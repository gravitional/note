# gcc 编译选项汇总

[gcc 编译选项汇总](https://zhuanlan.zhihu.com/p/347611674)

常用编译选项
`gcc` 和 `g++` 分别是 gnu 的 `c` 和 `c++`编译器,
gcc/g++在执行编译工作的时候, 总共需要4步

1. 预处理,生成.i的文件[预处理器cpp]
2. 将预处理后的文件不转换成汇编语言,生成文件.s[编译器egcs]
3. 有汇编变为目标代码(机器代码)生成.o的文件[汇编器as]
4. 连接目标代码,生成可执行程序[链接器ld]

## gcc 命令的常用选项

选项 解释

+ `-ansi`; 只支持 ANSI 标准的 C 语法.
这一选项将禁止 GNU C 的某些特色, 例如 asm 或 typeof 关键词.
+ `-m486`; 针对 486 进行代码优化.

+ `-DMACRO`; 以字符串"1"定义 MACRO 宏.
+ `-DMACRO=DEFN`; 以字符串"DEFN"定义 MACRO 宏.
+ `-UMACRO`; 取消对 MACRO 宏的定义.

+ `-o FILE`; 生成指定的输出文件. 用在生成可执行文件时.
+ `-c`; 只编译并生成目标文件(object).

    ```bash
    gcc -c test.s -o test.o
    ```

+ `-E`; 只运行 `C预编译器`.
+ `-g`; 生成调试信息. GNU 调试器可利用该信息.

头文件/库

+ `-IDIRECTORY`; 指定额外的 `头文件搜索路径的目录`. 大写 `-I`, `Inclue`.
+ `-LDIRECTORY`; 指定额外的 `函数库搜索路径的目录`. 大写 `-L`, `Library directory`.
+ `-lLIBRARY`; 连接时搜索指定的 `函数库` `lIBRARY`. 小写 `-l`, `libraray`.

+ `-O0`; 不进行优化处理.
+ `-O`; 或 `-O1` 优化生成代码.
+ `-O2`; 进一步优化.
+ `-O3`; 比 `-O2` 更进一步优化, 包括 `inline` 函数.

+ `-shared`; 生成共享目标文件. 通常用在建立共享库时.
+ `-static`; 禁止使用共享连接.

+ `-w`; 不生成任何警告信息.
+ `-Wall`; 生成所有警告信息.

## -fPIC, -fpic

[关于-fPIC, -fpic, -fpie, -fPIE的一点理解](https://blog.csdn.net/mao_hui_fei/article/details/106810977)

## -fPIC, -fpic, -fpie, -fPIE异同

-fPIC与-fpic都是在编译时加入的选项, 用于生成位置无关的代码(Position-Independent-Code).
这两个选项都是可以使代码在加载到内存时使用相对地址, 所有对固定地址的访问都通过全局偏移表(GOT)来实现.
-fPIC和-fpic最大的区别在于是否对GOT的大小有限制.
-fPIC对GOT表大小无限制, 所以如果在不确定的情况下, 使用-fPIC是更好的选择.

-fPIE与-fpie是等价的. 这个选项与-fPIC/-fpic大致相同, 不同点在于:
-fPIC用于生成动态库, -fPIE用与生成可执行文件.
再说得直白一点: -fPIE用来生成位置无关的可执行代码.

### pic 与PIC的异同

相同点: 都是为了在动态库中生成位置无关的代码.
通过全局偏移表(GOT)访问所有常量地址. 程序启动时动态加载程序解析GOT条目.

不同点: 如果链接的可执行文件的GOT大小超过计算机特定的最大大小,
则会从链接器收到错误消息, 指示-fpic不起作用;在这种情况下,
请使用-fPIC重新编译. GOT大小根据操作系统的不同而大小不一样,
SPARC上为8k, 在AArch64上为28k, 在m68k和 RS/6000 上为32k. x86没有此限制.

### 总结

为了兼容各个系统, 在生成位置无关的代码的时候, 应该使用-fPIC参数.
