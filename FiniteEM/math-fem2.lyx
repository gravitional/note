#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass ctex-book
\begin_preamble
\input{math-preamble}
\end_preamble
\options UTF8,dvipsnames,svgnames,x11names,hyperref,colorlinks=true
\use_default_options true
\begin_modules
theorems-ams-chap-bytype
graphicboxes
\end_modules
\maintain_unincluded_children false
\language chinese-simplified
\language_package none
\inputencoding utf8-plain
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures false
\graphics default
\default_output_format pdf4
\output_sync 0
\bibtex_command default
\index_command default
\float_placement H
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 2
\use_package amssymb 2
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
数学笔记
\end_layout

\begin_layout Author
Young
\end_layout

\begin_layout Chapter
静电场
\end_layout

\begin_layout Section
直角坐标系
\end_layout

\begin_layout Standard
如上所述
\end_layout

\begin_layout Section
轴对称电场
\end_layout

\begin_layout Standard
柱坐标 
\begin_inset Formula $(r,\phi,z)$
\end_inset

 下的 
\begin_inset Formula $\nabla^{2}$
\end_inset

 算子：
\begin_inset Formula 
\[
\nabla^{2}\psi=\frac{1}{r}\partial_{r}\left(r\,\partial_{r}\psi\right)+\frac{1}{r^{2}}\partial_{\phi}^{2}\psi+\partial_{z}^{2}\psi
\]

\end_inset


\end_layout

\begin_layout Standard
轴对称情况下，电场方程 
\begin_inset Formula $-\varepsilon\nabla^{2}\Phi=\rho$
\end_inset

 在柱坐标系下可以写成：
\begin_inset Formula 
\[
-\frac{1}{r}\partial_{r}\left(\epsilon_{r}\,r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}
\]

\end_inset

将方程化简成如下形式
\begin_inset Formula 
\begin{equation}
-\partial_{r}\left(\epsilon_{r}r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}r\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}r\label{eq:xl2.5-1}
\end{equation}

\end_inset

如果作替换
\begin_inset Formula 
\begin{align*}
 & r\to x,\quad z\to y,\\
 & \epsilon_{r}r\to\tilde{\varepsilon}(x),\quad\rho r\to\tilde{\rho}(x)
\end{align*}

\end_inset

则原方程可以写作
\begin_inset Formula 
\begin{equation}
-\partial_{x}\left[\tilde{\varepsilon}(x)\,\partial_{x}\Phi\right]-\partial_{y}\left[\tilde{\varepsilon}(x)\,\partial_{y}\Phi\right]=\tilde{\rho}(x)\label{eq:xl2.5}
\end{equation}

\end_inset

此方程的求解和二维情况完全相同，即它对应的泛函和通常的二维情况相同。
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\Phi\right)=\frac{1}{2\pi}\int_{\Omega^{e}}\left[\frac{1}{2}(\nabla N_{i}^{e}\cdot\epsilon_{r}\cdot\nabla N_{j}^{e})\,\Phi_{i}\Phi_{j}-\int_{\Omega^{e}}\frac{\rho}{\epsilon_{0}}N_{i}^{e}\Phi_{i}\right]\dd{\Omega}.
\]

\end_inset

其中
\begin_inset Formula $\dd{\Omega}=r\dd{r}\dd{z}\dd{\phi}$
\end_inset

，关于 
\begin_inset Formula $\phi$
\end_inset

 的积分给出
\begin_inset Formula $2\pi$
\end_inset

因子，与前面的系数
\begin_inset Formula $1/2\pi$
\end_inset

 互相抵消。对上式的泛函变分时，自由度是电势
\begin_inset Formula $\Phi_{i}$
\end_inset

，因此与 
\begin_inset Formula ${\color{blue}\varepsilon}$
\end_inset

 是否依赖于空间坐标无关。仍然给出泊松方程
\begin_inset Formula 
\[
\nabla\cdot\epsilon_{r}\cdot\nabla\Phi=-\frac{\rho}{\epsilon_{0}}.
\]

\end_inset


\end_layout

\begin_layout Standard
类似地，对于 Galerkin 方程，推导步骤也是相同的。只不过把其中的 
\begin_inset Formula $\varepsilon$
\end_inset

，
\begin_inset Formula $\rho$
\end_inset

 替换成相应的波浪线版本。
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\tilde{\rho}\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset


\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\left(-\tilde{\varepsilon}\right)\cdot\nabla\phi}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Remark
在 Simdroid 中，UI界面的对称轴是 
\begin_inset Formula $y$
\end_inset

 轴，不同于上述推导中的
\begin_inset Formula $z$
\end_inset

轴。但 
\begin_inset Formula $z$
\end_inset

 or 
\begin_inset Formula $y$
\end_inset

 只是一个标志，实际是什么无所谓。对于方程
\begin_inset Formula 
\[
-\frac{1}{r}\partial_{r}\left(\epsilon_{r}\,r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}
\]

\end_inset

重要的是 
\begin_inset Formula $r,z$
\end_inset

 坐标的相对次序，即
\begin_inset Formula $r$
\end_inset

 是坐标
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $z$
\end_inset

 是坐标
\begin_inset Formula $2$
\end_inset

。在随后的符号重排
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，
\begin_inset Formula $\tilde{\varepsilon}(r)=\epsilon_{r}\,r$
\end_inset

，
\begin_inset Formula $\tilde{\rho}(r)=\rho\,r$
\end_inset

，即
\begin_inset Formula $\tilde{\varepsilon}$
\end_inset

，
\begin_inset Formula $\tilde{\rho}$
\end_inset

 是坐标
\begin_inset Formula $1$
\end_inset

 的函数。由于轴对称边值问题被转化为 
\begin_inset Formula $x,y$
\end_inset

 平面上的问题，只要在求解算法中保持坐标次序即可，即这里应该把 
\begin_inset Formula $x$
\end_inset

 乘到 
\begin_inset Formula $\varepsilon,\rho$
\end_inset

 上。
\end_layout

\begin_layout Section
静电场的能量
\end_layout

\begin_layout Standard
目录:p18; Jackson p68/43; sec1.11
\end_layout

\begin_layout Standard
静电场能的两种表示方式：
\begin_inset Formula 
\begin{align}
 & W=\frac{1}{2}\int\rho(\sbf x)\Phi(\sbf x)\dd[3]{x},\quad W=\frac{1}{8\pi\epsilon_{0}}\sum_{i}\sum_{j}\frac{q_{i}q_{j}}{\abs{\sbf x_{i}-\sbf x_{j}}}\label{eq:j1.53}\\
 & W=\frac{\epsilon_{0}}{2}\int\abs{\sbf E}^{2}\dd[3]{x}.\label{eq:j1.54}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
第一行的公式分别是连续和离散情形。双求和忽略了 
\begin_inset Formula $i=j$
\end_inset

 的项，即“自能项”。
\end_layout

\begin_layout Enumerate
两种公式的物理图像分别为：电荷之间的相互作用能；电场中存储的能量。
\end_layout

\begin_layout Enumerate
电场的能量是正定的；相互作用能可能是负值。
\end_layout

\begin_layout Standard
考虑两个点电荷 
\begin_inset Formula $q_{1}$
\end_inset

，
\begin_inset Formula $q_{2}$
\end_inset

 组成的体系，空间一点
\begin_inset Formula $\sbf x$
\end_inset

处的电势和静电能分别为：
\begin_inset Formula 
\begin{align}
 & \sbf E=\frac{1}{4\pi\epsilon_{0}}\frac{q_{1}(\sbf x-\sbf x_{1})}{\abs{\sbf x-\sbf x_{1}}^{3}}+\frac{1}{4\pi\epsilon_{0}}\frac{q_{2}(\sbf x-\sbf x_{2})}{\abs{\sbf x-\sbf x_{2}}^{3}},\nonumber \\
 & 32\pi^{2}\epsilon_{0}w=\frac{q_{1}^{2}}{\abs{\sbf x-\sbf x_{1}}^{4}}+\frac{q_{2}^{2}}{\abs{\sbf x-\sbf x_{2}}^{4}}+2\frac{q_{1}q_{2}(\sbf x-\sbf x_{1})\cdot(\sbf x-\sbf x_{2})}{\abs{\sbf x-\sbf x_{1}}^{3}\abs{\sbf x-\sbf x_{2}}^{3}}.\label{eq:j1.56}
\end{align}

\end_inset

前两项是两个点电荷的自能，后一项是相互作用能。
\end_layout

\begin_layout Subsection
电容矩阵
\end_layout

\begin_layout Standard
FEM-Gerard; page 31/47; sec 1.3.8.8 
\end_layout

\begin_layout Standard
在含有 
\begin_inset Formula $n$
\end_inset

 个导体的系统中，第 
\begin_inset Formula $i$
\end_inset

 个导体上的电荷
\begin_inset Formula $Q_{i}$
\end_inset

 可以用所有导体上的电势
\begin_inset Formula $V_{j}$
\end_inset

，以及一些几何参数，共同表出：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
Q_{i}=\sum_{j=1}^{n}C_{ij}V_{j},\quad i=1,2,\cdots,n\label{eq:j1.61}
\end{equation}

\end_inset

系数 
\begin_inset Formula $C_{ii}$
\end_inset

 被称为电容（capacities or capacitances），非对角元
\begin_inset Formula $C_{ij}$
\end_inset

被称为互感系数。
\end_layout

\begin_layout Enumerate
导体的电容，等于它带单位电势时的电荷，同时保持其他导体电势为零。
\end_layout

\begin_layout Enumerate
电容矩阵 
\begin_inset Formula $C_{ij}$
\end_inset

 是对称矩阵，表示两个导体间的电荷相互作用是对等的。
\end_layout

\begin_layout Enumerate
非对角元 
\begin_inset Formula $C_{ij}$
\end_inset

 对应两个导体间的互作用能量。
\begin_inset Formula 
\[
C_{ij}V_{i}V_{j}=\int_{\Omega}\sbf E_{i}\cdot\sbf D_{j}\dd{\Omega},\quad i,j\,\text{不求和}
\]

\end_inset


\end_layout

\begin_layout Standard
导体系统的 静电能 可以表示为
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\sum_{i=1}^{n}Q_{i}V_{i}=\frac{1}{2}\sum_{i=1}^{n}\sum_{j=1}^{n}C_{ij}V_{i}V_{j}.\label{eq:j1.62}
\end{equation}

\end_inset


\begin_inset Formula $C_{ii}V_{i}^{2}$
\end_inset

是正定的，对应电荷的“自能”（self energy）；
\begin_inset Formula $C_{ij}V_{i}V_{j}$
\end_inset

对应相互作用能 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j1.53"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Section
电介质中的静电能
\end_layout

\begin_layout Standard
p190; sec 4.7 
\end_layout

\begin_layout Standard
见 Sec1.11，自由空间电荷系统的能量为：
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\int\rho(\sbf x)\Phi(\sbf x)\dd[3]{x}.\label{eq:j4.83}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
存在电介质的情况下，静电能的微小变分为：
\begin_inset Formula 
\begin{equation}
\delta W=\int\delta\rho(\sbf x)\Phi(\sbf x)\dd[3]{x}.\label{eq:j4.84}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\Phi(\sbf x)$
\end_inset

 是由于已存在电荷密度 
\begin_inset Formula $\rho(\sbf x)$
\end_inset

产生的电势。考虑到 
\begin_inset Formula $\nabla\cdot\sbf D=\rho$
\end_inset

，我们可以作替换
\begin_inset Formula 
\begin{equation}
\delta\rho=\nabla\cdot(\delta\sbf D).\label{eq:j4.85}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
\nabla\cdot(\Phi\delta\sbf D) & =(\nabla\phi)\cdot\delta\sbf D+\Phi\nabla\cdot\delta\sbf D\\
 & =-\sbf E\cdot\delta\sbf D+\Phi\delta\rho
\end{align*}

\end_inset

如果电荷分布在有限空间内，则 
\begin_inset Formula $\nabla\cdot(\Phi\delta\sbf D)$
\end_inset

 在全空间的积分为零（应用高斯散度定理）。因此可以把静电能的变分写成：
\begin_inset Formula 
\begin{equation}
\delta W=\int\sbf E\cdot\delta\sbf D\dd[3]{x}.\label{eq:j4.86}
\end{equation}

\end_inset

因此当
\begin_inset Formula $\sbf D$
\end_inset

从初始值
\begin_inset Formula $0$
\end_inset

变化到最终值时，在形式上可以把静电能写成：
\begin_inset Formula 
\begin{equation}
W=\int\dd[3]x\int_{0}^{D}\sbf E\cdot\delta\sbf D.\label{eq:j4.87}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
如果介质是 
\emph on
线性的
\emph default
，则
\begin_inset Formula 
\begin{equation}
\sbf E\cdot\delta\sbf D=\frac{1}{2}\delta\left(\sbf E\cdot\sbf D\right).\label{eq:4.88}
\end{equation}

\end_inset

总能量可以写成
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\int\sbf E\cdot\sbf D\dd[3]{x}.\label{eq:j4.89}
\end{equation}

\end_inset

如果假设 
\begin_inset Formula $\rho$
\end_inset

 和 
\begin_inset Formula $\Phi$
\end_inset

 是线性相关的，通过 
\begin_inset Formula $\sbf E=-\nabla\Phi$
\end_inset

 和 
\begin_inset Formula $\nabla\cdot\sbf D=\rho$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.89"
plural "false"
caps "false"
noprefix "false"

\end_inset

 可以回到
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.83"
plural "false"
caps "false"
noprefix "false"

\end_inset

或
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.84"
plural "false"
caps "false"
noprefix "false"

\end_inset

 。因此，
\emph on
只有当行为是线性的，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.83"
plural "false"
caps "false"
noprefix "false"

\end_inset

在宏观上才成立。
\emph default
否则，只能使用
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.87"
plural "false"
caps "false"
noprefix "false"

\end_inset

计算，最终的 静电能 依赖于极化历史。
\end_layout

\begin_layout Section
非线性材料的电容矩阵
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
g1 = Plot[x^(3/5), {x, 0, 5} , AxesLabel -> {"D", "E"} , ImageSize -> Small];
 g2 = Plot[Log[x + 1], {x, 0, 5} , AxesLabel -> {"Q", "U"} , ImageSize ->
 Small]; GraphicsRow[{g1, g2}]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/capacitance-curve.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Formula $E-D$
\end_inset

曲线与
\begin_inset Formula $U-Q$
\end_inset

曲线，静电能的等价表示形式为
\begin_inset Formula $\delta w=E\delta D$
\end_inset

，
\begin_inset Formula $\delta w=U\delta Q$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
follow XuLei，两张图中，曲线上的点是一一对应的，根据对应关系有：
\begin_inset Formula 
\begin{align*}
\frac{1}{2}\delta\sbf E\cdot\delta\sbf D & =\frac{1}{2}\delta U\delta fQ\\
 & =\frac{1}{2}\delta U\;C\delta U
\end{align*}

\end_inset

假设由边值问题
\begin_inset Formula $\alpha$
\end_inset

，求解出了电场结果 
\begin_inset Formula $\beta$
\end_inset

。在确定的几何点
\begin_inset Formula $P$
\end_inset

，和电场 
\begin_inset Formula $\sbf E$
\end_inset

 下，
\begin_inset Formula $\varepsilon=\partial D/\partial E$
\end_inset

，
\begin_inset Formula $C=\partial Q/\partial U$
\end_inset

 都是确定的。这时候作完全线性化，完全按照线性系统处理，取 
\begin_inset Formula $\delta U=\SI{1}{V}$
\end_inset

，给出
\begin_inset Formula 
\[
C=\delta\sbf E\cdot\delta\sbf D.
\]

\end_inset

这个式子的含义是：
\end_layout

\begin_layout Enumerate
体系此时的电容，可以由 
\begin_inset Formula $\delta U=\SI{1}{V}$
\end_inset

 条件定出的电场得到；
\end_layout

\begin_layout Enumerate
在使用 Galerkin 方程计算过程中，认定 
\begin_inset Formula $\varepsilon=\partial D/\partial E$
\end_inset

 为常数，
\begin_inset Formula $\varepsilon$
\end_inset

 的每一几何点的具体值，由之前边值问题的解 
\begin_inset Formula $\beta$
\end_inset

 提供；材料性质的影响体现在此处。
\end_layout

\begin_layout Enumerate
而 
\begin_inset Formula $\sbf D$
\end_inset

与 
\begin_inset Formula $\sbf E$
\end_inset

 的关系，由材料在当前 
\begin_inset Formula $\sbf E$
\end_inset

 下的电介质数 
\begin_inset Formula $\varepsilon$
\end_inset

 决定。非线性材料的 电介质数 
\begin_inset Formula $\varepsilon$
\end_inset

 与 
\begin_inset Formula $\sbf E$
\end_inset

 的关系可能比较复杂，但在当前一点可以当成常数。
\end_layout

\begin_layout Enumerate
并且对于多导体系统，还类似地定义电容矩阵：
\begin_inset Formula 
\[
C_{ij}=\frac{1}{\delta U_{i}\delta U_{j}}\int_{\Omega}\sbf D_{i}\cdot\sbf E_{j}\dd{\Omega},
\]

\end_inset

积分区域是全系统空间，实际上还取了 
\begin_inset Formula $\delta U_{i}=\delta U_{j}=\SI{1}{V}$
\end_inset

。
\end_layout

\begin_layout Remark
体系的电容 
\begin_inset Formula $C$
\end_inset

 与体系的几何构型，以及材料的电介质数 
\begin_inset Formula $\varepsilon$
\end_inset

 相关。以上方法实际上就是：
\color blue
在点的局域上，把 非线性材料 权当成 线性材料 处理
\color inherit
。线性材料的互容矩阵实际上就是
\begin_inset Formula 
\[
C_{ij}=\frac{1}{U_{i}U_{j}}\int_{\Omega}\sbf D_{i}\cdot\sbf E_{j}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Section
虚功法
\end_layout

\begin_layout Standard
FEM-Gerard; sec 38/54;
\end_layout

\begin_layout Standard
刚体上的力和力矩（torque）也可以使用虚功原理（virtual work theorem）计算。在微小位移
\begin_inset Formula $\delta u$
\end_inset

下，装置的内能（internal energy）的变化 
\begin_inset Formula $\delta W_{e}$
\end_inset

，等于 外源（external sources）输入的电能，加上力 
\begin_inset Formula $-F_{u}$
\end_inset

（牛顿第三定律）的功：
\begin_inset Formula 
\begin{equation}
\delta W_{e}=\sum V_{k}\delta Q_{k}-F_{u}\delta u=\sum\frac{\partial W_{e}}{\partial Q_{k}}\delta Q_{k}+\frac{\partial W_{e}}{\partial u}\delta u.\label{eq:g1.117}
\end{equation}

\end_inset


\end_layout

\begin_layout Example
在实验一中，装置与外界电源隔离。电极上的电荷总量不变，即 
\begin_inset Formula $\delta Q_{k}=0$
\end_inset

，因此给出
\begin_inset Formula 
\begin{align}
 & F_{u}=-\frac{\partial W_{e}}{\partial u}.\label{eq:g1.118}\\
 & C_{\omega}=-\frac{\partial W_{e}}{\partial\theta}.\label{eq:g1.119}
\end{align}

\end_inset

其中 
\begin_inset Formula $C_{\omega}$
\end_inset

 表示绕旋转轴 
\begin_inset Formula $\omega$
\end_inset

 的力矩。求偏导时，保持 electric state variable（电极上的电荷）不变。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
在实验二中，把装置连接到 恒压源，电极上的电势 
\begin_inset Formula $V_{k}$
\end_inset

 保持不变，而电极上的电荷可能会变化 
\begin_inset Formula $\delta Q_{k}$
\end_inset

。现在，更适合用系统的共能（coenergy）去分析。
\begin_inset Formula 
\begin{align}
 & \sum V_{k}\delta Q_{k}-\sum\delta\left(V_{k}Q_{k}\right)-F_{u}\delta u=\delta W_{e}-\sum\delta\left(V_{k}Q_{k}\right).\label{eq:g1.120}\\
\Rightarrow & -\sum Q_{k}\delta V_{k}-F_{u}\delta u=-\delta W_{c}=-\sum\frac{\partial W_{c}}{\partial V_{k}}\delta V_{k}-\frac{\partial W_{c}}{\partial u}\delta u.\label{eq:g1.121}
\end{align}

\end_inset

现在，力和力矩可以用 共能 的偏导表示，
\begin_inset Formula 
\begin{align}
 & F_{u}=\frac{\partial W_{c}}{\partial u},\label{eq:g1.122}\\
 & C_{\omega}=\frac{\partial W_{c}}{\partial\theta}.\label{eq:g1.123}
\end{align}

\end_inset

求偏导时保持 electric state variable（电极上的电压）不变。
\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Plain Layout
page 20/36;
\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\begin{equation}
\frac{\partial W_{c}}{\partial v_{i}}=-\iint D\cdot\mathrm{grad}\varphi_{i}h\dd{x}\dd{y}-\iint\rho\varphi_{i}h\dd{x}\dd{y}=0\quad\text{for}\quad i=1,2,\cdots,N_{L}\label{eq:g1.52-1}
\end{equation}

\end_inset


\begin_inset Formula $v_{i}$
\end_inset

 表示节点上的值，一共有 
\begin_inset Formula $N_{L}$
\end_inset

个。
\end_layout

\begin_layout Plain Layout
page 14/30;
\begin_inset Formula 
\begin{equation}
W_{c}=\iint\left[\int_{0}^{-\nabla v}D\dd{E}-\rho v\right]h\dd{x}\dd{y}\label{eq:g1.35-1}
\end{equation}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Example
当电极上的电势保持常数时，coenergy 的有限元近似只是位移 
\begin_inset Formula $u$
\end_inset

 的函数，或者通过 
\color blue
节点的坐标直接依赖
\color inherit
，或者通过 
\color brown
节点电势间接依赖
\color inherit
：
\begin_inset Formula 
\begin{equation}
W_{c}=W_{c}\left[{\color{brown}v_{1}(u),v_{2}(u),\cdots,v_{N_{L}}(u)},{\color{blue}u}\right]=W_{c}(u).\label{eq:g1.126}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
F_{u}=\frac{\dd{W_{c}}}{\dd{u}}=\sum_{j=1}^{N_{L}}\frac{\partial W_{c}}{\partial v_{j}}\frac{\dd{v_{j}}}{\dd{u}}+\frac{\partial W_{c}}{\partial u}.\label{eq:g1.127}
\end{equation}

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g1.52-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，共能对 节点电势的偏导为零，因此
\begin_inset Formula 
\begin{equation}
F_{u}=\frac{\partial W_{c}}{\partial u}.\label{eq:g1.128}
\end{equation}

\end_inset

求偏导时保持 节点电势不变。
\end_layout

\begin_layout Example
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/Gerard-1.11.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Virtual deformation of the meshing。浅灰色的是弹性单元。白色的是刚体单元。空心节点表示能够运动。
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
开放边界/开域问题
\end_layout

\begin_layout Standard
有限元方法只能处理有限大的空间，因此对于电场的开域问题，需要在边界上施加适当的边界条件来模拟边界的性质。首先根据麦克斯韦方程组，可以得到开域情况下电势满足的积分
方程：
\begin_inset Formula 
\[
\Phi\left(\sbf r\right)=\frac{1}{4\pi\varepsilon_{0}}\int\dd[3]{r'}\frac{1}{\abs{r-r'}}\left[\rho\left(\sbf r'\right)-\nabla'\cdot\sbf P\left(\sbf r'\right)\right]
\]

\end_inset

由于源都是局域的，因此在远离源的位置可以做如下展开：
\begin_inset Formula 
\[
\frac{1}{\abs{\sbf r-\sbf r'}}=\frac{1}{\abs{\sbf r}}+\frac{\sbf r\cdot\sbf r'}{\abs{\sbf r}^{3}}+\cdots
\]

\end_inset


\end_layout

\begin_layout Standard
取决于源的分布情况，电势在远离源的位置可能是以 
\begin_inset Formula $r^{-1}$
\end_inset

，或 
\begin_inset Formula $r^{-2}$
\end_inset

的形式衰减到零。在忽略高阶项的情况下，可以在远离源的位置将电势近似为
\begin_inset Formula 
\begin{equation}
\Phi=\frac{a}{r^{n}},\label{eq:xl2.6}
\end{equation}

\end_inset

其中 
\begin_inset Formula $a$
\end_inset

 是与 
\begin_inset Formula $r$
\end_inset

 无关的量；
\begin_inset Formula $n$
\end_inset

 可以由电荷的分布情况决定，对于同种电荷 
\begin_inset Formula $n$
\end_inset

 一般取
\begin_inset Formula $1$
\end_inset

，对于电偶极子
\begin_inset Formula $n$
\end_inset

一般取
\begin_inset Formula $2$
\end_inset

。在有限元模型边界上可以采用截断法来模拟开域边界，即取 
\begin_inset Formula $\Phi=0$
\end_inset

，或 
\begin_inset Formula $\nabla\Phi=0$
\end_inset

。两种处理方式分别对应 第一、二类边界条件，理论上的计算精度分别为 
\begin_inset Formula $\order{r^{-n}}$
\end_inset

 和 
\begin_inset Formula $\order{r^{-n-1}}$
\end_inset

。另外使用 
\begin_inset Formula $\nabla\frac{1}{r}=\frac{1}{r^{2}}\sbf e_{r}=\frac{1}{r^{2}}\frac{\sbf r}{r}$
\end_inset

，从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到： 
\begin_inset Formula 
\begin{equation}
\nabla\Phi=-na\frac{1}{r^{n+1}}\frac{\sbf r}{r}=-n\frac{\Phi}{r}\frac{\sbf r}{r}.\label{eq:xl2.7}
\end{equation}

\end_inset

如果在边界上采用 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 处理模型边界上的电势，那么理论上的计算精度可以达到 
\begin_inset Formula $\order{r^{-n-2}}$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示的条件即为 渐近边界条件（Asymptotic boundary condition），对应有限元计算中的第三类边界条件。
\end_layout

\begin_layout Section
表面项
\end_layout

\begin_layout Standard
在泛函积分式(2.2)
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\Phi\right)=\frac{1}{2}\int_{\Omega}\nabla\Phi\cdot\epsilon_{r}\nabla\Phi\dd{\Omega}-\int\frac{\rho}{\epsilon_{0}}\Phi\dd{\Omega}.\label{eq:xl2.2}
\end{equation}

\end_inset

中添加一个表面项得到新的泛函积分
\begin_inset Formula 
\[
\mathcal{F}\left(\Phi\right)=\frac{1}{2}\int_{\Omega}\nabla\Phi\cdot\epsilon_{r}\nabla\Phi\dd{\Omega}-\int\frac{\rho}{\epsilon_{0}}\Phi\dd{\Omega}+{\color{blue}\int_{\Gamma}\epsilon_{r}\frac{n}{r}\frac{\Phi\epsilon_{r}\Phi}{2}}\dd{\Gamma}.
\]

\end_inset

对上式做变分可以得到（使用分部积分）
\begin_inset Formula 
\[
\delta\mathcal{F}\left(\Phi\right)=-\int_{\Omega}\left(\nabla\cdot\epsilon_{r}\nabla\Phi+\frac{\rho}{\epsilon_{0}}\right)\delta\Phi\dd{\Omega}+\int_{\Gamma}\left({\color{blue}\sbf e_{n}\cdot\epsilon_{r}\nabla\Phi+\frac{n}{r}\epsilon_{r}\Phi}\right)\delta\Phi\dd{\Gamma}.
\]

\end_inset

从方程中的第二项可得
\begin_inset Formula 
\[
\sbf e_{n}\cdot\nabla\Phi=-n\frac{\Phi}{r}
\]

\end_inset

它等价于
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\Phi=-n\frac{\Phi}{r}\frac{\sbf r}{r}$
\end_inset

。对比第三类边界条件的标准形式：
\begin_inset Formula 
\[
\left(\alpha\nabla\Phi\right)\cdot\sbf n=q-\gamma\Phi
\]

\end_inset

相当于取 
\begin_inset Formula $\alpha=1$
\end_inset

，
\begin_inset Formula $q=0$
\end_inset

，
\begin_inset Formula $-\gamma=-\frac{n}{r}$
\end_inset

。
\end_layout

\begin_layout Remark
综上，开域边界条件相当于
\begin_inset Formula 
\[
-\nabla\Phi=\frac{n}{r}\Phi\,\sbf e_{r}
\]

\end_inset

取上式的变分得（变分和微分交换次序）
\begin_inset Formula 
\[
-\nabla\delta\Phi=\frac{n}{r}\delta\Phi\,\sbf e_{r}
\]

\end_inset


\end_layout

\begin_layout Section
Galerkin法
\end_layout

\begin_layout Standard
对于Galerkin 方法，保持残差函数不变
\begin_inset Formula 
\[
R^{e}\left[N_{i}^{e}\right]=\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}N_{i}^{e}\left({\color{blue}\nabla\cdot\sbf D}-\rho\right)\dd{\Omega}
\]

\end_inset

推导中的分部积分会自然地引入边界条件的贡献。考察 Galerkin 方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的边界项
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}
\end{align*}

\end_inset

其中（在开放边界足够大，渐近于球形的近似下）
\begin_inset Formula 
\[
{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot(-\sbf\nabla\delta\phi)}\Rightarrow N_{i}^{e}\sbf e_{r}\cdot\frac{\partial D}{\partial E}\cdot\sbf e_{r}\;\frac{n}{r}\delta\Phi
\]

\end_inset

同理，若代入微扰展开 
\begin_inset Formula $\delta\phi=\sum_{e=1}^{N}N_{j}^{e}\delta\phi_{j}$
\end_inset

，相当于在刚阵中添加一项
\begin_inset Formula 
\begin{equation}
N_{i}^{e}\;\sbf e_{r}\cdot\frac{\partial D}{\partial E}\cdot\sbf e_{r}\frac{n}{r}\;N_{j}^{e}\label{eq:el-open}
\end{equation}

\end_inset

或者写成
\begin_inset Newline newline
\end_inset


\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset Formula 
\[
\sbf r\cdot\frac{\partial D}{\partial E}\cdot\sbf r\;\frac{n}{r^{3}}\;N_{i}^{e}N_{j}^{e}
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{i}^{e}N_{j}^{e}$
\end_inset

 可以理解为 
\begin_inset Formula $N_{i1}^{e}N_{1j}^{e}=\left(N^{e}\cdot N^{e,T}\right)_{ij}$
\end_inset

，
\begin_inset Formula $N_{i1}^{e}$
\end_inset

为列矩阵。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r=\sqrt{x^{2}+y^{2}+z^{2}}$
\end_inset

，表示原点
\begin_inset Formula $O$
\end_inset

 到场点 
\begin_inset Formula $P$
\end_inset

 的距离。
\end_layout

\begin_layout Enumerate
为了保证计算精度，程序中要求开域边界条件的几何边界尽量为球形或圆形。
\end_layout

\begin_layout Section
边界形状和误差
\end_layout

\begin_layout Standard
对于球形边界，垂直边界的矢量 
\begin_inset Formula $\sbf e_{n}=\frac{\sbf r}{r}$
\end_inset

，所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示的渐近边界条件可以通过在泛函积分中添加相应的表面项来处理。对于非球形边界，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

近似成立。这一项会在原来的 
\begin_inset Formula $\left[K_{ij}^{e}\right]$
\end_inset

 矩阵中增加表面项的贡献
\begin_inset Formula 
\begin{equation}
K_{ij}^{s}=\int_{\Gamma^{e}}\epsilon_{r}\frac{n}{r}N_{i}^{e}N_{j}^{e}\dd{\Gamma}.\label{eq:xl2.8}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
由于 
\begin_inset Formula $r$
\end_inset

 在球形边界是定值，可以直接提取到积分外面；即使对于非圆形边界，
\begin_inset Formula $1/r$
\end_inset

 在边界处表面单元中变换不大，所以依然可以提到积分号外面。下面分二维，轴对称和三位情况分别计算 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
三维有限元的边界为一平面，采用高斯积分法计算的表达式为
\begin_inset Formula 
\[
K_{ij}^{s}=\epsilon_{r}\frac{n}{r}\Delta^{s}\sum_{\alpha}N_{i}^{s}\left(\xi_{\alpha},\eta_{\alpha}\right)\,N_{j}^{s}\left(\xi_{\alpha},\eta_{\alpha}\right)\,W\left(\xi_{\alpha},\eta_{\alpha}\right)
\]

\end_inset

其中 
\begin_inset Formula $\Delta^{s}$
\end_inset

 为边界单元的面积。
\end_layout

\begin_layout Remark
ref：郭硕鸿 p63/77。电多级展开：
\begin_inset Formula 
\[
f\left(\sbf x-\sbf x'\right)=f\left(\sbf x\right)-\sbf x'\cdot\nabla f@\sbf x+\frac{1}{2!}\left(\sbf x'\cdot\nabla\right)^{2}f@\sbf x+\cdots
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\varphi\left(x\right)=\frac{1}{4\pi\varepsilon_{0}}\left(\frac{Q}{R}-\sbf p\cdot\nabla\frac{1}{R}+\frac{1}{6}\sum_{i,j}\mathcal{D}_{ij}\partial_{i}\partial_{j}\frac{1}{R}+\cdots\right)\label{eq:g6.7}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
Q & =\int_{V}\rho\left(\sbf x'\right)\dd{V'}\\
\sbf p & =\int_{V}\rho\left(\sbf x'\right)\dd{V'}\\
\mathcal{D}_{ij} & =\int_{V}3x'_{i}x'_{j}\,\rho\left(\sbf x'\right)\dd{V'}
\end{align*}

\end_inset

其中
\begin_inset Formula $R=\sqrt{x^{2}+y^{2}+z^{2}}$
\end_inset

，表示原点到场点 
\begin_inset Formula $P$
\end_inset

 的距离。
\end_layout

\begin_layout Section
外加电场
\end_layout

\begin_layout Subsection
解析解的例子
\end_layout

\begin_layout Standard
ref: 郭硕鸿 p51/65；均匀介质球的极化，球外为真空，半径为 
\begin_inset Formula $R_{0}$
\end_inset

，均匀外电场为 
\begin_inset Formula $\sbf E_{0}$
\end_inset

。
\begin_inset CommandInset label
LatexCommand label
name "ref:g51"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/GuoShuoHong-2.5.png
	lyxscale 50
	scale 40

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\sbf E_{0}$
\end_inset

 的方向为球坐标系 
\begin_inset Formula $z$
\end_inset

 轴，并过球心
\begin_inset Formula 
\begin{align}
\text{球外解：} & \varphi_{1}=-E_{0}R\cos\theta+\frac{\varepsilon-\epsilon_{0}}{\varepsilon+2\epsilon_{0}}\frac{E_{0}R_{0}^{3}\cos\theta}{R^{2}}\nonumber \\
\text{球内解：} & \varphi_{2}=-\frac{3\epsilon_{0}}{\varepsilon+2\epsilon_{0}}E_{0}R\cos\theta.\label{eq:g3.21}
\end{align}

\end_inset

球内是均匀电场，球内束缚电荷激发的场与原外场反向，使总电场减弱。在球内总电场作用下，介质的极化强度为
\begin_inset Formula 
\begin{equation}
\sbf P=\chi_{e}\epsilon_{0}\sbf E=\left(\varepsilon-\epsilon_{0}\right)\sbf E=\frac{\varepsilon-\epsilon_{0}}{\varepsilon+2\epsilon_{0}}3\epsilon_{0}\sbf E_{0}\label{eq:g3.22}
\end{equation}

\end_inset

 介质球的总电偶极矩为
\begin_inset Formula 
\begin{equation}
\sbf p=\frac{4\pi}{3}R_{0}^{3}\sbf P=\frac{\varepsilon-\epsilon_{0}}{\varepsilon+2\epsilon_{0}}4\pi\epsilon_{0}R_{0}^{3}\sbf E_{0}\label{eq:g3.23}
\end{equation}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.21"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的第二项正是此电偶极矩所产生的电势
\begin_inset Formula 
\begin{equation}
\frac{1}{4\pi\epsilon_{0}}\frac{\sbf p\cdot\sbf R}{R^{3}}=\frac{\varepsilon-\epsilon_{0}}{\varepsilon+2\epsilon_{0}}\frac{E_{0}R_{0}^{3}\cos\theta}{R^{2}}\label{eq:g3.24}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
有限元中的处理
\end_layout

\begin_layout Standard
在程序实现中，规定 
\color blue
外加电场
\color inherit
 总是配合 
\color blue
开域边界
\color inherit
 一同使用，且边界应当是球形，介质是线性的。令外加电场为 
\begin_inset Formula $\sbf E_{0}$
\end_inset

，除去它的影响之后，令 有限区域电荷产生的电势为 
\begin_inset Formula $\Phi$
\end_inset

，令总电势为 
\begin_inset Formula $\Phi_{t}=\Phi-\sbf E_{0}\cdot\sbf r$
\end_inset

， 
\begin_inset Formula $\Phi$
\end_inset

 应该满足 开域边界条件 的性质，即
\begin_inset Formula 
\begin{equation}
{\color{brown}-\nabla\Phi=\frac{n}{r}\Phi\,\sbf e_{r}}\label{eq:phi-local}
\end{equation}

\end_inset

代入 
\begin_inset Formula $\Phi={\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}$
\end_inset

， 
\begin_inset Formula 
\[
-\nabla\left({\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}\right)=\frac{n}{r}\left({\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}\right)\sbf e_{r}
\]

\end_inset

略微化简给出
\begin_inset Formula 
\begin{equation}
{\color{brown}-\nabla\Phi_{t}=\frac{n}{r}\Phi_{t}\sbf e_{r}}+\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{r}\right)\sbf e_{r}\label{eq:phi-global}
\end{equation}

\end_inset

可以看到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi-global"
plural "false"
caps "false"
noprefix "false"

\end_inset

 与 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi-local"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的区别是多了后面两项。代入Galerkin 方程 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal3"
plural "false"
caps "false"
noprefix "false"

\end_inset

边界项 
\begin_inset Formula $N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot(\sbf\nabla\delta\phi)$
\end_inset

：并把 
\begin_inset Formula ${\color{brown}-\nabla\Phi_{t}=\frac{n}{r}\Phi_{t}\sbf e_{r}}$
\end_inset

 的贡献归入刚阵 
\begin_inset Formula $K_{ij}^{e}$
\end_inset

；把 
\begin_inset Formula $\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{r}\right)\sbf e_{r}$
\end_inset

 的贡献归入 载荷（Load），载荷项的形式为
\begin_inset Formula 
\[
-N_{i}\,\sbf e_{n}\cdot\varepsilon\cdot\left[\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{R}\right)\sbf e_{R}\right].
\]

\end_inset


\end_layout

\begin_layout Subsection
backup
\end_layout

\begin_layout Standard
在有限元框架下求解外加电场的问题，外加电场 
\begin_inset Formula $\sbf E_{0}$
\end_inset

 的影响体现在 两个边界项中。观察 Galerkin 方程
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}
\end{align*}

\end_inset


\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}$
\end_inset

这一项体现的是背景场（即
\begin_inset Formula $\sbf E_{0}$
\end_inset

 ）的贡献；而 
\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}$
\end_inset

 则类似于开域边界条件。
\end_layout

\begin_layout Standard
参考 
\begin_inset CommandInset ref
LatexCommand eqref
reference "ref:g51"
plural "false"
caps "false"
noprefix "false"

\end_inset

，在外加电场影响下，极化电荷在边界处的电势形如
\begin_inset Formula 
\[
\Phi=a\frac{\cos\theta}{R^{n}},
\]

\end_inset

对于电偶极子 
\begin_inset Formula $n=2$
\end_inset

，其中 
\begin_inset Formula $\cos\theta=\sbf E_{0}\cdot\sbf e_{R}$
\end_inset

。考察边界上的电势法向量，
\begin_inset Formula 
\[
-\nabla\Phi=a\frac{\cos\theta}{R^{n}}\frac{n}{R}\sbf e_{R}+a\frac{\sin\theta}{R^{n}}\frac{1}{R}\sbf e_{\theta}
\]

\end_inset

对应的变分是
\begin_inset Formula 
\[
-\sbf\nabla\delta\phi=\frac{n}{R}\sbf e_{R}\delta\Phi+(\cdots)\sbf e_{\theta}
\]

\end_inset

Galerkin 方程边界项的贡献是
\begin_inset Formula 
\[
-N_{i}^{e}\sbf e_{n}\cdot\varepsilon\cdot{\color{brown}\sbf\nabla\delta\phi}=N_{i}^{e}\sbf e_{n}\cdot\varepsilon\cdot{\color{brown}\sbf e_{R}\,\frac{n}{R}\delta\Phi}
\]

\end_inset


\end_layout

\begin_layout Remark
其中使用了球坐标下的梯度表达式
\begin_inset Formula 
\[
\nabla\psi=\sbf e_{r}\partial_{r}\psi+\frac{1}{r}\sbf e_{\theta}\partial_{\theta}\psi+\frac{1}{r\sin\theta}\partial_{\phi}\sbf e_{\phi}.
\]

\end_inset


\end_layout

\begin_layout Chapter
电流场分析
\end_layout

\begin_layout Section
稳态电流场
\end_layout

\begin_layout Standard
导体中的电流密度矢量会因为导体的几何构型出现不均匀的分布，通过建立电流场相关的方程，用有限元进行求解，可以得到导体目标区域的电流密度矢量分布情况，计算欧姆损耗等
。在稳态情况下，电流密度矢量可以通过欧姆定理表示为
\begin_inset Formula 
\[
\sbf J=\sigma\sbf E
\]

\end_inset

而电场又可以表示为势能的梯度，即
\begin_inset Formula 
\[
\sbf E=-\nabla\phi
\]

\end_inset

根据连续性方程
\begin_inset Formula $\nabla\cdot\sbf J=0$
\end_inset

，最终可以得到稳态电流场中，标量势所满足的方程
\begin_inset Formula 
\[
\nabla\cdot\sigma\nabla\phi=0.
\]

\end_inset

其表达式与静电场的方程类似，只是方程系数由介电常数换成电导率。另外电流密度矢量在沿着导体流动的截面上还需要满足约束方程
\begin_inset Formula 
\[
\int_{S}\sbf J\cdot\dd{\sbf S}=-\int_{S}\sigma\nabla\phi\cdot\dd{\sbf S}=I
\]

\end_inset


\end_layout

\begin_layout Standard
综合上述方程，就可以计算稳态电流场中的势能分布，进而计算出空间中的电流密度矢量等物理量。
\end_layout

\begin_layout Section
时谐和瞬态电流场
\end_layout

\begin_layout Standard
在稳态电流场的问题中，标量势
\begin_inset Formula $\phi$
\end_inset

的分布不随时间变化；但在瞬态或交流问题中，需要考虑位移电流
\begin_inset Formula $\sbf D$
\end_inset

的影响，将电流密度矢量记为
\begin_inset Formula $\mathbb{J}(t)$
\end_inset

，由材料本构关系
\begin_inset Formula 
\[
\sbf\mathbb{J}(t)=\epsilon\frac{\partial\sbf\mathbb{E}(t)}{\partial t}+\sigma\sbf\mathbb{E}(t).
\]

\end_inset

电流连续性方程
\begin_inset Formula 
\[
\nabla\cdot\mathbb{J}(t)=-\partial_{t}\varrho
\]

\end_inset

将电场
\begin_inset Formula $\sbf\mathbb{E}$
\end_inset

用标势
\begin_inset Formula $\Phi(t)$
\end_inset

表示 
\begin_inset Formula $\sbf\mathbb{E}(t)=-\nabla\Phi(t)$
\end_inset

，可得
\begin_inset Formula 
\[
-\nabla\cdot\epsilon\frac{\partial\nabla\Phi}{\partial t}-\nabla\cdot\sigma\nabla\Phi=-\partial_{t}\varrho.
\]

\end_inset

在时谐情况下，将各个物理量展开为傅立叶系数
\begin_inset Formula 
\[
\varrho=\rho\,e^{i\omega t},\quad\mathbb{E}=\sbf E\,e^{i\omega t},\quad\mathbb{J}(t)=\sbf J\,e^{i\omega t},\quad\Phi(t)=\phi\,e^{i\omega t}
\]

\end_inset

可以得到准静态方程
\begin_inset Formula 
\[
\nabla\cdot\sbf J=-i\omega\,\rho
\]

\end_inset


\begin_inset Formula 
\[
\sbf J=i\omega\epsilon\sbf E+\sigma\sbf E.
\]

\end_inset


\begin_inset Formula 
\[
-i\omega\,\nabla\cdot\epsilon\nabla\phi-\nabla\cdot\sigma\nabla\phi=-i\omega\,\rho.
\]

\end_inset

其中
\begin_inset Formula $\epsilon=\epsilon_{0}\epsilon_{r}$
\end_inset

。
\end_layout

\begin_layout Section
电流场方程的有限元求解
\end_layout

\begin_layout Standard
在为模型划分好有限元网格之后，标量势可以用节点电势和单元形函数表示为
\begin_inset Formula 
\[
\phi(x,y,z)=N_{i}^{e}(x,y,z)\phi_{i}
\]

\end_inset

利用 Galerkin 方法或者构建泛函积分的方法，可以得到
\begin_inset Formula 
\[
\left(\int_{\Omega}\nabla N_{i}^{e}\cdot\varepsilon\nabla N_{j}^{e}\dd{\Omega}\right)\frac{\partial\phi_{j}}{\partial t}+\left(\int_{\Omega}\nabla N_{i}^{e}\cdot\sigma\nabla N_{j}^{e}\dd{\Omega}\right)\phi_{j}=0
\]

\end_inset

定义系数矩阵
\begin_inset Formula 
\begin{align*}
 & M_{ij}^{e}=\int_{\Omega}\nabla N_{i}^{e}\cdot\varepsilon\nabla N_{j}^{e}\dd{\Omega},\\
 & K_{ij}^{e}=\int_{\Omega}\nabla N_{i}^{e}\cdot\sigma\nabla N_{j}^{e}\dd{\Omega}.
\end{align*}

\end_inset

得到相应的矩阵方程
\begin_inset Formula 
\[
M_{ij}^{e}\frac{\partial\phi_{j}}{\partial t}+K_{ij}^{e}\phi_{j}=0.
\]

\end_inset


\end_layout

\begin_layout Enumerate
对于稳态问题，方程中的第一项不存在；
\end_layout

\begin_layout Enumerate
对于时谐问题，利用 
\begin_inset Formula $\partial_{t}\phi=i\omega\phi$
\end_inset

，可以将上述方程转化为准静态问题进行求解；
\end_layout

\begin_layout Standard
对于瞬态问题，可以用隐式欧拉方法，将
\begin_inset Formula $\partial_{t}\phi$
\end_inset

进行离散处理
\begin_inset Formula 
\[
\frac{\partial\phi}{\partial t}=\frac{\phi_{j}^{t+\Delta t}-\phi_{j}^{t}}{\Delta t}.
\]

\end_inset

然后基于时间离散后的矩阵方程，对时间迭代，得到各个时刻网格节点上的势能
\begin_inset Formula $\phi$
\end_inset

，进而得到电流密度矢量的分布。
\begin_inset Formula 
\[
\left(\frac{M_{ij}^{e}}{\Delta t}+K_{ij}^{e}\right)\phi_{j}^{t+\Delta t}=M_{ij}^{e}\frac{\phi_{j}^{t}}{\Delta t}
\]

\end_inset


\begin_inset Formula 
\[
\phi_{j}^{t+\Delta t}=\phi_{j}^{t}+\phi_{jA}^{t+\Delta t}+\delta\phi_{j}^{t+\Delta t}
\]

\end_inset


\begin_inset Formula 
\[
\left(\frac{M_{ij}^{e}}{\Delta t}+K_{ij}^{e}\right)\left(\phi_{j}^{t}+\phi_{jA}^{t+\Delta t}+\delta\phi_{j}^{t+\Delta t}\right)=\frac{M_{ij}^{e}}{\Delta t}\phi_{j}^{t}
\]

\end_inset


\begin_inset Formula 
\[
\left(\frac{M_{ij}^{e}}{\Delta t}+K_{ij}^{e}\right)\delta\phi_{t}^{j+\Delta t}=-\left[\frac{M_{ij}^{e}}{\Delta t}\phi_{j,A}^{t+\Delta t}+K_{ij}^{e}\left(\phi_{j}^{t}+\phi_{jA}^{t+\Delta t}\right)\right]
\]

\end_inset


\end_layout

\begin_layout Standard
在获得各个节点的电势后，通过形函数插值，进而得到空间各处的电流密度矢量和电场的分布。另外空间各处的欧姆损耗功率密度也可以通过电流密度矢量和电场进行计算，其表达式
为
\begin_inset Formula 
\[
P=\sbf J\cdot\sbf E
\]

\end_inset

导体总的欧姆损耗可以通过对空间各处的欧姆损耗功率密度
\begin_inset Formula $P$
\end_inset

进行积分得到。
\end_layout

\begin_layout Chapter
静磁场
\end_layout

\begin_layout Section
磁场的基本理论
\end_layout

\begin_layout Standard
根据 
\begin_inset Formula $\sbf B$
\end_inset

 和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系 
\begin_inset Formula $\sbf B(\sbf H)$
\end_inset

，可以分线性材料，永磁体 和 非线性材料 三种来计算静磁场。
\end_layout

\begin_layout Standard
下面先以最简单的线性材料为例，用有限元方法来计算静磁场，之后再讨论永磁铁和更复杂的非线性情况。首先磁场强度矢量 
\begin_inset Formula $\sbf H$
\end_inset

 满足方程
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\sbf J\label{eq:xl3.1}
\end{equation}

\end_inset

在线性介质中，磁感应强度 
\begin_inset Formula $\sbf B$
\end_inset

 和 磁场强度 
\begin_inset Formula $\sbf H$
\end_inset

 之间的关系为：
\begin_inset Formula 
\[
\sbf H=\frac{1}{\mu_{0}\mu_{r}}\sbf B
\]

\end_inset

相对磁导率 
\begin_inset Formula $\mu_{r}$
\end_inset

 是不随磁场变化的常数（但可以随空间坐标变化）。由于 
\begin_inset Formula $\nabla\cdot\sbf B=0$
\end_inset

，因此磁感应强度可以用矢势 
\begin_inset Formula $\sbf A$
\end_inset

 表示为
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A
\]

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以得到 
\begin_inset Formula $\sbf A$
\end_inset

 满足的方程
\begin_inset Formula 
\begin{equation}
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J\label{eq:xl3.2}
\end{equation}

\end_inset


\end_layout

\begin_layout Theorem
\begin_inset Argument 1
status open

\begin_layout Plain Layout
毕奥–萨伐尔定律
\end_layout

\end_inset

ref:郭硕鸿 p77/91，若取 
\begin_inset Formula $\sbf A$
\end_inset

满足规范条件 
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

，得矢势
\begin_inset Formula $\sbf A$
\end_inset

的微分方程：
\begin_inset Formula 
\begin{equation}
\nabla^{2}\sbf A=-\mu\sbf J\label{eq:g3.1.8}
\end{equation}

\end_inset

矢势方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的特解： 
\begin_inset Formula 
\begin{equation}
\sbf A(\sbf x)=\frac{\mu}{4\pi}\int_{V}\frac{\sbf J(\sbf x')\dd{V'}}{r}\label{eq:g3.1.9}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\sbf x'$
\end_inset

 是源点，
\begin_inset Formula $\sbf x$
\end_inset

 是长点，
\begin_inset Formula $r$
\end_inset

 为由 
\begin_inset Formula $\sbf x'$
\end_inset

 到 
\begin_inset Formula $\sbf x$
\end_inset

的距离。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

 满足 
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

。取旋度可求出
\begin_inset Formula $\sbf B$
\end_inset

：
\begin_inset Formula 
\begin{align*}
\sbf B & =\nabla\times\sbf A=\frac{\mu}{4\pi}\nabla\times\int_{V}\frac{\sbf J(\sbf x')\dd{V}}{r}\\
 & =\frac{\mu}{4\pi}\int_{V}(\nabla\frac{1}{r})\times\sbf J(\sbf x')\dd{V'}\\
 & =\frac{\mu}{4\pi}\int_{V}\frac{\sbf J\times\sbf r}{r^{3}}\dd{V'}
\end{align*}

\end_inset

过渡到线电流情形，设
\begin_inset Formula $I$
\end_inset

 为导线上电流的大小，作代换 
\begin_inset Formula $\sbf J\dd{V'}\to I\dd{\sbf l}$
\end_inset

得
\begin_inset Formula 
\begin{equation}
\sbf B=\frac{\mu}{4\pi}\oint_{L}\frac{I\dd{\sbf l}\times\sbf r}{r^{3}}\label{eq:g3.1.11}
\end{equation}

\end_inset

这就是 毕奥–萨伐尔 定律。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
柱坐标下的旋度：
\begin_inset Formula 
\[
\nabla\times\sbf A=\left(\frac{1}{r}\partial_{\phi}A_{z}-\partial_{z}A_{\phi}\right)\sbf e_{r}+\left(\partial_{z}A_{r}-\partial_{r}A_{z}\right)\sbf e_{\phi}+\left[\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)-\frac{1}{r}\partial_{\phi}A_{r}\right]\sbf e_{z}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Subsection
磁矢势的泛函
\end_layout

\begin_layout Standard
与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J$
\end_inset

 对应的泛函积分为
\begin_inset Formula 
\begin{equation}
\mathcal{F}(\sbf A)=\int_{\Omega}\dd{\Omega}\left[\frac{1}{\mu_{r}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\left(\nabla\times\sbf A\right)-\mu_{0}\,\sbf J\cdot\sbf A\right]\label{eq:xl3.3}
\end{equation}

\end_inset

计算 
\begin_inset Formula $\mathcal{F}(\sbf A)$
\end_inset

 的变分得：
\begin_inset Formula 
\[
\mathcal{F}(\sbf A)=\int_{\Omega}\dd{\Omega}\left[\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\cdot\left(\nabla\times\delta\sbf A\right)-\mu_{0}\,\sbf J\cdot\delta\sbf A\right]
\]

\end_inset

根据公式 
\begin_inset Formula $\nabla\cdot(\sbf a\times\sbf b)=\sbf b\cdot(\nabla\times\sbf a)-\sbf a\cdot(\nabla\times\sbf b)$
\end_inset

， 并使用高斯定理可以得到
\begin_inset Formula 
\begin{align*}
\delta\mathcal{F}(\sbf A) & =\int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\dd{\Omega}+\int_{\Gamma}\sbf e_{n}\cdot\left[\delta\sbf A\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\right]\dd{\Gamma}\\
 & =\int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\dd{\Omega}-\int_{\Gamma}\delta\sbf A\cdot\left[\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\right]\dd{\Gamma}
\end{align*}

\end_inset


\end_layout

\begin_layout Itemize
第一项可以给出矢势 
\begin_inset Formula $\sbf A$
\end_inset

 满足的方程，即
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Itemize
第二项给出矢势
\begin_inset Formula $\sbf A$
\end_inset

的自然边界条件（磁感应线垂直）：
\begin_inset Formula 
\[
\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=0
\]

\end_inset


\end_layout

\begin_layout Itemize
计算的区域 
\begin_inset Formula $\Omega$
\end_inset

 划分有限单元后，
\begin_inset Formula $\mathcal{F}(\sbf A)$
\end_inset

 可以表示为
\begin_inset Formula 
\[
\mathcal{F}(\sbf A)=\sum_{e}\mathcal{F}^{e}(\sbf A)
\]

\end_inset

其中
\begin_inset Formula 
\begin{equation}
\mathcal{F}^{e}(\sbf A^{e})=\frac{1}{2}\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf A^{e}\right)\cdot\left(\nabla\times\sbf A^{e}\right)\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf A^{e}\dd{\Omega}\label{eq:xl3.5}
\end{equation}

\end_inset

对于磁场，二维，轴对称和 三维问题 所采用的单元略有不同。
\end_layout

\begin_layout Subsection
二维情况
\end_layout

\begin_layout Standard
电流是垂直二维平面流过的，
\begin_inset Formula $\sbf A$
\end_inset

 也只有垂直二维平面的分量。即 
\begin_inset Formula $\sbf J=J_{z}\sbf e_{z}$
\end_inset

，有限元中的矢势可以用形函数和节点上定义的 
\begin_inset Formula $A_{z,\alpha}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(x,y)=\sum_{\alpha=1}^{n_{e}}N_{\alpha}^{e}(x,y)\,A_{z,\alpha}\sbf e_{z}.
\]

\end_inset


\end_layout

\begin_layout Subsection
轴对称情况
\end_layout

\begin_layout Standard
然后是磁感应强度 
\begin_inset Formula $\sbf B$
\end_inset

 轴对称情况，从毕奥–萨伐尔定律
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.11"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\sbf B=\frac{\mu}{4\pi}\oint_{L}\frac{I\dd{\sbf l}\times\sbf r}{r^{3}}
\]

\end_inset

取对称轴为柱坐标系下的 
\begin_inset Formula $\sbf e_{z}$
\end_inset

 坐标轴，如果电流
\begin_inset Formula $I\dd{l}$
\end_inset

只沿着
\begin_inset Formula $\sbf e_{\phi}$
\end_inset

方向，则
\begin_inset Formula $\sbf B$
\end_inset

将没有 
\begin_inset Formula $\sbf e_{\phi}$
\end_inset

方向的分量，并且其他方向分量也不依赖于 
\begin_inset Formula $\phi$
\end_inset

 坐标。因此令电流 
\begin_inset Formula $\sbf J=J_{\varphi}\sbf e_{\varphi}$
\end_inset

，对应地由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula $\sbf A=A_{\varphi}\sbf e_{\varphi}$
\end_inset

。有限元中的矢势可以用形函数 和节点上定义的 
\begin_inset Formula $A_{\varphi,i}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(\rho,z)=\sum_{\alpha=1}^{n_{e}}N_{\alpha}^{e}(\rho,z)\,A_{\varphi,\alpha}\sbf e_{\varphi}
\]

\end_inset


\end_layout

\begin_layout Subsection
三维磁场
\end_layout

\begin_layout Standard
对于三维磁场问题，采用的是棱边单元，相应的形函数是矢量。有限元中的矢势可以用形函数和棱边上定义的 
\begin_inset Formula $A_{\alpha}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(x,y,z)=\sum_{\alpha=1}^{n_{e}}\sbf N_{\alpha}^{e}(x,y,z)\,A_{\alpha}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
有限元矩阵
\end_layout

\begin_layout Standard
对于任一种情况，单元内的矢量势均可以统一表示为一种形式，即
\begin_inset Formula 
\begin{equation}
\sbf A^{e}=\sum_{\alpha=1}^{n_{e}}\sbf N_{\alpha}^{e}A_{\alpha}\label{eq:xl3.6}
\end{equation}

\end_inset

例如二维情况下，
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(x,y)\sbf e_{z}$
\end_inset

，
\begin_inset Formula $A_{\alpha}=A_{z,\alpha}$
\end_inset

；轴对称情况下 
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(\rho,z)\sbf e_{\varphi}$
\end_inset

，
\begin_inset Formula $A_{\alpha}=A_{\varphi,\alpha}$
\end_inset

。然后将 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

，代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\[
\mathcal{F}^{e}(\sbf A^{e})=\frac{1}{2}\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}A_{\alpha}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}A_{\beta}\right)\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}A_{\alpha}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Standard
计算 
\begin_inset Formula $\mathcal{F}^{e}(\sbf A^{e})$
\end_inset

 对 
\begin_inset Formula $A_{\alpha}$
\end_inset

 的导数，并根据 
\begin_inset Formula $\delta\mathcal{F}(\sbf A)=0$
\end_inset

，可以得到
\begin_inset Formula $A_{i}$
\end_inset

所满足的矩阵方程
\begin_inset Formula 
\begin{equation}
\sum_{e=1}^{M}[K_{\alpha\beta}^{e}]\{A_{\beta}\}=\sum_{e=1}^{M}\{b_{\alpha}^{e}\}\label{eq:xl3.7}
\end{equation}

\end_inset

其中
\begin_inset Formula 
\begin{align}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}\right)\dd{\Omega}\label{eq:xl3.8}\\
b_{\alpha}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}\dd{\Omega}\label{eq:xl3.9}
\end{align}

\end_inset


\end_layout

\begin_layout Section
二维静磁场
\end_layout

\begin_layout Standard
二维静磁问题中的电流
\series bold
垂直流过
\series default
二维平面，
\begin_inset Formula $\sbf A$
\end_inset

只有垂直于二维平面的分量
\begin_inset Formula 
\begin{align*}
\sbf N_{\alpha}^{e} & =N_{\alpha}^{e}\left(x,y\right)\sbf e_{z},\\
\sbf J & =J_{z}\sbf e_{z},\\
\sbf A & =A_{z,\alpha}\,N_{\alpha}^{e}(x,y)\,\sbf e_{z}.
\end{align*}

\end_inset

其中 
\begin_inset Formula $\alpha$
\end_inset

 标记单元节点局部编号。将其代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以得到
\begin_inset Formula 
\begin{align*}
\nabla\times N_{\alpha}^{e}\sbf e_{z} & =\left[\begin{array}{ccc}
\sbf e_{x} & \sbf e_{y} & \sbf e_{z}\\
\partial_{x} & \partial_{y} & \partial_{z}\\
0 & 0 & N_{\alpha}
\end{array}\right]\\
 & =\sbf e_{x}\,\partial_{y}N_{\alpha}-\sbf e_{y}\,\partial_{x}N_{\alpha}\\
\text{即}\;\mathrm{curl}\sbf N_{\alpha} & =\left[\begin{array}{c}
\partial_{y}N_{\alpha}\\
-\partial_{x}N_{\alpha}
\end{array}\right]
\end{align*}

\end_inset


\begin_inset Formula 
\[
\nabla\times\nabla\times N_{\alpha}^{e}\sbf e_{z}=-(\partial_{xx}N_{\alpha}+\partial_{yy}N_{\alpha})\sbf e_{z}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
 & K_{\alpha\beta}^{e}=\frac{1}{\mu_{r}}\int_{\Omega^{e}}\left(\frac{\partial N_{\alpha}^{e}}{\partial x}\frac{\partial N_{\beta}^{e}}{\partial x}+\frac{\partial N_{\alpha}^{e}}{\partial y}\frac{\partial N_{\beta}^{e}}{\partial y}\right)\dd{\Omega}\\
 & b_{\alpha}^{e}=\mu_{0}\int_{\Omega^{e}}J_{z}N_{\alpha}^{e}\dd{\Omega}
\end{align*}

\end_inset

二维静磁场方程的形式和二维静电场方程的形式一样。
\end_layout

\begin_layout Standard
形函数的二阶旋度为
\begin_inset Formula 
\begin{align*}
\nabla\times\nabla\times N_{\alpha}^{e}(x,y)\sbf e_{z} & =\left[\begin{array}{ccc}
\sbf e_{x} & \sbf e_{y} & \sbf e_{z}\\
\partial_{x} & \partial_{y} & \partial_{z}\\
N_{\alpha,y} & -N_{\alpha,x} & 0
\end{array}\right]\\
 & =\left[N_{\alpha,xz},\;N_{\alpha,yz},\;N_{\alpha,yy}-N_{\alpha,xx}\right]\\
 & =\left[0,\;0,\;N_{\alpha,yy}-N_{\alpha,xx}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
二维磁场等Az线与B方向
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "磁力线到底是什么东西，为什么用等A线来描述？"
target "https://www.zhihu.com/question/325541042/answer/692043339"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\sbf B & =\nabla\times(A_{z}\sbf e_{z})\\
 & =\sbf e_{x}\,{\color{blue}\partial_{y}A_{z}}+\sbf e_{y}{\color{blue}(-\partial_{x}A_{z})}
\end{align*}

\end_inset


\begin_inset Formula $A_{z}$
\end_inset

的梯度方向是 
\begin_inset Formula $(\partial_{x}A_{z},\,\partial_{y}A_{z})$
\end_inset

，它的垂直方向是 
\begin_inset Formula $({\color{blue}\partial_{y}A_{z}},\,{\color{blue}-\partial_{x}A_{z}})$
\end_inset

 ；另一方面，梯度的垂直方向就是等值线方向；因此二维磁场 
\begin_inset Formula $\sbf B$
\end_inset

的方向就是 
\begin_inset Formula $A_{z}$
\end_inset

 的等值线方向，
\begin_inset Formula 
\[
\norm{\sbf B}=\sqrt{(\partial_{y}A_{z})^{2}+(\partial_{x}A_{z})^{2}}
\]

\end_inset

也就是梯度大小，因此，梯度越大的地方，
\begin_inset Formula $B$
\end_inset

越大，等值线越密集。
\end_layout

\begin_layout Section
轴对称静磁场
\end_layout

\begin_layout Standard
如果所研究的问题具有旋转对称性（对于
\begin_inset Formula $\sbf B$
\end_inset

来说），可以沿着对称轴取一个截面在柱坐标下求解相应的电磁方程，即 
\begin_inset Formula $r,z$
\end_inset

 平面。轴对称情况下，磁感应
\begin_inset Formula $\sbf B$
\end_inset

分布在
\begin_inset Formula $r,z$
\end_inset

平面，相应地，矢势
\begin_inset Formula $\sbf A$
\end_inset

只有柱坐标系的
\begin_inset Formula $A_{\phi}$
\end_inset

分量，相应的磁场可以用矢势表示为
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A=-\partial_{z}A_{\phi}\sbf e_{r}+{\color{red}0}\,\sbf e_{\phi}+\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)\sbf e_{z}
\]

\end_inset

如上所述，磁感应
\begin_inset Formula $\sbf B$
\end_inset

分布在
\begin_inset Formula $r,z$
\end_inset

平面。
\end_layout

\begin_layout Remark
柱坐标下的旋度表示
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf A=\left(r^{-1}\partial_{\phi}A_{z}-{\color{blue}\partial_{z}A_{\phi}}\right)\sbf e_{r}+\left(\partial_{z}A_{r}-\partial_{r}A_{z}\right)\sbf e_{\phi}+\left[{\color{blue}r^{-1}\partial_{r}\left(rA_{\phi}\right)}-r^{-1}\partial_{\phi}A_{r}\right]\sbf e_{z}\label{eq:curl-cylin}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
另外需要注意的是，虽然在截面上划分的单元和二维情况下的划分完全一样。但实际上处理的有限元单元并不是一个平面单元，而是平面单元沿对称轴旋转 
\begin_inset Formula $360$
\end_inset

 度所形成的圆环，如图 3.1所示。
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fem-axial-mesh-ele.png
	lyxscale 70
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
轴对称单元 
\begin_inset Formula $\leftrightarrow$
\end_inset

 网格剖分 的对应关系
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
在某个单元上的有限元泛函为（为了后续处理方便，
\begin_inset Formula $\mathcal{F}^{e}$
\end_inset

的表达式右边乘了系数
\begin_inset Formula $1/2\pi$
\end_inset

）
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\sbf A^{e}\right)=\frac{1}{2\pi}\int_{\Omega^{e}}\left[\frac{1}{2}\frac{1}{\mu_{r}}\left(\nabla\times\sbf A^{e}\right)\cdot\left(\nabla\times\sbf A^{e}\right)-\mu_{0}\,\sbf J\cdot\sbf A^{e}\right]\dd{\Omega}
\]

\end_inset

其中
\begin_inset Formula $\dd{\Omega}=r\dd{r}\dd{z}\dd{\phi}$
\end_inset

，关于 
\begin_inset Formula $\phi$
\end_inset

 的积分给出
\begin_inset Formula $2\pi$
\end_inset

因子，与前面的系数
\begin_inset Formula $1/2\pi$
\end_inset

 互相抵消。代入
\begin_inset Formula $\sbf A^{e}=N_{i}^{e}A_{i}\sbf e_{\phi}$
\end_inset

，电流 
\begin_inset Formula $\sbf J=J_{\phi}\sbf e_{\phi}$
\end_inset

，
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\sbf A^{e}\right)=\sum_{i,j}^{n_{e}}\int_{\Omega^{e}}\dd{r}\dd{z}\left[\frac{1}{2}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}A_{\alpha}\right)\cdot\left(\nabla\times\sbf N_{\beta}^{e}A_{\beta}\right)-\mu_{0}\,\sbf J\cdot\sbf N_{\beta}^{e}A_{\beta}\right]
\]

\end_inset

轴对称情况下，形函数 
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(r,z)\sbf e_{\phi}$
\end_inset

，计算可以得到
\begin_inset Formula 
\begin{align*}
\nabla\times\sbf N_{\alpha}^{e} & =-\partial_{z}N_{\alpha}^{e}\sbf e_{r}+{\color{blue}\frac{1}{r}\partial_{r}(rN_{\alpha}^{e})}\,\sbf e_{z}\\
 & =-\partial_{z}N_{\alpha}^{e}\sbf e_{r}+{\color{blue}\left[r^{-1}N_{\alpha}^{e}+\partial_{r}N_{\alpha}^{e}\right]}\,\sbf e_{z}
\end{align*}

\end_inset

相应的 
\begin_inset Formula $K_{ij}^{e}$
\end_inset

 矩阵和列向量 
\begin_inset Formula $b_{i}^{e}$
\end_inset

 可以分别表示为
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{e} & =\int_{\Gamma^{e}}\frac{r}{\mu_{r}}\left[(\partial_{z}N_{\alpha}^{e})\,(\partial_{z}N_{\beta}^{e})+\left(\frac{N_{\alpha}^{e}}{r}+\partial_{r}N_{\alpha}^{e}\right)\left(\frac{N_{\beta}^{e}}{r}+\partial_{r}N_{\beta}^{e}\right)\right]\dd{r}\dd{z}\\
b_{\alpha}^{e} & ={\color{blue}\mu_{0}\,J_{\varphi}}\,\int_{\Gamma^{e}}N_{\alpha}^{e}\,r\,\dd{r}\dd{z}.
\end{align*}

\end_inset

柱坐标下的旋度见
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:curl-cylin"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Itemize
当
\begin_inset Formula $r\to0$
\end_inset

时，为了使
\begin_inset Formula $\frac{N_{\alpha}^{e}}{r}$
\end_inset

有限，需要
\begin_inset Formula $N_{\alpha}^{e}\to0$
\end_inset

，则 
\begin_inset Formula $\frac{N_{\alpha}^{e}}{r}\to\partial_{r}N_{\alpha}^{e}$
\end_inset

，也就是洛必达法则。
\end_layout

\begin_layout Itemize
sdf将
\begin_inset Formula $K_{\alpha\beta}^{e}$
\end_inset

展开形式（
\begin_inset Formula $11$
\end_inset

，
\begin_inset Formula $00$
\end_inset

，
\begin_inset Formula $10$
\end_inset

 terms）：
\begin_inset Formula 
\[
K_{\alpha\beta}^{e}=\int_{\Gamma^{e}}\frac{1}{\mu_{r}}\left({\color{blue}r\left[\partial_{r}N_{\alpha}^{e}\,\partial_{r}N_{\beta}^{e}+\partial_{z}N_{\alpha}^{e}\,\partial_{z}N_{\beta}^{e}\right]}+{\color{red}\frac{1}{r}\,N_{\alpha}^{e}N_{\beta}^{e}}+N_{\alpha}^{e}\,\partial_{r}N_{\beta}^{e}+N_{\beta}^{e}\,\partial_{r}N_{\alpha}^{e}\right)\dd{r}\dd{z}
\]

\end_inset


\end_layout

\begin_layout Subsection
整理:轴对称的Hessian
\end_layout

\begin_layout Standard
轴对称情况下，形函数 
\begin_inset Formula $\sbf N_{i}^{e}=N_{i}^{e}(r,z)\sbf e_{\phi}$
\end_inset

，一阶导数
\begin_inset Formula 
\begin{align*}
\nabla\times\sbf N_{\alpha}^{e} & =-\partial_{z}N_{\alpha}^{e}\sbf e_{r}+{\color{blue}\frac{1}{r}\partial_{r}(rN_{\alpha}^{e})}\,\sbf e_{z}\\
 & =-\partial_{z}N_{\alpha}^{e}\sbf e_{r}+{\color{blue}\left[\frac{1}{r}N_{\alpha}^{e}+\partial_{r}N_{\alpha}^{e}\right]}\,\sbf e_{z}
\end{align*}

\end_inset

这里的 
\begin_inset Formula $r,z$
\end_inset

 分别相当于 平面中的 
\begin_inset Formula $x,y$
\end_inset

。单元上的矩阵形式为（按照
\begin_inset Formula $r,z$
\end_inset

的次序写）
\begin_inset Formula 
\[
\left[\begin{array}{c}
-\partial_{z}N_{\alpha}^{e}\\
\partial_{r}N_{\alpha}^{e}
\end{array}\right]+\left[\begin{array}{c}
0\\
\frac{1}{r}N_{\alpha}^{e}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
柱坐标下的二阶导数
\begin_inset Formula 
\begin{align*}
\nabla\times\nabla\times\sbf A & =\frac{1}{r}\partial_{\phi}\left[\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)\right]\sbf e_{r}+\left[\partial_{z}(-\partial_{z}A_{\phi})-\partial_{r}\left(\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)\right)\right]\sbf e_{\phi}+\left[-\frac{1}{r}\partial_{\phi}\left(-\partial_{z}A_{\phi}\right)\right]\sbf e_{z}\\
 & =0+\left[-\partial_{zz}A_{\phi}{\color{blue}-\partial_{r}\left(\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)\right)}\right]\sbf e_{\phi}+0\\
 & =\left[{\color{blue}\frac{1}{r^{2}}A_{\phi}-\frac{1}{r}\partial_{r}A_{\phi}-\partial_{rr}A_{\phi}}-\partial_{zz}A_{\phi}\right]\sbf e_{\phi}
\end{align*}

\end_inset

其中考虑了，轴对称下 
\begin_inset Formula $\partial_{\phi}f=0$
\end_inset

。单元上的矩阵形式为（按照 
\begin_inset Formula $rz\times rz$
\end_inset

的次序写）
\begin_inset Formula 
\[
-\left[\begin{array}{cc}
\partial_{rr}N_{\alpha}^{e} & 0\\
0 & \partial_{zz}N_{\alpha}^{e}
\end{array}\right]+\frac{1}{r^{2}}N_{\alpha}^{e}+\left[\begin{array}{c}
-\frac{1}{r}\partial_{r}N_{\alpha}^{e}\\
0
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Section
三维磁场和树–余树规范
\end_layout

\begin_layout Standard
About the gauge conditions arising in Finite Element magnetostatic problems,
 Emmanuel Creuse, Patrick Dular, Serge Nicaise, page 6。
\begin_inset Newline newline
\end_inset

Discrete Vector Potentials for Nonsimply Connected Three-Dimensional Domains--Fr
ancesca Rapetti
\end_layout

\begin_layout Definition
\begin_inset Argument 1
status open

\begin_layout Plain Layout
tree–cotree
\end_layout

\end_inset

 三角化网格的 tree 
\begin_inset Formula $\tau$
\end_inset

 定义为：一组连通的edge，通过网格
\begin_inset Formula $\mathcal{T}_{h}$
\end_inset

的所有node，且不形成闭合回路。
\begin_inset Formula $\tau'=\mathcal{E}_{h}\backslash\tau$
\end_inset

称为 它的 associated co–tree。
\end_layout

\begin_layout Standard
三维情况下的形函数有三个分量，可以取
\begin_inset Formula 
\begin{align*}
\sbf N_{\alpha}^{e} & =\left(L_{\alpha_{1}}^{e}\nabla L_{\alpha_{2}}^{e}-L_{\alpha_{2}}^{e}\nabla L_{\alpha_{1}}^{e}\right)\ell_{\alpha}^{e}\\
\nabla\times\sbf N_{\alpha}^{e} & =2\left(\nabla L_{\alpha_{1}}^{e}\times\nabla L_{\alpha_{2}}^{e}\right)\ell_{\alpha}^{e}
\end{align*}

\end_inset

因此
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\left(\nabla\times\sbf N_{\beta}^{e}\right)\dd{\Omega}\\
b_{\alpha}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
由于采用棱边单元定义的矩阵 
\begin_inset Formula $[K_{\alpha\beta}^{e}]$
\end_inset

 是奇异矩阵，即 
\begin_inset Formula $\det[K_{\alpha\beta}^{e}]=0$
\end_inset

。因此矩阵方程 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\sum_{e=1}^{M}[K_{\alpha\beta}^{e}]\{A_{\beta}\}=\sum_{e=1}^{M}\{b_{\alpha}^{e}\}$
\end_inset

 有无穷多解。采用棱边单元定义的矢势
\begin_inset Formula $\sbf A$
\end_inset

 在每个单元内部都满足库仑规范 （
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

）。但是在单元的边界，库仑规范不满足，导致 矢势
\begin_inset Formula $\sbf A$
\end_inset

有无穷解。为了保证方程解的唯一性，即得到库仑规范下 
\begin_inset Formula $\sbf A$
\end_inset

的解，需要对 
\begin_inset Formula $\sbf A$
\end_inset

做一些约束。取一个不闭合的任意矢量场
\begin_inset Formula $\sbf w$
\end_inset

，使得
\begin_inset Formula 
\[
\sbf A\cdot\sbf w=0,
\]

\end_inset

可以证明，在条件
\begin_inset Formula $\sbf A\cdot\sbf w=0$
\end_inset

的约束下，方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J$
\end_inset

的解是唯一的，证明如下。
\end_layout

\begin_layout Standard
如果
\begin_inset Formula $\sbf A$
\end_inset

和
\begin_inset Formula $\sbf A+\delta\sbf A$
\end_inset

都为方程的解，那么
\begin_inset Formula 
\[
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\delta\sbf A\right)=0
\]

\end_inset

进而可以得到
\begin_inset Formula 
\[
\int_{\Omega}(\nabla\times\delta\sbf A)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}=0
\]

\end_inset

 由于1/
\begin_inset Formula $\mu_{r}$
\end_inset

是正定的，上面的方程可以给出
\begin_inset Formula $\nabla\times\delta\sbf A=0$
\end_inset

，可以设
\begin_inset Formula $\delta\sbf A=\nabla\chi$
\end_inset

。如果固定空间中的一点
\begin_inset Formula $P$
\end_inset

，然后取空间任一点作为
\begin_inset Formula $Q$
\end_inset

，那么总是可以找到连接
\begin_inset Formula $P$
\end_inset

和
\begin_inset Formula $Q$
\end_inset

的一条积分路线，使得
\begin_inset Formula 
\[
\chi(Q)=\chi(P)+\int_{P}^{Q}\nabla\chi\cdot\dd{\sbf\ell}
\]

\end_inset

因为
\begin_inset Formula $\delta\sbf A=\nabla\chi$
\end_inset

，并且 
\begin_inset Formula $\sbf A\cdot\sbf w=0$
\end_inset

 ，所以 
\begin_inset Formula $\nabla\chi\cdot\sbf w=0$
\end_inset

。取
\begin_inset Formula $\dd{\sbf\ell}$
\end_inset

平行
\begin_inset Formula $\sbf w$
\end_inset

，则
\begin_inset Formula $\chi(Q)=\chi(P)$
\end_inset

。因此取适当的
\begin_inset Formula $\sbf w$
\end_inset

 可以保证 
\begin_inset Formula $\delta\sbf A=\nabla\chi=0$
\end_inset

，即
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示矩阵方程的唯一性。
\end_layout

\begin_layout Standard
图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的二维模型中，树–余树规范（Tree–Cotree gauge）对矢势
\begin_inset Formula $\sbf A$
\end_inset

的约束情况。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/xl-f3.2.png
	scale 90

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
二维有限元 树–余树 示意图。绿色边单元上的矢势取
\begin_inset Formula $0$
\end_inset

。
\begin_inset CommandInset label
LatexCommand label
name "fig:xl3.2"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
永磁材料
\begin_inset CommandInset label
LatexCommand label
name "sec:yongci"

\end_inset


\end_layout

\begin_layout Standard
在永磁材料中存在不为零的磁化强度，
\begin_inset Formula $\sbf B$
\end_inset

 和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系可以写为
\begin_inset Formula 
\[
\sbf H=\frac{1}{\mu_{0}}\sbf B-\sbf M
\]

\end_inset

硬体磁体中的 
\begin_inset Formula $\sbf M$
\end_inset

 几乎不随外磁场变化，可以当作常矢量（vary on 
\begin_inset Formula $\sbf H$
\end_inset

）处理。如果考虑更一般的情况，可以认为磁化强度 
\begin_inset Formula $\sbf M$
\end_inset

随磁场线性变化，即
\begin_inset Formula 
\[
\sbf M=\sbf M_{0}+\chi\sbf H.
\]

\end_inset

其中，
\begin_inset Formula $\sbf M_{0}$
\end_inset

 是没有外场情况下，永磁材料中的磁化强度，是常矢量。这样可以得到
\begin_inset Formula 
\begin{align*}
\sbf H & =\frac{1}{\mu_{0}\mu_{r}}\sbf B-\frac{1}{\mu_{r}}\sbf M_{0}\\
\mu_{r} & =1+\chi
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
计算的区域
\begin_inset Formula $\Omega$
\end_inset

存在永磁区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

，可以得到静磁场方程：
\begin_inset Formula 
\begin{equation}
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J+\frac{\mu_{0}}{\mu_{r}}{\color{red}\nabla\times\sbf M_{0}}\label{eq:xl3.10}
\end{equation}

\end_inset

以及相应的泛函积分
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\sbf A\right)=\int_{\Omega}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\left(\sbf J+\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}\right)\cdot\sbf A\dd{\Omega}\label{eq:xl3.11}
\end{equation}

\end_inset

同样，
\begin_inset Formula $\mathcal{F}\left(\sbf A\right)$
\end_inset

可以表示为各个有限元单元中 
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的和
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\sbf A\right)=\sum_{e}\mathcal{F}^{e}\left(\sbf A\right)\label{eq:xl3.12}
\end{equation}

\end_inset

如果单元积分区域属于线性材料区，
\begin_inset Formula $\Omega_{e}\in\Omega_{0}$
\end_inset

，
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的表达式和之前相同；如果单元积分区域实在永磁铁区，即 
\begin_inset Formula $\Omega_{e}\in\Omega_{m}$
\end_inset

，则
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\label{eq:xl3.13}\\
 & -{\color{blue}\int_{\Omega_{e}}\frac{\mu_{0}}{\mu_{r}}\left(\nabla\times\sbf M_{0}\right)\cdot\sbf A\dd{\Omega}}{\color{red}-\frac{\mu_{0}}{\mu_{r}}\int_{\Gamma_{e}}\left(\sbf M_{0}\times\sbf e_{n}\right)\cdot\sbf A\dd{\Gamma}}\label{eq:xl3.14}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
在 
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的表达式中，
\begin_inset Formula $\Gamma_{e}$
\end_inset

 是单元的表面，最后一项是在单元表面的积分，
\begin_inset Formula $\sbf e_{n}$
\end_inset

是垂直表面的单位矢量。
\end_layout

\begin_layout Enumerate
表面积分出现的原因是将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

改写为
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.12"
plural "false"
caps "false"
noprefix "false"

\end_inset

之后必然出现的。式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

中 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 对积分的贡献，完全来自 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 在空间中的变化，即 
\begin_inset Formula $\nabla\times\sbf M_{0}$
\end_inset

。将积分的区域 
\begin_inset Formula $\Omega$
\end_inset

 划分有限元网格之后，在计算
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 时，如果不考虑各个单元的表面积分，那么相邻单元边界处的 
\begin_inset Formula $\nabla\times\sbf M_{0}$
\end_inset

 会被忽视，见下文注
\begin_inset CommandInset ref
LatexCommand eqref
reference "rem2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 是一个常矢量（on 空间坐标），那么相邻单元在公共边处的 
\begin_inset Formula $\hat{\sbf e}_{n}$
\end_inset

 符号刚好相反，可以互相抵消，最后只留下永磁体区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

 边界处 
\begin_inset Formula $\Gamma_{m}$
\end_inset

 的表面积分，这一项就是
\series bold
面电流密度
\series default
。
\end_layout

\begin_layout Standard
使用等式 
\begin_inset Formula $\left(\nabla\times\sbf M_{0}\right)\cdot\sbf A=\nabla\cdot\left(\sbf M_{0}\times\sbf A\right)+\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)$
\end_inset

，并用高斯定律可以得到
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\\
 & -{\color{brown}\frac{\mu_{0}}{\mu_{r}}\int_{\Gamma^{e}}\hat{\sbf e}_{n}\cdot\left(\sbf M_{0}\times\sbf A\right)\dd{\Gamma}}-\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)\dd{\Omega}\\
 & -{\color{brown}\frac{\mu_{0}}{\mu_{r}}\int_{\Gamma^{e}}\left(\sbf M_{0}\times\hat{\sbf e}_{n}\right)\cdot\sbf A\dd{\Gamma}}
\end{align*}

\end_inset

可以看到表面积分的部分相互抵消，最后只留下体积分，即
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\label{eq:xl3.15}\\
 & -{\color{blue}\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)\dd{\Omega}}\label{eq:xl3.16}
\end{align}

\end_inset

因此在永磁材料中，力向量会多出一项永磁体的贡献
\begin_inset Formula 
\[
b_{i}^{e}=\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}+{\color{blue}\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Remark
\begin_inset CommandInset label
LatexCommand label
name "rem2"

\end_inset

考虑一个沿着
\begin_inset Formula $z$
\end_inset

方向均匀极化的永磁体球 
\begin_inset Formula $\sbf M=M_{0}\sbf e_{z}$
\end_inset

，代入球坐标系下的旋度公式；
\begin_inset Formula 
\[
\nabla\times\sbf f=\frac{1}{r\sin\theta}\left[\partial_{\theta}(\sin\theta f_{\phi})-\partial_{\phi}f_{\theta}\right]\sbf e_{r}+\frac{1}{r}\left[\frac{1}{\sin\theta}\partial_{\phi}f_{r}-\partial_{r}(rf_{\phi})\right]\sbf e_{\theta}+\frac{1}{r}\left[\partial_{r}(rf_{\theta})-\partial_{\theta}f_{r}\right]\sbf e_{\phi}
\]

\end_inset

并考虑到
\begin_inset Formula $\sbf e_{z}=\cos\theta\sbf e_{r}-\sin\theta\sbf e_{\theta}$
\end_inset

，可得在永磁体内部的连续区域
\begin_inset Formula 
\begin{align*}
\nabla\times\sbf M & =M_{0}\frac{1}{r}\left[\partial_{r}(-r\sin\theta)-\partial_{\theta}\cos\theta\right]\sbf e_{\phi}\\
 & =\frac{M_{0}}{r}\left[-\sin\theta+\sin\theta\right]\sbf e_{\phi}=0
\end{align*}

\end_inset

此外在永磁体的边界上 
\begin_inset Formula $\sbf M\times\sbf e_{n}=\sin\theta\sbf e_{\phi}$
\end_inset

，此即表面电流的物理图像：
\series bold
均匀磁化的永磁体的磁场，可以看作是磁体表面环形电流产生的磁场的叠加
\series default
。
\end_layout

\begin_layout Enumerate
因此，在均匀磁化的永磁体内部，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.10"
plural "false"
caps "false"
noprefix "false"

\end_inset

微分方程中的中
\begin_inset Formula ${\color{red}\nabla\times\sbf M_{0}}$
\end_inset

项等于零，无法体现永磁体的贡献；在数学上，常数项
\begin_inset Formula $\sbf M_{0}$
\end_inset

对
\begin_inset Formula $\sbf B$
\end_inset

的微分没有影响。
\end_layout

\begin_layout Enumerate
而
\begin_inset Formula $\sbf M_{0}$
\end_inset

作为预先给定值，不是泛函的自由度，对于均匀磁化的永磁体
\begin_inset Formula ${\color{blue}\int_{\Omega_{e}}\frac{\mu_{0}}{\mu_{r}}\left(\nabla\times\sbf M_{0}\right)\cdot\sbf A\dd{\Omega}}=0$
\end_inset

，那么泛函仿佛回到不含永磁体的情况，这显然是不对的。
\end_layout

\begin_layout Enumerate
解决的办法是在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.14"
plural "false"
caps "false"
noprefix "false"

\end_inset

中包含
\begin_inset Formula ${\color{red}-\int_{\Gamma_{e}}\left(\sbf M_{0}\times\sbf e_{n}\right)\cdot\sbf A\dd{\Gamma}}$
\end_inset

项，以包含永磁体表面等效电流的贡献；在数学上，此项出现在矢势
\begin_inset Formula $\sbf A$
\end_inset

的方程中，也只有在积分场（原函数）的边界上，常数项
\begin_inset Formula $\sbf M_{0}$
\end_inset

的意义才会体现。此外，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.14"
plural "false"
caps "false"
noprefix "false"

\end_inset

中表面电流项的负号是因为它是激励，即有限元中的
\begin_inset Formula $\{b_{i}\}$
\end_inset

项，类似于
\begin_inset Formula $\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}$
\end_inset

前面也有负号。后面通过分部积分，表面项互相抵消，但这不是无意义的，因为通过新的项
\begin_inset Formula ${\color{blue}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)\dd{\Omega}}$
\end_inset

，表面电流的影响已经均匀的分摊到永磁体内部的每一区域上了，可以不用再考虑表面电流，所以最后的泛函
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.16"
plural "false"
caps "false"
noprefix "false"

\end_inset

中不再含有表面项。
\end_layout

\begin_layout Section
非线性材料
\end_layout

\begin_layout Standard
非线性材料中 
\begin_inset Formula $\sbf B$
\end_inset

和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系比较复杂，一般无法写出关于 
\begin_inset Formula $\sbf A$
\end_inset

 的显式方程，但可以通过逐步迭代逼近的方法将 
\begin_inset Formula $\sbf A$
\end_inset

 求解出来。介质中的静磁场方程最一般的表达式为：
\begin_inset Formula 
\begin{align*}
 & \sbf B=\sbf B\left(\sbf H\right)\\
 & \nabla\times\sbf H=\sbf J
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
如果可以先确定出 
\begin_inset Formula $\sbf B$
\end_inset

，那么根据 BH 曲线就可以确定出 
\begin_inset Formula $\sbf H$
\end_inset

，得到的 
\begin_inset Formula $\sbf H$
\end_inset

 应该满足方程 
\begin_inset Formula $\nabla\times\sbf H=\sbf J$
\end_inset

。可以首先取 
\begin_inset Formula $\sbf B^{0}$
\end_inset

 作为方程的试探解，根据 BH 曲线可以得到 
\begin_inset Formula $\sbf H^{0}=\sbf H(\sbf B^{0})$
\end_inset

。
\end_layout

\begin_layout Enumerate
若 
\begin_inset Formula $\sbf H^{0}$
\end_inset

满足方程 
\begin_inset Formula $\nabla\times\sbf H^{0}=\sbf J$
\end_inset

，那么取 
\begin_inset Formula $\sbf B^{0}$
\end_inset

和 
\begin_inset Formula $\sbf H^{0}$
\end_inset

 就应该是所求的解。
\end_layout

\begin_layout Enumerate
若 
\begin_inset Formula $\sbf H^{0}$
\end_inset

不满足方程 
\begin_inset Formula $\nabla\times\sbf H^{0}=\sbf J$
\end_inset

，说明目前的 
\begin_inset Formula $\sbf B^{0}$
\end_inset

 值不正确，需要对 
\begin_inset Formula $\sbf B^{0}$
\end_inset

做修正。修正后 
\begin_inset Formula $\sbf B=\sbf B^{0}+\delta\sbf B$
\end_inset

。相应的 
\begin_inset Formula $\sbf H=\sbf H^{0}+\delta\sbf H$
\end_inset

，其中
\begin_inset Formula 
\[
\delta\sbf H=\frac{\partial H}{\partial B}\delta B
\]

\end_inset


\end_layout

\begin_layout Standard
如果是各向异性的情况，式中的 
\begin_inset Formula $\partial H/\partial B$
\end_inset

 就是张量。修正后 
\begin_inset Formula $\sbf H$
\end_inset

 应该满足方程
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\nabla\times\left(\sbf H^{0}+\frac{\partial H}{\partial B}\delta\sbf B\right)=\sbf J\label{eq:xl3.17}
\end{equation}

\end_inset

方程中只有 
\begin_inset Formula $\delta B$
\end_inset

 是未知量。由于 
\begin_inset Formula $\sbf B=\nabla\times\sbf A$
\end_inset

，因此 
\begin_inset Formula $\delta\sbf B=\nabla\times\delta\sbf A$
\end_inset

，代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.17"
plural "false"
caps "false"
noprefix "false"

\end_inset

得到
\begin_inset Formula 
\[
\nabla\times\left(\sbf H^{0}+\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J
\]

\end_inset


\end_layout

\begin_layout Standard
施加相应的边界条件，就可以解出 
\begin_inset Formula $\delta\sbf A$
\end_inset

，进而得到 
\begin_inset Formula $\delta\sbf B$
\end_inset

和 
\begin_inset Formula $\delta\sbf H$
\end_inset

，最后得到修正的
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

。如果修正后的 
\begin_inset Formula $\sbf H$
\end_inset

 仍然不满足方程 
\begin_inset Formula $\nabla\times\sbf H=\sbf J$
\end_inset

，那么就把修正后的
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

作为初始值，重复上面的步骤，直到 
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

趋近方程的真实解。每一步迭代所求解的方程为：
\begin_inset Formula 
\begin{equation}
\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J-\nabla\times\sbf H^{0}\label{eq:xl3.18}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
首先采用泛函积分的 Ritz 法来构造有限元计算流程。根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以写出关于 
\begin_inset Formula $\delta\sbf A$
\end_inset

 的泛函
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\delta\sbf A\right)=\mu_{0}\int_{\Omega}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\left(\sbf J-\nabla\times\sbf H^{0}\right)\cdot\delta\sbf A\dd{\Omega}\label{eq:xl3.19}
\end{equation}

\end_inset

然后有
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\delta\sbf A\right)=\sum_{e}\mathcal{F}^{e}\left(\delta\sbf A\right),\label{eq:xl3.19b}
\end{equation}

\end_inset

在单个有限元单元中
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\delta\sbf A\right)= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.20}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\delta\sbf A\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\left(\nabla\times\sbf H^{0}\right)\cdot\delta\sbf A\dd{\Omega}\label{eq:xl3.21}\\
 & +\mu_{0}\int_{\Gamma^{e}}\left(\sbf H^{0}\times\hat{\sbf e}_{n}\right)\cdot\delta\sbf A\dd{\Gamma}\label{eq:xl3.22}
\end{align}

\end_inset

式中最后一项是单元表面的积分。这一项出现的原因和永磁体一样，都是因为将原来的积分区域
\begin_inset Formula $\Omega$
\end_inset

 划分成网格后，利用式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.19b"
plural "false"
caps "false"
noprefix "false"

\end_inset

计算 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)$
\end_inset

 造成的。经过类似的处理，去掉边界项给出
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\delta\sbf A\right)= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.23}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\delta\sbf A\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.24}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\delta\sbf A=\sbf N_{j}^{e}\delta A_{j}$
\end_inset

，代入 
\begin_inset Formula $\mathcal{F}^{e}\left(\delta\sbf A\right)$
\end_inset

 中，可以得到
\begin_inset Formula 
\begin{align*}
\frac{\partial\mathcal{F}}{\partial\delta\sbf A_{i}}= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\delta A_{j}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

由于 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)$
\end_inset

 满足极值条件 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)=0$
\end_inset

，最后可以得到矩阵方程
\begin_inset Formula 
\[
\left\{ \frac{\partial\mathcal{F}}{\partial\delta\sbf A_{i}}\right\} =\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ \delta A_{j}\right\} -\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} =\left\{ 0\right\} 
\]

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{ij}^{e} & =\mu_{0}\int_{\Omega^{e}}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\\
b_{i}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
对于线性材料，
\begin_inset Formula $\sbf H=\sbf B/(\mu_{0}\mu_{r})$
\end_inset

，
\begin_inset Formula $\partial H/\partial B=1/(\mu_{0}\mu_{r})$
\end_inset

；对于永磁体，
\begin_inset Formula $\sbf H=\frac{1}{\mu_{0}\mu_{r}}\sbf B-\frac{1}{\mu_{r}}\sbf M_{0}$
\end_inset

，
\begin_inset Formula $\partial H/\partial B=1/(\mu_{0}\mu_{r})$
\end_inset

。将积分的区域
\begin_inset Formula $\Omega$
\end_inset

根据材料类型分为线性材料区域 
\begin_inset Formula $\Omega_{0}$
\end_inset

，永磁体材料区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

 和非线性材料区域 
\begin_inset Formula $\Omega_{n}$
\end_inset

。则
\begin_inset Formula 
\[
K_{ij}^{e}=\begin{cases}
\frac{1}{\mu_{r}}\int_{\Omega^{e}}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega} & \Omega^{e}\in\Omega_{0}+\Omega_{m}\\
\mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega} & \Omega^{e}\in\Omega_{n}
\end{cases}
\]

\end_inset


\end_layout

\begin_layout Example
Ritz 方法
\end_layout

\begin_layout Standard
根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J-\nabla\times\sbf H^{0}
\]

\end_inset

采用 Galerkin 法也可以得到和 Ritz 法相同的结果。首先以 
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

 为加权函数计算相应的余数
\begin_inset Formula 
\begin{align*}
R_{i}^{e}= & \mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\left[\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)-\sbf J+\nabla\times\sbf H^{0}\right]\dd{\Omega}\\
 & +\mu_{0}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\left(\sbf H^{0}\times\hat{\sbf e}_{n}\right)\dd{\Gamma}
\end{align*}

\end_inset

边界积分来源于单元的“表面电流” 
\begin_inset Formula $\sbf H^{0}\times\hat{\sbf e}_{n}$
\end_inset

，经过分部积分可得：
\begin_inset Formula 
\begin{align*}
R_{i}^{e}= & \mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\delta\sbf A\right)\dd{\Omega}+\mu_{0}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\left[\hat{\sbf e}_{n}\times\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\right]\dd{\Gamma}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\sbf J\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

式中的边界积分中，相邻单元的贡献在边界上互相抵消，最后只留下 
\begin_inset Formula $\Omega$
\end_inset

 边界上的积分，
\begin_inset Formula $\Omega$
\end_inset

 边界上的约束条件可以抵消掉该边界积分的贡献，因此表面积分可以去掉。最后将 
\begin_inset Formula $\delta\sbf A=\sbf N_{j}^{e}\delta A_{j}$
\end_inset

代入上式，可以得到矩阵形式下 
\begin_inset Formula $R_{i}^{e}$
\end_inset

 的表达式：
\begin_inset Formula 
\[
R_{i}^{e}=K_{ij}^{e}\delta A_{j}-b_{i}^{e}
\]

\end_inset

并且
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left\{ R_{i}^{e}\right\} =\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ \delta\sbf A_{j}\right\} -\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} =\left\{ 0\right\} 
\]

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{ij}^{e} & =\mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\\
b_{i}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\sbf J\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

和Ritz法得到的结果完全相同。
\end_layout

\begin_layout Section
计算电感
\end_layout

\begin_layout Section
磁场的开域问题
\end_layout

\begin_layout Standard
由于很少有材料可以屏蔽磁场，所以磁场的问题几乎都是开域问题。和静电场类似，磁场的开域问题也可以采用截断法或者精度更高的渐近边界条件来处理。首先矢势可以表示为
\begin_inset Formula 
\[
\sbf A\left(\sbf r\right)=\frac{\mu_{0}}{4\pi}\int\dd[3]{r'}\frac{\sbf J\left(\sbf r'\right)+\nabla'\times\sbf M\left(\sbf r'\right)}{\abs{\sbf r-\sbf r'}}
\]

\end_inset

同样在远离源的地方
\begin_inset Formula 
\[
\frac{1}{\abs{\sbf r-\sbf r'}}=\frac{1}{\abs{\sbf r}}+\frac{\sbf r\cdot\sbf r'}{\abs{\sbf r}^{3}}+\cdots
\]

\end_inset

这样可以得到最低阶的近似表达式：
\begin_inset Formula 
\begin{equation}
\sbf A=\frac{\sbf a}{r^{n}}\label{eq:xl3.25}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\sbf a$
\end_inset

 是与
\begin_inset Formula $r$
\end_inset

无关的矢量。采用截断法处理边界处的矢势，即取 
\begin_inset Formula $\sbf A=0$
\end_inset

 或 
\begin_inset Formula $\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=0$
\end_inset

，计算精度分别为 
\begin_inset Formula $\mathcal{O}\left(r^{-n}\right)$
\end_inset

和 
\begin_inset Formula $\mathcal{O}\left(r^{-n-1}\right)$
\end_inset

。根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.25"
plural "false"
caps "false"
noprefix "false"

\end_inset

得到
\begin_inset Formula $\sbf A$
\end_inset

满足的渐近边界条件：
\begin_inset Formula 
\[
\nabla\times\sbf A=\frac{-n}{r^{2}}\sbf r\times\sbf A
\]

\end_inset


\end_layout

\begin_layout Section
线性材料的开域问题
\end_layout

\begin_layout Standard
对于线性材料，在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的关于
\begin_inset Formula $\sbf A$
\end_inset

 的泛函积分中添加表面项的贡献，即
\begin_inset Formula 
\begin{align}
\mathcal{F}(\sbf A) & =\frac{1}{2}\int_{\Omega}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\sbf J\cdot\sbf A\dd{\Omega}\nonumber \\
 & +\int_{\Gamma}\frac{n}{2r^{3}}\left(\sbf r\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)\dd{\Gamma}\label{eq:xl3.25b}
\end{align}

\end_inset

对上式做变分可以得到：
\begin_inset Formula 
\begin{align*}
\delta\mathcal{F}(\sbf A)= & \int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\\
 & -\int_{\Gamma}\left[\hat{\sbf e}_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)+\frac{n}{r^{3}}\sbf r\times\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)\right]\cdot\delta\sbf A\dd{\Gamma}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Plain Layout
推导过程使用了
\begin_inset Formula 
\begin{align*}
 & \nabla\cdot\left[\sbf f\times\sbf g\right]=\left(\nabla\times f\right)\cdot g-f\cdot\left(\nabla\times g\right)\\
 & \left(\nabla\times\delta\sbf A\right)\cdot\left(\nabla\times\sbf A\right)=\nabla\cdot\left[\delta\sbf A\times\left(\nabla\times\sbf A\right)\right]+\delta\sbf A\cdot\left(\nabla\times\nabla\times\sbf A\right)
\end{align*}

\end_inset

以及混合积在轮换下不变：
\begin_inset Formula 
\[
\sbf a\cdot\left(\sbf b\times\sbf c\right)=\sbf c\cdot\left(\sbf a\times\sbf b\right)
\]

\end_inset

还有高斯散度定理。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
可以看到上式第二项给出
\begin_inset Formula 
\[
\hat{\sbf e}_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\frac{-n}{r^{3}}\sbf r\times\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)
\]

\end_inset

在圆形边界，上式即为关于
\begin_inset Formula $\sbf A$
\end_inset

 的渐近边界条件，表面积分对矩阵方程的贡献为：
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left(\left[K_{\alpha\beta}^{e}\right]+\left[K_{\alpha\beta}^{s}\right]\right)\left\{ \sbf A_{\beta}\right\} =\sum_{e=1}^{M}\left\{ b_{\alpha}^{e}\right\} 
\]

\end_inset

其中（这个式子的形式实际上参考自
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.25b"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\[
K_{\alpha\beta}^{s}=\frac{n}{r^{3}}\int_{\Gamma}\left(\sbf r\times\sbf N_{\alpha}^{e}\right)\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf N_{\beta}^{e}\right)\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Subsection
二维情况
\end_layout

\begin_layout Standard
二维情况和电场的形式完全一样，二维形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

在边界上退化为一维形函数
\begin_inset Formula $N_{i}^{s}$
\end_inset

，即
\begin_inset Formula 
\[
K_{\alpha\beta}^{s}=\frac{n}{r}\int_{\Gamma}\frac{N_{\alpha}^{s}N_{\beta}^{s}}{\mu_{r}}\dd{\Gamma}
\]

\end_inset

这里的形式可以参考电场的结果：
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:el-open"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Subsection
轴对称
\end_layout

\begin_layout Standard
轴对称情况下，矢势在柱坐标下只有 
\begin_inset Formula $A_{\varphi}$
\end_inset

 分量，进而得到边单元对 
\begin_inset Formula $K$
\end_inset

 矩阵的贡献（这里和前面保持一致，前面乘上系数 
\begin_inset Formula $1/2\pi$
\end_inset

）
\begin_inset Formula 
\begin{equation}
K_{\alpha\beta}^{s}=\frac{1}{2\pi}\frac{n}{r}\int_{\Gamma}\frac{N_{\alpha}^{e}N_{\beta}^{e}}{\mu_{r}}\dd{\Gamma}\label{eq:xl3.26}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
上面的积分涉及 边界上单元面积的积分（
\series bold
圆台侧面积分
\series default
），边界元形状如图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(a)所示，其中的剖面见图 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/xl-3.3.png
	scale 60

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
边界单元(a)及剖面(b)。
\begin_inset CommandInset label
LatexCommand label
name "fig:xl3.3"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
图中的 
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 和 
\begin_inset Formula $(\rho_{2},z_{2})$
\end_inset

 是边单元剖面的两个端点。左图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(a)所示的边单元上下底面的周长分别是 
\begin_inset Formula $2\pi\rho_{1}$
\end_inset

，
\begin_inset Formula $2\pi\rho_{2}$
\end_inset

，边单元面积可以表示为 
\begin_inset Formula $(2\pi\rho_{1}+2\pi\rho_{2})L_{s}/2$
\end_inset

，其中 
\begin_inset Formula $L_{s}$
\end_inset

 为端点
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 和 
\begin_inset Formula $(\rho_{2},z_{2})$
\end_inset

 之间的长度。将点 
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 到 
\begin_inset Formula $(\rho,z_{2})$
\end_inset

 之间的长度记为 
\begin_inset Formula $\ell_{s}$
\end_inset

，那么
\begin_inset Formula $\rho$
\end_inset

可以用
\begin_inset Formula $\ell_{s}$
\end_inset

表示为
\begin_inset Formula 
\[
\rho=\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}
\]

\end_inset

因此
\begin_inset Formula 
\begin{align*}
\dd{\Gamma} & =\frac{1}{2}\left[2\pi\rho+2\pi\left(\rho+\dd{\rho}\right)\right]\dd{\ell_{s}}\\
 & =2\pi\rho\dd{\ell_{s}}+\order{\varepsilon^{2}}\\
 & =2\pi\left(\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}\right)\dd{\ell_{s}}
\end{align*}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.26"
plural "false"
caps "false"
noprefix "false"

\end_inset

的积分可以表示为
\begin_inset Formula 
\[
K_{\alpha\beta}^{s}=\frac{1}{2\pi}\int_{0}^{L_{s}}\frac{1}{r}\frac{N_{\alpha}^{e}N_{\beta}^{e}}{\mu_{r}}2\pi\left(\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}\right)\dd{\ell_{s}}
\]

\end_inset


\end_layout

\begin_layout Standard
由于
\begin_inset Formula $r$
\end_inset

在面单元内变换不大，可以提到积分外面，二维形函数 
\begin_inset Formula $N_{\alpha}^{e}$
\end_inset

 在边界上退化为一维形函数
\begin_inset Formula $N_{\alpha}^{s}$
\end_inset

。然后取 
\begin_inset Formula $\eta=\ell_{s}/L_{s}$
\end_inset

，可以得到
\begin_inset Formula 
\[
K_{\alpha\beta}^{s}=\frac{1}{r}\frac{1}{\mu_{r}}L_{s}\int_{0}^{1}N_{\alpha}^{e}N_{\beta}^{e}\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\eta\right]\dd{\eta}
\]

\end_inset

一维形函数等参的取值范围是从 
\begin_inset Formula $-1$
\end_inset

 到 
\begin_inset Formula $1$
\end_inset

，下面再做变量代换
\begin_inset Formula 
\[
\eta=\frac{\xi+1}{2}
\]

\end_inset

可以得到
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{s} & =\frac{n}{r}\frac{1}{\mu_{r}}\frac{L_{s}}{2}\int_{-1}^{+1}N_{\alpha}^{s}N_{\beta}^{s}\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\frac{\xi+1}{2}\right]\dd{\eta}\\
 & =\frac{n}{r}\frac{1}{\mu_{r}}\frac{L_{s}}{2}\sum_{\alpha}N_{\alpha}^{s}\left(\xi_{\alpha}\right)N_{\beta}^{s}\left(\xi_{\alpha}\right)\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\frac{\xi_{\alpha}+1}{2}\right]W\left(\xi_{\alpha}\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
三维情况
\end_layout

\begin_layout Standard
三维情况下的静磁问题采用的是棱边形函数，
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

是一个三维矢量，因此
\begin_inset Formula 
\begin{align*}
K_{ij}^{s} & =\frac{n}{r^{3}}\int_{\Gamma}{\color{blue}\left(\sbf r\times\sbf N_{i}^{e}\right)}\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf N_{j}^{e}\right)\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}{\color{blue}\varepsilon_{abc}\,\sbf r_{b}\,(\sbf N_{i}^{e})_{c}}\;\varepsilon_{afg}\,\sbf r_{f}\,(\sbf N_{j}^{e})_{g}\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\left(\delta_{bf}\delta_{cg}-\delta_{bg}\delta_{cf}\right)r_{b}\,r_{d}\;(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{g}\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\left[r_{b}r_{b}{\color{brown}(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{c}}-r_{b}r_{c}\;(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{b}\right]\dd{\Gamma}
\end{align*}

\end_inset

代入形函数表达式 
\begin_inset Formula $\sbf N_{i}^{e}=(L_{i_{1}}^{e}\nabla L_{i_{2}}^{e}-L_{i_{2}}^{e}\nabla L_{i_{1}}^{e})\ell_{i}^{e}$
\end_inset

得到：
\begin_inset Formula 
\begin{align*}
K_{ij}^{s}=\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\dd{\Gamma} & \Bigg[r_{b}r_{b}{\color{brown}\left(L_{i_{1}}^{e}\partial_{c}L_{i_{2}}^{e}-L_{i_{2}}^{e}\partial_{c}L_{i_{1}}^{e}\right)\ell_{i}^{e}\,\left(L_{j_{1}}^{e}\partial_{c}L_{j_{2}}^{e}-L_{j_{2}}^{e}\partial_{c}L_{j_{1}}^{e}\right)\ell_{j}^{e}}\\
 & -r_{b}r_{c}\left(L_{i_{1}}^{e}\partial_{c}L_{i_{2}}^{e}-L_{i_{2}}^{e}\partial_{c}L_{i_{1}}^{e}\right)\ell_{i}^{e}\,\left(L_{j_{1}}^{e}\partial_{b}L_{j_{2}}^{e}-L_{j_{2}}^{e}\partial_{b}L_{j_{1}}^{e}\right)\ell_{j}^{e}\Bigg]
\end{align*}

\end_inset

根据公式
\begin_inset Formula 
\[
\int_{\Gamma}L_{i}^{e}L_{j}^{e}\dd{\Gamma}=\frac{\Delta_{e}}{12}\Lambda_{i,j},\quad\Lambda_{i,j}=\begin{cases}
2 & i=j\\
1 & i\neq j
\end{cases}
\]

\end_inset

最后得到
\begin_inset Formula 
\begin{align*}
K_{ij}^{s}=\frac{n\ell_{i}^{e}\ell_{j}^{e}}{r^{3}\mu_{r}}\frac{\Delta_{e}}{12} & \Bigg[\Lambda_{i_{1},j_{1}}(\sbf r\times\nabla L_{i_{2}}^{e})\cdot(\sbf r\times\nabla L_{j_{2}}^{e})\\
 & -\Lambda_{i_{2},j_{1}}(\sbf r\times\nabla L_{i_{1}}^{e})\cdot(\sbf r\times\nabla L_{j_{2}}^{e})\\
 & -\Lambda_{i_{1},j_{2}}(\sbf r\times\nabla L_{i_{2}}^{e})\cdot(\sbf r\times\nabla L_{j_{1}}^{e})\\
 & +\Lambda_{i_{2},j_{2}}(\sbf r\times\nabla L_{i_{1}}^{e})\cdot(\sbf r\times\nabla L_{j_{1}}^{e})\Bigg]
\end{align*}

\end_inset


\end_layout

\begin_layout Section
非线性材料的开域问题
\end_layout

\begin_layout Standard
在前面已经得到非线性静磁问题的迭代求解的方程，设在第
\begin_inset Formula $k$
\end_inset

步迭代，失势
\begin_inset Formula $A$
\end_inset

的增量为
\begin_inset Formula $\Delta A_{j}^{k}$
\end_inset

，其满足方程
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}\Delta A_{j}^{k}}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} ,
\]

\end_inset

上述方程也可以写成
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ A_{j}^{k}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} +\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}A_{j}^{k-1}}\right\} .
\]

\end_inset


\end_layout

\begin_layout Standard
其中
\begin_inset Formula $A_{j}^{k}$
\end_inset

和
\begin_inset Formula $A_{j}^{k-1}$
\end_inset

分别为第
\begin_inset Formula $k$
\end_inset

步和第
\begin_inset Formula $k-1$
\end_inset

步得到的失势，
\begin_inset Formula $\Delta A_{j}^{k}=A_{j}^{k}-A_{j}^{k-1}$
\end_inset

。在计算第
\begin_inset Formula $k$
\end_inset

步的失势时，第
\begin_inset Formula $k-1$
\end_inset

 的失势
\begin_inset Formula $\left\{ A_{j}^{k-1}\right\} $
\end_inset

是已知的。在关于失势的矩阵方程中加上相应表面单元的贡献
\begin_inset Formula $\left[K_{ij}^{s}\right]$
\end_inset

，就可以在模型边界用渐近边界条件来模拟开域问题，因此非线性开域问题的矩阵方程可以写为：
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left([K_{ij}^{e}]+[K_{ij}^{s}]\right)\left\{ A_{j}^{k}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} +\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}A_{j}^{k-1}}\right\} ,
\]

\end_inset

或者
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left([K_{ij}^{e}]+[K_{ij}^{s}]\right)\left\{ {\color{blue}\Delta A_{j}^{k}}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} -\sum_{e=1}^{M}\left[K_{ij}^{s}\right]\left\{ A_{j}^{k-1}\right\} .
\]

\end_inset


\end_layout

\begin_layout Chapter
时谐磁场和暂态磁场
\end_layout

\begin_layout Section
低频磁场方程
\end_layout

\begin_layout Standard
随时间变化的电流产生的磁场也会随时间变化，根据法拉第定理，变化的磁场会产生电场。如果存在自由的电荷，电场会驱动电荷运动产生电流，进而影响到系统的总电流。磁场和电
场可以用标势和标势表示为
\begin_inset Formula 
\begin{align}
 & \sbf B=\nabla\times\sbf A\label{eq:xl4.1}\\
 & \sbf E=-\nabla\phi-\frac{\partial\sbf A}{\partial t}\label{eq:xl4.2}
\end{align}

\end_inset

 总电流
\begin_inset Formula $\sbf J_{\text{tot}}$
\end_inset

分为两部分，一个是外加电流
\begin_inset Formula $\sbf J(t)$
\end_inset

，另外一部分是电场诱导出的电流，即
\begin_inset Formula 
\[
\sbf J_{\text{tot}}=\sbf J_{\text{ex}}(t)+\sigma\sbf E
\]

\end_inset


\end_layout

\begin_layout Standard
电场和磁场满足麦克斯韦方程
\begin_inset Formula 
\[
\nabla\times\sbf H-\frac{\partial\sbf D}{\partial t}=\sbf J_{\text{ex}}(t)+\sigma\sbf E
\]

\end_inset

在低频情况下，
\color blue
可以忽略电位移矢量对时间的导数
\color inherit
，因此
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\sbf J_{\text{ex}}(t)+\sigma\sbf E\label{eq:xl4.3}
\end{equation}

\end_inset

 另外，电流要满足守恒方程
\begin_inset Formula $\nabla\cdot\sbf J_{\text{tot}}=0$
\end_inset

（忽略电荷累积
\begin_inset Formula $\partial\rho/\partial t$
\end_inset

），而外加电流总是满足守恒方程的，因此
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sigma\left(-\nabla\Phi-\frac{\partial\sbf A}{\partial t}\right)=0.\label{eq:xl4.4}
\end{equation}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

即为低频情况下，时谐磁场和瞬态磁场所满足的方程。
\end_layout

\begin_layout Remark
忽略电位移矢量（数量级估计）。
\begin_inset Formula 
\[
\nabla\times\sbf H={\color{blue}\epsilon_{0}\epsilon_{r}\frac{\partial}{\partial t}\sbf E}+{\color{brown}\sigma\sbf E}+\sbf J_{\text{ex}}(t)
\]

\end_inset

假设频率为
\begin_inset Formula $50\mathrm{Hz}$
\end_inset

，对于一般的良导体，例如铝，列出以下数据
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\epsilon_{r}\approx8.85*10^{-12}\mathrm{F/m}\\
 & \frac{\partial}{\partial t}\approx50\mathrm{Hz}\\
 & \sigma\approx3.5\times10^{7}\mathrm{S/m}
\end{align*}

\end_inset

所以 
\begin_inset Formula ${\color{blue}\epsilon_{0}\epsilon_{r}\frac{\partial}{\partial t}\sbf E}\approx10^{-10}$
\end_inset

，而 
\begin_inset Formula ${\color{brown}\sigma\sbf E}>10^{7}$
\end_inset

，两者相差
\begin_inset Formula $17$
\end_inset

个数量级以上，所以总是可以安全地忽略第一项。而第三项
\begin_inset Formula $\sbf J_{\text{ex}}(t)$
\end_inset

作为外加电流，其数量级不好一概而论，总是保留在式子中。顺带一提，
\series bold
良导体条件
\series default
为
\begin_inset Formula 
\[
\omega\ll\tau^{-1}=\sigma/\varepsilon\quad\text{或者}\quad\frac{\sigma}{\varepsilon\omega}\gg1.
\]

\end_inset

对于一般金属导体，
\begin_inset Formula $\tau$
\end_inset

的数量极为
\begin_inset Formula $10^{-17}\mathrm{s}$
\end_inset

。只要电磁波的频率不太高，一般金属导体都可以看做良导体。良导体内部没有净的自由电荷积聚，电荷只能分布于导体表面上。
\end_layout

\begin_layout Section
时谐磁场
\end_layout

\begin_layout Standard
低频近似下的 
\begin_inset Formula $\Phi-A$
\end_inset

方程是
\begin_inset Formula 
\begin{align*}
 & \nabla\cdot\sigma\left(-\nabla\Phi-\frac{\partial\sbf A}{\partial t}\right)=0.\\
 & \frac{1}{\mu_{r}}\nabla\times\nabla\times\sbf A=\mu_{0}\sbf J_{0}+\mu_{0}\sigma(-\nabla\phi-\frac{\partial\sbf A}{\partial t})
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
对于时谐磁场，可以做傅立叶展开，将外加电流写成
\begin_inset Formula $\sbf J(t)=\sbf J_{0}\cos(\omega t+\varphi)$
\end_inset

，其中
\begin_inset Formula $J_{0}$
\end_inset

表示仅外加电流。在求解式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

时，可以将电流和待求的电磁场表示为复数的形式（选定适当的初相位
\begin_inset Formula $\varphi$
\end_inset

），
\begin_inset Formula 
\begin{align*}
\sbf J_{\text{ex}}(t) & =\sbf J_{0}e^{-i(\omega t+\varphi)}\\
\sbf A & =\sbf A_{\omega}e^{-i\omega t}\\
\sbf\Phi & =\sbf\Phi_{\omega}e^{-i\omega t}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
考虑线性材料，取电流
\begin_inset Formula $\sbf J(t)$
\end_inset

，标势
\begin_inset Formula $\Phi$
\end_inset

和矢势
\begin_inset Formula $\sbf A$
\end_inset

的复数形式，将
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf E$
\end_inset

的表达式，即式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\begin{align}
 & \nabla\cdot\sigma\left(-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}\right)=0,\label{eq:hm1}\\
 & \nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A_{\omega}\right)=\mu_{0}\sbf J_{0;\text{ex}}e^{-i\varphi}+\mu_{0}\sigma\left(-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}\right)\label{eq:hm2}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
其中
\end_layout

\begin_layout Itemize
\begin_inset Formula $\sbf J_{\text{eddy}}(\sbf R,t)=-\sigma\,\partial_{t}\sbf A(\sbf R,t)$
\end_inset

 代表涡流项，
\begin_inset Formula $\sbf R$
\end_inset

表示 随体运动的坐标（拉格朗日描述）。
\end_layout

\begin_layout Itemize
如果对
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:hm2"
plural "false"
caps "false"
noprefix "false"

\end_inset

取散度，根据
\begin_inset Formula $\nabla\cdot\nabla\times\sbf f=0$
\end_inset

，可以得到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:hm1"
plural "false"
caps "false"
noprefix "false"

\end_inset

。因此可以写
\begin_inset Formula 
\[
-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}=\nabla\times\sbf T
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Itemize
方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:hm1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:hm2"
plural "false"
caps "false"
noprefix "false"

\end_inset

作整理
\begin_inset Formula 
\begin{align}
{\color{brown}-\nabla\cdot(\sigma\nabla\Phi_{\omega})}+{\color{red}i\omega\sigma\,\nabla\cdot\sbf A_{\omega}} & =0\label{eq:hm1b}\\
{\color{blue}\nabla\times\frac{1}{\mu_{r}}(\nabla\times\sbf A_{\omega})}{\color{brown}-i\mu_{0}\omega\sigma\sbf A_{\omega}}+{\color{red}\mu_{0}\sigma\nabla\Phi_{\omega}} & =\mu_{0}e^{-i\varphi}\,\sbf J_{0}\label{eq:hm2b}
\end{align}

\end_inset


\end_layout

\begin_layout Itemize
引入 
\begin_inset Formula $\Phi=\partial_{t}\Psi$
\end_inset

，即
\begin_inset Formula $\Phi_{\omega}=-i\omega\Psi_{\omega}$
\end_inset

，并在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:hm1b"
plural "false"
caps "false"
noprefix "false"

\end_inset

中乘上因子
\begin_inset Formula $\mu_{0}$
\end_inset

。此举为了拉近两方程数量级（改善矩阵性质），并使得
\begin_inset Formula $A-\phi$
\end_inset

耦合项对称
\begin_inset Formula 
\begin{align}
 & {\color{brown}i\omega\mu_{0}\nabla\cdot(\sigma\nabla\Psi_{\omega})}+{\color{red}i\omega\mu_{0}\sigma\,\nabla\cdot\sbf A_{\omega}}=0\label{eq:hm1c}\\
 & {\color{blue}\nabla\times\frac{1}{\mu_{r}}(\nabla\times\sbf A_{\omega})}{\color{brown}-i\mu_{0}\omega\sigma\,\sbf A_{\omega}}-{\color{red}i\omega\mu_{0}\sigma\,\nabla\Psi_{\omega}}=\mu_{0}e^{-i\varphi}\,\sbf J_{0}\label{eq:hm2c}
\end{align}

\end_inset


\end_layout

\begin_layout Itemize
在方程两边乘上测试函数；使用 IBP，写出双线性型和线性算符（Galerkin 变分形式）
\begin_inset Formula 
\begin{align}
 & {\color{brown}-(\nabla N_{\mu}^{e},\,i\omega\mu_{0}\sigma\nabla\Psi_{\omega})}-{\color{red}(i\omega\mu_{0}\sigma\,\nabla N_{\mu}^{e},\,\sbf A_{\omega})}=0\label{eq:hm1d}\\
 & {\color{blue}(\nabla\times\sbf N_{\alpha}^{e},\,\frac{1}{\mu_{r}}\nabla\times\sbf A_{\omega})}{\color{brown}-(\sbf N_{\alpha}^{e},\,i\omega\mu_{0}\sigma\,\sbf A_{\omega})}-{\color{red}(\sbf N_{\alpha}^{e},\,i\omega\mu_{0}\sigma\nabla\Psi_{\omega})}=(\sbf N_{\alpha}^{e},\,\mu_{0}e^{-i\varphi}\,\sbf J_{0})\label{eq:hm2d}
\end{align}

\end_inset

为便于阅读，上面用指标
\begin_inset Formula $\alpha$
\end_inset

，
\begin_inset Formula $\beta$
\end_inset

表示
\begin_inset Formula $\sbf A_{w}$
\end_inset

的自由度，用
\begin_inset Formula $\mu,\nu$
\end_inset

表示
\begin_inset Formula $\Psi_{w}$
\end_inset

的自由度；
\end_layout

\begin_layout Itemize
将 矢势和标势 分别按照 Edge 和 Node 形函数展开
\begin_inset Formula 
\begin{align*}
\sbf A_{\omega} & =\sbf N_{\alpha}^{e}\,A_{\alpha}\\
\Psi_{\omega} & =N_{\mu}^{e}\,\Psi_{\mu}
\end{align*}

\end_inset

从弱形式可以得到矩阵方程
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{e}A_{\beta}+{\color{red}C_{\alpha\mu}\Phi_{\mu}} & =b_{\alpha}^{e}\\
{\color{brown}D_{\mu\nu}^{e}\phi_{\nu}}+{\color{red}C_{\mu\alpha}A_{\alpha}} & =b_{\mu}^{e}
\end{align*}

\end_inset

 其中
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\left[{\color{blue}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}\right)}{\color{brown}-i\omega\mu_{0}\,\sbf N_{\alpha}^{e}\cdot\sigma\sbf N_{\beta}^{e}}\right]\dd{\Omega}\\
b_{\alpha}^{e} & =\mu_{0}e^{-i\varphi}\int_{\Omega^{e}}\sbf N_{\alpha}^{e}\cdot\sbf J_{0}\dd{\Omega}\\
{\color{red}C_{\alpha\mu}^{e}=C_{\mu\alpha}^{e}} & =-i\omega\mu_{0}\int_{\Omega^{e}}\sbf N_{\alpha}^{e}\cdot\sigma\nabla N_{\mu}^{e}\,\dd{\Omega}\\
{\color{brown}D_{\mu\nu}^{e}} & =-i\omega\mu_{0}\int_{\Omega^{e}}(\nabla N_{\mu}^{e})\cdot\sigma(\nabla N_{\nu}^{e})\dd{\Omega}
\end{align*}

\end_inset

写成分块的矩阵方程
\begin_inset Formula 
\begin{equation}
\left[\begin{array}{cc}
{\color{brown}D_{\mu\nu}^{e}} & {\color{red}C_{\mu\beta}^{e}}\\
{\color{red}C_{\alpha\nu}^{e}} & K_{\alpha\beta}^{e}
\end{array}\right]\left\{ \begin{array}{c}
\Phi_{\nu}\\
A_{\beta}
\end{array}\right\} =\left\{ \begin{array}{c}
0\\
b_{\alpha}^{e}
\end{array}\right\} .\label{eq:harmonic}
\end{equation}

\end_inset


\end_layout

\begin_layout Itemize
推导弱形式时，要求边界条件 
\begin_inset Formula $\sbf n\cdot\sbf A_{\omega}=0$
\end_inset

，即磁力线平行。
\begin_inset Formula 
\[
(N_{\mu}^{e},\,\nabla\cdot\sbf A_{\omega})=\int_{\Gamma}\sbf n\cdot\sbf A_{\omega}\,N_{\mu}^{e}\dd{\Gamma}-(\nabla N_{\mu}^{e},\,\sbf A_{\omega})
\]

\end_inset


\end_layout

\begin_layout Itemize
Solver 中使用的 时间因子 是
\begin_inset Formula $e^{i\omega t}$
\end_inset

，因此上面 
\begin_inset Formula $K_{\alpha\beta}^{e}$
\end_inset

第二项，
\begin_inset Formula ${\color{red}C_{\alpha\mu}^{e}}$
\end_inset

，
\begin_inset Formula ${\color{brown}D_{\mu\nu}^{e}}$
\end_inset

中的 
\begin_inset Formula $-i\omega\mu_{0}$
\end_inset

均变成
\begin_inset Formula $i\omega\mu_{0}$
\end_inset

。
\end_layout

\begin_layout Itemize
Solver 中把 
\begin_inset Formula $K_{\alpha\beta}^{e}$
\end_inset

第二项，
\begin_inset Formula ${\color{red}C_{\alpha\mu}^{e}}$
\end_inset

，
\begin_inset Formula ${\color{brown}D_{\mu\nu}^{e}}$
\end_inset

 归入 ElementMatrixMe 项，有耦合时才计算。
\end_layout

\begin_layout Section
时谐磁场二维
\end_layout

\begin_layout Standard
将二维磁场的表示
\begin_inset Formula 
\begin{align*}
\sbf N_{\alpha}^{e} & =N_{\alpha}^{e}\left(x,y\right)\sbf e_{z},\\
\sbf J & =J_{z}\sbf e_{z},\\
\sbf A & =A_{z,\alpha}\,N_{\alpha}^{e}(x,y)\,\sbf e_{z}.
\end{align*}

\end_inset

代入时谐场方程（这里的
\begin_inset Formula $J_{0}$
\end_inset

表示外加电流）
\begin_inset Formula 
\begin{align*}
 & \nabla\cdot\sigma\left(-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}\right)=0,\\
 & \nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A_{\omega}\right)=\mu_{0}\sbf J_{0;\text{ex}}e^{-i\varphi}+\mu_{0}\sigma\left(-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}\right)
\end{align*}

\end_inset

得到
\begin_inset Formula 
\begin{align*}
 & -\sigma_{x}\partial_{xx}\phi_{\omega;x}-\sigma_{y}\partial_{yy}\phi_{\omega;y}=0\\
 & -\frac{1}{\mu_{r}}(\partial_{xx}N_{\alpha}+\partial_{yy}N_{\alpha})\sbf e_{z}=\mu_{0}e^{-i\varphi}\,J_{0;z}+i\mu_{0}\sigma\omega\,A_{\omega;z}
\end{align*}

\end_inset

其中考虑了 
\begin_inset Formula $\partial_{z}A_{\omega;z}=0$
\end_inset

，
\begin_inset Formula $\partial_{z}\Phi_{\omega;z}=0$
\end_inset

，因此 
\begin_inset Formula $A_{\omega},\Phi_{\omega}$
\end_inset

 解耦。因为要想影响
\begin_inset Formula $x,y$
\end_inset

上的电场
\begin_inset Formula $\sbf E$
\end_inset

，需要有
\begin_inset Formula $z$
\end_inset

方向的
\begin_inset Formula $\sbf B$
\end_inset

；但是2D分析只有
\begin_inset Formula $x,y$
\end_inset

上的
\begin_inset Formula $\sbf B$
\end_inset

，因此
\begin_inset Formula $\sbf E,\sbf B$
\end_inset

解耦。
\end_layout

\begin_layout Section
瞬态磁场
\begin_inset CommandInset label
LatexCommand label
name "sec:xl4.4"

\end_inset


\end_layout

\begin_layout Standard
如果将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

直接代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\begin{align*}
\nabla\cdot\sigma\left(\nabla\phi+\partial_{t}\sbf A\right)= & 0\\
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)= & -\mu_{0}\sigma\,\partial_{t}\sbf A+\frac{\mu_{0}}{\mu_{r}}\nabla\times\sbf M_{0}+\mu_{0}\sbf J_{\text{0}}-\mu_{0}\sigma\,\nabla\phi
\end{align*}

\end_inset

取 
\begin_inset Formula $\phi=\partial_{t}\Phi$
\end_inset

 可以得到
\begin_inset Formula 
\begin{align}
 & \nabla\cdot\sigma\,\partial_{t}\left(\nabla\Phi+\sbf A\right)=0,\quad\sbf E=-\partial_{t}\left(\nabla\Phi+\sbf A\right)\label{eq:my18}\\
 & \nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\frac{1}{\mu_{r}}\nabla\times(\mu_{0}\sbf M_{0})+\mu_{0}\sbf J_{\text{ex}}-\sigma\mu_{0}\,\partial_{t}\left(\nabla\Phi+\sbf A\right)\label{eq:my19}
\end{align}

\end_inset

其中
\begin_inset Formula $\sbf M_{0}$
\end_inset

为零外加磁场下，永磁材料中的磁化强度；
\begin_inset Formula $\sbf J_{\text{0}}$
\end_inset

是外加电流。
\end_layout

\begin_layout Remark
这里使用了电磁场方程和永磁体的本构关系，即 
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A,\quad\sbf E=-\nabla\phi-\frac{\partial\sbf A}{\partial t}
\]

\end_inset

以及
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf H=\sbf J_{\text{ex}}+\sigma\sbf E\\
 & \sbf B=\mu_{0}\mu_{r}\sbf H+\mu_{0}\sbf M_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
以
\begin_inset Formula $\sbf N_{i}$
\end_inset

作为权函数，计算
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my19"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的加权残差得
\begin_inset Formula 
\begin{align}
R^{e}(\sbf N_{\alpha}^{e}) & =\int_{\Omega^{e}}\sbf N_{\alpha}^{e}\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right){\color{red}-\frac{\mu_{0}}{\mu_{r}}\nabla\times\sbf M_{0}}-\sbf J_{\text{ex}}+\mu_{0}\sigma\frac{\partial}{\partial t}\left(\nabla\Phi+\sbf A\right)\right]\dd{\Omega}\nonumber \\
 & \quad+{\color{red}\int_{\Gamma^{e}}\sbf N_{\alpha}^{e}\cdot\frac{\mu_{0}}{\mu_{r}}\left(\sbf e_{n}\times\sbf M_{0}\right)\dd{\Gamma}}\nonumber \\
 & \stackrel{\text{IBP}}{=}\int_{\Omega^{e}}\Big[{\color{blue}(\nabla\times\sbf N_{\alpha}^{e})\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)}-\mu_{0}\sbf N_{\alpha}^{e}\cdot\sbf J_{\text{ex}}\label{eq:my20}\\
 & \quad-\frac{\mu_{0}}{\mu_{r}}\sbf M_{0}\cdot(\nabla\times\sbf N_{\alpha}^{e})+{\color{brown}\sbf N_{\alpha}^{e}\cdot\mu_{0}\sigma\frac{\partial}{\partial t}\nabla\Phi}+{\color{magenta}\sbf N_{\alpha}^{e}\cdot\mu_{0}\sigma\frac{\partial}{\partial t}\sbf A}\Big]\dd{\Omega}\nonumber 
\end{align}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Itemize
在推导
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my20"
plural "false"
caps "false"
noprefix "false"

\end_inset

时使用了公式
\begin_inset Formula 
\begin{align*}
\nabla\cdot\left(\sbf M_{0}\times\sbf N_{\alpha}^{e}\right) & ={\color{red}\left(\nabla\times\sbf M_{0}\right)\cdot\sbf N_{\alpha}^{e}}-\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\sbf M_{0}\\
\text{and}\;\int_{\Omega^{e}}\dd{\Omega}\nabla\cdot\left(\sbf M_{0}\times\sbf N_{\alpha}^{e}\right) & =\int_{\Gamma^{e}}\sbf e_{n}\cdot\left(\sbf M_{0}\times\sbf N_{\alpha}^{e}\right)\dd{\Gamma}={\color{red}\int_{\Gamma^{e}}\sbf N_{\alpha}^{e}\cdot\left(\sbf e_{n}\times\sbf M_{0}\right)\dd{\Gamma}}
\end{align*}

\end_inset

并添加了
\begin_inset Formula ${\color{red}\int_{\Gamma^{e}}\cdots\dd{\Gamma}}$
\end_inset

用来抵消边界上的面积分项，参见
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:yongci"
plural "false"
caps "false"
noprefix "false"

\end_inset

那里的说明。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
类似地，以
\begin_inset Formula $L_{\mu}^{e}$
\end_inset

作为权函数，计算
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my18"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的加权残差得
\begin_inset Formula 
\begin{align}
R^{e}(L_{\mu}^{e}) & =-\int_{\Omega^{e}}\left[L_{\mu}^{e}\nabla\cdot\sigma\,\partial_{t}(\nabla\Phi+\sbf A)\right]\dd{\Omega}+\int_{\Gamma^{e}}\left[L_{\mu}^{e}\sbf e_{n}\cdot\sigma\,\partial_{t}(\nabla\Phi+\sbf A)\right]\dd{\Gamma}\label{eq:my21}\\
 & \stackrel{\text{IBP}}{=}\int_{\Omega^{e}}\Big[{\color{red}\nabla L_{\mu}^{e}\cdot\sigma\,\partial_{t}\nabla\Phi}+{\color{brown}\nabla L_{\mu}^{e}\cdot\sigma\,\partial_{t}\sbf A}\Big]\dd{\Omega}\nonumber 
\end{align}

\end_inset

在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my21"
plural "false"
caps "false"
noprefix "false"

\end_inset

中我们手动添加了 
\begin_inset Formula $\int_{\Gamma^{e}}\sbf e_{n}\cdot\cdots\dd{\Gamma}$
\end_inset

 ，它抵消掉了边界项。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my21"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的两项用
\begin_inset Formula $\rho$
\end_inset

，
\begin_inset Formula $\sbf J=\sigma\sbf E$
\end_inset

 表示
\begin_inset Formula 
\[
R^{e}(L_{\mu}^{e})=\int_{\Omega^{e}}L_{\mu}^{e}\,\partial_{t}\rho\dd{\Omega}+\int_{\Gamma^{e}}L_{\mu}^{e}\left(-\sbf e_{n}\cdot\sbf J\right)\dd{\Gamma}
\]

\end_inset

第一项是求解域内部电荷堆积速率；第二项是经由求解域表面灌入电荷的速率，对于稳恒电流
\begin_inset Formula $\sbf J$
\end_inset

，第二项为零。
\end_layout

\begin_layout Section
矢量场的第三类边界条件
\end_layout

\begin_layout Standard
使用第一矢量格林定理
\begin_inset Formula 
\[
\int_{V}\left[{\color{blue}(\nabla\times\sbf a)}\cdot{\color{brown}(\nabla\times\sbf b)}-{\color{blue}\sbf a}\cdot(\nabla\times{\color{brown}\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,({\color{blue}\sbf a}\times{\color{brown}\nabla\times\sbf b})\cdot\sbf n\dd{S}
\]

\end_inset

矢量场刚度项 
\begin_inset Formula $(\nabla\times\sbf A)\cdot(\nabla\times\sbf A)$
\end_inset

的IBP为
\begin_inset Formula 
\[
\int_{V}{\color{blue}(\nabla\times\sbf N_{\alpha})}\cdot{\color{brown}(\nabla\times\sbf A)}-\oint_{S}\sbf n\cdot({\color{blue}\sbf N_{\alpha}}\times{\color{brown}\nabla\times\sbf A})=\int_{V}{\color{blue}\sbf N_{\alpha}}\cdot(\nabla\times{\color{brown}\nabla\times\sbf A})
\]

\end_inset

因此边界项形如（重新安排混合积，边界项和刚阵项同符号）
\begin_inset Formula 
\[
\frac{1}{\mu_{r}}\oint_{S}\sbf N_{\alpha}\cdot(\sbf n\times\sbf B)\dd{\Gamma}
\]

\end_inset


\series bold
若约定矢量场的3rd边界条件为
\series default

\begin_inset Formula 
\[
\frac{1}{\mu_{0}\mu_{r}}(\sbf n\times\sbf B)=\gamma\sbf A-\sbf q
\]

\end_inset

则对应的 刚度矩阵
\begin_inset Formula $A$
\end_inset

和激励
\begin_inset Formula $b$
\end_inset

的修正项为
\begin_inset Formula 
\[
\mu_{0}\gamma\,\sbf N_{\alpha}^{e}\cdot\sbf N_{\beta}^{e},\quad\mu_{0}\,\sbf N_{\alpha}^{e}\cdot\sbf q
\]

\end_inset


\end_layout

\begin_layout Section
FEM离散和时间迭代
\end_layout

\begin_layout Standard
作展开 
\begin_inset Formula $\sbf A=\sbf N_{\alpha}^{e}A_{\alpha}$
\end_inset

，
\begin_inset Formula $\Phi=L_{\mu}^{e}\Phi_{\mu}$
\end_inset

，其中
\begin_inset Formula $A_{\alpha}$
\end_inset

 表示 Edge 
\begin_inset Formula $\alpha$
\end_inset

 上的自由度；
\begin_inset Formula $\Phi_{\mu}$
\end_inset

表示节点
\begin_inset Formula $\mu$
\end_inset

上的自由度。代入上述方程可得
\begin_inset Formula 
\begin{align*}
R^{e}(\sbf N_{\alpha}^{e}) & ={\color{blue}K_{\alpha\beta}^{e}}\,A_{\beta}-b_{\alpha}^{e}+{\color{brown}C_{\alpha\nu}^{e}}\,\partial_{t}\Phi_{\nu}+{\color{magenta}M_{\alpha\beta}^{e}}\,\partial_{t}A_{\beta}\\
R^{e}(L_{\mu}^{e}) & ={\color{red}D_{\mu\nu}^{e}}\,\partial_{t}\Phi_{\nu}+{\color{brown}C_{\mu\beta}^{e}}\,\partial_{t}A_{\beta}
\end{align*}

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\left[{\color{blue}(\nabla\times\sbf N_{\alpha}^{e})\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}\right)}\right]\dd{\Omega}\\
b_{\alpha}^{e} & =\int_{\Omega^{e}}\left[\sbf N_{\alpha}^{e}\cdot\sbf J_{\text{ex}}+\frac{1}{\mu_{r}}\sbf M_{0}\cdot(\nabla\times\sbf N_{\alpha}^{e})\right]\dd{\Omega}\\
C_{\alpha\mu}^{e}=C_{\mu\alpha}^{e} & =\int_{\Omega^{e}}{\color{brown}\sigma\nabla L_{\mu}^{e}\cdot\sbf N_{\alpha}^{e}}\dd{\Omega}\\
M_{\alpha\beta}^{e} & =\int_{\Omega^{e}}{\color{magenta}\sigma\sbf N_{\alpha}^{e}\cdot\sbf N_{\beta}^{e}}\dd{\Omega}\\
D_{\mu\nu}^{e} & =\int_{\Omega^{e}}{\color{red}\sigma\left(\nabla L_{\mu}^{e}\cdot\nabla L_{\nu}^{e}\right)}\dd{\Omega}
\end{align*}

\end_inset

最后可以得到两个矩阵方程
\begin_inset Formula 
\begin{align*}
 & R^{e}(\sbf N_{\alpha}^{e})=[{\color{blue}K_{\alpha\beta}^{e}}]\,A_{\beta}-b_{\alpha}^{e}+[{\color{brown}C_{\alpha\nu}^{e}}]\,\partial_{t}\Phi_{\nu}+[{\color{magenta}M_{\alpha\beta}^{e}}]\,\partial_{t}A_{\beta}=\{0\}\\
 & R^{e}(L_{\mu\nu}^{e})=[{\color{red}D_{\mu\nu}^{e}}]\,\partial_{t}\Phi_{\nu}+[{\color{brown}C_{\mu\beta}^{e}}]\partial_{t}A_{\beta}=\{0\}
\end{align*}

\end_inset

整理之后可得
\begin_inset Formula 
\[
\left[\begin{array}{cc}
0 & 0\\
0 & {\color{blue}K_{\alpha\beta}^{e}}
\end{array}\right]\left[\begin{array}{c}
\Phi_{\mu}\\
A_{\beta}
\end{array}\right]+\left[\begin{array}{cc}
{\color{red}D_{\mu\nu}^{e}} & {\color{brown}C_{\mu\beta}^{e}}\\
{\color{brown}C_{\alpha\nu}^{e}} & {\color{magenta}M_{\alpha\beta}^{e}}
\end{array}\right]\partial_{t}\left[\begin{array}{c}
\Phi_{\nu}\\
A_{\beta}
\end{array}\right]=\left[\begin{array}{c}
0\\
b_{\alpha}^{e}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Itemize
然后是时间导数项作离散，按照通常的 常微分方程 离散格式。空间离散（FEM）和 时间离散（ODE）彼此独立，
\series bold
按照各自的离散化规则处理即可
\series default
，时间矩阵在代码中标记为 
\family sans
\series bold
Me
\family default
\series default
。
\end_layout

\begin_layout Itemize
拿掉 
\begin_inset Formula $\partial_{t}$
\end_inset

之后，
\family sans
\series bold
Me
\family default
\series default
对应的矩阵是 
\begin_inset Formula $\sbf N_{\alpha}^{e}\cdot\sbf N_{\beta}^{e}$
\end_inset

 这种二次项，
\family sans
\series bold
Me
\family default
\series default
 与 
\family sans
\series bold
Ke
\family default
\series default
 项符号相同。
\end_layout

\begin_layout Remark
\begin_inset Argument 1
status open

\begin_layout Plain Layout
deprecated
\end_layout

\end_inset

。例如使用后向微分。
\begin_inset Formula 
\[
\left[\begin{array}{cc}
0 & 0\\
0 & {\color{blue}K_{\alpha\beta}^{e}}
\end{array}\right]\left[\begin{array}{c}
\Phi_{\mu}^{t+\Delta t}\\
A_{\beta}^{t+\Delta t}
\end{array}\right]+\left[\begin{array}{cc}
{\color{red}D_{\mu\nu}^{e}} & {\color{brown}C_{\mu\beta}^{e}}\\
{\color{brown}C_{\alpha\nu}^{e}} & {\color{magenta}M_{\alpha\beta}^{e}}
\end{array}\right]\frac{1}{\Delta t}\left[\begin{array}{c}
\Phi_{\nu}^{t+\Delta t}-\Phi_{\nu}^{t}\\
A_{\beta}^{t+\Delta t}-A_{\beta}^{t}
\end{array}\right]=\left[\begin{array}{c}
0\\
b_{\alpha}^{e}
\end{array}\right]
\]

\end_inset

最后得到
\begin_inset Formula 
\begin{align}
\Bigg(\left[\begin{array}{cc}
0 & 0\\
0 & {\color{blue}K_{\alpha\beta}^{e}}
\end{array}\right]+\frac{1}{\Delta t}\left[\begin{array}{cc}
{\color{red}D_{\mu\nu}^{e}} & {\color{brown}C_{\mu\beta}^{e}}\\
{\color{brown}C_{\alpha\nu}^{e}} & {\color{magenta}M_{\alpha\beta}^{e}}
\end{array}\right]\Bigg) & \left[\begin{array}{c}
\Phi_{\nu}^{t+\Delta t}\\
A_{\beta}^{t+\Delta t}
\end{array}\right]\label{eq:my22}\\
 & \qquad=\left[\begin{array}{c}
0\\
b_{\alpha}^{e}
\end{array}\right]+\frac{1}{\Delta t}\left[\begin{array}{cc}
{\color{red}D_{\mu\nu}^{e}} & {\color{brown}C_{\mu\beta}^{e}}\\
{\color{brown}C_{\alpha\nu}^{e}} & {\color{magenta}M_{\alpha\beta}^{e}}
\end{array}\right]\left[\begin{array}{c}
\Phi_{\nu}^{t}\\
A_{\beta}^{t}
\end{array}\right]\nonumber 
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my22"
plural "false"
caps "false"
noprefix "false"

\end_inset

左边是
\begin_inset Formula $t+\Delta t$
\end_inset

时刻的场，右边是
\begin_inset Formula $t$
\end_inset

时刻的场；以 
\begin_inset Formula $[\Phi_{\nu}^{t+\Delta t},A_{\beta}^{t+\Delta t}]$
\end_inset

 作为待求矢量，方程又化作 
\begin_inset Formula $AX=b$
\end_inset

 的形式。
\end_layout

\begin_layout Section
磁场A的mapping，不同网格之间
\end_layout

\begin_layout Section
时谐磁场非线性材料
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "磁力线到底是什么东西，为什么用等A线来描述？"
target "https://www.zhihu.com/question/325541042/answer/692043339"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
为什么时谐场不支持非线性铁磁材料。
\end_layout

\begin_layout Chapter
运动导体，Eddy电流
\end_layout

\begin_layout Section
约定
\end_layout

\begin_layout Standard
随体坐标系（moving坐标系）表示为 
\begin_inset Formula $(X,Y,Z)$
\end_inset

，固定坐标系表示为
\begin_inset Formula $(x,y,z)$
\end_inset

。坐标的变换关系为
\begin_inset Formula 
\[
\sbf r=\sbf R+\sbf v\,t
\]

\end_inset


\end_layout

\begin_layout Itemize
洛伦兹力公式
\begin_inset Formula 
\[
\sbf F=q\,\sbf E+q\,\sbf v\times\sbf B
\]

\end_inset


\end_layout

\begin_layout Itemize
\begin_inset Formula $\sbf A$
\end_inset

–
\begin_inset Formula $\phi$
\end_inset

 势
\begin_inset Formula 
\begin{align*}
 & \sbf B=\nabla\times\sbf A\\
 & \sbf E=-\nabla\phi-\frac{\partial\sbf A}{\partial t}
\end{align*}

\end_inset


\end_layout

\begin_layout Section
涡流 eddy current
\end_layout

\begin_layout Standard
参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\begin{align*}
\nabla\cdot\sigma\left(\nabla\Phi+\partial_{t}\sbf A\right)= & 0\\
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)= & -\mu_{0}\sigma\,\partial_{t}\sbf A+\frac{\mu_{0}}{\mu_{r}}\nabla\times\sbf M_{0}+\mu_{0}\sbf J_{\text{0}}-\mu_{0}\sigma\,\nabla\Phi
\end{align*}

\end_inset


\end_layout

\begin_layout Itemize
随体坐标 
\begin_inset Formula $(t,\sbf R)$
\end_inset

下，涡流表示为
\begin_inset Formula 
\[
\sbf J_{\text{eddy}}\left(t,\sbf R\right)={\color{blue}-\sigma_{\text{ed}}\,\partial_{t}\sbf A(t,\sbf R)}
\]

\end_inset

磁矢势方程
\begin_inset Formula 
\begin{align}
 & \nabla\times\nu\,\nabla\times A(t,\sbf R)=\sbf J_{0}{\color{blue}-\sigma_{\text{ed}}\,\partial_{t}\sbf A(t,\sbf R)}-\sigma\,\nabla\phi(t,\sbf R)\label{eq:Na1}\\
 & \nabla\cdot\left[{\color{blue}-\sigma_{\text{ed}}\,\partial_{t}\sbf A(t,\sbf R)}-\sigma\,\nabla\phi(t,\sbf R)\right]=0\label{eq:Na2}
\end{align}

\end_inset

其中
\begin_inset Formula $\sbf A$
\end_inset

 and 
\begin_inset Formula $\phi$
\end_inset

 分别是 磁矢势 和 电标势。
\begin_inset Formula $\nu=\mu^{-1}$
\end_inset

 是磁阻率（reluctivity），
\begin_inset Formula $\sigma$
\end_inset

是电导率，
\begin_inset Formula $\sigma_{\text{ed}}$
\end_inset

表示
\series bold
运动导体
\series default
的电导率；
\begin_inset Formula $\sbf J_{0}$
\end_inset

 是 magnetizing current density。
\end_layout

\begin_layout Itemize
固定坐标系
\begin_inset Formula $(t,\sbf r)$
\end_inset

下，涡流可以表示为
\begin_inset Formula 
\[
\sbf J_{\text{eddy}}\left(t,\sbf r\right)={\color{blue}-\sigma_{\text{ed}}\,\partial_{t}\sbf A(t,\sbf r)+\sigma_{\text{ed}}\,\sbf v\times\sbf B(t,\sbf r)}
\]

\end_inset

磁矢势方程
\begin_inset Formula 
\begin{align}
 & \nabla\times\mu\,\nabla\times A(t,\sbf r)=\sbf J_{0}{\color{blue}-\sigma_{\text{ed}}\,\partial_{t}\sbf A(t,\sbf R)+\sigma_{\text{ed}}\,\sbf v\times\sbf B(t,\sbf r)}-\sigma\,\nabla\phi(t,\sbf R)\label{eq:Na3}\\
 & \nabla\cdot\left[{\color{blue}-\sigma_{\text{ed}}\,\partial_{t}\sbf A(t,\sbf r)+\sigma_{\text{ed}}\,\sbf v\times\sbf B(t,\sbf r)}-\sigma\,\nabla\phi(t,\sbf r)\right]=0\label{eq:Na4}
\end{align}

\end_inset

其中 
\begin_inset Formula $\sbf v$
\end_inset

为 
\series bold
运动导体
\series default
 的 速度矢量，
\begin_inset Formula $\sbf B=\nabla\times\sbf A(t,\sbf r)$
\end_inset

 是 flux density vector 。
\end_layout

\begin_layout Section
Eddy 电流项的离散
\end_layout

\begin_layout Standard
以
\begin_inset Formula $1$
\end_inset

–D模型为例
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Na-fig2"
plural "false"
caps "false"
noprefix "false"

\end_inset

，沿着
\begin_inset Formula $x$
\end_inset

轴作匀速运动，使用 backward 差分离散时间导数。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/eddy-fig1.png
	lyxscale 45
	scale 45

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Conductor moving with constant velocity。
\begin_inset CommandInset label
LatexCommand label
name "fig:Na-fig2"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Transient 分析
\end_layout

\begin_layout Standard
In the transient analysis of the moving conductor，在时刻 
\begin_inset Formula $(t+\Delta t)$
\end_inset

，点
\begin_inset Formula $p$
\end_inset

（固定系坐标为
\begin_inset Formula $x_{2}$
\end_inset

），
\end_layout

\begin_layout Itemize
随体坐标系的时间导数为
\begin_inset Formula 
\begin{align}
\frac{\partial\sbf A(X_{1})^{t+\Delta t}}{\partial t} & =\frac{\sbf A^{*}(X_{1})^{t+\Delta t}-\sbf A(X_{1})^{t}}{\Delta t}\nonumber \\
 & =\frac{\sbf A^{*}(x_{2})^{t+\Delta t}-\sbf A(x_{1})^{t}}{\Delta t}\label{eq:Na5}
\end{align}

\end_inset

其中使用了
\begin_inset Formula $\sbf A^{*}(X_{1})^{t+\Delta t}=\sbf A^{*}(x_{2})^{t+\Delta t}$
\end_inset

，
\begin_inset Formula $\sbf A(X_{1})^{t}=\sbf A(x_{1})^{t}$
\end_inset

。
\end_layout

\begin_layout Itemize
固定坐标系的时间导数为
\begin_inset Formula 
\begin{align}
\frac{\partial\sbf A(x_{2})^{t+\Delta t}}{\partial t} & -\sbf v\cdot\sbf B(x_{2})^{t+\Delta t}\nonumber \\
 & =\frac{\sbf A^{*}(x_{2})^{t+\Delta t}-\sbf A(x_{2})^{t}}{\Delta t}-\sbf v\cdot\sbf B^{*}(x_{2})^{t+\Delta t}\label{eq:Na6}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
其中
\begin_inset Formula $\Delta t$
\end_inset

表示时间间隔。例如 
\begin_inset Formula $\sbf A^{*}(x_{2})^{t+\Delta t}$
\end_inset

表示点
\begin_inset Formula $p(x_{2})$
\end_inset

，时刻
\begin_inset Formula $(t+\Delta t)$
\end_inset

时的矢量势，上标
\begin_inset Formula $\,^{*}$
\end_inset

表示需要计算的未知量。
\end_layout

\begin_layout Standard
使用 随体坐标系（moving）得到的 系数矩阵是 对称的（symmetric）；使用固定坐标系（fixed）得到的 系数矩阵是非对称的，由于速度项。
\end_layout

\begin_layout Subsection
DC 稳态分析
\end_layout

\begin_layout Standard
In the dc steady state analysis of the moving conductor with constant velocity
 in the dc uniform field, 
\begin_inset Formula $\sbf A(x)$
\end_inset

 does not change with time as follows:
\begin_inset Formula 
\begin{equation}
\sbf A(x)^{t}=\sbf A(x)^{t+\Delta t}\label{eq:Na7}
\end{equation}

\end_inset


\end_layout

\begin_layout Itemize
在随体坐标系中，将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na7"
plural "false"
caps "false"
noprefix "false"

\end_inset

代入
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na5"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到磁矢势
\begin_inset Formula $\sbf A(x)$
\end_inset


\begin_inset Formula 
\begin{equation}
\frac{\partial\sbf A(X_{1})^{t+\Delta t}}{\partial t}=\frac{\sbf A^{*}(x_{2})^{t+\Delta t}-\sbf A^{*}(x_{1})^{t+\Delta t}}{\Delta t}\label{eq:Na8}
\end{equation}

\end_inset

由于时刻
\begin_inset Formula $(t+\Delta t)$
\end_inset

 的势是未知的，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na8"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $\sbf A^{*}(x_{1})^{t+\Delta t}$
\end_inset

 被当作未知量，从而稀疏矩阵是非对称的。
\series bold
在随体坐标中不认为 
\begin_inset Formula $\sbf A(X_{1})^{t+\Delta t}=\sbf A(X_{1})^{t}$
\end_inset


\series default
。
\end_layout

\begin_layout Itemize
在固定坐标系中，考虑到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na7"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na6"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的时间导数等于零
\begin_inset Formula 
\begin{equation}
\frac{\partial\sbf A(x_{2})^{t+\Delta t}}{\partial t}-\sbf v\cdot\sbf B(x_{2})^{t+\Delta t}=-\sbf v\cdot\sbf B^{*}(x_{2})^{t+\Delta t}\label{eq:Na9}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Eddy电流项的物理意义
\end_layout

\begin_layout Standard
in the transient analysis，随体坐标中的 速度项 可以从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na5"
plural "false"
caps "false"
noprefix "false"

\end_inset

推导出来
\begin_inset Formula 
\begin{align}
\frac{\partial\sbf A(X_{1})^{t+\Delta t}}{\partial t}= & \frac{\sbf A^{*}(x_{2})^{t+\Delta t}-\sbf A(x_{2})^{t}}{\Delta t}\nonumber \\
 & \quad+\frac{\sbf A(x_{2})^{t}-\sbf A(x_{1})^{t}}{\Delta x}\cdot\frac{\Delta x}{\Delta t}\nonumber \\
= & \frac{\sbf A^{*}(x_{2})^{t+\Delta t}-\sbf A(x_{2})^{t}}{\Delta t}-\mathrm{Ba}^{t}\cdot\sbf v\label{eq:Na10}
\end{align}

\end_inset

其中
\begin_inset Formula $\Delta x$
\end_inset

 是
\begin_inset Formula $x_{1}$
\end_inset

和 
\begin_inset Formula $x_{2}$
\end_inset

之间的距离，速度项中的
\begin_inset Formula $\mathrm{Ba}^{t}=-[\sbf A(x_{2})-\sbf A(x_{1})]/\Delta x$
\end_inset

 是 
\begin_inset Formula $x_{1}$
\end_inset

和 
\begin_inset Formula $x_{2}$
\end_inset

之间的平均 flux density at 时刻
\begin_inset Formula $t$
\end_inset

。另一方面，固定坐标系的速度项中，出现的是 
\begin_inset Formula $\sbf B^{*}(x_{2})^{t+\Delta t}$
\end_inset

 the flux density at point p in the conductor at the instant 
\begin_inset Formula $(t+\Delta t)$
\end_inset

。因此，若使用 
\series bold
时间差分
\series default
 代替 
\series bold
时间导数
\series default
，两种坐标系下的公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na5"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na6"
plural "false"
caps "false"
noprefix "false"

\end_inset

是有区别的，从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Na10"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以看出。In the dc steady state analysis，it is the same as mentioned above.
\end_layout

\begin_layout Chapter
有限元下计算电磁力
\end_layout

\begin_layout Section
Levi–Civita 符号
\end_layout

\begin_layout Standard
ref：
\begin_inset CommandInset href
LatexCommand href
name "Levi-Civita符号"
target "https://www.zhihu.com/question/445700749"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $\varepsilon^{123}=1$
\end_inset

，上标相同则为零，交换两个指标出负号。有等式：
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{def}=\left[\begin{array}{ccc}
\delta^{ad} & \delta^{ae} & \delta^{af}\\
\delta^{bd} & \delta^{be} & \delta^{bf}\\
\delta^{cd} & \delta^{ce} & \delta^{cf}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Enumerate
特殊情况一：单个指标求和，
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{aef}=\left[\begin{array}{ccc}
1 & 0 & 0\\
0 & \delta^{be} & \delta^{bf}\\
0 & \delta^{ce} & \delta^{cf}
\end{array}\right]=\left[\begin{array}{cc}
\delta^{be} & \delta^{bf}\\
\delta^{ce} & \delta^{cf}
\end{array}\right]=\delta^{be}\delta^{cf}-\delta^{bf}\delta^{ce}
\]

\end_inset


\end_layout

\begin_layout Enumerate
特殊情况二：双指标求和，
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{dbc}=\left[\begin{array}{ccc}
\delta^{ad} & 0 & 0\\
0 & 1 & 0\\
0 & 0 & 1
\end{array}\right]=\delta^{ad}
\]

\end_inset


\end_layout

\begin_layout Section
虚功法计算磁力
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:virtualforce"

\end_inset


\end_layout

\begin_layout Standard
假设导线中的电流从 
\begin_inset Formula $0$
\end_inset

 开始，在时间
\begin_inset Formula $t$
\end_inset

的时候达到 
\begin_inset Formula $I$
\end_inset

。那么在这个过程中，导线中存储的此能为：
\begin_inset Formula 
\begin{equation}
\mathcal{U}=-\int_{0}^{t}\mathcal{E}I\dd{t'}=-\int_{0}^{t}\frac{\dd{\Psi}}{\dd{t'}}I\dd{t'}=\int_{0}^{\Psi}I\dd{\Psi}.\label{eq:x6.1}
\end{equation}

\end_inset


\begin_inset Formula $\mathcal{E}$
\end_inset

螺旋与磁通成右手螺旋。
\end_layout

\begin_layout Standard
此外通过场源关系，磁能也可以表示成：
\begin_inset Formula 
\[
\mathcal{U}=\int_{\Omega}\left[\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right]\dd{\Omega}
\]

\end_inset

是用与线性和非线性情况，不包括永磁体材料。
\end_layout

\begin_layout Standard
根据磁能还可以定义 磁共能（coenergy）：
\begin_inset Formula 
\[
\mathcal{U}_{\text{co}}=I\Psi-\mathcal{U}=\int_{0}^{I}\Psi\dd{I'}
\]

\end_inset

在坐标平面上，具有明显的几何意义；
\begin_inset Formula $\mathcal{U}$
\end_inset

 和 
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

 分别对应 
\begin_inset Formula $I$
\end_inset

–
\begin_inset Formula $\Psi$
\end_inset

 曲线两侧的面积。
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

 同样可以用场表示成
\begin_inset Formula 
\[
\mathcal{U}_{\text{co}}=\int_{\Omega}\sbf H\cdot\sbf B\dd{\Omega}-\mathcal{U}=\int_{\Omega}\left(\int_{0}^{H}\sbf B\cdot\dd{\sbf H'}\right)\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Standard
根据使用 磁能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 还是 磁共能 
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

的计算思路，还有取 
\begin_inset Formula $\Psi$
\end_inset

 或 
\begin_inset Formula $I$
\end_inset

 作为 
\begin_inset Formula $x$
\end_inset

 之外的独立变量，可以得到磁力的四种表达式：
\begin_inset Formula 
\begin{align*}
F & =-\frac{\partial\mathcal{U}\left(\Psi,x\right)}{\partial x}\\
 & =-\frac{\partial\mathcal{U}\left(I,x\right)}{\partial x}+I\frac{\partial\Psi\left(I,x\right)}{\partial x}\\
 & =\frac{\partial\mathcal{U}_{\text{co}}\left(\Psi,x\right)}{\partial x}-\Psi\frac{\partial I\left(\Psi,x\right)}{\partial x}\\
 & =\frac{\partial\mathcal{U}_{\text{co}}\left(I,x\right)}{\partial x}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
磁能的磁场表示形式：
\begin_inset Formula 
\begin{align}
\mathcal{U} & =\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\dd{\Omega},\nonumber \\
\mathcal{U}_{\text{co}} & =\sum_{e}\int_{\Omega^{e}}\left[\sbf H\cdot\sbf B-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right]\dd{\Omega}.\label{eq:fem-uco}
\end{align}

\end_inset


\end_layout

\begin_layout Section
计算磁力
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:calc-magforce"

\end_inset


\end_layout

\begin_layout Standard
本节中的计算 与 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:virtualforce"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的理论不尽相同；在这里把 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 当成唯一的独立变量，计算电能的变分。
\end_layout

\begin_layout Standard
在有限元框架下，通过场的形式，将磁能表示成：
\begin_inset Formula 
\begin{align}
\mathcal{U} & =\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\dd{\Omega},\label{eq:fem-energy}
\end{align}

\end_inset

节点 
\begin_inset Formula $\alpha$
\end_inset

 上的磁力，表示成 磁能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 对节点 
\begin_inset Formula $\alpha$
\end_inset

 的坐标的偏导数：
\begin_inset Formula 
\[
\sbf F_{\alpha}=-\frac{\partial\mathcal{U}}{\partial\sbf r_{\alpha}}
\]

\end_inset

考虑到积分测度 
\begin_inset Formula $\dd{\Omega}=\dd{x}\dd{y}\dd{z}=\det[J]\dd{\xi}\dd{\eta}\dd{\zeta}$
\end_inset

，记 
\begin_inset Formula $\dd{\hat{\Omega}}=\dd{\xi}\dd{\eta}\dd{\zeta}$
\end_inset

，则根据磁共能式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:fem-uco"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\frac{\partial\det[J]}{\partial\sbf r_{\alpha}}-\left(\sbf H\cdot\frac{\partial\sbf B}{\partial\sbf r_{\alpha}}\right)\det[J]\right]\dd{\hat{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Remark
这里的变分理解为：
\end_layout

\begin_layout Enumerate
一方面节点坐标的改变，会影响到积分测度；
\end_layout

\begin_layout Enumerate
另一方面，会影响到空间场 
\begin_inset Formula $\sbf B$
\end_inset

 的分布；这里还使用了积分下求导的公式：
\begin_inset Formula 
\[
\frac{\dd}{\dd{x}}\int_{0}^{f\left(x\right)}g\left(x'\right)\dd{x'}=f'(x)g\left[f(x)\right]
\]

\end_inset

在这里就是
\begin_inset Formula 
\[
\frac{\partial}{\partial\sbf r_{\alpha}}\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\quad\Rightarrow\quad\sbf H(\sbf B)\cdot\frac{\partial\sbf B}{\partial\sbf r_{\alpha}}
\]

\end_inset


\end_layout

\begin_layout Subsection
二维电磁力计算
\end_layout

\begin_layout Standard
二维磁场 
\begin_inset Formula $\sbf B$
\end_inset

 的矢势 
\begin_inset Formula $\sbf A$
\end_inset

 只有
\begin_inset Formula $z$
\end_inset

 分量，
\begin_inset Formula $\sbf B$
\end_inset

 可以表示为：
\begin_inset Formula 
\begin{equation}
\sbf B=\frac{\partial A_{z}}{\partial y}\sbf e_{x}-\frac{\partial A_{z}}{\partial x}\sbf e_{y}=A_{i}\frac{\partial N_{i}^{e}}{\partial y}\sbf e_{x}-A_{i}\frac{\partial N_{i}^{e}}{\partial x}\sbf e_{y}=A_{i}\left(\nabla N_{i}^{e}\times\sbf e_{z}\right).\label{eq:xl6.10}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
也可以写出磁场的分量形式：
\begin_inset Formula 
\begin{equation}
B_{j}=A_{i}\varepsilon_{jk\ell}\partial_{k}N_{i}^{e}\left(\hat{e}_{z}\right)_{\ell}=\varepsilon_{jk3}\,A_{i}\partial_{k}N_{i}^{e}\label{eq:xl6.11}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\hat{e}_{z}$
\end_inset

 是
\begin_inset Formula $z$
\end_inset

方向坐标基矢，所以 
\begin_inset Formula $\left(\hat{e}_{z}\right)_{\ell}=\delta_{z\ell}$
\end_inset

。
\end_layout

\begin_layout Enumerate
上式中的 
\begin_inset Formula $\partial_{k}N_{i}^{e}$
\end_inset

 可以在 母坐标系下表示为：
\begin_inset Formula 
\[
\partial_{k}N_{i}^{e}=J_{k\ell}^{-1}\hat{\partial}_{\ell}N_{i}^{e}.
\]

\end_inset

其中 
\begin_inset Formula $\hat{\partial}_{\ell}$
\end_inset

 表示 母坐标系下的偏导。
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

 稍作变换可以得到另一种形式，两边同乘 
\begin_inset Formula $\varepsilon_{jk3}$
\end_inset

 得：
\begin_inset Formula 
\begin{align*}
 & \varepsilon_{jk3}A_{i}\partial_{k}N_{i}^{e}=B_{j}\\
\Rightarrow\quad & \varepsilon_{jk3}\;\varepsilon_{jk3}A_{i}\partial_{k}N_{i}^{e}=\varepsilon_{jk3}\;B_{j}
\end{align*}

\end_inset

即
\begin_inset Formula 
\begin{equation}
A_{i}\partial_{k}N_{i}^{e}=\varepsilon_{jk3}\,B_{j}\label{eq:xl6.11-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
使用
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

 （数字表示不同指标）得
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha m}} & =A_{i}\varepsilon_{jk3}\;{\color{blue}\frac{\partial J_{k\ell}^{-1}}{\partial r_{\alpha m}}}\;\hat{\partial}_{\ell}N_{i}^{e}=A_{i}\varepsilon_{jk3}\;{\color{blue}\left(-\partial_{k}L_{\alpha}^{e}\;J_{m\ell}^{-1}\right)}\;\hat{\partial}_{\ell}N_{i}^{e}\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(A_{i}J_{m\ell}^{-1}\hat{\partial}_{\ell}N_{i}^{e}\right)\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(A_{i}\partial_{m}N_{i}^{e}\right)\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(\varepsilon_{nm3}\,B_{n}\right)\\
 & =-\left(\delta_{jn}\delta_{km}-\delta_{jm}\delta_{kn}\right){\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{n}\\
 & =-{\color{blue}\left(\partial_{m}L_{\alpha}^{e}\right)}B_{j}+\delta_{jm}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{k}
\end{align*}

\end_inset

合并两项的贡献，给出节点 
\begin_inset Formula $\alpha$
\end_inset

 所受磁力的 
\begin_inset Formula $m$
\end_inset

 分量，
\begin_inset Formula 
\[
F_{\alpha m}=\sum_{e}\int_{\Omega^{e}}\left\{ -\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-H_{j}\left[\delta_{jm}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{k}-{\color{blue}\left(\partial_{m}L_{\alpha}^{e}\right)}B_{j}\right]\right\} \dd{\Omega}
\]

\end_inset

写成矢量形式，节点 
\begin_inset Formula $\alpha$
\end_inset

 上所受的力是，
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-\sbf H\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)+\left(\sbf H\cdot\sbf B\right)\nabla L_{\alpha}^{e}\right]\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Example
线性情况下 
\begin_inset Formula $\sbf B=\mu_{0}\mu_{r}\sbf H$
\end_inset

，节点 
\begin_inset Formula $\alpha$
\end_inset

 所受的力化简为：
\begin_inset Formula 
\begin{align*}
\sbf F_{\alpha} & =\sum_{e}\int_{\Omega^{e}}\left[-\frac{\sbf H\cdot\sbf B}{2}\nabla L_{\alpha}^{e}-\sbf H\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)+\left(\sbf H\cdot\sbf B\right)\nabla L_{\alpha}^{e}\right]\dd{\Omega}\\
 & =\sum_{e}\int_{\Omega^{e}}\left[\frac{-\sbf B\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)}{\mu_{0}\mu_{r}}+\frac{\sbf B\cdot\sbf B}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}\right]\dd{\Omega}
\end{align*}

\end_inset

代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.10"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到
\begin_inset Formula 
\begin{equation}
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[\frac{A_{\beta}A_{\gamma}}{\mu_{0}\mu_{r}}\left(\nabla L_{\alpha}^{e}\cdot\nabla N_{\beta}^{e}\right)\nabla N_{\gamma}^{e}-A_{\beta}A_{\gamma}\frac{\nabla N_{\beta}^{e}\cdot\nabla N_{\gamma}^{e}}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}\right]\dd{\Omega}\label{eq:xl6.12}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
三维电磁力计算
\end_layout

\begin_layout Standard
三维磁场可以用棱边性函数表示为：
\begin_inset Formula 
\[
\sbf B=(\nabla\times\sbf N_{\alpha}^{e})A_{\alpha}=2A_{\alpha}\ell_{\alpha}^{e}\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}
\]

\end_inset

其中 
\begin_inset Formula $\sbf N_{\alpha}^{e}=(L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}-L_{\alpha(2)}^{e}\times\nabla L_{\alpha(1)}^{e})\ell_{\alpha}^{e}$
\end_inset

。分量形式为：
\begin_inset Formula 
\begin{align*}
B_{j} & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\;{\color{blue}\partial_{k}L_{\alpha(1)}^{e}}\;{\color{brown}\partial_{m}L_{\alpha(2)}^{e}}\\
 & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\;{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}\hat{\partial}_{g}L_{\alpha(2)}^{e}}
\end{align*}

\end_inset

上式中的 Jacobi 矩阵和四面体棱边的长度 
\begin_inset Formula $\ell_{i}^{e}$
\end_inset

 均为 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 的函数，但在用棱边形函数进行有限元计算时，待求的独立变量应该是 
\begin_inset Formula $A_{i}\ell_{i}$
\end_inset

 而不是 
\begin_inset Formula $A_{i}$
\end_inset

；每条边上的 
\begin_inset Formula $A_{i}\ell_{i}$
\end_inset

 不变，也是保证四面体某个面上磁通不变的条件。因此在计算 
\begin_inset Formula $B_{j}$
\end_inset

 偏导的时候，只需计算 Jacobi 矩阵对 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 的导数。利用式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

可得
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha h}} & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left({\color{blue}\frac{\partial J_{kf}^{-1}}{\partial r_{\alpha h}}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}}+{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}\frac{J_{mg}^{-1}}{\partial r_{\alpha h}}}\right){\color{brown}\hat{\partial}_{g}L_{\alpha(2)}^{e}}\\
 & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}(-)\left({\color{blue}\partial_{k}L_{\alpha}^{e}\;J_{hf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}}+{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}\partial_{m}L_{\alpha}^{e}\;J_{hg}^{-1}}\right){\color{brown}\hat{\partial}_{g}L_{\alpha(2)}^{e}}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left(\partial_{k}L_{\alpha}^{e}\;{\color{red}J_{hf}^{-1}\hat{\partial}_{f}}\;L_{\alpha(1)}^{e}\;{\color{red}J_{mg}^{-1}\hat{\partial}_{g}}\;L_{\alpha(2)}^{e}+{\color{red}J_{kf}^{-1}\hat{\partial}_{f}}\;L_{\alpha(1)}^{e}\;\partial_{m}L_{\alpha}^{e}\;{\color{red}J_{hg}^{-1}\hat{\partial}_{g}}\;L_{\alpha(2)}^{e}\right)\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left(\partial_{k}L_{\alpha}^{e}\;{\color{red}\partial_{h}}\;L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}\;L_{\alpha(2)}^{e}+{\color{red}\partial_{k}}\;L_{\alpha(1)}^{e}\;\partial_{m}L_{\alpha}^{e}\;{\color{red}\partial_{h}}\;L_{\alpha(2)}^{e}\right)\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\partial_{k}L_{\alpha}^{e}\left({\color{red}\partial_{h}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}L_{\alpha(2)}^{e}-{\color{red}\partial_{m}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{h}}L_{\alpha(2)}^{e}\right)
\end{align*}

\end_inset

代入恒等式
\begin_inset Formula 
\[
{\color{red}\partial_{h}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}L_{\alpha(2)}^{e}-{\color{red}\partial_{m}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{h}}L_{\alpha(2)}^{e}=\varepsilon_{bhm}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\quad\text{反对称}
\]

\end_inset

得到
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha h}} & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\partial_{k}L_{\alpha}^{e}\;\varepsilon_{bhm}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\left[\begin{array}{cc}
\delta_{jb} & \delta_{jh}\\
\delta_{kb} & \delta_{kh}
\end{array}\right]\partial_{k}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\left[\partial_{h}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{j}-\delta_{jh}\partial_{k}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{k}\right]\\
 & =-B_{j}\;\partial_{h}L_{\alpha}^{e}+\delta_{jh}\;B_{k}\,\partial_{k}L_{\alpha}^{e}
\end{align*}

\end_inset

写成矢量形式是
\begin_inset Formula 
\[
\left[\begin{array}{c}
\partial/\partial r_{\alpha1}\\
\partial/\partial r_{\alpha2}\\
\partial/\partial r_{\alpha3}
\end{array}\right]B_{j}=-B_{j}\nabla L_{\alpha}^{e}+\sbf e_{j}\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)
\]

\end_inset

因此虚功法的磁力表达式
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-\sbf H\cdot\frac{\partial\sbf B}{\partial\sbf r_{k}}\right]
\]

\end_inset

给出
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}+\nabla L_{\alpha}^{e}\left(\sbf H\cdot\sbf B\right)-\left(\sbf B\cdot\nabla L_{\alpha}^{e}\right)\sbf H\right]
\]

\end_inset

对于线性材料 
\begin_inset Formula $\sbf B=\mu\mu_{0}\sbf H$
\end_inset

，结果化简为：
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\frac{\sbf B\cdot\sbf B}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}-\frac{\sbf B\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)}{\mu_{0}\mu_{r}}\right]
\]

\end_inset


\end_layout

\begin_layout Section
计算电力？？
\end_layout

\begin_layout Standard
理论公式：
\begin_inset Formula 
\[
\mathcal{U}=\int_{0}^{Q}V\dd{Q'}=\int_{\Omega}\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\dd{\Omega}
\]

\end_inset


\begin_inset Formula 
\[
\int_{0}^{\Psi}I\dd{\Psi'}\quad\Leftrightarrow\quad\int_{0}^{Q}V\dd{Q'}
\]

\end_inset

所以 
\begin_inset Formula $\Psi$
\end_inset

 对应 
\begin_inset Formula $Q$
\end_inset

，
\begin_inset Formula $I$
\end_inset

 对应 
\begin_inset Formula $V$
\end_inset

。
\begin_inset Formula 
\begin{align*}
\mathcal{U}_{\text{co}} & =VQ-\mathcal{U}=\int_{0}^{V}Q\dd{V'}\\
 & =\int_{\Omega}\left(\int_{0}^{E}\sbf D\cdot\dd{\sbf E'}\right)\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
类似磁力的计算 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:calc-magforce"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\mathcal{U}=\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\det[J]\dd{\hat{\Omega}}
\]

\end_inset

节点 
\begin_inset Formula $\alpha$
\end_inset

 上的电力，表示成 电能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 对节点 
\begin_inset Formula $\alpha$
\end_inset

 的坐标的偏导数：
\begin_inset Formula 
\[
\sbf F_{\alpha}=-\frac{\partial\mathcal{U}}{\partial\sbf r_{\alpha}}
\]

\end_inset


\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right){\color{blue}\frac{\partial\det[J]}{\partial\sbf r_{\alpha}}}-\left(\sbf E\cdot{\color{brown}\frac{\partial\sbf D}{\partial\sbf r_{\alpha}}}\right)\det[J]\right]\dd{\hat{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Example
代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\partial\det[J]/\partial r_{\alpha j}=\det[J]\,\partial_{j}L_{\alpha}^{e}$
\end_inset

，第一项的贡献表示为，
\begin_inset Formula 
\[
f_{\alpha,1}=-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right){\color{blue}\partial_{j}L_{\alpha}^{e}\,\det[J]}\dd{\hat{\Omega}}
\]

\end_inset

顺便改写积分测度：
\begin_inset Formula 
\[
\sbf f_{\alpha,1}=-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\nabla L_{\alpha}^{e}\,\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
再考虑第二项的贡献
\begin_inset Formula 
\begin{equation}
-\left(\sbf E\cdot{\color{brown}\frac{\partial\sbf D}{\partial\sbf r_{\alpha}}}\right)\det[J]\quad\Rightarrow\quad-E_{i}\frac{\partial D_{i}}{\partial r_{\alpha j}}\,\det[J]\label{eq:e-force2}
\end{equation}

\end_inset

右边是对应的分量形式。电位移
\begin_inset Formula $\sbf D$
\end_inset

 依赖于 电场强度 
\begin_inset Formula $\sbf E$
\end_inset

：
\begin_inset Formula 
\[
\frac{\partial D_{i}}{\partial r_{\alpha j}}=\mathcal{\varepsilon}_{ik}\frac{\partial E_{k}}{\partial r_{\alpha j}},\quad\mathcal{\varepsilon}_{ik}=\frac{\partial D_{i}}{\partial E_{k}}
\]

\end_inset


\begin_inset Formula $\mathcal{\varepsilon}_{ik}$
\end_inset

 是材料的介电张量。写出 
\begin_inset Formula $\sbf E=-\nabla\phi$
\end_inset

 的分量形式：
\end_layout

\begin_layout Example
\begin_inset Formula 
\[
E_{k}=-\partial_{k}\phi=-{\color{blue}\partial_{k}N_{\beta}^{e}\;\phi_{\beta}}
\]

\end_inset

其中 
\begin_inset Formula $\phi_{\beta}$
\end_inset

 是节点上的电势，为常数。将对 母坐标的偏导数记作 
\begin_inset Formula $\hat{\partial}_{k}=\left(\frac{\partial}{\partial\xi},\frac{\partial}{\partial\eta},\frac{\partial}{\partial\zeta}\right)$
\end_inset

，考虑雅可比矩阵得
\begin_inset Formula 
\begin{equation}
E_{k}=-{\color{brown}J_{k\ell}^{-1}}\;{\color{blue}\hat{\partial}_{\ell}N_{\beta}^{e}\,\phi_{\beta}}\label{eq:elec-field}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
其中 
\begin_inset Formula $\hat{\partial}_{\ell}N_{\beta}^{e}$
\end_inset

 表示 母坐标系下的偏导，此时形函数 
\begin_inset Formula $N_{\beta}^{e}$
\end_inset

 使用 母坐标表示，不包含节点 
\begin_inset Formula $\alpha$
\end_inset

 的空间坐标。
\end_layout

\begin_layout Enumerate
对节点 
\begin_inset Formula $\alpha$
\end_inset

 坐标的依赖 只包含在 
\begin_inset Formula ${\color{brown}J_{k\ell}^{-1}}$
\end_inset

 中。
\end_layout

\begin_layout Standard
代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

 （数字表示不同指标）得
\begin_inset Formula 
\begin{align*}
\frac{\partial E_{k}}{\partial r_{\alpha j}} & =-({\color{brown}-\partial_{k}L_{\alpha}^{e}\;J_{j\ell}^{-1}})\,{\color{blue}\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\\
 & =\partial_{k}L_{\alpha}^{e}\;{\color{blue}J_{j\ell}^{-1}\,\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\\
 & ={\color{blue}(-E_{j})}\;\partial_{k}L_{\alpha}^{e}
\end{align*}

\end_inset

将此结果代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e-force2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 得
\begin_inset Formula 
\[
-E_{i}\frac{\partial D_{i}}{\partial r_{\alpha j}}=-E_{i}\,\mathcal{\varepsilon}_{ik}\left(-E_{j}\right)\partial_{k}L_{\alpha}^{e}
\]

\end_inset

写成矢量形式是
\begin_inset Formula 
\[
f_{\alpha,2}=\sbf E\;\left(\sbf E\cdot\varepsilon\cdot\nabla L_{\alpha}^{e}\right)\dd{\Omega}
\]

\end_inset

其中 
\begin_inset Formula $\varepsilon=\partial D/\partial E$
\end_inset

，是材料的介电张量。
\end_layout

\begin_layout Standard
综合两项的贡献得到：
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\nabla L_{\alpha}^{e}+\sbf E\,\left(\sbf E\cdot\varepsilon\cdot\nabla L_{\alpha}^{e}\right)\right]\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Subsection
eeee
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
F_{\alpha}=\sum_{\langle e\rangle}\int_{\Omega^{e}}\left[\big(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\big)\nabla L_{\alpha}^{e}-\sbf E\,(\sbf D\cdot\nabla L_{\alpha}^{e})\right]\dd{\Omega}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
F_{\alpha} & =\sum_{\langle e\rangle}\int_{\Omega^{e}}\frac{\sbf E\cdot\sbf D}{2}\nabla L_{\alpha}^{e}\dd{\Omega}-\sum_{\langle e\rangle}\int_{\Omega^{e}}\left(\sbf D\cdot\nabla L_{\alpha}^{e}\right)\sbf E\dd{\Omega}\\
 & +\sum_{\langle e\rangle}\int_{\Omega^{e}}\frac{\sbf B\cdot\sbf H}{2}\nabla L_{\alpha}^{e}\dd{\Omega}-\sum_{\langle e\rangle}\int_{\Omega^{e}}\left(\sbf B\cdot\nabla L_{\alpha}^{e}\right)\sbf H\dd{\Omega}
\end{align*}

\end_inset

在上面的表达式中，
\begin_inset Formula $\langle e\rangle$
\end_inset

 表示仅对最近邻单元进行求和。将目标区域的节点上的电磁力进行求和，可以得到该目标区域所受到的总的电磁力。
\end_layout

\begin_layout Standard
另外根据力矩的计算公式，也可以得到各个节点上所受到的力矩，即
\begin_inset Formula 
\[
\sbf T_{k}=\left(\sbf r_{k}-\sbf r_{0}\right)\times\sbf F_{k}
\]

\end_inset

 其中 
\begin_inset Formula $\sbf r_{0}$
\end_inset

 为转轴的坐标，对目标区域的节点上的力矩进行求和，同样可以得到总的电磁力矩。
\end_layout

\begin_layout Section
麦克斯韦协强张量法
\end_layout

\begin_layout Standard
麦克斯韦协强张量法通常用来计算被真空包围的磁体在磁场作用下受到的合力。从洛伦兹力表达式
\begin_inset Formula 
\begin{equation}
\sbf F=\int_{V}\sbf J\times\sbf B\dd{V}\label{eq:xl6.18}
\end{equation}

\end_inset

出发，根据
\begin_inset Formula $\nabla\times\sbf B=\mu_{0}\sbf J$
\end_inset

 和 
\begin_inset Formula $\nabla\cdot\sbf B=\sbf0$
\end_inset

，可以得到
\begin_inset Formula 
\[
\sbf F=\int_{V}\frac{(\nabla\times\sbf B)\times\sbf B+(\nabla\cdot\sbf B)\sbf B}{\mu_{0}}\dd{V}
\]

\end_inset

分量形式下
\begin_inset Formula 
\begin{equation}
F_{a}=\int_{V}\frac{-(\partial_{a}B_{b})B_{b}+(\partial_{b}B_{a})B_{b}+B_{a}(\partial_{b}B_{b})}{\mu_{0}}\dd{V}\label{eq:xl6.19}
\end{equation}

\end_inset

在没有电场的情况下，麦克斯韦协强张量定义为
\begin_inset Formula 
\begin{equation}
\mathcal{T}_{ab}=\frac{1}{\mu_{0}}B_{a}B_{b}-\frac{B_{c}B_{c}}{2\mu_{0}}\delta_{ab}\label{eq:xl6.20}
\end{equation}

\end_inset

 计算可以得到
\begin_inset Formula 
\begin{align*}
\partial_{b}\mathcal{T}_{ab} & =\frac{1}{\mu_{0}}\partial_{b}(B_{a}B_{b})-\frac{\partial_{b}(B_{c}B_{c})}{2\mu_{0}}\delta_{ab}\\
 & =\frac{(\partial_{b}B_{a})B_{b}+B_{a}(\partial_{b}B_{b})}{\mu_{0}}-\frac{(\partial_{a}B_{b})B_{b}}{\mu_{0}}
\end{align*}

\end_inset

所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.19"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的洛伦兹力可以用麦克斯韦协强张量表示为：
\begin_inset Formula 
\[
F_{a}=\int_{V}\dd{V}\partial_{b}\,\mathcal{T}_{ab}=\oint_{S}\dd{S}\sbf n_{b}\,\mathcal{T}_{ab}
\]

\end_inset


\end_layout

\begin_layout Standard
存在表面电流的情况下
\begin_inset Formula 
\[
\sbf F=\iint_{S}\sbf J_{s}\times\frac{\sbf B^{+}+\sbf B^{-}}{2}\dd{S}
\]

\end_inset

根据边界条件 
\begin_inset Formula $\sbf n\cdot(\sbf B^{+}+\sbf B^{-})=0$
\end_inset

以及
\begin_inset Formula $\sbf n\times(\sbf B^{+}-\sbf B^{-})=\mu_{0}\sbf J_{s}$
\end_inset

，可以将洛伦兹力分量形式用磁场表示为
\begin_inset Formula 
\[
F_{a}=\iint_{s}\frac{2n_{b}B_{a}^{+}B_{b}^{-}-n_{a}B_{b}^{+}B_{b}^{+}+n_{a}B_{b}^{-}B_{b}^{-}-2n_{b}B_{a}^{-}B_{b}^{+}}{2\mu_{0}}\dd{S}
\]

\end_inset

另外根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.20"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的麦克斯韦协强张量的定义可得
\begin_inset Formula 
\[
n_{b}\left(\mathcal{T}_{ab}^{+}-\mathcal{T}_{ab}^{-}\right)=\frac{2n_{b}B_{a}^{+}B_{b}^{-}-n_{a}B_{b}^{+}B_{b}^{+}+n_{a}B_{b}^{-}B_{b}^{-}-2n_{b}B_{a}^{-}B_{b}^{+}}{2\mu_{0}}
\]

\end_inset

因此可以将表面电流下的洛伦兹力表示为
\begin_inset Formula 
\[
F_{a}=\iint_{S}n_{b}\left(\mathcal{T}_{ab}^{+}-\mathcal{T}_{ab}^{-}\right)\dd{S}
\]

\end_inset


\end_layout

\begin_layout Section
等价电流法
\end_layout

\begin_layout Standard
根据洛伦兹力的表达式，在静磁学中，一个局域电流分布受到的力为：
\begin_inset Formula 
\[
\sbf F=\int_{V}\sbf J(\sbf r')\times\sbf B(\sbf r')\dd[3]{r'}
\]

\end_inset

假设电流分布局域在原点附近，将外磁场在原点附近展开：
\begin_inset Formula $\sbf B(\sbf r')=\sbf B(\sbf0)+(\sbf r'\cdot\nabla)\sbf B(\sbf0)+\cdots$
\end_inset

，然后代入上式可得
\begin_inset Formula 
\[
F_{a}=\varepsilon_{abc}\int_{V}J_{b}(B_{c}+r_{d}^{\prime}\partial_{d}B_{c})\dd[3]{r'}
\]

\end_inset

第一项包含
\begin_inset Formula $\int\sbf J(\sbf r')\dd[3]{r'}$
\end_inset

，其值等于零（全空间稳恒电流守恒方程）；另外由等式
\begin_inset Formula $\int_{V}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})\dd[3]{r'}=0$
\end_inset

，可知 
\begin_inset Formula $\int_{V}J_{b}r_{c}^{\prime}\dd[3]{r'}$
\end_inset

为反对称张量。所以
\begin_inset Formula 
\begin{align*}
F_{a} & =\frac{\varepsilon_{abc}}{2}\int_{V}\left(J_{b}r_{d}^{\prime}-J_{d}r_{b}^{\prime}\right)\partial_{d}B_{c}\dd[3]{r'}\\
 & =\frac{-\varepsilon_{abc}}{2}\int_{V}\varepsilon_{bed}\left(\sbf J\times r^{\prime}\right)_{e}\partial_{d}B_{c}\dd[3]{r'}
\end{align*}

\end_inset

定义
\begin_inset Formula 
\[
\sbf m=\frac{1}{2}\int_{V}\sbf r'\times\sbf J(\sbf r')\dd[3]{r'}
\]

\end_inset

并根据
\begin_inset Formula $\nabla\cdot\sbf B=0$
\end_inset

，最后可以得到
\begin_inset Formula 
\[
F_{a}=m_{b}\partial_{a}B_{b}
\]

\end_inset

如果材料里面有连续分布的磁化强度，则合力的表达式为：
\begin_inset Formula 
\[
\sbf F=\int_{\Omega}\sbf M\cdot(\nabla\sbf B)\dd{\Omega}
\]

\end_inset

其中
\begin_inset Formula $\nabla\sbf B$
\end_inset

的结果是一个张量。
\end_layout

\begin_layout Remark
\begin_inset Formula $\int_{V}\dd[3]{r'}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})=\oint_{S}\dd{\sbf S}\cdot(\sbf Jr_{b}^{\prime}r_{c}^{\prime})=0$
\end_inset

（考虑到电流分布是局域的），另一方面
\begin_inset Formula 
\begin{align*}
\int_{V}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})\dd[3]{r'} & =\int_{V}\left[(\partial_{a}J_{a})r_{b}^{\prime}r_{c}^{\prime}+J_{b}r_{c}^{\prime}+J_{c}r_{b}^{\prime}\right]\dd[3]{r'}\\
 & =\int_{V}(J_{b}r_{c}^{\prime}+J_{c}r_{b}^{\prime})\dd[3]{r'}=0
\end{align*}

\end_inset

所以说
\begin_inset Formula $\int_{V}\,J_{b}r_{c}^{\prime}\dd[3]{r'}$
\end_inset

是反对称的。
\end_layout

\begin_layout Remark
若
\begin_inset Formula $W_{c}=\varepsilon_{abc}U_{a}V_{b}=\sbf U\times\sbf V$
\end_inset

，定义
\begin_inset Formula 
\[
T_{ab}=\varepsilon_{ab{\color{blue}c}}W_{{\color{blue}c}}
\]

\end_inset

根据
\begin_inset Formula $\varepsilon_{abc}\varepsilon_{abd}=\delta_{cd}$
\end_inset

，逆变换是
\begin_inset Formula 
\[
W_{{\color{blue}d}}=\varepsilon_{ab{\color{blue}d}}T_{ab}
\]

\end_inset

则根据迷向张量恒等式 
\begin_inset Formula $\varepsilon_{abc}\varepsilon_{ade}=\delta_{bd}\delta_{ce}-\delta_{be}\delta_{cd}$
\end_inset

可得
\begin_inset Formula 
\[
T_{de}=\varepsilon_{dea}\varepsilon_{abc}U_{b}V_{c}=U_{d}V_{e}-U_{e}V_{d}
\]

\end_inset


\end_layout

\begin_layout Chapter
三维空间曲面
\end_layout

\begin_layout Section
仿射变换，局域坐标系
\end_layout

\begin_layout Standard
约定：全局坐标表示为 笛卡尔坐标系中的 
\begin_inset Formula $\sbf r=\left(x,y,z\right)$
\end_inset

 ，二维平面局域坐标表示为 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

。对于三维空间中的曲面上的点，其全局坐标和局域坐标的变换关系为：
\begin_inset Formula 
\begin{align*}
\sbf r & =S.\sbf R+\sbf r_{n}\\
\sbf R & =S^{-1}.\left(\sbf r-\sbf r_{n}\right)
\end{align*}

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是第
\begin_inset Formula $n$
\end_inset

个单元的参考点。也可以写成
\begin_inset Formula 
\[
\left[\begin{array}{c}
\sbf r\\
1
\end{array}\right]=\left[\begin{array}{cc}
S & \sbf r_{n}\\
0 & 1
\end{array}\right]\left[\begin{array}{c}
\sbf R\\
1
\end{array}\right]
\]

\end_inset

其中坐标变换矩阵
\begin_inset Formula $S$
\end_inset

为
\begin_inset Formula 
\[
S_{ij}=\sbf d_{i}\cdot{\color{blue}\sbf e_{j}}.
\]

\end_inset

式中 
\begin_inset Formula $\sbf d_{i}$
\end_inset

 表示笛卡尔坐标基矢， 
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 表示局域坐标基矢。因此，
\begin_inset Formula $S$
\end_inset

 的每一列就是 
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 在原坐标系中的分量表示。这里的约定是
\begin_inset Formula 
\[
\left[e_{1}\right]=\left(\begin{array}{c}
e_{1,x}=\sbf d_{1}\cdot\sbf e_{1}\\
e_{1,y}=\sbf d_{2}\cdot\sbf e_{1}\\
e_{1,z}=\sbf d_{3}\cdot\sbf e_{1}
\end{array}\right),\quad\sbf e_{1}\,\text{分量形式为列向量}.
\]

\end_inset

用黑体表示矢量，普通字体表示矢量的分量数组，拉丁下标表示具体的分量。
\end_layout

\begin_layout Corollary
当 
\begin_inset Formula $\sbf d_{i}$
\end_inset

，
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 都是单位正交基时，
\begin_inset Formula $S$
\end_inset

 是正交矩阵，即
\begin_inset Formula 
\[
S^{-1}=S^{T},\quad S_{ij}^{-1}=S_{ji}.
\]

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{c}
X\\
Y\\
Z
\end{array}\right]=\left[\begin{array}{c}
e_{1}^{T}\\
e_{2}^{T}\\
e_{3}^{T}
\end{array}\right].\left([r]-[r_{n}]\right)
\]

\end_inset

其中 
\begin_inset Formula $[r]$
\end_inset

，
\begin_inset Formula $[r_{n}]$
\end_inset

 均为列向量。在局域坐标的小范围中，如果将 
\begin_inset Formula $\sbf e_{i}$
\end_inset

 当作常矢量，则有
\begin_inset Formula 
\begin{align*}
 & \dd{X}=[e_{1}^{T}]\cdot\dd{[r]}\\
 & \dd{Y}=[e_{2}^{T}]\cdot\dd{[r]}\\
 & \dd{Z}=[e_{3}^{T}]\cdot\dd{[r]}
\end{align*}

\end_inset

从几何直观上也是可以理解的。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
Frenet 标架
\end_layout

\begin_layout Standard
ref: 
\begin_inset CommandInset href
LatexCommand href
name "Frenet 标架"
target "https://zhuanlan.zhihu.com/p/144787656"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Frenet 公式：
\begin_inset Formula 
\[
\frac{\dd}{\dd{s}}\left[\begin{array}{c}
T(s)\\
N[s]\\
B[s]
\end{array}\right]=\left[\begin{array}{ccc}
0 & \kappa(s) & 0\\
-\kappa(s) & 0 & \tau(s)\\
0 & -\tau(s) & 0
\end{array}\right]\left[\begin{array}{c}
T(s)\\
N[s]\\
B[s]
\end{array}\right]
\]

\end_inset

以弧长作为参数：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf r(t)$
\end_inset

 变成了 
\begin_inset Formula $\sbf r(s)$
\end_inset

。
\end_layout

\begin_layout Enumerate
单位切向量 
\begin_inset Formula $\sbf T$
\end_inset

：
\begin_inset Formula 
\[
\sbf T(s)=\frac{\dd{\sbf r}}{\dd{s}}=\frac{\dd{\sbf r}/\dd{t}}{\dd{s}/\dd{t}}=\frac{\sbf v}{\abs{\sbf v}}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
曲率 
\begin_inset Formula $\kappa$
\end_inset

：描述了单位切向量随着曲线的改变，也可以看成曲线偏离直线的变化率：
\begin_inset Formula 
\[
\kappa(s)=\frac{\dd{T}}{\dd{s}}=\frac{1}{\abs{\sbf v}}\frac{\dd{\sbf T}}{\dd{t}}
\]

\end_inset


\end_layout

\begin_layout Enumerate
主法向量 
\begin_inset Formula $\sbf N$
\end_inset

：指向曲线转动的方向。定义在在 
\begin_inset Formula $\kappa\neq0$
\end_inset

 的点
\begin_inset Formula 
\[
\sbf N=\frac{1}{\kappa}\frac{\dd{T}}{\dd{s}}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
次法向量：垂直于 
\begin_inset Formula $\sbf T$
\end_inset

–
\begin_inset Formula $\sbf N$
\end_inset

平面
\begin_inset Formula 
\[
\sbf B=\sbf T\times\sbf N.
\]

\end_inset


\end_layout

\begin_layout Enumerate
挠率：
\begin_inset Formula $\tau=-\frac{\dd{\sbf B}}{\dd{s}}\cdot\sbf N$
\end_inset

，代表曲线偏离 
\begin_inset Formula $\sbf T$
\end_inset

–
\begin_inset Formula $\sbf N$
\end_inset

平面的速率。和 曲线的主单位法向量
\end_layout

\begin_layout Standard
三维曲面的边界为一空间曲线，计算其边界的主法线方向需要曲率 
\begin_inset Formula $\kappa\neq0$
\end_inset

；但是在线性单元的近似下，边界上的曲率为零，所以无法计算其主法线方向。
\end_layout

\begin_layout Section
曲面上的泊松方程
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:curve3D"

\end_inset


\end_layout

\begin_layout Standard
三维曲面上的泊松方程为
\begin_inset Formula 
\[
-\nabla_{t}\cdot\varepsilon\cdot\nabla_{t}\phi=\rho
\]

\end_inset


\begin_inset Formula $\nabla_{t}$
\end_inset

 表示沿着曲面切平面的梯度。对应的有限元方程中的系数矩阵为
\begin_inset Formula 
\[
K_{ij}^{e}=\int_{\Omega^{e}}\nabla_{t}N_{i}^{e}\cdot\varepsilon\cdot\nabla_{t}N_{j}^{e}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Example
三维中的曲面的四边形单元上的雅可比矩阵（对于某一确定单元 
\begin_inset Formula $e$
\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[J\right] & =\left[{\color{blue}\begin{array}{c}
\frac{\partial\sbf r}{\partial\xi}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}
\end{array}}\right]=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\vspace{1ex}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{ccc}
\frac{\partial N_{i}^{e}}{\partial\xi}x_{i} & \frac{\partial N_{i}^{e}}{\partial\xi}y_{i} & \frac{\partial N_{i}^{e}}{\partial\xi}z_{i}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}x_{i} & \frac{\partial N_{i}^{e}}{\partial\eta}y_{i} & \frac{\partial N_{i}^{e}}{\partial\eta}z_{i}
\end{array}\right],\quad\text{重复指标求和}\\
 & =\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]
\end{align*}

\end_inset

从雅可比矩阵可以定义出局域坐标的三个方向（正交归一基）
\begin_inset Formula 
\begin{align*}
 & \sbf e_{1}=\frac{\partial\sbf r}{\partial\xi}/\abs{\frac{\partial\sbf r}{\partial\xi}}\\
 & \sbf e_{3}=\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}/\abs{\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}}\\
 & \sbf e_{2}=\sbf e_{3}\times\sbf e_{1}
\end{align*}

\end_inset

注意曲面上的两切线
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}$
\end_inset

，
\begin_inset Formula $\frac{\partial\sbf r}{\partial\eta}$
\end_inset

 不一定是正交的；网格剖分时单元面积不为零，保证了 
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}\neq0$
\end_inset

。
\end_layout

\begin_layout Example
使用局域坐标系 
\begin_inset Formula $T^{ab}=T^{ab}\left(\sbf e_{1},\sbf e_{2},\sbf e_{3}\right)$
\end_inset

 ，实现全局坐标 
\begin_inset Formula $\sbf r=\left(x,y,z\right)$
\end_inset

 到二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

的转换
\begin_inset Formula 
\[
\sbf R=T^{ab}\cdot\sbf r
\]

\end_inset


\begin_inset Formula 
\[
\sbf R=S^{-1}.\left(\sbf r-\sbf r_{n}\right),\quad S^{-1}=\left[\begin{array}{c}
\sbf e_{1}^{T}\\
\sbf e_{2}^{T}\\
\sbf e_{3}^{T}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是局域原点的全局坐标。系数矩阵计算需要的形函数的切向梯度可以在二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

下计算（参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jac2"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial X} & \frac{\partial N_{2}^{e}}{\partial X} & \frac{\partial N_{3}^{e}}{\partial X} & \frac{\partial N_{4}^{e}}{\partial X}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial Y} & \frac{\partial N_{2}^{e}}{\partial Y} & \frac{\partial N_{3}^{e}}{\partial Y} & \frac{\partial N_{4}^{e}}{\partial Y}
\end{array}\right] & =\left[\begin{array}{cc}
\frac{\partial\xi}{\partial X} & \frac{\partial\eta}{\partial X}\vspace{1ex}\\
\frac{\partial\xi}{\partial Y} & \frac{\partial\eta}{\partial Y}
\end{array}\right]\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\vspace{1ex}\\
\frac{\partial X}{\partial\eta} & \frac{\partial Y}{\partial\eta}
\end{array}\right]^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\partial\sbf r}{\partial\xi}\cdot\sbf e_{1} & \frac{\partial\sbf r}{\partial\xi}\cdot\sbf e_{2}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}\cdot\sbf e_{1} & \frac{\partial\sbf r}{\partial\eta}\cdot\sbf e_{2}
\end{array}\right]^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left(\left[\begin{array}{c}
\frac{\partial\sbf r}{\partial\xi}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}
\end{array}\right]\left[\begin{array}{cc}
\sbf e_{1} & \sbf e_{2}\end{array}\right]\right)^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]
\end{align*}

\end_inset

其中使用了
\begin_inset Formula $\dd{r}=\dd{X}\sbf e_{1}+\dd{Y}\sbf e_{2}$
\end_inset

，即矢径的微元等于切矢的微元。
\end_layout

\begin_layout Section
约定和总结
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r_{j}$
\end_inset

 表示全局坐标，三维空间自由度 
\begin_inset Formula $j\in\left\{ 1,2,3\right\} $
\end_inset

，
\begin_inset Formula $\partial_{j}$
\end_inset

 表示对全局坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\overline{x}_{\alpha}$
\end_inset

 表示有限元中的采样点（node）， 
\begin_inset Formula $\alpha\in{1,2,\cdots,N}$
\end_inset

（希腊字母），一阶三角形单元
\begin_inset Formula $3$
\end_inset

个，二阶三角形
\begin_inset Formula $6$
\end_inset

个；一阶四边形
\begin_inset Formula $4$
\end_inset

个 等等。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $x_{p}^{\prime}$
\end_inset

 表示单元中二维平面的局域空间坐标 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

，
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{p}^{\prime}$
\end_inset

 表示对局域坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\xi_{p}$
\end_inset

 表示将二维局域坐标再变换到 母坐标 
\begin_inset Formula $\left(\xi_{1},\xi_{2}\right)$
\end_inset

，或记作
\begin_inset Formula $\left(\xi,\eta\right)$
\end_inset

，平面自由度 
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

（拉丁字母）；
\begin_inset Formula $\hat{\partial}_{p}$
\end_inset

 表示对
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

求导。
\end_layout

\begin_layout Enumerate
表达式右边标出了维度。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
全局空间坐标对 母坐标的雅可比行列式
\begin_inset Formula 
\begin{equation}
J_{pj}=\hat{\partial}_{p}{\color{blue}r_{j}}=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\vspace{1ex}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}
\end{array}\right]=\hat{\partial}_{p}\,{\color{blue}N_{\alpha}\,\overline{x}_{\alpha j}},\quad[2,3]\label{eq:jacobi9}
\end{equation}

\end_inset

其中 ，对于选定的单元 
\begin_inset Formula $N_{\alpha}$
\end_inset

 形式已知，
\begin_inset Formula $\overline{x}_{\alpha j}$
\end_inset

 是节点坐标为已知常量，所以 
\begin_inset Formula $J_{pj}$
\end_inset

 可以直接求得，维数是 
\begin_inset Formula $2\times3$
\end_inset

。
\end_layout

\begin_layout Enumerate
局域空间坐标的三个单位正交基
\begin_inset Formula 
\begin{align*}
\sbf e_{1} & =J_{1\cdot}/\abs{J_{1\cdot}},\quad\text{点表示取整列}\\
\sbf e_{3} & =J_{1\cdot}\times J_{2\cdot}/\abs{J_{1\cdot}\times J_{2\cdot}},\\
\sbf e_{2} & =\sbf e_{3}\times\sbf e_{1}.
\end{align*}

\end_inset

之所以按此序列构造，是为了保证 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

 是相互垂直的。求出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi9"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $J_{pj}$
\end_inset

，即可求出每个单元所属的 
\begin_inset Formula $\sbf e_{j}$
\end_inset

。可以把 
\begin_inset Formula $\left\{ \sbf e_{j}\right\} $
\end_inset

的分量写成数组形式（矩阵）。分量数组用普通字体表示，将 
\begin_inset Formula $[e_{i}]$
\end_inset

分别填入
\color blue
每列
\color inherit

\begin_inset Formula 
\begin{equation}
E_{ij}=\left[\begin{array}{ccc}
\vdots & \vdots & \vdots\\
e_{1} & e_{2} & e_{3}\\
\vdots & \vdots & \vdots
\end{array}\right],\quad[3,3]\label{eq:unitVector}
\end{equation}

\end_inset

则 指标
\begin_inset Formula $1$
\end_inset

索引 基矢的分量，指标
\begin_inset Formula $2$
\end_inset

索引 基矢的编号。
\end_layout

\begin_layout Enumerate
局域空间坐标 对 母坐标的 雅可比矩阵：
\begin_inset Formula 
\begin{equation}
L_{pq}=\hat{\partial}_{p}x_{q}^{\prime}=\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\vspace{1ex}\\
\frac{\partial X}{\partial\eta} & \frac{\partial Y}{\partial\eta}
\end{array}\right]=J_{pj}\,E_{jq},\quad[2,2]\label{eq:jacobi3}
\end{equation}

\end_inset


\begin_inset Formula $p,q\in\{1,2\}$
\end_inset

， 
\begin_inset Formula $J$
\end_inset

 和 
\begin_inset Formula $E$
\end_inset

 分别在 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi9"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:unitVector"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中求出。注意使用 
\begin_inset Formula $E$
\end_inset

 时只需取前
\begin_inset Formula $[2\times2]$
\end_inset

。
\end_layout

\begin_layout Enumerate
形函数 对 局域空间坐标 的梯度
\begin_inset Formula 
\[
{\color{blue}\partial_{p}^{\prime}}\,N_{\alpha}={\color{blue}L_{pq}^{-1}\,\hat{\partial}_{q}}N_{\alpha},\quad[2,N]
\]

\end_inset

其中
\begin_inset Formula $N$
\end_inset

是节点的数目，
\begin_inset Formula $L^{-1}$
\end_inset

是 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi3"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的逆。至此，
\begin_inset Formula $\nabla_{t}N_{i}^{e}$
\end_inset

已经求出。
\end_layout

\begin_layout Enumerate
计算均在
\begin_inset Formula $\xi\text{–}\eta$
\end_inset

参数坐标平面进行，即坐标变换步骤为 全局系的曲面
\begin_inset Formula $\Rightarrow$
\end_inset

局域系的平面
\begin_inset Formula $\Rightarrow$
\end_inset

参数系平面。最后需要在 
\begin_inset Formula $\xi$
\end_inset

–
\begin_inset Formula $\eta$
\end_inset

 参数系平面，用高斯积分法计算积分：
\begin_inset Formula 
\[
\iint_{\Omega^{\prime e}}F\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{X}\dd{Y}=\sum_{i=1}^{m}F\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset

与平直面元的区别是，现在 
\begin_inset Formula $\det[J]$
\end_inset

=
\begin_inset Formula $\frac{\partial(X,Y)}{\partial\left(\xi,\eta\right)}$
\end_inset

 在每个高斯点上可以不同。
\begin_inset Formula $\det[J]$
\end_inset

 在几何上等于局域基矢 
\begin_inset Formula $\{\frac{\partial\sbf r}{\partial\xi},\frac{\partial\sbf r}{\partial\eta}\}$
\end_inset

 架设的四边形的面积；在程序中此面积可直接用 
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}$
\end_inset

 计算。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Chapter
介电屏蔽条件
\end_layout

\begin_layout Section
介电屏蔽边界条件
\end_layout

\begin_layout Standard
电介质在外加电场
\begin_inset Formula $\sbf E_{0}$
\end_inset

下会产生极化电荷，假设电场线垂直于介质界面，根据
\begin_inset Formula $\sbf D$
\end_inset

法向在界面连续：
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\sbf E_{0}=\varepsilon\sbf E\quad\Rightarrow\quad{\color{blue}\sbf E=\frac{\epsilon_{0}}{\varepsilon}\sbf E_{0}}\\
 & \Delta\sbf E=\sbf E-\sbf E_{0}=\left(\frac{\epsilon_{0}}{\varepsilon}-1\right)\sbf E_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate

\color blue
即极化电荷产生与原外加电场反向的电场，削弱原场
\color inherit
。
\begin_inset Formula $\varepsilon$
\end_inset

越大，效果越明显，理想导体可以理解为 
\begin_inset Formula $\varepsilon\to\infty$
\end_inset

。
\end_layout

\begin_layout Enumerate
在理想导体的情况下，电场被完全屏蔽，导体内部无电场。在高
\begin_inset Formula $\varepsilon$
\end_inset

材料的情况下，会残余一丢丢电场。
\end_layout

\begin_layout Enumerate
在理想导体的情况下，电场线是垂直于导体表面的；在高
\begin_inset Formula $\varepsilon$
\end_inset

材料的情况下，材料表面的
\begin_inset Formula $\sbf E$
\end_inset

会与法向
\begin_inset Formula $\sbf n$
\end_inset

 略有偏离。
\end_layout

\begin_layout Example
一种理解方式
\end_layout

\begin_layout Enumerate
在高
\begin_inset Formula $\varepsilon$
\end_inset

介质表面求解电势分布，在界面附近，假设 
\begin_inset Formula $\sbf D_{n}$
\end_inset

 变化不大，在 
\begin_inset Formula $\nabla^{2}$
\end_inset

算子中忽略法向的贡献，只关注切向的变化。
\end_layout

\begin_layout Enumerate
表面微元上的面电荷密度是 
\begin_inset Formula $\sbf n\cdot\sbf D$
\end_inset

，
\begin_inset Formula 
\[
\sbf n\cdot\sbf D=-\nabla_{t}\cdot\left(d\,\epsilon_{0}\epsilon_{r}\cdot\nabla_{t}\phi\right)
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
另一种推导方式
\end_layout

\begin_layout Standard
选取适当的曲面坐标系，令曲线微元的表达式形如
\begin_inset Formula 
\[
\dd{\ell_{1}}=1\dd{u_{1}},\quad\dd{\ell_{2}}=1\dd{u_{2}},\quad\dd{\ell_{3}}=d\dd{u_{3}},
\]

\end_inset

假设介质中没有自由电荷，即 
\begin_inset Formula $\nabla\cdot\sbf D=0$
\end_inset

，按照公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:shI.30"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\nabla_{n}D_{n}=0
\]

\end_inset

假设 
\begin_inset Formula $d$
\end_inset

 非常小，为一薄层，
\begin_inset Formula $u_{3}$
\end_inset

变化单位长度
\begin_inset Formula $1$
\end_inset

，对应的 
\begin_inset Formula $\dd{\ell_{3}}=d$
\end_inset

 在实际中仍然是很小的尺度，把导数近似为差商；并认为由于高
\begin_inset Formula $\epsilon_{r}$
\end_inset

介质的屏蔽作用，薄层另一侧
\begin_inset Formula $\sbf D\approx0$
\end_inset

，给出
\begin_inset Formula 
\[
\nabla_{n}D_{n}\Rightarrow\frac{\sbf n\cdot\sbf D-\sbf n\cdot0}{1}=\sbf n\cdot\sbf D
\]

\end_inset

因此有
\begin_inset Formula 
\begin{equation}
\nabla_{t}\cdot\left(d\epsilon_{0}\sbf E_{t}\right)+\sbf n\cdot\epsilon_{0}\sbf E=0\label{eq:screen}
\end{equation}

\end_inset


\color blue

\begin_inset Formula $\sbf n$
\end_inset

 是法线方向，从高
\begin_inset Formula $\epsilon_{r}$
\end_inset

介质指向低
\begin_inset Formula $\epsilon_{0}$
\end_inset

介质
\color inherit
，
\begin_inset Formula $\epsilon_{0}$
\end_inset

是低介电材料的常数。
\end_layout

\begin_layout Subsection
存在的问题
\end_layout

\begin_layout Enumerate
推导过程需要用到 分部积分/高斯公式，对于曲面，或者曲线上的场，公式是否仍然成立，正确的形式是什么。
\end_layout

\begin_layout Enumerate
对于封闭的边界，如封闭曲面，或者封闭曲线，找不到边界，该如何应用分部积分，或者高斯公式。
\end_layout

\begin_layout Section
例：介电屏蔽的解析解
\end_layout

\begin_layout Enumerate
开放空间的均匀介质
\begin_inset Formula $\epsilon_{3}$
\end_inset

中，有一导体球壳
\begin_inset Formula $\epsilon_{2}$
\end_inset

，内部电介常数为
\begin_inset Formula $\epsilon_{1}$
\end_inset

，厚度为
\begin_inset Formula $d$
\end_inset

；
\end_layout

\begin_layout Enumerate
空间中存在均匀电场
\begin_inset Formula $\sbf E_{0}$
\end_inset

，求空间电场分布。
\end_layout

\begin_layout Enumerate
选取球坐标系，
\begin_inset Formula $z$
\end_inset

轴正向同
\begin_inset Formula $\sbf E_{0}$
\end_inset

方向，到内外球壳的半径分别为 
\begin_inset Formula $R_{1}$
\end_inset

，
\begin_inset Formula $R_{2}$
\end_inset

；
\end_layout

\begin_layout Standard
从球壳内到外部，电势依次为 
\begin_inset Formula $1,2,3$
\end_inset

；全部定解条件为：
\begin_inset Formula 
\begin{align*}
 & \nabla^{2}\varphi_{1}=0,\quad\nabla^{2}\varphi_{2}=0,\quad\nabla^{2}\varphi_{3}=0.\\
 & r=0:\quad\varphi_{1}=0\\
 & r\to\infty:\quad\varphi_{3}\to-E_{0}R\cos\theta,\quad\text{渐近条件}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
 & r=R_{1}:\quad\varphi_{1}\left(R_{1}\right)=\varphi_{2}\left(R_{1}\right),\quad\left.\varepsilon_{1}\frac{\partial\varphi_{1}}{\partial r}\right|_{R_{1}}=\left.\varepsilon_{2}\frac{\partial\varphi_{2}}{\partial r}\right|_{R_{1}}\\
 & r=R_{2}:\quad\varphi_{2}\left(R_{2}\right)=\varphi_{3}\left(R_{2}\right),\quad\left.\varepsilon_{2}\frac{\partial\varphi_{1}}{\partial r}\right|_{R_{2}}=\left.\varepsilon_{3}\frac{\partial\varphi_{2}}{\partial r}\right|_{R_{2}}
\end{align*}

\end_inset

根据渐近条件，假设解的形式：
\begin_inset Formula 
\begin{align*}
 & \varphi_{1}\left(r\right)=\sum_{n=1}^{\infty}a_{n}r^{n}P_{n}\left(\cos\theta\right),\quad\text{电势零点约定为}0\\
 & \varphi_{2}\left(r\right)=\sum_{n=0}^{\infty}\left(b_{n}r^{n}+\frac{c_{n}}{r^{n+1}}\right)P_{n}\left(\cos\theta\right)\\
 & \varphi_{3}\left(r\right)=d_{0}-E_{0}r\cos\theta+\sum_{n=0}^{\infty}\frac{e_{n}}{r^{n+1}}P_{n}\left(\cos\theta\right)
\end{align*}

\end_inset

代入边界条件，边界条件1–2：
\begin_inset Formula 
\begin{align}
n=0:\quad & 0=b_{0}+\frac{c_{0}}{R_{1}},\quad\varepsilon_{2}\frac{-c_{0}}{R_{1}}=0\nonumber \\
n\ge1:\quad & a_{n}R_{1}^{2n+1}=b_{n}R_{1}^{2n+1}+c_{n}\label{eq:my1}\\
n\ge1:\quad & a_{n}R_{1}^{2n+1}=\frac{\varepsilon_{2}}{\varepsilon_{1}}\left(b_{n}R_{1}^{2n+1}+\frac{-(n+1)}{n}c_{n}\right)\nonumber 
\end{align}

\end_inset

容易看出
\begin_inset Formula 
\[
a_{0}=b_{0}=c_{0}=0
\]

\end_inset

边界条件2–3：
\begin_inset Formula 
\begin{align*}
n=0:\quad & d_{0}+\frac{e_{0}}{R_{2}}=0,\quad\epsilon_{3}\frac{-e_{0}}{R_{2}^{2}}=0\\
n=1:\quad & ,b_{1}R_{2}+\frac{c_{1}}{R_{2}^{2}}=-E_{0}R_{2}+\frac{e_{1}}{R_{2}^{2}},\quad b_{1}+\frac{-2c_{1}}{R_{2}^{3}}=\frac{\epsilon_{3}}{\epsilon_{2}}\left(-E_{0}+\frac{-2e_{1}}{R_{2}^{3}}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align}
n\ge2:\quad & b_{n}R_{2}^{2n+1}+c_{n}=e_{n}\label{eq:my2}\\
n\ge2:\quad & b_{n}R_{2}^{2n+1}+\frac{-\left(n+1\right)}{n}c_{n}=\frac{\epsilon_{3}}{\epsilon_{2}}\frac{-\left(n+1\right)}{n}e_{n}\nonumber 
\end{align}

\end_inset

容易看出
\begin_inset Formula 
\[
d_{0}=e_{0}=0
\]

\end_inset

联立
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my2"
plural "false"
caps "false"
noprefix "false"

\end_inset

给出，当 
\begin_inset Formula $n\ge2$
\end_inset

时：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
equ = { an*R1^(2 n + 1) == bn*R1^(2 n + 1) + cn, an*R1^(2 n + 1) == 
\backslash
[CurlyEpsilon]2/
\backslash
[CurlyEpsilon]1 (bn* R1^(2 n + 1) + (-n - 1)/n cn), bn*R2^(2 n + 1) + cn
 == en, bn*R2^(2 n + 1) + (-n - 1)/ n cn == 
\backslash
[CurlyEpsilon]3/
\backslash
[CurlyEpsilon]2 ((-n - 1)/n en) }; Solve[equ, {an, bn, cn, en}]
\end_layout

\end_inset


\begin_inset Formula 
\[
a_{n}=0,\quad b_{n}=0,\quad c_{n}=0,\quad e_{n}=0,\quad n\ge2
\]

\end_inset

当
\begin_inset Formula $n=1$
\end_inset

时：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
equ = { a1*R1^3 == b1*R1^3 + c1, a1*R1^3 == 
\backslash
[Epsilon]2/
\backslash
[Epsilon]1 (b1*R1^3 + (-2) c1), b1*R2 + c1/R2^2 == -Subscript[
\backslash
[CapitalEpsilon], 0] R2 + e1/R2^2, b1 + (-2 c1)/ R2^3 == 
\backslash
[Epsilon]3/
\backslash
[Epsilon]2 (-Subscript[
\backslash
[CapitalEpsilon], 0] + (-2 e1)/R2^3) }; ans = First@Solve[equ, {a1, b1,
 c1, e1}] // Simplify; rule = {R2 -> Subscript[R, 2], R1 -> Subscript[R,
 1], 
\backslash
[Epsilon]2 -> Subscript[
\backslash
[Epsilon], 2], 
\backslash
[Epsilon]1 -> Subscript[
\backslash
[Epsilon], 1], 
\backslash
[Epsilon]3 -> Subscript[
\backslash
[Epsilon], 3]}; ans /.
 rule
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
 & a_{1}=-\frac{9R_{2}^{3}\epsilon_{2}\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & b_{1}=-\frac{3R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & c_{1}=\frac{3R_{1}^{3}R_{2}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & e_{1}=\frac{R_{2}^{3}\left(R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(2\epsilon_{2}+\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)\right)}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
简化情形
\end_layout

\begin_layout Standard
如果令 
\begin_inset Formula $\epsilon_{1}=\epsilon_{3}$
\end_inset

，即球壳内外具有相同的
\begin_inset Formula $\varepsilon$
\end_inset

，则化简为：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(ans2 = Simplify[ans /.
 {
\backslash
[Epsilon]3 -> 
\backslash
[Epsilon]1}]) /.
 rule; (ans3 = Simplify[ ans2 /.
 {
\backslash
[Epsilon]2 -> (S + 
\backslash
[CapitalDelta]), 
\backslash
[Epsilon]1 -> (S 
\backslash
 - 
\backslash
[CapitalDelta])}]) /.
 rule
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
 & a_{1}=-\frac{9E_{0}R_{2}^{3}(S-\Delta)(\Delta+S)}{R_{2}^{3}\left(9S^{2}-\Delta^{2}\right)-8\Delta^{2}R_{1}^{3}},\\
 & b_{1}=-\frac{3E_{0}R_{2}^{3}(S-\Delta)(\Delta+3S)}{R_{2}^{3}\left(9S^{2}-\Delta^{2}\right)-8\Delta^{2}R_{1}^{3}},\\
 & c_{1}=\frac{6\Delta E_{0}R_{1}^{3}R_{2}^{3}(S-\Delta)}{8\Delta^{2}R_{1}^{3}+R_{2}^{3}\left(\Delta^{2}-9S^{2}\right)},\\
 & e_{1}=-\frac{2\Delta E_{0}R_{2}^{3}\left(R_{2}^{3}-R_{1}^{3}\right)(\Delta+3S)}{8\Delta^{2}R_{1}^{3}+R_{2}^{3}\left(\Delta^{2}-9S^{2}\right)},
\end{align*}

\end_inset

其中 
\begin_inset Formula $S=(\epsilon_{1}+\epsilon_{2})/2$
\end_inset

， 
\begin_inset Formula $\Delta=(\epsilon_{2}-\epsilon_{1})/2$
\end_inset

。
\end_layout

\begin_layout Standard
如果进一步取 
\begin_inset Formula $\delta=\epsilon_{1}/\epsilon_{2}\rightarrow0$
\end_inset

 的极限：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify[Normal@ Series[Values@ ans2 /.
 {
\backslash
[Epsilon]1 -> 
\backslash
[Delta]*
\backslash
[Epsilon]2}, {
\backslash
[Delta], 0, 1}] /.
 rule]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
a_{1} & =\frac{9\delta E_{0}R_{2}^{3}}{2R_{1}^{3}-2R_{2}^{3}},\\
b_{1} & =\frac{3\delta E_{0}R_{2}^{3}}{R_{1}^{3}-R_{2}^{3}},\quad c_{1}=\frac{3\delta E_{0}R_{1}^{3}R_{2}^{3}}{2\left(R_{1}^{3}-R_{2}^{3}\right)},\\
e_{1} & =\frac{1}{2}E_{0}R_{2}^{3}\left(\frac{3\delta\left(R_{1}^{3}+2R_{2}^{3}\right)}{R_{1}^{3}-R_{2}^{3}}+2\right)
\end{align*}

\end_inset

代入电势的表达式得到：
\begin_inset Formula 
\begin{align*}
 & \varphi_{1}\left(r\right)=a_{1}r\cos\theta\\
 & \varphi_{2}\left(r\right)=\left(b_{1}r+c_{1}\frac{1}{r^{2}}\right)\cos\theta\\
 & \varphi_{3}\left(r\right)=\left(-E_{0}r+e_{1}\frac{1}{r^{2}}\right)\cos\theta
\end{align*}

\end_inset

如果令
\begin_inset Formula $R_{2}=\left(1+t\right)R_{1}$
\end_inset

，展开到
\begin_inset Formula $\left(\delta^{1},t^{1}\right)$
\end_inset

和
\begin_inset Formula $\left(\delta^{1},t^{0}\right)$
\end_inset

阶的结果分别是
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify[Normal@ Series[Values@ans2 /.
 {
\backslash
[Epsilon]1 -> 
\backslash
[Delta]*
\backslash
[Epsilon]2, R2 -> R1 (1 + t)} , {
\backslash
[Delta], 0, 1}, {t, 0, 0} ] /.
 rule]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
a_{1} & =-\frac{\delta E_{0}\left(2t^{2}+6t+3\right)}{2t}\approx-\frac{3\delta E_{0}(2t+1)}{2t},\\
b_{1} & =-\frac{\delta E_{0}\left(2t^{2}+6t+3\right)}{3t}\approx-\frac{\delta E_{0}(2t+1)}{t}\\
c_{1} & =-\frac{\delta E_{0}R_{1}^{3}\left(2t^{2}+6t+3\right)}{6t}\approx-\frac{\delta E_{0}R_{1}^{3}(2t+1)}{2t},\\
e_{1} & =\frac{E_{0}R_{1}^{3}\left(-3\delta+(6-20\delta)t^{2}+(2-12\delta)t\right)}{2t}\approx-\frac{E_{0}R_{1}^{3}(3\delta+2(6\delta-1)t)}{2t}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
电势和电场图像
\end_layout

\begin_layout Standard
电势的图像如下，可以看到中心处的电势接近于零。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(*dielectric, radius*) 
\backslash
[Epsilon]1 = 1; 
\backslash
[Epsilon]2 = 500; R1 = 1; R2 = 1.06; R3 = 2; E0 = 10; (*potential coeffcients*)
 S = (
\backslash
[Epsilon]1 + 
\backslash
[Epsilon]2)/ 2; 
\backslash
[CapitalDelta] = (
\backslash
[Epsilon]2 - 
\backslash
[Epsilon]1)/2; a1 = -((9 E0*R2^3 (S - 
\backslash
[CapitalDelta]) (S + 
\backslash
[CapitalDelta]))/( R2^3 (9 S^2 - 
\backslash
[CapitalDelta]^2) - 8 
\backslash
[CapitalDelta]^2 R1^3)); b1 = -((3 E0*R2^3 (S - 
\backslash
[CapitalDelta]) (
\backslash
[CapitalDelta] + 3 S))/( R2^3 (9 S^2 - 
\backslash
[CapitalDelta]^2) - 8 
\backslash
[CapitalDelta]^2 R1^3)); c1 = (6 
\backslash
[CapitalDelta]*E0*R1^3*R2^3 (S - 
\backslash
[CapitalDelta]))/( 8 
\backslash
[CapitalDelta]^2*R1^3 + R2^3 (
\backslash
[CapitalDelta]^2 - 9 S^2)); e1 = -((2 
\backslash
[CapitalDelta]*E0* R2^3 (R2^3 - R1^3) (
\backslash
[CapitalDelta] + 3 S))/( 8 
\backslash
[CapitalDelta]^2*R1^3 + R2^3 (
\backslash
[CapitalDelta]^2 - 9 S^2))); (*electric potential*) potE[{r_, 
\backslash
[Theta]_, 
\backslash
[Phi]_}] := -Piecewise[{ {a1*r*Cos[
\backslash
[Theta]], 0 < r <= R1}, {(b1*r + c1/r^2)*Cos[
\backslash
[Theta]], R1 < r <= R2}, {(-E0*r + e1/r^2)*Cos[
\backslash
[Theta]], R2 < r} }]; fig1 = DensityPlot[ potE@ToSphericalCoordinates[{0,
 y, z}] , {y, -2, 2}, {z, -2, 2} , ColorFunction -> "Rainbow" , AspectRatio
 -> 1, ImageSize -> 165, PlotLegends -> Automatic ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/jieDianPingBi1.png
	scale 80

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
电势云图，外加电场
\begin_inset Formula $\sbf E=10\,\mathrm{V/m}$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
电场强度
\end_layout

\begin_layout Standard
根据电势表达式和球坐标 梯度表达式可以求出电场强度的表达式：
\begin_inset Formula 
\[
\nabla\phi=\partial_{r}\phi\sbf e_{r}+\frac{1}{r}\partial_{\theta}\phi\sbf e_{\theta}+\frac{1}{r\sin\theta}\partial_{\theta}\phi\sbf e_{\phi}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
-\nabla\varphi_{1} & =-a_{1}\left(\cos\theta\sbf e_{r}-\sin\theta\sbf e_{\theta}\right)\\
-\nabla\varphi_{2} & =-\frac{1}{r^{3}}\left[\left(b_{1}r^{3}-2c_{1}\right)\cos\theta\sbf e_{r}-\left(b_{1}r^{3}+c_{1}\right)\sin\theta\sbf e_{\theta}\right]\\
-\nabla\varphi_{3} & =-\frac{1}{r^{3}}\left[-\left(E_{0}r^{3}+2e_{1}\right)\cos\theta\sbf e_{r}+\left(E_{0}r^{3}-e_{1}\right)\sin\theta\sbf e_{\theta}\right]
\end{align*}

\end_inset

电场强度
\begin_inset Formula $\sbf E$
\end_inset

在界面处的分布如下，可以看到中间的电场强度也接近于零。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
vecE[{x_, y_, z_}] := Evaluate[Simplify@TransformedField[ "Spherical" ->
 "Cartesian", Simplify@ Grad[-potE[{r, 
\backslash
[Theta], 
\backslash
[Phi]}], {r, 
\backslash
[Theta], 
\backslash
[Phi]}, "Spherical"], {r, 
\backslash
[Theta], 
\backslash
[Phi]} -> {x, y, z}]]; fig2 = VectorPlot[ Rest@vecE@{10^-9, y, z} , {y,
 -1.2, 1.2}, {z, -1.2, 1.2} , VectorPoints -> {18, 18} , ImageSize -> Medium
 ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/jieDianPingBi2.png
	scale 80

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
电场强度在介质界面处的分布
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Ritz方法
\end_layout

\begin_layout Standard
综上，当存在介电常数相差较大的两种材料，高
\begin_inset Formula $\varepsilon$
\end_inset

的材料形成一个薄层。则在高
\begin_inset Formula $\varepsilon$
\end_inset

壳的表面，应满足以下边界条件：
\begin_inset Formula 
\[
\sbf e_{n}\cdot\sbf D+\nabla_{t}\cdot\left(d\sbf D_{t}\right)=0,
\]

\end_inset

其中
\begin_inset Formula $d$
\end_inset

是界面薄层的厚度，
\begin_inset Formula $\sbf D=\varepsilon\sbf E$
\end_inset

。
\end_layout

\begin_layout Example
考虑三维情形。设求解区域为
\begin_inset Formula $\Omega$
\end_inset

，
\begin_inset Formula $\Omega$
\end_inset

的边界曲面记作
\begin_inset Formula $\Gamma=\partial\Omega$
\end_inset

，
\begin_inset Formula $\Gamma$
\end_inset

的边界曲线记作
\begin_inset Formula $C=\partial\Gamma$
\end_inset

。通常情况下，静电场的泊松方程的泛函写作
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}\left(\phi^{e}\right) & =\frac{1}{2}\int_{\Omega^{e}}\left[(\nabla\phi^{e})\cdot\epsilon_{0}\cdot(\nabla\phi^{e})+\beta\phi^{e;2}-f\phi^{e}\right]\dd{\Omega}\\
 & =\frac{1}{2}\int_{\Omega^{e}}\left[-\phi^{e}\cdot(\epsilon_{0}\nabla^{2})\phi^{e}+\beta\phi^{e;2}-f\phi^{e}\right]\dd{\Omega}+{\color{blue}\int_{\Gamma^{s}}\phi^{s}\,\sbf e_{n}\cdot(\epsilon_{0}\cdot\nabla\phi^{s})\dd{\Gamma}}
\end{align*}

\end_inset


\begin_inset Formula ${\color{blue}\int_{\Gamma^{e}}\cdots\dd{\Gamma}}$
\end_inset

 给出边界条件项，
\begin_inset Formula $\phi^{s}$
\end_inset

表示边界曲面
\begin_inset Formula $\Gamma$
\end_inset

上的场。
\color blue

\begin_inset Formula $\sbf e_{n}$
\end_inset

 是法线方向，指向求解区域外侧
\color inherit
（从低
\begin_inset Formula $\varepsilon$
\end_inset

指向高
\begin_inset Formula $\varepsilon$
\end_inset

）。为了加上介电屏蔽条件，在边界曲面
\begin_inset Formula $\Gamma$
\end_inset

上添加一项：
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{s}\left(\phi^{s}\right) & =\frac{1}{2}\int_{\Gamma^{s}}\left[(\nabla_{t}\phi^{s})\cdot d\varepsilon\cdot(\nabla_{t}\phi^{s})\right]\dd{\Gamma}\\
 & ={\color{blue}-\frac{1}{2}\int_{\Gamma^{s}}\left[\phi^{s}\,(\nabla_{t}\cdot d\epsilon_{0}\nabla_{t})\,\phi^{s}\right]\dd{\Gamma}}+{\color{brown}\int_{C^{\ell}}\phi^{\ell}\,\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})\dd{C}}
\end{align*}

\end_inset

其中：
\begin_inset Formula $\nabla_{t}$
\end_inset

表示沿着曲面切向的导数，即曲面上的局部坐标基矢
\begin_inset Formula $(\partial_{x},\partial_{y})$
\end_inset

；
\begin_inset Formula $\sbf e_{n}^{\ell}$
\end_inset

 是曲线
\begin_inset Formula $C$
\end_inset

的法向单位矢量。此外，上式使用了“曲面上的格林公式”
\begin_inset Formula $\int_{\Gamma}\left(\frac{\partial Q}{\partial x}-\frac{\partial P}{\partial y}\right)\dd{x}\dd{y}=\oint_{C}P\dd{x}+Q\dd{y}$
\end_inset

。
\end_layout

\begin_layout Example
如此，
\begin_inset Formula $\mathcal{F}^{e}\left(\phi^{e}\right)+\mathcal{F}^{s}\left(\phi^{s}\right)$
\end_inset

 的变分，将给出对应的电势场方程和边界条件为
\begin_inset Formula 
\begin{align}
-\nabla\cdot\left(\epsilon_{0}\nabla\phi\right)+\beta\phi=f\nonumber \\
{\color{blue}\sbf e_{n}\cdot(\epsilon_{0}\cdot\nabla\phi^{s})-(\nabla_{t}\cdot d\epsilon_{0}\nabla_{t})\,\phi^{s}=0} & \quad\text{在交界曲面上}\label{eq:di-screen3}\\
\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})=0 & \quad\text{在曲面的边界上}\nonumber 
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:di-screen3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的负号，是由于约定与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:screen"
plural "false"
caps "false"
noprefix "false"

\end_inset

相反；
\begin_inset Formula $\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})=0$
\end_inset

 类似于自然边界条件，物理含义是：在交界面的某边界线
\begin_inset Formula $C$
\end_inset

上，电位移
\begin_inset Formula $\sbf D$
\end_inset

沿曲线的法向分量为零（此法线平行主法线
\begin_inset Formula $\sbf N$
\end_inset

，后者指向曲线的转动方向）。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
考虑二维情形。设求解区域为
\begin_inset Formula $\Gamma$
\end_inset

，
\begin_inset Formula $\Gamma$
\end_inset

的边界曲线记作
\begin_inset Formula $C=\partial\Gamma$
\end_inset

，
\begin_inset Formula $C$
\end_inset

的两个端点记作
\begin_inset Formula $p_{1}$
\end_inset

，
\begin_inset Formula $p_{2}$
\end_inset

。通常情况下，静电场的泊松方程的泛函写作
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{s}\left(\phi^{s}\right) & =\frac{1}{2}\int_{\Gamma^{s}}\left[(\nabla\phi^{s})\cdot\epsilon_{0}\cdot(\nabla\phi^{s})+\beta\phi^{s;2}-f\phi^{s}\right]\dd{\Gamma}\\
 & =\frac{1}{2}\int_{\Gamma^{s}}\left[-\phi^{s}\cdot(\epsilon_{0}\nabla^{2})\phi^{s}+\beta\phi^{s;2}-f\phi^{s}\right]\dd{\Gamma}+{\color{blue}\int_{C^{\ell}}\phi^{\ell}\,\sbf e_{n}^{\ell}\cdot(\epsilon_{0}\cdot\nabla\phi^{\ell})\dd{C}}
\end{align*}

\end_inset

其中
\begin_inset Formula $\nabla=(\partial_{x},\partial_{y})$
\end_inset

是二维平面上的梯度算符。
\begin_inset Formula ${\color{blue}\int_{C^{\ell}}\cdots\dd{C}}$
\end_inset

 给出边界条件项，
\begin_inset Formula $\phi^{\ell}$
\end_inset

表示边界曲线
\begin_inset Formula $C$
\end_inset

上的场，
\begin_inset Formula $\sbf e_{n}^{\ell}$
\end_inset

 是曲线
\begin_inset Formula $C$
\end_inset

的法向单位矢量，
\color blue
指向求解区域外侧
\color inherit
（从低
\begin_inset Formula $\varepsilon$
\end_inset

指向高
\begin_inset Formula $\varepsilon$
\end_inset

）。为了加上介电屏蔽条件，在边界曲线
\begin_inset Formula $C$
\end_inset

上添加一项：
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{\ell}\left(\phi^{\ell}\right) & =\frac{1}{2}\int_{C^{\ell}}\left[(\partial_{t}\phi^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}\phi^{\ell})\right]\dd{C}\\
 & =-{\color{blue}\frac{1}{2}\int_{C^{\ell}}\left[\phi^{\ell}\,\left(\partial_{t}\cdot d\epsilon_{0}\,\partial_{t}\right)\,\phi^{\ell}\right]\dd{C}}+{\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}
\end{align*}

\end_inset

其中：
\begin_inset Formula $\partial_{t}$
\end_inset

表示沿曲线
\begin_inset Formula $C$
\end_inset

切向的导数，
\begin_inset Formula $\partial_{t}\phi^{\ell}$
\end_inset

为实数。若曲线
\begin_inset Formula $C=C(t)$
\end_inset

（即以
\begin_inset Formula $t$
\end_inset

为参数），则
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\phi^{\ell}=\frac{\dd{x^{\mu}(t)}}{\dd{t}}\frac{\partial}{\partial x^{\mu}}\phi^{\ell},\quad x^{\mu}=x,y.
\]

\end_inset

表达式
\begin_inset Formula $\int_{C^{\ell}}\cdots\dd{C}$
\end_inset

可以参数化为对
\begin_inset Formula $t$
\end_inset

的积分。所以通过分部积分，多出一个端点项。
\end_layout

\begin_layout Example
如此，
\begin_inset Formula $\mathcal{F}^{s}\left(\phi^{s}\right)+\mathcal{F}^{\ell}\left(\phi^{\ell}\right)$
\end_inset

 的变分，将给出对应的电势场方程和边界条件为
\begin_inset Formula 
\begin{align}
-\nabla\cdot\left(\epsilon_{0}\nabla\phi\right)+\beta\phi=f\nonumber \\
{\color{blue}\sbf e_{n}^{\ell}\cdot(\epsilon_{0}\cdot\nabla\phi^{\ell})-\left(\partial_{t}\cdot d\epsilon_{0}\,\partial_{t}\right)\,\phi^{\ell}=0} & \quad\text{在交界曲线上}\label{eq:di-screen2}\\
{\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}=0 & \quad\text{在曲线的端点}\nonumber 
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:di-screen2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的负号，是由于约定与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:screen"
plural "false"
caps "false"
noprefix "false"

\end_inset

相反。如果曲线
\begin_inset Formula $C$
\end_inset

是闭合的，则认为
\begin_inset Formula ${\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}=0$
\end_inset

总是满足的？
\end_layout

\begin_layout Section
具体公式–二维
\end_layout

\begin_layout Standard
所以综上，需要在交界面的泛函 
\begin_inset Formula $\mathcal{F}^{\ell}\left(\phi^{\ell}\right)$
\end_inset

 中添加一项 
\begin_inset Formula $-\frac{1}{2}\int_{C^{\ell}}\left[(\partial_{t}\phi^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}\phi^{\ell})\right]\dd{C}$
\end_inset

。其中 
\begin_inset Formula $\partial_{t}$
\end_inset

 表示沿曲线切向的方向导数。对应的有限元方程中的系数矩阵为（
\begin_inset Formula $1/2$
\end_inset

在作变分时去掉）
\begin_inset Formula 
\[
K_{ij}^{\ell}=-\int_{C^{\ell}}(\partial_{t}N_{i}^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}N_{j}^{\ell})\dd{C}.
\]

\end_inset


\end_layout

\begin_layout Subsection
雅可比矩阵
\end_layout

\begin_layout Example
参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:curve3D"
plural "false"
caps "false"
noprefix "false"

\end_inset

。以二维平面中的曲线的线性单元为例，雅可比矩阵
\begin_inset Formula $J$
\end_inset

为（对于某一确定单元 
\begin_inset Formula $e$
\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[J\right]_{1\times2} & =\left[{\color{blue}\begin{array}{c}
\frac{\dd{\sbf r}}{\dd{\xi}}\end{array}}\right]=\left[\begin{array}{cc}
\frac{\dd{x}}{\dd{\xi}} & \frac{\dd{y}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\dd{N_{i}^{e}}}{\dd{\xi}}x_{i} & \frac{\dd{N_{i}^{e}}}{\dd{\xi}}y_{i}\end{array}\right],\quad\text{重复指标求和}\\
 & =\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}
\end{array}\right]
\end{align*}

\end_inset

注意 
\begin_inset Formula $x$
\end_inset

，
\begin_inset Formula $y$
\end_inset

并不是独立的，因为曲线是一维的。代入一阶单元表达式
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{1-\xi}{2},\quad N_{2}^{(1)}=\frac{1+\xi}{2},
\]

\end_inset

 得到
\begin_inset Formula 
\begin{align*}
\left[J\right]_{1\times2} & =\frac{1}{2}\left[\begin{array}{cc}
-1 & 1\end{array}\right]\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}
\end{array}\right]\\
 & =\frac{1}{2}\left[\begin{array}{cc}
-x_{1}+x_{2} & -y_{1}+y_{2}\end{array}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
局域坐标系
\end_layout

\begin_layout Example
从雅可比矩阵可以定义出局域坐标的三个方向（正交归一基），
\begin_inset Formula 
\begin{align*}
 & \sbf e_{1}=\frac{\dd{\sbf r}}{\dd{\xi}}/\abs{\frac{\dd{\sbf r}}{\dd{\xi}}}\\
 & \sbf e_{3}=\sbf e_{z}=(0,0,1)\\
 & \sbf e_{2}=\sbf e_{3}\times\sbf e_{1}
\end{align*}

\end_inset

约定基矢
\begin_inset Formula $\{\sbf e_{i}\}$
\end_inset

的分量写成列矩阵形式。
\end_layout

\begin_layout Example
使用局域坐标系 
\begin_inset Formula $T^{ab}=T^{ab}\left(\sbf e_{1},\sbf e_{2}\right)$
\end_inset

，实现全局坐标 
\begin_inset Formula $\sbf r=\left(x,y\right)$
\end_inset

 到二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

的转换
\begin_inset Formula 
\[
\sbf R=T^{ab}\sbf r
\]

\end_inset

坐标分量的变换式为：
\begin_inset Formula 
\[
\sbf R=S^{-1}.\left(\sbf r-\sbf r_{n}\right),\quad S^{-1}=\left[\begin{array}{c}
\sbf e_{1}^{\mathrm{T}}\\
\sbf e_{2}^{\mathrm{T}}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是局域原点的全局坐标，
\begin_inset Formula $\sbf e_{1}^{\mathrm{T}}$
\end_inset

表示分量矩阵的转置。计算
\begin_inset Formula $K_{ij}^{\ell}$
\end_inset

 矩阵需要的形函数的切向导数 
\begin_inset Formula $\frac{\dd{N_{i}^{e}}}{\dd{X}}$
\end_inset

（况且形函数也只在切线上定义）。在二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

下计算（参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jac2"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{X}} & \frac{\dd{N_{2}^{e}}}{\dd{X}}\end{array}\right] & =\left[\begin{array}{c}
\frac{\dd{\xi}}{\dd{X}}\end{array}\right]\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{c}
\frac{\dd{X}}{\dd{\xi}}\end{array}\right]^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{c}
\frac{\dd{r}}{\dd{\xi}}\cdot\sbf e_{1}\end{array}\right]^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left(\left[\begin{array}{cc}
\frac{\dd{x}}{\dd{\xi}} & \frac{\dd{y}}{\dd{\xi}}\end{array}\right]\left[\begin{array}{c}
\sbf e_{1}\end{array}\right]_{2\times1}\right)^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]
\end{align*}

\end_inset

其中使用了 
\begin_inset Formula $\dd{\sbf r}=\dd{X}\sbf e_{1}+\dd{Y}\sbf e_{2}$
\end_inset

，即矢径微元等于切线微元。
\end_layout

\begin_layout Subsection
约定和总结
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r_{j}$
\end_inset

 ：表示全局坐标，二维空间自由度 
\begin_inset Formula $j\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{j}$
\end_inset

 表示对全局坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\overline{x}_{\alpha}$
\end_inset

： 表示有限元中的采样点（node）， 
\begin_inset Formula $\alpha\in{1,2,\cdots,S}$
\end_inset

（希腊字母），线性单元
\begin_inset Formula $2$
\end_inset

个，二阶单元
\begin_inset Formula $3$
\end_inset

个等等。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $x_{p}^{\prime}$
\end_inset

 ：表示单元中二维平面的局域空间坐标 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

，
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{x}^{\prime}$
\end_inset

 表示沿曲线切向求导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\xi$
\end_inset

 ：表示曲线参数（自由度）；
\begin_inset Formula $\partial_{\xi}$
\end_inset

 表示对 
\begin_inset Formula $\xi$
\end_inset

 求导。
\end_layout

\begin_layout Enumerate
表达式右边标出了维度。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
全局空间坐标对 母坐标的雅可比行列式
\begin_inset Formula 
\begin{equation}
J_{1i}=\partial_{\xi}{\color{blue}r_{i}}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\end{array}\right]=\partial_{\xi}\,{\color{blue}N_{\alpha}\,\overline{x}_{\alpha i}},\quad[1,2]\label{eq:j-2d}
\end{equation}

\end_inset

其中 ，对于选定的单元
\begin_inset Formula $N_{\alpha}$
\end_inset

 形式已知，
\begin_inset Formula $\overline{x}_{\alpha j}$
\end_inset

 是节点坐标为已知常量，所以可直接求得
\begin_inset Formula $J_{j}$
\end_inset

 ，维数是 
\begin_inset Formula $1\times2$
\end_inset

。对于一阶单元
\begin_inset Formula 
\[
[J]_{1\times2}=\frac{1}{2}\left[\begin{array}{cc}
\Delta x & \Delta y\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\Delta x=x_{2}-x_{1}$
\end_inset

，
\begin_inset Formula $\Delta y$
\end_inset

类似。
\end_layout

\begin_layout Enumerate
局域空间坐标的三个单位正交基
\begin_inset Formula 
\begin{align*}
\sbf e_{1} & =J_{1\cdot}/\abs{J_{1\cdot}},\quad\text{点表示取整行}\\
\sbf e_{3} & =(0,0,1)\\
\sbf e_{2} & =\sbf e_{3}\times\sbf e_{1}.
\end{align*}

\end_inset

之所以按此序列构造，是为了保证 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

 是相互垂直的。求出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-2d"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $J_{j}$
\end_inset

，即可求出每个单元所属的 
\begin_inset Formula $\sbf e_{j}$
\end_inset

。可以把 
\begin_inset Formula $\left\{ \sbf e_{j}\right\} $
\end_inset

的分量写成数组形式（矩阵），分量用普通字体表示，将 
\begin_inset Formula $[e_{i}]$
\end_inset

分别填入
\color blue
每列
\color inherit
，这里只用到左上的
\begin_inset Formula $2\times2$
\end_inset

的子矩阵。
\begin_inset Formula 
\begin{equation}
E_{ij}=\left[\begin{array}{ccc}
{\color{blue}e_{1x}} & {\color{blue}e_{2x}} & \vdots\\
{\color{blue}e_{1y}} & {\color{blue}e_{2y}} & e_{3}\\
\vdots & \vdots & \vdots
\end{array}\right],\quad[3,3]\label{eq:unitV-2D}
\end{equation}

\end_inset

则 指标
\begin_inset Formula $1$
\end_inset

索引 某
\begin_inset Formula $e$
\end_inset

的分量，指标
\begin_inset Formula $2$
\end_inset

索引 
\begin_inset Formula $e_{1},e_{2},e_{3}$
\end_inset

。例如对于一阶单元
\begin_inset Formula 
\[
E_{ij}=\frac{1}{\Delta\ell}\left[\begin{array}{cc}
{\color{blue}\Delta x} & {\color{blue}-\Delta y}\\
{\color{blue}\Delta y} & {\color{blue}\Delta x}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\Delta_{\ell}=\sqrt{\Delta x^{2}+\Delta y^{2}}$
\end_inset

。
\end_layout

\begin_layout Enumerate
局域空间坐标 对 参数坐标的 雅可比矩阵：
\begin_inset Formula 
\begin{equation}
L_{1q}=\partial_{\xi}\,x_{q}^{\prime}=\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\end{array}\right]=J_{1j}\,E_{jq},\quad[1,2]\label{eq:j-loc-2D}
\end{equation}

\end_inset


\begin_inset Formula $j,q=1,2$
\end_inset

， 
\begin_inset Formula $J$
\end_inset

 和 
\begin_inset Formula $E$
\end_inset

 分别在 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-2d"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:unitV-2D"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中求出，注意 
\begin_inset Formula $E$
\end_inset

 只取用 前
\begin_inset Formula $2\times2$
\end_inset

。对于一阶单元
\begin_inset Formula 
\[
L_{1q}=\frac{1}{2}\left[\begin{array}{cc}
\Delta\ell & 0\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Enumerate
形函数 对 局域空间坐标 的梯度
\begin_inset Formula 
\[
{\color{blue}\partial_{X}^{\prime}}\,N_{\alpha}={\color{blue}L_{11}^{-1}\,\partial_{\xi}}N_{\alpha},\quad[1,S]
\]

\end_inset

其中
\begin_inset Formula $S$
\end_inset

是节点的总数，
\begin_inset Formula $L^{-1}$
\end_inset

是 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-loc-2D"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的逆，这里只需元素
\begin_inset Formula $(1,1)$
\end_inset

。例如对于一阶单元
\begin_inset Formula 
\[
{\color{blue}\partial_{X}^{\prime}}\,N_{\alpha}=\frac{1}{\Delta\ell}\left[\begin{array}{cc}
-1 & 1\end{array}\right]
\]

\end_inset

至此，切向导数
\begin_inset Formula $\partial_{t}N_{i}^{\ell}$
\end_inset

 已求出。
\end_layout

\begin_layout Enumerate
计算均在
\begin_inset Formula $\xi$
\end_inset

参数轴上进行，即坐标变换步骤为：全局系的曲线
\begin_inset Formula $\Rightarrow$
\end_inset

局域系的直线
\begin_inset Formula $\Rightarrow$
\end_inset

参数系的直线，最后需在 
\begin_inset Formula $\xi$
\end_inset

 参数轴上积分：
\begin_inset Formula 
\begin{align*}
[K_{ij}^{\ell}] & =-\int_{C^{\ell}}(\partial_{t}N_{i}^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}N_{j}^{\ell})\dd{C}\\
 & =-\int_{-1}^{1}\frac{d\epsilon_{0}}{\Delta\ell^{2}}\left[\begin{array}{cc}
1 & -1\\
-1 & 1
\end{array}\right]\,\frac{\Delta\ell}{2}\dd{\xi}\\
 & =\frac{-d\epsilon_{0}}{\Delta\ell}\left[\begin{array}{cc}
1 & -1\\
-1 & 1
\end{array}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Section
Galerkin方法
\end_layout

\begin_layout Enumerate
边界条件为
\begin_inset Formula 
\[
\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\sbf e_{n}\cdot\sbf D=0
\]

\end_inset


\end_layout

\begin_layout Enumerate
求解区域为 
\begin_inset Formula $\Omega$
\end_inset

，区域边界
\begin_inset Formula $\Gamma=\partial\Omega$
\end_inset

，边界的边界
\begin_inset Formula $C=\partial\Gamma$
\end_inset

。
\end_layout

\begin_layout Enumerate
仿照Galerkin方法通常情况的微分方程 
\begin_inset Formula $\nabla\cdot\left(\sbf D\right)-\rho=0$
\end_inset

，给出介电屏蔽条件对应的残差；在求解区域的边界
\begin_inset Formula $\Gamma$
\end_inset

上，加上残差项：
\begin_inset Formula 
\[
R^{e}\left[N_{i}^{e}\right]=\int_{\Gamma^{e}}N_{i}^{e}\left[\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\sbf e_{n}\cdot\sbf D\right]\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Enumerate
例如对于三维问题，不同介质交界面是二维 
\begin_inset Formula $\Gamma^{e}$
\end_inset

，边界的边界是曲线
\begin_inset Formula $C^{e}$
\end_inset

；类似地，先用分部积分转移
\begin_inset Formula $\nabla$
\end_inset

，再使用二维情况下的散度定理，最终得到：
\begin_inset Formula 
\[
\int_{\Gamma^{e}}{\color{blue}\left(\nabla_{t}N_{i}^{e}\right)\cdot d\,\sbf D_{t}}\dd{\Gamma}=\int_{C^{e}}{\color{brown}N_{i}^{e}d\,\sbf D_{t}\cdot\sbf s_{n}}\dd{C}+\int_{\Gamma^{e}}N_{i}^{e}\sbf\,e_{n}\cdot\sbf D\dd{\Gamma}
\]

\end_inset

其中
\begin_inset Formula $\sbf e_{n}$
\end_inset

是 
\begin_inset Formula $\Gamma^{e}$
\end_inset

（二维单元）的法向单位矢量，
\begin_inset Formula $\sbf s_{n}$
\end_inset

 是
\begin_inset Formula $C^{e}$
\end_inset

（一维单元）的法向单位矢量。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
电流场中的介电屏蔽条件
\end_layout

\begin_layout Chapter
洛伦兹变换
\end_layout

\begin_layout Section
特殊洛伦兹变换
\end_layout

\begin_layout Standard
\begin_inset Formula $S'$
\end_inset

和
\begin_inset Formula $S$
\end_inset

系
\begin_inset Formula $t=0$
\end_inset

远点重合，
\begin_inset Formula $S'$
\end_inset

以速度
\begin_inset Formula $v$
\end_inset

沿着
\begin_inset Formula $S$
\end_inset

的
\begin_inset Formula $x$
\end_inset

轴方向运动，则坐标变换为
\begin_inset Formula 
\begin{equation}
L_{\mu\nu}=\left[\begin{array}{cccc}
\gamma & -\gamma v/c^{2} & 0 & 0\\
-\gamma v & \gamma & 0 & 0\\
0 & 0 & 1 & 0\\
0 & 0 & 0 & 1
\end{array}\right],\label{eq:ll5.1}
\end{equation}

\end_inset


\begin_inset Formula 
\[
x_{\mu}^{\prime}=L_{\mu\nu}x_{\nu}
\]

\end_inset

其中
\begin_inset Formula $\gamma=(1-\beta)^{-1/2}$
\end_inset

，
\begin_inset Formula $\beta=v/c$
\end_inset

。逆变换为
\begin_inset Formula $L(-v)$
\end_inset

。
\end_layout

\begin_layout Subsection
电磁场
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
A_{\mu}^{\prime}=L_{\mu\nu}A_{\nu},\quad A'=LA
\]

\end_inset

根据洛伦兹变换13.5式，电磁矢势和标势的变换为
\begin_inset Formula 
\begin{align*}
 & A_{1}^{\prime}=\gamma(A_{1}-\frac{v}{c^{2}}\varphi),\\
 & A_{2}^{\prime}=A_{2},\\
 & A_{3}^{\prime}=A_{3},\\
 & \varphi'=\gamma(\varphi-v\,A_{1}).
\end{align*}

\end_inset

逆变换为
\begin_inset Formula 
\begin{align*}
 & A_{1}=\gamma(A_{1}^{\prime}+\frac{v}{c^{2}}\varphi),\\
 & A_{2}=A_{2}^{\prime},\\
 & A_{3}=A_{3}^{\prime},\\
 & \varphi=\gamma(\varphi'+v\,A_{1}^{\prime}).
\end{align*}

\end_inset

四维矢量的长度不变
\begin_inset Formula 
\[
A_{\mu}A_{\mu}=\abs{\sbf A}^{2}-(\frac{\varphi}{c})^{2}=\text{inv.}\;.
\]

\end_inset


\end_layout

\begin_layout Subsection
电磁场强度的变换
\end_layout

\begin_layout Standard
分量变换形式，
\begin_inset Formula $S\to S'$
\end_inset


\begin_inset Formula 
\begin{equation}
\begin{cases}
E_{1}^{\prime}=E_{1} & B_{1}^{\prime}=B_{1}\\
E_{2}^{\prime}=\gamma\left(E_{2}+vB_{3}\right), & B_{2}^{\prime}=\gamma\left(B_{2}-vE_{3}/c^{2}\right),\\
E_{3}^{\prime}=\gamma\left(E_{3}-vB_{2}\right), & B_{3}^{\prime}=\gamma\left(B_{3}+vE_{2}/c^{2}\right),
\end{cases}\label{eq:ll15.8}
\end{equation}

\end_inset

或者写成矢量形式：
\begin_inset Formula 
\begin{align}
 & \sbf E'=\gamma(\sbf E+\sbf v\times\sbf B-\frac{\gamma}{\gamma+1}\frac{(\sbf v\cdot\sbf E)\sbf v}{c^{2}}),\label{eq:ll15.8'}\\
 & \sbf B'=\gamma(\sbf B-\frac{\sbf v}{c^{2}}\times\sbf E-\frac{\gamma}{\gamma+1}\frac{(\sbf v\cdot\sbf B)\sbf v}{c^{2}}),\nonumber 
\end{align}

\end_inset

令
\begin_inset Formula $\sbf v\to-\sbf v$
\end_inset

 即可得到逆变换。也可以对
\begin_inset Formula $A-\varphi$
\end_inset

变换直接求导得到。
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align}
c^{2}B^{2}-E^{2} & =c^{2}B^{\prime2}-E^{\prime2}\label{eq:ll15.9}\\
\sbf B\cdot\sbf E & =\sbf B^{\prime}\cdot\sbf E^{\prime}\label{eq:ll15.10}
\end{align}

\end_inset


\end_layout

\begin_layout Chapter
网格，几何
\end_layout

\begin_layout Section
IBEMesh 单元Face法向
\end_layout

\begin_layout Itemize
搭建正方体几何的测试案例，剖分成6个四面体单元。
\end_layout

\begin_layout Itemize
Simdroid UI 上，单元，节点，面的编号都是 1–based；mesh.dat，mesh.h5 中是 0–based。
\end_layout

\begin_layout Itemize
以第
\begin_inset Formula $5$
\end_inset

个单元为例，mesh.dat 中给出体
\begin_inset Formula $\to$
\end_inset

节点：
\begin_inset Formula $4\;[7,4,0,5]$
\end_inset

；也就是对应 UI 上 
\begin_inset Formula $5\;[8,5,1,6]$
\end_inset

。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
t$Sty = Style[#, Red] &; delta = 0.05; Graphics3D[{ Line[{{1, 0, 0}, {0,
 1, 0}, {0, 0, 1}, {1, 0, 0}}] , Line[{{1, 0, 0}, {0, 0, 0}, {0, 1, 0}}]
 , Line[{{0, 0, 1}, {0, 0, 0}}] , FontSize -> 13 , t$Sty@Text[6, {1 + 3
 delta, 2 delta, 0}], t$Sty@Text[1, {2 delta, 1 + 3 delta, 0}] , t$Sty@Text[8,
 {1 delta, 1 delta, 1 + 0 delta}] , t$Sty@Text[5, {+2 delta, -delta, +2
 delta}]} , Axes -> True, AxesOrigin -> {0, 0, 0} , AxesStyle -> Arrowheads[{0.07
}] , AxesLabel -> {"
\backslash
[Xi]1", "
\backslash
[Xi]2", "
\backslash
[Xi]3"} , Ticks -> None , PlotRangePadding -> {Scaled[.0], Scaled[.0], Scaled[.0]},
 ImageSize -> Medium, Boxed -> False]
\end_layout

\end_inset


\end_layout

\begin_layout Itemize
mesh.dat 中相关的 boundary face 的编号是 
\begin_inset Formula $6\;[4,5,7,4]$
\end_inset

，
\begin_inset Formula $13\;[4,0,5,4]$
\end_inset

；对应 UI 中的 
\begin_inset Formula $7\;[5,6,8,5]$
\end_inset

，
\begin_inset Formula $14\;[5,1,6,5]$
\end_inset

。第四位是face所属单元编号，前三位是节点编号，从图中可见，
\series bold
face的法向都指向单元外部
\series default
。
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ibe-normal-test.pdf
	lyxscale 60
	scale 35

\end_inset


\end_layout

\begin_layout Chapter
Mortor单元法
\end_layout

\begin_layout Section
Mortor连续条件
\end_layout

\begin_layout Standard
Mortar元法(mortar element method, MEM)是一种新型区域分解算法，它允许将求解区域分解为多个子域，在各个区域以最适合子域特征的方式
离散。在各个区域的交界面上，
\series bold
边界节点不要求逐点匹配
\series default
，而是通过建立加权积分形式的 Mortar条件使得交界面上的传递条件在分布意义上满足。 Mortar有限元法(mortar finite element
 method, MFEM)将 MEM 和有限元法(finite element method, FEM)相结合，在各区域中分别使用 FEM 网格离散，区域的交
界面上通过施加 Mortar条件实现区域间的自由度连续。根据子域网格位置关系的不同，MFEM 也可以分为重叠型 和非重叠型两种，本文只讨论非重叠
 MFEM(non- overlapping mortar finite element method, NO-MFEM)的基本原理和实现。
\end_layout

\begin_layout Standard
与传统 FEM 不同，MFEM 将求解区域分为多个子域，若 2 个子域的交集仅为以下情况之一：空集、 2 个区域的顶点、为整条边(面)，则称这种区域分解
 是几何协调的，否则是几何非协调的，如 图 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor1"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示。
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fem-mortor1.png
	lyxscale 80
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
左边是几何协调分解；右边是几何非协调分解。
\begin_inset CommandInset label
LatexCommand label
name "fig:mortor1"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
在几何协调的情况下，具体到网格时，又可以分成
\series bold
网格协调
\series default
和
\series bold
网格非协调
\series default
。网格协调是指不同区域间的公共面/边上，网格的节点是重合的，也就是共节点的概念。相应地，非协调是指两区域的公共面/边上，网格节点可以不重合，如图
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fem-mortor2.png
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
左边是协调网格；右边是非协调网格。
\begin_inset CommandInset label
LatexCommand label
name "fig:mortor2"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
对于图 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)中的非协调网格，需要用各个子域的解逼近全域解，关键是解决 内交界面 上节点自由度的连续问题。在 NO-MFEM 中，交界面的连续条件通过选择非
 Mortar 侧（从边）的有限元空间在交界面上的迹空间作为拉格朗日乘子空间，强制满足 Mortar 条件。例如对于图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)所示的区域 
\begin_inset Formula $m$
\end_inset

 的网格
\begin_inset Formula $\mathcal{T}_{m}$
\end_inset

和区 域 
\begin_inset Formula $n$
\end_inset

 的网格
\begin_inset Formula $\mathcal{T}_{n}$
\end_inset

，两套网格节点自由度在区域交界面
\begin_inset Formula $\Gamma_{mn}$
\end_inset

上满足
\begin_inset Formula 
\begin{equation}
\int_{\Gamma_{mn}^{-}}\mu\,u\,\dd{\Gamma}=\int_{\Gamma_{mn}^{-}}\mu\,v\,\dd{\Gamma}\label{eq:mo8}
\end{equation}

\end_inset

式中：
\begin_inset Formula $u$
\end_inset

 表示非 Mortar边（从边）的未知函数；
\begin_inset Formula $v$
\end_inset

 表示 Mortar 边（主边）的未知函数；
\begin_inset Formula $\mu$
\end_inset

表示试探函数。对
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo8"
plural "false"
caps "false"
noprefix "false"

\end_inset

离散可得矩阵形式的 Mortar连续条件，即 
\begin_inset Formula 
\begin{equation}
Cu=Dv\label{eq:mo9}
\end{equation}

\end_inset

将非Mortar边的节点自由度
\begin_inset Formula $u$
\end_inset

作为从节点自由 度，用 Mortar 边的主节点自由度 
\begin_inset Formula $v$
\end_inset

表示，即 
\begin_inset Formula 
\begin{equation}
u=C^{-1}D\,v=Qv\label{eq:mo10}
\end{equation}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo9"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo10"
plural "false"
caps "false"
noprefix "false"

\end_inset

中：系数矩阵 
\begin_inset Formula $C$
\end_inset

、
\begin_inset Formula $D$
\end_inset

 为中间矩阵；
\begin_inset Formula $Q$
\end_inset

 为 MEM 交界面连续条件矩阵。
\end_layout

\begin_layout Chapter
离散形式整理
\end_layout

\begin_layout Section
控制方程符号整理
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\text{静电场}\quad-\nabla\cdot\left(\epsilon_{r}\nabla\phi\right)+\frac{\beta}{\epsilon_{0}}\phi=\frac{1}{\epsilon_{0}}\rho(x),
\]

\end_inset


\begin_inset Formula 
\[
\varepsilon\frac{\partial\phi}{\partial n}+\gamma\phi=q\quad\text{on}\quad\Gamma_{2}
\]

\end_inset


\begin_inset Formula 
\[
\text{静电场Axial}\quad-\partial_{r}\left(\epsilon_{r}r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}r\,\partial_{z}\Phi\right)+\frac{\beta\,r}{\epsilon_{0}}\phi=\frac{\rho}{\epsilon_{0}}r
\]

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2DA
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-\nabla\cdot\left(\epsilon_{r}\,\nabla\phi\right)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\nabla N_{\alpha}^{e}\cdot\epsilon_{r}\cdot\nabla N_{\beta}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\epsilon_{r}(N_{\alpha,x}\,N_{\beta,x}+N_{\alpha,y}\,N_{\beta,y})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi\,(N_{\alpha,x}^{e}\,\epsilon_{r}r\,N_{\beta,x}^{e}+N_{\alpha,y}^{e}\,\epsilon_{r}r\,N_{\beta,y}^{e})$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\epsilon_{0}}\beta\,\phi$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\epsilon_{0}}\beta\,N_{\alpha}^{e}N_{\beta}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\epsilon_{0}}\beta\,N_{\alpha}^{e}N_{\beta}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi r\,\frac{1}{\epsilon_{0}}\beta\,N_{\alpha}^{e}N_{\beta}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\color red
\begin_inset Formula $\frac{1}{\epsilon_{0}}\rho(x)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\color red
\begin_inset Formula $\frac{1}{\epsilon_{0}}\rho(x)\,N_{\alpha}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\color red
\begin_inset Formula $\frac{1}{\epsilon_{0}}\rho(x)\,N_{\alpha}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\color red
\begin_inset Formula $2\pi r\,\frac{1}{\epsilon_{0}}\rho(x)\,N_{\alpha}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\epsilon\partial_{n}\phi=q-\gamma\phi$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\epsilon_{0}}({\color{brown}\gamma N_{\alpha}^{e}N_{\beta}^{e}},\;{\color{brown}N_{\alpha}^{e}\,q})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\epsilon_{0}}({\color{brown}\gamma N_{\alpha}^{e}N_{\beta}^{e}},\;{\color{brown}N_{\alpha}^{e}\,q})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi r\,\frac{1}{\epsilon_{0}}({\color{brown}\gamma N_{\alpha}^{e}N_{\beta}^{e}},\;{\color{brown}N_{\alpha}^{e}\,q})$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\text{静磁场}\quad\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J+\frac{\mu_{0}}{\mu_{r}}{\color{red}\nabla\times\sbf M_{0}}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
\nabla\cdot\sigma\left(\nabla\Phi+\frac{\partial\sbf A}{\partial t}\right) & =0\\
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)+\mu_{0}\sigma\frac{\partial\sbf A}{\partial t} & =\frac{\mu_{0}}{\mu_{r}}\nabla\times\sbf M_{0}+\mu_{0}\sbf J_{\text{0}}-\mu_{0}\sigma\,\nabla\Phi
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="7" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2DA
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\mu_{r}}\nabla\times\nabla\times A$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\mu_{r}}(\nabla\times\sbf N_{\alpha}^{e})\cdot(\nabla\times\sbf N_{\beta}^{e})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\mu_{r}}(N_{\alpha,x}\,N_{\beta,x}+N_{\alpha,y}\,N_{\beta,y})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi r\frac{1}{\mu_{r}}\left[N_{\alpha,z}^{e}\,N_{\beta,z}^{e}+(\frac{N_{\alpha}^{e}}{r}+N_{\alpha,r}^{e})(\frac{N_{\beta}^{e}}{r}+N_{\beta,r}^{e})\right]$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\color red
\begin_inset Formula $\mu_{0}\sbf J$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\color red
\begin_inset Formula $\mu_{0}\,\sbf N_{\alpha}^{e}\cdot\sbf J$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\color red
\begin_inset Formula $\mu_{0}\,N_{\alpha}^{e}\,J_{z}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\color red
\begin_inset Formula $2\pi r\,\mu_{0}\,N_{\alpha}^{e}\,J_{\varphi}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{\mu}(\sbf n\times\sbf B)=\gamma\sbf A-\sbf q$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}(\gamma\sbf N_{\alpha}^{e}\cdot\sbf N_{\beta}^{e},\;\sbf N_{\alpha}^{e}\cdot\sbf q)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}(\gamma N_{\alpha}^{e}N_{\beta}^{e},\;N_{\alpha}^{e}q)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi r\,\mu_{0}(\gamma N_{\alpha}^{e}N_{\beta}^{e},\;N_{\alpha}^{e}q)$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}\sigma\,\partial_{t}\sbf A$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}\sigma\,\sbf N_{\alpha}^{e}\cdot\sbf N_{\beta}^{e}\,(\partial_{t}A_{\beta})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}\sigma\,N_{\alpha}^{e}N_{\beta}^{e}\,(\partial_{t}A_{\beta})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi r\,\mu_{0}\sigma\,N_{\alpha}^{e}N_{\beta}^{e}\,(\partial_{t}A_{\beta})$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
\begin_inset Formula $\sigma\,\nabla\cdot\partial_{t}\sbf A$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $N_{\alpha}^{e}\,\sigma\,(\nabla\cdot\sbf N_{\beta})\,(\partial_{t}A_{\beta})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-\mu_{0}\sigma\,\nabla\Phi$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-\mu_{0}\sigma\,(\sbf N_{\alpha}\cdot\nabla N_{\beta})\,\Phi_{\beta}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
0
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
\text{时谐磁场}\quad & {\color{blue}\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A_{\omega}\right)-i\omega\mu_{0}\sigma\sbf A_{\omega}}+{\color{brown}\mu_{0}\sigma\,\nabla\Phi_{\omega}}=\mu_{0}e^{-i\varphi}\,\sbf J_{0}\\
 & {\color{blue}-\nabla\cdot(\sigma\nabla\Phi_{\omega})}+{\color{brown}i\omega\sigma\,\nabla\cdot\sbf A_{\omega}}=0
\end{align*}

\end_inset

阻尼因子
\begin_inset Formula $\alpha$
\end_inset

，穿透深度
\begin_inset Formula $\delta$
\end_inset


\begin_inset Formula 
\[
\alpha_{0}=\sqrt{\omega\mu_{0}\sigma/2},\quad\delta=1/\alpha
\]

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2D
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2DA
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}e^{-i\varphi}\,\sbf J_{0}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}e^{-i\varphi}\,\sbf N_{\alpha}^{e}\cdot\sbf J_{0}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}e^{-i\varphi}\,N_{\alpha}^{e}J_{z}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi r\,\mu_{0}e^{-i\varphi}\,N_{\alpha}^{e}J_{\phi}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-i\omega\mu_{0}\sigma\,\sbf A_{\omega}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-i\omega\mu_{0}\sigma\,\sbf N_{\alpha}^{e}\cdot\sbf N_{\beta}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-i\omega\mu_{0}\sigma\,N_{\alpha}^{e}N_{\beta}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi r\,(-i\omega\mu_{0}\sigma)\,N_{\alpha}^{e}N_{\beta}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{brown}\mu_{0}\sigma\,\nabla\Phi_{\omega}}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\mu_{0}\sigma\,\sbf N_{\alpha}^{e}\cdot(\nabla N_{\beta}^{e})\,\Phi_{\omega;\beta}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{blue}-\nabla\cdot(\sigma\nabla\Phi_{\omega})}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\nabla N_{\alpha}^{e}\cdot\sigma\cdot\nabla N_{\beta}^{e}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\epsilon_{r}(N_{\alpha,x}\,N_{\beta,x}+N_{\alpha,y}\,N_{\beta,y})$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2\pi\,(N_{\alpha,x}^{e}\,\epsilon_{r}r\,N_{\beta,x}^{e}+N_{\alpha,y}^{e}\,\epsilon_{r}r\,N_{\beta,y}^{e})$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{brown}i\omega\sigma\,\nabla\cdot\sbf A_{\omega}}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $i\omega\sigma\,N_{\alpha}^{e}(\nabla\cdot\sbf N_{\beta}^{e})\,A_{\omega\beta}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Chapter
电路 MNA
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset href
LatexCommand href
name "电子技术基础"
target "http://staff.ustc.edu.cn/~ftliang/FET/"
literal "false"

\end_inset

；
\end_layout

\begin_layout Enumerate
The modified nodal approach to network analysis–Chung-Wen Ho; A.
 Ruehli; P.
 Brennan All Authors
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset href
LatexCommand href
name "Nodal analysis"
target "https://en.wikipedia.org/wiki/Nodal_analysis"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "Modified nodal analysis"
target "https://en.wikipedia.org/wiki/Modified_nodal_analysis"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
对应 Solver 中的 MNAxxx 模块。
\end_layout

\begin_layout Standard
在电气工程中，Modified nodal analysis，即 MNA 是 nodal analysis 的一种扩展，它不仅能确定电路的 node电压（如经典
节点分析），还能确定一些 branch电流。
\series bold
修正节点分析法
\series default
是为 缓解在节点分析法中 表示 voltage-defined组件（如电压控制电压源）的困难而开发的一种形式。它就是此类形式之一，其他形式，如
 sparse tableau 格式 也同样通用，并通过 矩阵变换 相联系。
\end_layout

\begin_layout Example
电阻矩阵
\begin_inset Formula 
\[
\sum_{j\ne k}G_{jk}\left(v_{k}-v_{j}\right)=0
\]

\end_inset


\begin_inset Formula 
\[
G_{kk}v_{k}-\sum_{j\neq k}G_{jk}v_{j}=0
\]

\end_inset

其中
\begin_inset Formula $G_{kk}$
\end_inset

是所有连接到
\begin_inset Formula $k$
\end_inset

的 电导之和。 
\begin_inset Formula 
\[
\left[\begin{array}{c}
\sigma(v_{1}-v_{2})\\
\sigma(v_{2}-v_{1})
\end{array}\right]=\left[\begin{array}{cc}
\sigma & -\sigma\\
-\sigma & \sigma
\end{array}\right]\left[\begin{array}{c}
v_{1}\\
v_{2}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
电感
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
0 & 0 & 1\\
0 & 0 & -1\\
1 & -1 & -R
\end{array}\right]\left[\begin{array}{c}
v_{1}\\
v_{2}\\
I_{1}
\end{array}\right],\quad\left[\begin{array}{ccc}
0 & 0 & 0\\
0 & 0 & 0\\
0 & 0 & -L
\end{array}\right]\left[\begin{array}{c}
v_{1}\\
v_{2}\\
I_{1}
\end{array}\right],
\]

\end_inset


\end_layout

\begin_layout Section
耦合
\end_layout

\begin_layout Standard
有限元分析 和 电路分析耦合。刚度矩阵写成分块形式
\begin_inset Formula 
\[
\left[\begin{array}{cc}
{\color{blue}K_{00}} & K_{01}\\
K_{10} & {\color{blue}K_{11}}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula ${\color{blue}K_{00}}$
\end_inset

表示有限元部分矩阵，
\begin_inset Formula ${\color{blue}K_{11}}$
\end_inset

表示电路部分矩阵；
\begin_inset Formula $K_{01}$
\end_inset

（upper）表示 
\begin_inset Formula $\text{电路}\to\text{有限元}$
\end_inset

，
\begin_inset Formula $K_{10}$
\end_inset

（lower）表示 
\begin_inset Formula $\text{有限元}\to\text{电路}$
\end_inset

。
\end_layout

\begin_layout Itemize
元器件由它的伏安特性曲线（V-I ）刻画。
\end_layout

\begin_layout Itemize
给到导体性质和通过导体的总电流 
\begin_inset Formula $\mathcal{I}$
\end_inset

，通过电流分布模型模拟出电流密度分布函数
\begin_inset Formula $\sbf j(x)$
\end_inset

，满足
\begin_inset Formula $\int_{S}\sbf j\dd{s}=\mathcal{I}$
\end_inset

。然后把 电流分布函数
\begin_inset Formula $\sbf j(x)$
\end_inset

 作
\series bold
内积投影
\series default
到 FEM 基函数上，得到 Node Fv Distribute of 
\begin_inset Formula $\sbf j$
\end_inset

 — 
\begin_inset Formula $d_{j}$
\end_inset

，程序中表示为
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
 _Con_FvModel
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color inherit
，相当于总电流
\begin_inset Formula $\mathcal{I}=1\,\mathrm{A}$
\end_inset

时对应的 
\begin_inset Formula $\sbf j(x)$
\end_inset

的内积投影，
\begin_inset Formula 
\[
d_{j}=\left(J,N_{\alpha}\right),
\]

\end_inset


\begin_inset Formula 
\[
\sbf J=-\sigma\frac{\sbf A_{t}-\sbf A_{\mathrm{t0}}}{\dd{t}}
\]

\end_inset

其中
\begin_inset Formula $\sbf J$
\end_inset

从
\begin_inset Formula $\sbf E=-\nabla\phi-\frac{\partial\sbf A}{\partial t}$
\end_inset

推导；在瞬态场分析中，矩阵贡献到 时间导数项。
\begin_inset Formula 
\[
\sbf J=i\sigma\omega t\sbf Ae^{i\omega t}
\]

\end_inset


\end_layout

\begin_layout Remark
耦合机制
\end_layout

\begin_deeper
\begin_layout Itemize
\begin_inset Formula $\text{电路}\to\text{有限元}$
\end_inset

（upper）：给出总电流
\begin_inset Formula $\mathcal{I}$
\end_inset

，通过 配分函数
\begin_inset Formula $d_{j}$
\end_inset

，贡献到 FEM 节点上。
\end_layout

\begin_layout Itemize
\begin_inset Formula $\text{有限元}\to\text{电路}$
\end_inset

（upper）：给出每个节点上的电流标量值
\begin_inset Formula $j_{\alpha}$
\end_inset

，将
\begin_inset Formula $j_{\alpha}$
\end_inset

按照 配分函数函数
\begin_inset Formula $d_{j}$
\end_inset

求和，给出对电路的贡献。求和操作可抽出成 刚度矩阵
\begin_inset Formula $K$
\end_inset

中的一行。
\end_layout

\end_deeper
\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
基函数展开
\end_layout

\begin_deeper
\begin_layout Itemize
用
\begin_inset Formula $\mathcal{I}(x)$
\end_inset

 表示通过导体的电流，在 FEM的基函数空间中
\begin_inset Formula $\mathcal{I}(x)$
\end_inset

的近似（或投影）
\begin_inset Formula $\mathcal{I}_{h}(x)$
\end_inset

表示为
\begin_inset Formula 
\begin{equation}
\mathcal{I}_{h}(x)=\sum_{i=1}^{M}\mathcal{I}_{\alpha}\,N_{\alpha}(x),\quad\mathcal{I}_{\alpha}=\mathcal{I}(x_{i}),\label{eq:mna1}
\end{equation}

\end_inset

由于基函数 
\series bold
关于节点正交
\series default
，所以表示系数就是
\begin_inset Formula $\mathcal{I}(x)$
\end_inset

在节点上的值
\begin_inset Formula $\mathcal{I}(x_{i})$
\end_inset

。
\end_layout

\begin_layout Itemize
通常基函数空间的内积定义为 
\begin_inset Formula $(N_{\alpha},N_{\beta})=\int_{\Omega}N_{\alpha}(x)\,N_{\beta}(x)\dd{V}$
\end_inset

，则 
\series bold
基函数关于内积并不是正交的
\series default
，
\begin_inset Formula $(N_{\alpha},N_{\beta})\neq0$
\end_inset

，因为support有重合。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mna3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，使用非正交的内积投影得到一众分量方程，在寻找有限元解的时候需要求解矩阵方程 
\begin_inset Formula $\sbf A\cdot\sbf p=\sbf f$
\end_inset

（如果是正交投影，就不用求解矩阵方程）：
\begin_inset Formula 
\begin{align}
 & p_{h}(x)=\sum_{\alpha=1}^{M}p_{\alpha}\,N_{\alpha}(x),\quad p_{\alpha}=p_{h}(x_{\alpha}),\label{eq:mna2}\\
 & \sum_{\alpha=1}^{M}\left(\frac{\dd{N_{\alpha}}}{\dd{x}},\frac{\dd{N_{\beta}}}{\dd{x}}\right)p_{\beta}=(f,N_{\beta}),\quad\beta=1,2,\cdots,M\label{eq:mna3}
\end{align}

\end_inset


\end_layout

\begin_layout Itemize
因此，给定面
\begin_inset Formula $S$
\end_inset

，和面上节点的值
\begin_inset Formula $\mathcal{I}_{\alpha}$
\end_inset

，根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mna1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，在基函数空间恢复（计算）
\series bold
面上通量
\series default
，需要对基函数做积分。对应上面 【
\begin_inset Formula $j_{\alpha}$
\end_inset

按照 配分函数函数
\begin_inset Formula $d_{j}$
\end_inset

求和】。
\end_layout

\end_deeper
\begin_layout Section
交流电功率
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "交流电功率"
target "https://zh.wikipedia.org/wiki/%E4%BA%A4%E6%B5%81%E7%94%B5%E5%8A%9F%E7%8E%87"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
交流电功率可以用实数或复数的方式表示。
\end_layout

\begin_layout Subsection
实数 
\end_layout

\begin_layout Standard
各个与功率相关的参数，以及各自的单位如下所示：
\end_layout

\begin_layout Itemize
有功功率、平均功率或实功率 P：瓦特（W） 
\end_layout

\begin_layout Itemize
无功功率或虚功率 Q：无功伏安（var） 
\end_layout

\begin_layout Itemize
电压-电流相位差或功率角（power angle）
\begin_inset Formula 
\[
\theta=\theta_{v}-\theta_{i}
\]

\end_inset

角度（
\begin_inset Formula $\text{°}$
\end_inset

）或弧度（rad） 。
\end_layout

\begin_layout Itemize
视在功率 S：伏安（VA） 
\end_layout

\begin_layout Itemize
功率因数（power factor）：无单位
\end_layout

\begin_layout Standard
交流电讯号为弦波讯号，其电压可写成 
\begin_inset Formula $v(t)=V_{m}\,\cos(\omega t+\theta_{v})$
\end_inset

，电流可写成 
\begin_inset Formula $i(t)=I_{m}\,\cos(\omega t+\theta_{i})$
\end_inset


\end_layout

\begin_layout Subsection
瞬时功率
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
 & (\cos\omega t\cos\theta_{v}-\sin\omega t\sin\theta_{v})\,(\cos\omega t\cos\theta_{i}-\sin\omega t\sin\theta_{i})\\
 & =(\cos\omega t)^{2}\cos\theta_{v}\cos\theta_{i}+(\sin\omega t)^{2}\sin\theta_{v}\sin\theta_{i}\\
 & \quad-\cos\omega t\sin\omega t(\cos\theta_{v}\sin\theta_{i}+\sin\theta_{v}\cos\theta_{i})\\
 & =\frac{1+\cos2\omega t}{2}\cos\theta_{v}\cos\theta_{i}+\frac{1-\cos2\omega t}{2}\sin\theta_{v}\sin\theta_{i}\\
 & \quad-\frac{\sin2\omega t}{2}(\cos\theta_{v}\sin\theta_{i}+\sin\theta_{v}\cos\theta_{i})\\
 & =\frac{1}{2}\cos(\theta_{v}-\theta_{i})+{\color{blue}\frac{\cos2\omega t}{2}\cos(\theta_{v}+\theta_{i})-\frac{\sin2\omega t}{2}\sin(\theta_{v}+\theta_{i})}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
p(t) & =v(t)\,i(t)=\frac{V_{m}I_{m}}{2}\cos\theta\,(1+\cos2\omega t)-\frac{V_{m}I_{m}}{2}\sin\theta\,(1+\cos2\omega t)\\
 & =\frac{V_{m}I_{m}}{2}\cos\theta+\frac{V_{m}I_{m}}{2}\cos(\theta+2\omega t)=P+\abs{T}\cos(\theta+2\omega t)
\end{align*}

\end_inset

以上可得 
\series bold
瞬时功率的频率为电压或电流的两倍
\series default
，平均瞬时功率为 
\series bold

\begin_inset Formula $P=\frac{V_{m}I_{m}}{2}\cos\theta$
\end_inset


\series default
，最大瞬时功率为 
\begin_inset Formula $P+\abs{T}$
\end_inset

，最小瞬时功率为 
\begin_inset Formula $P-\abs{T}$
\end_inset

。
\end_layout

\begin_layout Itemize
视在功率 
\begin_inset Formula $S=VI=\sqrt{P^{2}+Q^{2}}$
\end_inset


\end_layout

\begin_layout Itemize
功率因数 
\begin_inset Formula 
\[
pf=\frac{P}{S}=\cos\theta
\]

\end_inset


\end_layout

\begin_layout Itemize
阻抗 
\begin_inset Formula $Z=\sqrt{R^{2}+X^{2}}$
\end_inset

，
\begin_inset Formula $V=I\,Z$
\end_inset

。
\end_layout

\begin_layout Chapter
速度项离散格式
\end_layout

\begin_layout Subsection
迎风格式 Upwind scheme
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "Upwind scheme"
target "https://en.wikipedia.org/wiki/Upwind_scheme"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "迎风格式(upwind scheme)离散原理"
target "https://www.techchickensoup.com/cae/upwind-scheme-intro/"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\partial_{t}u+a\partial_{x}u=0.
\]

\end_inset

简单说，就是当速度
\begin_inset Formula $a>0$
\end_inset

时，且对流占主导时，对于当下求解的格点
\begin_inset Formula $i$
\end_inset

而言，影响几乎都来自于左侧上游格点
\begin_inset Formula $i-1$
\end_inset

，如果这是使用中央差分来离散空间值，同时考虑上下游
\begin_inset Formula $(i-1,i+1)$
\end_inset

的影响，由于采用的离散数值方法不符合流场特性，会使数值求解相当不稳定。
\begin_inset Formula 
\begin{align*}
 & \frac{u_{i}^{n+1}-u_{i}^{n}}{\Delta t}+a\frac{u_{i}^{n}-u_{i-1}^{n}}{\Delta x}=0\quad\text{for}\quad a>0\\
 & \frac{u_{i}^{n+1}-u_{i}^{n}}{\Delta t}+a\frac{u_{i+1}^{n}-u_{i}^{n}}{\Delta x}=0\quad\text{for}\quad a<0
\end{align*}

\end_inset

稳定性，Courant–Friedrichs–Lewy 条件
\begin_inset Formula 
\[
c=\abs{\frac{a\Delta t}{\Delta x}}\le1,\quad\text{and}\quad0\le a.
\]

\end_inset


\end_layout

\end_body
\end_document
