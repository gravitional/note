#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass ctex-book
\begin_preamble
\input{math-preamble}
\end_preamble
\options UTF8,dvipsnames,svgnames,x11names,hyperref,colorlinks=true
\use_default_options true
\begin_modules
theorems-ams-chap-bytype
graphicboxes
\end_modules
\maintain_unincluded_children false
\language chinese-simplified
\language_package none
\inputencoding utf8-plain
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures false
\graphics default
\default_output_format pdf4
\output_sync 0
\bibtex_command default
\index_command default
\float_placement H
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 2
\use_package amssymb 2
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
数学笔记
\end_layout

\begin_layout Author
Young
\end_layout

\begin_layout Standard
刚阵：刚度矩阵
\end_layout

\begin_layout Standard
内力/外力：激励向量
\end_layout

\begin_layout Standard
母坐标：有限元等参坐标
\begin_inset Formula $\xi_{\alpha}$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "经典书单：学习有限元分析"
target "https://zhuanlan.zhihu.com/p/448836259"
literal "false"

\end_inset


\end_layout

\begin_layout Chapter
数学基础
\end_layout

\begin_layout Section
原码，补码
\end_layout

\begin_layout Standard
ref：
\begin_inset CommandInset href
LatexCommand href
name "百科"
target "https://baike.baidu.com/item/%E8%A1%A5%E7%A0%81/6854613"
literal "false"

\end_inset

。假设用
\begin_inset Formula $n+1$
\end_inset

位bit表示整数，首位是符号位，
\begin_inset Formula $0$
\end_inset

表示整数，
\begin_inset Formula $1$
\end_inset

表示负数；后面的
\begin_inset Formula $n$
\end_inset

位表示绝对值。沿数轴列出典型的真值、原码与补码表示。
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="10">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}1}1\ldots1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\ldots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}1}0\ldots01$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}1}0\ldots0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}0}0\ldots0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}0}0\ldots01$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\ldots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}0}1\ldots1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
原码
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-(2^{n}-1)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $+0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $+1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2^{n}-1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
真值
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-2^{n}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-(2^{n}-1)$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\ldots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $+1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\ldots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2^{n}-1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
真值
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}1}0\ldots0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}1}0\ldots01$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}1}1\ldots1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}0}0\ldots0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}0}0\ldots01$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula ${\color{red}0}1\ldots1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
补码
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
真值，原码和补码的关系
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Itemize
在计量范围有限的技术系统中，加法和减法可以互相转换。例如模
\begin_inset Formula $12$
\end_inset

的系统（钟表），
\begin_inset Formula $8-{\color{red}2}=8+({\color{red}12-2})\mod12$
\end_inset

。
\begin_inset Formula $2$
\end_inset

 和 
\begin_inset Formula $12-2$
\end_inset

 互为补数。通过取 mod ，等式成立。
\end_layout

\begin_layout Itemize
如果规定首位表示正负，余下位数表示绝对值。例如 
\begin_inset Formula $4$
\end_inset

位数字，总共能表示
\begin_inset Formula $2^{4}=8$
\end_inset

个数字。在此规定下，一半表示负数，一半表示正数。如果规定要编码的对象
\begin_inset Formula $\{-3,-2,\cdots-0,0,\cdots2,3\}$
\end_inset

 的索引是
\begin_inset Formula $\{1,2,3,\cdots,8\}$
\end_inset

，则负数的索引是
\begin_inset Formula 
\begin{align*}
\text{索引：} & -x\rightarrow2^{3}+x\\
\text{例子：} & -1\rightarrow1001=9\\
\text{补码：} & 1001\rightarrow0111=7
\end{align*}

\end_inset

可以发现，设负数为
\begin_inset Formula $-x<0$
\end_inset

，则它的索引是 
\begin_inset Formula $2^{n}+x$
\end_inset

，则负数的补码等于
\series bold
索引在 
\begin_inset Formula $2^{n+1}$
\end_inset

下的补数
\series default
。所以求补码可以用取反加
\begin_inset Formula $1$
\end_inset

，此操作相当于
\begin_inset Formula $2^{n+1}-{\color{red}(2^{n}+x)}=2^{n}-{\color{red}x}$
\end_inset

。也就是说负数是
\series bold
 
\begin_inset Formula $n$
\end_inset

位bit
\series default
 和 
\series bold

\begin_inset Formula $n+1$
\end_inset

位bit
\series default
 间的映射；负数首位的
\begin_inset Formula $1$
\end_inset

就对应
\begin_inset Formula $2^{n}$
\end_inset

；
\begin_inset Formula $n+1$
\end_inset

位的补码对应
\begin_inset Formula $n$
\end_inset

位的补码；
\begin_inset Formula 
\[
{\color{red}(2^{n}+x)}\leftrightarrow{\color{red}x}
\]

\end_inset


\end_layout

\begin_layout Itemize
使用补码时的表示范围是不对称的：
\begin_inset Formula $-2^{n}\sim-1$
\end_inset

，
\begin_inset Formula $0\sim2^{n-1}$
\end_inset

；因为
\begin_inset Formula ${\color{red}1}0\ldots0$
\end_inset

被用来表示
\begin_inset Formula $-2^{n}$
\end_inset

。所以
\begin_inset Formula $0$
\end_inset

获得唯一表示
\begin_inset Formula ${\color{red}0}0\ldots0$
\end_inset

。
\end_layout

\begin_layout Section
循环指标
\end_layout

\begin_layout Standard
编码中经常遇到需要处理循环指标，例如下列这种表达式。
\begin_inset Formula 
\[
x_{1}y_{23}+x_{2}y_{31}+x_{3}y_{12}
\]

\end_inset


\end_layout

\begin_layout Itemize
要想让指标范围在
\begin_inset Formula $[0,1,\cdots,n-1]$
\end_inset

中。令循环指标的表达式如下：
\begin_inset Formula 
\begin{align*}
\mathrm{id}_{1} & =i+0\\
\mathrm{id}_{2} & =(i+1)\%n\\
 & \vdots\\
\mathrm{id}_{n} & =(i+n-1)\%n
\end{align*}

\end_inset

其中
\begin_inset Formula $i$
\end_inset

是 0–based，
\begin_inset Formula $i=0,1,\cdots,n-1$
\end_inset

 共
\begin_inset Formula $n$
\end_inset

个。
\end_layout

\begin_layout Itemize
要想让指标范围在
\begin_inset Formula $[1,\cdots,n]$
\end_inset

中，令循环指标的表达式同上，再加上适当的 偏移量（offset）。
\end_layout

\begin_layout Section
偏序全序
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "Preorders vs partial orders"
target "https://math.stackexchange.com/questions/1992277/preorders-vs-partial-orders-clarification"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "序理论"
target "https://oi-wiki.org/math/order-theory/#dilworth-定理与-mirsky-定理"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
对集合
\begin_inset Formula $S$
\end_inset

 上的二元关系
\begin_inset Formula $R$
\end_inset

，我们定义如下特殊性质：
\end_layout

\begin_layout Enumerate

\color blue
自反性
\color inherit
：
\begin_inset Formula $\forall a\in S$
\end_inset

，
\begin_inset Formula $,aRa$
\end_inset

，自己和自己满足二元关系
\begin_inset Formula $R$
\end_inset

。
\end_layout

\begin_layout Enumerate

\color blue
反自反性
\color inherit
（irreflexive）：
\begin_inset Formula $\forall a\in S$
\end_inset

，
\begin_inset Formula $\lnot(aRa)$
\end_inset

，自己和自己不满足
\begin_inset Formula $R$
\end_inset

。
\end_layout

\begin_layout Enumerate

\color blue
对称性
\color inherit
（symmetric）：
\begin_inset Formula $\forall a,b\in S$
\end_inset

，
\begin_inset Formula $aRb\,\Leftrightarrow\,bRa$
\end_inset

。例如 
\begin_inset Formula $a=b$
\end_inset

 和 
\begin_inset Formula $b=a$
\end_inset

。（
\begin_inset Formula $+1$
\end_inset

对称）
\end_layout

\begin_layout Enumerate

\color blue
反对称性
\color inherit
（antisymmetric）：
\begin_inset Formula $\forall a,b\in S$
\end_inset

，
\begin_inset Formula $aRb\wedge bRa\,\Rightarrow\,a=b$
\end_inset

。例如
\begin_inset Formula $a\le b\,\wedge\,b\le a\;\Rightarrow\;a=b$
\end_inset

。（
\begin_inset Formula $-1$
\end_inset

对称）
\end_layout

\begin_layout Enumerate

\color blue
非对称性
\color inherit
（asymmetric）：
\begin_inset Formula $\forall a,b\in S$
\end_inset

，
\begin_inset Formula $aRb\;\Rightarrow\;\lnot(bRa)$
\end_inset

。即 
\begin_inset Formula $a<b$
\end_inset

 否定
\begin_inset Formula $b<a$
\end_inset

。（没有对称）
\end_layout

\begin_layout Enumerate
传递性（transitive）：
\begin_inset Formula $\forall a,b,c\in S$
\end_inset

，
\begin_inset Formula $aRb\wedge bRc\;\Rightarrow\;aRc$
\end_inset

。例如
\begin_inset Formula $<$
\end_inset

的传递性。
\end_layout

\begin_layout Enumerate
连接性（connected）：
\begin_inset Formula $\forall a,b\in S$
\end_inset

，
\begin_inset Formula $a\neq b\;\Rightarrow\;(aRb\vee bRa)$
\end_inset

。任意两个元素一定有关系。
\end_layout

\begin_layout Enumerate
良基性（well–founded）：
\begin_inset Formula $\exists m\in S\neq\emptyset$
\end_inset

，
\begin_inset Formula $\forall a\in S\backslash\{m\}$
\end_inset

，
\begin_inset Formula $\lnot(aRm)$
\end_inset

；即非空集合
\begin_inset Formula $S$
\end_inset

中有极小元
\begin_inset Formula $m$
\end_inset

。
\end_layout

\begin_layout Enumerate
不可比的传递性（transitive of incomparability）：
\begin_inset Formula $\forall a,b,c\in S$
\end_inset

，
\begin_inset Formula 
\[
\lnot(aRb\wedge bRa)\wedge\lnot(bRc\wedge cRb)\;\Rightarrow\;\lnot(aRc\wedge cRa)
\]

\end_inset

其中 
\begin_inset Formula $\lnot(aRb\wedge bRa)$
\end_inset

 表示 
\begin_inset Formula $a$
\end_inset

 和 
\begin_inset Formula $b$
\end_inset

是不可比的，即无法比较 
\begin_inset Formula $a$
\end_inset

 和 
\begin_inset Formula $b$
\end_inset

 。
\end_layout

\begin_layout Subsection
STL排序相关
\end_layout

\begin_layout Standard
CC++ STL 中 
\begin_inset CommandInset href
LatexCommand href
name "需要使用比较的算法和数据结构"
target "https://en.cppreference.com/w/cpp/named_req/Compare#Standard_library"
literal "false"

\end_inset

 中有序理论的应用。我们经常需要在 C++ 中自定义比较器，STL 要求 其必须为 
\series bold
严格弱序
\series default
。令 
\begin_inset Formula $<$
\end_inset

 为自定义比较器，则可以定义：
\end_layout

\begin_layout Itemize
\begin_inset Formula $x>y$
\end_inset

 为 
\begin_inset Formula $y<x$
\end_inset

；
\end_layout

\begin_layout Itemize
\begin_inset Formula $x\le y$
\end_inset

 为 
\begin_inset Formula $y\nless x$
\end_inset

（意思是
\begin_inset Formula $y$
\end_inset

不满足“小于”
\begin_inset Formula $x$
\end_inset

）。
\end_layout

\begin_layout Itemize
\begin_inset Formula $x\ge y$
\end_inset

 为
\begin_inset Formula $x\nless y$
\end_inset

；
\end_layout

\begin_layout Itemize
\begin_inset Formula $x=y$
\end_inset

 为 
\begin_inset Formula $x\nless y\,\wedge\,y\nless x$
\end_inset

。
\end_layout

\begin_layout Subsection
preorder
\end_layout

\begin_layout Standard
\begin_inset Formula $a\lesssim b$
\end_inset

 是集合
\begin_inset Formula $S$
\end_inset

上的二元关系，满足 reflexive（自反性） and transitive（传递）。
\end_layout

\begin_layout Itemize
即
\begin_inset Formula $\lesssim$
\end_inset

 是自反的，满足 
\begin_inset Formula $a\lesssim a$
\end_inset

 
\begin_inset Formula $\forall a\in S$
\end_inset

。
\end_layout

\begin_layout Itemize
\begin_inset Formula $\lesssim$
\end_inset

 是传递性的，
\begin_inset Formula $a\lesssim b$
\end_inset

 and 
\begin_inset Formula $b\lesssim c$
\end_inset

 意味着 
\begin_inset Formula $a\lesssim c$
\end_inset

， 
\begin_inset Formula $\forall\,a,b,c\in S$
\end_inset

。
\end_layout

\begin_layout Standard
例如 去掉
\begin_inset Formula $0$
\end_inset

的整数集合 
\begin_inset Formula $Z\backslash\{0\}$
\end_inset

，整除关系 
\begin_inset Formula $a|b$
\end_inset

 就是 preorder。因为 
\begin_inset Formula $a|b$
\end_inset

 且 
\begin_inset Formula $b|a$
\end_inset

 只能推导出 
\begin_inset Formula $a=\pm b$
\end_inset

而不能推导出 
\begin_inset Formula $a=b$
\end_inset

。
\end_layout

\begin_layout Subsection
partial order
\end_layout

\begin_layout Standard
除了 preorder 满足的性质外，还要满足 antisymmetric，即 
\begin_inset Formula $a\le b$
\end_inset

，
\begin_inset Formula $b\le a$
\end_inset

 意味着 
\begin_inset Formula $a=b$
\end_inset

， 
\begin_inset Formula $\forall a,b\in S$
\end_inset

。
\end_layout

\begin_layout Standard
通过定义等价类：即定义等价关系 
\begin_inset Formula $a\sim b\Leftrightarrow a\lesssim b\,\text{and}\,b\lesssim a$
\end_inset

，以及 
\begin_inset Formula $a$
\end_inset

 的等价类 
\begin_inset Formula $[a]=\{x\in S|x\sim a\}$
\end_inset

，可以从 pre-order 关系中提取出 partial order。即改变集合
\begin_inset Formula $S$
\end_inset

 的构成 
\begin_inset Formula $S\quad\Rightarrow\quad S/\sim$
\end_inset

。
\end_layout

\begin_layout Itemize
如果把 ordered set 看成 category。preorder 对应的范畴中，从 object 
\begin_inset Formula $a$
\end_inset

 到 object 
\begin_inset Formula $b$
\end_inset

 最多有一个 morphism。
\end_layout

\begin_layout Itemize
范畴 
\begin_inset Formula $C$
\end_inset

 中 
\begin_inset Formula $a\to b$
\end_inset

 的态射的集合称为 hom-set，记作
\begin_inset Formula $C(a,b)$
\end_inset

。因此，preorder 中的每个 hom-set 要么是空集，要么是 singleton。
\begin_inset Formula $C(a,a)$
\end_inset

 必然是 singleton。
\end_layout

\begin_layout Itemize
preorder 中可能有 cycles；而 partial order 中不能有 cycle。
\end_layout

\begin_layout Subsection
total order
\end_layout

\begin_layout Standard
如果集合中的任意两个元素
\begin_inset Formula $a,b$
\end_inset

，或者能满足
\begin_inset Formula $aRb$
\end_inset

 ，或者能满足
\begin_inset Formula $bRa$
\end_inset

，则称 linear order 或 total order。
\end_layout

\begin_layout Section
行列式相关
\end_layout

\begin_layout Subsection
行列式的性质
\end_layout

\begin_layout Standard
行列式使用全反称张量展开
\begin_inset Formula 
\[
\left|\begin{array}{ccc}
a_{11} & \cdots & a_{n1}\\
\vdots &  & \vdots\\
a_{n1} & \cdots & a_{nn}
\end{array}\right|=\varepsilon_{i_{1}\cdots i_{n}}a_{1i_{1}}\,a_{2i_{2}}\cdots a_{ni_{n}}
\]

\end_inset


\end_layout

\begin_layout Standard
行列式的性质：
\begin_inset CommandInset href
LatexCommand href
name "deteminant"
target "https://zh.wikipedia.org/wiki/行列式#行列式的性質"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
在行列式中，一行（列）元素全为
\begin_inset Formula $0$
\end_inset

，则此行列式的值为
\begin_inset Formula $0$
\end_inset

。
\end_layout

\begin_layout Enumerate
在行列式中，有两行（列）对应成比例或相同，则此行列式的值为
\begin_inset Formula $0$
\end_inset

。
\end_layout

\begin_layout Enumerate
将一行（列）的
\begin_inset Formula $k$
\end_inset

倍加进另一行（列）里，行列式的值不变。
\end_layout

\begin_layout Enumerate
线性律。在行列式中，某一行（列）有公因子
\begin_inset Formula $k$
\end_inset

，则可以提出
\begin_inset Formula $k$
\end_inset

。
\end_layout

\begin_layout Enumerate
行列式分解。在行列式中，某一行（列）的每个元素是两数之和，则此行列式可拆分为两个相加的行列式。
\end_layout

\begin_layout Enumerate
行列式中的两行（列）互换，改变行列式正负符号。
\end_layout

\begin_layout Enumerate
将行列式的行列互换，行列式的值不变，其中行列互换相当于转置。这个性质可以简单地记作
\begin_inset Formula 
\[
D=\abs{a_{ij}}=\abs{a_{ji}}=\tps D
\]

\end_inset


\end_layout

\begin_layout Enumerate
行列式的乘法定理：
\series bold
方块矩阵的乘积
\series default
 的行列式等于 
\series bold
行列式的乘积
\series default
。
\begin_inset Formula 
\[
\det(AB)=\det(A)\,\det(B)
\]

\end_inset

特别的，若将矩阵中的每一行每一列上的数都乘以一个常数
\begin_inset Formula $r$
\end_inset

，那么所得到的行列式将是原来的
\begin_inset Formula $r^{n}$
\end_inset

倍：
\begin_inset Formula 
\[
\det(rA)=\det(rI_{n}\cdot A)=\det(rI_{n})\cdot\det(A)=r^{n}\det(A).
\]

\end_inset


\end_layout

\begin_layout Enumerate
以上的乘法公式还可以进一步推广为所谓 
\series bold
柯西–比内公式
\series default
，从而使得只要两个矩阵的乘积是方块矩阵，就有类似于以上的结果：假设
\begin_inset Formula $A$
\end_inset

是一个
\begin_inset Formula $m\times n$
\end_inset

矩阵，而
\begin_inset Formula $B$
\end_inset

是一个
\begin_inset Formula $n\times m$
\end_inset

矩阵。如果
\begin_inset Formula $S$
\end_inset

是
\begin_inset Formula $\{1,\cdots,n\}$
\end_inset

中具有
\begin_inset Formula $m$
\end_inset

个元素的子集 
\begin_inset Formula $\{S_{1},\cdots,S_{m}\}$
\end_inset

，我们记
\begin_inset Formula $A_{s}$
\end_inset

为
\begin_inset Formula $A$
\end_inset

中列指标位于
\begin_inset Formula $S$
\end_inset

中的
\begin_inset Formula $m\times m$
\end_inset

子矩阵。类似地，记
\begin_inset Formula $B_{S}$
\end_inset

为
\begin_inset Formula $B$
\end_inset

中行指标位于
\begin_inset Formula $S$
\end_inset

中的
\begin_inset Formula $m\times m$
\end_inset

子矩阵。那么
\begin_inset Formula 
\[
\det(AB)=\sum_{S}\det(A_{S})\,\det(B_{S})
\]

\end_inset

这里求遍
\begin_inset Formula $\{1,\cdots,n\}$
\end_inset

中
\begin_inset Formula $m$
\end_inset

个元素的所有可能子集
\begin_inset Formula $S$
\end_inset

，共有
\begin_inset Formula $C(n,m)$
\end_inset

个。如果
\begin_inset Formula $m=2$
\end_inset

，即
\begin_inset Formula $A$
\end_inset

与
\begin_inset Formula $B$
\end_inset

是同样大小的方块矩阵，则只有一个容许集合
\begin_inset Formula $S$
\end_inset

，柯西–比内公式退化为通常行列式的乘法公式。如过
\begin_inset Formula $m=1$
\end_inset

则有
\begin_inset Formula $n$
\end_inset

个容许集合
\begin_inset Formula $S$
\end_inset

，这个公式退化为点积。如果
\begin_inset Formula $m>n$
\end_inset

，没有容许集合
\begin_inset Formula $S$
\end_inset

，约定行列式 
\begin_inset Formula $\det(AB)$
\end_inset

是零。
\end_layout

\begin_layout Enumerate
若
\begin_inset Formula $A$
\end_inset

是可逆矩阵，
\begin_inset Formula $\det(A^{-1})=(\det A)^{-1}$
\end_inset

 。
\end_layout

\begin_layout Enumerate
由行列式的
\series bold
乘法定理
\series default
，以及
\begin_inset Formula $\det(A^{-1})=(\det A)^{-1}$
\end_inset

 可以知道，行列式定义了一个从
\series bold
一般线性群
\series default

\begin_inset Formula $(\mathrm{GL}_{n}(\mathbb{F}),\times)$
\end_inset

 到
\begin_inset Formula $(\mathbb{F}^{*},\times)$
\end_inset

 上的群同态。
\end_layout

\begin_layout Enumerate
若将方块矩阵中的元素取共轭，得到的是矩阵的共轭矩阵。共轭矩阵的行列式值等于矩阵行列式值的共轭：
\begin_inset Formula 
\[
\det(\overline{A})=\overline{\det(A)}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
若两个矩阵相似，那么它们的行列式相同。这是因为两个相似的矩阵之间只相差一个基底变换，而行列式描述的是矩阵对应的线性映射对体积的影响，而不是体积，所以基底变换并不
会影响行列式的值。用数学语言来说，就是：如果两个矩阵
\begin_inset Formula $A$
\end_inset

与
\begin_inset Formula $B$
\end_inset

相似，那么存在可逆矩阵
\begin_inset Formula $P$
\end_inset

使得
\begin_inset Formula 
\begin{align*}
 & A=P\,B\,P^{-1},\\
 & \det(A)=\det(PBP^{-1})=\det(B).
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate
行列式是所有
\series bold
特征值
\series default
（按代数重数计）的乘积。这可由矩阵必和其若尔当标准型相似推导出。特殊地，
\series bold
三角矩阵
\series default
的行列式等于其对角线上所有元素的乘积。
\end_layout

\begin_layout Enumerate
由于三角矩阵的行列式计算简便，当矩阵的系数为
\series bold
域
\series default
时，可以通过
\series bold
高斯消元法
\series default
将矩阵变换成三角矩阵，或者将矩阵分解成三角矩阵的乘积之后再利用行列式的乘法定理进行计算。可以证明，所有的矩阵
\begin_inset Formula $A$
\end_inset

都可以分解成一个上三角矩阵
\begin_inset Formula $U$
\end_inset

、一个下三角矩阵
\begin_inset Formula $L$
\end_inset

以及一个置换矩阵
\begin_inset Formula $P$
\end_inset

的乘积：
\begin_inset Formula $A=P\cdot L\cdot U$
\end_inset

。这时，矩阵
\begin_inset Formula $A$
\end_inset

的行列式可以写成：
\begin_inset Formula 
\[
\det(A)=\det(P)\cdot\det(L)\cdot\det(U)
\]

\end_inset


\end_layout

\begin_layout Enumerate
分块矩阵的行列式并不能简单地表示成每个分块的行列式的乘积组合。对于分块的三角矩阵，仍然有类似的结论：
\begin_inset Formula 
\[
\left|\begin{array}{cc}
A & 0\\
C & D
\end{array}\right|=\left|\begin{array}{cc}
A & B\\
0 & D
\end{array}\right|=\det(A)\,\det(D),
\]

\end_inset

矩阵的行列式等于对角元素的行列式之乘积。 对于一般情况，若对角元素中有一个是可逆矩阵，比如说
\begin_inset Formula $A$
\end_inset

可逆，那么矩阵的行列式可以写做
\begin_inset Formula 
\[
\left|\begin{array}{cc}
A & B\\
C & D
\end{array}\right|=\det(A)\,\det(D-CA^{-1}B)
\]

\end_inset


\end_layout

\begin_layout Enumerate
矩阵的行列式和矩阵的
\series bold
迹数
\series default
有一定的关联，当矩阵的系数为
\series bold
域
\series default
时，在定义了
\series bold
矩阵的指数函数
\series default
后，有如下的恒等式：
\begin_inset Formula 
\[
\det(\exp(A))=\exp(\tr(A)).
\]

\end_inset


\end_layout

\begin_layout Subsection
行列式拉普拉斯展开
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "https://zh.wikipedia.org/wiki/拉普拉斯展开"
target "拉普拉斯展开"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
行列式的按行按列展开，
\begin_inset Formula $B$
\end_inset

关于第
\begin_inset Formula $i$
\end_inset

行第
\begin_inset Formula $j$
\end_inset

列的
\series bold
余子式
\series default

\begin_inset Formula $M_{ij}$
\end_inset

是值去掉第
\begin_inset Formula $i$
\end_inset

行第
\begin_inset Formula $j$
\end_inset

列后得到的
\begin_inset Formula $n-1$
\end_inset

阶子矩阵的行列式，简称
\begin_inset Formula $B$
\end_inset

的
\begin_inset Formula $(i,j)$
\end_inset

 余子式。
\begin_inset Formula $B$
\end_inset

的
\begin_inset Formula $(i,j)$
\end_inset


\series bold
代数余子式 
\series default

\begin_inset Formula $C_{ij}$
\end_inset

 是指
\begin_inset Formula $M_{ij}$
\end_inset

与
\begin_inset Formula $(-1)^{i+j}$
\end_inset

的乘积：
\begin_inset Formula $C_{ij}=(-1)^{i+j}M_{ij}$
\end_inset

；
\begin_inset Formula $(i,j)$
\end_inset

均是 0–based or 1–based。
\begin_inset Formula 
\begin{align*}
\abs{B} & =b_{i1}C_{i1}+b_{i2}C_{i2}+\cdots+b_{in}C_{in}\\
 & =b_{1j}C_{1j}+b_{2j}C_{2j}+\cdots+b_{nj}C_{nj}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
范德蒙德行列式
\end_layout

\begin_layout Standard
ref: 
\begin_inset CommandInset href
LatexCommand href
name "范德蒙行列式"
target "https://zhuanlan.zhihu.com/p/161300510"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
范德蒙德行列式的形式：
\begin_inset Formula 
\[
D=\left[\begin{array}{ccccc}
1 & 1 & 1 & \cdots & 1\\
x_{1} & x_{2} & x_{3} & \cdots & x_{n}\\
x_{1}^{2} & x_{2}^{2} & x_{3}^{2} & \cdots & x_{n}^{2}\\
\cdots & \cdots & \cdots & \cdots & \cdots\\
x_{1}^{n-2} & x_{2}^{n-2} & \cdots & \cdots & x_{n}^{n-2}\\
x_{1}^{n-1} & x_{2}^{n-1} & \cdots & \cdots & x_{n}^{n-1}
\end{array}\right]
\]

\end_inset

遇到类似于上式的行列式时，可以使用范德蒙行列式公式计算：
\begin_inset Formula 
\[
\prod_{n\ge i\ge j\ge1}=(x_{i}-x_{j})
\]

\end_inset

即行列式
\begin_inset Formula $D$
\end_inset

的值为所有
\begin_inset Formula $(x_{i}-x_{j})$
\end_inset

 的乘积，其中
\begin_inset Formula $i>j$
\end_inset

。
\end_layout

\begin_layout Standard
例如
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
1 & 1 & 1\\
x_{1} & x_{2} & x_{3}\\
x_{1}^{2} & x_{2}^{2} & x_{3}^{2}
\end{array}\right]=\left(x_{2}-x_{1}\right)\left(x_{3}-x_{1}\right)\left(x_{3}-x_{2}\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
证明范德蒙行列式
\end_layout

\begin_layout Standard
通过观察范德蒙行列式，拿行列式的第一列来说，相邻的两个元素，上面的元素比下面的元素少乘一次 
\begin_inset Formula $x_{1}$
\end_inset

。根据这一特征，可以试着从第 
\begin_inset Formula $n$
\end_inset

 行开始，每个元素都减去前一行元素的 
\begin_inset Formula $x_{1}$
\end_inset

 倍，则可以提取出公因式
\begin_inset Formula 
\[
\left(x_{2}-x_{1}\right)\left(x_{3}-x_{1}\right)\cdots\left(x_{n}-x_{1}\right)\times\left[\begin{array}{cccc}
1 & 1 & \cdots & 1\\
x_{2} & x_{3} & \cdots & x_{n}\\
\cdots & \cdots & \cdots & \cdots\\
x_{2}^{n-3} & \cdots & \cdots & x_{n}^{n-3}\\
x_{2}^{n-2} & \cdots & \cdots & x_{n}^{n-2}
\end{array}\right]
\]

\end_inset

于是又产生了范德蒙德行列式，可以递归进行下去。因此得到公式
\begin_inset Formula 
\[
D=\prod_{n\ge i\ge j\ge1}=(x_{i}-x_{j}).
\]

\end_inset


\end_layout

\begin_layout Subsection
代数余子式，矩阵的逆
\end_layout

\begin_layout Section
Gram矩阵
\end_layout

\begin_layout Subsection
正交基矢
\end_layout

\begin_layout Standard
设
\begin_inset Formula $\{e_{i}\}$
\end_inset

，
\begin_inset Formula $\{e_{i}^{\prime}\}$
\end_inset

 分别是两组正交基矢，都写成列矩阵的形式；
\begin_inset Formula $\{v_{i}\}$
\end_inset

，
\begin_inset Formula $\{v_{i}^{\prime}\}$
\end_inset

同一向量
\begin_inset Formula $\sbf v$
\end_inset

 的两种表示。
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\sbf v=e_{i}\,v_{i},\quad\sbf v=e_{i}^{\prime}\,v_{i}^{\prime}
\]

\end_inset

计算 旧基矢
\begin_inset Formula $\{e_{i}\}$
\end_inset

用新基矢
\begin_inset Formula $\{e_{i}^{\prime}\}$
\end_inset

 表出的矩阵 
\begin_inset Formula $P_{ki}$
\end_inset

（坐标变换，到 new 系，new 系在前 
\begin_inset Formula $e_{k}^{\prime\mathsf{T}}$
\end_inset

 ） 
\begin_inset Formula 
\begin{align*}
 & e_{i}=e_{j}^{\prime}P_{ji}\\
 & {\color{red}P_{ki}=e_{k}^{\prime\mathsf{T}}\,e_{i}}
\end{align*}

\end_inset


\begin_inset Formula 
\[
e_{i}\,{\color{blue}v_{i}}=e_{j}^{\prime}\,{\color{blue}P_{ji}\,v_{i}}
\]

\end_inset

即向量的坐标变换为
\begin_inset Formula 
\[
{\color{blue}v_{i}}\to{\color{blue}P_{ji}\,v_{i}}.
\]

\end_inset

类似地，新基矢
\begin_inset Formula $\{e_{i}^{\prime}\}$
\end_inset

 用旧基矢
\begin_inset Formula $\{e_{i}\}$
\end_inset

表出（逆变换矩阵）：
\begin_inset Formula 
\begin{align*}
 & e_{i}^{\prime}=e_{j}Q_{ji}\\
 & Q_{ki}=e_{k}^{\mathsf{T}}\,e_{i}^{\prime}
\end{align*}

\end_inset


\begin_inset Formula 
\[
e_{i}^{\prime}\,{\color{blue}v_{i}^{\prime}}=e_{j}\,{\color{blue}Q_{ji}\,v_{i}^{\prime}}
\]

\end_inset


\begin_inset Formula 
\[
{\color{blue}v_{i}^{\prime}}\to{\color{blue}Q_{ji}\,v_{i}^{\prime}}
\]

\end_inset


\end_layout

\begin_layout Subsection
一般倾斜基矢
\end_layout

\begin_layout Example
\begin_inset Argument 1
status open

\begin_layout Plain Layout
一般基矢下的表示
\end_layout

\end_inset

设
\begin_inset Formula $\{{\color{blue}e_{i}}\}$
\end_inset

是一组一般的线性无关基矢，
\begin_inset Formula $\sbf v$
\end_inset

 表示为
\begin_inset Formula 
\[
\sbf v=e_{i}\,v_{i}
\]

\end_inset

为了计算表出系数，令 
\begin_inset Formula $e_{j}^{\mathsf{T}}\,\sbf v=c_{j}$
\end_inset

，
\begin_inset Formula 
\[
c_{j}=e_{j}^{\mathsf{T}}\,e_{i}\,v_{i}
\]

\end_inset

定义 
\begin_inset Formula $G_{ji}={\color{blue}e_{j}^{\mathsf{T}}\,e_{i}}$
\end_inset

，即
\begin_inset Formula 
\[
c_{j}=G_{ji}\,v_{i}
\]

\end_inset

若
\begin_inset Formula $\{e_{i}\}$
\end_inset

两两不平行，则
\begin_inset Formula $G$
\end_inset

可逆，得到
\begin_inset Formula 
\[
v=G^{-1}\,c.
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status open

\begin_layout Plain Layout
一般基矢间的坐标变换
\end_layout

\end_inset

 由 
\begin_inset Formula $\sbf v$
\end_inset

 表示的等价性得
\begin_inset Formula 
\[
e_{j}^{\prime\mathsf{T}}\,\sbf v=e_{j}^{\prime\mathsf{T}}\left(e_{i}^{\prime}\,v_{i}^{\prime}\right)=e_{j}^{\prime\mathsf{T}}\left(e_{i}\,v_{i}\right),
\]

\end_inset

定义投影矩阵 
\begin_inset Formula 
\[
P_{ji}=e_{j}^{\prime\mathsf{T}}\,e_{i}
\]

\end_inset

代入Gram矩阵的定义 
\begin_inset Formula $G_{ji}^{\prime}=e_{j}^{\prime\mathsf{T}}\,e_{i}^{\prime}$
\end_inset

，上式写成
\begin_inset Formula 
\[
G_{ji}^{\prime}\,v_{i}^{\prime}=P_{ji}\,v_{i}
\]

\end_inset

写成矩阵形式：
\begin_inset Formula 
\begin{align*}
 & G^{\prime}\,v^{\prime}=P\,v\\
\Rightarrow\; & v^{\prime}=G^{\prime-1}\,P\,v
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
坐标变换下的Gram矩阵
\end_layout

\begin_layout Standard
在一个由可逆矩阵 
\begin_inset Formula $U$
\end_inset

 表示的基变换下 
\begin_inset Formula 
\[
e_{j}\to e_{i}\,U_{ij}
\]

\end_inset

Gram 矩阵的变换为 
\begin_inset Formula 
\begin{align*}
{\color{blue}G}_{ji} & =e_{j}^{\mathsf{T}}\,e_{i}\;\to\;e_{i}^{\mathsf{T}}\,U_{ji}^{\mathsf{T}}\,e_{k}\,U_{ki}\\
 & =U_{ji}^{\mathsf{T}}\,e_{i}^{\mathsf{T}}e_{k}\,U_{ki}
\end{align*}

\end_inset

所以格拉姆矩阵作合同变换， 变为 
\begin_inset Formula $U^{\mathsf{T}}\,G\,U$
\end_inset


\end_layout

\begin_layout Section
线搜索方法 Line search
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "线搜索(line search)方法"
target "https://www.cnblogs.com/kemaswill/p/3416231.html"
literal "false"

\end_inset

;
\end_layout

\begin_layout Standard
Numerical Optimization, Chapter 3, p35-p42.
 J.
 Nocedal, S.Wright.
\end_layout

\begin_layout Standard
在机器学习中, 通常需要求某个函数的最值(比如 最大似然中 需要求的 似然的最大值)。线搜索(line search)是求得一个函数
\begin_inset Formula $f(x)$
\end_inset

的最值的两种常用迭代方法之一(另外一个是 trust region)。其思想是首先求得一个下降方向,在这个方向上
\begin_inset Formula $f(x)$
\end_inset

会下降，然后是求得
\begin_inset Formula $f(x)$
\end_inset

在这个方向上下降的步长。求下降方向的方法有很多，比如梯度下降，牛顿方法 和 Quasi-Newton 方法, 而步长可以是固定值，也可以通过诸如回溯线搜索来求得
。
\end_layout

\begin_layout Subsection
线搜索
\end_layout

\begin_layout Standard
线搜索 是一种迭代的求得某个函数的最值的方法。 对于每次迭代, 线搜索会计算得到搜索的方向 
\begin_inset Formula $p_{k}$
\end_inset

 以及沿这个方向移动的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

。迭代过程可以表示为
\begin_inset Formula 
\begin{equation}
x_{k+1}=x_{k}+\alpha_{k}p_{k},\label{eq:w3.1}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\alpha_{k}$
\end_inset

 是正值标量，称为步长（step length）。线搜索的成功取决于方向 
\begin_inset Formula $p_{k}$
\end_inset

 和 步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 的有效选择。
\end_layout

\begin_layout Standard
大多数的线搜索方法都会要求 
\begin_inset Formula $p_{k}$
\end_inset

 是下降方向(descent direction)，亦即需要满足以下条件： 
\begin_inset Formula 
\[
p_{k}^{T}.\nabla f_{k}<0,
\]

\end_inset

这样就能够保证函数f(x)沿着这个方向是下降的。一般来说, 搜索方向的形式为
\begin_inset Formula 
\begin{equation}
p_{k}=-B_{k}^{-1}.\nabla f_{k},\label{eq:w3.2}
\end{equation}

\end_inset

其中 
\begin_inset Formula $B_{k}$
\end_inset

 是对称的非奇异矩阵。在最陡下降(steepest descent)方法中，
\begin_inset Formula $B_{k}$
\end_inset

是单位矩阵
\begin_inset Formula $I$
\end_inset

, 在牛顿方法(Newton)中
\begin_inset Formula $B_{k}$
\end_inset

 则是海森(Hessian)矩阵
\begin_inset Formula $\nabla^{2}f\left(x_{k}\right)$
\end_inset

，在 Quasi-Newton方法中通过迭代求得 Hessian 矩阵的近似矩阵。
\end_layout

\begin_layout Standard
当 
\begin_inset Formula $p_{k}$
\end_inset

 由上式定义, 且 
\begin_inset Formula $B_{k}$
\end_inset

 是正定矩阵时：
\begin_inset Formula 
\[
p_{k}^{T}\nabla f_{k}=-\nabla f_{k}^{T}.B_{k}^{-1}.\nabla f_{k}<0
\]

\end_inset

所以 
\begin_inset Formula $p_{k}$
\end_inset

 是下降方向(descent direction)。
\end_layout

\begin_layout Subsection
步长
\end_layout

\begin_layout Standard
步长 
\begin_inset Formula $\alpha$
\end_inset

 应该最小化下列函数
\begin_inset Formula 
\begin{equation}
\phi\left(\alpha\right)=f\left(x_{k}+\alpha p_{k}\right),\quad\alpha>0\label{eq:w3.3}
\end{equation}

\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.2.png
	lyxscale 50
	scale 45

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
在 
\begin_inset Formula $f$
\end_inset

 上不充分的下降。
\begin_inset Formula $f\left(x_{k}\right)=5/k$
\end_inset

, 
\begin_inset Formula $k=0,1,\cdots$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

但是 全局最小值对应的 
\begin_inset Formula $\alpha$
\end_inset

 比较困难，且计算量比较大，实际常用的方法是在可接受的计算量的情况下尽可能的求得较大的步长， 以使得 
\begin_inset Formula $\phi\left(\alpha\right)$
\end_inset

尽可能的降低。经典的线搜索方法通过迭代来求得
\begin_inset Formula $\alpha$
\end_inset

，直至达到某个停止条件。一般的线搜索方法都包含以下两个步骤：
\end_layout

\begin_layout Enumerate
bracketing: 求得一个包含 理想步长 的区间 
\end_layout

\begin_layout Enumerate
二分法或者插值法：在这个区间内使用二分法或者插值法来求得步长。
\end_layout

\begin_layout Subsection
对于凸函数的二分搜索算法
\end_layout

\begin_layout Standard
ref：
\begin_inset CommandInset href
LatexCommand href
name "凸函数定义"
target "https://zhuanlan.zhihu.com/p/56876303"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
如果 
\begin_inset Formula $f(x)$
\end_inset

 是一个可微分的凸函数, 即
\end_layout

\begin_layout Enumerate
函数 
\begin_inset Formula $f$
\end_inset

 的定义域 
\begin_inset Formula $\mathrm{dom}f$
\end_inset

 是一个凸集；
\end_layout

\begin_layout Enumerate
满足 
\begin_inset Formula $f\left[\theta x+\left(1-\theta\right)y\right]\le\theta f\left(x\right)+\left(1-\theta\right)f\left(y\right),\quad\theta\in\left(0,1\right)$
\end_inset


\end_layout

\begin_layout Standard
其函数图像类似 
\begin_inset Formula $x^{2}$
\end_inset

，定义域中任意两点连线组成的线段都在这两点的函数曲线上方。如果 
\begin_inset Formula $f(\vec{x})$
\end_inset

 是凸函数，则函数 
\begin_inset Formula $g(t)=f(\vec{x}+t\vec{v})$
\end_inset

 也是其定义域内的凸函数。
\end_layout

\begin_layout Standard
我们的目标是求得 
\begin_inset Formula $\alpha$
\end_inset

, 使得 
\begin_inset Formula 
\[
\alpha=\mathrm{arg}\min_{\lambda>0}f\left(x+\lambda p\right)
\]

\end_inset

在每一步迭代中我们令 
\begin_inset Formula $\phi(\alpha)=f\left(x_{k}+\alpha p_{k}\right)$
\end_inset

，
\begin_inset Formula $x_{k}$
\end_inset

是搜索起点，
\begin_inset Formula $p_{k}$
\end_inset

是梯度下降方向。其中 
\begin_inset Formula $\phi(\alpha)$
\end_inset

 是 
\begin_inset Formula $\alpha$
\end_inset

 的凸函数, 所以问题转化为求: 
\begin_inset Formula 
\[
\overline{\alpha}=\mathrm{arg}\min_{\alpha>0}\phi\left(\alpha\right)
\]

\end_inset


\end_layout

\begin_layout Itemize
因为 
\begin_inset Formula $\phi(\alpha)$
\end_inset

 是凸函数，所以 
\begin_inset Formula $\phi'(\overline{\alpha})=0$
\end_inset

。
\end_layout

\begin_layout Itemize
可以得到 
\begin_inset Formula $\phi'(\alpha)=\left[\nabla f\left(x+\alpha p\right)\right]^{T}.p$
\end_inset

，因为
\begin_inset Formula $p$
\end_inset

是梯度下降方向，满足 
\begin_inset Formula $p_{k}^{T}.\nabla f_{k}<0$
\end_inset

，所以 
\begin_inset Formula $\phi'(0)<0$
\end_inset

。
\end_layout

\begin_layout Standard
假设我们知道一个 
\begin_inset Formula $\beta$
\end_inset

 使得 
\begin_inset Formula $\phi'(\beta)>0$
\end_inset

，那么使得 
\begin_inset Formula $\phi'(\overline{\alpha})=0$
\end_inset

 的 
\begin_inset Formula $\alpha$
\end_inset

 肯定位于 
\begin_inset Formula $(0,\beta)$
\end_inset

 区间内。然后我们可以使用以下二分查找算法来求解 
\begin_inset Formula $\phi'(\alpha)\approx0$
\end_inset

。
\end_layout

\begin_layout Enumerate
令 
\begin_inset Formula $k=0$
\end_inset

，
\begin_inset Formula $\alpha_{\ell}\coloneqq0$
\end_inset

，
\begin_inset Formula $\alpha_{r}:=\beta$
\end_inset

；即 
\begin_inset Formula $\phi'(\alpha_{\ell})<0$
\end_inset

，
\begin_inset Formula $\phi'(\alpha_{r})>0$
\end_inset

。
\end_layout

\begin_layout Enumerate
令 
\begin_inset Formula $\overline{\alpha}=\frac{\alpha_{\ell}+\alpha_{r}}{2}$
\end_inset

，然后计算 
\begin_inset Formula $\phi'(\tilde{\alpha})$
\end_inset

：
\end_layout

\begin_deeper
\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\overline{\alpha})>0$
\end_inset

，则令 
\begin_inset Formula $\alpha_{r}\coloneqq\overline{\alpha}$
\end_inset

，
\begin_inset Formula $\alpha_{\ell}$
\end_inset

不变，令 
\begin_inset Formula $k\to k+1$
\end_inset


\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\overline{\alpha})<0$
\end_inset

，则令 
\begin_inset Formula $\alpha_{\ell}\coloneqq\overline{\alpha}$
\end_inset

，
\begin_inset Formula $\alpha_{r}$
\end_inset

不变，令 
\begin_inset Formula $k\to k+1$
\end_inset


\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\overline{\alpha})=0$
\end_inset

, 停止迭代。
\end_layout

\end_deeper
\begin_layout Subsection
回溯线搜索 backtracking line search
\end_layout

\begin_layout Standard
使用二分查找法来求步长的计算复杂度很高，因为在最小化 
\begin_inset Formula $f(x)$
\end_inset

 的每次迭代中我们都需要执行一次线搜索,，而每次线搜索都要用上述的二分查找算法。我们可以在牺牲一定的精度的条件下来加快计算速度，回溯线搜索是一种近似线搜索算法。
\end_layout

\begin_layout Standard
首先，我们要求每次的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 都使得
\begin_inset Formula $f(x)$
\end_inset

充分的降低：
\begin_inset Formula 
\begin{equation}
f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k}\label{eq:w3.4}
\end{equation}

\end_inset

上述条件称作充分下降条件，其中 
\begin_inset Formula $c_{1}\in(0,1)$
\end_inset

，一般来说 
\begin_inset Formula $c_{1}=10^{-4}$
\end_inset

。亦即 
\begin_inset Formula $f(x)$
\end_inset

 的下降应该至少和 
\begin_inset Formula $\alpha_{k}$
\end_inset

 以及 
\begin_inset Formula $\nabla f_{k}^{T}p_{k}$
\end_inset

 成正比。如下图所示, 上式的右边 
\begin_inset Formula $f(x_{k})+c_{1}\alpha\nabla f_{k}^{T}p_{k}$
\end_inset

 是线性函数, 可以表示为 
\begin_inset Formula $\ell(\alpha)$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.3.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
充分下降条件
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.3"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
充分下降条件规定只有使得 
\begin_inset Formula $\phi(\alpha)\le\ell(\alpha)$
\end_inset

 的 
\begin_inset Formula $\alpha$
\end_inset

 才满足条件。其区间如上图所示。
\end_layout

\begin_layout Standard
单独只有充分下降条件是不够的，因为如上图，所有充分小的 
\begin_inset Formula $\alpha$
\end_inset

 都满足上述条件，但是 
\begin_inset Formula $\alpha$
\end_inset

 太小会导致下降不充分, 为了排除这些小的 
\begin_inset Formula $\alpha$
\end_inset

，我们引入了第二个要求，亦即曲率条件(curvature condition)：
\begin_inset Formula 
\[
\nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k}
\]

\end_inset

其中 
\begin_inset Formula $c_{2}\in\left(c_{1},1\right)$
\end_inset

。上式的左边就是 
\begin_inset Formula $\phi'(\alpha_{k})$
\end_inset

，右边则是 
\begin_inset Formula $\phi'(0)$
\end_inset

，即上式相当于
\begin_inset Formula 
\[
\phi'(\alpha_{k})\ge c_{2}\phi'(0).
\]

\end_inset

这是因为如果 
\begin_inset Formula $\phi'(\alpha)$
\end_inset

 是很小的负数（下降得非常陡峭），则我们可以在这个方向上继续使得 
\begin_inset Formula $f(x)$
\end_inset

下降更多.
 如下图所示
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.4.png
	lyxscale 50
	scale 50

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
曲率条件（curvature condition）
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.4"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Typical values of 
\begin_inset Formula $c_{2}$
\end_inset

 are 
\begin_inset Formula $0.9$
\end_inset

 when the search direction 
\begin_inset Formula $p_{k}$
\end_inset

 is chosen by a Newton or quasi-Newton method, and 
\begin_inset Formula $0.1$
\end_inset

 when 
\begin_inset Formula $p_{k}$
\end_inset

 is obtained from a nonlinear conjugate gradient method。上述两个条件合起来称作 Wolfe
 条件：
\begin_inset Formula 
\begin{align}
 & f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k},\label{eq:w3.6a}\\
 & \nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k},\label{eq:w3.6b}
\end{align}

\end_inset

其中 
\begin_inset Formula $0<c_{1}<c_{2}<1$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.5.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
满足 Wolfe 条件的步长。
\begin_inset CommandInset label
LatexCommand label
name "fig:w-3.5"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
满足 Wolfe 条件的 步长 不一定离 
\begin_inset Formula $\phi$
\end_inset

 的极值点很近，如 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:w-3.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

。但是可以修改 curvature condition，来让 
\begin_inset Formula $\alpha_{k}$
\end_inset

 至少位于 
\begin_inset Formula $\phi$
\end_inset

 的 local minimizer 或 stationary point 附近。strong Wolfe condition 要求 
\begin_inset Formula $\alpha_{k}$
\end_inset

 满足：
\begin_inset Formula 
\begin{align}
 & f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k},\label{eq:w3.7a}\\
 & \nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k},\label{eq:w3.7b}
\end{align}

\end_inset

其中 
\begin_inset Formula $0<c_{1}<c_{2}<1$
\end_inset

。
\end_layout

\begin_layout Standard
对于任意光滑且有下界（smooth and bounded below）函数
\begin_inset Formula $f$
\end_inset

，不难证明存在满足 Wolfre 条件的步长。
\end_layout

\begin_layout Lemma
Suppose that 
\begin_inset Formula $f:\symbb R^{n}\to\symbb R$
\end_inset

 is continuously differentiable.
 Let pk be a descent direction at xk, and assume that f is bounded below
 along the ray 
\begin_inset Formula $\left\{ x_{k}+\alpha p_{k}|\alpha>0\right\} $
\end_inset

。Then if 
\begin_inset Formula $0<c1<c2<1$
\end_inset

, there exist intervals of step lengths satisfying the Wolfe conditions
 (3.6) and the strong Wolfe conditions 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.7a"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
Wolfe条件 在广义上是标度不变的（scale-invariant）。将目标函数乘以常数，或对变量进行仿射变换（affine）都不会改变它们。它们可以用在大多
数线搜索方法中，而且在实现准牛顿方法中特别重要，正如我们在第六章中看到的那样。
\end_layout

\begin_layout Subsection
Goldstein 条件
\end_layout

\begin_layout Standard
与 Wolfe条件 一样，Goldstein条件 确保步长 
\begin_inset Formula $\alpha$
\end_inset

 足够小，但不会太短。Goldstein条件 也可以被表述为一对不等式，具体方式如下：
\begin_inset Formula 
\begin{equation}
f(x_{k})+{\color{blue}(1-c)\alpha_{k}}\nabla f_{k}^{T}p_{k}\le f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+{\color{blue}c\alpha_{k}}\nabla f_{k}^{T}p_{k},\label{eq:w3.11}
\end{equation}

\end_inset

其中 
\begin_inset Formula $0<c<1/2$
\end_inset

。第二个不等式正是充分下降条件
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:w3.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

，并引入第一个不等式来控制 步长的下限。见图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:w3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.6.png
	lyxscale 50
	scale 50

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
The Goldstein conditions.
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.6"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Goldstein条件 相对于Wolfe条件 的一个缺点是，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:w3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的第一个不等式可能会排除 
\begin_inset Formula $\phi$
\end_inset

 的所有极小值点（minimizers）。 然而，Goldstein和Wolfe条件有很多共同点，它们的收敛理论也非常相似。Goldstein条件
 经常用于牛顿型方法，但不太适合于保持 正定Hessian近似 的 准牛顿方法。
\end_layout

\begin_layout Remark
充分下降条件和回溯算法(BACKTRACKING)
\end_layout

\begin_layout Standard
我们已经提到，仅仅是充分减少条件
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.6a"
plural "false"
caps "false"
noprefix "false"

\end_inset

 并不足以确保，算法沿着给定的搜索方向取得合理的下降。 然而，如果 线搜索 算法适当地选择其候选步长，通过使用所谓的 回溯方法（backtracking
 approach），我们可以省去 额外的条件
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.6b"
plural "false"
caps "false"
noprefix "false"

\end_inset

，只使用 充分下降条件 来终止 线搜索 程序。在其最基本的形式中，回溯法的过程如下。
\end_layout

\begin_layout Example
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
算法3.1
\end_layout

\end_inset

 回溯线搜索Backtracking Line Search
\end_layout

\begin_layout Enumerate
选取 
\begin_inset Formula $\overline{\alpha}>0$
\end_inset

，
\begin_inset Formula ${\color{blue}\rho\in(0,1)}$
\end_inset

，
\begin_inset Formula ${\color{brown}c\in(0,1)}$
\end_inset

；令 
\begin_inset Formula $\alpha\leftarrow\overline{\alpha}$
\end_inset

；
\end_layout

\begin_layout Enumerate

\series bold
repeat 
\series default
until 
\begin_inset Formula $f(x_{k}+\alpha p_{k})\le f(x_{k})+{\color{brown}c}\,\alpha\nabla f_{k}^{T}p_{k}$
\end_inset

 （直到满足充分下降条件）
\begin_inset Formula 
\[
\alpha\leftarrow{\color{blue}\rho}\,\alpha;
\]

\end_inset


\series bold
end(repeat)
\begin_inset Newline newline
\end_inset


\series default
返回 
\begin_inset Formula $\alpha_{k}=\alpha$
\end_inset

。
\end_layout

\begin_layout Standard
在这个过程中，初始步长 
\begin_inset Formula $\overline{\alpha}$
\end_inset

 在牛顿和 quasi- Newton 方法中被选择为 
\begin_inset Formula $1$
\end_inset

，但在其他算法中可以有不同的值，如 最陡峭下降法（steepest descent） 或 共轭梯度法（conjugate gradient）。在有限次数的试验后
，能找到一个可接受的步长，因为 
\begin_inset Formula $\alpha_{k}$
\end_inset

 最终会变得足够小，以至于充分下降条件成立（见图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:w3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

）。在实践中，允许在直线搜索的每个迭代中，改变 收缩因子
\begin_inset Formula $\rho$
\end_inset

。例如，它可以通过保障性插值（safeguarded interpolation）来选择，我们将在后面介绍。我们只需要确保在每次迭代中，我们有
 
\begin_inset Formula $\rho\in[\rho_{\text{low}},\rho_{\text{high}}]$
\end_inset

，对于某些固定常数 
\begin_inset Formula $0<\rho_{\text{low}}<\rho_{\text{high}}<1$
\end_inset

。
\end_layout

\begin_layout Standard
回溯方法 确保所选择的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 要么是某固定值（初始选择
\begin_inset Formula $\overline{\alpha}$
\end_inset

），否则就是足够短以满足充分下降条件，但又不会太短。后一种说法成立，是因为 被接受值 
\begin_inset Formula $\alpha_{k}$
\end_inset

 相比于前一试验值（trial value，
\begin_inset Formula $\alpha_{k}/\rho$
\end_inset

）要乘上系数 
\begin_inset Formula $\rho$
\end_inset

；而前个值因违反 充分下降条件 被拒绝，也就是太长。
\end_layout

\begin_layout Standard
这种简单而流行的 终止线搜索 的策略很适合 牛顿法，但不太适合准牛顿和共轭梯度方法。
\end_layout

\begin_layout Section
牛顿优化，最速降线优化，回溯线搜索
\end_layout

\begin_layout Standard
ref: Numerical methods for unconstrained optimization--J.
 E.
 Dennis，P101
\end_layout

\begin_layout Standard
牛顿方向，
\begin_inset Formula 
\begin{align*}
 & H_{k}\,s_{k}^{N}=-\nabla f(x_{k})\\
 & x_{k+1}=x_{k}+s_{k}^{N}.
\end{align*}

\end_inset

quasi–Newton 方向:
\begin_inset Formula 
\[
-H_{k}^{-1}\,\nabla f(x_{k}),\quad H_{k}=\nabla^{2}f(x_{k})+\mu_{k}I
\]

\end_inset

最速降线方向：寻找从
\begin_inset Formula $x_{k}$
\end_inset

开始，
\begin_inset Formula $f$
\end_inset

在
\begin_inset Formula $-\nabla f(x_{k})$
\end_inset

方向上的最低点，即寻找
\begin_inset Formula $\lambda_{k}$
\end_inset


\begin_inset Formula 
\begin{align*}
 & \min_{\lambda_{k}>0}f\left(x_{k}-\lambda_{k}\nabla f(x_{k})\right)\\
 & x_{k+1}:=x_{k}-\lambda_{k}\nabla f(x_{k})
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
通常在绝大多数问题中，不应该使用 steepest descent 作为计算方法，因为 quasi–Newton 方法更高效。然而，当 global
 strategy 必须取极小的步长时（相对于Newton step），Sect6.4 中将看到，global strategy 采用的步长将落在，或者靠近
 steepest descent direction。
\end_layout

\begin_layout Standard
steepest descent 方向对 
\begin_inset Formula $x$
\end_inset

 的scale 很敏感，而 Newton 方向不敏感。所以在 6.4 中使用 steepest descent 方向时，附录中的实现是，首先左乘一个
 对角的 scaling matrix。在Sect 7.1 中将会讨论这个实践中很重要的话题，称为 scaling。
\end_layout

\begin_layout Standard
Page 117，线搜索 line searches。为了避免两种搜索失败的情况：
\begin_inset Formula $x_{k}$
\end_inset

步长太小，或者
\begin_inset Formula $f(x_{k})$
\end_inset

下降太慢。使用了两条筛选准则：
\end_layout

\begin_layout Itemize
使
\begin_inset Formula $f(x)$
\end_inset

充分下降，对于U形函数，对应避免
\begin_inset Formula $x_{k}$
\end_inset

过大
\begin_inset Formula 
\[
f(x_{c}+\lambda p)\le f(x_{c})+\alpha\,\lambda\,\nabla f(x_{c})^{T}\,p
\]

\end_inset


\begin_inset Formula 
\[
f(x_{+})\le f(x_{c})+\alpha\,\nabla f(x_{c})^{T}\,(x_{+}-x_{c})
\]

\end_inset


\end_layout

\begin_layout Itemize
避免step 过小；对于U形函数，对应避免
\begin_inset Formula $x_{k}$
\end_inset

过小
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nabla f(x_{+})^{T}p\stackrel{\Delta}{=}\nabla f(x_{c}+\lambda_{c}p)^{T}p\ge\beta\,\nabla f(x_{c})^{T}p
\]

\end_inset


\begin_inset Formula 
\[
\nabla f(x_{+})^{T}(x_{+}-x_{c})\ge\beta\,\nabla f(x_{c})^{T}(x_{+}-x_{c})
\]

\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status open

\begin_layout Plain Layout
P120 Example 6.3.1
\end_layout

\end_inset


\end_layout

\begin_layout Section
Lagrange插值与Gauss积分
\end_layout

\begin_layout Standard
ref:
\begin_inset CommandInset href
LatexCommand href
name "Lagrange插值与Gauss积分"
target "https://zhuanlan.zhihu.com/p/37768842"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Lagrange插值与Gauss积分是在学习FEM中不可回避的两部分，虽然说是两部分，其实在Gauss积分中，构造多项式的被积函数时，也用到了Lagrange插
值多项式，所以在讲关于 参数单元 刚阵 求积分的时候，在数值积分中一起提出。
\begin_inset Formula 
\begin{equation}
\int_{a}^{b}f\left(x\right)\dd{x}\approx\int_{a}^{b}P\left(x\right)\dd{x}\label{eq:5.145}
\end{equation}

\end_inset

以上表达式是说，对于比较难以积分的函数
\begin_inset Formula $f$
\end_inset

，我们找到了与之相似度很高的多项式函数
\begin_inset Formula $P$
\end_inset

，用
\begin_inset Formula $P$
\end_inset

的积分来代替f的积分，那么现在的问题就是如何找到多项式
\begin_inset Formula $P$
\end_inset

。
\end_layout

\begin_layout Subsection
Newton–Cotes 数值积分
\end_layout

\begin_layout Standard
基于 
\begin_inset Formula $n$
\end_inset

 个点（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

），将多项式取为 Lagrange 插值多项式，即
\begin_inset Formula 
\[
\varphi\left(\xi\right)=a_{0}+a_{1}\xi+\cdots+a_{n-1}\xi^{n-1}=\sum_{i=1}^{n}l_{i}^{(n-1)}\left(\xi\right)f\left(\xi_{i}\right).
\]

\end_inset

其中 
\begin_inset Formula $a_{0}$
\end_inset

，
\begin_inset Formula $a$
\end_inset

，
\begin_inset Formula $\cdots$
\end_inset

，
\begin_inset Formula $a_{n-1}$
\end_inset

为常数，
\begin_inset Formula $l_{i}^{(n-1)}$
\end_inset

为
\begin_inset Formula $n-1$
\end_inset

阶 Lagrange 插值函数，即
\begin_inset Formula 
\[
l_{i}^{(n-1)}\left(\xi\right)=\frac{\left(\xi-\xi_{1}\right)\left(\xi-\xi_{2}\right)\cdots{\color{blue}\left(\xi-\xi_{i-1}\right)\left(\xi-\xi_{i+1}\right)}\cdots\left(\xi-\xi_{n}\right)}{\left(\xi_{i}-\xi_{1}\right)\left(\xi_{i}-\xi_{2}\right)\cdots{\color{blue}\left(\xi_{i}-\xi_{i-1}\right)\left(\xi_{i}-\xi_{i+1}\right)}\cdots\left(\xi_{i}-\xi_{n}\right)}=\prod_{\substack{j=1\\
j\neq i
}
}^{n}\frac{\left(\xi-\xi_{j}\right)}{\left(\xi_{i}-\xi_{j}\right)}.
\]

\end_inset


\end_layout

\begin_layout Standard
Lagrange插值的定义: 如果已知 
\begin_inset Formula $n$
\end_inset

 个点的数值，那么可以构造一个
\begin_inset Formula $n-1$
\end_inset

阶的多项式，通过待定系数的方式，使得这个多项式在这
\begin_inset Formula $n$
\end_inset

个点的值就等于原本函数在这
\begin_inset Formula $n$
\end_inset

个点的数值。关于待定系数的求解，刚好是一个范德蒙德多项式：
\begin_inset Formula 
\[
\left[\begin{array}{ccccc}
1 & x_{1} & x_{1}^{2} & \cdots & x_{1}^{n-1}\\
1 & x_{2} & x_{2}^{2} & \cdots & x_{2}^{n-1}\\
\cdots & \cdots & \cdots & \cdots & \cdots\\
1 & x_{n} & x_{n}^{2} & \cdots & x_{n}^{n-1}
\end{array}\right]\left(\begin{array}{c}
a_{0}\\
a_{1}\\
\cdots\\
a_{n-1}
\end{array}\right)=\left(\begin{array}{c}
f\left(x_{1}\right)\\
f\left(x_{2}\right)\\
\cdots\\
f\left(x_{n}\right)
\end{array}\right)
\]

\end_inset

其中 
\begin_inset Formula $a_{0}$
\end_inset

，
\begin_inset Formula $a_{1}$
\end_inset

，
\begin_inset Formula $a_{n-1}$
\end_inset

 是拟合多项式中的各个系数。例如给三个点，得到的插值多项式形如：
\begin_inset Formula 
\[
y=l_{1}^{(2)}\left(x\right)y_{1}+l_{2}^{(2)}\left(x\right)y_{2}+l_{3}^{(2)}\left(x\right)y_{3}
\]

\end_inset

容易看出
\begin_inset Formula $f_{i}(x_{j})=\delta_{ij}$
\end_inset

，即在所有要插值的点，多项式插值的结果与原来的函数相等。因此 Lagrange 插值的一般表达式为
\begin_inset Formula 
\[
P\left(x\right)=\sum_{i=1}^{n}\left[\prod_{\substack{j=1\\
i\neq j
}
}\frac{\left(x-x_{j}\right)}{\left(x_{i}-x_{j}\right)}y_{i}\right].
\]

\end_inset

从而引出了 Newton–Cotes 数值积分公式
\begin_inset Formula 
\begin{align*}
I & =\int_{-1}^{1}f\left(\xi\right)\dd{\xi}\approx\int_{-1}^{1}\varphi\left(\xi\right)\dd{\xi}\\
 & =\sum_{i=1}^{n}{\color{blue}\left(\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}\right)}f\left(\xi_{i}\right)\\
 & =\sum_{i=1}^{n}A_{i}f\left(\xi_{i}\right)
\end{align*}

\end_inset

Newton-Cotes 数值积分将原积分转化为 
\series bold
权函数
\series default
 与 
\series bold
原函数值
\series default
 的线性组合（在离散点上）。
\end_layout

\begin_layout Subsection
Gauss积分, Gauss quadrature
\end_layout

\begin_layout Standard
然后，就是 FEM 里常用的 Gauss 积分了：
\end_layout

\begin_layout Standard
首先谈一下我的理解，上面的Newton-Cotes数值积分，是将 
\series bold
函数
\series default
 转换为 
\series bold
多项式
\series default
，采用的多项式是Lagrange插值多项式，对采用的n个点没有特殊的要求；下面的Gauss积分，就是要挑选优化过的积分点，同时确定积分点函数值的权函数。
\end_layout

\begin_layout Standard
如果调整 
\begin_inset Formula $n$
\end_inset

 个插值点的位置（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

），使 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

作为 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式对
\begin_inset Formula $f(\xi)$
\end_inset

 进行逼近，则可以大大提高积分精度；也就是调整插值点 
\begin_inset Formula $\xi_{i}$
\end_inset

 的位置，使其达到一个最优的组合，这种最优的位置点叫做 Gauss 积分点。
\end_layout

\begin_layout Standard
由函数逼近理论，可构造 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

 为
\begin_inset Formula 
\begin{equation}
\varphi\left(\xi\right)=\sum_{i=1}^{n}l_{i}^{(n-1)}(\xi)f(\xi_{i})+\sum_{i=0}^{n-1}\beta_{i}\xi^{i}P\left(\xi\right)\label{eq:5.149}
\end{equation}

\end_inset

其中 
\begin_inset Formula $l_{i}^{(n-1)}(\xi)$
\end_inset

 是 
\begin_inset Formula $\left(n-1\right)$
\end_inset

 次 Lagrange插值函数，
\begin_inset Formula $\beta_{i}$
\end_inset

 为系数，
\begin_inset Formula $P\left(\xi\right)$
\end_inset

 为 
\begin_inset Formula $n$
\end_inset

 次多项式，即
\begin_inset Formula 
\begin{equation}
P\left(\xi\right)=\left(\xi-\xi_{1}\right)\left(\xi-\xi_{2}\right)\cdots\left(\xi-\xi_{n}\right)=\prod_{i=1}^{n}\left(\xi-\xi_{i}\right).\label{eq:5.150}
\end{equation}

\end_inset

（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

）积分点由以下条件确定
\begin_inset Formula 
\begin{equation}
\int_{-1}^{1}\xi^{i}P\left(\xi\right)\dd{\xi}=0,\quad i=0,1,\cdots,n-1\label{eq:5.151}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Gauss积分的定义
\end_layout

\begin_layout Standard
可以看出，构造的高斯积分的函数虽然阶次提高到了
\begin_inset Formula $2n-1$
\end_inset

，它的两项中的第一项仍然为
\begin_inset Formula $n-1$
\end_inset

阶，并且就是之前的拉格朗日插值多项式，只是在后面添加了一个“辅助项”。其实为什么这么构造我是不清楚的，但是毋庸置疑的是：
\end_layout

\begin_layout Enumerate
辅助项在所有积分点处的值为零，即 
\begin_inset Formula $P\left(\xi_{i}\right)=0$
\end_inset

。
\end_layout

\begin_layout Enumerate
整个多项式的阶次被提高到 
\begin_inset Formula $2n-1$
\end_inset

次，相比于牛顿积分更精确；
\end_layout

\begin_layout Enumerate
利用上述的积分条件（共
\begin_inset Formula $n$
\end_inset

个），可以用来确定
\begin_inset Formula $n$
\end_inset

个积分点（采样点）的位置。
\end_layout

\begin_layout Standard
则积分
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:5.145"
plural "false"
caps "false"
noprefix "false"

\end_inset

为，
\begin_inset Formula 
\begin{align}
I & =\int_{-1}^{1}f\left(\xi\right)\dd{\xi}\approx\int_{-1}^{1}\varphi\left(\xi\right)\dd{\xi}\nonumber \\
 & =\sum_{i=1}^{n}\left[\left({\color{blue}\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}}\right)f\left(\xi_{i}\right)\right]+\sum_{i=0}^{n-1}\int_{-1}^{1}\beta_{i}\xi^{i}P\left(\xi\right)\dd{\xi}=\sum_{i=1}^{n}Af\left(\xi_{i}\right)\label{eq:5.152}
\end{align}

\end_inset

其中
\begin_inset Formula 
\begin{equation}
A_{i}={\color{blue}\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}}\label{eq:5.153}
\end{equation}

\end_inset

注意这时 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

 为 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式，
\color blue

\begin_inset Formula $\xi_{i}$
\end_inset

的位置由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:5.151"
plural "false"
caps "false"
noprefix "false"

\end_inset

 式确定
\color inherit
，因而整个积分的精度具有 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 阶。
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
高斯积分运用的是正交多项式的性质。Lagrange 多项式那项已经保证了至少
\begin_inset Formula $n$
\end_inset

的精确度，后面的项则把精确度提高到
\begin_inset Formula $2n-1$
\end_inset

。精确度跟多项式的次数应当是没有关系的。而是跟特殊的取点有关系。
\end_layout

\end_inset


\end_layout

\begin_layout Remark
令 
\begin_inset Formula $J$
\end_inset

 表示空间坐标对 母坐标的雅可比矩阵，
\begin_inset Formula $\det[J]$
\end_inset

正比于几何区域的面积，例如对于三角形
\begin_inset Formula 
\[
S=\frac{1}{2}\det[J]
\]

\end_inset

在 Solver程序中，这个几何因子（
\begin_inset Formula $1/2$
\end_inset

）被吸收进 权重因子 
\begin_inset Formula $W_{i}$
\end_inset

 中。因此 Solver程序中高斯积分法的公式写作：
\begin_inset Formula 
\[
\iint_{\Omega^{e}}F\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{x}\dd{y}=\sum_{i=1}^{m}F\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset

即直接乘上采样点的 Jacobi行列式 即可。
\end_layout

\begin_layout Section
局域坐标系和转动变换
\end_layout

\begin_layout Standard
给定任意两个非平行矢量 
\begin_inset Formula $\sbf A$
\end_inset

，
\begin_inset Formula $\sbf B$
\end_inset

，使用它们构建一个局域坐标系的方法是，
\end_layout

\begin_layout Enumerate
先令 
\begin_inset Formula $\sbf Z=\sbf A\times\sbf B$
\end_inset

，右手螺旋三元组为 
\begin_inset Formula $(\sbf Z,\sbf A,\sbf B)$
\end_inset


\end_layout

\begin_layout Enumerate
再令 
\begin_inset Formula $\sbf B'=\sbf Z\times\sbf A$
\end_inset

，现在右手螺旋三元组为 
\begin_inset Formula $(\sbf B',\sbf Z,\sbf A)$
\end_inset


\end_layout

\begin_layout Enumerate
再令 
\begin_inset Formula $\sbf A'=\sbf B'\times\sbf Z$
\end_inset

，现在右手螺旋三元组为 
\begin_inset Formula $(\sbf A',\sbf B',\sbf Z)$
\end_inset


\end_layout

\begin_layout Standard
现在三元组是两两垂直的，
\begin_inset Formula 
\begin{align*}
 & \sbf Z\times\sbf B'\\
 & =(\sbf A\times\sbf B)\times(\sbf Z\times\sbf A)\\
 & =(\sbf A\times\sbf B)\times(\sbf A\times\sbf B\times\sbf A)=0
\end{align*}

\end_inset


\begin_inset Formula $\sbf Z\times\sbf A'$
\end_inset

 同理。所以最终 
\begin_inset Formula $(\sbf A',\sbf B',\sbf Z)$
\end_inset

 即为局部正交基，
\begin_inset Formula $\sbf Z$
\end_inset

 垂直于原先的 
\begin_inset Formula $\sbf A$
\end_inset

–
\begin_inset Formula $\sbf B$
\end_inset

 平面。
\end_layout

\begin_layout Subsection
坐标转动变换
\end_layout

\begin_layout Enumerate
旧坐标系下矢量记为 
\begin_inset Formula $X$
\end_inset

（例如全局坐标系），坐标基矢组为 
\begin_inset Formula $[\sbf e]$
\end_inset

；
\end_layout

\begin_layout Enumerate
新坐标系下矢量记为 
\begin_inset Formula $Y$
\end_inset

（例如局域坐标系）；坐标基矢组为 
\begin_inset Formula $[\sbf f]$
\end_inset

；
\end_layout

\begin_layout Enumerate
新旧坐标的 转动变换 矩阵为 
\begin_inset Formula $R$
\end_inset

，
\begin_inset Formula $R^{-1}=R^{T}$
\end_inset

，
\begin_inset Formula $R.R^{T}=\symbb1$
\end_inset

，为正交矩阵。
\end_layout

\begin_layout Standard
将坐标分量表示记为列矢量，约定 
\begin_inset Formula $Y=R.X$
\end_inset

，则
\begin_inset Formula 
\begin{align}
 & Y_{i}=R_{ij}X_{j}\label{eq:coordTrans}\\
 & X_{k}=R_{ki}^{-1}Y_{i}\nonumber 
\end{align}

\end_inset

同一矢量在两坐标系下具有不同的表示形式，但本质相同：
\begin_inset Formula 
\[
X_{i}\sbf e_{i}=Y_{j}\sbf f_{j}=R_{ji}X_{i}\sbf f_{j}
\]

\end_inset

从而得到 坐标基矢间的变换关系
\begin_inset Formula 
\[
\sbf e_{i}=\sbf f_{j}R_{ji},\quad\text{or}\quad\sbf f_{j}=\sbf e_{i}R_{ij}^{-1}
\]

\end_inset


\end_layout

\begin_layout Itemize
如果把坐标基矢组织到一起，可以写成行矩阵的形式：
\begin_inset Formula 
\[
[\begin{array}{ccc}
e_{1} & e_{2} & e_{3}\end{array}]=[\begin{array}{ccc}
f_{1} & f_{2} & f_{3}\end{array}].[R]
\]

\end_inset


\end_layout

\begin_layout Itemize
另一方面，坐标基矢本身可以用分量表示；新坐标系的基矢 
\begin_inset Formula $\sbf f_{1}$
\end_inset

 在新系的形式显然为 
\begin_inset Formula $[1,0,0]$
\end_inset

，根据 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:coordTrans"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\left[\begin{array}{c}
f_{1,1}\\
f_{1,2}\\
f_{1,3}
\end{array}\right]=R^{-1}\left[\begin{array}{c}
1\\
0\\
0
\end{array}\right],
\]

\end_inset

根据约定，
\begin_inset Formula $\left[f_{11},f_{12},f_{13}\right]^{T}$
\end_inset

 是新系基矢 
\begin_inset Formula $\sbf f_{1}$
\end_inset

 在旧系下的分量形式；而 式子右边相当于 
\begin_inset Formula $R^{-1}$
\end_inset

 的第一列。
\end_layout

\begin_layout Itemize
所以 
\begin_inset Formula $R^{-1}$
\end_inset

 的每一列，刚好是新基矢在旧坐标系下的分量形式。同理，
\begin_inset Formula $R$
\end_inset

的每一列是旧系基矢在新系下的分量形式。
\end_layout

\begin_layout Example
如果 
\begin_inset Formula $R$
\end_inset

 矩阵：旧坐标 
\begin_inset Formula $\stackrel{R}{\to}$
\end_inset

 新坐标（带撇的量）；或者说 
\begin_inset Formula $R$
\end_inset

 将新坐标用旧坐标表示，则
\begin_inset Formula 
\begin{align*}
 & X^{\prime}=RX,\quad\sbf e_{j}^{\prime}=\sbf e_{i}R_{ij}^{-1}\\
 & T^{\prime}=RTR^{-1}
\end{align*}

\end_inset


\begin_inset Formula $R^{-1}$
\end_inset

 的每一列，是 新系基矢 
\begin_inset Formula $\sbf e'$
\end_inset

 在旧系下的 分量形式；
\begin_inset Formula $R$
\end_inset

的每一列是旧系基矢 
\begin_inset Formula $\sbf e$
\end_inset

 在新系下的分量形式。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
新旧名称是相对的。所以等价地，如果 
\begin_inset Formula $U$
\end_inset

 矩阵：新坐标 
\begin_inset Formula $\stackrel{U}{\to}$
\end_inset

 旧坐标；或者说 
\color blue

\begin_inset Formula $U$
\end_inset

 将 旧坐标 用 新坐标表示
\color inherit
，
\begin_inset Formula 
\begin{align*}
 & X=UX^{\prime},\quad\sbf e_{j}=\sbf e_{i}^{\prime}U_{ij}^{-1}\\
 & T=UT^{\prime}U^{-1}
\end{align*}

\end_inset


\begin_inset Formula $U^{-1}$
\end_inset

的每一列是 旧系基矢 
\begin_inset Formula $\sbf e$
\end_inset

 在新系下的 分量形式；
\color blue

\begin_inset Formula $U$
\end_inset

 的每一列是新系 基矢在 旧系 下的分量形式
\color inherit
。
\end_layout

\begin_layout Section
快速傅立叶
\end_layout

\begin_layout Example
\begin_inset CommandInset href
LatexCommand href
name "FFT 超详解"
target "https://zhuanlan.zhihu.com/p/347091298"
literal "false"

\end_inset


\end_layout

\begin_layout Section
格林公式
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "从格林公式到柯西公式"
target "https://zhuanlan.zhihu.com/p/86297231"
literal "false"

\end_inset


\end_layout

\begin_layout Remark
关于曲线积分符号的规定，是由于物理界盛行右手定则，可能对数学符号规定方面造成了一定影响。所以对于曲线积分的符号做如下规定：当沿着区域的边界移动时，区域内部在你的
左侧，则符号为正。所以如果是环状结构的区域，外圈逆时针积分为正，内圈顺时针积分为正。所有没有标注顺时针还是逆时针的积分曲线（主要是公式中），默认取正方向。
\end_layout

\begin_layout Standard
格林公式为：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\oint_{C}P\dd{x}+Q\dd{y}=\iint_{D}\left(\frac{\partial Q}{\partial x}-\frac{\partial P}{\partial y}\right)\dd{x}\dd{y}
\]

\end_inset

其中，
\begin_inset Formula $D$
\end_inset

 是一单连通区域， 
\begin_inset Formula $C$
\end_inset

 是该区域的边界。它说一个闭区域边界上的曲线积分，等于被积函数经过一种操作以后在面积上积分。下面我们讨论两点：
\end_layout

\begin_layout Enumerate
因为要将原被积函数
\begin_inset Formula $f$
\end_inset

实现在
\begin_inset Formula $D$
\end_inset

上的积分，并且出现了导数结构，自然要求原被积函数
\begin_inset Formula $f$
\end_inset

需要在
\begin_inset Formula $D$
\end_inset

上定义，各偏导数都存在，且偏导数与函数在
\begin_inset Formula $D$
\end_inset

上都连续。
\end_layout

\begin_layout Enumerate
这个式子只能在单连通区域(没有“洞”)成立，所以对于复连通区域(有“洞”)，这个“洞”也叫奇点，就是不满足条件1的点。可以给奇点外面加一个边界形成一个新的、具有
两个边界的复连通区域，就像这样：
\begin_inset CommandInset href
LatexCommand href
name "region"
target "https://pic2.zhimg.com/80/v2-2d2a90cfd2925bb1b17def74806a8aa5_720w.webp"
literal "false"

\end_inset


\end_layout

\begin_layout Subsection
二维散度定理
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "2D Divergence Theorem [KhanAcademy]"
target "https://www.bilibili.com/video/BV15k4y1r7Uq?p=2&vd_source=a7a8fe02bc1634566f069ff312b17c99"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
假设 
\begin_inset Formula $\sbf v$
\end_inset

 是一矢量场，
\begin_inset Formula $C$
\end_inset

 是单连通区域
\begin_inset Formula $D$
\end_inset

的边界曲线，则
\begin_inset Formula $\sbf v$
\end_inset

沿逆时针对曲线法向单位矢量
\begin_inset Formula $\sbf n$
\end_inset

的内积的线积分： 
\begin_inset Formula 
\begin{align*}
\oint_{C}\sbf v\cdot\sbf n\dd{\ell} & =\oint_{C}\sbf v\cdot\frac{\left(\dd{y},-\dd{x}\right)}{\dd\ell}\\
 & =\oint_{C}v_{x}\dd{y}-v_{y}\dd{x}\\
\text{by Green Theorem}\; & =\iint_{D}\left(\frac{\partial v_{x}}{\partial x}+\frac{\partial v_{y}}{\partial y}\right)\dd{x}\dd{y}
\end{align*}

\end_inset

即二维情形的散度定理：
\begin_inset Formula $\oint_{C}\sbf v\cdot\sbf n\dd{\ell}=\iint_{D}\nabla\cdot\sbf v\dd{A}$
\end_inset

。以上使用了曲线法向的表达式 
\begin_inset Formula $\left(\dd{y},-\dd{x}\right)/\dd{\ell}$
\end_inset

和格林环路定理。
\end_layout

\begin_layout Section
一般曲线坐标系
\end_layout

\begin_layout Standard
在一般曲线正交坐标系中，空间一点
\begin_inset Formula $P$
\end_inset

的位置用三个坐标
\begin_inset Formula $u_{1}$
\end_inset

，
\begin_inset Formula $u_{2}$
\end_inset

和 
\begin_inset Formula $u_{3}$
\end_inset

表示。沿这些坐标增加方向的单位矢量为 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

。沿着三个方向的线元为
\begin_inset Formula 
\begin{equation}
\dd{\ell_{1}}=h_{1}\dd{u_{1}},\quad\dd{\ell_{2}}=h_{2}\dd{u_{2}},\quad\dd{\ell_{3}}=h_{3}\dd{u_{3}}.\label{eq:shI1.27}
\end{equation}

\end_inset

其中 
\begin_inset Formula $h_{1}$
\end_inset

，
\begin_inset Formula $h_{2}$
\end_inset

，
\begin_inset Formula $h_{3}$
\end_inset

一般为坐标的函数。在 
\begin_inset Formula $P$
\end_inset

 点上任一矢量可以写为
\begin_inset Formula 
\begin{equation}
\sbf f=f_{1}\sbf e_{1}+f_{2}\sbf e_{2}+f_{3}\sbf e_{3}\label{eq:sh.28}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
对于任意曲面，且对于上面任意一点
\begin_inset Formula $P$
\end_inset

，选择任意两条通过 
\begin_inset Formula $P$
\end_inset

 点的曲线，可以确定两条（不平行的）切线，可以确定切面；
\end_layout

\begin_layout Enumerate
然后也可以确定
\begin_inset Formula $P$
\end_inset

点处的法线，选为 
\begin_inset Formula $w$
\end_inset

 方向，在切面上选取 
\begin_inset Formula $u$
\end_inset

，
\begin_inset Formula $v$
\end_inset

 方向（有一定自由度）。
\end_layout

\begin_layout Enumerate
加入当前的线元表达式为
\begin_inset Formula 
\[
\dd{\ell_{1}}=h_{1}\dd{u_{1}},\quad\dd{\ell_{2}}=h_{2}\dd{u_{2}},\quad\dd{\ell_{3}}=h_{3}\dd{u_{3}},
\]

\end_inset

通过适当的坐标变换，令
\begin_inset Formula 
\[
\dd{\ell_{1}}=\dd{u},\quad\dd{\ell_{2}}=\dd{v},\quad\dd{\ell_{3}}=\dd{w}.
\]

\end_inset

即 
\begin_inset Formula $u$
\end_inset

，
\begin_inset Formula $v$
\end_inset

，
\begin_inset Formula $w$
\end_inset

 组成局域笛卡尔正交系，尽管不一定能找到显式的变换。
\end_layout

\begin_layout Standard
在曲线正交坐标系中有一般公式
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\nabla\psi=\frac{1}{h_{1}}\partial_{1}\psi\,\sbf e_{1}+\frac{1}{h_{2}}\partial_{2}\psi\,\sbf e_{2}+\frac{1}{h_{3}}\partial_{3}\psi\,\sbf e_{3}\label{eq:shI.29}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sbf f=\frac{1}{h_{1}h_{2}h_{3}}\left[\partial_{1}\left(h_{2}h_{3}f_{1}\right)+\partial_{2}\left(h_{3}h_{1}f_{2}\right)+\partial_{3}\left(h_{1}h_{2}f_{3}\right)\right]\label{eq:shI.30}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
\nabla^{2}\psi=\frac{1}{h_{1}h_{2}h_{3}}\left[\partial_{1}\left(\frac{h_{2}h_{3}}{h_{1}}\partial_{1}\psi\right)+\partial_{2}\left(\frac{h_{3}h_{1}}{h_{2}}\partial_{2}\psi\right)+\partial_{3}\left(\frac{h_{1}h_{2}}{h_{3}}\partial_{3}\psi\right)\right]\label{eq:shI.32}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nabla^{2}\psi=\frac{1}{h_{3}}\left[\partial_{1}\left(h_{3}\partial_{1}\psi\right)+\partial_{2}\left(h_{3}\partial_{2}\psi\right)+\partial_{3}\left(\frac{1}{h_{3}}\partial_{3}\psi\right)\right]
\]

\end_inset


\end_layout

\begin_layout Example
柱坐标下：
\begin_inset Formula 
\[
\nabla^{2}\psi=\frac{1}{r}\partial_{r}\left(r\partial_{r}\psi\right)+\frac{1}{r^{2}}\partial_{\phi}^{2}\psi+\partial_{z}^{2}\psi
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\nabla\times\sbf f=\left(\frac{1}{r}\partial_{\phi}f_{z}-\partial_{z}f_{\phi}\right)\sbf e_{r}+\left(\partial_{z}f_{r}-\partial_{r}f_{z}\right)\sbf e_{\phi}+\frac{1}{r}\left[\partial_{r}(rf_{\phi})-\partial_{\phi}f_{r}\right]\sbf e_{z}\label{eq:gI.36}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
球坐标下：
\begin_inset Formula 
\begin{align}
\nabla\times\sbf f=\frac{1}{r\sin\theta}\left[\partial_{\theta}(\sin\theta f_{\phi})-\partial_{\phi}f_{\theta}\right]\sbf e_{r}+\frac{1}{r}\left[\frac{1}{\sin\theta}\partial_{\phi}f_{r}-\partial_{r}(rf_{\phi})\right]\sbf e_{\theta}+\frac{1}{r}\left[\partial_{r}(rf_{\theta})-\partial_{\theta}f_{r}\right]\sbf e_{\phi}\label{eq:gI.41}
\end{align}

\end_inset


\end_layout

\begin_layout Section
广义斯托克斯公式
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "广义斯托克斯公式"
target "https://blog.csdn.net/MamiyaHasaki/article/details/119297305"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
格林公式（闭区域
\begin_inset Formula $D$
\end_inset

由光滑曲线
\begin_inset Formula $L$
\end_inset

围成，若
\begin_inset Formula $P(x,y)$
\end_inset

，
\begin_inset Formula $Q(x,y)$
\end_inset

在
\begin_inset Formula $D$
\end_inset

上有一阶连续偏导数），
\begin_inset Formula $L$
\end_inset

方向取右手螺旋；是Stokes公式的二维投影；
\begin_inset Formula 
\[
\oint_{L}\left(P,Q\right)\cdot\dd{\sbf\ell}=\oint_{L}P\dd{x}+Q\dd{y}=\iint_{D}\left(\partial_{x}Q-\partial_{y}P\right)\dd{x}\dd{y}
\]

\end_inset

以及对偶公式，其中
\begin_inset Formula $\hat{\sbf n}$
\end_inset

表示边界的外法向。
\begin_inset Formula 
\[
\oint_{L}\left(P,Q\right)\cdot\hat{\sbf n}\dd{\ell}=\oint_{L}P\dd{y}+Q(-\dd{x})=\iint_{D}\left(\partial_{x}P+\partial_{y}Q\right)\dd{x}\dd{y}
\]

\end_inset


\end_layout

\begin_layout Enumerate
梯度定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\dd{V}\nabla\phi=\oint_{S}\dd{\sbf S}\phi\label{eq:jA.13}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
散度定理（高斯定理）：
\begin_inset Formula 
\begin{equation}
\int_{V}\dd{V}\nabla\cdot\sbf A=\oint_{S}\dd{\sbf S}\cdot\sbf A\label{eq:jA.14}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
旋度定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\dd{V}\nabla\times\sbf A=\oint_{S}\dd{\sbf S}\times\sbf A\label{eq:jA.15}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
叉乘–梯度定理：
\begin_inset Formula 
\begin{equation}
\int_{S}\dd{\sbf S}\times\nabla\phi=\oint_{C}\dd{\sbf\ell}\,\phi\label{eq:jA.16}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
斯托克斯（stokes）定理：
\begin_inset Formula 
\begin{equation}
\int_{S}\dd{\sbf S}\nabla\times\sbf A=\oint_{C}\dd{\sbf\ell}\cdot\sbf A\label{eq:jA.17}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
叉乘–nabla–叉乘定理：
\begin_inset Formula 
\begin{equation}
\int_{S}\dd{\sbf S}\times\nabla\times\sbf A=\oint_{C}\dd{\sbf\ell}\times\sbf A\label{eq:jA.18}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
第一标量格林定理
\begin_inset Formula 
\begin{equation}
\int_{V}\left[a\nabla\cdot{\color{blue}(u\nabla b)}+u(\nabla a)\cdot(\nabla b)\right]\dd{V}=\oint_{S}\,a{\color{blue}u\frac{\partial b}{\partial n}}\dd{S}\label{eq:jA.19}
\end{equation}

\end_inset


\begin_inset Formula $u=1$
\end_inset

的简化形式为：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[a{\color{blue}(\nabla^{2}b)}+(\nabla a)\cdot(\nabla b)\right]\dd{V}=\oint_{S}\,a{\color{blue}\frac{\partial b}{\partial n}}\dd{S}\label{eq:jA.19b}
\end{equation}

\end_inset

简记：
\begin_inset Formula $\nabla\cdot(a\nabla b)$
\end_inset

 展开会得到
\begin_inset Formula $a{\color{blue}(\nabla^{2}b)}+(\nabla a)\cdot(\nabla b)$
\end_inset

 两项，它的体积分等于 
\begin_inset Formula $a{\color{blue}\frac{\partial b}{\partial n}}$
\end_inset

 的面积分，即高斯定理或分部积分；还可以加上调料
\begin_inset Formula $u$
\end_inset

，一般就对应介电常数
\begin_inset Formula $\varepsilon$
\end_inset

。通过此等式，可以转移
\begin_inset Formula $\nabla$
\end_inset

算符。
\end_layout

\begin_layout Enumerate
第二标量格林定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[a\nabla\cdot{\color{blue}(u\nabla b)}-b\nabla\cdot{\color{brown}(u\nabla a)}\right]\dd{V}=\oint_{S}\,u({\color{blue}a\frac{\partial b}{\partial n}}{\color{brown}-b\frac{\partial a}{\partial n}})\dd{S}\label{eq:jA.20}
\end{equation}

\end_inset


\begin_inset Formula $u=1$
\end_inset

的简化形式为：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[a{\color{blue}(\nabla^{2}b)}-b{\color{brown}(\nabla^{2}a)}\right]\dd{V}=\oint_{S}\,({\color{blue}a\frac{\partial b}{\partial n}}{\color{brown}-b\frac{\partial a}{\partial n}})\dd{S}\label{eq:jA.20b}
\end{equation}

\end_inset

简记：
\begin_inset Formula $a{\color{blue}(\nabla^{2}b)}-b{\color{brown}(\nabla^{2}a)}$
\end_inset

是个对易式，它的体积分等于 
\begin_inset Formula ${\color{blue}a\frac{\partial b}{\partial n}}{\color{brown}-b\frac{\partial a}{\partial n}}$
\end_inset

 的面积分，后者也是个对易式；还可以加上调料
\begin_inset Formula $u$
\end_inset

，一般就对应介电常数
\begin_inset Formula $\varepsilon$
\end_inset

。
\end_layout

\begin_layout Enumerate
第一矢量格林定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[u{\color{blue}(\nabla\times\sbf a)}\cdot{\color{brown}(\nabla\times\sbf b)}-{\color{blue}\sbf a}\cdot(\nabla\times{\color{brown}u\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,u({\color{blue}\sbf a}\times{\color{brown}\nabla\times\sbf b})\cdot\sbf n\dd{S}\label{eq:jA.21}
\end{equation}

\end_inset


\begin_inset Formula $u=1$
\end_inset

的简化形式为：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[{\color{blue}(\nabla\times\sbf a)}\cdot{\color{brown}(\nabla\times\sbf b)}-{\color{blue}\sbf a}\cdot(\nabla\times{\color{brown}\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,({\color{blue}\sbf a}\times{\color{brown}\nabla\times\sbf b})\cdot\sbf n\dd{S}\label{eq:jA.21b}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
第二矢量格林定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[\sbf b\cdot(\nabla\times u{\color{blue}\nabla\times\sbf a})-\sbf a\cdot(\nabla\times u{\color{brown}\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,u(\sbf a\times{\color{brown}\nabla\times\sbf b}-\sbf b\times{\color{blue}\nabla\times\sbf a})\cdot\sbf n\dd{S}\label{eq:jA.22}
\end{equation}

\end_inset


\begin_inset Formula $u=1$
\end_inset

的简化形式为：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[\sbf b\cdot(\nabla\times{\color{blue}\nabla\times\sbf a})-\sbf a\cdot(\nabla\times{\color{brown}\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,(\sbf a\times{\color{brown}\nabla\times\sbf b}-\sbf b\times{\color{blue}\nabla\times\sbf a})\cdot\sbf n\dd{S}\label{eq:jA.22b}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
矢量运算的几何
\end_layout

\begin_layout Standard
高斯公式和斯托克斯公式
\begin_inset Formula 
\begin{align*}
{\color{blue}\sbf D}\cdot\dd{S}\quad & \Leftrightarrow\quad{\color{blue}\nabla\cdot\sbf D}\,\dd{V}\\
{\color{blue}\sbf A}\cdot\dd{\sbf\ell}\quad & \Leftrightarrow\quad{\color{blue}\nabla\times\sbf A}\cdot\,\dd{\sbf S}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fig-divergence.png
	lyxscale 25
	scale 50

\end_inset


\begin_inset Graphics
	filename inset/fig-curl.png
	lyxscale 25
	scale 40

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
散度和旋度
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Paragraph
散度——Box
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nabla\cdot\sbf D=\partial_{x}D_{x}+\partial_{y}D_{y}+\partial_{z}D_{z}
\]

\end_inset

差分表达式为
\begin_inset Formula 
\[
\lim_{\Delta V\to0}\frac{\left(D_{x+\Delta x}-D_{x}\right)\dd{S_{x}}+\left(D_{y+\Delta y}-D_{y}\right)\dd{S_{y}}+\left(D_{z+\Delta z}-D_{z}\right)\dd{S_{z}}}{\Delta V},\quad\Delta V=\Delta x\Delta y\Delta z
\]

\end_inset


\end_layout

\begin_layout Itemize
几何上，
\begin_inset Formula $0$
\end_inset

阶量是通过一个 Box 的流量的difference。当
\begin_inset Formula $\Delta V\to0$
\end_inset

，Box 收缩到一个点
\begin_inset Formula $(x,y,z)$
\end_inset

，就是散度
\begin_inset Formula $\nabla\cdot\sbf D$
\end_inset

的定义。
\end_layout

\begin_layout Itemize
边界条件的情形：当 Box 跨过边界，则可选取细长Box；即令
\begin_inset Formula $x$
\end_inset

方向两个面比较大，其他面很窄，则通量的主要贡献在
\begin_inset Formula $x$
\end_inset

面上，其他面忽略不计。再考虑到
\begin_inset Formula $x$
\end_inset

面可以任意变形，从而得到
\series bold
每一点上
\series default
满足
\begin_inset Formula $D_{2n}=D_{1n}$
\end_inset

 类型的边界条件。
\end_layout

\begin_layout Paragraph
旋度——回路
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/fig-curl2.png
	lyxscale 20
	scale 50

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nabla\times\sbf A=\left({\color{blue}\left[\partial,A\right]_{y,z}},\left[\partial,A\right]_{z,x},\left[\partial,A\right]_{x,y}\right)
\]

\end_inset

其中反对称记号
\begin_inset Formula $\left[\partial,A\right]_{y,z}=\partial_{y}A_{z}-\partial_{z}A_{y}$
\end_inset

。差分表达式为（
\begin_inset Formula $\dd{\ell_{x}}$
\end_inset

表示沿着
\begin_inset Formula $x$
\end_inset

轴正方向）
\begin_inset Formula 
\[
\lim_{\Delta S\to0}\frac{(A_{3;y+\Delta y}-A_{3;y})\dd{\ell_{z}}-(A_{2;z+\Delta z}-A_{2;z})\dd{\ell_{y}}}{\Delta S},\quad\Delta S=\Delta y\Delta z
\]

\end_inset


\end_layout

\begin_layout Itemize
几何上，
\begin_inset Formula $0$
\end_inset

阶量是矢量在Ring上的积分。当
\begin_inset Formula $\Delta S\to0$
\end_inset

，Ring 收缩到一个点
\begin_inset Formula $(x,y,z)$
\end_inset

，就是旋度
\begin_inset Formula $\nabla\times\sbf A$
\end_inset

沿着这个方向的分量。
\end_layout

\begin_layout Itemize
边界条件的情形，当 Ring 跨过边界，则可选取细长回路。即令上图中沿
\begin_inset Formula $z$
\end_inset

方向的回路长，令
\begin_inset Formula $y$
\end_inset

方向的回路短，从而
\begin_inset Formula $y$
\end_inset

回路可以忽略。再考虑到回路可以任意变形，从而得到
\series bold
每一点上
\series default
满足 
\begin_inset Formula $A_{2t}=A_{1t}$
\end_inset

 类型的边界条件。
\begin_inset Formula $y,z$
\end_inset

方向的边界同理。
\end_layout

\begin_layout Section
代数基本定理
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "代数基本定理-zhihu"
target "https://zhuanlan.zhihu.com/p/34926001"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $n$
\end_inset

次代数方程
\begin_inset Formula 
\[
f(z)=a_{n}z^{n}+a_{n-1}z^{n-1}+\cdots a_{1}z+a_{0}=0,\quad(a_{n}\neq0,\,n\ge1)
\]

\end_inset

在复数域上恰有
\begin_inset Formula $n$
\end_inset

个根。
\end_layout

\begin_layout Standard
只要证明
\begin_inset Formula $n$
\end_inset

次多项式存在一个根，则可知
\begin_inset Formula $n-1$
\end_inset

次也存在一个根，通过归纳法即可证明。
\end_layout

\begin_layout Itemize
第一步先证：当
\begin_inset Formula $R$
\end_inset

足够大，圆周
\begin_inset Formula $C_{R}$
\end_inset

（圆心位于原点，半径为
\begin_inset Formula $R$
\end_inset

）在
\begin_inset Formula $f$
\end_inset

 下的像是把原点围绕在内部的封闭曲线。通过多项式在
\begin_inset Formula $z\to\infty$
\end_inset

时主要由
\begin_inset Formula $a_{n}z^{n}$
\end_inset

项决定。
\end_layout

\begin_layout Itemize
第二步注意到：当
\begin_inset Formula $R\to0$
\end_inset

时，圆周
\begin_inset Formula $C_{R}$
\end_inset

收缩到原点，故封闭曲线 
\begin_inset Formula $f(C_{R})$
\end_inset

会连续收缩到一个单点
\begin_inset Formula $a_{0}$
\end_inset

。初始时刻原点和
\begin_inset Formula $a_{0}$
\end_inset

都落在封闭曲线内，由于收缩过程连续并且收缩到单点，所以过程中必有某一时刻过原点。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/algebra1.jpg
	lyxscale 60
	scale 35

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
aaa
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
勒让德多项式
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
P_{n}(x)=\frac{1}{2^{n}n!}\frac{\dd[n]}{\dd{x^{n}}}\left(x^{2}-1\right)^{n}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $P_{n}(x)$
\end_inset

 在
\begin_inset Formula $[-1,1]$
\end_inset

 上有
\begin_inset Formula $n$
\end_inset

个不重合的零点。
\begin_inset Formula $P_{n}(1)=1$
\end_inset

，
\begin_inset Formula $P_{n}(-1)=(-1)^{n}$
\end_inset

。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $P_{n}(x)$
\end_inset

 和 
\begin_inset Formula $P_{n-1}(x)$
\end_inset

 的零点相互穿插，即在 
\begin_inset Formula $P_{n}(x)$
\end_inset

 的两相邻零点之间必有
\begin_inset Formula $P_{n-1}(x)$
\end_inset

 的一个零点，反之亦然。这些关于零点的性质是一般正交多项式都具有的普遍特性。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $P_{n}(x)$
\end_inset

 是
\begin_inset Formula $n$
\end_inset

阶多项式（最高幂次为
\begin_inset Formula $n$
\end_inset

），定义域 和 值域都是
\begin_inset Formula $[-1,1]$
\end_inset

。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Needs["NumericalDifferentialEquationAnalysis`"]; fLst = Array[CurryApplied[{2,
 1}][LegendreP][x], 15]; Plot[fLst, {x, -1, 1}]
\end_layout

\end_inset


\end_layout

\begin_layout Section
多维数组索引
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
n_{\text{offset}}=\sum_{k=0}^{N-1}s_{k}\,n_{k}
\]

\end_inset

其中
\begin_inset Formula 
\[
s_{k}^{\text{column}}=\text{itemsize}\prod_{j=0}^{k-1}d_{j},\quad s_{k}^{\text{row}}=\text{itemsize}\prod_{j=k+1}^{N-1}d_{j}.
\]

\end_inset

其中 
\begin_inset Formula $d_{j}=\mathrm{shape}[j]$
\end_inset

。
\end_layout

\begin_layout Section
FFT，快速傅立叶变换
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "https://zhuanlan.zhihu.com/p/110897470"
target "快速傅里叶变换"
literal "false"

\end_inset


\end_layout

\begin_layout Subsection
蝴蝶变换
\end_layout

\begin_layout Standard
不失一般性的，设
\begin_inset Formula $k$
\end_inset

为偶数。对于初始是
\begin_inset Formula 
\[
\omega_{n}^{0},\quad\omega_{n}^{1},\quad\omega_{n}^{2},\quad\cdots,\quad\omega_{n}^{k}
\]

\end_inset

的序列，在递归的第一层会将其拆分为 
\begin_inset Formula 
\[
\omega_{n}^{0},\quad\omega_{n}^{2},\quad\omega_{n}^{4},\quad\cdots,\quad\omega_{n}^{k}
\]

\end_inset

和 
\begin_inset Formula 
\[
\omega_{n}^{1},\quad\omega_{n}^{3},\quad\omega_{n}^{5},\quad\cdots,\quad\omega_{n}^{k}
\]

\end_inset

两部分。
\end_layout

\begin_layout Itemize
也就是说对于任意的 
\begin_inset Formula $\omega_{n}^{i}$
\end_inset

，若
\begin_inset Formula $i$
\end_inset

在二进制下最后一位为
\begin_inset Formula $0$
\end_inset

，则
\begin_inset Formula $\omega_{n}^{i}$
\end_inset

会被分配到前半部分，否则会被分配到后半部分。
\end_layout

\begin_layout Itemize
换言之，对于以
\begin_inset Formula $k/2$
\end_inset

为中心的，长度为
\begin_inset Formula $2*2^{k-j}$
\end_inset

的子序列，当前索引
\begin_inset Formula $i$
\end_inset

在二进制下的
\series bold
 倒数第
\begin_inset Formula $j$
\end_inset

位
\series default
 决定了它被放在长度为
\begin_inset Formula $2^{k-j}$
\end_inset

的前半部分，还是长度为 的
\begin_inset Formula $2^{k-j}$
\end_inset

后半部分。
\end_layout

\begin_layout Itemize
可以发现 
\begin_inset Formula $\omega_{n}^{i}$
\end_inset

 在最终的序列中的位置下标，相当于
\begin_inset Formula $i$
\end_inset

的二进制编码的逆序对应的数。
\end_layout

\begin_layout Itemize
所以我们先把每个数放到最后的位置上，然后不断两两求和，同时求出点值表示即可。
\end_layout

\begin_layout Example
我们以 
\begin_inset Formula $N=8$
\end_inset

的序列为例，
\begin_inset Formula $N=8$
\end_inset

的序列共进行了两次奇偶分组：
\end_layout

\begin_deeper
\begin_layout Itemize
进行分组之前的序号为： 
\begin_inset Formula $0,\;1,\;2,\;3,\;4,\;5,\;6,\;7$
\end_inset

。
\end_layout

\begin_layout Itemize
第一次分组之后的序号为： 
\begin_inset Formula $0,\;2,\;4,\;6,\;1,\;3,\;5,\;7$
\end_inset

。
\end_layout

\begin_layout Itemize
第二次分组之后的序号为： 
\begin_inset Formula $0,\;4,\;2,\;6,\;1,\;5,\;3,\;7$
\end_inset

。
\end_layout

\end_deeper
\begin_layout Example
之后按第二次分组的序号进行运算，最终得到的结果的序号是： 
\begin_inset Formula $0,\;1,\;2,\;3,\;4,\;5,\;6,\;7$
\end_inset

。如果我们将未分组之前的序号和第二次分组之后的序号进行二进制编码可以得到：
\begin_inset Formula 
\[
\begin{array}{ccccc}
0 & 000 & \quad & 0 & 000\\
1 & {\color{blue}001} & \quad & 4 & {\color{blue}100}\\
2 & 010 & \quad & 2 & 010\\
3 & {\color{blue}011} & \quad & 6 & {\color{blue}110}\\
4 & {\color{blue}100} & \quad & 1 & {\color{blue}001}\\
5 & 101 & \quad & 5 & 101\\
6 & {\color{blue}110} & \quad & 3 & {\color{blue}011}\\
7 & 111 & \quad & 7 & 111
\end{array}
\]

\end_inset


\end_layout

\begin_layout Remark
使用 FFT 算法的注意事项：
\end_layout

\begin_deeper
\begin_layout Itemize
信号离散时，采样频率为 Nyquist 频率；
\end_layout

\begin_layout Itemize
\begin_inset Formula $N$
\end_inset

必须为
\begin_inset Formula $2$
\end_inset

的整数次幂；
\end_layout

\begin_layout Itemize
数据长度必须足够长： 
\begin_inset Formula $\Delta f=\frac{1}{N\cdot T_{s}}$
\end_inset

。其中，
\begin_inset Formula $\Delta f$
\end_inset

 为数据分辨率； 
\begin_inset Formula $N$
\end_inset

为序列长度（序列点数）； 为采样周期， 
\begin_inset Formula $N\cdot T_{s}$
\end_inset

是数据的实际长度。
\end_layout

\end_deeper
\begin_layout Section
conforming FEM
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "Conforming and non-conforming FEM"
target "https://math.stackexchange.com/questions/3541532/conforming-and-non-conforming-fem"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
FEM 求解 variational 问题：寻找 
\begin_inset Formula $u\in V$
\end_inset

 such that 
\begin_inset Formula $a(u,v)=f(v)$
\end_inset

，
\begin_inset Formula $\forall v\in V$
\end_inset

，其中
\begin_inset Formula $a$
\end_inset

是bilinear, 
\begin_inset Formula $f$
\end_inset

线性。空间
\begin_inset Formula $V$
\end_inset

使用有限维空间
\begin_inset Formula $V_{h}$
\end_inset

近似。Conforming FEM 意味着
\begin_inset Formula $V_{h}\in V$
\end_inset

，即试探函数也属于
\begin_inset Formula $V$
\end_inset

。
\end_layout

\begin_layout Standard
通常情况下：
\begin_inset Formula $V=H^{1}(\Omega)$
\end_inset

，三角形网格，
\begin_inset Formula $V_{h}$
\end_inset

由在每条边上连续的函数组成， conformity 等价于 试探函数的连续性（continuity）。
\end_layout

\begin_layout Section
conforming mesh
\end_layout

\begin_layout Standard
refs：
\begin_inset CommandInset href
LatexCommand href
name "conformal-vs-non-conformal-mesh"
target "https://www.cfd-online.com/Forums/main/15242-conformal-vs-non-conformal-mesh.html"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "comsol_ref_mesh"
target "https://doc.comsol.com/5.5/doc/com.comsol.help.comsol/comsol_ref_mesh.15.04.html"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
conformal mesh 是指单元之间的几何形状和阶次一致的网格（例如，没有悬挂节点，并持有恒定的多项式阶次）。h–nonconforming
 意味着存在悬挂节点，p–nonconforming意味着多项式阶次不一致。conformal discretization 是指全局函数空间具有预期的正则性（
通常为 
\begin_inset Formula $H^{1}$
\end_inset

）。由于全局函数空间不在 
\begin_inset Formula $H^{1}$
\end_inset

 中（尽管在元素上是 
\begin_inset Formula $H^{1}$
\end_inset

），因此Discontinuous Galerkin 采用的是 nonconforming 离散化。您可以通过使用约束和消除约束自由度，在nonconformi
ng 网格上使用 conformal 离散化。
\end_layout

\begin_layout Standard
COMSOL Multiphysics 软件生成的网格是conforming mesh。在共形网格中，网格中任何两个单元之间的交集都是这两个单元的子单元（mes
h face, mesh edge, or mesh vertex），或者nothing。对于装配体类型的几何图形，此定义只对装配体的每个单独零件有效。nonc
onforming 网格（如导入网格）通常包含 “悬挂节点”（hanging nodes 见下图 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:comsol-8.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

）。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/comsol-mesh-hanging-nodes.png
	lyxscale 60
	scale 40

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
带有悬挂节点的网格
\begin_inset CommandInset label
LatexCommand label
name "fig:comsol-8.1"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Chapter
数值基础
\end_layout

\begin_layout Section
拉格朗日乘子法与罚方法
\end_layout

\begin_layout Standard
ref：
\begin_inset CommandInset href
LatexCommand href
name "拉格朗日乘子法和罚方法"
target "https://zhuanlan.zhihu.com/p/114555696"
literal "false"

\end_inset

。
\end_layout

\begin_layout Standard
有限元编程中，处理含有线性约束方程常用的有两种方法：拉格朗日乘子法和罚方法。
\end_layout

\begin_layout Standard
例如考虑下列线性方程组：
\begin_inset Formula 
\begin{equation}
K\phi=f\label{eq:mat1}
\end{equation}

\end_inset

有限元计算中，组装完总刚阵和载荷向量，并消去必要边界条件，就得到类似
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mat1"
plural "false"
caps "false"
noprefix "false"

\end_inset

的方程。当
\begin_inset Formula $\det[K]\neq0$
\end_inset

时，方程的解为
\begin_inset Formula 
\[
\phi=K^{-1}f.
\]

\end_inset

如果希望在模型的自由度之间施加一些额外约束，例如线性约束
\begin_inset Formula 
\begin{equation}
Q^{T}\phi=\phi^{T}Q=c,\label{eq:mat2}
\end{equation}

\end_inset

其中
\begin_inset Formula $Q^{T}$
\end_inset

是表示约束的行向量，
\begin_inset Formula $c$
\end_inset

是常数。这时候就可以采用拉格朗日乘子法，或者罚方法来施加约束。此时求出的解是满足约束方程条件下的势能泛函的极值点，也被称为拉格朗日条件极值。
\end_layout

\begin_layout Subsection
拉氏乘子法
\end_layout

\begin_layout Standard
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mat1"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的泛函显然为，
\begin_inset Formula 
\[
\mathcal{L}(\phi)=\frac{1}{2}\phi^{T}.K.\phi-\phi^{T}f
\]

\end_inset

其中
\begin_inset Formula $\phi,f$
\end_inset

是自由度和激励列向量，
\begin_inset Formula $K$
\end_inset

是刚阵。根据微积分求约束极值的思路，添加乘子项
\begin_inset Formula 
\[
\mathcal{L}(\phi)=\frac{1}{2}\phi^{T}.K.\phi-\phi^{T}f+\lambda\left(\phi^{T}Q-c\right)
\]

\end_inset

并且把
\begin_inset Formula $\lambda$
\end_inset

也当作自由度，求极值
\begin_inset Formula $\frac{\partial\mathcal{L}}{\partial\phi^{T}}$
\end_inset

和
\begin_inset Formula $\frac{\partial\mathcal{L}}{\partial\lambda}$
\end_inset

得到新方程组：
\begin_inset Formula 
\begin{align}
K.\phi+\lambda Q & =f\nonumber \\
Q^{T}\phi & =c\label{eq:mat3}
\end{align}

\end_inset

由于现在把
\begin_inset Formula $\lambda$
\end_inset

也当成独立自由度，可以考虑合并
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mat3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的两个方程
\begin_inset Formula 
\begin{equation}
\left[\begin{array}{cc}
K & Q\\
Q^{T} & 0
\end{array}\right]\left[\begin{array}{c}
\phi\\
\lambda
\end{array}\right]=\left[\begin{array}{c}
f\\
c
\end{array}\right]\label{eq:mat3b}
\end{equation}

\end_inset

这样又化归到简单形式：
\begin_inset Formula 
\[
K'.\phi'=f'
\]

\end_inset

可以用之前的方法求解。
\end_layout

\begin_layout Subsection
罚系数方法
\end_layout

\begin_layout Standard
罚系数法的思想是，通过引入系数
\begin_inset Formula $p$
\end_inset

，且
\begin_inset Formula $p$
\end_inset

远大于刚阵最大元素，将约束方程增幅后添加到原方程中。由于
\begin_inset Formula $p$
\end_inset

的存在，原先方程中的约束关系变得可以忽略。再写出约束条件
\begin_inset Formula 
\[
Q^{T}\phi=c
\]

\end_inset

但它左右都是数字，为了能够写成
\begin_inset Formula $Ax=b$
\end_inset

的形式，与原方程
\begin_inset Formula $K\phi=f$
\end_inset

相加，做变换
\begin_inset Formula 
\begin{equation}
QQ^{T}\phi=cQ\label{eq:mat4}
\end{equation}

\end_inset

并且乘上罚系数
\begin_inset Formula $p$
\end_inset


\begin_inset Formula 
\begin{equation}
pQQ^{T}\phi=cpQ\label{eq:mat5}
\end{equation}

\end_inset

这样可以把
\begin_inset Formula $pQQ^{T}$
\end_inset

理解成对刚阵的修正，
\begin_inset Formula $cpQ$
\end_inset

理解成对力向量的修正，
\begin_inset Formula 
\begin{equation}
\left(K+pQQ^{T}\right)\phi=f+cpQ\label{eq:mat6}
\end{equation}

\end_inset

同样去求解，得到的解也满足约束条件。
\end_layout

\begin_layout Standard
设
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mat3"
plural "false"
caps "false"
noprefix "false"

\end_inset

求出的解是
\begin_inset Formula $\phi_{0}$
\end_inset

，罚系数求出的解是
\begin_inset Formula $\phi_{1}$
\end_inset

，对方程稍作整理，得到它们满足的关系
\begin_inset Formula 
\begin{align*}
 & K\phi_{0}=f-\lambda_{0}Q\\
 & K\phi_{1}=f-pQ\left(Q^{T}\phi_{1}-c\right)
\end{align*}

\end_inset

由于罚方法得到的解只是近似的满足约束方程，设
\begin_inset Formula $Q^{T}\phi_{1}-c=pgQ$
\end_inset

，其中
\begin_inset Formula $g\neq0$
\end_inset

描述罚系数结果对约束条件的微小偏离。 则显然有
\begin_inset Formula 
\[
pg=\lambda_{0}
\]

\end_inset

即罚系数，误差和拉氏乘子值的关系。这里认为
\begin_inset Formula $K\phi_{0}$
\end_inset

和
\begin_inset Formula $K\phi_{1}$
\end_inset

的差距是更高阶的。
\end_layout

\begin_layout Section
ODE的欧拉方法
\end_layout

\begin_layout Standard
最简单的数值微商公式为：向前差商公式、向后差商公式以及中心差商公式。对应地，我们有求常微分方程数值解的向前Euler格式、向后Euler格式以及中心差分格式。一
阶常微分方程初值问题为
\begin_inset Formula 
\begin{equation}
\begin{cases}
y'(x)=f(x,y), & a\le x\le b\\
y(a)=y_{0}
\end{cases}\label{eq:eu1.1}
\end{equation}

\end_inset

其中
\begin_inset Formula $f$
\end_inset

是
\begin_inset Formula $x$
\end_inset

和
\begin_inset Formula $y$
\end_inset

的已知函数，
\begin_inset Formula $y_{0}$
\end_inset

是给定的初值。
\end_layout

\begin_layout Subsection
向前欧拉法
\end_layout

\begin_layout Standard

\series bold
向前Euler法
\series default
 是最简单的一种显式单步法。对于方程
\begin_inset Formula 
\[
y'(x)=f(x,y)
\]

\end_inset

自变量被离散成
\begin_inset Formula 
\[
x_{n}=x_{0}+nh,\quad n=0,1,2,\cdots
\]

\end_inset

用差商代替导数则得到方程的近似为：
\begin_inset Formula 
\begin{equation}
y_{n+1}\approx y_{n}+hf(x_{n},y_{n})\label{eq:eu2}
\end{equation}

\end_inset

其中
\begin_inset Formula $y_{n}=y(x_{0}+nh)$
\end_inset

。具体计算时由
\begin_inset Formula $x_{0}$
\end_inset

出发，根据初值，逐步递推而得到系列离散数值。
\end_layout

\begin_layout Subsection
向后欧拉法
\end_layout

\begin_layout Standard
若将函数
\begin_inset Formula $y(x)$
\end_inset

在
\begin_inset Formula $x_{n+1}$
\end_inset

处展开，
\begin_inset Formula 
\begin{equation}
y(x_{n+1})=y(x_{n})+hf\left(x_{n+1},y(x_{n+1})\right)-\frac{h^{2}}{2!}y''(\xi_{n})\label{eq:eu3}
\end{equation}

\end_inset

其中
\begin_inset Formula $x_{n}\le\xi_{n}\le x_{n+1}$
\end_inset

，略去高阶项得到 
\series bold
向后欧拉格式（方法）
\begin_inset Formula 
\begin{equation}
y_{n+1}=y_{n}+hf\left(x_{n+1},y_{n+1}\right),\quad n=0,1,\cdots,N-1\label{eq:eu4}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
改进欧拉法
\end_layout

\begin_layout Standard
Euler法计算量小，但是精度不高，为此可构造
\series bold
梯形公式
\series default
：
\begin_inset Formula 
\[
\begin{cases}
y_{n+1}=y_{n}+\frac{h}{2}\left[f(x_{n},y_{n})+f(x_{n+1},y_{n+1})\right]\\
y_{0}=\eta
\end{cases}
\]

\end_inset

其中
\begin_inset Formula $h=(b-a)/n$
\end_inset

。这是一个二阶方法，比 Euler法精度高。但是方程两边都有待求量 
\begin_inset Formula $y_{n+1}$
\end_inset

，因而是隐式差分方程。但可以用迭代法计算
\begin_inset Formula $y_{n+1}$
\end_inset

，初值由前向欧拉法
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu2"
plural "false"
caps "false"
noprefix "false"

\end_inset

提供，一般而言迭代一两次即可。
\begin_inset Formula 
\[
\begin{cases}
y_{n+1}^{(0)}=y_{n}+\frac{h}{2}f\left(x_{n},y_{n}\right),\\
y_{n+1}^{(k+1)}=y_{n}+\frac{h}{2}\left[f\left(x_{n},y_{n}\right)+f\left(x_{n+1},y_{n+1}^{(k)}\right)\right]. & k=0,1,2,\cdots
\end{cases}
\]

\end_inset

其中
\begin_inset Formula $y_{n+1}^{(k+1)}$
\end_inset

表示在
\begin_inset Formula $n+1$
\end_inset

时刻
\begin_inset Formula $y$
\end_inset

的
\begin_inset Formula $k+1$
\end_inset

阶修正的解。这实际上是一种预估–校正方法，改进的Euler法又称为 
\series bold
Heun方法
\series default
。参见
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:RK1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:pc1"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Section
龙格–库塔方法,Runge–Kutta
\end_layout

\begin_layout Standard
ref：数值分析–张平文
\begin_inset Formula 
\[
\begin{cases}
y'(x)=f(x,y), & a\le x\le b\\
y(a)=y_{0}
\end{cases}
\]

\end_inset


\end_layout

\begin_layout Subsection
RK方法的基本思想
\begin_inset CommandInset label
LatexCommand label
name "subsec:RK1"

\end_inset


\end_layout

\begin_layout Standard
设显式单步法的一般形式为
\begin_inset Formula 
\begin{equation}
y_{n+1}=y_{n}+h\varphi\left(x_{n},y_{n},f,h\right)\label{eq:eu5}
\end{equation}

\end_inset

其中
\begin_inset Formula $\varphi$
\end_inset

是理想斜率，用函数
\begin_inset Formula $f(x,y)$
\end_inset

 在
\begin_inset Formula $(x,y)$
\end_inset

 邻近一些点来组合
\begin_inset Formula $\varphi\left(x_{n},y_{n},f,h\right)$
\end_inset

，得到的相应的单步方法称为 
\series bold
Runge–Kutta 方法
\series default
。
\end_layout

\begin_layout Standard
取两个点 
\begin_inset Formula $(x,y)$
\end_inset

，
\begin_inset Formula $(x+a_{2}h,y+b_{21}hf(x,y))$
\end_inset

，作线性组合：
\begin_inset Formula 
\begin{equation}
\varphi\left(x_{n},y_{n},f,h\right)=c_{1}f(x,y)+c_{2}f\left(x+a_{2}h,y+b_{21}hf(x,y)\right),\label{eq:eu6}
\end{equation}

\end_inset

 其中系数
\begin_inset Formula $c_{1}$
\end_inset

，
\begin_inset Formula $c_{2}$
\end_inset

，
\begin_inset Formula $a_{2}$
\end_inset

，
\begin_inset Formula $b_{21}$
\end_inset

待定。这些数据的选取原则为，尽可能使 
\begin_inset Formula $y_{n}+h\varphi\left(x_{n},y_{n},f,h\right)$
\end_inset

与
\begin_inset Formula $y(x+h)$
\end_inset

在
\begin_inset Formula $x$
\end_inset

的 Taylor 展开有相同的项。
\end_layout

\begin_layout Standard
将
\begin_inset Formula $\varphi\left(x_{n},y_{n},f,h\right)$
\end_inset

和
\begin_inset Formula $y(x+h)$
\end_inset

同时在
\begin_inset Formula $x$
\end_inset

作Taylor展开，比较
\begin_inset Formula $h$
\end_inset

的同阶项，可以得到系数的约束方程
\begin_inset Formula 
\begin{equation}
\begin{cases}
c_{1}+c_{2}=1\\
a_{2}c_{2}=1/2\\
c_{2}b_{21}=1/2
\end{cases}\label{eq:eu7}
\end{equation}

\end_inset

方程组
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu7"
plural "false"
caps "false"
noprefix "false"

\end_inset

有无穷多组解。若取
\begin_inset Formula $c_{1}=c_{2}=1/2$
\end_inset

，
\begin_inset Formula $a_{2}=1$
\end_inset

，
\begin_inset Formula $b_{21}=1$
\end_inset

，对应的二阶（指截断误差）单步方法为
\begin_inset Formula 
\begin{equation}
\begin{cases}
y_{n+1}=y_{n}+\frac{h}{2}\left(K_{1}+K_{2}\right),\\
K_{1}=f\left(x_{n},y_{n}\right),\\
K_{2}=f\left(x_{n}+h,y_{n}+hK_{1}\right),
\end{cases}\label{eq:eu8}
\end{equation}

\end_inset

称之为 
\series bold
改进的Euler公式
\series default
。
\end_layout

\begin_layout Standard
若取方程组
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu7"
plural "false"
caps "false"
noprefix "false"

\end_inset

的另一组解
\begin_inset Formula 
\[
c_{1}=\frac{1}{4},\quad c_{2}=\frac{3}{4},\quad a_{2}=\frac{2}{3},\quad b_{21}=\frac{2}{3},
\]

\end_inset

对应的二阶单步方法为
\begin_inset Formula 
\begin{equation}
\begin{cases}
K_{1}=f\left(x_{n},y_{n}\right),\\
K_{2}=f\left(x_{n}+\frac{2}{3}h,y_{n}+\frac{2}{3}hK_{1}\right),\\
y_{n+1}=y_{n}+\frac{h}{4}\left(K_{1}+3K_{2}\right),
\end{cases}\label{eq:eu9}
\end{equation}

\end_inset

称之为 
\series bold
Huen公式
\series default
。
\end_layout

\begin_layout Standard
改进的Euler公式和Heun公式是典型的二阶Runge–Kutta方法。一般
\begin_inset Formula $m$
\end_inset

阶Runge–Kutta方法可仿照二阶方法构造。
\end_layout

\begin_layout Subsection
显式Runge–Kutta方法及稳定性
\end_layout

\begin_layout Standard
直接使用Taylor展开式来建立高阶差分公式时，差分方程比较复杂，也不适合实际的应用。为此 Runge（1895）提出了间接使用Taylor展开式来构造高精度数
值方法的思想：首先用函数
\begin_inset Formula $f$
\end_inset

在
\begin_inset Formula $m$
\end_inset

个点上的值的
\series bold
线性组合
\series default
来代替
\begin_inset Formula $y$
\end_inset

的导数，然后按Taylor级数展开，确定其中的组合系数，这样即可避免计算
\begin_inset Formula $y$
\end_inset

的高阶导数，又可保证差分方法具有较高精度。方法描述如下：
\end_layout

\begin_layout Definition
\begin_inset Argument 1
status open

\begin_layout Plain Layout
6.3.1
\end_layout

\end_inset

设
\begin_inset Formula $m$
\end_inset

是一个正整数，代表使用函数值
\begin_inset Formula $f$
\end_inset

的个数，
\begin_inset Formula $a_{i}$
\end_inset

，
\begin_inset Formula $b_{ij}$
\end_inset

（
\begin_inset Formula $i=2,3,\cdots,m$
\end_inset

；
\begin_inset Formula $j=1,2,\cdots,i-1$
\end_inset

）和
\begin_inset Formula $c_{i}$
\end_inset

（
\begin_inset Formula $i=1,2,\cdots,m$
\end_inset

）是一些待定的权因子（为实数），方法
\begin_inset Formula 
\begin{equation}
y_{n+1}=y_{n}+h\left(c_{1}K_{1}+\cdots+c_{m}K_{m}\right)\label{eq:eu3.6}
\end{equation}

\end_inset

被称为初值问题
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

的
\series bold

\begin_inset Formula $m$
\end_inset

级显式Runge–Kutta方法
\series default
，其中
\begin_inset Formula $K_{i}$
\end_inset

（
\begin_inset Formula $i=1,2,\cdots,m$
\end_inset

）满足下列方程：
\begin_inset Formula 
\begin{align}
 & K_{1}=f\left(x_{n},y_{n}\right),\nonumber \\
 & K_{2}=f\left(x_{n}+a_{2}h,y_{n}+hb_{21}K_{1}\right),\nonumber \\
 & \cdots\nonumber \\
 & K_{m}=f\left(x_{n}+a_{m}h,y_{n}+h\sum_{i=1}^{m-1}b_{mi}K_{i}\right).\label{eq:eu3.7}
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的系数可以这样确定：设问题
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu1.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

的解
\begin_inset Formula $y(x)$
\end_inset

和右端函数
\begin_inset Formula $f(x,y)$
\end_inset

充分光滑。首先将式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

的左端和右端各项在点
\begin_inset Formula $x_{n}$
\end_inset

处展成关于
\begin_inset Formula $h$
\end_inset

的Taylor级数，然后比较左、右两端
\begin_inset Formula $h$
\end_inset

的幂次，一直比较到幂次
\begin_inset Formula $p$
\end_inset

，建立等式关系，就得到确定
\begin_inset Formula $m$
\end_inset

级显式 Runge–Kutta方法中的系数满足的代数方程组，求出代数方程组的解也就得到
\begin_inset Formula $m$
\end_inset

阶Runge–Kutta方法，且精度为
\begin_inset Formula $p$
\end_inset

阶，称之为
\begin_inset Formula $m$
\end_inset

级（
\begin_inset Formula $m$
\end_inset

个组合点）
\begin_inset Formula $p$
\end_inset

阶（展开到
\begin_inset Formula $h^{p}$
\end_inset

）Runge–Kutta方法。显式Runge–Kutta公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

又可以写成如表
\begin_inset CommandInset ref
LatexCommand eqref
reference "tab:Butcher"
plural "false"
caps "false"
noprefix "false"

\end_inset

既直观又简洁的阵列形式（称为Butcher表）
\end_layout

\begin_layout Definition
\begin_inset Float table
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $0$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $a_{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{21}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $a_{3}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{31}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $a_{m}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{m1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{m2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{m(m-1)}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{m-1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{m}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Butcher表
\begin_inset CommandInset label
LatexCommand label
name "tab:Butcher"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Definition
对于
\begin_inset Formula $m=3,4$
\end_inset

的情形，可类似地推导出相应的高阶显式Runge–Kutta方法，这里仅列举几个常用的公式：
\end_layout

\begin_layout Enumerate
三级三阶显式Kutta 公式
\begin_inset Formula 
\begin{equation}
\begin{cases}
K_{1}=f\left(x_{n},y_{n}\right),\\
K_{2}=f\left(x_{n}+{\color{blue}\frac{1}{2}}h,y_{n}+{\color{blue}\frac{1}{2}}hK_{1}\right),\\
K_{3}=f\left(x_{n}+{\color{blue}1}h,y_{n}{\color{blue}-1}hK_{1}+{\color{blue}2}hK_{2}\right),\\
y_{n+1}=y_{n}+\frac{h}{6}\left({\color{blue}1}K_{1}+{\color{blue}4}K_{2}+{\color{blue}1}K_{3}\right);
\end{cases}\label{eq:eu3.8}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
三级三阶显式Heun 公式
\begin_inset Formula 
\begin{equation}
\begin{cases}
K_{1}=f\left(x_{n},y_{n}\right),\\
K_{2}=f\left(x_{n}+{\color{blue}\frac{1}{3}}h,y_{n}+{\color{blue}\frac{1}{3}}hK_{1}\right),\\
K_{3}=f\left(x_{n}+{\color{blue}\frac{2}{3}}h,y_{n}+{\color{blue}\frac{2}{3}}hK_{2}\right),\\
y_{n+1}=y_{n}+\frac{h}{4}\left({\color{blue}1}K_{1}+{\color{blue}3}K_{2}\right);
\end{cases}\label{eq:eu3.9}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
四级四阶古典显式Runge–Kutta 公式
\begin_inset Formula 
\begin{equation}
\begin{cases}
K_{1}=f\left(x_{n},y_{n}\right),\\
K_{2}=f\left(x_{n}+{\color{blue}\frac{1}{2}}h,y_{n}+{\color{blue}\frac{1}{2}}hK_{1}\right),\\
K_{3}=f\left(x_{n}+{\color{blue}\frac{1}{2}}h,y_{n}+{\color{blue}\frac{1}{2}}hK_{2}\right),\\
K_{4}=f\left(x_{n}+{\color{blue}1}h,y_{n}+{\color{blue}1}hK_{3}\right),\\
y_{n+1}=y_{n}+\frac{h}{6}\left({\color{blue}1}K_{1}+{\color{blue}2}K_{2}+{\color{blue}2}K_{3}+{\color{blue}1}K_{4}\right);
\end{cases}\label{eq:eu3.10}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
四级四阶显式Runge–Kutta 公式
\begin_inset Formula 
\begin{equation}
\begin{cases}
K_{1}=f\left(x_{n},y_{n}\right),\\
K_{2}=f\left(x_{n}+{\color{blue}\frac{1}{3}}h,y_{n}+{\color{blue}\frac{1}{3}}hK_{1}\right),\\
K_{3}=f\left(x_{n}+{\color{blue}\frac{2}{3}}h,y_{n}{\color{blue}-\frac{1}{3}}hK_{1}+{\color{blue}h}K_{2}\right),\\
K_{4}=f\left(x_{n}+{\color{blue}1}h,y_{n}+{\color{blue}1}hK_{1}{\color{blue}-1}hK_{2}+{\color{blue}1}hK_{3}\right),\\
y_{n+1}=y_{n}+\frac{h}{8}\left({\color{blue}1}K_{1}+{\color{blue}3}K_{2}+{\color{blue}3}K_{3}+{\color{blue}1}K_{4}\right);
\end{cases}\label{eq:eu3.11}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
四级四阶显式 Gill 公式
\begin_inset Formula 
\begin{equation}
\begin{cases}
K_{1}=f\left(x_{n},y_{n}\right),\\
K_{2}=f\left(x_{n}+{\color{blue}\frac{1}{2}}h,y_{n}+{\color{blue}\frac{1}{2}}hK_{1}\right),\\
K_{3}=f\left(x_{n}+{\color{blue}\frac{1}{2}}h,y_{n}+{\color{blue}\frac{\sqrt{2}-1}{2}}hK_{1}+{\color{blue}\left(1-\frac{\sqrt{2}}{2}\right)}hK_{2}\right),\\
K_{4}=f\left(x_{n}+{\color{blue}1}h,y_{n}{\color{blue}-\frac{\sqrt{2}}{2}}hK_{2}+{\color{blue}\left(1+\frac{\sqrt{2}}{2}\right)}hK_{3}\right),\\
y_{n+1}=y_{n}+\frac{h}{6}\left[{\color{blue}1}K_{1}+{\color{blue}\left(2-\sqrt{2}\right)}K_{2}+{\color{blue}\left(2+\sqrt{2}\right)}K_{3}+{\color{blue}1}K_{4}\right];
\end{cases}\label{eq:eu3.12}
\end{equation}

\end_inset

Gill公式有减少舍入误差的优点。最常用的 Runge–Kutta公式是
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.10"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
一般地，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.10"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的系数满足
\begin_inset Formula 
\[
\sum_{j=1}^{m}c_{j}=1;\quad a_{i}=\sum_{j=1}^{i-1}b_{ij},\quad i=2,3,\cdots,m
\]

\end_inset

表6.3是Butcher（1965）做出的各级显式 Runge–Kutta 方法最高精度的结果。从表6.3中可以看出，Runge–Kutta方法的级数从
\begin_inset Formula $4$
\end_inset

变成
\begin_inset Formula $5$
\end_inset

时，精度的阶数并没有相应地从
\begin_inset Formula $4$
\end_inset

提高到
\begin_inset Formula $5$
\end_inset

.这就是为什么
\begin_inset Formula $4$
\end_inset

级以上的 Runge–Kutta方法很少被采用的原因。
\end_layout

\begin_layout Standard
\begin_inset Float table
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="9">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
级数
\begin_inset Formula $m$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $3$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $4$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $5$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $6$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $7$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $m\ge8$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
精度阶数
\begin_inset Formula $p$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $3$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $4$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $4$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $5$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $6$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $p\le m-2$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
各级显式Runge–Kutta方法最高精度
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $m$
\end_inset

阶Runge–Kunta方法的绝对稳定域为
\begin_inset Formula 
\[
\abs{1+\lambda h+\frac{1}{2!}\left(\lambda h\right)^{2}+\cdots+\frac{1}{m!}\left(\lambda h\right)^{m}}<1,
\]

\end_inset

即同阶的不同格式具有相同的绝对稳定域。图6.2给出了各阶 Runge–Kutta 方法的显式绝对稳定域，值得注意的是三、四阶 Runge–Kutta方法的显式绝对
稳定域包含了一段虚轴。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\backslash
[Lambda]h := x + y I fn1 := 1 + 
\backslash
[Lambda]h; fn2 := 1 + 
\backslash
[Lambda]h + 1/2 
\backslash
[Lambda]h^2; fn3 := 1 + 
\backslash
[Lambda]h + 1/2 
\backslash
[Lambda]h^2 + 1/3! 
\backslash
[Lambda]h^3; fn4 := 1 + 
\backslash
[Lambda]h + 1/2 
\backslash
[Lambda]h^2 + 1/3! 
\backslash
[Lambda]h^3 + 1/4! 
\backslash
[Lambda]h^4; RegionPlot[ { Abs@fn1 <= 1, Abs@fn2 <= 1, Abs@fn3 <= 1, Abs@fn4
 <= 1 }, {x, -3, 1}, {y, -3, 3}, PlotLabels -> {1, 2, 3, 4}, ImageSize ->
 Medium ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/Runge-Kutta1.png
	lyxscale 80
	scale 60

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
显式 Runge–Kutta方法的绝对稳定域。
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
隐式Runge–Kutta方法
\end_layout

\begin_layout Definition
设
\begin_inset Formula $a_{i}$
\end_inset

，
\begin_inset Formula $b_{ij}$
\end_inset

，
\begin_inset Formula $c_{i}$
\end_inset

（
\begin_inset Formula $i,j=1,2,\cdots,m$
\end_inset

）是一些实数，称方法
\begin_inset Formula 
\begin{equation}
\begin{cases}
K_{i}=f\left(x_{n}+a_{i}h,y_{n}+h\sum_{j=1}^{m}b_{ij}K_{j}\right),\\
y_{n+1}=y_{n}+h\sum_{i=1}^{m}c_{i}K_{i};\\
(i=1,2,\cdots,m;\quad m=0,1,2,\cdots)
\end{cases}\label{eq:eu3.19}
\end{equation}

\end_inset

是初值问题
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu1.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

的一个
\begin_inset Formula $m$
\end_inset

级隐式 Runge–Kutta方法。
\end_layout

\begin_layout Definition
类似于显式 Runge–Kutta 公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

，公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.19"
plural "false"
caps "false"
noprefix "false"

\end_inset

也可表示成 Butcher 表，即表6.7。隐式Runge–Kutta公式中参量
\begin_inset Formula $a_{i}$
\end_inset

，
\begin_inset Formula $b_{ij}$
\end_inset

，
\begin_inset Formula $c_{i}$
\end_inset

的确定通常有两种方法。第一种方法是将方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.19"
plural "false"
caps "false"
noprefix "false"

\end_inset

的右端和左端分别在点
\begin_inset Formula $x_{n}$
\end_inset

处作Taylor展开，类似前面显式Runge–Kutta方法中系数的确定，比较左、右级数就可以确定出诸参数；另一种方法类似例6.3.1中显式三级Kutta方法系数的
确定，将微分方程化为等价的积分方程，取阶数较高的数值积分公式计算右端的积分式，对于每个 Runge–Kutta方法，相应地用
\begin_inset Formula $a_{i}$
\end_inset

，
\begin_inset Formula $b_{ij}$
\end_inset

和
\begin_inset Formula $c_{i}$
\end_inset

所确定的积分公式是一个 Gauss型数值积分公式，由此可以给出
\begin_inset Formula $y_{n+1}$
\end_inset

的一个计算表达式，把它与公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.19"
plural "false"
caps "false"
noprefix "false"

\end_inset

右端的Taylor展式作比较，则可以确定出诸参数。
\end_layout

\begin_layout Definition
Kuntzmann（1961）和Butcher（1964）已经发现对所有的
\begin_inset Formula $m$
\end_inset

阶方法均存在
\begin_inset Formula $2m$
\end_inset

阶隐式 Runge–Kutta方法，这显然要比显式Runge–Kunta方法优越。对
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu3.19"
plural "false"
caps "false"
noprefix "false"

\end_inset

的推导这里不作进一步的介绍，仅列出几个典型的隐式 Runge–Kutta 公式作为参考。
\end_layout

\begin_layout Definition
\begin_inset Float table
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $a_{1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{11}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{1m}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $a_{m}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{m1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $b_{mm}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{1}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\cdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $c_{m}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset space \quad{}
\end_inset


\begin_inset Tabular
<lyxtabular version="3" rows="2" columns="2">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{2}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\begin_inset space \quad{}
\end_inset


\begin_inset Tabular
<lyxtabular version="3" rows="3" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{3-\sqrt{3}}{6}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{4}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{3-2\sqrt{3}}{12}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{3+\sqrt{3}}{6}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{3+2\sqrt{3}}{12}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{4}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\vdots$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{2}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Butcher表；隐式中点公式（
\begin_inset Formula $m=1$
\end_inset

，
\begin_inset Formula $p=2$
\end_inset

）；隐式Runge–Kutta公式（
\begin_inset Formula $m=2$
\end_inset

，
\begin_inset Formula $p=4$
\end_inset

）
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Definition
\begin_inset Float table
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{5-\sqrt{15}}{10}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{5}{36}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{10-3\sqrt{15}}{45}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{25-6\sqrt{15}}{180}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{1}{2}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{10+3\sqrt{15}}{72}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{2}{9}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{10-23\sqrt{15}}{72}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{5+\sqrt{15}}{10}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{25+6\sqrt{15}}{180}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{10+3\sqrt{15}}{45}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{5}{36}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{5}{18}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{4}{9}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\frac{5}{18}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Kuntzmann和Butcher公式（
\begin_inset Formula $m=3$
\end_inset

，
\begin_inset Formula $p=6$
\end_inset

）
\end_layout

\end_inset


\end_layout

\end_inset

对于同级的 Runge–Kutta公式，隐式公式的精确度要比显式公式的高，且又有较高的数值稳定性，这些优点对于求解下面 S6.7 中的刚性方程组是非常有用的。
 但是在隐式 Runge–Kutta公式中，由于每个
\begin_inset Formula $K_{i}$
\end_inset

的表达式都含有
\begin_inset Formula $K_{1}$
\end_inset

，
\begin_inset Formula $\cdots$
\end_inset

，
\begin_inset Formula $K_{m}$
\end_inset

，因而在使用时，往往需要解非线性方程（组），这也给计算带来很大的不变和开销。例如隐式中点公式明确写出是，
\begin_inset Formula 
\[
\begin{cases}
K_{1}=f\left(x_{n}+\frac{1}{2}h,y_{n}+\frac{1}{2}hK_{1}\right),\\
y_{n+1}=y_{n}+hK_{1}
\end{cases}
\]

\end_inset


\end_layout

\begin_layout Section
线性多步法与预估–校正格式
\end_layout

\begin_layout Standard
常微分方程初值问题
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:eu1.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

的数值解法中，除了像Runge–Kutta型公式等单步法之外，还有另一种类型的解法–多步法。多步法的基本思想是：某一步解的公式不仅与前一步解的值有关，而且与前若
干步解的值有关，利用前面多步的信息预测下一步的值，可以期望获得较高的精度。构造多步法有多种途径，下面先讨论基于数值积分的方法。
\end_layout

\begin_layout Subsection
显示格式
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
y_{n+1}=y_{n-p}+h\sum_{j=0}^{q}\alpha_{j}f\left(x_{n-j},y_{n-j}\right),\label{eq:zl6.4.4}
\end{equation}

\end_inset

其中
\begin_inset Formula $p$
\end_inset

控制回溯起点（几步），
\begin_inset Formula $q$
\end_inset

控制积分点数（影响精度）。
\begin_inset Formula 
\[
\alpha_{j}=\frac{1}{h}\int_{x_{n-p}}^{x_{n+1}}l_{j}(t)\dd{t},
\]

\end_inset

这里
\begin_inset Formula $l_{j}(t)$
\end_inset

是关于节点
\begin_inset Formula $x_{n}$
\end_inset

，
\begin_inset Formula $x_{n-1}$
\end_inset

，
\begin_inset Formula $\cdots$
\end_inset

，
\begin_inset Formula $x_{n-q}$
\end_inset

的 Lagrange 基函数。
\end_layout

\begin_layout Standard
当
\begin_inset Formula $p=1,q=2$
\end_inset

时，可得三步三阶显式格式
\begin_inset Formula 
\[
y_{n+1}=y_{n-1}+\frac{h}{3}\left[7f(x_{n},y_{n})-2f(x_{n-1},y_{n-1})+f(x_{n-2},y_{n-2})\right].
\]

\end_inset


\end_layout

\begin_layout Subsection
隐式格式
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
y_{n+1}=y_{n-p}+h\sum_{j=0}^{q}\beta_{j}f\left(x_{n+1-j},y_{n+1-j}\right),\label{eq:zl6.4.5}
\end{equation}

\end_inset

其中
\begin_inset Formula 
\[
\beta_{j}=\frac{1}{h}\int_{x_{n-p}}^{x_{n+1}}l_{j}(t)\dd{t}.
\]

\end_inset


\end_layout

\begin_layout Standard
当
\begin_inset Formula $p=2,q=2$
\end_inset

时，可得三步三阶隐式格式
\begin_inset Formula 
\[
y_{n+1}=y_{n-2}+\frac{h}{4}\left[3f(x_{n+1},y_{n+1})+9f(x_{n-1},y_{n-1})\right].
\]

\end_inset


\end_layout

\begin_layout Standard
上述方法中若
\begin_inset Formula $p=0$
\end_inset

，则相应的格式（方法）称为 
\series bold
Adams格式
\series default
，其中
\begin_inset Formula $q=0$
\end_inset

时称为Euler格式；
\begin_inset Formula $q=1$
\end_inset

时，二步显式 Adams格式为
\begin_inset Formula 
\[
y_{n+1}=y_{n}+\frac{h}{2}\left[3f(x_{n},y_{n})-f(x_{n-1},y_{n-1})\right],
\]

\end_inset

二步隐式Adams格式为
\begin_inset Formula 
\[
y_{n+1}=y_{n}+\frac{h}{2}\left[f(x_{n+1},y_{n+1})+f(x_{n},y_{n})\right].
\]

\end_inset

这个格式也称为梯形公式。
\end_layout

\begin_layout Standard
利用插值多项式的余项，可以求出Adams方法的局部截断误差。当然也可以从得到的显式和隐式Adams格式，由局部截断误差的定义来求出方法的局部截断误差。
\end_layout

\begin_layout Subsection
预估–校正格式
\begin_inset CommandInset label
LatexCommand label
name "subsec:pc1"

\end_inset


\end_layout

\begin_layout Standard
隐式格式与同类显式格式相比，有较小的截断误差，更好的稳定性。但是在隐式格式中，
\begin_inset Formula $y_{n+1}$
\end_inset

不能通过简单的算术运算得到，一般需要通过迭代方法才能得到
\begin_inset Formula $y_{n+1}$
\end_inset

的近似值，这必然大大地增加运算量。若用一个恰当的显式格式求出的
\begin_inset Formula $y_{n+1}$
\end_inset

作为隐式格式的预估值，再用显式格式对预估值做校正，然后以这个校正的值作为格点函数
\begin_inset Formula $y_{n+1}$
\end_inset

，则我们称这样的格式为 
\series bold
预估–校正格式
\series default
。
\end_layout

\begin_layout Standard
用Euler公式作为预估，梯形公式作校正构成的预估–校正公式为
\begin_inset Formula 
\begin{equation}
\begin{cases}
y_{n+1}^{(0)}=y_{n}+hf(x_{n},y_{n})\\
y_{n+1}^{(k+1)}=y_{n}+\frac{h}{2}\left[f(x_{n},y_{n})+f(x_{n+1},y_{n+1}^{(k)})\right]
\end{cases}\label{eq:pc1}
\end{equation}

\end_inset

这个公式就是改进的Euler公式。
\end_layout

\begin_layout Standard
常用的预估–校正公式还有
\series bold
三点Milne公式
\series default

\begin_inset Formula 
\[
\begin{cases}
y_{n+1}^{(0)}=y_{n-3}+\frac{h}{3}\left[8f(x_{n},y_{n})-4f(x_{n-1},y_{n-1})+8f(x_{n-2},y_{n-2})\right],\\
y_{n+1}^{(k+1)}=y_{n-1}+\frac{h}{3}\left[f(x_{n+1},y_{n+1}^{(0)})+4f(x_{n},y_{n})+f(x_{n-1},y_{n-1})\right].
\end{cases}
\]

\end_inset

和改进的 
\series bold
四点Adams公式
\series default

\begin_inset Formula 
\[
\begin{cases}
y_{n+1}^{(0)}=y_{n}+\frac{h}{24}\left[{\color{blue}55}f(x_{n},y_{n}){\color{blue}-59}f(x_{n-1},y_{n-1})+{\color{blue}37}f(x_{n-2},y_{n-2}){\color{blue}-9}f(x_{n-3},y_{n-3})\right],\\
y_{n+1}^{(k+1)}=y_{n}+\frac{h}{24}\left[{\color{blue}9}f(x_{n+1},y_{n+1}^{(0)})+{\color{blue}19}f(x_{n},y_{n}){\color{blue}-5}f(x_{n-1},y_{n-1})+{\color{blue}1}f(x_{n-2},y_{n-2})\right].
\end{cases}
\]

\end_inset

值得一提的是，线性多步方法都具有较好的稳定性。
\end_layout

\begin_layout Section
beta方法,exa1
\end_layout

\begin_layout Standard
设一阶常微分方程的形式为
\begin_inset Formula 
\[
M\,x^{\prime}\left(t\right)+K\,x\left(t\right)=b\left(t\right)
\]

\end_inset

引入可调参数
\begin_inset Formula $\beta$
\end_inset

，将函数
\begin_inset Formula $x(t+\Delta t)$
\end_inset

表示为
\begin_inset Formula 
\[
x\left(t+\Delta t\right)=x\left(t\right)+\overline{\beta}\Delta t\,x^{\prime}\left(t\right)+\beta\Delta t\,x^{\prime}\left(t+\Delta t\right)
\]

\end_inset

其中
\begin_inset Formula $\overline{\beta}=1-\beta$
\end_inset

。以下将
\begin_inset Formula $t+\Delta t$
\end_inset

时刻离散成
\begin_inset Formula $n+1$
\end_inset

指标，联立方程
\begin_inset Formula 
\begin{align*}
 & x^{n+1}=x^{n}+\overline{\beta}\Delta t\,x^{\prime;n}+\beta\Delta t\,x^{\prime;n+1}\\
 & K\,x^{n}+M\,x^{\prime;n}=b^{n}\\
 & K\,x^{n+1}+M\,x^{\prime;n+1}=b^{n+1}
\end{align*}

\end_inset

解得
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify@First@ Solve[{x[n + 1] == x[n] + 
\backslash
[CapitalDelta]t (1 - 
\backslash
[Beta]) x
\backslash
[Prime][ n] + 
\backslash
[CapitalDelta]t*
\backslash
[Beta]*x
\backslash
[Prime][n + 1], K*x[n] + M*x
\backslash
[Prime][n] == b[n], K*x[n + 1] + M*x
\backslash
[Prime][n + 1] == b[n + 1]}, {x[n + 1], x
\backslash
[Prime][n], x
\backslash
[Prime][n + 1]}]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
\left(\frac{M}{\Delta t}+\beta K\right){\color{blue}x^{n+1}} & =\left(\frac{M}{\Delta t}-\overline{\beta}K\right)x^{n}+\overline{\beta}\,b^{n}+\beta b^{n+1}\\
\left(\frac{M}{\Delta t}K^{-1}M+\beta M\right){\color{blue}x^{\prime;n+1}} & =-\left(\frac{M}{\Delta t}-\overline{\beta}K\right)x^{n}-\overline{\beta}b^{n}+\frac{M}{\Delta t}K^{-1}\,b^{n+1}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
如果使用
\begin_inset Formula $\lambda$
\end_inset

-FPI 求解此方程，
\begin_inset Formula 
\[
A\Delta x_{\beta+1}^{n+1}=\lambda\left[B-AX_{\beta}^{n+1}\right]
\]

\end_inset

将对应矩阵代入得
\begin_inset Formula 
\[
\left[\frac{M}{\Delta t}+\beta\,K\right]\Delta x_{\beta+1}^{n+1}=\lambda\Big[\overline{\beta}\,b^{n}+\beta b^{n+1}+\left(\frac{M}{\Delta t}-\overline{\beta}K\right)x^{n}-\left(\frac{M}{\Delta t}+\beta\,K\right)x_{\beta}^{n+1}\Big]
\]

\end_inset

整理
\begin_inset Formula 
\[
\left[\frac{M}{\Delta t}+\beta\,K\right]\Delta x_{\beta+1}^{n+1}=\lambda\Big[{\color{blue}\overline{\beta}\,b^{n}+\beta b^{n+1}}-{\color{brown}\left(\overline{\beta}\,K\,x^{n}+\beta\,K\,x_{\beta}^{n+1}\right)}+{\color{magenta}\frac{M}{\Delta t}\left(x^{n}-x_{\beta}^{n+1}\right)}\Big]
\]

\end_inset


\end_layout

\begin_layout Standard
beta方法的系数具有对称性，作
\begin_inset Formula $\beta\leftrightarrow\overline{\beta}$
\end_inset

对换，对应
\begin_inset Formula 
\[
x^{n+1}=x^{n}+\beta\Delta t\,x^{\prime,n}+\overline{\beta}\Delta t\,x^{\prime,n+1}
\]

\end_inset

表达式为
\begin_inset Formula 
\begin{align*}
\left[\frac{M}{\Delta t}+\overline{\beta}\,K\right]\Delta x_{\beta+1}^{n+1}= & \lambda\Big[{\color{blue}\beta\,b^{n}+\overline{\beta}b^{n+1}}-{\color{brown}\left(\beta\,K\,x^{n}+\overline{\beta}\,K\,x_{\beta}^{n+1}\right)}\\
 & +{\color{magenta}\frac{M}{\Delta t}\left(x^{n}-x_{\beta}^{n+1}\right)}\Big]
\end{align*}

\end_inset


\end_layout

\begin_layout Remark
当
\begin_inset Formula $\beta=1$
\end_inset

，回到向前欧拉法：
\begin_inset Formula 
\[
\frac{M}{\Delta t}{\color{blue}x^{n+1}}=\left(\frac{M}{\Delta t}-K\right)x^{n}+b^{n}
\]

\end_inset

当
\begin_inset Formula $\beta=0$
\end_inset

，回到向后欧拉法：
\begin_inset Formula 
\[
\left(\frac{M}{\Delta t}+K\right){\color{blue}x^{n+1}}=\frac{M}{\Delta t}x^{n}+\beta b^{n+1}
\]

\end_inset

当
\begin_inset Formula $\beta=1/2$
\end_inset

，回到梯形法则：
\begin_inset Formula 
\[
\left(\frac{M}{\Delta t}+\frac{K}{2}\right){\color{blue}x^{n+1}}=\left(\frac{M}{\Delta t}-\frac{K}{2}\right)x^{n}+\frac{1}{2}\left(b^{n}+b^{n+1}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
By 《数值分析–张平文，李铁军》P156，将此方法应用到方程 
\begin_inset Formula $x'=\lambda x$
\end_inset

 上，可知此方法的稳定域为
\begin_inset Formula 
\[
\abs{\frac{1+\beta\xi}{1-\overline{\beta}\xi}}<1,\quad\xi=\lambda\Delta t
\]

\end_inset

当
\begin_inset Formula $\beta$
\end_inset

从
\begin_inset Formula $1$
\end_inset

到
\begin_inset Formula $0$
\end_inset

，此方法的稳定域逐渐扩大。代码演示
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
solODE[x0_, n_, {
\backslash
[Beta]_, 
\backslash
[CapitalDelta]t_, M1_, K1_, b_}] := Module[{tmp, 
\backslash
[Beta]b}, 
\backslash
[Beta]b = 1 - 
\backslash
[Beta]; tmp = Range[n + 1]; tmp[[1]] = x0; Do[tmp[[i + 1]] = LinearSolve[
 M1/
\backslash
[CapitalDelta]t + 
\backslash
[Beta]b* K1, (M1/
\backslash
[CapitalDelta]t - 
\backslash
[Beta]*K1) .
 tmp[[i]] + 
\backslash
[Beta]* b[i] + 
\backslash
[Beta]b*b[i + 1]], {i, 1, n}]; tmp];(*-----*)M1 = 1*{{1, 0, 0}, {0, 1, 0},
 {0, 0, 1}}; K1 = 2.1*{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}}; b[n_] := 0*{1, 1,
 1}; x0 = {1, 1, 1};(*----------*)
\backslash
[Beta] = 1/2; 
\backslash
[CapitalDelta]t = 1; step = 100; r1t = solODE[x0, step, {
\backslash
[Beta], 
\backslash
[CapitalDelta]t, M1, K1, b}]; r1 = Style[#, Red] & /@ Transpose@r1t;(**)
\backslash
[Beta] = 0; r2t = solODE[x0, step, {
\backslash
[Beta], 
\backslash
[CapitalDelta]t, M1, K1, b}]; r2 = Style[#, Green] & /@ Transpose@r2t;(**)
\backslash
[Beta] = 1; r3t = solODE[x0, step, {
\backslash
[Beta], 
\backslash
[CapitalDelta]t, M1, K1, b}]; r3 = Style[#, Black] & /@ Transpose@r3t; GraphicsC
olumn[ Table[ListPlot[{r1[[ord]], r2[[ord]], r3[[ord]]}, PlotRange -> All],
 {ord, 1, 3}], ImageSize -> 500]
\end_layout

\end_inset

，收敛域
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
f = Table[
\backslash
[Beta]b = 1 - 
\backslash
[Beta]; RegionPlot[ Callout[Abs[(1 + 
\backslash
[Beta] (x + y*I))/(1 - 
\backslash
[Beta]b (x + y I))] < 1, StringTemplate["
\backslash
[Beta]=``"][
\backslash
[Beta]], {
\backslash
[Beta], 0.7}], {x, -2.5, 2.5}, {y, -2.5, 2.5}, PlotStyle -> {ColorData[3, "ColorList"
][[Mod[10 
\backslash
[Beta], 10]]], Opacity[.15]}, Axes -> True], {
\backslash
[Beta], 0, 1, 0.1}]
\end_layout

\end_inset

。
\end_layout

\begin_layout Section
beta方法,exa2
\end_layout

\begin_layout Standard
设一阶常微分方程的形式为
\begin_inset Formula 
\begin{equation}
M\,x^{\prime}(t)+K\,x(t)+F[x(t)]=b(t)\label{eq:beta2}
\end{equation}

\end_inset

引入可调参数
\begin_inset Formula $\beta$
\end_inset

（
\begin_inset Formula $0\le\beta\le1$
\end_inset

），将函数
\begin_inset Formula $x(t+\Delta t)$
\end_inset

表示为（XuLei的选取方式）
\begin_inset Formula 
\[
x\left(t+\Delta t\right)=x\left(t\right)+\beta\Delta t\,x^{\prime}\left(t\right)+\overline{\beta}\Delta t\,x^{\prime}\left(t+\Delta t\right)
\]

\end_inset

其中
\begin_inset Formula $\overline{\beta}=1-\beta$
\end_inset

。
\begin_inset Formula $\beta=0$
\end_inset

 对应后向欧拉。
\series bold
以下用
\begin_inset Formula $n$
\end_inset

标记时间步
\series default
，即指标 
\begin_inset Formula $n+1$
\end_inset

 对应时刻 
\begin_inset Formula $t+\Delta t$
\end_inset

，联立方程
\begin_inset Formula 
\begin{align*}
 & x^{n+1}=x^{n}+\beta\Delta t\,x^{\prime;n}+\overline{\beta}\Delta t\,x^{\prime;n+1}\\
 & M\,x^{\prime;n}+K\,x^{n}+F^{n}=b^{n}\\
 & M\,x^{\prime;n+1}+K\,x^{n+1}+F^{n+1}=b^{n+1}
\end{align*}

\end_inset

解得
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify@First@Solve[{ x[n + 1] == x[n] + 
\backslash
[CapitalDelta]t*
\backslash
[Beta]* x
\backslash
[Prime][n] + 
\backslash
[CapitalDelta]t*
\backslash
[Beta]b*x
\backslash
[Prime][n + 1], M*x
\backslash
[Prime][n] + K*x[n] + F[n] == b[n], M*x
\backslash
[Prime][n + 1] + K*x[n + 1] + F[n + 1] == b[n + 1] }, {x[n + 1], x
\backslash
[Prime][n], x
\backslash
[Prime][n + 1]} ]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
\left(\frac{M}{\Delta t}+\overline{\beta}K\right){\color{blue}x^{n+1}} & =\left(\frac{M}{\Delta t}-\beta K\right)x^{n}-\left(\overline{\beta}\,F^{n+1}+\beta\,F^{n}\right)+\left(\overline{\beta}\,b^{n+1}+\beta\,b^{n}\right)
\end{align*}

\end_inset

简记
\begin_inset Formula 
\begin{align*}
 & A_{1}=\left(\frac{M}{\Delta t}+\overline{\beta}K\right),\quad A_{2}=\left(\frac{M}{\Delta t}-\beta K\right)\\
 & B_{1}=\left(\overline{\beta}\,b^{n+1}+\beta\,b^{n}\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Example
如果使用
\begin_inset Formula $\lambda$
\end_inset

-FPI 求解此方程，
\series bold
并用
\begin_inset Formula $w$
\end_inset

标记NLI（非线性）迭代步， 
\begin_inset Formula $u$
\end_inset

 标记线搜索试探步
\series default
（线搜索结果是覆盖的，即只采用最后一次）
\begin_inset Formula 
\[
A\Delta x_{w+1}^{n+1}=\lambda_{w,u}\left[B-AX_{w}^{n+1}\right]
\]

\end_inset

将对应矩阵代入得
\begin_inset Formula 
\begin{equation}
A_{1}\Delta x_{w+1}^{n+1}=\lambda_{w,u}\left[A_{2}x^{n}-\overline{\beta}\,{\color{blue}F^{n+1}}-\beta\,F^{n}+B_{1}-A_{1}x_{w}^{n+1}\right]\label{eq:my30}
\end{equation}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my30"
plural "false"
caps "false"
noprefix "false"

\end_inset

中
\begin_inset Formula ${\color{blue}F^{n+1}}=F\left(x_{w+1}^{n+1}\right)$
\end_inset

，所以是隐式的。为转换成显式方程，作泰勒展开
\begin_inset Formula 
\[
F^{n+1}=F\left(x_{w+1}^{n+1}\right)=F_{w}^{n+1}+F_{w}^{(1),n+1}\Delta x_{w+1}^{n+1}
\]

\end_inset

其中
\begin_inset Formula $F_{w}^{(1),n+1}$
\end_inset

表示
\begin_inset Formula $F$
\end_inset

在
\begin_inset Formula $x_{w}^{n+1}$
\end_inset

 的一阶导数；
\begin_inset Formula $F_{w}^{n+1}=F\left(x_{w}^{n+1}\right)$
\end_inset

表示
\begin_inset Formula $F$
\end_inset

在
\begin_inset Formula $x_{w}^{n+1}$
\end_inset

 的零阶值；
\begin_inset Formula $F^{n}$
\end_inset

表示
\begin_inset Formula $F$
\end_inset

在
\begin_inset Formula $x^{n}$
\end_inset

的值（上一时间步）。
\begin_inset Formula 
\[
\left[A_{1}+\overline{\beta}F_{w}^{(1),n+1}\right]\Delta x_{w+1}^{n+1}=\lambda_{w,u}\left[B_{1}+A_{2}x^{n}-\overline{\beta}F_{w}^{(0),n+1}-\beta\,F^{n}-A_{1}x_{w}^{n+1}\right]
\]

\end_inset

整理
\begin_inset Formula 
\begin{align*}
\left[\frac{M}{\Delta t}+\overline{\beta}K+\overline{\beta}F_{w}^{(1),n+1}\right]\Delta x_{w+1}^{n+1}= & \lambda_{w,u}\Big[{\color{blue}\overline{\beta}\,b^{n+1}+\beta\,b^{n}}-\left({\color{brown}\overline{\beta}F_{w}^{(0),n+1}+\beta\,F^{n}}\right)\\
 & -{\color{magenta}\frac{M}{\Delta t}\left(x_{w}^{n+1}-x^{n}\right)-\left(\overline{\beta}\,K\,x_{w}^{n+1}+\beta\,K\,x^{n}\right)}\Big]
\end{align*}

\end_inset

对比系数项容易发现，
\begin_inset Formula $K\sim F_{w}^{(1),n+1}$
\end_inset

，
\begin_inset Formula $K\,x_{w}^{n+1}\sim F_{w}^{n+1}$
\end_inset

，
\begin_inset Formula $K\,x^{n}\sim F^{n}$
\end_inset

 一一对应；这是由于推导时假设
\begin_inset Formula $F[x(t)]$
\end_inset

是一般函数，推导也适用于
\begin_inset Formula $K\,x(t)$
\end_inset

这样的线性项。
\end_layout

\begin_layout Remark
beta方法的系数具有对称性，作
\begin_inset Formula $\beta\leftrightarrow\overline{\beta}$
\end_inset

对换，
\begin_inset Formula $\beta=1$
\end_inset

对应后向欧拉。
\begin_inset Formula 
\[
x^{n+1}=x^{n}+\overline{\beta}\Delta t\,x^{\prime,n}+\beta\Delta t\,x^{\prime,n+1}
\]

\end_inset

表达式为
\begin_inset Formula 
\begin{align*}
\left[\frac{M}{\Delta t}+\beta\,K+\beta\,F_{w}^{(1),n+1}\right]\Delta x_{w+1}^{n+1}= & \lambda_{w,u}\Big[{\color{blue}\beta\,b^{n+1}+\overline{\beta}\,b^{n}}-\left({\color{brown}\beta\,F_{w}^{n+1}+\overline{\beta}\,F^{n}}\right)\\
 & -{\color{magenta}\frac{M}{\Delta t}\left(x_{w}^{n+1}-x^{n}\right)-\left(\beta\,K\,x_{w}^{n+1}+\overline{\beta}\,K\,x^{n}\right)}\Big]
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
以电化学残差方程为例，
\begin_inset Formula 
\begin{align}
\int_{\Omega^{e}}N_{m}\,\partial_{t}C_{i}\dd{\Omega} & -\int_{\Omega^{e}}{\color{red}\nabla N_{m}\cdot\sbf J_{D_{i}}}\dd{\Omega}+\int_{\Omega^{e}}\nabla N_{m}\cdot\sbf J_{C_{i}}\dd{\Omega}\label{eq:cf3a}\\
 & +\int_{\Gamma^{s}}{\color{red}N_{m}\,\sbf n\cdot\sbf J_{D_{i}}}\dd{\Gamma}+\int_{\Gamma^{s}}{\color{blue}N_{m}\,\sbf n\cdot\sbf J_{M_{i}}}\dd{\Gamma}-\int_{\Gamma^{s}}N_{m}\,\sbf n\cdot\sbf J_{C_{i}}\dd{\Gamma}\label{eq:cf3b}\\
 & =\int_{\Omega^{e}}N_{m}R_{i}\dd{\Omega}\label{eq:cf3c}
\end{align}

\end_inset

令待求自由度是
\begin_inset Formula $C_{n,i}$
\end_inset

，
\begin_inset Formula $n$
\end_inset

为节点指标，
\begin_inset Formula $i$
\end_inset

为离子指标。则
\begin_inset Formula $M=N_{m}N_{n}$
\end_inset

。体单元的 
\begin_inset Formula ${\color{red}\nabla N_{m}\cdot\sbf J_{D_{i}}}$
\end_inset

 贡献到 
\begin_inset Formula $K$
\end_inset

 。边界项 
\begin_inset Formula ${\color{red}\sbf n\cdot\sbf J_{D_{i}}}$
\end_inset

 由边界条件给出，在齐次2nd边界上是零；在一般的3rd边界上可能具有下列形式
\begin_inset Formula 
\[
\sbf n\cdot\sbf J_{D_{i}}=F[c_{i}(t)]+b(b)
\]

\end_inset

这里的
\begin_inset Formula $F$
\end_inset

是已知函数，则对应
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:beta2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的
\begin_inset Formula $F[x(t)]$
\end_inset

与
\begin_inset Formula $b(t)$
\end_inset

，因此需要对
\begin_inset Formula $F[x(t)]$
\end_inset

作线性化。
\end_layout

\begin_layout Section
sss2
\end_layout

\begin_layout Standard
general ODE form：待整理
\begin_inset Formula 
\[
M\,x^{\prime}(t)+K\,x(t)+L[x(t)]\,x(t)+F[x(t)]=b(t)
\]

\end_inset


\begin_inset Formula 
\begin{align*}
 & x^{n+1}=x^{n}+\overline{\beta}\Delta t\,x^{\prime;n}+\beta\Delta t\,x^{\prime;n+1}\\
 & K\,x^{n}+L^{n}x^{n}+F^{n}+M\,x^{\prime;n}=b^{n}\\
 & K\,x^{n+1}+L^{n+1}x^{n+1}+F^{n+1}+M\,x^{\prime;n+1}=b^{n+1}
\end{align*}

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify@First@Solve[{ x[n + 1] == x[n] + 
\backslash
[CapitalDelta]t 
\backslash
[Beta]b* x
\backslash
[Prime][n] + 
\backslash
[CapitalDelta]t*
\backslash
[Beta]*x
\backslash
[Prime][n + 1], K*x[n] + L[n]*x[n] + F[n] + M*x
\backslash
[Prime][n] == b[n], K*x[n + 1] + L[n + 1]*x[n + 1] + F[n + 1] + M*x
\backslash
[Prime][n + 1] == b[n + 1] }, {x[n + 1], x
\backslash
[Prime][n], x
\backslash
[Prime][n + 1]} ]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
\left(\frac{R}{\Delta t}+\beta S\right){\color{blue}x^{n+1}} & =\left(\frac{R}{\Delta t}-\overline{\beta}S\right)x^{n}-\left(\beta\,F^{n+1}+\overline{\beta}\,F^{n}\right)+\left(\beta\,b^{n+1}+\overline{\beta}\,b^{n}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\left[\frac{M}{\Delta t}+\beta K+\beta L^{n+1}\right]x^{n+1} & =\left(\frac{M}{\Delta t}-\overline{\beta}K-\overline{\beta}L^{n}\right)x^{n}-\left(\overline{\beta}F^{n}+\beta F^{n+1}\right)+\left(\overline{\beta}b^{n}+\beta b^{n+1}\right)\\
\left(\beta K+\beta L^{n+1}+\frac{M}{\Delta t}\right)Mx^{\prime;n+1} & =-\overline{\beta}\,\left(K+L^{n+1}\right)b^{n}+\frac{M}{\Delta t}b^{n+1}+\overline{\beta}\,KF^{n}\\
 & +\overline{\beta}\,F^{n}L^{n+1}-\frac{M}{\Delta t}F^{n+1}+\overline{\beta}K^{2}x^{n}+\overline{\beta}KL^{n}x^{n}\\
 & +\overline{\beta}\,KL^{n+1}x^{n}-K\frac{M}{\Delta t}x^{n}-\frac{M}{\Delta t}L^{n+1}x^{n}+\overline{\beta}L^{n}L^{n+1}x^{n}
\end{align*}

\end_inset


\end_layout

\begin_layout Section
广义alpha方法
\end_layout

\begin_layout Standard
设一阶常微分方程的形式为
\begin_inset Formula 
\begin{equation}
M\,x^{\prime}(t)+F[x(t)]=b(t)\label{eq:mya1}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
M\,x_{n+\alpha_{m}}^{\prime} & +F^{(0)}[x_{n}]+F^{(1)}(x_{n+\alpha_{f}}-x_{n})=b_{n+\alpha_{f}}\\
x_{n+1}-x_{n} & =\Delta t\,\overline{\beta}\,x_{n}^{\prime}+\Delta t\,\beta\,x_{n+1}^{\prime}\\
x_{n+\alpha_{m}}^{\prime}-x_{n}^{\prime} & =\alpha_{m}(x_{n+1}^{\prime}-x_{n}^{\prime})\\
x_{n+\alpha_{f}}-x_{n} & =\alpha_{f}(x_{n+1}-x_{n})
\end{align*}

\end_inset

其中
\begin_inset Formula $\alpha_{m}$
\end_inset

，
\begin_inset Formula $\alpha_{f}$
\end_inset

，
\begin_inset Formula $\gamma$
\end_inset

 当前是可调参数。
\begin_inset Formula 
\begin{align*}
 & \left(\alpha_{m}M+\alpha_{f}\beta\Delta t\,F^{(1)}\right)x_{n+1}=\left(\alpha_{m}M+\beta\Delta t\alpha_{f}\,F^{(1)}\right)x_{n}+\left(\alpha_{m}-\beta\right)\Delta tM\,x_{n}^{\prime}+\beta\Delta t\left(b_{n+\alpha_{f}}-F^{(0)}\right)\\
 & \left(\alpha_{m}M+\alpha_{f}\,\beta\Delta t\,F^{(1)}\right)x_{n+1}^{\prime}=-\left(\overline{\alpha_{m}}M+\alpha_{f}\overline{\beta}\Delta t\,F^{(1)}\right)x_{n}^{\prime}+\left(b_{n+\alpha_{f}}-F^{(0)}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
 & \left[\begin{array}{cc}
\alpha_{m}M+\alpha_{f}\beta\Delta t\,F^{(1)}\\
 & \alpha_{m}M+\alpha_{f}\beta\Delta t\,F^{(1)}
\end{array}\right]\left[\begin{array}{c}
x_{n+1}\\
x_{n+1}^{\prime}
\end{array}\right]=\\
 & \left[\begin{array}{cc}
\alpha_{m}M+\beta\Delta t\alpha_{f}\,F^{(1)} & \left(\alpha_{m}-\beta\right)\Delta tM\,\\
 & -\left(\overline{\alpha_{m}}M+\alpha_{f}\overline{\beta}\Delta t\,F^{(1)}\right)
\end{array}\right]\left[\begin{array}{c}
x_{n}\\
x_{n}^{\prime}
\end{array}\right]+\left[\begin{array}{c}
\beta\Delta t\left(b_{n+\alpha_{f}}-F^{(0)}\right)\\
\left(b_{n+\alpha_{f}}-F^{(0)}\right)
\end{array}\right]
\end{align*}

\end_inset

引入可调参数
\begin_inset Formula $\beta$
\end_inset

（
\begin_inset Formula $0\le\beta\le1$
\end_inset

），将函数
\begin_inset Formula $x(t+\Delta t)$
\end_inset

表示为（XuLei的选取方式）
\begin_inset Formula 
\[
x\left(t+\Delta t\right)=x\left(t\right)+\beta\Delta t\,x^{\prime}\left(t\right)+\overline{\beta}\Delta t\,x^{\prime}\left(t+\Delta t\right)
\]

\end_inset

其中
\begin_inset Formula $\overline{\beta}=1-\beta$
\end_inset

。
\begin_inset Formula $\beta=0$
\end_inset

 对应后向欧拉。
\series bold
以下用
\begin_inset Formula $n$
\end_inset

标记时间步
\series default
，即指标 
\begin_inset Formula $n+1$
\end_inset

 对应时刻 
\begin_inset Formula $t+\Delta t$
\end_inset

，联立方程
\begin_inset Formula 
\begin{align*}
 & x^{n+1}=x^{n}+\beta\Delta t\,x^{\prime;n}+\overline{\beta}\Delta t\,x^{\prime;n+1}\\
 & M\,x^{\prime;n}+K\,x^{n}+F^{n}=b^{n}\\
 & M\,x^{\prime;n+1}+K\,x^{n+1}+F^{n+1}=b^{n+1}
\end{align*}

\end_inset

解得
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify@First@Solve[{ x[n + 1] == x[n] + 
\backslash
[CapitalDelta]t*
\backslash
[Beta]* x
\backslash
[Prime][n] + 
\backslash
[CapitalDelta]t*
\backslash
[Beta]b*x
\backslash
[Prime][n + 1], M*x
\backslash
[Prime][n] + K*x[n] + F[n] == b[n], M*x
\backslash
[Prime][n + 1] + K*x[n + 1] + F[n + 1] == b[n + 1] }, {x[n + 1], x
\backslash
[Prime][n], x
\backslash
[Prime][n + 1]} ]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
\left(\frac{M}{\Delta t}+\overline{\beta}K\right){\color{blue}x^{n+1}} & =\left(\frac{M}{\Delta t}-\beta K\right)x^{n}-\left(\overline{\beta}\,F^{n+1}+\beta\,F^{n}\right)+\left(\overline{\beta}\,b^{n+1}+\beta\,b^{n}\right)
\end{align*}

\end_inset

简记
\end_layout

\begin_layout Section
不动点迭代
\end_layout

\begin_layout Standard
对于线性材料，
\begin_inset Formula $\varepsilon$
\end_inset

是不依赖于
\begin_inset Formula $\sbf E$
\end_inset

（等价于
\begin_inset Formula $\phi$
\end_inset

）的常数，因此刚阵的元素不依赖于
\begin_inset Formula $\phi$
\end_inset

，方程是线性的。但对于一般的问题，
\begin_inset Formula $\varepsilon$
\end_inset

可能依赖于
\begin_inset Formula $\sbf E$
\end_inset

，方程组是
\series bold
非线性的
\series default
，形如 
\begin_inset Formula $K_{ij}[\phi]\,\phi_{j}-b_{i}[\phi]=0$
\end_inset

。
\series bold
对于非线性问题，需要使用迭代法求解
\series default
。
\end_layout

\begin_layout Standard
ref:《数值分析–Timothyp27/42，不动点迭代》。先考虑类似问题的简化版本，即一维情形。以下
\begin_inset Formula $k(\phi)$
\end_inset

是单变量函数，
\begin_inset Formula $b$
\end_inset

是数，
\begin_inset Formula $\phi$
\end_inset

是普通变量：
\begin_inset Formula 
\[
k(\phi)\phi=b\quad\Rightarrow\quad\phi=k^{-1}(\phi)b
\]

\end_inset

实际上就是方程
\begin_inset Formula $x=g(x)$
\end_inset

的一个特例，此类方程可以使用
\series bold
不动点迭代
\series default
（FPI）求解。
\begin_inset Formula 
\begin{equation}
\begin{cases}
x_{0}=\text{初始估计}\\
x_{i+1}=g(x_{i}), & \text{其中}i=0,1,2,\cdots
\end{cases}\label{eq:my3a}
\end{equation}

\end_inset

如图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:fpi"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/cobweb2.pdf
	lyxscale 50
	scale 35

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
fpi[f_, x0_, n_] := NestList[f, x0, n]; cobs[f_, x0_, 0] := {{x0, 0}, {x0,
 f@x0}}; cobs[f_, x0_, n_] := Module[{tmp, r1, r2, r3, r4}, tmp = fpi[f,
 x0, n]; r1 = Most@tmp; r2 = ReplacePart[r1, 1 -> 0]; r3 = r1; r4 = Rest@tmp;
 Riffle[Transpose@{r1, r2}, Transpose@{r3, r4}]]; (*figure*) fn = -1/5 #^2
 + 3/2 &; pts = cobs[fn, 0.9, 8]; alist = Table[Arrow[{pts[[i]], pts[[i +
 1]]}], {i, 1, Length@pts - 1}]; f1 = Plot[{x, fn@x}, {x, 0.8, 1.4}, PlotRange
 -> {{0.87, 1.38}, {1, 1.4}}, Frame -> True, ImageSize -> Medium, AspectRatio
 -> Automatic, PlotStyle -> Thickness[0.005]]; f2 = Graphics[Prepend[Thickness@0.0
03]@ Prepend[alist, Arrowheads[{{.018, 1}}]]]; Show[f1, f2, ImageSize ->
 500]
\end_layout

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:fpi"

\end_inset

cobweb图，方程
\begin_inset Formula $x=g(x)$
\end_inset

不动点迭代过程的示意图。黄色曲线表示
\begin_inset Formula $y=g(x)$
\end_inset

，蓝色直线是
\begin_inset Formula $y=x$
\end_inset

。
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
在迭代过程的每一步中，
\begin_inset Formula $\phi$
\end_inset

，
\begin_inset Formula $\sbf E$
\end_inset

，
\begin_inset Formula $\sbf D$
\end_inset

保持为常量，对应cobweb图中的直线走法。所以相应地，每一步迭代中
\begin_inset Formula $\varepsilon$
\end_inset

等材料属性也可当成常数，从而采用线性材料的算法处理。
\end_layout

\begin_layout Subsection
改进的FPI
\end_layout

\begin_layout Standard
求解器中使用改进的不动点迭代，
\begin_inset Formula 
\begin{align}
 & x_{0}=\text{初始估计}\nonumber \\
 & x_{i+1}=\lambda_{i}\,g(x_{i})+\overline{\lambda}_{i}\,x_{i},\quad\text{其中}i=0,1,2,\cdots\label{eq:my3}
\end{align}

\end_inset

其中
\begin_inset Formula $0<\lambda_{i}\le1$
\end_inset

，
\begin_inset Formula $\overline{\lambda}_{i}=1-\lambda_{i}$
\end_inset

。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my3"
plural "false"
caps "false"
noprefix "false"

\end_inset

也可以写成
\begin_inset Formula 
\begin{align}
 & x_{0}=\text{初始估计}\nonumber \\
 & \Delta x_{i+1}=\lambda_{i}\,\Delta g(x_{i}),\label{eq:my4}\\
\text{with}\quad & \Delta x_{i+1}=x_{i+1}-x_{i},\quad\Delta g(x_{i})=g(x_{i})-x_{i}\nonumber 
\end{align}

\end_inset

这里的
\begin_inset Formula $\Delta x_{i+1}$
\end_inset

，
\begin_inset Formula $\Delta g(x_{i})$
\end_inset

都是有限值（不必是无穷小量），参考图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:fpi"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Box ovalbox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout

\series bold
FPI的核心思想：给出
\begin_inset Formula $\Delta x_{i+1}$
\end_inset

的估计即可，用什么方法不重要，只要在根
\begin_inset Formula $r_{0}$
\end_inset

处满足
\begin_inset Formula $\Delta x_{\infty}=0$
\end_inset

，即方程渐近成立，
\begin_inset Formula $\lambda$
\end_inset

参数会使迭代尽可能收敛到根。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
设
\begin_inset Formula $r$
\end_inset

为方程
\begin_inset Formula $x=g(x)$
\end_inset

的一个根，假设迭代的初始值在
\begin_inset Formula $r$
\end_inset

附近，定义前向误差
\begin_inset Formula $e_{i}=\abs{x_{i}-r}$
\end_inset

，从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my3"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\begin{equation}
e_{i+1}=P_{i}\,e_{i}\label{eq:my5}
\end{equation}

\end_inset

其中
\begin_inset Formula $P_{i}=\abs{\lambda_{i}\,g'(c_{i})+\overline{\lambda}_{i}}$
\end_inset

，而
\begin_inset Formula $c_{i}\in\left[x_{i},r\right]$
\end_inset

。工作中我们选取的
\begin_inset Formula $\lambda$
\end_inset

满足
\begin_inset Formula $0<\lambda_{i}\le1$
\end_inset

，图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:fpi2"
plural "false"
caps "false"
noprefix "false"

\end_inset

给出了误差的收敛域，即满足
\begin_inset Formula $0\le P_{i}<1$
\end_inset

的区域。其中横轴是
\begin_inset Formula $\lambda_{i}$
\end_inset

，取值范围是
\begin_inset Formula $(0,1]$
\end_inset

，纵轴为
\begin_inset Formula $g'(c_{i})$
\end_inset

，取值范围是
\begin_inset Formula $(-\infty,1]$
\end_inset

，当
\begin_inset Formula $g'(c_{i})$
\end_inset

沿着纵轴下降时，
\begin_inset Formula $\lambda$
\end_inset

的取值范围需要缩短，以满足误差收敛条件。也就是说通过在迭代步中调节
\begin_inset Formula $\lambda_{i}$
\end_inset

，可以使原本在FPI中发散的迭代序列获得收敛。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fpi2.pdf
	lyxscale 70
	scale 40

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
RegionPlot[ 0 <= Abs[
\backslash
[Lambda]*gc + 1 - 
\backslash
[Lambda]] < 1, {
\backslash
[Lambda], 0, 1}, {gc, -5, 1.1} , BoundaryStyle -> Dashed, PlotStyle -> Automatic
 , FrameLabel -> {"
\backslash
[Lambda]", "gc"}, ImageSize -> Medium]
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:fpi2"

\end_inset

改进FPI的收敛域
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
结合式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my4"
plural "false"
caps "false"
noprefix "false"

\end_inset

、
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my4"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\begin{align}
 & \Delta x_{i+1}=\lambda_{i}\,\Delta g(x_{i}),\label{eq:my4b}\\
 & e_{i+1}=\abs{\lambda_{i}\,g'(c_{i})+\overline{\lambda}_{i}}e_{i}\label{eq:my5b}
\end{align}

\end_inset

对于普通FPI中发散的问题，即
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my3a"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的
\begin_inset Formula $\Delta x_{i+1}$
\end_inset

将疯狂膨胀，通过在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my4b"
plural "false"
caps "false"
noprefix "false"

\end_inset

引入
\begin_inset Formula $\lambda_{i}$
\end_inset

调节，可以使步长
\begin_inset Formula $\Delta x_{i+1}$
\end_inset

变小，从而使迭代回路有机会收敛到根。但是另一方面，如果
\begin_inset Formula $\lambda_{i}$
\end_inset

取得过小，由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my5b"
plural "false"
caps "false"
noprefix "false"

\end_inset

可知此时
\begin_inset Formula $e_{i+1}\approx e_{i}$
\end_inset

，也就是前向误差的收敛速度会变慢，没有两全其美的事。图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:fpi-err"
plural "false"
caps "false"
noprefix "false"

\end_inset

中给出了
\begin_inset Formula $P$
\end_inset

随
\begin_inset Formula $\lambda$
\end_inset

的变化，每根曲线对应不同的
\begin_inset Formula $g'(c_{i})$
\end_inset

。欲令迭代收敛，
\begin_inset Formula $P$
\end_inset

应该比较小，从图中看到， 随着
\begin_inset Formula $\lambda$
\end_inset

从
\begin_inset Formula $1$
\end_inset

到
\begin_inset Formula $0$
\end_inset

，
\begin_inset Formula $P$
\end_inset

先变小，然后逐渐回升到
\begin_inset Formula $1$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fpi-err.pdf
	lyxscale 90
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
fn[
\backslash
[Lambda]_, g_] := Abs[
\backslash
[Lambda] (g - 1) + 1]; lst = {1, 0.5, 0.0, -0.5, -1.0, -1.5, -2}; lst2 = ("g="
 <> ToString[#] &) /@ lst; Plot[Evaluate[fn[
\backslash
[Lambda], #] & /@ lst] , {
\backslash
[Lambda], 0, 1} , PlotLabels -> lst2 , AxesLabel -> {"
\backslash
[Lambda]", "P"} , ImageSize -> Medium ]
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:fpi-err"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Example
对于不动点问题
\begin_inset Formula $x=g(x)$
\end_inset

，其中
\begin_inset Formula $g(x)=-3/2x+5/2$
\end_inset

，由于
\begin_inset Formula $\abs{g(c_{i})}=3/2>1$
\end_inset

，使用普通的FPI不会收敛，如图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:fpi3"
plural "false"
caps "false"
noprefix "false"

\end_inset

a。但使用改进的FPI，并令
\begin_inset Formula $\lambda=0.7$
\end_inset

，此时
\begin_inset Formula $P=0.75$
\end_inset

，则迭代收敛，如图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:fpi3"
plural "false"
caps "false"
noprefix "false"

\end_inset

b。可以看到对于改进的FPI，迭代点
\begin_inset Formula $x_{i+1}$
\end_inset

并不落在
\begin_inset Formula $y=g(x)$
\end_inset

曲线上，而是落在
\begin_inset Formula $y=x$
\end_inset

 和 
\begin_inset Formula $y=g(x)$
\end_inset

两条曲线之间，即图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:fpi3"
plural "false"
caps "false"
noprefix "false"

\end_inset

b中的红色曲线，它就是修正曲线。当迭代序列到达根
\begin_inset Formula $r$
\end_inset

附近时，三条曲线是相交的，所以不会影响最终结果的正确性。可以看到，在改进的FPI中，迭代回路的水平或垂直线段长度
\begin_inset Formula $\Delta x_{i+1}=x_{i+1}-x_{i}$
\end_inset

变小，得到了有效的控制。但是
\begin_inset Formula $\lambda$
\end_inset

也不能取得过小，如图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:fpi3"
plural "false"
caps "false"
noprefix "false"

\end_inset

c，此时虽然收敛性好，但是收敛速率下降，需要更多步才能找到根。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fpi3a.pdf
	lyxscale 50
	scale 40

\end_inset


\begin_inset space \enskip{}
\end_inset


\begin_inset Graphics
	filename inset/fpi3b.pdf
	lyxscale 50
	scale 40

\end_inset


\begin_inset space \enskip{}
\end_inset


\begin_inset Graphics
	filename inset/fpi3c.pdf
	lyxscale 50
	scale 40

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:fpi3"

\end_inset

图a：FPI；图b：改进的FPI，
\begin_inset Formula $\lambda=0.7$
\end_inset

；图c：改进的FPI，但
\begin_inset Formula $\lambda=0.1$
\end_inset

取值过小。
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Subsection
终止条件
\end_layout

\begin_layout Standard
FPI 收敛到给定
\series bold
容差
\series default
（TOL）的步数无法事先预测，必须决定何时终止算法，即
\series bold
终止条件
\series default
。
\end_layout

\begin_layout Standard
绝对终止条件是
\begin_inset Formula 
\begin{equation}
\abs{x_{i+1}-x_{i}}<\mathrm{TOL}\label{eq:1.16}
\end{equation}

\end_inset

或者当解不在 
\begin_inset Formula $0$
\end_inset

 附近，使用相对误差条件
\begin_inset Formula 
\begin{equation}
\frac{\abs{x_{i+1}-x_{i}}}{\abs{x_{i+1}}}<\mathrm{TOL}\label{eq:1.17}
\end{equation}

\end_inset

还有混合 绝对/相对误差 终止条件：
\begin_inset Formula 
\begin{equation}
\frac{\abs{x_{i+1}-x_{i}}}{\max(\abs{x_{i+1}},\theta)}<\mathrm{TOL}\label{eq:1.18}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\theta>0$
\end_inset

，常常用于 
\begin_inset Formula $0$
\end_inset

 附近的解。此外，好的 FPI 代码应当在收敛失败的时候，设置最大迭代步数的限制。
\end_layout

\begin_layout Standard
对应到有限元方程的迭代法，
\begin_inset Formula 
\[
K'\,\delta\phi_{j}=b'
\]

\end_inset

相当于要求 
\begin_inset Formula $\delta\phi_{j}<\mathrm{TOL}$
\end_inset

，而
\begin_inset Formula $\delta\phi_{j}$
\end_inset

的充分条件是 
\begin_inset Formula $b'\to0$
\end_inset

，所以可把
\begin_inset Formula $\norm{b}\to0$
\end_inset

，即残差趋于零当成算法终止条件。
\end_layout

\begin_layout Section
左逆元，右逆元
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "方阵的左逆等于右逆，本质的原因是什么？"
target "https://www.zhihu.com/question/26549728"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "左逆，右逆，可逆"
target "https://zhuanlan.zhihu.com/p/20589059"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
假设有且只有唯一单位元，满足 
\begin_inset Formula $A\,I=I\,A=A$
\end_inset

。对于元素
\begin_inset Formula $x$
\end_inset

，假设存在左逆
\begin_inset Formula $L$
\end_inset

和右逆
\begin_inset Formula $R$
\end_inset

满足 
\begin_inset Formula $Lx=I$
\end_inset

，
\begin_inset Formula $xR=I$
\end_inset

，易知
\begin_inset Formula 
\[
L=L\,I=L\,x\,R=I\,R=R
\]

\end_inset


\end_layout

\begin_layout Chapter
几何算法
\end_layout

\begin_layout Section
正四面体性质
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "wiki正四面体"
target "https://zh.wikipedia.org/wiki/%E6%AD%A3%E5%9B%9B%E9%9D%A2%E9%AB%94"
literal "false"

\end_inset


\end_layout

\begin_layout Itemize
面的形状：等边三角形
\end_layout

\begin_layout Itemize
顶点数目：
\begin_inset Formula $4$
\end_inset

 
\end_layout

\begin_layout Itemize
边数目：
\begin_inset Formula $6$
\end_inset


\end_layout

\begin_layout Itemize
面数目：
\begin_inset Formula $4$
\end_inset


\end_layout

\begin_layout Itemize
二面角角度：
\begin_inset Formula $\arccos(1/3)=\arctan(2\sqrt{2})\approx70.5288\text{°}$
\end_inset

。
\end_layout

\begin_layout Itemize
面棱夹角： 
\begin_inset Formula $\arccos(1/\sqrt{3})=\arctan(\sqrt{2})\approx54.7356\text{°}$
\end_inset

。
\end_layout

\begin_layout Itemize
中心–顶点连线之间夹角： 
\begin_inset Formula $\arccos(-1/3)=2\arctan(\sqrt{2})\approx109.4712\text{°}$
\end_inset

。
\end_layout

\begin_layout Itemize
面所对立体角：
\begin_inset Formula $\arccos(23/27)=0.55129\,\text{sr}$
\end_inset

。
\end_layout

\begin_layout Standard
对于棱长为a的正四面体：
\end_layout

\begin_layout Itemize
底面积：
\begin_inset Formula $A_{0}=\sqrt{3}/4\,a^{2}$
\end_inset


\end_layout

\begin_layout Itemize
高：
\begin_inset Formula $H=\sqrt{6}/3\,a=\sqrt{2/3}\,a$
\end_inset


\end_layout

\begin_layout Itemize
表面积：
\begin_inset Formula $S=4A_{0}=\sqrt{3}\,a^{2}$
\end_inset


\end_layout

\begin_layout Itemize
体积：
\begin_inset Formula $V=\sqrt{2}/12\,a^{3}$
\end_inset


\end_layout

\begin_layout Itemize
外接球半径：
\begin_inset Formula $\sqrt{6}/4\,a$
\end_inset


\end_layout

\begin_layout Itemize
内切球半径：
\begin_inset Formula $\sqrt{6}/12\,a$
\end_inset


\end_layout

\begin_layout Itemize
中分球半径：
\begin_inset Formula $r_{M}=\sqrt{rR}=\sqrt{2}/4\,a$
\end_inset


\end_layout

\begin_layout Itemize
旁切球半径：
\begin_inset Formula $r_{E}=\sqrt{6}/6\,a$
\end_inset


\end_layout

\begin_layout Itemize
旁切球到顶点距离：
\begin_inset Formula $d_{\text{VE}}=\sqrt{6}/2\,a=\sqrt{3/2}\,a$
\end_inset


\end_layout

\begin_layout Itemize
对偶多面体：正四面体
\end_layout

\begin_layout Standard
注意到相对于底面，面的斜率（
\begin_inset Formula $2\sqrt{2}$
\end_inset

）是棱的斜率（
\begin_inset Formula $\sqrt{2}$
\end_inset

）的两倍，这意味着由于从底面沿棱到顶点的水平距离，是沿侧面中线到顶点水平距离的
\begin_inset Formula $2$
\end_inset

倍，而这是由于从底面重心到底面顶点的距离是到底面边距离的
\begin_inset Formula $2$
\end_inset

倍。
\end_layout

\begin_layout Subsection
坐标系
\end_layout

\begin_layout Itemize
如果我们以正四面体的中心作为原点建立三维直角坐标系的话，棱长
\begin_inset Formula $a=2$
\end_inset

的正四面体的顶点坐标可以表示为：
\begin_inset Formula 
\[
(\pm1,0,\frac{-1}{\sqrt{2}}),\quad(0,\pm1,\frac{1}{\sqrt{2}}),
\]

\end_inset


\end_layout

\begin_layout Itemize
另一种表示方法把正四面体看作是半立方体，它有立方体一半的顶点：（如果原正方体棱长为
\begin_inset Formula $1$
\end_inset

的话，正四面体棱长为
\begin_inset Formula $\sqrt{2}$
\end_inset

）
\begin_inset Formula 
\[
(1,1,1),\quad(1,-1,-1),\quad(-1,1,-1),\quad(-1,-1,1)
\]

\end_inset

另外，被交错舍弃掉的那四个顶点构成了与原来正四面体对偶的另一个正四面体：
\begin_inset Formula 
\[
(-1,-1,-1),\quad(-1,1,1),\quad(1,-1,1),\quad(1,1,-1)
\]

\end_inset

 它们一起构成了星形八面体。
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/Tetraeder_animation_with_cube.png

\end_inset


\end_layout

\begin_layout Section
带符号体积判断
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "点是否在 三角形,凸多边形, 凹多边形,四面体内 的判断"
target "https://www.cnblogs.com/sosi/p/4658694.html"
literal "false"

\end_inset

。
\end_layout

\begin_layout Standard
如何判断一个点在四面体的内部呢? 使用有向体积的概念.
 假设四面体的四个顶点的坐标为 (x1,y1,z1), (x2,y2,z2), (x3,y3,z3), (x4,y4,z4).
 需要判断的点为(x,y,z).
 那么原来四面体的有向体积 为
\begin_inset Formula 
\[
V_{0}=\frac{1}{3!}\left[\begin{array}{cccc}
x_{1} & y_{1} & z_{1} & 1\\
x_{2} & y_{2} & z_{2} & 1\\
x_{3} & y_{3} & z_{3} & 1\\
x_{4} & y_{4} & z_{4} & 1
\end{array}\right]
\]

\end_inset

同理剩下的
\begin_inset Formula $4$
\end_inset

个有向体积
\begin_inset Formula $V_{1}$
\end_inset

~
\begin_inset Formula $V_{4}$
\end_inset

分别为：用 
\begin_inset Formula $(x,y,z,1)$
\end_inset

 分别代替第 
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $2$
\end_inset

，
\begin_inset Formula $3$
\end_inset

，
\begin_inset Formula $4$
\end_inset

行。判断准则很简单, 
\begin_inset Formula $V_{0}$
\end_inset

与
\begin_inset Formula $V_{1}$
\end_inset

，
\begin_inset Formula $V_{2}$
\end_inset

，
\begin_inset Formula $V_{3}$
\end_inset

，
\begin_inset Formula $V_{4}$
\end_inset

 都同向的时候, 则点位于四面体内, 否则位于四面体外。 当 
\begin_inset Formula $V_{i}=0$
\end_inset

 的时候, 则子四面体退化。判断的原理是，
\begin_inset Formula $3$
\end_inset

点形成一个面，第
\begin_inset Formula $4$
\end_inset

个点位于面的不同侧时，有向体积的符号不一样。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
lst = { {0, 0, 0}, {1, 0, 0}, {0, 1, 0}, {0, 0, 1} }; a = Transpose@Append[Trans
pose@lst, ConstantArray[1, Length@lst]]; lst[[4]] = {0, 0, -1}; b = Transpose@Ap
pend[Transpose@lst, ConstantArray[1, Length@lst]] {Det[a], Det[b]}
\end_layout

\end_inset


\end_layout

\begin_layout Section
非结构化网格
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "结构化网格和非结构化网格"
target "https://stuch.cn/question/819"
literal "false"

\end_inset


\end_layout

\begin_layout Definition
\begin_inset Argument 1
status open

\begin_layout Plain Layout
结构化网格
\end_layout

\end_inset

一般数值计算中正交与非正交曲线坐标系中生成的网格都是结构化网格，其特点是每一节点与其邻点之间的连接关系固定不变，且隐含在所生成的网格中，因而我们不必专门设置数据
去确认节点与邻点之间的这种联系。 从严格意义上讲，结构化网格是指网格区域内所有的内部点都具有相同的毗邻单元。结构化网格的主要优点有以下几点：
\end_layout

\begin_layout Itemize
网格生成的速度快；
\end_layout

\begin_layout Itemize
网格生成的质量好；
\end_layout

\begin_layout Itemize
数据结构简单。
\end_layout

\begin_layout Itemize
对曲面或空间的拟合大多数采用参数化或样条插值的方法得到，区域光滑，与实际的模型更容易接近；
\end_layout

\begin_layout Definition
\begin_inset Argument 1
status open

\begin_layout Plain Layout
非结构化网格
\end_layout

\end_inset

 同结构化网格的定义相对应，非结构化网格是指网格区域内的内部点不具有相同的批邻单元。即与网格剖分区域内的不同内点相连的网格数目不同。
\end_layout

\begin_layout Standard
从定义上可以看出，结构化网格和非结构化网格有相互重叠的部分，即非结构化网格中可能会包含结构化网格的部分。 非结构化网格技术从 20 世纪 60
 年代开始得到了发展，主要是弥补结构化网格不能解决任意形状和任意连通区域的网格剖分的欠缺。 由于对不规则区域的特别适应性而自 20 世纪 80
 年代以来得到迅速的发展，到 90 年代时，非结构化网格的文献达到了它的高峰时期。由于非结构化网格的生成技术比较复杂，随着人们对求解区域的复杂性的不断提高，对非
结构化网格生成技术的要求越来越高。
\end_layout

\begin_layout Itemize
所有的网格都能以非结构化的形式描述 
\end_layout

\begin_layout Itemize
部分网格（六面体网格，四面体网格）能用结构化的形式描述，也即是如果是结构化网格，则必须是 6 面体网格或者四边形网格，但是四边形网格和六面体网格不一定是结构化网
格。 
\end_layout

\begin_layout Itemize
结构化网格能转换成非结构化网格，但是非结构化网格一般不能转换成结构网格。 
\end_layout

\begin_layout Itemize
结构化网格能通过 IJK 索引，而非结构不可以。
\end_layout

\begin_layout Section
同构网格映射
\end_layout

\begin_layout Standard
周期性边界的两张网格，如果需要寻找节点间的一一映射关系，可以使用 sort 函数，并设定先对横坐标
\begin_inset Formula $x$
\end_inset

排序，在一定的重叠范围
\begin_inset Formula $\delta_{x}$
\end_inset

内，再对纵坐标
\begin_inset Formula $y$
\end_inset

排序，则几乎能够唯一确定节点的次序。此时，两个 vector 是一一对应的。
\end_layout

\begin_layout Section
点到平面距离公式
\end_layout

\begin_layout Standard
平面方程，过一点
\begin_inset Formula $P=(a,b,c)$
\end_inset

 且垂直于 法向矢量 
\begin_inset Formula $(A,B,C)$
\end_inset

 的点的集合：
\begin_inset Formula 
\[
A(x-a)+B(y-b)+C(z-c)=0
\]

\end_inset

可以进一步化简成
\begin_inset Formula 
\[
Ax+By+Cz+D=0,
\]

\end_inset

不同的
\begin_inset Formula $D$
\end_inset

 对应不同的
\begin_inset Formula $P$
\end_inset

，即垂直于 
\begin_inset Formula $(A,B,C)$
\end_inset

 的平面簇。
\end_layout

\begin_layout Standard
给定平面外一点 
\begin_inset Formula $Q=(x_{0},y_{0},z_{0})$
\end_inset

，则点到平面的距离为
\begin_inset Formula 
\[
d=\frac{\abs{{\color{blue}A}\,x_{0}+{\color{blue}B}\,y_{0}+{\color{blue}C}\,z_{0}+D}}{{\color{blue}\sqrt{A^{2}+B^{2}+C^{2}}}}
\]

\end_inset

可以理解成，线段
\begin_inset Formula $PQ$
\end_inset

在单位法线上的投影。
\begin_inset Formula 
\[
{\color{blue}\frac{(A,B,C)}{\sqrt{A^{2}+B^{2}+C^{2}}}}
\]

\end_inset

是归一化的法向矢量。
\end_layout

\begin_layout Section
三角形外接圆
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "外接圆--wiki"
target "https://zh.wikipedia.org/wiki/外接圓"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
圆的方程
\begin_inset Formula 
\begin{equation}
(x-x_{0})^{2}+(y-y_{0})^{2}=R^{2}\quad\Rightarrow\quad x^{2}+y^{2}-2x_{0}x-2y_{0}y-(R^{2}-x_{0}^{2}-y_{0}^{2})=0\label{eq:1.4.0}
\end{equation}

\end_inset

过三点的圆的方程：
\begin_inset Formula 
\begin{align}
 & x^{2}+y^{2}-2x_{0}x-2y_{0}y-Q^{2}=0\nonumber \\
 & x_{1}^{2}+y_{1}^{2}-2x_{0}x-2y_{0}y-Q^{2}=0\nonumber \\
 & x_{2}^{2}+y_{2}^{2}-2x_{0}x-2y_{0}y-Q^{2}=0\nonumber \\
 & x_{3}^{2}+y_{3}^{2}-2x_{0}x-2y_{0}y-Q^{2}=0\label{eq:1.4.1}
\end{align}

\end_inset

其中第一个方程是圆上动点的方程，其它是控制的方程。根据行列式的性质，将
\begin_inset Formula $x_{0}$
\end_inset

，
\begin_inset Formula $y_{0}$
\end_inset

，
\begin_inset Formula $Q^{2}$
\end_inset

理解为 矩阵列 的线性相关系数。可以写成
\begin_inset Formula 
\begin{equation}
\left|\begin{array}{cccc}
x^{2}+y^{2} & x & y & 1\\
x_{1}^{2}+y_{1}^{2} & x_{1} & y_{1} & 1\\
x_{2}^{2}+y_{2}^{2} & x_{2} & y_{2} & 1\\
x_{3}^{2}+y_{3}^{2} & x_{3} & y_{3} & 1
\end{array}\right|=0\label{eq:1.4.2}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
第一列减去第二列乘上
\begin_inset Formula $2x_{0}$
\end_inset

，减去第三列乘上
\begin_inset Formula $2y_{0}$
\end_inset

，减去第四列乘上
\begin_inset Formula $Q^{2}$
\end_inset

，即可得到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:1.4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，因此等价于行列式为零。反过来，行列式为零，则矩阵列线性相关。满足适当线性组合，因此
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:1.4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:1.4.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

等价。
\end_layout

\begin_layout Enumerate
将行列式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:1.4.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

按第一行展开，根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:1.4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，第二列的系数等于
\begin_inset Formula $2x_{0}$
\end_inset

，第三列的系数等于
\begin_inset Formula $2y_{0}$
\end_inset

，因此三角形的外心坐标和
\begin_inset Formula $Q^{2}$
\end_inset

为（负号来自行列式展开）
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(*三点共圆的方程*) mat = { {x^2 + y^2, x, y, 1} , {x1^2 + y1^2, x1, y1, 1} , {x2^2
 + y2^2, x2, y2, 1} , {x3^2 + y3^2, x3, y3, 1}}; ia = mat[[{2, 3, 4}, {2,
 3, 4}]]; ib = mat[[{2, 3, 4}, {1, 3, 4}]]; ic = mat[[{2, 3, 4}, {1, 2,
 4}]]; id = mat[[{2, 3, 4}, {1, 2, 3}]]; (*圆心坐标, 半径*) circle = Simplify[{{Det@ib
, -Det@ic}/(2*Det@ia)}]; radi2 = (Det@id/Det@ia) + (Power[#, 2] &)@(Norm
 @@ circle); circle = (Append@Sqrt@radi2)@circle; (*3 vertex of triangle*)
 tri = {{0, 0} , {1, 2} , {2, .5}}; (*坐标的替换规则*) rule = MapThread[Rule]@{{x1,
 y1, x2, y2, x3, y3}, Flatten@tri}; iCirc = circle /.
 rule; Graphics[{ Triangle@tri , Circle @@ iCirc }]
\end_layout

\end_inset


\begin_inset Formula 
\[
\frac{\left|\begin{array}{ccc}
x_{1}^{2}+y_{1}^{2} & y_{1} & 1\\
x_{2}^{2}+y_{2}^{2} & y_{2} & 1\\
x_{3}^{2}+y_{3}^{2} & y_{3} & 1
\end{array}\right|}{2\left|\begin{array}{ccc}
x_{1} & y_{1} & 1\\
x_{2} & y_{2} & 1\\
x_{3} & y_{3} & 1
\end{array}\right|},\frac{-\left|\begin{array}{ccc}
x_{1}^{2}+y_{1}^{2} & x_{1} & 1\\
x_{2}^{2}+y_{2}^{2} & x_{2} & 1\\
x_{3}^{2}+y_{3}^{2} & x_{3} & 1
\end{array}\right|}{2\left|\begin{array}{ccc}
x_{1} & y_{1} & 1\\
x_{2} & y_{2} & 1\\
x_{3} & y_{3} & 1
\end{array}\right|},\quad\frac{\left|\begin{array}{ccc}
x_{1}^{2}+y_{1}^{2} & x_{1} & y_{1}\\
x_{2}^{2}+y_{2}^{2} & x_{2} & y_{2}\\
x_{3}^{2}+y_{3}^{2} & x_{3} & y_{3}
\end{array}\right|}{2\left|\begin{array}{ccc}
x_{1} & y_{1} & 1\\
x_{2} & y_{2} & 1\\
x_{3} & y_{3} & 1
\end{array}\right|}
\]

\end_inset

或者直接求解方程
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
equ = { (Subscript[x, 1] - Subscript[x, 0])^2 + (Subscript[y, 1] - Subscript[y,
 0])^2 == r2, (Subscript[x, 2] - Subscript[x, 0])^2 + (Subscript[y, 2] -
 Subscript[y, 0])^2 == r2, (Subscript[x, 3] - Subscript[x, 0])^2 + (Subscript[y,
 3] - Subscript[y, 0])^2 == r2}; ans = Simplify[ First@Solve[equ, {Subscript[x,
 0], Subscript[y, 0], r2}], r2 > 0 ]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
 & x_{0}=\frac{x_{1}^{2}y_{23}+x_{2}^{2}y_{31}+x_{3}^{2}y_{12}-y_{23}y_{31}y_{12}}{a},\\
 & y_{0}=\frac{x_{1}b_{23}+x_{2}b_{31}+x_{3}b_{12}}{a},\\
 & R^{2}=\frac{\left(x_{12}^{2}+y_{12}^{2}\right)\left(x_{13}^{2}+y_{13}^{2}\right)\left(x_{23}^{2}+y_{23}^{2}\right)}{a^{2}}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
其中定义了 
\begin_inset Formula $a$
\end_inset

，
\begin_inset Formula $b_{ij}$
\end_inset

，
\begin_inset Formula $x_{ij}$
\end_inset

：
\begin_inset Formula 
\begin{align*}
 & a=2(x_{3}y_{12}+x_{1}y_{23}+x_{2}y_{31})\\
 & b_{ij}=x_{i}^{2}+y_{i}^{2}-x_{j}^{2}-y_{j}^{2}\\
 & x_{ij}=x_{i}-x_{j}\text{，}y_{ij}=y_{i}-y_{j}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate
讨论特殊情况：分母实际就是三角形的面积。因此只要三点不共线，上面的解始终适用。
\end_layout

\begin_layout Enumerate
另一个角度：给定任意三点，不妨通过坐标系转动使得
\begin_inset Formula $x_{1}=x_{2}$
\end_inset

且
\begin_inset Formula $y_{1}\neq y_{2}$
\end_inset

（非同一点），令
\begin_inset Formula $a=0$
\end_inset

，解得 
\begin_inset Formula $x_{1}=x_{3}$
\end_inset

，则 
\begin_inset Formula $x_{1}=x_{2}=x_{3}$
\end_inset

，表明只有三点共线，才会令分母
\begin_inset Formula $a=0$
\end_inset

。同样，如果我们令
\begin_inset Formula $y_{1}=y_{2}$
\end_inset

且
\begin_inset Formula $x_{1}\neq x_{2}$
\end_inset

，
\begin_inset Formula $a=0$
\end_inset

 将迫使
\begin_inset Formula $y_{1}=y_{2}=y_{3}$
\end_inset

，对应三点共线。
\end_layout

\begin_layout Section
四面体外接球
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "Circumsphere"
target "https://mathworld.wolfram.com/Circumsphere.html"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "外接球算法"
target "https://blog.csdn.net/LiveALearn/article/details/7412214"
literal "false"

\end_inset

。类似外接圆，外接球上一点
\begin_inset Formula $(x,y,z)$
\end_inset

满足的方程是
\begin_inset Formula 
\[
\det(M)=\left|\begin{array}{ccccc}
x^{2}+y^{2}+z^{2} & x & y & z & 1\\
x_{1}^{2}+y_{1}^{2}+z_{1}^{2} & x_{1} & y_{1} & z_{1} & 1\\
x_{2}^{2}+y_{2}^{2}+z_{2}^{2} & x_{2} & y_{2} & z_{2} & 1\\
x_{3}^{2}+y_{3}^{2}+z_{3}^{2} & x_{3} & y_{3} & z_{3} & 1\\
x_{4}^{2}+y_{4}^{2}+z_{4}^{2} & x_{4} & y_{4} & z_{4} & 1
\end{array}\right|=0
\]

\end_inset

展开行列式
\begin_inset Formula 
\[
a(x^{2}+y^{2}+z^{2})-\left(D_{x}x+D_{y}y+D_{z}z\right)+c=0
\]

\end_inset

其中 
\begin_inset Formula $a=\det M\left\llbracket 2;;5,\,2;;5\right\rrbracket $
\end_inset


\begin_inset Formula 
\[
a\equiv\left|\begin{array}{cccc}
x_{1} & y_{1} & z_{1} & 1\\
x_{2} & y_{2} & z_{2} & 1\\
x_{3} & y_{3} & z_{3} & 1\\
x_{4} & y_{4} & z_{4} & 1
\end{array}\right|
\]

\end_inset


\begin_inset Formula $D_{x}$
\end_inset

，
\begin_inset Formula $D_{y}$
\end_inset

，
\begin_inset Formula $D_{z}$
\end_inset

分别是下列余子式
\begin_inset Formula 
\[
\det M\left\llbracket 2;;5,\,\{\cancel{2}\}\right\rrbracket ,\quad-\det M\left\llbracket 2;;5,\,\{\cancel{3}\}\right\rrbracket ,\quad\det M\left\llbracket 2;;5,\,\{\cancel{4}\}\right\rrbracket ,
\]

\end_inset

其中
\begin_inset Formula $\{\cancel{2}\}$
\end_inset

表示除去第
\begin_inset Formula $2$
\end_inset

列。类似地，
\begin_inset Formula 
\[
c=\det M\left\llbracket 2;;5,\,1;;4\right\rrbracket 
\]

\end_inset

写成完全平方式
\begin_inset Formula 
\[
a(x-\frac{D_{x}}{2a})^{2}+a(y-\frac{D_{y}}{2a})^{2}+a(z-\frac{D_{z}}{2a})^{2}-\frac{D_{x}^{2}+D_{y}^{2}+D_{z}^{2}}{4a}+c=0
\]

\end_inset

对比球的标准形式
\begin_inset Formula 
\[
(x-x_{0})^{2}+(y-y_{0})^{2}+(z-z_{0})^{2}=r^{2}
\]

\end_inset

得到球心，半径平方 为
\begin_inset Formula 
\[
(\frac{D_{x}}{2a},\frac{D_{y}}{2a},\frac{D_{z}}{2a}),\quad\frac{D_{x}^{2}+D_{y}^{2}+D_{z}^{2}-4ac}{4a}
\]

\end_inset


\end_layout

\begin_layout Standard
也可以使用Mathemtaica直接求解，下面的代码给出C语言表达式。
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=Mathematica,basicstyle={\ttfamily}"
inline false
status open

\begin_layout Plain Layout

equ = {(x1 - x0)^2 + (y1 - y0)^2 + (z1 - z0)^2 == r2
\end_layout

\begin_layout Plain Layout

,(x2 - x0)^2 + (y2 - y0)^2 + (z2 - z0)^2 == r2
\end_layout

\begin_layout Plain Layout

,(x3 - x0)^2 + (y3 - y0)^2 + (z3 - z0)^2 == r2
\end_layout

\begin_layout Plain Layout

,(x4 - x0)^2 + (y4 - y0)^2 + (z4 - z0)^2 == r2}; 
\end_layout

\begin_layout Plain Layout

ans = Simplify[First@Solve[equ, {x0, y0, z0, r2}], r2 > 0];
\end_layout

\begin_layout Plain Layout

cRule = {Power -> pow}; CForm[Last@ ans[[1]] /.
 cRule]
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
泛函与弱形式
\end_layout

\begin_layout Section
变分法
\end_layout

\begin_layout Standard
ref:
\begin_inset CommandInset href
LatexCommand href
name "变分法简介Part 1"
target "https://zhuanlan.zhihu.com/p/20718489"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "变分法简介Part 2"
target "https://zhuanlan.zhihu.com/p/20727402"
literal "false"

\end_inset


\end_layout

\begin_layout Definition
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
泛函数 (Functionals)
\end_layout

\end_inset

 简而言之，泛函数是 函数 的函数，即它的输入是函数，输出是实数。而这个输出值取决于一个或多个函数（输入）在一整个路径上的积分，而非像一般函数那样取决于离散的变
量。
\end_layout

\begin_layout Standard
通常在变分法中，泛函数是一个积分，记做
\begin_inset Formula $I$
\end_inset

，例如
\begin_inset Formula 
\[
I=\int_{x_{1}}^{x^{2}}F\dd{x}.
\]

\end_inset

其中我们想要通过 选择被积函数 
\begin_inset Formula $F$
\end_inset

 来最大化或最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的值。同时我们称 
\begin_inset Formula $F$
\end_inset

 为拉格朗日函数(Lagrangian)。
\begin_inset Formula $F$
\end_inset

 可以是函数 
\begin_inset Formula $y(x)$
\end_inset

 和 
\begin_inset Formula $y(x)$
\end_inset

 各阶导数的函数(以下 
\begin_inset Formula $y(x)$
\end_inset

均简写成 
\begin_inset Formula $y$
\end_inset

)。
\end_layout

\begin_layout Definition
\begin_inset CommandInset label
LatexCommand label
name "def:extreme"

\end_inset


\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
泛函数的极值
\end_layout

\end_inset

 泛函数 
\begin_inset Formula $I$
\end_inset

 在区间 
\begin_inset Formula $[x_{1},x_{2}]$
\end_inset

 上的值取决于积分路径的选择，即取决于函数 
\begin_inset Formula $y(x)$
\end_inset

 的选择。我们有理由假设存在一个这样的 
\begin_inset Formula $y(x)$
\end_inset

，可以使得泛函数 
\begin_inset Formula $I$
\end_inset

 取到极值。而在这个 
\begin_inset Formula $y(x)$
\end_inset

 附近的任意路径我们记做 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

。另外，我们假设 
\begin_inset Formula $y(x)$
\end_inset

 两阶可微。通过引入一个微小量 
\begin_inset Formula $\varepsilon\ll1$
\end_inset

 和一个任意可微函数 
\begin_inset Formula $\eta(x)$
\end_inset

，我们可以用 
\begin_inset Formula $y(x)$
\end_inset

 表示 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

：
\begin_inset Formula 
\[
\tilde{y}(x)=y(x)+\varepsilon\eta(x).
\]

\end_inset


\end_layout

\begin_layout Standard
这样做的好处是对于一个给定的 
\begin_inset Formula $\eta(x)$
\end_inset

，我们可以通过改变 
\begin_inset Formula $\eta$
\end_inset

 值来得到无穷多的路径，同时对于任何 
\begin_inset Formula $\eta(x)$
\end_inset

，当 
\begin_inset Formula $\varepsilon(x)=0$
\end_inset

 的时候，
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 和 
\begin_inset Formula $y(x)$
\end_inset

 重合。图像直观表示如下图：
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/fanhan-1.png
	lyxscale 50
	scale 45

\end_inset


\end_layout

\begin_layout Standard
由于存在边界条件的限制，需要要求 
\begin_inset Formula $\eta(x_{1})=\eta(x_{2})=0$
\end_inset

。这样就能保证 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 可以通过两个固定端点。这时我们可以说，
\begin_inset Formula $y(x)$
\end_inset

 所对应的泛函数 
\begin_inset Formula $I$
\end_inset

 的值是泛函数 
\begin_inset Formula $\tilde{I}=\int_{x_{1}}^{x^{2}}F\left(\tilde{y},\tilde{y}';x\right)\dd{x}$
\end_inset

 的极值。我们可以进一步用 
\begin_inset Formula $\varepsilon$
\end_inset

 表示 
\begin_inset Formula $\tilde{I}$
\end_inset

：
\begin_inset Formula 
\[
\tilde{I}=\int_{x_{1}}^{x^{2}}F(\tilde{y},\tilde{y}';x)\dd{x}=\int_{x_{1}}^{x^{2}}F\left(y+\varepsilon\eta,y'+\varepsilon\eta';x\right)\dd{x}
\]

\end_inset

虽然 
\begin_inset Formula $y(x)$
\end_inset

 未知，但是根据之前的合理假设，
\begin_inset Formula $y(x)$
\end_inset

 是一个存在的确定函数。所以根据上式，如果给定一个特定的 
\begin_inset Formula $\eta(x)$
\end_inset

，
\begin_inset Formula $\tilde{I}$
\end_inset

 的变化只取决于 
\begin_inset Formula $\varepsilon$
\end_inset

 的变化。所以我们现在可以把 
\begin_inset Formula $\tilde{I}$
\end_inset

 看做是 
\begin_inset Formula $\varepsilon$
\end_inset

 的函数。用泰勒展开公式将 
\begin_inset Formula $\tilde{I}$
\end_inset

 在
\begin_inset Formula $\varepsilon=0$
\end_inset

 处展开得到：
\begin_inset Formula 
\[
\tilde{I}(\varepsilon)=\left.\tilde{I}\right|_{\varepsilon=0}+\left.(\frac{\dd{\tilde{I}}}{\dd{\varepsilon}})\right|_{\varepsilon=0}\cdot\varepsilon+\left.(\frac{\dd[2]{\tilde{I}}}{\dd{\varepsilon^{2}}})\right|_{\varepsilon=0}\cdot\frac{\varepsilon^{2}}{2!}+\cdots=\tilde{I}_{0}+\tilde{I}_{1}\varepsilon+\tilde{I}_{2}\varepsilon^{2}+\cdots
\]

\end_inset

很明显，当 
\begin_inset Formula $\varepsilon=0$
\end_inset

 时，
\begin_inset Formula $\left.\tilde{I}\right|_{\varepsilon=0}=I$
\end_inset

，代入上式可得到：
\begin_inset Formula 
\[
\tilde{I}-I=\tilde{I}_{1}\varepsilon+\tilde{I}_{2}\varepsilon^{2}+\cdots
\]

\end_inset

这里我们记 
\begin_inset Formula $\delta I=\tilde{I}_{1}\varepsilon=\left.(\frac{\dd{\tilde{I}}}{\dd{\varepsilon}})\right|_{\varepsilon=0}\cdot\varepsilon$
\end_inset

，并称之为一阶变分。同理二阶变分为 
\begin_inset Formula $\delta I^{2}=\tilde{I}_{2}\varepsilon^{2}$
\end_inset

。
\end_layout

\begin_layout Remark
这里插一句变分和微分的区别。变分在上图的直观解释是
\begin_inset Formula $\tilde{y}$
\end_inset

和 
\begin_inset Formula $y$
\end_inset

 在竖直方向上的距离，称之为 
\begin_inset Formula $\delta y$
\end_inset

，所以这个差是在同一个 
\begin_inset Formula $x$
\end_inset

 上计算的。而微分则是由于 
\begin_inset Formula $x$
\end_inset

 的微小变动引起的 
\begin_inset Formula $y$
\end_inset

 的变动。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
然后我们可以类比求函数极值时的做法。求函数极值时，我们会令函数的一阶导数为零。这里同样，为了求泛函数 
\begin_inset Formula $\tilde{I}$
\end_inset

 的极值，我们令一阶变分 
\begin_inset Formula $\delta I=0$
\end_inset

。计算 
\begin_inset Formula $\delta I$
\end_inset

，并通过分部积分得到
\begin_inset Formula 
\begin{equation}
\delta I=\int_{x_{1}}^{x^{2}}\left(\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}\right)\delta y\dd{x}+\left.{\color{blue}\frac{\partial F}{\partial y'}\delta y}\right|_{x_{1}}^{x_{2}}\label{eq:EL-equ}
\end{equation}

\end_inset

令 
\begin_inset Formula $\delta I=0$
\end_inset

 就能解得最小化泛函数的 
\begin_inset Formula $y$
\end_inset

。由于 
\begin_inset Formula $\delta y$
\end_inset

 是任意地，所以要想使上式等于零，需要
\begin_inset Formula 
\[
\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}=0,\quad x_{1}\le x\le x_{2}
\]

\end_inset

即 欧拉–拉格朗日方程（Euler–Lagrange equation）。而第二部分等于零则是边界条件。
\end_layout

\begin_layout Standard
对于边界条件：
\end_layout

\begin_layout Enumerate
如果在边界 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 
\begin_inset Formula ${\color{blue}\frac{\partial F}{\partial y'}}$
\end_inset

 等于零，那么我们称在 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 满足自然边界条件（
\series bold
Natural Boundary Condition
\series default
）。
\end_layout

\begin_layout Enumerate
对应的，如果在边界 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 
\begin_inset Formula ${\color{blue}\delta y}$
\end_inset

 等于零，我们就称 在 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 满足 
\series bold
Essential Boundary condition
\series default
。
\begin_inset Formula $\delta y=0$
\end_inset

 是一个比较模糊的概念，不好判断，所以我们把它等价转化一下。如果
\begin_inset Formula $y$
\end_inset

在某一点处的变分为零，说明它在这点的值是确定不变的。换句话说如果 
\begin_inset Formula $y$
\end_inset

 在边界上是确定的值(specified)，那么我们称这个是 essential boundary condition。
\end_layout

\begin_layout Subsection
含有高阶导数
\end_layout

\begin_layout Standard
当然上述问题中，
\begin_inset Formula $F$
\end_inset

 只是
\begin_inset Formula $y$
\end_inset

和
\begin_inset Formula $y'$
\end_inset

的函数，但是
\begin_inset Formula $F$
\end_inset

完全还可能是
\begin_inset Formula $y''$
\end_inset

甚至更高阶导数的函数。这时候我们用上节所说的设 
\begin_inset Formula $\tilde{y}=y(x)+\varepsilon\eta(x)$
\end_inset

 的方法就有点麻烦了（但是也可行）。这里我们提供一个更高效的方法，直接对泛函数求变分。假如泛函数 
\begin_inset Formula $I=\int_{x_{1}}^{x^{2}}F(\tilde{y},\tilde{y}',y'';x)\dd{x}$
\end_inset

，那么它的一阶变分为：
\begin_inset Formula 
\[
\delta I=\int_{x_{1}}^{x^{2}}\frac{\partial F}{\partial y}\delta y+\frac{\partial F}{\partial y'}\delta y'+\frac{\partial F}{\partial y''}\delta y''\dd{x}
\]

\end_inset

然后再进行分部积分得到：
\begin_inset Formula 
\[
\delta I=\int_{x_{1}}^{x^{2}}\left(\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}+\frac{\dd[2]}{\dd{x^{2}}}\frac{\partial F}{\partial y''}\delta\right)\delta y\dd{x}+\left.\frac{\partial F}{\partial y''}\delta y'+\left[\frac{\partial F}{\partial y'}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y''}\right]\delta y\right|_{x_{1}}^{x_{2}}=0
\]

\end_inset

同样我们可以得到欧拉-拉格朗日方程：
\begin_inset Formula 
\[
\text{E-L:}\,\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}+\frac{\dd[2]}{\dd{x^{2}}}\frac{\partial F}{\partial y''}=0
\]

\end_inset

以及边界条件：
\begin_inset Formula 
\begin{align*}
\frac{\partial F}{\partial y''}=0,\;\text{(Natural)}\quad & \text{or}\quad\delta y'=0\;\text{(Essential)}\\
\frac{\partial F}{\partial y'}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y''}=0,\;\text{(Natural)}\quad & \text{or}\quad y=0\;\text{(Essential)}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
约束条件（拉格朗日乘数）
\end_layout

\begin_layout Standard
现在我们来讨论下如果我们需要求在满足一定条件下求泛函数的极值，应该如何求解。
\end_layout

\begin_layout Standard
举个简单的例子，如果给定一个区域的边界长度，我们想最大化该边界所围的区域。这类问题我们需要引进拉格朗日乘数(
\begin_inset Formula $\lambda$
\end_inset

)。
\end_layout

\begin_layout Standard
假设约束条件为：
\begin_inset Formula $J(y)=\int_{x_{1}}^{x_{2}}G(y,y';x)=\text{const.}$
\end_inset

那我们引入拉格朗日乘数在原泛函数的基础上构建新的泛函数：
\begin_inset Formula 
\[
I^{*}=I+\lambda J=\int_{x_{1}}^{x_{2}}(F+\lambda G)\dd{x}=\int_{x_{1}}^{x_{2}}F^{*}(y,y';x)\dd{x}
\]

\end_inset

然后我们就可以转化成之前的问题来解了。还是用刚才提到的最大化面积问题为例来阐述下这个过程：
\end_layout

\begin_layout Enumerate
面积：
\begin_inset Formula $A=\int_{x_{1}}^{x_{2}}y\dd{x}$
\end_inset

，
\end_layout

\begin_layout Enumerate
边界长度约束：
\begin_inset Formula $S=\int_{x_{1}}^{x_{2}}\sqrt{1+(y')}^{2}\dd{x}=\text{const.}$
\end_inset


\end_layout

\begin_layout Enumerate
则：
\begin_inset Formula $I^{*}=\int_{x_{1}}^{x_{2}}[y+\lambda\sqrt{1+(y')}^{2}]\dd{x}$
\end_inset


\end_layout

\begin_layout Enumerate
令一阶变分为零（
\begin_inset Formula $\delta I^{*}=0$
\end_inset

）：
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}[\delta y+\lambda\frac{y'}{\sqrt{1+(y')}^{2}}\delta y']\dd{x}=0
\]

\end_inset

依旧老朋友分部积分：
\begin_inset Formula 
\[
\delta I^{*}=\int_{x_{1}}^{x_{2}}[1-\lambda\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}]\delta y\dd{x}+\text{B.C.term}=0
\]

\end_inset

这里图方便我就将边界条件项用 B.C.term 代替啦。然后欧拉-拉格朗日方程为：
\begin_inset Formula 
\[
\text{E-L:}\,1-\lambda\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}=0,\quad x\in(x_{1},x_{2})
\]

\end_inset


\end_layout

\begin_layout Enumerate
现在我们可以解一下E-L方程：
\begin_inset Formula 
\[
\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}=\frac{1}{\lambda}\quad\Rightarrow\quad\frac{y''}{(1+y^{\prime2})^{3/2}}=\frac{1}{\lambda}.
\]

\end_inset

也就是说边界是曲率恒为 
\begin_inset Formula $\frac{1}{\lambda}$
\end_inset

 的曲线，即半径为 
\begin_inset Formula $\lambda$
\end_inset

 的圆，这也和我们常识一致。
\end_layout

\begin_layout Standard
上文说到了用 
\emph on
最小化泛函数
\emph default
 的方法求解问题，最终可以将问题转化为求解一个带有边界条件的偏微分方程（PDE）。但是实际上并不是所有的 PDE 都像上次那个两点间最短距离问题中的PDE那么好
解，这也就是为什么我们要有有限元方法，因为有限元可以避开求解复杂偏微分方程，用相对简单的方法来求解其近似解。一般有三种近似方法，分别是 
\series bold
Rayleigh-Ritz method
\series default
，
\series bold
Strong Form Galerkin
\series default
 (SFG) 和 
\series bold
Weak Form Galerkin
\series default
 (WFG)。后两者就是我们常听说的貌似比较高大上的 
\series bold
强形式
\series default
 和 
\series bold
弱形式
\series default
。后面会分别介绍和比较这三种方法。以后的文章会介绍如何将他们运用于有限元方法。
\end_layout

\begin_layout Standard
在最开始，首先要理清一个非常重要的思路。那就是通过变分法最小化泛函数得到的 PDE 和 原泛函数 之间的关系。如果理清了这个关系，上述三种方法的基本思想就算是掌
握了，剩下的就是一些数学而已了。它们之间的关系是：PDE 的解是能将原泛函数最小化的函数。
\end_layout

\begin_layout Standard
这层关系给我们提供了两条路走：
\end_layout

\begin_layout Enumerate
直接从泛函数出发，找出可以最小化它的函数。
\end_layout

\begin_layout Enumerate
通过变分法得到PDE，然后求解PDE（近似求解），这样得到的PDE的解（或近似解）就是方法1中所要求的函数。
\end_layout

\begin_layout Standard
上面提到的三种方法就是顺着这两条路走的。Rayleigh-Ritz 对应于第一条路，强弱形式对应于后一条路。看上去 Rayleigh-Ritz
 法和求解微分方程并没有什么关系，因为它跳过了通过变分法得到 PDE 这个步骤，但是根据上面提到的关系，我们可以把思维逆转过来，即 能够将 泛函数最小化的函数，
是使用变分法后得到的PDE的解。这样我们也可以强行把 Rayleigh-Ritz 法看成是近似求解微分方程的方法。
\end_layout

\begin_layout Section
Rayleigh-Ritz Method
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "Rayleigh-Ritz Method"
target "https://zhuanlan.zhihu.com/p/20882021"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
第一条路看似是更直接的捷径，但是世界上有无穷种函数，直接找出可以最小化一个泛函数的函数谈何容易。但是如果我们先假设一下这个函数的形式，那么未知的就只是一些系数了
，再将这个假设的函数代入 原泛函数，就可以将泛函数转化为未知系数的函数，而最小化函数对我们而言是轻而易举的（对未知系数求导等于零），解出未知系数后代入假设的函数
，就得到了最小化泛函数的近似解。这就是 Rayleigh-Ritz Method 的基本思想。一般来说，我们会将近似函数的形式设为多项式(polynomial)
，例如，这也是有限元里常用的形式。话不多说，看个简单的例子：
\end_layout

\begin_layout Example
如图，拉伸一个横截面积为 
\begin_inset Formula $A$
\end_inset

，长为 
\begin_inset Formula $L$
\end_inset

，杨氏模量为 
\begin_inset Formula $E$
\end_inset

 的杆，最右端的力为 
\begin_inset Formula $P$
\end_inset

，位移为 
\begin_inset Formula $u_{0}$
\end_inset

。我们想要用最小势能原理解出其位移场 
\begin_inset Formula $u(x)$
\end_inset

。虽然很明显精确解是 
\begin_inset Formula $u(x)=\frac{u_{0}}{L}x$
\end_inset

，但是就像之前的两点间直线最短的例子一样，例子虽然简单，但是可以帮助我们感受下这个方法的过程。
\end_layout

\begin_layout Example
\begin_inset Graphics
	filename inset/fanhan-2.png

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
我们可以写出系统势能（具体为什么是这个式子之后的文章会解释，这次着重于介绍方法的思想）：
\begin_inset Formula $\Pi=\frac{1}{2}\int_{0}^{L}EA\,u^{\prime2}\dd{x}-Pu_{0}$
\end_inset

。由于左端固定，右端位移已知，所以有两个 Essential Boundary Conditions: 
\begin_inset Formula $\left.u\right|_{x=0}=0$
\end_inset

 和 
\begin_inset Formula $\left.u\right|_{x=L}=u_{0}$
\end_inset

 。
\end_layout

\begin_layout Standard
根据上文的思路，我们设待求函数 
\begin_inset Formula $u(x)$
\end_inset

 的形式为多项式。这里姑且先设成二次形式。一般来说，设的次数越高，近似解越精确，但是由于本例精确解就是个一次线性方程，所以只要设的函数高于
\begin_inset Formula $1$
\end_inset

次，近似解就和精确解相同。另一个需要注意的是，使用 Rayleigh-Ritz 法时，设的近似方程（如本例中的
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 ）必须满足 Essential Boundary Conditions(不必须满足Natural Boundary Condition)。遵循这点，我们可以得
出两个等式：
\begin_inset Formula 
\[
\tilde{u}(0)=0,\quad\text{and}\quad\tilde{u}(L)=0,
\]

\end_inset

由上述两式可以解出 
\begin_inset Formula $a_{0}=0$
\end_inset

 以及 
\begin_inset Formula 
\[
a_{1}L+a_{2}L^{2}=u_{0}\Rightarrow a_{2}=\frac{u_{0}-a_{1}L}{L^{2}},
\]

\end_inset

将这两个结果代入 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 整理下得到：
\begin_inset Formula 
\[
\tilde{u}(x)=\frac{u_{0}}{L^{2}}x^{2}+a_{1}(x-\frac{x^{2}}{L}).
\]

\end_inset

也就是说我们只有 
\begin_inset Formula $1$
\end_inset

 个未知参数 
\begin_inset Formula $a_{1}$
\end_inset

。
\end_layout

\begin_layout Standard
通常我们会将 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 写成 
\begin_inset Formula $\tilde{u}(x)=\phi_{0}(x)+\sum_{j=1}^{n}c_{j}\phi_{j}(x)$
\end_inset

 的形式。对应这个例子
\begin_inset Formula 
\[
\phi_{0}=\frac{u_{0}}{L^{2}}x^{2},\quad c_{1}=a_{1},\quad\phi_{1}=\frac{x}{L}(L-x),
\]

\end_inset

如果有更多未知参数，则会有更高阶项。
\begin_inset Formula $\phi_{i}$
\end_inset

 有个 
\series bold
重要性质
\series default
：从 
\begin_inset Formula $\phi_{1}$
\end_inset

 开始，所有的 
\begin_inset Formula $\phi_{i}$
\end_inset

 在 Essential Boundary Condition 处都等于零。比如这个例子中，在 
\begin_inset Formula $x=0$
\end_inset

和
\begin_inset Formula $x=L$
\end_inset

处有 Essential Boundary Condition，那么
\begin_inset Formula $\phi_{1}$
\end_inset

 在
\begin_inset Formula $x=0$
\end_inset

和
\begin_inset Formula $x=L$
\end_inset

处必须等于零。我们可以发现确实满足，如果有更高阶项 
\begin_inset Formula $\phi_{2}$
\end_inset

，
\begin_inset Formula $\phi_{3}$
\end_inset

 等等，同样应该满足。这个性质可以帮助我们检查假设的 近似函数是否正确。现在需要做的就是把 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 代入到原泛函数中，即用 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 取代 
\begin_inset Formula $u(x)$
\end_inset

。
\begin_inset Formula 
\begin{align*}
 & \tilde{u}'(x)=\frac{2u_{0}}{L^{2}}x+c_{1}(1-\frac{2x}{L})\\
 & \Pi=\frac{1}{2}\int_{0}^{L}EA\,\tilde{u}'(x)^{2}\dd{x}-Pu_{0}=\frac{EA}{2}(\frac{4u_{0}^{2}}{3L}+\frac{c_{1}^{2}L}{3}-\frac{2u_{0}c_{1}}{3})-Pu_{0}
\end{align*}

\end_inset

这样 
\begin_inset Formula $\Pi$
\end_inset

 就仅是 
\begin_inset Formula $c_{1}$
\end_inset

 的函数而已，那么最小化就非常简单了，即令
\begin_inset Formula $\frac{\dd{\Pi}}{\dd{c_{1}}}=0$
\end_inset

：
\begin_inset Formula 
\[
\frac{\dd{\Pi}}{\dd{c_{1}}}=\frac{2}{3}c_{1}L-\frac{2}{3}u_{0}=0,
\]

\end_inset

解得 
\begin_inset Formula $c_{1}=\frac{u_{0}}{L}$
\end_inset

。代入
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 得到 
\begin_inset Formula $\tilde{u}(x)=\frac{u_{0}}{L}x$
\end_inset

。可以看到这和精确解一致，这是由于所设的近似方程的形式恰巧和精确解方程的形式一样，但是大多数问题中，精确解一般都不是多项式，所以如果将近似函数设为多项式，则会产
生误差，得出的结果则是近似解。
\end_layout

\begin_layout Standard
上面这个例子并不能令人感到兴奋，因为本身就是一眼就能看出精确解的问题硬生生算了半天，感觉很傻，所以再举个稍微复杂点的例子感受下。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset CommandInset label
LatexCommand label
name "exa:2.2"

\end_inset

泛函为
\begin_inset Formula 
\[
I[y(x);x]=\int_{0}^{2}\left[0.5(y'')^{2}+5(y')^{2}+2y^{2}+y\right]\dd{x}-10y(0),
\]

\end_inset


\end_layout

\begin_layout Enumerate
Essential Boundary Conditions: 
\begin_inset Formula $y(2)=0$
\end_inset

；
\begin_inset Formula $y'(0)=-2$
\end_inset

。
\end_layout

\begin_layout Enumerate
Natural Boundary Conditions: ; 
\begin_inset Formula $y'''(0)=-10$
\end_inset

；
\begin_inset Formula $y''(2)=0$
\end_inset

。
\end_layout

\begin_layout Standard
有兴趣的可以用 Rayleigh-Ritz方法求解下，可以最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的近似解函数 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

。
\end_layout

\begin_layout Section
强形式Galerkin
\end_layout

\begin_layout Standard
上文介绍了 Rayleigh-Ritz 法。一句话概括下就是：将 
\series bold
泛函数
\series default
 中的待求函数设成带有 
\series bold
未知系数
\series default
 的已知形式（如多项式），并将其带入 原泛函数，从而将 
\series bold
最小化泛函数
\series default
 的问题简化成我们熟悉的 
\series bold
最小化函数
\series default
 问题来求解未知系数，最后就得出了待求函数的近似解。而这次文章以及下次文章要说到的强形式和弱形式（Strong form & Weak form
 Galerkin）法是从求解 PDE 出发的。类似于 Rayleigh-Ritz 法的思路，我们可以把PDE的解近似为一系列基函数的叠加（需要满足边界条件）。
例如如果我们要解这样一个PDE：
\begin_inset Formula 
\[
A[w(x)]-f=0,
\]

\end_inset

其中 
\begin_inset Formula $A[w(x)]$
\end_inset

 代表对待求函数 
\begin_inset Formula $w(x)$
\end_inset

 的任意微分运算，例如 
\begin_inset Formula $A[w(x)]=\frac{\partial^{2}w}{\partial x^{2}}$
\end_inset

。那么我们可以用公式写出这个PDE 的近似解为：
\begin_inset Formula 
\[
\tilde{w}(x)=\phi_{0}(x)+\sum_{j=1}^{n}c_{j}\phi_{j}(x)
\]

\end_inset

其中 
\begin_inset Formula $\phi_{j}(x)$
\end_inset

 是已知的基函数(basis functions)，
\begin_inset Formula $c_{j}$
\end_inset

 是待解的未知系数。
\begin_inset Formula $\phi_{0}(x)$
\end_inset

 是用来满足非其次边界条件的，下面会结合例子说明。
\end_layout

\begin_layout Standard
很显然，除非精确解恰巧和我们设的近似解形式相同，不然近似解是和精确解有偏差的。换句话说，如果我们把近似解 
\begin_inset Formula $\tilde{w}(x)$
\end_inset

 代入原PDE，那么将不会等于
\begin_inset Formula $0$
\end_inset

，会带来一些 
\series bold
残差
\series default
 或余量。用公式表示就是 
\begin_inset Formula 
\[
A[\tilde{w}(x)]-f=R\neq0.
\]

\end_inset

这样问题就转化为求解出 
\begin_inset Formula $c_{j}$
\end_inset

 使得余量 
\begin_inset Formula $R$
\end_inset

 在求解域上尽可能小（尽可能接近
\begin_inset Formula $0$
\end_inset

），这样我们的近似解越逼近于精确解。
\end_layout

\begin_layout Standard
这时候我们需要使用 加权余量法(Method of Weighted Residual)。这种方法的基本思想是，既然不能找到准确解使余量
\begin_inset Formula $R$
\end_inset

在整个求解域上都完全等于零，那么我们至少要找到一个近似解使余量
\begin_inset Formula $R$
\end_inset

在求解域上的某种平均等于零。说到某种平均第一反应会是将
\begin_inset Formula $R$
\end_inset

在求解域上积分，即令 
\begin_inset Formula $\int R\dd{x}=0$
\end_inset

，但这其实是个比较糟糕的想法，满足这个式子的有无穷种可能性，根本不可解。合理的做法是令
\begin_inset Formula $R$
\end_inset

的加权积分为零，写成公式即：
\begin_inset Formula 
\[
\int R(x)\Phi_{i}(x)\dd{x}=0,\quad i=1,\cdots,n
\]

\end_inset

其中 
\begin_inset Formula $\Phi_{i}$
\end_inset

 是 
\series bold
权函数
\series default
(weighted function)。权函数的选择有多种方法，这里介绍的同时也是有限元中常用的一种即 Galerkin method。该方法将近似解中的
 
\series bold
基函数
\series default
 直接当做 权函数。这样做的好处是，独立等式的数量（即
\begin_inset Formula $\phi_{i}$
\end_inset

的数量）和待解
\begin_inset Formula $c_{j}$
\end_inset

的数量相同，这样就能确保未知系数唯一且可解。解出后代入就可以得到近似解。
\end_layout

\begin_layout Standard
以上面的 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 为例，这次使用 Strong Form Galerkin，这里仅用一个未知系数。
\end_layout

\begin_layout Solution
首先大家可以用变分法证明下，能够最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的解和下面这个PDE的解是等价的。
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
y''''-10y''+4y+1=0,\quad0<x<2
\]

\end_inset

加上上述题目中的边界条件。
\end_layout

\begin_layout Standard
基本思路是写出 
\begin_inset Formula $I$
\end_inset

 的一阶变分
\begin_inset Formula 
\begin{equation}
\delta I=\int_{0}^{2}\left[y''\delta(y'')+10y'\delta(y')+4y\delta y+\delta y\right]\dd{x},\label{eq:variation1}
\end{equation}

\end_inset

然后再分部积分，即可得到 
\begin_inset CommandInset ref
LatexCommand eqref
reference "rem1"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\begin{equation}
\delta I=\int_{0}^{2}\left(y''''-10y''+4y+1\right)\delta y\dd{x}+\text{Boundary terms}.\label{eq:var-bound}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
总之现在问题就变成使用 Strong Form Galerkin求解一个带有边界条件的PDE。回顾下文章开头，第一步是设出PDE的近似解，我们一般采用多项式形式
。这里要注意，使用 Strong Form Galerkin 的时候，设的近似解既要满足 Essential boundary condition
 又要满足 Natural Boundary condition。也就是说在本例中，四个边界条件都需要满足。假设我们只用一个未知系数，那么这个多项式必须要是四次
的，即：
\begin_inset Formula 
\[
\tilde{y}=a_{1}x^{4}+a_{2}x^{3}+a_{3}x^{2}+a_{4}x+a_{5}.
\]

\end_inset

因为若要满足边界条件，我们需要列出四个等式，然后上式有五个未知系数，等于最终我们只有一个未知系数。现在我们将边界条件带入近似解：
\begin_inset Formula 
\[
\tilde{y}(2)=0;\quad\tilde{y}'(0)=-2;\quad\tilde{y}'''(0)=-10;\quad\tilde{y}''(2)=0.
\]

\end_inset

可以解得：
\begin_inset Formula 
\[
\tilde{y}(x)=-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}+a_{4}(x^{4}-24x^{2}+80),
\]

\end_inset

上式中， 
\begin_inset Formula $-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}$
\end_inset

 是
\begin_inset Formula $\phi_{0}$
\end_inset

，然后 
\begin_inset Formula $a_{4}$
\end_inset

是
\begin_inset Formula $c_{1}$
\end_inset

; 最后 
\begin_inset Formula $(x^{4}-24x^{2}+80)$
\end_inset

是
\begin_inset Formula $\phi_{1}$
\end_inset

。
\end_layout

\begin_layout Standard
接着计算残差或者余量：
\begin_inset Formula 
\[
R=\tilde{y}''''-10\tilde{y}''+4\tilde{y}+1,
\]

\end_inset

可见
\begin_inset Formula $R$
\end_inset

 是
\begin_inset Formula $a_{4}$
\end_inset

和
\begin_inset Formula $x$
\end_inset

的函数。最后计算加权积分：
\begin_inset Formula 
\[
\int_{0}^{2}\left[(\tilde{y}''''-10\tilde{y}''+4\tilde{y}+1)(x^{4}-24x^{2}+80)\right]\dd{x}=0.
\]

\end_inset

上式仅有一个未知数 
\begin_inset Formula $a_{4}$
\end_inset

，可以解得其值为 
\begin_inset Formula $0.2985$
\end_inset

，所以最终求得的近似解是：
\begin_inset Formula 
\[
\tilde{y}(x)=-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}+0.2985(x^{4}-24x^{2}+80),
\]

\end_inset

我用Matlab简单画了下上述近似解和精确解的比较，有没有很失望啊。这是由于我们只用了一个未知系数，如果用两个甚至更多的话，近似解是十分逼近精确解的，有兴趣的可
以自行尝试~
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/fanhan-3.png
	lyxscale 45
	scale 40

\end_inset


\end_layout

\begin_layout Remark
\begin_inset CommandInset label
LatexCommand label
name "rem1"

\end_inset

下面两个等式是由分部积分得来的：
\begin_inset Formula 
\begin{align*}
 & \int_{0}^{2}[y''\delta y'']\dd{x}=\int_{0}^{2}[y''''\delta y]\dd{x}-\left.y'''\delta y\right|_{0}^{2}+\left.y''\delta y'\right|_{0}^{2}\\
 & \int_{0}^{2}[10y'\delta y']\dd{x}=10(-\int_{0}^{2}[y''\delta y]\dd{x}+\left.y'\delta y\right|_{0}^{2})
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:var-bound"
plural "false"
caps "false"
noprefix "false"

\end_inset

 是把所有积分项合并，然后其余边界项统一称为 Boundary terms 得到的。
\end_layout

\begin_layout Section
弱形式Galerkin
\end_layout

\begin_layout Standard

\series bold
弱形式
\series default
 是应用最广也是被应用于有限元的方法。弱形式和强形式的本质是一致的，其实可以通过 
\series bold
分部积分
\series default
 将 强形式 转化为弱形式。强形式的主要缺点在于，所设的近似解函数需要有非常高阶的可微性。以 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 为例，待解的微分方程含有四阶导数项
\begin_inset Formula $y''''$
\end_inset

，所以所设的近似解函数需要保证四阶导数不为零，如果使用多项式形式的话，则最高次项至少要是四次。这和上文提到的由于四个边界条件都要满足，所以至少要是四次的结论是一
致的。
\end_layout

\begin_layout Standard
对应的，
\series bold
弱形式的优点在于可以通过分部积分将要求的可微次数减半，并且近似解函数只需满足 Essential boundary condition，不必满足
 Natural boundary condition
\series default
。直接说这个结论比较难以理解，还是结合一个简单的例子说明。
\end_layout

\begin_layout Standard
假设我们现在要解这样一个带边界条件的微分方程：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
y''-y-1=0;\quad\text{B.C.:}\;y(0)=1,\quad y'(1)=0
\]

\end_inset

其中 
\begin_inset Formula $y(0)=1$
\end_inset

 是 Essential boundary condition，
\begin_inset Formula $y'(1)=0$
\end_inset

 是Natural boundary condition。根据上一篇文章中强形式的思路，我们会将微分方程乘以一个 
\series bold
权函数
\series default
（基函数），然后令加权积分为零。在弱形式中，我们将乘的这个函数称为 
\series bold
检验函数
\series default
(test function)，用 
\begin_inset Formula $v(x)$
\end_inset

 表示。（后文会谈到这个 
\begin_inset Formula $v(x)$
\end_inset

 和待解函数的变分 
\begin_inset Formula $\delta y$
\end_inset

 不可告人的关系）。现在我们得到了下式：
\begin_inset Formula 
\[
\int_{0}^{1}\left[(y''-y-1)v\right]\dd{x}=\int_{0}^{1}y''v\dd{x}-\int_{0}^{1}yv\dd{x}-\int_{0}^{1}v\dd{x}=0.
\]

\end_inset

我们可以发现第二项积分内 
\begin_inset Formula $y$
\end_inset

 和 
\begin_inset Formula $v$
\end_inset

 的微分次数是一样的（都是零次微分），但是第一项积分内是二次微分而检验函数是零次微分。如果使用分部积分，就可以将一次微分转移到检验函数 
\begin_inset Formula $v$
\end_inset

上，
\series bold
这样 
\begin_inset Formula $y$
\end_inset

 的近似解函数只需是一阶线性的而不用是二次的了(对应上文提到的将要求的可微分次数减半)
\series default
。通过分部积分可得：
\begin_inset Formula 
\[
\int_{0}^{1}y''v\dd{x}=-\int_{0}^{1}y'v'\dd{x}+\left.y'v\right|_{0}^{1}
\]

\end_inset

这样积分内 
\begin_inset Formula $y$
\end_inset

 和 
\begin_inset Formula $v$
\end_inset

 的微分次数就一样了，看上去很舒服。
\end_layout

\begin_layout Standard
现在我们来处理边界项 
\begin_inset Formula $\left.y'v\right|_{0}^{1}$
\end_inset

，
\begin_inset Formula 
\[
\left.y'v\right|_{0}^{1}=\left.y'v\right|_{x=1}-\left.y'v\right|_{x=0}=y'(1)v(1)-y'(0)v(0)
\]

\end_inset

由边界条件可知，
\begin_inset Formula $y'(1)=0$
\end_inset

 。另外由于在 
\begin_inset Formula $x=0$
\end_inset

 处有 Essential boundary condition 
\begin_inset Formula $y(0)=1$
\end_inset

 ，所以 
\begin_inset Formula $v(0)=0$
\end_inset

。（这是基函数的性质，即在有Essential boundary condition 的点处为零，后面会从另一个角度阐述这个性质）)。将 
\begin_inset Formula $y'(1)=0$
\end_inset

 和 
\begin_inset Formula $v(0)=0$
\end_inset

 代入边界项可得出边界项为零。当然这种情况只是巧合，一般情况下边界项不必是零。
\end_layout

\begin_layout Standard
现在，我们最初的加权积分等式被化简为了：
\begin_inset Formula 
\[
\int_{0}^{1}y'v'+yv+v\dd{x}=0.
\]

\end_inset

其实上式就已经是原微分方程的 
\series bold
弱形式
\series default
(Weak Form)了。
\end_layout

\begin_layout Standard
这里我希望大家能去变分法 
\begin_inset CommandInset ref
LatexCommand eqref
reference "def:extreme"
plural "false"
caps "false"
noprefix "false"

\end_inset

 那里 复习一下微分方程和原泛函数的关系。通过令 泛函数的一阶变分为零，经过分部积分的化简，可以得到积分内的微分方程。上文中我们从微分方程开始得到了弱形式，现在
可以继续反推到原泛函数。这么做的目的是为了显示泛函数和其对应的微分方程的可逆关系。具体步骤如下：
\end_layout

\begin_layout Enumerate
首先弱形式积分中的前两项(
\begin_inset Formula $y'v'$
\end_inset

 和 
\begin_inset Formula $yv$
\end_inset

 )中 
\begin_inset Formula $y$
\end_inset

 和
\begin_inset Formula $v$
\end_inset

（或者 
\begin_inset Formula $y^{(n)}$
\end_inset

和
\begin_inset Formula $v^{(n)}$
\end_inset

，上标
\begin_inset Formula $n$
\end_inset

代表
\begin_inset Formula $n$
\end_inset

次导数）都是线性的，而第三项只有线性的
\begin_inset Formula $v$
\end_inset

。所以我们定义：
\begin_inset Formula 
\[
B(y,v)=\int_{0}^{1}y'v'+yv\dd{x},\quad l(v)=\int_{0}^{1}v\dd{x}
\]

\end_inset

其中 
\begin_inset Formula $B(y,v)$
\end_inset

 称为双线性项(
\begin_inset Formula $y$
\end_inset

和
\begin_inset Formula $v$
\end_inset

或其微分都是线性的)，
\begin_inset Formula $l(v)$
\end_inset

 称为线性项。
\end_layout

\begin_layout Enumerate
这样，我们就可以得到对应微分方程的原泛函数是：
\begin_inset Formula 
\[
I(y)=\frac{1}{2}B(y,y)+l(y)=\frac{1}{2}\int_{0}^{1}(y')^{2}+y^{2}+2y\dd{x}
\]

\end_inset


\end_layout

\begin_layout Standard
有兴趣的可以试着用变分法将这个泛函数化为一开始的微分方程，可以发现是一致的。从弱形式到泛函数的过程中，实际上我们做了一个 
\begin_inset Formula $v\to\delta y$
\end_inset

 的替换。如果将弱形式中 
\begin_inset Formula $v$
\end_inset

 的替换成 
\begin_inset Formula $\delta y$
\end_inset

，则可以得到：
\begin_inset Formula 
\[
\int_{0}^{1}y'\delta y'+y\delta y+\delta y\dd{x}=0
\]

\end_inset

这个式子实际上就是泛函数 的一阶变分。一切都联系在一起了。如果将 
\begin_inset Formula $v$
\end_inset

 和 
\begin_inset Formula $\delta y$
\end_inset

 看成是等价，我们可以从另一个角度解释为什么 
\begin_inset Formula $v(x)$
\end_inset

 在 Essential boundary condition 的地方等于零。比如有 
\begin_inset Formula $y(0)=1$
\end_inset

 这个Essential B.C.，说明 
\begin_inset Formula $y(x)$
\end_inset

 在 
\begin_inset Formula $x=0$
\end_inset

 处是确定或固定的，只能等于
\begin_inset Formula $1$
\end_inset

，因此自然其变分
\begin_inset Formula $\delta y$
\end_inset

 在 
\begin_inset Formula $x=0$
\end_inset

 是等于零的，因为是确定的值没有变动的空间。
\end_layout

\begin_layout Standard
从弱形式还原到原泛函数 这段算是额外的内容，让我们回到如何用Weak Form Galerkin求解近似解。还是用那个大家已经看过两遍的 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的例子，方便和其余方法比较。
\end_layout

\begin_layout Standard
泛函为
\begin_inset Formula 
\[
I[y(x);x]=\int_{0}^{2}\left[0.5(y'')^{2}+5(y')^{2}+2y^{2}+y\right]\dd{x}-10y(0),
\]

\end_inset


\end_layout

\begin_layout Enumerate
Essential Boundary Conditions: 
\begin_inset Formula $y(2)=0$
\end_inset

；
\begin_inset Formula $y'(0)=-2$
\end_inset

。
\end_layout

\begin_layout Enumerate
Natural Boundary Conditions: ; 
\begin_inset Formula $y'''(0)=-10$
\end_inset

；
\begin_inset Formula $y''(2)=0$
\end_inset

。
\end_layout

\begin_layout Standard
求解最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的近似解函数 
\begin_inset Formula $y(x)$
\end_inset

。
\end_layout

\begin_layout Solution
和Strong Form Galerkin（SFG）一样， 我们从泛函数对应的微分方程开始：
\end_layout

\begin_layout Solution
\begin_inset Formula 
\[
y''''-10y''+4y+1=0,\quad0<x<2\quad\text{（加上上述题目中的边界条件）}
\]

\end_inset

第一步也和SFG类似，将微分方程乘以检验函数然后求积分:
\begin_inset Formula 
\[
\int_{0}^{2}y''''v-10y''v+4yv+v\dd{x}=0
\]

\end_inset

然后通过 分部积分 平衡微分，将 
\begin_inset Formula $y''''$
\end_inset

 中的两撇分给
\begin_inset Formula $v$
\end_inset

，
\begin_inset Formula $y''$
\end_inset

中的一撇分给 
\begin_inset Formula $v$
\end_inset

，可以得到：
\begin_inset Formula 
\[
\int_{0}^{2}y''v''+10y'v'+4yv+v\dd{x}+\left.(y'''-10y')v\right|_{0}^{2}-\left.y''v'\right|_{0}^{2}=0
\]

\end_inset

展开一下积分外的边界项：
\begin_inset Formula 
\[
\left[y'''(2)-10y'(2)\right]v(2)-\left[y'''[0]-10y'(0)\right]v(0)-y''(2)v'(2)+y''(0)v'(0)
\]

\end_inset

由于 
\begin_inset Formula $y(2)=0$
\end_inset

 和 
\begin_inset Formula $y'(0)=-2$
\end_inset

 这两个 Essential B.C, 可以得到 
\begin_inset Formula $v(2)=0$
\end_inset

 以及 
\begin_inset Formula $v'(0)=0$
\end_inset

。再加上那两个Natural B.C，边界项可最终化简为 
\begin_inset Formula $-10v(0)$
\end_inset

。
\series bold
注意 Natural B.C.
 正是被考虑在这里，所以近似函数直须满足 Essential B.C.
\series default
。这样整个式子就被化简为：
\begin_inset Formula 
\[
H(y,v)=\int_{0}^{2}y''v''+10y'v'+4yv+v\dd{x}-10v(0)=0.
\]

\end_inset

也就是弱形式。
\end_layout

\begin_layout Solution
和SFG一样，想要求解近似解，我们也需要先将其设成一个已知形式，这里我们依然使用多项式。这里弱形式的优势就显现出来了，现在多项式只需要保证二次导数不为零，同时只
有两个 Essential B.C.
 需要满足，因此多项式最少是二次的。如果设一个二次多项式，那么一共会有三个系数，为了满足两个 Essential B.C,最终只剩下一个未知待解系数。为了得到更精
确的解，这里我们设一个三次多项式，即含有两个未知系数。
\begin_inset Formula 
\[
\tilde{y}(x)=a_{0}+a_{1}x+a_{2}x^{2}+a_{3}x^{3}
\]

\end_inset


\series bold
代入两个Essential B.C.解得
\series default
：
\begin_inset Formula 
\[
\tilde{y}(x)=4-2x+a_{2}(x^{2}-4)+a_{3}(x^{3}-8)
\]

\end_inset

对比表标准形式 
\begin_inset Formula $\phi_{0}+\sum_{i}c_{i}\phi_{i}$
\end_inset

 ，发现上式中 
\begin_inset Formula $4-2x$
\end_inset

是 
\begin_inset Formula $\phi_{0}$
\end_inset

；
\begin_inset Formula $a_{2}$
\end_inset

 是 
\begin_inset Formula $c_{1}$
\end_inset

，
\begin_inset Formula $x^{2}-4$
\end_inset

 是 
\begin_inset Formula $\phi_{1}$
\end_inset

；
\begin_inset Formula $a_{3}$
\end_inset

 是 
\begin_inset Formula $c_{2}$
\end_inset

，
\begin_inset Formula $x^{3}-8$
\end_inset

 是
\begin_inset Formula $\phi_{2}$
\end_inset

。这样就可以把 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 统一成 
\begin_inset Formula $\tilde{y}(x)=\phi_{0}+c_{i}\phi_{i}$
\end_inset

的形式。
\end_layout

\begin_layout Solution
现在我们将弱形式 
\begin_inset Formula $H(y,v)$
\end_inset

 中的所有 
\begin_inset Formula $y$
\end_inset

 替换成 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

, 所有 
\begin_inset Formula $v$
\end_inset

 替换成 
\begin_inset Formula $\phi_{i}$
\end_inset

(不包括
\begin_inset Formula $\phi_{0}$
\end_inset

)。这样我们可以得到两个式子：
\begin_inset Formula 
\begin{align*}
 & H[\tilde{y}(x),\phi_{1}]=0\\
 & H[\tilde{y}(x),\phi_{2}]=0
\end{align*}

\end_inset

这两个方程中仅有 
\begin_inset Formula $c_{1}$
\end_inset

，
\begin_inset Formula $c_{2}$
\end_inset

 两个未知量，是可解的。最终解得 
\begin_inset Formula $c_{1}=1.0682$
\end_inset

，
\begin_inset Formula $c_{2}=-0.2341$
\end_inset

。所以通过Weak Form Galerkin得到的近似解为：
\begin_inset Formula 
\[
\tilde{y}(x)=-0.234x^{3}+1.068x^{2}-2x+1.600.
\]

\end_inset


\end_layout

\begin_layout Solution
同样，用Matlab将这次结果和精确解以及上一篇文章中的SFG的结果进行对比。可以发现这次逼近了精确解很多。这是由于这次使用了两个未知系数而上次SFG只用了一个
。我试过如果SFG也用两个未知系数，其结果会比WFG更精确（对于这个例子）。但是我们仍然可以看出弱形式的优势，对于这个例子，弱形式在使用更低次的多项式的情况下，
依然比强形式的结果逼近精确解（弱形式使用了三次多项式，强形式使用了四次多项式）。
\end_layout

\begin_layout Solution
\begin_inset Graphics
	filename inset/fanhan-4.png
	lyxscale 40
	scale 40

\end_inset


\end_layout

\begin_layout Chapter
变分学
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "变分法中的欧拉方程的细致讲解&详细推导"
target "https://www.cnblogs.com/jiangongyuxiao/p/15088070.html"
literal "false"

\end_inset


\end_layout

\begin_layout Section
变分学基本引理
\end_layout

\begin_layout Standard
因为整个变分中都会大量用到这个引理，所以书中将其提出来单独作为一个引理。
\end_layout

\begin_layout Standard
当然，这个引理也是相当直观的，直观上，如果一个函数 
\begin_inset Formula $f(x)$
\end_inset

 和任一高阶可微的函数 
\begin_inset Formula $\eta(x)$
\end_inset

 正交，那么这个函数理应满足 
\begin_inset Formula $f(x)\equiv0$
\end_inset

。
\end_layout

\begin_layout Lemma
如果 
\begin_inset Formula $f(x)$
\end_inset

在 
\begin_inset Formula $[x_{1},x_{2}]$
\end_inset

 上连续，
\begin_inset Formula $\eta(x)$
\end_inset

 是在 
\begin_inset Formula $[x_{1},x_{2}]$
\end_inset

上 
\begin_inset Formula $N$
\end_inset

 次可微的任意函数（ 
\begin_inset Formula $N$
\end_inset

 可为任意自然数）。如果对于任意的 
\begin_inset Formula $\eta(x)$
\end_inset

，都恒有
\begin_inset Formula 
\begin{equation}
\int_{x_{1}}^{x_{2}}f(x)\eta(x)\dd{x}=0\label{eq:j1.1}
\end{equation}

\end_inset

则必有
\begin_inset Formula 
\[
f(x)\equiv0,\quad\forall x\in[x_{1},x_{2}]
\]

\end_inset


\end_layout

\begin_layout Section
单方程,单变量,欧拉方程
\end_layout

\begin_layout Subsection
单方程,单变量,一阶导
\end_layout

\begin_layout Theorem
设泛函
\begin_inset Formula 
\begin{equation}
I\left[y(\cdot)\right]=\int_{x_{1}}^{x_{2}}F(x,y,y')\dd{x}\label{eq:j2.1}
\end{equation}

\end_inset

其中
\begin_inset Formula $F$
\end_inset

是有着三个独立变量的已知函数，且具有二阶连续偏导数，其可取函数集为
\begin_inset Formula 
\begin{equation}
\mathbb{Y}_{1,1,1}=\left\{ y(x)\left|\begin{array}{c}
y(x)\in C_{[x_{1},x_{2}]}^{(2)}\\
y(x_{1})=y_{1},\;y(x_{2})=y_{2}
\end{array}\right.\right\} \label{eq:j2.2}
\end{equation}

\end_inset


\begin_inset Formula $Y(x)\in\mathbb{Y}_{1,1,1}$
\end_inset

使泛函
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

取得极小值的必要条件是：
\begin_inset Formula $Y(x)$
\end_inset

是下列微分方程的解
\begin_inset Formula 
\begin{equation}
F_{y}-\frac{\dd}{\dd{x}}F_{y'}=0\label{eq:j2.3}
\end{equation}

\end_inset

其中
\begin_inset Formula $F_{y}=\partial F/\partial y=F_{2}^{\prime}$
\end_inset

，
\begin_inset Formula $F_{y}^{\prime}=\partial F/\partial y'=F_{3}^{\prime}$
\end_inset

（下标的数字表示变量的槽位）。
\end_layout

\begin_layout Remark
\begin_inset Formula $\mathbb{Y}_{1,1,1}$
\end_inset

的含义是单方程，单变量，一阶导数。
\begin_inset Formula $C_{[x_{1},x_{2}]}^{(2)}$
\end_inset

 表示
\begin_inset Formula $2$
\end_inset

阶连续。
\begin_inset Formula $y(x_{1})=y_{1}$
\end_inset

，
\begin_inset Formula $y(x_{2})=y_{2}$
\end_inset

 是边界条件。
\end_layout

\begin_layout Proof
对于我们期望的极值函数
\begin_inset Formula $Y(x)$
\end_inset

，它应当满足这样的性质——我们将其叠加上一个任意的函数
\begin_inset Formula $\alpha\cdot\eta(x)$
\end_inset

，只要能使得 
\begin_inset Formula $y(x)=Y(x)+\alpha\cdot\eta(x)$
\end_inset

满足边界条件
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

，就有 
\begin_inset Formula $\left.\left[\frac{\dd{I(Y+\alpha\eta)}}{\dd{\alpha}}\right]\right|_{\alpha=0}=0$
\end_inset

。 其中 
\begin_inset Formula $\alpha$
\end_inset

 是一个充分小的实数，我们期望它的行为类似于 
\begin_inset Formula $\dd{x}$
\end_inset

，
\begin_inset Formula $\eta(x)$
\end_inset

 是满足下列条件的任意函数
\begin_inset Formula 
\begin{equation}
\mathbb{Y}_{1,1,1}^{(0)}=\left\{ \eta(x)\left|\begin{array}{c}
\eta(x)\in C_{[x_{1},x_{2}]}^{(2)}\\
\eta(x_{1})=0,\;\eta(x_{2})=0_{2}
\end{array}\right.\right\} \label{eq:j2.4}
\end{equation}

\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Enumerate
\begin_inset Formula $\alpha$
\end_inset

 理论上可以是任意实数，但实际上我们只会用到 
\begin_inset Formula $\left.\left[\frac{\dd{I[y(\cdot)]}}{\dd{\alpha}}\right]\right|_{\alpha=0}$
\end_inset

，所以我们可以把 
\begin_inset Formula $\alpha$
\end_inset

 当作类似于 
\begin_inset Formula $\varepsilon$
\end_inset

 的工具人。 
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\eta$
\end_inset

 满足的 
\begin_inset Formula $\mathbb{Y}_{1,1,1}^{(0)}$
\end_inset

 和 
\begin_inset Formula $y$
\end_inset

 满足的 
\begin_inset Formula $\mathbb{Y}_{1,1,1}$
\end_inset

唯一区别就在于边界条件为零，这是为了确保 
\begin_inset Formula $Y,y\in\mathbb{Y}_{1,1,1}$
\end_inset

。
\end_layout

\end_inset

证明过程中，需要用到分部积分，即
\begin_inset Formula 
\begin{align*}
\left.\frac{\dd{I(Y+\alpha\eta)}}{\dd{\alpha}}\right|_{\alpha=0} & =\int_{x_{1}}^{x_{2}}\eta\left(\frac{\partial F}{\partial y}+\eta'\frac{\partial F}{\partial y'}\right)\dd{x}\\
 & ={\color{blue}\left.\left(\eta\frac{\partial F}{\partial y'}\right)\right|_{x_{1}}^{x_{2}}}+\int_{x_{1}}^{x_{2}}\eta\left(\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}\right)\dd{x}
\end{align*}

\end_inset

有限元中公式中，这个边界项不一定能丢掉（若不满足 
\begin_inset Formula $\delta y=0$
\end_inset

 或 
\begin_inset Formula $\frac{\partial F}{\partial y'}=0$
\end_inset

）。
\end_layout

\begin_layout Subsection
单方程,单变量,高阶导
\end_layout

\begin_layout Standard
实际上， 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

 很容易向高次情形推广。如果约定 
\begin_inset Formula $\dd[0]{y}/\dd{x}^{0}=y$
\end_inset

 ， 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

 可以改写为
\begin_inset Formula 
\begin{equation}
\sum_{k=0}^{n}(-1)^{k}\left(\frac{\dd[k]}{\dd{x}^{k}}\frac{\partial F}{\partial y^{(k)}}\right)=0.\label{eq:j2.10}
\end{equation}

\end_inset

当泛函中最高含有
\begin_inset Formula $n$
\end_inset

阶导数时。
\end_layout

\begin_layout Theorem
设泛函
\begin_inset Formula 
\begin{equation}
I\left[y(\cdot)\right]=\int_{x_{1}}^{x_{2}}F(x,y,y',y'',\cdots,y^{(n)})\dd{x}\label{eq:j2.11}
\end{equation}

\end_inset

其中
\begin_inset Formula $F$
\end_inset

是以
\begin_inset Formula $x,y$
\end_inset

以及
\begin_inset Formula $y$
\end_inset

各阶导数做为独立变量的已知函数，且具有
\begin_inset Formula $n$
\end_inset

阶连续偏导数，其可取函数集为
\begin_inset Formula 
\begin{equation}
\mathbb{Y}_{1,1,n}=\left\{ y(x)\left|\begin{array}{c}
y(x)\in C_{[x_{1},x_{2}]}^{(2n)}\\
y^{(k)}(x_{1})=y_{1}^{(k)},\;y^{(k)}(x_{2})=y_{2}^{(k)},\;k=0,1,\cdots,r
\end{array}\right.\right\} \label{eq:j2.12}
\end{equation}

\end_inset


\begin_inset Formula $Y(x)\in\mathbb{Y}_{1,1,n}$
\end_inset

使泛函
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

取得极小值的必要条件是：
\begin_inset Formula $Y(x)$
\end_inset

是下列微分方程的解
\begin_inset Formula 
\begin{equation}
F_{y}-\frac{\dd}{\dd{x}}F_{y'}+\frac{\dd[2]}{\dd{x}^{2}}F_{y''}+\cdots+(-1)^{n}\frac{\dd[n]}{\dd{x}^{n}}F_{y^{(n)}}=0\label{eq:j2.13}
\end{equation}

\end_inset

或者采用求和的形式记录之，则为
\begin_inset Formula 
\[
\sum_{k=0}^{n}(-1)^{k}\left(\frac{\dd[k]}{\dd{x}^{k}}\frac{\partial F}{\partial y^{(k)}}\right)=0.
\]

\end_inset

其中 
\begin_inset Formula $\frac{\partial F}{\partial y^{(k)}}=F_{y^{(k)}}$
\end_inset

，表示
\begin_inset Formula $F$
\end_inset

的偏导数，对于
\begin_inset Formula $y$
\end_inset

的
\begin_inset Formula $n$
\end_inset

阶导数
\begin_inset Formula $y^{(k)}$
\end_inset

。
\end_layout

\begin_layout Proof
定理的理解与证明。该证明的核心就在于将
\begin_inset Formula $\eta(n)$
\end_inset

转化为
\begin_inset Formula $\eta$
\end_inset

，然后用变分学基本引理进行证明。回忆一下： 
\begin_inset Formula $1$
\end_inset

阶情形的证明方式是进行
\begin_inset Formula $1$
\end_inset

次分部积分。因此，我们不难想象
\begin_inset Formula $n$
\end_inset

阶的证明也是基于
\begin_inset Formula $n$
\end_inset

次分部积分。我们不加证明（事实上，证明只需对函数进行 
\begin_inset Formula $n$
\end_inset

 次分部积分即可，十分显明）地引入 
\begin_inset Formula $n$
\end_inset

 次分部积分的
\series bold
引理
\series default
——
\begin_inset Newline newline
\end_inset

若
\begin_inset Formula $\eta^{(k)}(x_{1})=0$
\end_inset

，
\begin_inset Formula $\eta^{(k)}(x_{2})=0$
\end_inset

 ，
\begin_inset Formula $\forall k=0,1,\cdots,n-1$
\end_inset

，则
\begin_inset Formula 
\begin{equation}
\int_{x_{1}}^{x_{2}}\eta^{(n)}\frac{\partial F}{\partial y^{(n)}}\dd{x}=(-1)^{n}\int_{x_{1}}^{x_{2}}\eta\left(\frac{\dd[n]}{\dd{x}^{n}}\frac{\partial F}{\partial y^{(n)}}\right)\dd{x}\label{eq:j2.15}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
后续的证明仿照 2.9 其实就水到渠成了。
\begin_inset Formula 
\[
\left.\frac{\dd{I(Y+\alpha\eta)}}{\dd{\alpha}}\right|_{\alpha=0}=\int_{x_{1}}^{x_{2}}\left(\eta\frac{\partial F}{\partial y}+\eta'\frac{\partial F}{\partial y'}+\cdots+\eta^{(n)}\frac{\partial F}{\partial y^{(n)}}\right)\dd{x}
\]

\end_inset


\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Theorem
如果不丢掉边界项：
\begin_inset Formula 
\begin{align*}
\int_{x_{1}}^{x_{2}}\eta^{(k)}\,f\dd{x} & ={\color{blue}\left.(-1)^{0}\left(\eta^{(k-1)}f\right)\right|_{x_{1}}^{x_{2}}}+(-1)^{1}\int_{x_{1}}^{x_{2}}\eta^{(k-1)}\frac{\dd}{\dd{x}}f\dd{x}\\
 & ={\color{blue}\cdots+(-1)^{1}\left.\left(\eta^{(k-2)}\frac{\dd}{\dd{x}}f\right)\right|_{x_{1}}^{x_{2}}}+(-1)^{2}\int_{x_{1}}^{x_{2}}\eta^{(k-2)}\frac{\dd[2]}{\dd{x}^{2}}f\dd{x}\\
 & ={\color{blue}\cdots\cdots}
\end{align*}

\end_inset

前面的推导中只不过是令
\begin_inset Formula $f=\partial F/\partial y^{(k)}$
\end_inset

。容易总结出含有边界项的一般形式：
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}\eta^{(k)}f\dd{x}={\color{blue}\sum_{\ell=0}^{k-1}\left.(-1)^{\ell}\left(\eta^{(k-1-\ell)}\frac{\dd[\ell]}{\dd{x}^{\ell}}f\right)\right|_{x_{1}}^{x_{2}}}+(-1)^{k}\int_{x_{1}}^{x_{2}}\eta\left(\frac{\dd[k]}{\dd{x}^{k}}f\right)\dd{x}
\]

\end_inset

with 
\begin_inset Formula $\frac{\dd[0]}{\dd{x}^{0}}f=f$
\end_inset

。
\end_layout

\begin_layout Example
应用到上面的
\begin_inset Formula $F(x,y,y',y'',\cdots,y^{(n)})$
\end_inset

，如果不丢掉边界项，
\begin_inset Formula $\delta F=0$
\end_inset

给出的方程应该是
\begin_inset Formula 
\begin{align*}
\delta F(y,\cdots) & =F_{y}\\
 & +{\color{blue}\left.\eta^{(0)}\,F_{y'}\right|_{x_{1}}^{x_{2}}}-\dd{F_{y'}}\\
 & +{\color{blue}\left.\eta^{(1)}\,F_{y^{(2)}}\right|_{x_{1}}^{x_{2}}-\left.\eta^{(0)}\,\dd{F_{y^{(2)}}}\right|_{x_{1}}^{x_{2}}}+\dd[2]{F_{y^{(2)}}}\\
 & +{\color{blue}\left.\eta^{(2)}\,F_{y^{(3)}}\right|_{x_{1}}^{x_{2}}-\left.\eta^{(1)}\,\dd{F_{y^{(3)}}}\right|_{x_{1}}^{x_{2}}+\left.\eta^{(0)}\,\dd[2]{F_{y^{(3)}}}\right|_{x_{1}}^{x_{2}}}-\dd[3]{F_{y^{(3)}}}
\end{align*}

\end_inset

其中
\begin_inset Formula $F_{y'}=\partial F/\partial y'$
\end_inset

，
\begin_inset Formula $\dd{F_{y'}}$
\end_inset

是
\begin_inset Formula $\frac{\dd{F_{y'}}}{\dd{x}}$
\end_inset

的简写，其他类似。
\end_layout

\begin_layout Section
多方程单变量欧拉方程
\end_layout

\begin_layout Standard
在实际问题中，我们可能遇到多个独立变元一起出现的约束极值问题，例如给出两个变元
\begin_inset Formula $y_{1}(x)$
\end_inset

和
\begin_inset Formula $y_{2}(x)$
\end_inset

，并令 
\begin_inset Formula $F=y_{1}^{\prime2}+y_{2}^{\prime2}+2y_{1}y_{2}$
\end_inset

，求泛函 
\begin_inset Formula $I[y_{1}(\cdot),y_{2}(\cdot)]=\int_{x_{1}}^{x_{2}}F(x,y_{1},y_{2};y_{1}^{\prime},y_{2}^{\prime})\dd{x}$
\end_inset

 的极值。
\end_layout

\begin_layout Subsection
两方程单变量一阶导
\end_layout

\begin_layout Standard
先考虑两方程情形，令 
\begin_inset Formula $y=Y_{k}+\alpha\eta_{k}$
\end_inset

，
\begin_inset Formula $k=1,2$
\end_inset

，并令
\begin_inset Formula 
\begin{align*}
\Phi(\alpha) & =I[y_{1}(\cdot),y_{2}(\cdot)]\\
 & =\int_{x_{1}}^{x_{2}}F(x,Y_{1}+\alpha\eta_{1},y_{2}+\alpha\eta_{2};Y_{1}^{\prime}+\alpha\eta_{1}^{\prime},Y_{2}^{\prime}+\alpha\eta_{2}^{\prime})\dd{x}
\end{align*}

\end_inset

则函数组
\begin_inset Formula $Y_{k}$
\end_inset

使得泛函取得极值的必要条件为
\begin_inset Formula $\Phi'(0)=0$
\end_inset

，即
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}\left(\eta_{1}\frac{\partial F}{\partial y_{1}}+\eta_{1}^{\prime}\frac{\partial F}{\partial y_{1}^{\prime}}\right)\dd{x}+\int_{x_{1}}^{x_{2}}\left(\eta_{2}\frac{\partial F}{\partial y_{2}}+\eta_{2}^{\prime}\frac{\partial F}{\partial y_{2}^{\prime}}\right)\dd{x}=0.
\]

\end_inset

应用分部积分引理
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.15"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}\eta_{1}\left(\frac{\partial F}{\partial y_{1}}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y_{1}^{\prime}}\right)\dd{x}+\int_{x_{1}}^{x_{2}}\eta_{2}\left(\frac{\partial F}{\partial y_{2}}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y_{2}^{\prime}}\right)\dd{x}=0.
\]

\end_inset

根据变分学基本引理
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

，以及
\begin_inset Formula $\eta_{1}$
\end_inset

，
\begin_inset Formula $\eta_{2}$
\end_inset

的任意性，自然得到：
\begin_inset Formula 
\begin{equation}
\begin{cases}
\frac{\partial F}{\partial y_{1}}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y_{1}^{\prime}}=0\\
\frac{\partial F}{\partial y_{2}}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y_{2}^{\prime}}=0
\end{cases}\label{eq:j3.4}
\end{equation}

\end_inset

也就是说，对于两方程情形，对应泛函取到极值的必要条件为上式。
\end_layout

\begin_layout Subsection
多方程单变量高阶导
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{cases}
\sum_{n=0}^{N_{1}}(-1)^{n}\frac{\dd[n]}{\dd{x}^{n}}\frac{\partial F}{\partial y_{1}^{(n)}}=0\\
\sum_{n=0}^{N_{2}}(-1)^{n}\frac{\dd[n]}{\dd{x}^{n}}\frac{\partial F}{\partial y_{2}^{(n)}}=0\\
\vdots\\
\sum_{n=0}^{N_{M}}(-1)^{n}\frac{\dd[n]}{\dd{x}^{n}}\frac{\partial F}{\partial y_{M}^{(n)}}=0
\end{cases}\label{eq:3.8}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
多方程多变量的欧拉方程
\end_layout

\begin_layout Standard
通常来说，因为我们现实世界是三维的，所以我们会遇到多变量的函数。例如电场强度函数可能就是一个三维 
\begin_inset Formula $(x,y,z)$
\end_inset

函数，也就是三变量的函数。对于它的极值问题，我们依然可以类似地方法进行求解。
\end_layout

\begin_layout Subsection
分部积分向高维的推广
\end_layout

\begin_layout Standard
我们将
\begin_inset Formula $\eta'$
\end_inset

转换为
\begin_inset Formula $\eta$
\end_inset

中用到了一个重要的公式——分部积分公式。而分部积分公式基于
\begin_inset Quotes erd
\end_inset

牛顿莱布尼茨公式
\begin_inset Quotes erd
\end_inset

。
\series bold
而接下来我们要处理的函数，将是多变量的函数，此时我们就需要一个
\begin_inset Quotes erd
\end_inset

高维的牛顿莱布尼茨公式
\begin_inset Quotes erd
\end_inset


\series default
。幸运的是，我们高数学的
\begin_inset Quotes erd
\end_inset

格林公式
\begin_inset Quotes erd
\end_inset

和 
\begin_inset Quotes erd
\end_inset

高斯公式
\begin_inset Quotes erd
\end_inset

正是
\begin_inset Quotes erd
\end_inset

牛顿莱布尼茨公式
\begin_inset Quotes erd
\end_inset

向高维的推广，它们的推广被称为
\begin_inset Quotes erd
\end_inset

广义斯托克斯公式
\begin_inset Quotes erd
\end_inset

。如果有对“广义斯托克斯公式”感兴趣的同学，可以看文章
\begin_inset CommandInset href
LatexCommand href
name "广义斯托克斯公式-MamiyaHasaki的博客"
target "https://blog.csdn.net/MamiyaHasaki/article/details/119297305"
literal "false"

\end_inset

。
\end_layout

\begin_layout Example
二维：假设函数
\begin_inset Formula $\eta(x,y)$
\end_inset

定义在区域 
\begin_inset Formula $D$
\end_inset

上，区域 
\begin_inset Formula $D$
\end_inset

的边界 
\begin_inset Formula $\partial D=L$
\end_inset

，并满足边界条件：
\begin_inset Formula $\left.\eta\right|_{L}=0$
\end_inset

。高数讲的格林公式是：
\begin_inset Formula 
\begin{equation}
\int_{D}\left(\frac{\partial Q}{\partial x}-\frac{\partial P}{\partial y}\right)\dd{x}\dd{y}=\oint_{L}P\dd{x}+Q\dd{y}\label{eq:j4.1}
\end{equation}

\end_inset

将
\begin_inset Formula $Q=\eta\cdot f$
\end_inset

，
\begin_inset Formula $P=0$
\end_inset

代入，考虑到
\begin_inset Formula ${\color{blue}\left.\eta\right|_{L}=0}$
\end_inset

，得
\begin_inset Formula 
\begin{align}
 & \int_{D}\frac{\partial(\eta\cdot f)}{\partial x}\dd{x}\dd{y}={\color{blue}\oint_{L}\eta}(f\dd{y})=0\label{eq:j4.2}\\
\Rightarrow & \int_{D}(\frac{\partial\eta}{\partial x})f\cdot\dd{x}\dd{y}=-\int_{D}\eta(\frac{\partial f}{\partial x})\cdot\dd{x}\dd{y}\label{eq:j4.3}
\end{align}

\end_inset

如果我们假设
\begin_inset Formula $\left.\eta\right|_{L}$
\end_inset

 满足 
\begin_inset Formula $n−1$
\end_inset

 阶导的边界条件，即 
\begin_inset Formula $\left.\eta\right|_{L}=0$
\end_inset

，
\begin_inset Formula $\left.\frac{\partial\eta}{\partial x}\right|_{L}=0$
\end_inset

，
\begin_inset Formula $\cdots$
\end_inset

，
\begin_inset Formula $\left.\frac{\partial^{n-1}\eta}{\partial x^{n-1}}\right|_{L}=0$
\end_inset

，那么就可以得到二维的 
\begin_inset Formula $n$
\end_inset

 次分部积分公式
\begin_inset Formula 
\begin{equation}
\int_{D}\left(\frac{\partial^{n}\eta}{\partial x^{n}}\right)f\cdot\dd{x}\dd{y}=(-1)^{n}\int_{D}\eta\left(\frac{\partial^{n}f}{\partial x^{n}}\right)\cdot\dd{x}\dd{y}.\label{eq:j4.4}
\end{equation}

\end_inset

同理，令 
\begin_inset Formula $P=-\eta\cdot f$
\end_inset

，
\begin_inset Formula $Q=0$
\end_inset

代入
\begin_inset Formula 
\begin{equation}
\int_{D}\left(\frac{\partial^{n}\eta}{\partial y^{n}}\right)f\cdot\dd{x}\dd{y}=(-1)^{n}\int_{D}\eta\left(\frac{\partial^{n}f}{\partial y^{n}}\right)\cdot\dd{x}\dd{y}.\label{eq:j4.5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
三维情形也是同理，我们采用 
\series bold
高斯公式
\series default
：
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\left(\frac{\partial P}{\partial x}+\frac{\partial Q}{\partial y}+\frac{\partial R}{\partial z}\right)\dd{V}=\oint_{\partial\Omega}\left(P\cos\alpha+Q\cos\beta+R\cos\gamma\right)\dd{S}\label{eq:j4.6}
\end{equation}

\end_inset

其中
\begin_inset Formula $\alpha$
\end_inset

，
\begin_inset Formula $\beta$
\end_inset

，
\begin_inset Formula $\gamma$
\end_inset

 是曲线法向与笛卡尔系的
\begin_inset Formula $\sbf e_{x}$
\end_inset

，
\begin_inset Formula $\sbf e_{y}$
\end_inset

，
\begin_inset Formula $\sbf e_{z}$
\end_inset

所成的夹角。考虑区域
\begin_inset Formula $\Omega$
\end_inset

上的边界条件为
\begin_inset Formula $\left.\eta\right|_{\partial\Omega}=0$
\end_inset

，代入
\begin_inset Formula $P=\eta\cdot f$
\end_inset

，
\begin_inset Formula $Q=0$
\end_inset

，
\begin_inset Formula $R=0$
\end_inset

，等式右端为
\begin_inset Formula $0$
\end_inset

：
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\frac{\partial(\eta\cdot f)}{\partial x}\dd{V}=0\label{eq:j4.7}
\end{equation}

\end_inset

进行分部积分得到：
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\left(\frac{\partial\eta}{\partial x}\right)f\dd{V}=-\int_{\Omega}\eta\left(\frac{\partial f}{\partial x}\right)\dd{V}.\label{eq:j4.8}
\end{equation}

\end_inset

仿照格林公式的方式，可以推广到每个维度的 
\begin_inset Formula $n$
\end_inset

阶导数
\begin_inset Formula 
\[
\int_{\Omega}\left(\frac{\partial^{n}\eta}{\partial x^{n}}\right)f\cdot\dd{V}=(-1)^{n}\int_{\Omega}\eta\left(\frac{\partial^{n}f}{\partial x^{n}}\right)\cdot\dd{V}
\]

\end_inset


\end_layout

\begin_layout Subsection
三维问题的边界项
\end_layout

\begin_layout Example
矢量场 
\begin_inset Formula $\varphi\,\sbf f$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\int_{\Omega}\nabla\cdot\left(\varphi\,\sbf f\right)\dd{V}=\oint_{\partial\Omega}(\varphi\,\sbf f)\dd{\sbf S}
\]

\end_inset

即
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega}\left[(\nabla\varphi)\cdot\sbf f+\varphi\nabla\cdot\sbf f\right]\dd{V}=\oint_{\partial\Omega}(\varphi\,\sbf f)\dd{\sbf S}\\
\Rightarrow & \int_{\Omega}\left(\varphi\nabla\cdot\sbf f\right)\dd{V}=-\int_{\Omega}\left[(\nabla\varphi)\cdot\sbf f\right]\dd{V}+\oint_{\partial\Omega}(\varphi\,\sbf f)\dd{\sbf S}
\end{align*}

\end_inset


\end_layout

\begin_layout Example
标量场 
\begin_inset Formula $\varphi\,\psi$
\end_inset


\begin_inset Formula 
\[
\int_{\Omega}\nabla\cdot\nabla\left(\varphi\,\psi\right)\dd{V}=\oint_{\partial\Omega}\nabla\left(\varphi\,\psi\right)\dd{\sbf S}
\]

\end_inset

即
\begin_inset Formula 
\[
\int_{\Omega}\left[\nabla\cdot\left(\varphi\nabla\psi+\psi\nabla\varphi\right)\right]\dd{V}=\int_{\Omega}\left[\varphi\nabla^{2}\psi+\psi\nabla^{2}\varphi+2(\nabla\psi\cdot\nabla\varphi)\right]\dd{V}
\]

\end_inset

如果
\begin_inset Formula $\psi=\varphi=\phi$
\end_inset

，给出
\begin_inset Formula 
\[
\int_{\Omega}\phi\nabla^{2}\phi\dd{V}=\oint_{\partial\Omega}\phi\nabla\phi\dd{\sbf S}-\int_{\Omega}\nabla\phi\cdot\nabla\phi\dd{V}
\]

\end_inset


\end_layout

\begin_layout Chapter
电磁场基础理论
\end_layout

\begin_layout Section
电磁场单位
\end_layout

\begin_layout Enumerate
质量（Kilogram）：
\begin_inset Formula $\mathrm{Kg}$
\end_inset


\end_layout

\begin_layout Enumerate
长度（meter）：
\begin_inset Formula $\mathrm{m}$
\end_inset


\end_layout

\begin_layout Enumerate
时间（time）：
\begin_inset Formula $\mathrm{s}$
\end_inset


\end_layout

\begin_layout Enumerate
力（Newton）：
\begin_inset Formula $\mathrm{N}=\mathrm{Kg}\cdot\mathrm{m}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
力矩（Torque）:
\begin_inset Formula $\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{2}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
电流（I），安培（ampere）：
\begin_inset Formula $\mathrm{A}$
\end_inset


\end_layout

\begin_layout Enumerate
电流密度（J），
\begin_inset Formula $\mathrm{A}\cdot\mathrm{m}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
库仑（Coulomb）：
\begin_inset Formula $\mathrm{C}=\mathrm{A}\cdot\mathrm{s}$
\end_inset


\end_layout

\begin_layout Enumerate
能量（Joule）：
\begin_inset Formula $\mathrm{J}=\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{2}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
能量密度，共能密度，：
\begin_inset Formula $\mathrm{J}\cdot\mathrm{m}^{-3}=\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{-1}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
功率密度（Power Density）：
\begin_inset Formula $\mathrm{J}\cdot\mathrm{m}^{-3}\cdot\mathrm{s}^{-1}$
\end_inset


\end_layout

\begin_layout Enumerate
电压，电势（Volt）：
\begin_inset Formula $\mathrm{V}=\mathrm{J}\cdot\mathrm{s}^{-1}\cdot\mathrm{A}^{-1}=\mathrm{Kg}\cdot\mathrm{m}^{2}\cdot\mathrm{s}^{-3}\cdot\mathrm{A}^{-1}$
\end_inset


\end_layout

\begin_layout Enumerate
电容（法拉）：
\begin_inset Formula $\mathrm{F}=\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{V}^{-1}=\mathrm{Kg}^{-1}\cdot\mathrm{m}^{-2}\cdot\mathrm{s}^{4}\cdot\mathrm{A}^{2}$
\end_inset


\end_layout

\begin_layout Enumerate
电场强度（
\begin_inset Formula $E$
\end_inset

）：
\begin_inset Formula $\mathrm{V}\cdot\mathrm{m}^{-1}=\mathrm{Kg}\cdot\mathrm{m}\cdot\mathrm{s}^{-3}\cdot\mathrm{A}^{-1}$
\end_inset


\end_layout

\begin_layout Enumerate
电位移（
\begin_inset Formula $D$
\end_inset

）：
\begin_inset Formula $\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{m}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
介电常数
\begin_inset Formula $\epsilon_{0}$
\end_inset

：
\begin_inset Formula $\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{V}^{-1}\cdot\mathrm{m}^{-1}=\mathrm{A}^{2}\cdot\mathrm{s}^{4}\cdot\mathrm{m}^{-3}\cdot\mathrm{Kg}^{-1}$
\end_inset


\end_layout

\begin_layout Enumerate
电导（
\begin_inset Formula $G=1/R$
\end_inset

）：
\begin_inset Formula $\mathrm{S}=\mathrm{A}/\mathrm{V}=\mathrm{s}^{3}\cdot\mathrm{A}^{2}\cdot\mathrm{Kg}^{-1}\cdot\mathrm{m}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
电导率（
\begin_inset Formula $\sigma$
\end_inset

）：
\begin_inset Formula $\mathrm{S}/\mathrm{m}=\mathrm{s}^{3}\cdot\mathrm{A}^{2}\cdot\mathrm{Kg}^{-1}\cdot\mathrm{m}^{-3}$
\end_inset

，或 
\begin_inset Formula $\mathrm{A\cdot V^{-1}\cdot m^{-1}}$
\end_inset

。
\end_layout

\begin_layout Enumerate
通用气体常数 
\begin_inset Formula $R=8.314472\,\mathrm{J\cdot mol^{-1}\cdot K^{-1}}$
\end_inset

；
\begin_inset Formula $\mathrm{Kg\cdot m^{2}\cdot s^{-2}\cdot mol^{-1}\cdot K^{-1}}$
\end_inset


\end_layout

\begin_layout Enumerate
法拉第常数，
\begin_inset Formula $F=96485\,\mathrm{C\cdot mol^{-1}}$
\end_inset

；
\begin_inset Formula $\mathrm{A\cdot s\cdot mol^{-1}}$
\end_inset

，表示每摩尔电子携带的电荷。
\end_layout

\begin_layout Standard
介电常数
\begin_inset Formula $\varepsilon_{0}=8.8541\,8781\,7620\,3898\,51×10^{-12}\,\mathrm{F/m}$
\end_inset

：
\begin_inset Formula $\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{m}^{-1}\cdot\mathrm{V}^{-1}=\mathrm{A}^{2}\cdot\mathrm{s}^{4}\cdot\mathrm{m}^{-3}\cdot\mathrm{Kg}^{-1}$
\end_inset


\begin_inset Formula 
\[
\varepsilon=\varepsilon_{0}{\color{blue}\varepsilon_{r}}
\]

\end_inset


\end_layout

\begin_layout Section
电磁场的矢势和标势
\end_layout

\begin_layout Standard
简单起见，真空中的麦克斯韦方程组为
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf E=-\frac{\partial\sbf B}{\partial t}\\
 & \nabla\times H=\frac{\partial\sbf D}{\partial t}+\sbf J\\
 & \nabla\cdot\sbf D=\rho\\
 & \nabla\cdot\sbf B=0
\end{align*}

\end_inset

电荷守恒方程
\begin_inset Formula 
\[
-\sbf\nabla\cdot J=\frac{\partial\rho}{\partial t}
\]

\end_inset

引入电磁势
\begin_inset Formula 
\begin{align}
\sbf E & =-\nabla\varphi-\frac{\partial\sbf A}{\partial t}\label{eq:g5.1.3}\\
\sbf B & =\nabla\times\sbf A\label{eq:g5.1.2}
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g5.1.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g5.1.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

把电磁场用矢势和标势表示出来。现在电场
\begin_inset Formula $\sbf E$
\end_inset

不再是保守立场，一般不存在势能的概念，标势
\begin_inset Formula $\varphi$
\end_inset

失去作为电场中势能的意义。因此，在高频系统中，电压的概念也是去确切的意义。在变化场中，磁场和电场是相互作用着的整体，必须把矢势和标势作为一个整体来描述电磁场。
\end_layout

\begin_layout Subsection
规范变换和规范不变性
\end_layout

\begin_layout Standard
用矢势和标势
\begin_inset Formula $\varphi$
\end_inset

描述电磁场不是唯一的，即给定的
\begin_inset Formula $\sbf E$
\end_inset

和
\begin_inset Formula $\sbf B$
\end_inset

并不对应唯一的
\begin_inset Formula $\sbf A$
\end_inset

和
\begin_inset Formula $\varphi$
\end_inset

。假设
\begin_inset Formula $\psi$
\end_inset

为是时空的任意函数，做变换
\begin_inset Formula 
\begin{align}
 & \sbf A\to\sbf A'=\sbf A+\nabla\psi\nonumber \\
 & \varphi\to\varphi'=\varphi-\frac{\partial\psi}{\partial t}\label{eq:g5.1.4}
\end{align}

\end_inset

则
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf A'=\nabla\times\sbf A=\sbf B\\
 & -\nabla\varphi'-\frac{\partial\sbf A'}{\partial t}=-\nabla\varphi-\frac{\partial\sbf A}{\partial t}=\sbf E
\end{align*}

\end_inset

 即 
\begin_inset Formula $(\sbf A',\varphi')$
\end_inset

与
\begin_inset Formula $(\sbf A,\varphi)$
\end_inset

描述同一电磁场。变换
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g5.1.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

称为势的规范变换。每一组
\begin_inset Formula $(\sbf A,\varphi)$
\end_inset

称为一种规范。
\end_layout

\begin_layout Standard
库仑规范
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sbf A=0\label{eq:g5.1.5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
洛伦兹规范
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sbf A+\frac{1}{c^{2}}\frac{\partial\varphi}{\partial t}=0.\label{eq:g5.1.6}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
介质交界面的边界条件
\end_layout

\begin_layout Standard
麦克斯韦方程组可以应用于任何连续介质内部。在两介质分界面上，由于一般出现面电荷电流分布，使物理量发生跃变，微分形式的麦克斯韦方程组不再适用。
\end_layout

\begin_layout Standard
在电场作用下，介质界面上一般出现面束缚电流和电流分布。这些电荷电流的存在又使得界面两侧常量发生跃变。研究边值关系的基础是积分形式的麦克斯韦方程组，下面分别求出场
量的法向分量和切向分量的跃变。麦克斯韦方程组的积分形式为
\begin_inset Formula 
\begin{align}
 & \oint_{L}\sbf E\cdot\dd{\sbf\ell}=-\frac{\dd}{\dd{t}}\int_{S}\sbf B\cdot\dd{\sbf S}\nonumber \\
 & \oint_{L}\sbf H\cdot\dd{\sbf\ell}=I_{f}+\frac{\dd}{\dd{t}}\int_{S}\sbf D\cdot\dd{\sbf S}\nonumber \\
 & \oint_{S}\sbf D\cdot\dd{\sbf S}=Q_{f}\label{eq:5.1}\\
 & \oint_{S}\sbf B\cdot\dd{\sbf S}=0\nonumber 
\end{align}

\end_inset

式中 
\begin_inset Formula $I_{f}$
\end_inset

 为通过曲面
\begin_inset Formula $S$
\end_inset

的总自由电流，
\begin_inset Formula $Q_{f}$
\end_inset

为闭合曲面内总自由电荷。对应的微分形式是
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf E=-\frac{\partial\sbf B}{\partial t}\\
 & \nabla\times\sbf H=\sbf j_{f}+\frac{\partial\sbf D}{\partial t}\\
 & \nabla\cdot\sbf D=\rho_{f}\\
 & \nabla\cdot\sbf B=0
\end{align*}

\end_inset

把这组方程应用到界面上可以得到两侧场量的关系。
\end_layout

\begin_layout Section
法向分量的跃变
\end_layout

\begin_layout Standard
电位移矢量 
\begin_inset Formula $\sbf D_{n}$
\end_inset

 的跃变取决于自由电荷面密度 
\begin_inset Formula $\sigma_{f}$
\end_inset

：
\begin_inset Formula 
\[
\sbf e_{1}\cdot\sbf D_{1}+\sbf e_{2}\cdot\sbf D_{2}=\sigma_{f}
\]

\end_inset


\begin_inset Formula $\sbf e_{1}$
\end_inset

 和 
\begin_inset Formula $\sbf e_{2}$
\end_inset

 分别是界面两侧的法向量（从界面指向介质内部）。考虑到 
\begin_inset Formula $\sbf e_{2}=-\sbf e_{1}$
\end_inset

，可以统一成
\begin_inset Formula 
\begin{equation}
\sbf e_{2}\cdot\left(\sbf D_{2}-\sbf D_{1}\right)=\sigma_{f}\label{eq:5.5}
\end{equation}

\end_inset

其中
\begin_inset Formula $\sbf e_{2}$
\end_inset

从介质
\begin_inset Formula $1$
\end_inset

指向介质
\begin_inset Formula $2$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename inset/GuoShuoHong-1.12.png
	lyxscale 70
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
法向分量的跃变
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
类似地可以得到：
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\sbf e_{2}\cdot\left(\sbf E_{2}-\sbf E_{1}\right)=\sigma_{f}+\sigma_{P}\\
 & \sbf e_{2}\cdot\left(\sbf P_{2}-\sbf P_{1}\right)=-\sigma_{P}
\end{align*}

\end_inset

即 
\begin_inset Formula $E_{n}$
\end_inset

 的跃变与总电荷面密度相关。
\end_layout

\begin_layout Section
切向分量的跃变
\end_layout

\begin_layout Standard
面电流分布使界面两侧磁场的切向分量发生跃变。沿轴向均匀磁化的铁棒，其内部分子磁矩的示意图如下。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/GuoShuoHong-1.13.png
	lyxscale 90
	scale 70

\end_inset


\begin_inset Newline newline
\end_inset

在铁棒内部，分子电流互相抵消，但在靠近棒侧面上的分子电流则构成宏观的磁化电流面分布。面电流实际上是在靠近表面的相当多分子层内的平均宏观效应。设理想薄层的厚度趋于
零，则通过电流的横截面变为横截线。定义电流线密度 
\begin_inset Formula $\sbf\alpha$
\end_inset

，其大小等于垂直通过单位横截线的电流，其线密度为 
\begin_inset Formula $\sbf\alpha$
\end_inset

，
\begin_inset Formula $\Delta\ell$
\end_inset

为横截线。垂直流过 
\begin_inset Formula $\Delta\ell$
\end_inset

 段的电流为
\begin_inset Formula 
\begin{equation}
\Delta I=\alpha\Delta\ell\label{eq:g5.7}
\end{equation}

\end_inset

面电流的对应量纲实际上是 
\begin_inset Formula $[L]$
\end_inset

，
\begin_inset Formula 
\[
[\text{面电流}]=\frac{[\text{电流}]}{[\text{长度}]},\quad[\text{面电荷}]=\frac{[\text{电荷}]}{[\text{面积}]}
\]

\end_inset


\end_layout

\begin_layout Standard
将 
\begin_inset Formula $\oint_{L}\sbf H\cdot\dd{\sbf\ell}=(H_{2t}-H_{1t})\Delta\ell$
\end_inset

应用到图 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:g1.14-15"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的积分回路上得到
\begin_inset Formula 
\begin{align}
 & \sbf e_{1}\times\sbf H_{1}+\sbf e_{2}\times\sbf H_{2}=\sbf\alpha_{f}\nonumber \\
\Rightarrow\quad & \sbf e_{2}\times\left(\sbf H_{2}-\sbf H_{1}\right)=\sbf\alpha_{f}\label{eq:g5.9}
\end{align}

\end_inset

此即 磁场切向分量的边值关系。类似可得电场分量的边值关系：
\begin_inset Formula 
\begin{equation}
\sbf e_{n}\times\left(\sbf E_{2}-\sbf E_{1}\right)=0\label{eq:g5.10}
\end{equation}

\end_inset

此式表示界面两侧 
\begin_inset Formula $\sbf E$
\end_inset

 的切向分量连续。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename inset/GuoShuoHong-1.14-15.png
	lyxscale 60
	scale 60

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
面电流的积分回路 1.14-1.15 
\begin_inset CommandInset label
LatexCommand label
name "fig:g1.14-15"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
省略自由电荷密度和自由电流线密度，不再写出下角标
\begin_inset Formula $f$
\end_inset

。总括我们得到的边值关系为
\begin_inset Formula 
\begin{align}
 & \sbf e_{2}\times\left(\sbf E_{2}-\sbf E_{1}\right)=0\nonumber \\
 & \sbf e_{2}\times\left(\sbf H_{2}-\sbf H_{1}\right)=\sbf\alpha\label{eq:g5.11}\\
 & \sbf e_{2}\cdot\left(\sbf D_{2}-\sbf D_{1}\right)=\sigma\nonumber \\
 & \sbf e_{2}\cdot\left(\sbf B_{2}-\sbf B_{1}\right)=0\nonumber 
\end{align}

\end_inset

其中 
\begin_inset Formula $\sbf e_{2}$
\end_inset

是从界面指向介质
\begin_inset Formula $2$
\end_inset

 内部的法向单位矢量，或等价地，从介质
\begin_inset Formula $1$
\end_inset

指向介质
\begin_inset Formula $2$
\end_inset

。 
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Enumerate
散度：包围界面的无限扁闭曲面
\begin_inset Formula $S$
\end_inset

，考虑法向通量；因此
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g5.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的法向是
\begin_inset Formula $S$
\end_inset

的外法向，
\begin_inset Formula $D_{2n}=\sbf e_{2}\cdot\sbf D_{2}$
\end_inset

，
\begin_inset Formula $D_{1}=-\sbf e_{2}\cdot\sbf D_{1}$
\end_inset

。
\end_layout

\begin_layout Enumerate
旋度：穿过界面的无限扁回路
\begin_inset Formula $L$
\end_inset

，考虑切向积分；因此
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g5.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

中 
\begin_inset Formula $H_{2t}=\sbf e_{2}\times\sbf H_{2}$
\end_inset

，
\begin_inset Formula $H_{1t}=-\sbf e_{1}\times\sbf H_{2}$
\end_inset

；即
\begin_inset Formula $(\sbf e,\sbf H,\sbf\alpha)$
\end_inset

 成右手螺旋。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
边值关系表示界面两侧的场与界面上电荷电流的制约关系。对于不包含自由面电荷，面电流的系统：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf E$
\end_inset

，
\begin_inset Formula $\sbf H$
\end_inset

 切向连续；
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf B$
\end_inset

，
\begin_inset Formula $\sbf D$
\end_inset

 法向连续。
\end_layout

\begin_layout Subsection
电场线平行，垂直
\end_layout

\begin_layout Standard
电场线垂直，例如在边界
\begin_inset Formula $\Gamma_{1}$
\end_inset

上 
\begin_inset Formula $\sbf E_{t}=0$
\end_inset

，即
\begin_inset Formula 
\[
\sbf e_{t}\cdot\nabla\phi=0\quad\Rightarrow\quad\sbf e_{n}\times\nabla\Phi=0
\]

\end_inset

所以边界
\begin_inset Formula $\Gamma_{1}$
\end_inset

为等势面，电势为常数。相当于第一类（狄利赫雷）边界条件。
\end_layout

\begin_layout Standard
电场线平行， 例如在边界 
\begin_inset Formula $\Gamma_{2}$
\end_inset

上 
\begin_inset Formula $\sbf E_{n}=0$
\end_inset

，即
\begin_inset Formula 
\[
\sbf e_{n}\cdot\nabla\phi=0
\]

\end_inset

对应第二类（诺伊曼）边界条件，如果泛函中没有非齐次项，是自动满足的，被称为自然边界条件（Natural Boundary condition）。
\end_layout

\begin_layout Section
势函数的边界条件
\end_layout

\begin_layout Standard
转换成用静电势
\begin_inset Formula $\varphi$
\end_inset

，静磁势
\begin_inset Formula $\sbf A$
\end_inset

表示，边值关系表示为
\begin_inset Formula 
\begin{align}
\varphi_{1}=\varphi_{2}\quad\Leftrightarrow\quad\sbf e_{n}\times(\sbf E_{2}-\sbf E_{1})=0\label{eq:g2.1.11}
\end{align}

\end_inset


\begin_inset Formula 
\begin{equation}
\varepsilon_{2}\frac{\partial\varphi_{2}}{\partial n}-\varepsilon_{1}\frac{\partial\varphi_{1}}{\partial n}=-\sigma\label{eq:g2.1.12}
\end{equation}

\end_inset

其中
\begin_inset Formula $\partial/\partial n$
\end_inset

 是法线方向的偏导数，
\begin_inset Formula $\sigma$
\end_inset

为界面上的自由电荷面密度。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g2.1.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g2.1.12"
plural "false"
caps "false"
noprefix "false"

\end_inset

式是在界面上静电势所满足的边值关系。
\end_layout

\begin_layout Standard
导体的静电条件归结如下：
\end_layout

\begin_layout Enumerate
导体内部不带静电荷，电荷只能分布于导体表面上；
\end_layout

\begin_layout Enumerate
导体内部电场为零；
\end_layout

\begin_layout Enumerate
导体表面上电场必沿法线方向，因此导体表面为等势体。整个导体的电势相等。
\end_layout

\begin_layout Standard
设导体表面所带自由电荷面密度为
\begin_inset Formula $\sigma$
\end_inset

，设它外面的介质电容率为
\begin_inset Formula $\varepsilon$
\end_inset

，由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g2.1.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g2.1.12"
plural "false"
caps "false"
noprefix "false"

\end_inset

式和导体静电条件得导体表面的边界条件
\begin_inset Formula 
\begin{align}
 & \varphi=\text{常量}\label{eq:g2.1.11a}\\
 & \varepsilon\frac{\partial\varphi}{\partial n}=-\sigma\label{eq:g2.1.12a}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
矢势边值关系：对于非铁磁性均匀介质，矢势的边值关系为
\begin_inset Formula 
\begin{align}
 & \sbf e_{n}\cdot\left(\nabla\times\sbf A_{2}-\nabla\times\sbf A_{1}\right)=0\label{eq:g3.1.14}\\
 & \sbf e_{n}\times\left(\frac{1}{\mu_{2}}\nabla\times\sbf A_{2}-\frac{1}{\mu_{1}}\nabla\times\sbf A_{1}\right)=\sbf\alpha\label{eq:g3.1.15}\\
\text{i.e.}\; & \sbf e_{n}\times(\sbf H_{2}-\sbf H_{1})=\sbf\alpha
\end{align}

\end_inset

其中
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.14"
plural "false"
caps "false"
noprefix "false"

\end_inset

等价于
\begin_inset Formula 
\[
A_{2t}=A_{1t},
\]

\end_inset

而
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

规范给出
\begin_inset Formula $A_{2n}=A_{1n}$
\end_inset

，综合起来给出
\begin_inset Formula 
\begin{equation}
\sbf A_{2}=\sbf A_{2}\label{eq:g3.1.18}
\end{equation}

\end_inset

也就是矢势
\begin_inset Formula $\sbf A$
\end_inset

在两介质分界面上连续。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以用来代替
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.14"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Remark
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.15"
plural "false"
caps "false"
noprefix "false"

\end_inset

的物理含义是，面电流
\begin_inset Formula $\sbf\alpha$
\end_inset

是沿着表面切向
\begin_inset Formula $\sbf\tau$
\end_inset

的，根据安培环路定律
\begin_inset Formula $\nabla\times\sbf B=\mu_{0}\sbf J$
\end_inset

，产生的磁场的轴（旋度）是沿着
\begin_inset Formula $\sbf\tau$
\end_inset

的。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.14"
plural "false"
caps "false"
noprefix "false"

\end_inset


\end_layout

\begin_layout Section
有限元的自然边界条件
\end_layout

\begin_layout Subsection
自然边界条件–磁力线垂直
\end_layout

\begin_layout Standard
磁矢势的泛函积分，给出在边界
\begin_inset Formula $\Gamma$
\end_inset

上
\begin_inset Formula $\sbf A$
\end_inset

的自然边界条件：
\begin_inset Formula 
\[
\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=0
\]

\end_inset

对应磁场切向分量为零，所以是
\series bold
磁力线垂直
\series default
。
\end_layout

\begin_layout Subsection
Dirichlet边界–磁力线平行
\end_layout

\begin_layout Standard
IBE中的“磁力线平行”表示边界 
\begin_inset Formula $\Gamma_{D}$
\end_inset

 满足Dirichlet 边界条件。在 Edge–单元中，磁矢势表示为
\begin_inset Formula 
\[
\sbf A=\sum_{\alpha}A_{\alpha}\,\sbf N_{\alpha},
\]

\end_inset


\end_layout

\begin_layout Standard
若给定在 
\begin_inset Formula $\Gamma_{D}$
\end_inset

上
\begin_inset Formula $\sbf A=0$
\end_inset

，对于其它不在
\begin_inset Formula $\Gamma_{D}$
\end_inset

上的边
\begin_inset Formula $\beta$
\end_inset

（内边），对应的矢量形函数
\begin_inset Formula $\sbf N_{\beta}$
\end_inset

 在
\begin_inset Formula $\Gamma_{D}$
\end_inset

上只有法向分量，只对
\begin_inset Formula $\sbf A$
\end_inset

 贡献法向分量；更准确地说，考虑到 
\begin_inset Formula $\sbf N$
\end_inset

 在柱坐标下的表达式，
\begin_inset Formula 
\[
\sbf N=\frac{r}{h}\sbf e_{\phi}
\]

\end_inset

参考柱坐标下的 curl 算符
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gI.36"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\nabla\times\sbf f=\left(\frac{1}{r}\partial_{\phi}f_{z}-\partial_{z}f_{\phi}\right)\sbf e_{r}+\left(\partial_{z}f_{r}-\partial_{r}f_{z}\right)\sbf e_{\phi}+\frac{1}{r}\left[\partial_{r}(rf_{\phi})-\partial_{\phi}f_{r}\right]\sbf e_{z}
\]

\end_inset

因此
\begin_inset Formula $\sbf N^{e}$
\end_inset

只有
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\sbf e_{z}$
\end_inset

不为零，
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
\nabla\times\sbf N=\frac{1}{r}\partial_{r}\left(r\frac{r}{h}\right)=\frac{2}{h}\sbf e_{z}
\]

\end_inset

对应到有限元模型中，
\begin_inset Formula $\sbf e_{z}$
\end_inset

沿着边界切向；因此
\begin_inset Formula $\nabla\times\sbf B$
\end_inset

只有切向分量，即
\series bold
磁力线平行
\series default
。
\end_layout

\begin_layout Itemize
在一般曲线正交坐标系中，设单位基矢为
\begin_inset Formula $\{\sbf e_{1},\sbf e_{2},\sbf e_{3}\}$
\end_inset

，如果
\begin_inset Formula $\sbf f$
\end_inset

 只有
\begin_inset Formula $\sbf e_{3}$
\end_inset

分量，则
\begin_inset Formula $\nabla\times\sbf f$
\end_inset

的结果一定只有
\begin_inset Formula $\{\sbf e_{1},\sbf e_{2}\}$
\end_inset

分量，即在局部上，
\begin_inset Formula $(\nabla\times\sbf f)\perp\sbf f$
\end_inset

。
\end_layout

\begin_layout Itemize
若给定在
\begin_inset Formula $\Gamma_{D}$
\end_inset

上
\begin_inset Formula $\sbf A\neq0$
\end_inset

，则 
\begin_inset Formula $\Gamma_{D}$
\end_inset

上的边的形函数 
\begin_inset Formula $\sbf N_{\alpha}$
\end_inset

也有贡献，则最终磁力线不一定平行。
\end_layout

\begin_layout Chapter
单元上的形函数
\end_layout

\begin_layout Standard
单元上的形函数，具体细节可以参考 《A first course in finite elements — Jacob Fish，Ted Belytschko》
。
\end_layout

\begin_layout Enumerate
空间坐标（Space or Geometric Coordinates）：指所求解问题的几何模型所在物理空间的坐标；例如经常用到 网格节点的空间坐标。
\end_layout

\begin_layout Enumerate
母坐标（Parent or Isoparametric Coordinates）：有限元的分片单元经过坐标变换后，一般变成参数空间的标准单元，例如三角形
\begin_inset Formula $\rightarrow$
\end_inset

等腰直角三角形。将参数空间的坐标称为 等参坐标坐标，因为它使用和 场量 相同的插值函数。
\end_layout

\begin_layout Section
势函数连续条件
\end_layout

\begin_layout Standard
在有限元中，求解区域被划分成小单元。每个小单元内的点，包括边界，也使用形函数插值得到：
\begin_inset Formula 
\[
X=\sum_{\alpha}N_{\alpha}^{e}\left(\xi_{1},\cdots\xi_{n}\right)X_{\alpha}
\]

\end_inset

其中 
\begin_inset Formula $X_{i}$
\end_inset

 是节点坐标，
\begin_inset Formula $X$
\end_inset

 是单元 
\begin_inset Formula $e$
\end_inset

 的内点，对应于等参平面上的点 
\begin_inset Formula $(\xi_{1},\cdots\xi_{n})$
\end_inset

 。如果区域不是平面/直线，例如对于圆弧边界，插值得到的
\begin_inset Formula $X$
\end_inset

 将作为精确点 
\begin_inset Formula $X_{0}$
\end_inset

 的近似。
\end_layout

\begin_layout Standard
形函数具有支撑性质 
\begin_inset Formula $N_{\alpha}^{e}(x_{\beta})=\delta_{\alpha\beta}$
\end_inset

，也就是 
\begin_inset Formula $x_{i}$
\end_inset

 点上定义的形函数，只在这一点的邻域不为零，在单元的其它点上都为零。这一性质保证了插值出的结果在单元边界上至少是 
\begin_inset Formula $C^{0}$
\end_inset

 连续的。例如下左图的两个三角形单元，
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\backslash
documentclass[tikz,border=10pt]{standalone} 
\end_layout

\begin_layout Plain Layout

\backslash
usepackage{tikz} 
\end_layout

\begin_layout Plain Layout

\backslash
usetikzlibrary{positioning} 
\end_layout

\begin_layout Plain Layout

\backslash
begin{document}
\end_layout

\begin_layout Plain Layout

\backslash
begin{tikzpicture}[scale=1] 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=left:$1$](A) at (0,0); 
\backslash
coordinate [label=right:$2$] (B) at (2,0); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$3$] (C) at (1.5,1); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$4$] (D) at (3,1); 
\end_layout

\begin_layout Plain Layout

\backslash
draw (A) -- (B)--(C)--cycle; 
\backslash
draw (B) -- (C)--(D)--cycle; 
\backslash
node at (3.5, .5) {$
\backslash
Rightarrow$}; 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=left:$1$](A) at (4,0); 
\backslash
coordinate [label=below:$2$] (B) at (5,0); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$3$] (C) at (5,1); 
\backslash
coordinate [label=right:$4$] (D) at (6,0);
\end_layout

\begin_layout Plain Layout

\backslash
draw (A) -- (B)--(C)--cycle; 
\backslash
draw (B) -- (C)--(D)--cycle;
\end_layout

\begin_layout Plain Layout

\backslash
end{tikzpicture}
\end_layout

\begin_layout Plain Layout

\backslash
end{document} 
\end_layout

\end_inset

它们具有公共边 
\begin_inset Formula $2$
\end_inset

–
\begin_inset Formula $3$
\end_inset

，经过 母坐标变换，所有单元都变成标准单元–边长为
\begin_inset Formula $1$
\end_inset

的直角三角形，即右图。在 母坐标系中，两个单元的形状完全相同。
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/ele-tri3-2.pdf
	lyxscale 150
	scale 80

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
单元映射
\begin_inset CommandInset label
LatexCommand label
name "fig:ele-trans"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset

某个单元内的场量的插值，在 母坐标系下写作：
\begin_inset Formula 
\[
\phi\left(\xi_{i}\right)=\sum_{\alpha=1}^{N}N_{\alpha}^{e}\left(\xi_{i}\right)\,\phi_{\alpha}
\]

\end_inset

其中
\begin_inset Formula $\alpha=1,2,\cdots N$
\end_inset

，
\begin_inset Formula $N$
\end_inset

是单元的自由度数。fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:ele-trans"
plural "false"
caps "false"
noprefix "false"

\end_inset

中公共边（2–3）上的场量即可以用单元
\begin_inset Formula $1$
\end_inset

表示，也可以用单元
\begin_inset Formula $2$
\end_inset

表示，即
\begin_inset Formula 
\[
\phi=\sum_{\alpha=1}^{n}N_{\alpha}^{(1)}\left(\xi_{i}\right)\phi_{\alpha}^{(1)}=\sum_{\alpha=1}^{n}N_{\alpha}^{(2)}\left(\xi_{i}\right)\phi_{\alpha}^{(2)}
\]

\end_inset

公共边在两个单元中的 母坐标 
\begin_inset Formula $(\xi_{\alpha})$
\end_inset

 是相同的，形函数在两个单元中也取相同的形式，因此唯一的差别在于顶点 
\begin_inset Formula $(1,4)$
\end_inset

 上 
\begin_inset Formula $\phi_{i}$
\end_inset

的取值，而它们的值一般不相等。因此两个单元对公共边上的场给出不同的插值，解决冲突的办法之一就是要求形函数满足 
\begin_inset Formula $N_{\alpha}^{e}(x_{\beta})=\delta_{\alpha\beta}$
\end_inset

，这样公共边上的值只取决于节点 
\begin_inset Formula $(2,3)$
\end_inset

，所以至少是
\begin_inset Formula $C^{0}$
\end_inset

连续的。（类似拉格朗日插值）
\end_layout

\begin_layout Standard
从另一方面，插值表达式是 
\begin_inset Formula $\phi_{\alpha}$
\end_inset

 和
\begin_inset Formula $N_{\alpha}^{e}$
\end_inset

的线性组合。
\begin_inset Formula 
\[
\phi=\sum_{\alpha=1}^{N}N_{\alpha}^{e}\,\phi_{\alpha}
\]

\end_inset

要求在每个节点上，插值
\begin_inset Formula $\phi=\phi_{\alpha}$
\end_inset

，得到
\begin_inset Formula $N$
\end_inset

个方程；当
\begin_inset Formula $\phi_{\alpha}\to\phi_{\alpha}+\delta\phi_{\alpha}$
\end_inset

时要求插值表达式仍然成立，则等价于
\begin_inset Formula $N_{\alpha}^{e}$
\end_inset

 满足 离散形式的正交归一性
\begin_inset Formula 
\[
N_{\alpha}^{e}(x_{\beta})=\delta_{\alpha\beta}
\]

\end_inset


\end_layout

\begin_layout Section
场和坐标的插值多项式
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/affine.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Standard
一阶单元的坐标变换在数学上就是仿射变换（Affine transformation）。
\begin_inset Formula 
\[
\left(\begin{array}{c}
x\\
y\\
1
\end{array}\right)=\left[\begin{array}{ccc}
R_{00} & R_{01} & T_{x}\\
R_{10} & R_{11} & T_{y}\\
0 & 0 & 1
\end{array}\right]\left(\begin{array}{c}
\xi_{1}\\
\xi_{2}\\
1
\end{array}\right)
\]

\end_inset

变换矩阵一共
\begin_inset Formula $6$
\end_inset

个未知元素，需要
\begin_inset Formula $6$
\end_inset

个方程，因此提供三个节点的坐标（共
\begin_inset Formula $6$
\end_inset

个分量），可以唯一确定这
\begin_inset Formula $6$
\end_inset

个元素。
\begin_inset Formula 
\[
\left(\begin{array}{ccc}
x_{1} & x_{2} & x_{3}\\
y_{1} & y_{2} & y_{3}\\
1 & 1 & 1
\end{array}\right)=\left[\begin{array}{ccc}
R_{00} & R_{01} & T_{x}\\
R_{10} & R_{11} & T_{y}\\
0 & 0 & 1
\end{array}\right]\left(\begin{array}{ccc}
1 & 0 & 0\\
0 & 1 & 0\\
1 & 1 & 1
\end{array}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
从另一个角度，一阶单元上的插值场是一阶线性多项式 （Zienkiewicz，Page119/158）（下面分别写成显式矩阵形式和指标形式）
\begin_inset Formula 
\begin{equation}
\hat{\phi}^{e}=p_{1}+p_{2}x+p_{3}y={\color{blue}x_{\alpha}}\,p_{\alpha}\label{eq:7.1}
\end{equation}

\end_inset

其中
\begin_inset Formula $\alpha$
\end_inset

是节点编号，
\begin_inset Formula $x_{\alpha}=(1,x,y)$
\end_inset

，
\begin_inset Formula $p_{\alpha}=(p_{1},p_{2},p_{3})$
\end_inset

对
\begin_inset Formula $(x,y)$
\end_inset

是常数。为了确定这些系数，代入三角形三个顶点的 坐标和对应的场值
\begin_inset Formula $\tilde{\phi}$
\end_inset

，建立方程组
\begin_inset Formula 
\begin{align}
\left(\begin{array}{c}
\tilde{\phi}_{1}^{e}\\
\tilde{\phi}_{2}^{e}\\
\tilde{\phi}_{3}^{e}
\end{array}\right) & =\left[\begin{array}{ccc}
1 & x_{1} & y_{1}\\
1 & x_{2} & y_{2}\\
1 & x_{3} & y_{3}
\end{array}\right]\left(\begin{array}{c}
p_{1}\\
p_{2}\\
p_{3}
\end{array}\right)\label{eq:7.2}\\
\tilde{\phi}_{\alpha} & =X_{\alpha\beta}\,p_{\beta}
\end{align}

\end_inset

其中
\begin_inset Formula $\tilde{\phi}$
\end_inset

场可以是电势（场插值），也可以是空间坐标
\begin_inset Formula $x,y$
\end_inset

（坐标变换）。上述
\begin_inset Formula $\phi\leftarrow P$
\end_inset

变换的逆是
\begin_inset Formula 
\begin{align}
\left[\begin{array}{ccc}
1 & x_{1} & y_{1}\\
1 & x_{2} & y_{2}\\
1 & x_{3} & y_{3}
\end{array}\right]^{-1} & =\frac{1}{2\Delta^{e}}\left[\begin{array}{ccc}
a_{1} & a_{2} & a_{3}\\
b_{1} & b_{2} & b_{3}\\
c_{1} & c_{2} & c_{3}
\end{array}\right]={\color{blue}X_{\alpha\beta}^{-1}}\label{eq:7.3}\\
p_{\alpha} & ={\color{blue}X_{\alpha\beta}^{-1}}\tilde{\phi}_{\beta}
\end{align}

\end_inset

上式为 逆矩阵 的 伴随矩阵形式，
\begin_inset Formula $A_{ij}^{-1}=C_{ji}/\det[A]$
\end_inset

，
\begin_inset Formula $2\Delta^{e}=\det[A]$
\end_inset

，
\begin_inset Formula $\Delta^{e}$
\end_inset

是三角形面积。
\end_layout

\begin_layout Standard
重新填入坐标依赖
\begin_inset Formula $x_{\alpha}$
\end_inset

，将
\begin_inset Formula $\hat{\phi}$
\end_inset

的插值
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:7.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

写成指标形式
\begin_inset Formula 
\begin{equation}
\hat{\phi}^{e}=p_{\alpha}\,x_{\alpha}={\color{blue}x_{\alpha}X_{\alpha\beta}^{-1}}\,\tilde{\phi}_{\beta}\label{eq:7.4}
\end{equation}

\end_inset

从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:7.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

看出 对应节点值
\begin_inset Formula $\tilde{\phi}_{\beta}$
\end_inset

 的插值函数是 
\begin_inset Formula $N_{\beta}=x_{\alpha}X_{\alpha\beta}^{-1}$
\end_inset

，其显式为
\begin_inset Formula 
\[
N_{\beta}(x,y;X_{\alpha j})=\frac{1}{2\Delta^{e}}\left(a_{\beta}+b_{\beta}x+c_{\beta}y\right)
\]

\end_inset

从而插值表达式
\begin_inset Formula 
\[
\hat{\phi}^{e}=N_{\beta}(x,y)\,\tilde{\phi}_{\beta}
\]

\end_inset


\end_layout

\begin_layout Standard
高阶的单元可以用类似的推导方式，或者用直接法构建，see Zienkiewicz Page153/193.
\end_layout

\begin_layout Standard
由于这些形函数沿三角形的任意边线性变化，并施加相同的节点值，因此相邻单元之间的界面上显然存在相同的函数值。但我们注意到，单元之间的导数可能并不连续；因此，上述形
式只提供了 
\begin_inset Formula $C_{0}$
\end_inset

 连续性。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/zienkiewicz-5.2.png
	lyxscale 70
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
单元上的
\begin_inset Formula $N_{3}$
\end_inset

形函数：（a）三节点三角形（b）四节点长方形。hint: 
\begin_inset Formula $N_{i}$
\end_inset

为Z轴。
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
坐标mapping
\end_layout

\begin_layout Standard
三角形的一阶形函数
\begin_inset Formula $N_{\alpha}^{(1)}$
\end_inset

的在单元上线性变化，值域范围是 
\begin_inset Formula $[0,1]$
\end_inset

，几何意义是面积比。可以直接定义 
\begin_inset Formula $N_{\alpha}^{(1)}$
\end_inset

 为一种新的局部坐标，称为面积坐标（或母坐标），改用字母
\begin_inset Formula $L_{\alpha}$
\end_inset

表示，即
\begin_inset Formula $L_{\alpha}:=N_{\alpha}^{(1)}$
\end_inset

，称为 母坐标。因为
\begin_inset Formula $\sum_{\alpha}L_{\alpha}=1$
\end_inset

，所以
\begin_inset Formula $L_{\alpha}$
\end_inset

并不是全部独立的，可以提出两个独立变量
\begin_inset Formula $\xi_{1}$
\end_inset

，
\begin_inset Formula $\xi_{2}$
\end_inset


\begin_inset Formula 
\[
L_{\alpha}=(1-\xi_{1}-\xi_{2},\,\xi_{1},\,\xi_{2}).
\]

\end_inset


\end_layout

\begin_layout Standard
由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:7.4"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
L_{\beta}={\color{blue}x_{\alpha}\,X_{\alpha\beta}^{-1}}
\]

\end_inset

所以逆变换是
\begin_inset Formula 
\[
x_{\beta}=L_{\alpha}\,X_{\alpha\beta}
\]

\end_inset

其中
\begin_inset Formula $x_{\beta}=(1,x,y)$
\end_inset

 是扩充的空间坐标。因而上文的形函数
\begin_inset Formula $N_{\alpha}(x,y)$
\end_inset

可以写作
\begin_inset Formula $(\xi_{1},\xi_{2})$
\end_inset

的函数，
\begin_inset Formula 
\[
N_{\alpha}=\left[\begin{array}{c}
1-\xi_{1}-\xi_{2}\\
\xi_{1}\\
\xi_{2}
\end{array}\right]
\]

\end_inset

后续默认情况下形函数（包括高阶）都写在母坐标下。
\end_layout

\begin_layout Subsection
例：一阶三角形单元
\end_layout

\begin_layout Standard
一阶三角形单元的形函数
\begin_inset Formula $N_{\beta}(x,y)$
\end_inset

 恰好是面积坐标
\begin_inset Formula $L_{\alpha}^{e}(x,y)$
\end_inset

 
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}
\end{array}\right\} =\frac{1}{2\Delta^{e}}\left[\begin{array}{ccc}
x_{2}y_{3}-x_{3}y_{2} & y_{2}-y_{3} & x_{3}-x_{2}\\
x_{3}y_{1}-x_{1}y_{3} & y_{3}-y_{1} & x_{1}-x_{3}\\
x_{1}y_{2}-x_{2}y_{1} & y_{1}-y_{2} & x_{2}-x_{1}
\end{array}\right]\left\{ \begin{array}{c}
1\\
x\\
y
\end{array}\right\} \label{eq:4.160}
\end{equation}

\end_inset


\begin_inset Formula 
\[
2\Delta^{e}=\det[J]=(y_{2}-y_{3})(x_{1}-x_{3})-(y_{3}-y_{1})(x_{3}-x_{2})
\]

\end_inset


\begin_inset Formula $L_{j}\to x_{j}$
\end_inset

 的mapping
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{c}
1\\
x\\
y
\end{array}\right\} =\left[\begin{array}{ccc}
1 & 1 & 1\\
x_{1}^{e} & x_{2}^{e} & x_{3}^{e}\\
y_{1}^{e} & y_{2}^{e} & y_{3}^{e}
\end{array}\right]\left\{ \begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}
\end{array}\right\} .\label{eq:4.161}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
等参单元形函数
\end_layout

\begin_layout Standard
下面附上一些常用的等参单元的 shape function。
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/triangle-ele.pdf
	scale 70

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics[{ Line[{ {0, 0}, {0, 1}, {1, 0}, {0, 0} }] , FontSize
 -> 13 , Text[1, {1, +3 delta}] , Text[2, {0 - 4 delta, 1 + delta}] , Text[3,
 {-6 delta, 2 delta}] } , Axes -> True, AxesOrigin -> {0, 0} , AxesStyle
 -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2"} , PlotRangePadding -> { {Scaled[0], Scaled[.1]}, {Scaled[0], Scaled[.1]}}
 , ImageSize -> Small ]
\end_layout

\end_inset


\begin_inset Formula 
\[
N^{(1)}=1-\xi_{1}-\xi_{2},\quad N^{(2)}=\xi_{1},\quad N^{(3)}=\xi_{2}
\]

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/rectangle-ele.pdf
	scale 70

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics[{ Line[{ {-1, -1}, {1, -1}, {1, 1}, {-1, 1}, {-1,
 -1} }] , FontSize -> 13 , Text[1, {-1 - 3 delta, -1 - 3 delta}] , Text[2,
 {1 + 3 delta, -1 - 3 delta}] , Text[3, {1 + 3 delta, 1 + 3 delta}] , Text[4,
 {-1 - 3 delta, 1 + 3 delta}] } , Axes -> True, AxesOrigin -> {0, 0} , AxesStyle
 -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2"} , PlotRangePadding -> { {Scaled[.1], Scaled[.1]}, {Scaled[.1], Scaled[.1]}}
 , ImageSize -> Small ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
N^{(1)} & =\frac{1}{4}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right),\\
N^{(2)} & =\frac{1}{4}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right),\\
N^{(3)} & =\frac{1}{4}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right),\\
N^{(4)} & =\frac{1}{4}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right).
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/tetrahedron-ele.pdf
	lyxscale 50
	scale 55

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics3D[{ Line[{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}, {1, 0,
 0}}], Line[{{1, 0, 0}, {0, 0, 0}, {0, 1, 0}}], Line[{{0, 0, 1}, {0, 0,
 0}}], , FontSize -> 13 , Text[1, {1 + 3 delta, 2 delta, 0}] , Text[2, {2
 delta, 1 + 3 delta, 0}] , Text[3, {2 delta, 2 delta, 1 + 3 delta}] , Text[4,
 {+3 delta, -delta, +3 delta}] } , Axes -> True, AxesOrigin -> {0, 0, 0}
 , AxesStyle -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2", "
\backslash
[Xi]_3"} , PlotRangePadding -> {Scaled[.1], Scaled[.1], Scaled[.1]} , ImageSize
 -> Medium , Boxed -> False ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
 & N^{(1)}=\xi_{1},\quad N^{(2)}=\xi_{2},\quad N^{(3)}=\xi_{3},\\
 & N^{(4)}=1-\xi_{1}-\xi_{2}-\xi_{3},
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/cuboid-ele.pdf
	lyxscale 50
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics3D[{ Line[{{-1, -1, -1}, {1, -1, -1}, {1, 1, -1}, {-1,
 1, -1}, {-1, -1, -1}}], Line[{{-1, -1, 1}, {1, -1, 1}, {1, 1, 1}, {-1,
 1, 1}, {-1, -1, 1}}], Line[{{-1, -1, -1}, {-1, -1, 1}}], Line[{{1, -1,
 -1}, {1, -1, 1}}], Line[{{1, 1, -1}, {1, 1, 1}}], Line[{{-1, 1, -1}, {-1,
 1, 1} }], Line[{{0, 0, 1}, {0, 0, 0}}] , FontSize -> 13 , Text[1, {-1 -
 3 delta, -1 - 3 delta, -1 - 3 delta}], Text[5, {-1 - 3 delta, -1 - 3 delta,
 1 + 3 delta}] , Text[2, {1 + 3 delta, -1 - 3 delta, -1 - 3 delta}], Text[6,
 {1 + 3 delta, -1 - 3 delta, 1 + 3 delta}] , Text[3, {1 + 3 delta, 1 + 3
 delta, -1 - 3 delta}], Text[7, {1 + 3 delta, 1 + 3 delta, 1 + 3 delta}]
 , Text[4, {-1 - 3 delta, 1 + 3 delta, -1 - 3 delta}], Text[8, {-1 - 3 delta,
 1 + 3 delta, 1 + 3 delta}] } , Axes -> True, AxesOrigin -> {0, 0, 0} ,
 AxesStyle -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2", "
\backslash
[Xi]_3"} , PlotRangePadding -> {Scaled[.1], Scaled[.1], Scaled[.1]} , ImageSize
 -> Medium , Boxed -> False ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
N^{(1)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(2)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(3)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(4)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(5)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(6)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(7)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(8)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right)\left(1+\xi_{3}\right),
\end{align*}

\end_inset


\end_layout

\begin_layout Section
形函数基本性质
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-tri6.pdf
	scale 50

\end_inset

三角形单元；
\end_layout

\begin_layout Itemize

\series bold
形函数正交性
\series default
。形函数
\begin_inset Formula $N_{\alpha}$
\end_inset

满足
\begin_inset Formula 
\[
N_{\alpha}(\xi_{\beta})=\delta_{\alpha\beta}.
\]

\end_inset

其中
\begin_inset Formula $N_{\alpha}$
\end_inset

表示属于节点
\begin_inset Formula $\alpha$
\end_inset

的形函数，
\begin_inset Formula $\xi_{\beta}$
\end_inset

表示节点
\begin_inset Formula $\beta$
\end_inset

的坐标。
\end_layout

\begin_layout Itemize
在单元边界上，形函数只是单一母坐标分量的函数，例如在 Edge(0,1) 上，只是
\begin_inset Formula $\xi_{2}$
\end_inset

的函数。
\end_layout

\begin_layout Itemize

\series bold
标量形函数边界值
\series default
。 以上面三角形的节点
\begin_inset Formula $0$
\end_inset

的形函数
\begin_inset Formula $N_{0}$
\end_inset

为例，如果
\begin_inset Formula $N_{0}$
\end_inset

是一阶形函数，由于
\begin_inset Formula $N_{0}$
\end_inset

在节点
\begin_inset Formula $1,2$
\end_inset

 上必须为零，所以它在 Edge(1,2) 上恒为零（线性函数）。类似地，如果
\begin_inset Formula $N_{0}$
\end_inset

是二阶形函数，因为
\begin_inset Formula $N_{0}$
\end_inset

在节点
\begin_inset Formula $1,2,4$
\end_inset

上必须为零，所以它在 Edge(1,4,2) 上恒为零，因为单变量的二阶多项式在3个点上为零。
\end_layout

\begin_layout Itemize

\series bold
矢量形函数边界值
\series default
。对于矢量形函数
\begin_inset Formula 
\begin{equation}
\sbf N_{01}=N_{0}\nabla N_{1}-N_{1}\nabla N_{0}\label{eq:73.1}
\end{equation}

\end_inset

它在 Edge(1,2) 化简成 
\begin_inset Formula $\sbf N_{01}=-N_{1}\nabla N_{0}$
\end_inset

，又因为
\begin_inset Formula $N_{0}$
\end_inset

在Edge(1,2) 上恒为零，所以 Edge(1,2) 是
\begin_inset Formula $N_{0}$
\end_inset

的等势线，
\begin_inset Formula $\nabla N_{0}$
\end_inset

必定垂直于Edge(1,2)，即
\begin_inset Formula $\sbf N_{01}$
\end_inset

 在Edge(1,2) 上的切向分量为零。矢量形函数沿一条边的切向分量是非零常数，而沿其他边则为零。
\end_layout

\begin_layout Itemize
组合
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:73.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的负号是因为
\begin_inset Formula $N_{1}$
\end_inset

和
\begin_inset Formula $N_{0}$
\end_inset

的默认梯度方向相反，这样出来的矢量方向是顺着的。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/vector-shape-function1.pdf
	lyxscale 60
	scale 28

\end_inset


\begin_inset Graphics
	filename inset/vector-shape-function2.pdf
	lyxscale 60
	scale 28

\end_inset


\begin_inset Graphics
	filename inset/vector-shape-function3.pdf
	lyxscale 60
	scale 28

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
n1 = {x1, y1} = {0, 0}; n2 = {x2, y3} = {1, 0}; n3 = {x3, y3} = {0, 1};
 (*node coord*) nd = {n1, n2, n3}; al = { x2*y3 - y2*x3, x3*y1 - y3*x1,
 x1*y2 - y1*x2}; bl = { y2 - y3, y3 - y1, y1 - y2}; cl = { x3 - x2, x1 -
 x3, x2 - x1}; i
\backslash
[CapitalDelta]e = 1/2 Det[{ {1, x1, y1}, {1, x2, y2}, {1, x3, y3} }]; (*形函数*)
 iNl[x_, y_] := 1/(2 i
\backslash
[CapitalDelta]e) (1*al + x*bl + y*cl); (*形函数梯度*) gradN[x_, y_] := Replace[Grad[i
Nl[a, b], {a, b}], {a -> x, b -> y}]; vecN[x_, y_] := Module[{iN = iNl[x,
 y], iG = gradN[x, y]}, {iN[[1]]*iG[[2]] - iN[[2]]*iG[[1]], iN[[2]]*iG[[3]]
 - iN[[3]]*iG[[2]], iN[[3]]*iG[[1]] - iN[[1]]*iG[[3]]}]; tri = Triangle[{{x1,
 y1}, {x2, y2}, {x3, y3}}]; vecte1 = vecN[x, y]; fig = VectorPlot[vecte1[[3]],
 {x, y} 
\backslash
[Element] tri, VectorPoints -> "Regular", ImageSize -> Medium]
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
矢量形函数图示，分别为
\begin_inset Formula $N_{12}$
\end_inset

，
\begin_inset Formula $N_{23}$
\end_inset

，
\begin_inset Formula $N_{31}$
\end_inset

。
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
程序约定
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language={C++}"
inline false
status open

\begin_layout Plain Layout

//[母坐标数, 节点数]
\end_layout

\begin_layout Plain Layout

Matrix dNdzeta(1,NdNum);// LineFunc
\end_layout

\begin_layout Plain Layout

Matrix dNdzeta(2,NdNum);// TriangleFunc
\end_layout

\end_inset


\end_layout

\begin_layout Section
邻接关系
\end_layout

\begin_layout Itemize
使用 
\series bold
0–based。
\series default
按照 Edge 的顺序排列。
\end_layout

\begin_layout Itemize
二维用
\begin_inset Formula $\hat{\sbf z}\times$
\end_inset

算符作用到Edge切向后，法向朝单元外部。一阶Edge 
\begin_inset Formula $2$
\end_inset

个点，二阶 Edge 
\begin_inset Formula $3$
\end_inset

个点。
\end_layout

\begin_layout Enumerate
二阶线单元，Line
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/ele-line3.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Enumerate
三角形，Triangle
\begin_inset Formula 
\begin{align*}
 & \{1,0,\,{\color{blue}3}\}\\
 & \{2,1,\,{\color{blue}4}\}\\
 & \{0,2,\,{\color{blue}5}\}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate
四边形，Quadrilateral
\begin_inset Formula 
\begin{align*}
 & \{1,0,\,{\color{blue}4}\}\\
 & \{2,1,\,{\color{blue}5}\}\\
 & \{3,2,\,{\color{blue}6}\}\\
 & \{0,3,\,{\color{blue}7}\}
\end{align*}

\end_inset


\end_layout

\begin_layout Itemize
三维的点排布的螺旋性朝单元外部。按照 Facet 的顺序排列。
\end_layout

\begin_layout Itemize
例如下面的 
\begin_inset Formula $\{0,2,1,{\color{blue}6,5,4}\}$
\end_inset

，
\begin_inset Formula $6$
\end_inset

是 
\begin_inset Formula $\{0,2\}$
\end_inset

的中点，
\begin_inset Formula $5$
\end_inset

 是
\begin_inset Formula $\{2,1\}$
\end_inset

的中点。
\end_layout

\begin_layout Enumerate
四面体 Tetrahedron
\begin_inset Formula 
\begin{align*}
 & \{0,2,1,\,{\color{blue}6,5,4}\}\\
 & \{0,1,3,\,{\color{blue}4,8,7}\}\\
 & \{1,2,3,\,{\color{blue}5,9,8}\}\\
 & \{0,3,2,\,{\color{blue}7,9,6}\}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate
三棱柱 Wedge
\begin_inset Formula 
\begin{align*}
 & \{0,2,1,\,{\color{blue}6,8,7}\}\\
 & \{3,4,5,\,{\color{blue}9,10,11}\}\\
 & \{0,1,4,3,\,{\color{blue}6,13,9,12}\}\\
 & \{1,2,5,4,\,{\color{blue}7,14,10,13}\}\\
 & \{0,3,5,2,\,{\color{blue}12,11,14,8}\}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate
金字塔 Pyramid
\begin_inset Formula 
\begin{align*}
 & \{0,3,2,1,\,{\color{blue}8,7,6,5}\}\\
 & \{0,1,4,\,{\color{blue}5,10,9}\}\\
 & \{1,2,4,\,{\color{blue}6,11,10}\}\\
 & \{2,3,4,\,{\color{blue}7,12,11}\}\\
 & \{0,4,3,\,{\color{blue}9,12,8}\}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate
六面体 Hexahedron
\begin_inset Formula 
\begin{align*}
 & \{0,3,2,1,\,{\color{blue}11,10,9,8}\}\\
 & \{4,5,6,7,\,{\color{blue}12,13,14,15}\}\\
 & \{0,1,5,4,\,{\color{blue}8,17,12,16}\}\\
 & \{1,2,6,5,\,{\color{blue}9,18,13,17}\}\\
 & \{2,3,7,6,\,{\color{blue}10,19,14,18}\}\\
 & \{0,4,7,3,\,{\color{blue}16,15,19,11}\}
\end{align*}

\end_inset


\end_layout

\begin_layout Section
1D,Line,直线元
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-line2.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; d1 = {0, 0.05}; Graphics[{ Line[{v1, v2}], PointSize[.04
], Point[{v1, v2}], Text["1", v1 + d1], Text["2", v2 + d1] } , ImageSize
 -> Small ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
一维有限元单元为连接节点 
\begin_inset Formula $x_{1}^{e}$
\end_inset

 和 
\begin_inset Formula $x_{2}^{e}$
\end_inset

 的线段。两个节点上的一阶形函数为：
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{x_{2}^{e}-x}{x_{2}^{e}-x_{1}^{e}},\quad N_{2}^{(1)}=\frac{x-x_{1}^{e}}{x_{2}^{e}-x_{1}^{e}}.
\]

\end_inset

或用等参表示为
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{1-\xi}{2},\quad N_{2}^{(1)}=\frac{1+\xi}{2}
\]

\end_inset

其中 
\begin_inset Formula $\xi$
\end_inset

 的取值范围是 
\begin_inset Formula $[-1,1]$
\end_inset

，与坐标的转换关系为：
\begin_inset Formula 
\[
\xi=\frac{x-(x_{1}^{e}+x_{2}^{e})/2}{(x_{2}^{e}-x_{1}^{e})/2}
\]

\end_inset

单元中某个内点的坐标 
\begin_inset Formula $x$
\end_inset

 可以用形函数，以及相应的节点坐标 
\begin_inset Formula $x_{i}$
\end_inset

 表示为：
\begin_inset Formula 
\begin{equation}
x=\sum_{i=1}^{n_{e}}N_{i}^{e}(\xi)x_{i}=\sum_{i=1}^{n_{e}}N_{i}^{e\prime}(x,y)x_{i}\label{eq:interp1d}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
derivatives
\end_layout

\begin_layout Standard
Gradient 矩阵 
\begin_inset Formula $G_{\alpha j}=\partial N_{\alpha}/\partial\xi_{j}$
\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
L0 := 
\backslash
[Xi]; dvlst = {
\backslash
[Xi]}; NShapelst = {(1 - L0)/2, (1 + L0)/2}; Simplify[D[#, {dvlst}] & /@
 NShapelst] // Print; Simplify[D[#, {dvlst, 2}] & /@ NShapelst] // Print;
\end_layout

\end_inset


\begin_inset Formula 
\[
\begin{array}{c}
-\frac{1}{2}\\
\frac{1}{2}
\end{array}
\]

\end_inset


\end_layout

\begin_layout Standard
Hessian 矩阵 
\begin_inset Formula $H_{\alpha ij}=\frac{\partial^{2}N_{\alpha}}{\partial\xi_{i}\partial\xi_{j}}$
\end_inset


\begin_inset Formula 
\[
\left[0\right]_{1\times1},\left[0\right]_{1\times1}
\]

\end_inset


\end_layout

\begin_layout Subsection
remark
\end_layout

\begin_layout Enumerate
一阶单元是 
\series bold
线性单元
\series default
。例如把曲线的参数取为横坐标
\begin_inset Formula $x$
\end_inset

，两节点的纵坐标分别是 
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $2$
\end_inset

。有限元插值
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:interp1d"
plural "false"
caps "false"
noprefix "false"

\end_inset

给出的内点落在一条直线上。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/ele-o1-regionInterp.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1, 
\backslash
[Xi]_] := (1 - 
\backslash
[Xi])/2; nShape[2, 
\backslash
[Xi]_] := (1 + 
\backslash
[Xi])/2; xi = {1, 2}; coord[
\backslash
[Xi]_] := Sum[xi[[n]]*nShape[n, 
\backslash
[Xi]], {n, 2}]; Plot[coord[
\backslash
[Xi]], {
\backslash
[Xi], -1, 1}, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{1}^{(1)}$
\end_inset

形函数在 
\begin_inset Formula $x_{2}$
\end_inset

处为零，即满足 
\begin_inset Formula $N_{i}^{e}\left(x_{j}\right)=\delta_{ij}$
\end_inset

。但
\begin_inset Formula 
\[
\partial_{x}N_{1}^{(1)}=\frac{-1}{\ell},\quad\partial_{x}N_{2}^{(1)}=\frac{1}{\ell},
\]

\end_inset

在整个单元上为常数。如右图 
\begin_inset Formula $1,2$
\end_inset

组成单元
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $2,3$
\end_inset

为单元
\begin_inset Formula $B$
\end_inset

，
\begin_inset Graphics
	filename inset/ele-line-pair.pdf
	lyxscale 80
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; v3 = {2, 0}; d1 = {0, 0.1}; d2 = {0.5, 0.1}; Graphics[{
 Line[{v1, v2, v3}], PointSize[.04], Point[{v1, v2, v3}], Text["1", v1 +
 d1], Text["2", v2 + d1], Text["3", v3 + d1], Text["A", v1 + d2], Text["B",
 v2 + d2] } , ImageSize -> Small ]
\end_layout

\end_inset

。 点 
\begin_inset Formula $2$
\end_inset

是单元
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $B$
\end_inset

 的公共点，
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $B$
\end_inset

单元分别在点
\begin_inset Formula $2$
\end_inset

 有形函数，记作
\begin_inset Formula $N_{2}^{A}$
\end_inset

，
\begin_inset Formula $N_{2}^{B}$
\end_inset

 ，它们对点
\begin_inset Formula $2$
\end_inset

 的 
\begin_inset Formula $\phi$
\end_inset

 贡献相同，但是它们对点 
\begin_inset Formula $2$
\end_inset

 的梯度（一阶导数）的贡献是不同的，因为
\begin_inset Formula $\nabla\phi=\sum\phi_{\alpha}\nabla N_{\alpha}$
\end_inset

，通过考虑全局编号和局部编号关系可知 
\begin_inset Formula $N_{2}^{A}=\frac{1}{\ell}$
\end_inset

，
\begin_inset Formula $N_{2}^{A}=\frac{-1}{\ell}$
\end_inset

。
\end_layout

\begin_layout Subsection
线段二阶形函数
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-line3.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; v3 = {2, 0}; d1 = {0, 0.1}; d2 = {0.5, 0.1}; Graphics[{Li
ne[{v1, v2, v3}], PointSize[.04], Point[{v1, v2, v3}], Text["1", v1 + d1],
 Text["3", v2 + d1], Text["2", v3 + d1]}, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
在一维有限元单元上添加中点，可以构造二阶形函数。二阶形函数可以由一阶形函数直接生成。
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{1-\xi}{2},\quad N_{2}^{(1)}=\frac{1+\xi}{2}
\]

\end_inset

首先，边中点形函数 
\begin_inset Formula $N_{3}^{(2)}$
\end_inset

 可以由两个节点的一阶形函数生成，即
\begin_inset Formula 
\[
{\color{blue}N_{3}^{(2)}=4N_{1}^{(1)}N_{2}^{(1)}}
\]

\end_inset

则
\begin_inset Formula $N_{3}^{(2)}$
\end_inset

在节点
\begin_inset Formula $1,2$
\end_inset

上必为零。但此时，
\begin_inset Formula $N_{1}^{(1)},N_{2}^{(1)}$
\end_inset

在节点
\begin_inset Formula $3$
\end_inset

上不为零。可以通过从
\begin_inset Formula $N_{1}^{(1)},N_{2}^{(1)}$
\end_inset

中减除适当的
\begin_inset Formula $N_{3}^{(2)}$
\end_inset

，使得它们满足
\begin_inset Formula $N_{\alpha}(\xi_{\beta})=\delta_{\alpha\beta}$
\end_inset


\begin_inset Formula 
\[
N_{i}^{(2)}=N_{i}^{(1)}-\frac{1}{2}N_{3}^{(2)},\quad i\in\{1,2\}
\]

\end_inset

最后得到二阶形函数的表达式：
\begin_inset Formula 
\begin{align*}
\text{端点形函数：} & N_{1}^{(2)}=\frac{\xi(\xi-1)}{2}\\
\text{端点形函数：} & N_{2}^{(2)}=\frac{\xi(\xi+1)}{2}\\
\text{中点形函数：} & N_{3}^{(2)}=(1+\xi)(1-\xi)
\end{align*}

\end_inset

类似地，单元内点由插值得到
\begin_inset Formula 
\begin{equation}
x=\sum_{i=1}^{n_{e}}N_{i}^{(2)}(\xi)x_{i},\quad\xi\in[-1,1]\label{eq:interp2d}
\end{equation}

\end_inset

对内点的二阶形函数插值，给出二阶单元，二阶单元可以精确拟合二次曲线。例如下图，两端点纵坐标都是
\begin_inset Formula $1$
\end_inset

，中点纵坐标是 
\begin_inset Formula $2$
\end_inset

，二阶单元给出的插值曲线为：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1, 
\backslash
[Xi]_] := (
\backslash
[Xi] (
\backslash
[Xi] - 1))/2; nShape[2, 
\backslash
[Xi]_] := (
\backslash
[Xi] (
\backslash
[Xi] + 1))/2; nShape[3, 
\backslash
[Xi]_] := (1 + 
\backslash
[Xi]) (1 - 
\backslash
[Xi]); xi = {1, 1, 2}; coord[
\backslash
[Xi]_] := Sum[xi[[n]]*nShape[n, 
\backslash
[Xi]], {n, 3}]; Plot[coord[
\backslash
[Xi]], {
\backslash
[Xi], -1, 1}, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-o2-regionInterp.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Standard
计算中经常会用到 空间坐标 和 母坐标 微分之间的转换，即
\begin_inset Formula 
\[
J=\frac{\partial x}{\partial\xi}=\frac{\partial N_{i}^{e}}{\partial\xi}x_{i}
\]

\end_inset


\end_layout

\begin_layout Subsection
derivatives
\end_layout

\begin_layout Standard
根据中点形函数公式 
\begin_inset Formula ${\color{blue}N_{i}^{(2)}=4N_{j}^{(1)}N_{k}^{(1)}}$
\end_inset

，首先使用Leibniz 法则计算 边中点 的导数；然后根据 trim 规则，修正对应 角点的形函数。
\begin_inset Formula 
\[
N_{j}^{(2)}=N_{j}^{(1)}-\frac{1}{2}N_{i}^{(2)},
\]

\end_inset


\end_layout

\begin_layout Standard
或者直接计算：Gradient 矩阵 
\begin_inset Formula $G_{\alpha}=\partial N_{\alpha}/\partial\xi$
\end_inset

:
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
L0 := 
\backslash
[Xi]; dvlst = {
\backslash
[Xi]}; NShapelst = {L0 (L0 - 1)/2, L0 (L0 + 1)/2, (1 + L0) (1 - L0)}; Simplify[D
[#, {dvlst}] & /@ NShapelst] // Print; Simplify[D[#, {dvlst, 2}] & /@ NShapelst]
 // Print;
\end_layout

\end_inset


\begin_inset Formula 
\[
\left(\begin{array}{c}
\xi-\frac{1}{2}\\
\xi+\frac{1}{2}\\
-2\xi
\end{array}\right)
\]

\end_inset


\end_layout

\begin_layout Standard
Hessian矩阵 
\begin_inset Formula $H_{\alpha ij}=\partial^{2}N^{\alpha}/\partial\xi_{i}\partial\xi_{j}$
\end_inset


\begin_inset Formula 
\[
\left[1\right]_{1\times1},\quad\left[1\right]_{1\times1},\quad\left[-2\right]_{1\times1},
\]

\end_inset


\end_layout

\begin_layout Section
2D,triangle,三角形
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-tri3.pdf
	lyxscale 70
	scale 40

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {-1, 0}; v2 = {1, 0}; v3 = {0, Sqrt[3]}; Graphics[{Line[{v1, v2, v3,
 v1}], PointSize[0.03], Point[{v1, v2, v3}], FontSize -> 14, Text["1", {-1.1,
 0}], Text["2", {1.1, 0}], Text["3", {0, Sqrt[3] + 0.1}] }, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
由二维三角形单元顶点的三个坐标可以定义相应的一阶形函数：
\begin_inset Formula 
\begin{align}
 & N_{1}^{(1)}=\frac{\Delta_{1}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{1}^{e}+b_{1}^{e}x+c_{1}^{e}y\right),\label{eq:shape-2-1}\\
 & N_{2}^{(1)}=\frac{\Delta_{2}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{2}^{e}+b_{2}^{e}x+c_{2}^{e}y\right),\nonumber \\
 & N_{3}^{(1)}=\frac{\Delta_{3}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{3}^{e}+b_{3}^{e}x+c_{3}^{e}y\right).\nonumber 
\end{align}

\end_inset

二维形函数的 母坐标取值为 
\begin_inset Formula $[0,1]$
\end_inset

，一阶形函数可以用 母坐标表示为：
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(1)}=1-\xi_{1}-\xi_{2},\\
 & N_{2}^{(1)}=\xi_{1}\\
 & N_{3}^{(1)}=\xi_{2}
\end{align*}

\end_inset

一阶形函数恰好等于三角形的面积坐标，
\begin_inset Formula $L_{\alpha}^{e}(\xi_{i})=N_{\alpha}^{(1)}(\xi_{i})$
\end_inset

。
\begin_inset Formula $L_{\alpha}^{e}(\xi_{i})$
\end_inset

的几何意义是，内点
\begin_inset Formula $\text{(\xi_{1},\ensuremath{\xi_{2}})}$
\end_inset

 加三角形顶点，所分割成的三个 子三角形的面积。
\end_layout

\begin_layout Remark
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:shape-2-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

中系数的定义为
\begin_inset Formula 
\begin{align*}
 & a_{1}^{e}=x_{2}^{e}y_{3}^{e}-y_{2}^{e}x_{3}^{e}; &  & b_{1}^{e}=y_{2}^{e}-y_{3}^{e}; &  & c_{1}^{e}=x_{3}^{e}-x_{2}^{e}\\
 & a_{2}^{e}=x_{3}^{e}y_{1}^{e}-y_{3}^{e}x_{1}^{e}; &  & b_{2}^{e}=y_{3}^{e}-y_{1}^{e}; &  & c_{2}^{e}=x_{1}^{e}-x_{3}^{e}\\
 & a_{3}^{e}=x_{1}^{e}y_{2}^{e}-y_{1}^{e}x_{2}^{e}; &  & b_{3}^{e}=y_{1}^{e}-y_{2}^{e}; &  & c_{3}^{e}=x_{2}^{e}-x_{1}^{e}
\end{align*}

\end_inset

以及
\begin_inset Formula 
\[
\Delta^{e}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right]=\frac{1}{2}(b_{1}c_{2}-b_{2}c_{1})
\]

\end_inset


\begin_inset Formula 
\[
\Delta_{1}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x & y\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right],\quad\Delta_{2}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x & y\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right],\quad\Delta_{3}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x & y
\end{array}\right].
\]

\end_inset


\end_layout

\begin_layout Subsection
derivatives
\end_layout

\begin_layout Standard
Gradient 矩阵 
\begin_inset Formula $G_{\alpha}=\partial N_{\alpha}/\partial\xi$
\end_inset

：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
L0 := 1 - Subscript[
\backslash
[Xi], 0] - Subscript[
\backslash
[Xi], 1]; L1 := Subscript[
\backslash
[Xi], 0]; L2 := Subscript[
\backslash
[Xi], 1]; dvlst = {Subscript[
\backslash
[Xi], 0], Subscript[
\backslash
[Xi], 1]}; NShapelst = {L0, L1, L2}; (Grid[#, Frame -> All, FrameStyle ->
 Directive[Thin, Dashed, Orange, 5]] &@ Simplify[D[#, {dvlst}] & /@ NShapelst])
 // Print; Grid[{#}, Frame -> All, FrameStyle -> Directive[Thin, Gray, 5],
 Spacings -> {2, Automatic}] &@(Grid[#, Frame -> All, FrameStyle -> Directive[Th
in, Dashed, Orange, 5]] & /@ Simplify[D[#, {dvlst, 2}] & /@ NShapelst])
 // Print;
\end_layout

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{cc}
-1 & -1\\
1 & 0\\
0 & 1
\end{array}\right]
\]

\end_inset

Hessian矩阵 
\begin_inset Formula $H_{\alpha ij}=\partial^{2}N^{\alpha}/\partial\xi_{i}\partial\xi_{j}$
\end_inset

：
\begin_inset Formula 
\[
\left[0\right]_{2\times2},\quad\left[0\right]_{2\times2},\quad\left[0\right]_{2\times2}
\]

\end_inset


\end_layout

\begin_layout Subsection
三角形二阶
\end_layout

\begin_layout Standard
在三角形单元各个边中点增加一个节点之后，可以构造出相应的二阶形函数，
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-tri6.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Graphics[{Line[{{-1, 0}, {1, 0}, {0, Sqrt[3]}, {-1, 0}}], PointSize[0.03],
 Point[{{0, 0}, {0.5, Sqrt[3]/2}, {-0.5, Sqrt[3]/2}}], Style[Text["0", {-1.1,
 0}], 16], Style[Text["1", {1.1, 0}], 16], Style[Text["2", {0, Sqrt[3] +
 0.1}], 16], (*mid side nodes*) Style[Text["3", {0, -0.16}], 16], Style[Text["4",
 {0.62, Sqrt[3]/2}], 16], Style[Text["5", {-0.62, Sqrt[3]/2}], 16]}, ImageSize
 -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
边中点形函数 
\begin_inset Formula $N_{i}^{(2)}$
\end_inset

 可以由对应两个端点的 一阶形函数 相乘 得到
\begin_inset Formula 
\begin{align*}
 & N_{3}^{(2)}=4N_{0}^{(1)}N_{1}^{(1)}\\
 & N_{4}^{(2)}=4N_{2}^{(1)}N_{1}^{(1)}\\
 & N_{5}^{(2)}=4N_{0}^{(1)}N_{2}^{(1)}
\end{align*}

\end_inset

顶点的二阶形函数，可以由顶点的一阶形函数，和 邻接边中点的二阶形函数生成
\begin_inset Formula 
\begin{align*}
 & N_{0}^{(2)}=N_{0}^{(1)}-\frac{1}{2}[N_{3}^{(1)}+N_{5}^{(1)}]\\
 & N_{1}^{(2)}=N_{1}^{(1)}-\frac{1}{2}[N_{3}^{(1)}+N_{4}^{(1)}]\\
 & N_{2}^{(2)}=N_{2}^{(1)}-\frac{1}{2}[N_{4}^{(1)}+N_{5}^{(1)}]
\end{align*}

\end_inset

最后可以得到
\begin_inset Formula 
\begin{align*}
 & N_{0}^{(2)}=\left(1-\xi-\eta\right)\left(1-2\xi-2\eta\right)\\
 & N_{1}^{(2)}=\xi\left(2\xi-1\right)\\
 & N_{2}^{(2)}=\eta\left(2\eta-1\right)\\
 & N_{3}^{(2)}=4\left(1-\xi-\eta\right)\xi\\
 & N_{4}^{(2)}=4\xi\eta\\
 & N_{5}^{(2)}=4\left(1-\xi-\eta\right)\eta
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
单元内点的坐标 
\begin_inset Formula $(x,y)$
\end_inset

 ，可以用 形函数
\begin_inset Formula $N_{i}^{e}(\xi,\eta)$
\end_inset

 以及 节点处的坐标 
\begin_inset Formula $\left(x_{i},y_{i}\right)$
\end_inset

 表示为
\begin_inset Formula 
\begin{align*}
 & x=\sum_{i}N_{i}^{e}\left(\xi,\eta\right)x_{i}\\
 & y=\sum_{i}N_{i}^{e}\left(\xi,\eta\right)y_{i}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
如图，对于曲线边界的几何区域，使用二阶形函数插值能给出贴合得更好的单元
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1][
\backslash
[Xi]_, 
\backslash
[Eta]_] := (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) (1 - 2 
\backslash
[Xi] - 2 
\backslash
[Eta]); nShape[2][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 
\backslash
[Xi] (2 
\backslash
[Xi] - 1); nShape[3][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 
\backslash
[Eta] (2 
\backslash
[Eta] - 1);
\end_layout

\begin_layout Plain Layout
nShape[4][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) 
\backslash
[Xi]; nShape[5][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 
\backslash
[Xi] 
\backslash
[Eta]; nShape[6][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) 
\backslash
[Eta]; 
\backslash
[Delta] = 0.1;(*midpoint offset*) xi = { {-1, 0}, {1, 0}, {0, Sqrt[3]}, {0,
 0 - 
\backslash
[Delta]}, {0.5 - 
\backslash
[Delta], Sqrt[3]/2}, {-(0.5 + 
\backslash
[Delta]), Sqrt[3]/2} }; coord[
\backslash
[Xi]_, 
\backslash
[Eta]_] := Sum[xi[[n]]*nShape[n][
\backslash
[Xi], 
\backslash
[Eta]], {n, 6}]; ParametricPlot[ coord[
\backslash
[Xi], 
\backslash
[Eta]], {
\backslash
[Xi], 0, 1}, {
\backslash
[Eta], 0, 1 - 
\backslash
[Xi]}, ImageSize -> Tiny]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-tri6-RegionIntep.png
	scale 65

\end_inset


\end_layout

\begin_layout Standard
有限元计算中，经常用到下面公式所示的形函数积分性质：
\begin_inset Formula 
\[
\int_{\Omega^{e}}(L_{1}^{e})^{\ell}(L_{2}^{e})^{m}(L_{3}^{e})^{n}\dd{x}\dd{y}=\frac{\ell!m!n!}{(\ell+m+n+2)!}2\Delta^{e}
\]

\end_inset


\end_layout

\begin_layout Subsection
derivatives
\end_layout

\begin_layout Standard
根据中点形函数
\begin_inset Formula ${\color{blue}N_{i}^{(2)}=4N_{j}^{(1)}N_{k}^{(1)}}$
\end_inset

，首先使用Leibniz 法则计算 边中点 的导数；然后根据角点形函数的 trim 规则
\begin_inset Formula 
\[
N_{j}^{(2)}=N_{j}^{(1)}-\frac{1}{2}\sum_{i}N_{i}^{(2)},
\]

\end_inset

修正对应 角点的形函数。其中
\begin_inset Formula $j$
\end_inset

表示角节点，
\begin_inset Formula $\sum_{i}$
\end_inset

 对所有相邻中点
\begin_inset Formula $i$
\end_inset

进行。
\end_layout

\begin_layout Standard
Gradient 矩阵 
\begin_inset Formula $G_{\alpha}=\partial N_{\alpha}/\partial\xi$
\end_inset

：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
L0 := 1 - Subscript[
\backslash
[Xi], 0] - Subscript[
\backslash
[Xi], 1]; L1 := Subscript[
\backslash
[Xi], 0]; L2 := Subscript[
\backslash
[Xi], 1]; dvlst = {Subscript[
\backslash
[Xi], 0], Subscript[
\backslash
[Xi], 1]}; NShapelst = { (2 L0 - 1) L0, (2 L1 - 1) L1, (2 L2 - 1) L2, 4
 L0*L1, 4 L1*L2, 4 L2*L0 }; (Grid[#, Frame -> All, FrameStyle -> Directive[Thin,
 Dashed, Orange, 5]] &@ Simplify[D[#, {dvlst}] & /@ NShapelst]) Grid[{#},
 Frame -> All, FrameStyle -> Directive[Thin, Gray, 5], Spacings -> {2, Automatic
}] &@ (Grid[#, Frame -> All, FrameStyle -> Directive[Thin, Dashed, Orange,
 5]] & /@ Simplify[D[#, {dvlst, 2}] & /@ NShapelst])
\end_layout

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{cc}
4\xi_{0}+4\xi_{1}-3 & 4\xi_{0}+4\xi_{1}-3\\
4\xi_{0}-1 & 0\\
0 & 4\xi_{1}-1\\
-4\left(2\xi_{0}+\xi_{1}-1\right) & -4\xi_{0}\\
4\xi_{1} & 4\xi_{0}\\
-4\xi_{1} & -4\left(\xi_{0}+2\xi_{1}-1\right)
\end{array}\right]
\]

\end_inset

Hessian矩阵 
\begin_inset Formula $H_{\alpha ij}=\partial^{2}N^{\alpha}/\partial\xi_{i}\partial\xi_{j}$
\end_inset

：
\begin_inset Formula 
\begin{align*}
 & \left[\begin{array}{cc}
4 & 4\\
4 & 4
\end{array}\right],\quad\left[\begin{array}{cc}
4 & 0\\
0 & 0
\end{array}\right],\quad\left[\begin{array}{cc}
0 & 0\\
0 & 4
\end{array}\right],\\
 & \left[\begin{array}{cc}
-8 & -4\\
-4 & 0
\end{array}\right],\quad\left[\begin{array}{cc}
0 & 4\\
4 & 0
\end{array}\right],\quad\left[\begin{array}{cc}
0 & -4\\
-4 & -8
\end{array}\right].
\end{align*}

\end_inset


\end_layout

\begin_layout Section
2D,quadrilateral,四边形
\end_layout

\begin_layout Standard
ref: AfirstCourse-Jacob Fish，P165，quadrilateral。
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/rectangle-ele.pdf
	scale 70

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics[{ Line[{ {-1, -1}, {1, -1}, {1, 1}, {-1, 1}, {-1,
 -1} }] , FontSize -> 13 , Text[1, {-1 - 3 delta, -1 - 3 delta}] , Text[2,
 {1 + 3 delta, -1 - 3 delta}] , Text[3, {1 + 3 delta, 1 + 3 delta}] , Text[4,
 {-1 - 3 delta, 1 + 3 delta}] } , Axes -> True, AxesOrigin -> {0, 0} , AxesStyle
 -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2"} , PlotRangePadding -> { {Scaled[.1], Scaled[.1]}, {Scaled[.1], Scaled[.1]}}
 , ImageSize -> Small ]
\end_layout

\end_inset

 
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="3">
<features tabularvalignment="bottom">
<column alignment="center" valignment="top" width="0pt">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Node 
\begin_inset Formula $I$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\xi_{I}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\eta_{I}$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-1$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $2$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-1$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $3$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $4$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $-1$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $1$
\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
在参数单元域中的节点坐标
\begin_inset CommandInset label
LatexCommand label
name "fig:7.7"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
注意在
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:7.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，每个坐标轴旁的表达式，在此坐标轴上为零。因此可以构造形函数为（例如节点
\begin_inset Formula $1$
\end_inset

 使用 2–3, 3–4 边的形函数）
\begin_inset Formula 
\[
N_{I}^{\text{4Q}}\left(\xi,\eta\right)=\frac{1}{4}\left(1+\xi_{I}\xi\right)\left(1+\eta_{I}\eta\right),
\]

\end_inset

具体形式是
\begin_inset Formula 
\begin{align*}
N^{(1)} & =\frac{1}{4}\left(1-\xi\right)\left(1-\eta\right),\\
N^{(2)} & =\frac{1}{4}\left(1+\xi\right)\left(1-\eta\right),\\
N^{(3)} & =\frac{1}{4}\left(1+\xi\right)\left(1+\eta\right),\\
N^{(4)} & =\frac{1}{4}\left(1-\xi\right)\left(1+\eta\right).
\end{align*}

\end_inset

坐标或场
\begin_inset Formula $X$
\end_inset

的插值展开为，
\begin_inset Formula 
\[
X=\sum_{j=1}^{4}X_{j}\,N_{j}^{\text{4Q}}\left(\xi,\eta\right)
\]

\end_inset


\end_layout

\begin_layout Standard
其中
\begin_inset Formula $X_{j}$
\end_inset

为节点值。
\end_layout

\begin_layout Standard
从 parent element 到 physical element 的映射为
\begin_inset Formula 
\begin{equation}
x\left(\xi,\eta\right)=\sbf N^{\text{4Q}}\left(\xi,\eta\right)\sbf x^{e},\quad y\left(\xi,\eta\right)=\sbf N^{\text{4Q}}\left(\xi,\eta\right)\sbf y^{e},\label{eq:j7.26}
\end{equation}

\end_inset

单元上的试探解 
\begin_inset Formula $\theta^{e}$
\end_inset

表示为
\begin_inset Formula 
\[
\theta^{e}\left(\xi,\eta\right)=\sbf N^{\text{4Q}}\left(\xi,\eta\right)\sbf d^{e}
\]

\end_inset

其中 
\begin_inset Formula $\sbf N^{4Q}$
\end_inset

 是形函数组成的行向量；
\begin_inset Formula $\sbf d^{e}$
\end_inset

是 
\begin_inset Formula $\theta$
\end_inset

在节点上的取值。
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\partial_{i}N_{\alpha}^{\text{4Q}}\left(\xi,\eta\right)=J_{ij}^{e,-1}\tilde{\partial}_{j}\,N_{\alpha}^{\text{4Q}}\left(\xi,\eta\right)
\]

\end_inset

其中
\begin_inset Formula $\partial_{i}=[\partial/\partial x,\partial/\partial y]$
\end_inset

，
\begin_inset Formula $\tilde{\partial}_{j}=[\partial/\partial\xi,\partial/\partial\eta]$
\end_inset

。
\end_layout

\begin_layout Example
写成矩阵符号是
\begin_inset Formula 
\[
\nabla\sbf N_{\alpha}^{\text{4Q}}=\sbf J^{e,-1}\,\tilde{\sbf\partial}\sbf N_{\alpha}^{\text{4Q}},
\]

\end_inset

其中 
\begin_inset Formula $\sbf N_{\alpha}^{\text{4Q}}$
\end_inset

 是形函数行向量，
\begin_inset Formula $\sbf G$
\end_inset

是母坐标偏导列向量
\begin_inset Formula 
\begin{equation}
\tilde{\sbf\partial}=\left[\begin{array}{c}
\partial/\partial\xi\\
\partial/\partial\eta
\end{array}\right].\label{eq:j7.34}
\end{equation}

\end_inset


\begin_inset Formula $\sbf G\sbf N_{\alpha}^{\text{4Q}}\to[2\times4]$
\end_inset

。
\begin_inset Formula 
\begin{equation}
\sbf J^{e}=\tilde{\partial}_{i}x_{j}=\tilde{\sbf\partial}\sbf N_{\alpha}^{\text{4Q}}\left[\begin{array}{cc}
\sbf x^{e} & \sbf y^{e}\end{array}\right]\label{eq:j7.36}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\sbf x^{e}$
\end_inset

，
\begin_inset Formula $\sbf y^{e}$
\end_inset

是节点坐标列向量。
\begin_inset Formula 
\[
\tilde{\sbf\partial}\sbf N_{\alpha}^{\text{4Q}}=\frac{1}{4}\left[\begin{array}{cccc}
-\left(1-\eta\right) & \left(1-\eta\right) & \left(1+\eta\right) & -\left(1+\eta\right)\\
-\left(1-\xi\right) & -\left(1+\xi\right) & \left(1+\xi\right) & \left(1-\xi\right)
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
场量梯度列向量
\begin_inset Formula 
\[
\nabla\theta^{e}=\sbf B^{e}\sbf d^{e}
\]

\end_inset

其中
\begin_inset Formula $\sbf B^{e}$
\end_inset

是形函数梯度矩阵
\begin_inset Formula $\partial_{i}N_{j}^{\text{4Q}}\rightarrow[2\times4]$
\end_inset

，
\begin_inset Formula $\sbf d^{e}$
\end_inset

是节点场量列向量 
\begin_inset Formula $[\theta_{1}^{e},\theta_{2}^{e},\theta_{3}^{e},\theta_{4}^{e}]$
\end_inset

。
\begin_inset Formula 
\begin{align}
\sbf B^{e} & =\nabla\sbf N^{\text{4Q}}=\sbf J^{e,-1}\,\sbf G\sbf N^{\text{4Q}}.\label{eq:j7.37}\\
 & =\left(\sbf G\sbf N^{\text{4Q}}.\sbf V\right)^{-1}.\sbf G\sbf N^{\text{4Q}}
\end{align}

\end_inset

其中
\begin_inset Formula $\sbf V$
\end_inset

是节点physical坐标，每组顶点坐标
\begin_inset Formula $\{x_{i},y_{i}\}$
\end_inset

放在矩阵的行上。
\end_layout

\begin_layout Example
为使映射
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j7.26"
plural "false"
caps "false"
noprefix "false"

\end_inset

在每个点上都唯一，Jacobian 行列式不能为零。此外 Jacobian的行列式应该大于零，综合起来就是
\begin_inset Formula 
\begin{equation}
\abs{\sbf J^{e}}\equiv\det\left(\sbf J^{e}\right)>0,\quad\forall e\;\text{and}\;(x,y)\label{eq:j7.38}
\end{equation}

\end_inset

可以证明，如果所有 quadrilateral 中的所有角都小于 
\begin_inset Formula $180^{\circ}$
\end_inset

，则满足以上要求（Problem 7.3）。
\end_layout

\begin_layout Subsection
derivatives
\end_layout

\begin_layout Standard
定义形函数砖块
\begin_inset Formula 
\[
L=\left[\begin{array}{c}
1+\eta\\
1-\xi\\
1-\eta\\
1+\xi
\end{array}\right],\quad\frac{\partial L}{\partial(\xi,\eta)}=\left[\begin{array}{cccc}
0 & -1 & 0 & 1\\
1 & 0 & -1 & 0
\end{array}\right]
\]

\end_inset

四边形的形函数可以写成 
\begin_inset Formula $L$
\end_inset

的乘积：
\begin_inset Formula 
\[
N_{i}^{(1)}=\frac{1}{4}L_{j}L_{k},
\]

\end_inset

其中
\begin_inset Formula $j=(i+1)\%4$
\end_inset

，
\begin_inset Formula $k=(i+2)\%4$
\end_inset

；然后使用 Leibniz 法则计算 
\begin_inset Formula $G_{i\alpha}^{(1)}$
\end_inset

。
\end_layout

\begin_layout Standard
或者直接计算：Gradient 矩阵 
\begin_inset Formula $G_{\alpha}=\partial N_{\alpha}/\partial\xi$
\end_inset

：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
L0 := 1/4 (1 - Subscript[
\backslash
[Xi], 0]) (1 - Subscript[
\backslash
[Xi], 1]); L1 := 1/4 (1 + Subscript[
\backslash
[Xi], 0]) (1 - Subscript[
\backslash
[Xi], 1]); L2 := 1/4 (1 + Subscript[
\backslash
[Xi], 0]) (1 + Subscript[
\backslash
[Xi], 1]); L3 := 1/4 (1 - Subscript[
\backslash
[Xi], 0]) (1 + Subscript[
\backslash
[Xi], 1]); dvlst = {Subscript[
\backslash
[Xi], 0], Subscript[
\backslash
[Xi], 1]}; NShapelst = {L0, L1, L2, L3}; (Grid[#, Frame -> All, FrameStyle
 -> Directive[Thin, Dashed, Orange, 5]] &@ Simplify[D[#, {dvlst}] & /@ NShapelst
]) // Print; Grid[{#}, Frame -> All, FrameStyle -> Directive[Thin, Gray,
 5], Spacings -> {2, Automatic}] &@(Grid[#, Frame -> All, FrameStyle ->
 Directive[Thin, Dashed, Orange, 5]] & /@ Simplify[D[#, {dvlst, 2}] & /@
 NShapelst]) // Print;
\end_layout

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{cc}
\frac{1}{4}\left(\xi_{1}-1\right) & \frac{1}{4}\left(\xi_{0}-1\right)\\
\frac{1}{4}\left(1-\xi_{1}\right) & \frac{1}{4}\left(-\xi_{0}-1\right)\\
\frac{1}{4}\left(\xi_{1}+1\right) & \frac{1}{4}\left(\xi_{0}+1\right)\\
\frac{1}{4}\left(-\xi_{1}-1\right) & \frac{1}{4}\left(1-\xi_{0}\right)
\end{array}\right]
\]

\end_inset

Hessian矩阵 
\begin_inset Formula $H_{\alpha ij}=\partial^{2}N^{\alpha}/\partial\xi_{i}\partial\xi_{j}$
\end_inset

：
\begin_inset Formula 
\[
\begin{array}{cccc}
\left[\begin{array}{cc}
0 & \frac{1}{4}\\
\frac{1}{4} & 0
\end{array}\right], & \left[\begin{array}{cc}
0 & -\frac{1}{4}\\
-\frac{1}{4} & 0
\end{array}\right], & \left[\begin{array}{cc}
0 & \frac{1}{4}\\
\frac{1}{4} & 0
\end{array}\right], & \left[\begin{array}{cc}
0 & -\frac{1}{4}\\
-\frac{1}{4} & 0
\end{array}\right]\end{array}
\]

\end_inset


\end_layout

\begin_layout Subsection
四边形二阶
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/rectangle-ele-o2.pdf
	scale 70

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics[{Line[{{-1, -1}, {1, -1}, {1, 1}, {-1, 1}, {-1, -1}}],
 FontSize -> 13, Text[1, {-1 - 3 delta, -1 - 3 delta}], Text[2, {1 + 3 delta,
 -1 - 3 delta}], Text[3, {1 + 3 delta, 1 + 3 delta}], Text[4, {-1 - 3 delta,
 1 + 3 delta}], Text[Style[5, Red, Medium], {0 + 3 delta, -1 + 3 delta}],
 Text[Style[6, Red, Medium], {1 - 3 delta, 0 + 3 delta}], Text[Style[7,
 Red, Medium], {0 + 3 delta, 1 - 3 delta}], Text[Style[8, Red, Medium],
 {-1 + 3 delta, 0 + 3 delta}], Text[Style["1+
\backslash
[Xi]2", Small], {0 - 4 delta, -1 - 4 delta}], Text[Style["1-
\backslash
[Xi]1", Small], {1 + 4 delta, 0 + 3 delta}], Text[Style["1-
\backslash
[Xi]2", Small], {0 + 4 delta, 1 + 4 delta}], Text[Style["1+
\backslash
[Xi]1", Small], {-1 - 4 delta, 0 + 4 delta}], }, Axes -> True, AxesOrigin
 -> {0, 0}, AxesStyle -> Arrowheads[{0.07}], AxesLabel -> {"
\backslash
[Xi]1", "
\backslash
[Xi]2"}, PlotRangePadding -> {{Scaled[.1], Scaled[.1]}, {Scaled[.1], Scaled[.1]}},
 ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Serenpidity 形函数族。Zienkiewicz 159/198。
\end_layout

\begin_layout Standard
一阶为
\begin_inset Formula 
\[
N_{a}=\frac{1}{4}\left(1+\xi_{a}\xi\right)\left(1+\eta_{a}\eta\right)
\]

\end_inset


\end_layout

\begin_layout Standard
二阶为
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
Corner nodes:
\begin_inset Formula 
\[
N_{a}=\frac{1}{4}\left(1+\xi_{a}\xi\right)\left(1+\eta_{a}\eta\right)\left(\xi_{a}\xi+\eta_{a}\eta-1\right)
\]

\end_inset

Mid–side nodes:
\begin_inset Formula 
\begin{align*}
\xi_{a}=0,\quad & N_{a}=\frac{1}{2}\left(1-\xi^{2}\right)\left(1+\eta_{a}\eta\right)\\
\eta_{a}=0,\quad & N_{a}=\frac{1}{2}\left(1+\xi_{a}\xi\right)\left(1-\eta^{2}\right)
\end{align*}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
例如 mid node 5，对应 
\begin_inset Formula $\xi_{a}=0$
\end_inset

，
\begin_inset Formula $\eta_{a}=-1$
\end_inset


\begin_inset Formula 
\[
\frac{1}{2}\left(1+\xi\right)\left(1-\xi\right)\left(1+\eta_{a}\eta\right)
\]

\end_inset

观察可知，使用了 2–3，3–4，4–1 边上的 形函数砖块。
\end_layout

\begin_layout Standard
所以 mid–side nodes 的形函数可以写成
\begin_inset Formula 
\[
N_{i}^{(2)}=\frac{1}{2}L_{k}L_{m}L_{n},
\]

\end_inset

其中
\begin_inset Formula $j=i-4$
\end_inset

（中点重编号），
\begin_inset Formula $k=(j+1)\%4$
\end_inset

，
\begin_inset Formula $m=(k+1)\%4$
\end_inset

，
\begin_inset Formula $n=(k+2)\%4$
\end_inset

。
\end_layout

\begin_layout Subsection
derivatives
\end_layout

\begin_layout Standard
类似地，形函数的导数使用 Leibniz 法则计算，先计算 中点形函数的导数。然后根据角点形函数的 trim 规则
\begin_inset Formula 
\[
N_{j}^{(2)}=N_{j}^{(1)}-\frac{1}{2}\sum_{i}N_{i}^{(2)},
\]

\end_inset

修正对应 角点的形函数。其中
\begin_inset Formula $j$
\end_inset

表示角节点，
\begin_inset Formula $\sum_{i}$
\end_inset

 对所有相邻中点
\begin_inset Formula $i$
\end_inset

进行。
\end_layout

\begin_layout Standard
或者直接计算：Gradient 矩阵 
\begin_inset Formula $G_{\alpha}=\partial N_{\alpha}/\partial\xi$
\end_inset

：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
dvlst = {Subscript[
\backslash
[Xi], 0], Subscript[
\backslash
[Xi], 1]}; NShapelst = { (1 + (-1) Subscript[
\backslash
[Xi], 0]) (1 + (-1) Subscript[
\backslash
[Xi], 1]) (Subscript[
\backslash
[Xi], 0] (-1) + Subscript[
\backslash
[Xi], 1] (-1) - 1), (1 + (1) Subscript[
\backslash
[Xi], 0]) (1 + (-1) Subscript[
\backslash
[Xi], 1]) (Subscript[
\backslash
[Xi], 0] (1) + Subscript[
\backslash
[Xi], 1] (-1) - 1), (1 + (1) Subscript[
\backslash
[Xi], 0]) (1 + (1) Subscript[
\backslash
[Xi], 1]) (Subscript[
\backslash
[Xi], 0] (1) + Subscript[
\backslash
[Xi], 1] (1) - 1), (1 + (-1) Subscript[
\backslash
[Xi], 0]) (1 + (1) Subscript[
\backslash
[Xi], 1]) (Subscript[
\backslash
[Xi], 0] (-1) + Subscript[
\backslash
[Xi], 1] (1) - 1), (1/2) (1 - Subscript[
\backslash
[Xi], 0]^2) (1 + (-1) Subscript[
\backslash
[Xi], 1]), (1/2) (1 + (1) Subscript[
\backslash
[Xi], 0]) (1 - Subscript[
\backslash
[Xi], 1]^2), (1/2) (1 - Subscript[
\backslash
[Xi], 0]^2) (1 + (1) Subscript[
\backslash
[Xi], 1]), (1/2) (1 + (-1) Subscript[
\backslash
[Xi], 0]) (1 - Subscript[
\backslash
[Xi], 1]^2) }; (Grid[#, Frame -> All, FrameStyle -> Directive[Thin, Dashed,
 Orange, 5]] &@ FullSimplify[D[#, {dvlst}] & /@ NShapelst]) // Print; Grid[{#},
 Frame -> All, FrameStyle -> Directive[Thin, Gray, 5], Spacings -> {2, Automatic
}] &@(Grid[#, Frame -> All, FrameStyle -> Directive[Thin, Dashed, Orange,
 5]] & /@ FullSimplify[D[#, {dvlst, 2}] & /@ NShapelst]) // Print;
\end_layout

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{cc}
-\left(\xi_{1}-1\right)\left(2\xi_{0}+\xi_{1}\right), & -\left(\xi_{0}-1\right)\left(\xi_{0}+2\xi_{1}\right)\\
-\left(2\xi_{0}-\xi_{1}\right)\left(\xi_{1}-1\right), & -\left(\xi_{0}+1\right)\left(\xi_{0}-2\xi_{1}\right)\\
\left(\xi_{1}+1\right)\left(2\xi_{0}+\xi_{1}\right) & \left(\xi_{0}+1\right)\left(\xi_{0}+2\xi_{1}\right)\\
\left(2\xi_{0}-\xi_{1}\right)\left(\xi_{1}+1\right) & \left(\xi_{0}-1\right)\left(\xi_{0}-2\xi_{1}\right)\\
\xi_{0}\left(\xi_{1}-1\right) & \frac{1}{2}\left(\xi_{0}^{2}-1\right)\\
\frac{1}{2}\left(1-\xi_{1}^{2}\right) & -\left(\xi_{0}+1\right)\xi_{1}\\
-\xi_{0}\left(\xi_{1}+1\right) & \frac{1}{2}\left(1-\xi_{0}^{2}\right)\\
\frac{1}{2}\left(\xi_{1}^{2}-1\right) & \left(\xi_{0}-1\right)\xi_{1}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
Hessian矩阵 
\begin_inset Formula $H_{\alpha ij}=\partial^{2}N^{\alpha}/\partial\xi_{i}\partial\xi_{j}$
\end_inset

：
\begin_inset Formula 
\[
\begin{array}{cc}
\left[\begin{array}{cc}
2-2\xi_{1} & -2\xi_{0}-2\xi_{1}+1\\
-2\xi_{0}-2\xi_{1}+1 & 2-2\xi_{0}
\end{array}\right], & \left[\begin{array}{cc}
2-2\xi_{1} & -2\xi_{0}+2\xi_{1}-1\\
-2\xi_{0}+2\xi_{1}-1 & 2\left(\xi_{0}+1\right)
\end{array}\right],\end{array}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\begin{array}{cc}
\left[\begin{array}{cc}
2\left(\xi_{1}+1\right) & 2\xi_{0}+2\xi_{1}+1\\
2\xi_{0}+2\xi_{1}+1 & 2\left(\xi_{0}+1\right)
\end{array}\right], & \left[\begin{array}{cc}
2\left(\xi_{1}+1\right) & 2\xi_{0}-2\xi_{1}-1\\
2\xi_{0}-2\xi_{1}-1 & 2(1-\xi_{0})
\end{array}\right]\end{array}
\]

\end_inset


\begin_inset Formula 
\[
\begin{array}{cccc}
\left[\begin{array}{cc}
\xi_{1}-1 & \xi_{0}\\
\xi_{0} & 0
\end{array}\right], & \left[\begin{array}{cc}
0 & -\xi_{1}\\
-\xi_{1} & -\xi_{0}-1
\end{array}\right], & \left[\begin{array}{cc}
-\xi_{1}-1 & -\xi_{0}\\
-\xi_{0} & 0
\end{array}\right], & \left[\begin{array}{cc}
0 & \xi_{1}\\
\xi_{1} & \xi_{0}-1
\end{array}\right]\end{array}
\]

\end_inset


\end_layout

\begin_layout Subsection
math remark
\end_layout

\begin_layout Standard
对于四边形，长宽分别为
\begin_inset Formula $2a$
\end_inset

，
\begin_inset Formula $2b$
\end_inset

。可以先定义局部坐标（原点在矩阵中心）
\begin_inset Formula 
\[
x'=x-x_{0},\quad\text{and}\quad y'=y-y_{0}
\]

\end_inset

 其中
\begin_inset Formula 
\[
x_{0}=\frac{1}{4}\sum_{a=1}^{4}y_{a}\quad\text{and}\quad y_{0}=\frac{1}{4}\sum_{a=1}^{4}x_{a}
\]

\end_inset

We now need four functions for each displacement component in order to uniquely
 define the shape functions.
 In addition these functions must have linear behavior along each edge of
 the element to ensure interelement C0 continuity.
 A suitable choice is given by
\begin_inset Formula 
\[
\hat{\phi}^{e}=\alpha_{1}+\alpha_{2}x'+\alpha_{3}y'+\alpha_{4}x'y'
\]

\end_inset


\begin_inset Formula 
\[
\left(\begin{array}{c}
\tilde{\phi}_{1}^{e}\\
\tilde{\phi}_{2}^{e}\\
\tilde{\phi}_{3}^{e}\\
\tilde{\phi}_{4}^{e}
\end{array}\right)=\left[\begin{array}{cccc}
1 & -a & -b & ab\\
1 & a & -b & -ab\\
1 & a & b & ab\\
1 & -a & b & -ab
\end{array}\right]\left(\begin{array}{c}
\alpha_{1}\\
\alpha_{2}\\
\alpha_{3}\\
\alpha_{4}
\end{array}\right)
\]

\end_inset

同样的，可以反解出系数
\begin_inset Formula $\alpha_{1}\sim\alpha_{4}$
\end_inset

。
\end_layout

\begin_layout Subsection
四边形特征参数
\end_layout

\begin_layout Standard
四边形具有各种不同的形状。现定义两个无量纲参数
\begin_inset Formula $g_{1}$
\end_inset

和
\begin_inset Formula $g_{2}$
\end_inset

作为四边形的形状特征参数
\begin_inset Formula 
\[
g_{1}=\frac{A(\Delta124)}{A},\quad g_{2}=\frac{A(\Delta123)}{A},
\]

\end_inset

其中
\begin_inset Formula $A$
\end_inset

表示四边形面积，
\begin_inset Formula $A(\Delta124)$
\end_inset

和
\begin_inset Formula $A(\Delta123)$
\end_inset

分别表示
\begin_inset Formula $\Delta124$
\end_inset

和
\begin_inset Formula $\Delta123$
\end_inset

的三角形面积。换句话说，由
\begin_inset Formula $g_{1}$
\end_inset

可以确定对角线
\begin_inset Formula $24$
\end_inset

两侧三角形面积之比，由
\begin_inset Formula $g_{2}$
\end_inset

可确定对角线
\begin_inset Formula $13$
\end_inset

两侧三角形面积之比。
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/quadrilateral.png
	scale 65

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Formula $g_{1}$
\end_inset

和
\begin_inset Formula $g_{2}$
\end_inset

的定义
\end_layout

\end_inset


\end_layout

\end_inset

对于凸形四边形，
\begin_inset Formula $g_{1}$
\end_inset

和
\begin_inset Formula $g_{2}$
\end_inset

的取值范围是
\begin_inset Formula 
\[
0<g_{1}<1,\quad0<g_{2}<1
\]

\end_inset


\end_layout

\begin_layout Standard
令四边形的坐标分别为
\begin_inset Formula $X_{i}=[x_{i},y_{i}]$
\end_inset

，
\begin_inset Formula $i\in[1,4]$
\end_inset

， 
\begin_inset Formula 
\[
\left[\begin{array}{cccc}
X_{1} & X_{2} & X_{3} & X_{4}\end{array}\right]\left[\begin{array}{c}
1-g_{1}\\
-(1-g_{2})\\
g_{1}\\
-g_{2}
\end{array}\right]=\left[\begin{array}{c}
0\\
0
\end{array}\right]
\]

\end_inset

给定基三角形
\begin_inset Formula $\Delta123$
\end_inset

以及参数
\begin_inset Formula $g_{1}$
\end_inset

，
\begin_inset Formula $g_{2}$
\end_inset

，可以唯一确定四边形。
\end_layout

\begin_layout Subsection
四边形面积坐标
\end_layout

\begin_layout Standard
四边形内任一点
\begin_inset Formula $P$
\end_inset

的面积坐标
\begin_inset Formula $\{L_{i}\},i=1,\cdots,4$
\end_inset

定义为
\begin_inset Formula 
\begin{equation}
L_{i}=\frac{A_{i}}{A},\quad i=1,\cdots,4\label{eq:l18}
\end{equation}

\end_inset

其中
\begin_inset Formula $A_{i}$
\end_inset

是由
\begin_inset Formula $P$
\end_inset

点分别与四边形单元的各边组成的四个三角形的面积。显然四边形单元各边的方程为
\begin_inset Formula 
\[
L_{i}=0,\quad i=1,\cdots,4
\]

\end_inset

四个节点的面积坐标为
\begin_inset Formula 
\begin{align*}
 & \left(g_{2},1-g_{2},0,0\right)\\
 & \left(0,1-g_{1},g_{1},0\right)\\
 & \left(0,0,1-g_{2},g_{2}\right)\\
 & \left(1-g_{1},0,0,g_{1}\right)
\end{align*}

\end_inset

对角线交点的坐标为
\begin_inset Formula 
\begin{equation}
g_{2}(1-g_{1}),\quad(1-g_{1})(1-g_{2}),\quad(1-g_{2})g_{1},\quad g_{1}g_{2}\label{eq:l21}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/Q4_ele_2.png
	lyxscale 85
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
四边形面积坐标的定义
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
直角坐标 To 面积坐标
\end_layout

\begin_layout Standard
使用行列式求出三角形面积 
\begin_inset Formula $A_{i}$
\end_inset

：
\begin_inset Formula 
\begin{align}
 & A_{1}=\frac{1}{2}\left|\begin{array}{ccc}
1 & x & y\\
1 & x_{2} & y_{2}\\
1 & x_{3} & y_{3}
\end{array}\right|,\quad A_{2}=\frac{1}{2}\left|\begin{array}{ccc}
1 & x & y\\
1 & x_{3} & y_{3}\\
1 & x_{4} & y_{4}
\end{array}\right|\nonumber \\
 & A_{3}=\frac{1}{2}\left|\begin{array}{ccc}
1 & x & y\\
1 & x_{4} & y_{4}\\
1 & x_{1} & y_{1}
\end{array}\right|,\quad A_{4}=\frac{1}{2}\left|\begin{array}{ccc}
1 & x & y\\
1 & x_{1} & y_{1}\\
1 & x_{2} & y_{2}
\end{array}\right|\label{eq:l22}
\end{align}

\end_inset

代入
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:l18"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到面积坐标用直角坐标表示的坐标变换式：
\begin_inset Formula 
\[
L_{i}=\frac{1}{2A}\left(a_{i}+b_{i}x+c_{i}y\right),\quad i\in[1,4]
\]

\end_inset

式中
\begin_inset Formula 
\begin{align*}
 & a_{1}=x_{2}y_{3}-x_{3}y_{2},\\
 & b_{1}=y_{2}-y_{3},\\
 & c_{1}=x_{3}-x_{2}
\end{align*}

\end_inset

代入适当的置换，可得出其余各式
\begin_inset Formula 
\begin{align*}
 & a_{1}\rightarrow\{2,3\},\quad a_{2}\rightarrow\{3,4\}\\
 & a_{3}\rightarrow\{4,1\},\quad a_{4}\rightarrow\{1,2\}
\end{align*}

\end_inset


\end_layout

\begin_layout Example
直角坐标 To 特征参数
\end_layout

\begin_layout Standard
\begin_inset Formula $g_{1}$
\end_inset

，
\begin_inset Formula $g_{2}$
\end_inset

与
\begin_inset Formula $b_{i}$
\end_inset

，
\begin_inset Formula $c_{i}$
\end_inset

的关系。从面积–行列式关系得到 
\begin_inset Formula $2Ag_{1}=b_{3}c_{4}-b_{4}c_{3}$
\end_inset

，通过指标置换得到
\begin_inset Formula 
\begin{align}
2Ag_{1} & =b_{3}c_{4}-b_{4}c_{3}\nonumber \\
2Ag_{2} & =b_{4}c_{1}-b_{1}c_{4}\nonumber \\
2A(1-g_{1}) & =b_{1}c_{2}-b_{2}c_{1}\nonumber \\
2A(1-g_{2}) & =b_{2}c_{3}-b_{3}c_{2}\label{eq:l27}
\end{align}

\end_inset

以及
\begin_inset Formula 
\begin{align}
2A(1-g_{1}-g_{2}) & =b_{3}c_{1}-b_{1}c_{3}\nonumber \\
2A(g_{2}-g_{1}) & =b_{2}c_{4}-b_{4}c_{2}\nonumber \\
2A & =(b_{3}c_{4}-b_{4}c_{3})+(b_{1}c_{2}-b_{2}c_{1})\nonumber \\
 & =(b_{4}c_{1}-b_{1}c_{4})+(b_{2}c_{3}-b_{3}c_{2})\nonumber \\
 & =\frac{1}{2}\left[(b_{1}-b_{3})(c_{2}-c_{4})-(b_{2}-b_{4})(c_{1}-c_{3})\right]\label{eq:l28}
\end{align}

\end_inset


\end_layout

\begin_layout Subsection
系数恒等式
\end_layout

\begin_layout Example
\begin_inset Formula $a_{i}$
\end_inset

，
\begin_inset Formula $b_{i}$
\end_inset

，
\begin_inset Formula $c_{i}$
\end_inset

满足下列等式。令
\begin_inset Formula $v_{i}=[a_{i},b_{i},c_{i}]$
\end_inset


\begin_inset Formula 
\begin{equation}
\sum_{i=1}^{4}v_{i}=\left[\begin{array}{c}
2A\\
0\\
0
\end{array}\right]\label{eq:l25}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
\left[\begin{array}{cccc}
v_{1} & v_{2} & v_{3} & v_{4}\end{array}\right]\left[\begin{array}{c}
g_{1}(1-g_{2})\\
-g_{1}g_{2}\\
g_{2}(1-g_{1})\\
-(1-g_{1})(1-g_{2})
\end{array}\right]=\left[\begin{array}{c}
0\\
0\\
0
\end{array}\right]\label{eq:l26}
\end{equation}

\end_inset


\begin_inset Formula $v_{i}$
\end_inset

的系数刚好是对角线交点的坐标。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
面积坐标的两个恒等式
\begin_inset Formula 
\begin{align}
 & L_{1}+L_{2}+L_{3}+L_{4}=1\label{eq:l29}\\
 & \left[\begin{array}{cccc}
L_{1} & L_{2} & L_{3} & L_{4}\end{array}\right]\left[\begin{array}{c}
g_{1}(1-g_{2})\\
-g_{1}g_{2}\\
g_{2}(1-g_{1})\\
-(1-g_{1})(1-g_{2})
\end{array}\right]=0\label{eq:l30}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
独立面积坐标：可以取相邻的两个坐标作为独立坐标，例如
\begin_inset Formula $(L_{1},L_{2})$
\end_inset


\begin_inset Formula 
\begin{align}
 & L_{3}=(1-g_{2})-\frac{1-g_{2}}{1-g_{1}}L_{1}-\frac{1-g_{1}-g_{2}}{1-g_{1}}L_{2}\nonumber \\
 & L_{4}=g_{2}+\frac{g_{1}-g_{2}}{1-g_{1}}L_{1}-\frac{g_{2}}{1-g_{1}}L_{2}\label{eq:l31}
\end{align}

\end_inset


\end_layout

\begin_layout Subsection
四边形积分公式
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\iint_{A}L_{1}^{m}\,L_{2}^{n}\,L_{3}^{p}\,L_{4}^{q}\,\dd{A} & =\frac{m!n!p!q!}{(m+n+p+q+2)!}2A\times\\
 & \Big[(1-g_{1})^{m+n+1}\sum_{k=0}^{q}\sum_{j=0}^{p}C_{m+q-k}^{m}C_{n+p-j}^{n}C_{k+j}^{k}g_{2}^{k}\left(1-g_{2}\right)^{j}g_{1}^{p+q-k-j}\\
 & +g_{1}^{p+q+1}\sum_{k=0}^{m}\sum_{j=0}^{n}C_{m+q-k}^{q}C_{n+p-j}^{p}C_{k+j}^{k}g_{2}^{k}\left(1-g_{2}\right)^{j}\left(1-g_{1}\right)^{m+n-k-j}\Big]
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\iint_{A}L_{1}^{m}\,L_{2}^{n}\,L_{3}^{p}\,L_{4}^{q}\,\dd{A} & =\frac{m!n!p!q!}{(m+n+p+q+2)!}2A\times\\
 & \Big[(1-g_{2})^{n+p+1}\sum_{k=0}^{m}\sum_{j=0}^{q}C_{n+m-k}^{n}C_{p+q-j}^{p}C_{k+j}^{k}\,\overline{g_{1}}^{k}\,g_{1}^{j}\,g_{2}^{m+q-k-j}\\
 & +g_{2}^{m+q+1}\sum_{k=0}^{n}\sum_{j=0}^{p}C_{m+n-k}^{m}C_{q+p-j}^{q}C_{k+j}^{k}\,\overline{g_{1}}^{k}\,g_{1}^{j}\,\overline{g_{2}}^{n+p-k-j}\Big]
\end{align*}

\end_inset

其中
\begin_inset Formula 
\[
C_{k}^{j}=\frac{k!}{\left(k-i\right)!i!}
\]

\end_inset


\end_layout

\begin_layout Subsection
等参坐标 To 面积坐标
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
 & L_{1}=\frac{1}{4}\left(1-\xi\right)\left[g_{2}\left(1-\eta\right)+\overline{g_{1}}\left(1+\eta\right)\right]\\
 & L_{2}=\frac{1}{4}\left(1-\eta\right)\left[\overline{g_{2}}\left(1-\xi\right)+\overline{g_{1}}\left(1+\xi\right)\right]\\
 & L_{3}=\frac{1}{4}\left(1+\xi\right)\left[g_{1}\left(1-\eta\right)+\overline{g_{2}}\left(1+\eta\right)\right]\\
 & L_{4}=\frac{1}{4}\left(1+\eta\right)\left[g_{1}\left(1-\xi\right)+g_{2}\left(1+\xi\right)\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Section
3D,Tetrahedron,四面体
\end_layout

\begin_layout Standard
\align left
\begin_inset Graphics
	filename inset/tetrahedron-ele.pdf
	lyxscale 50
	scale 55

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics3D[{ Line[{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}, {1, 0,
 0}}], Line[{{1, 0, 0}, {0, 0, 0}, {0, 1, 0}}], Line[{{0, 0, 1}, {0, 0,
 0}}], , FontSize -> 13 , Text[1, {1 + 3 delta, 2 delta, 0}] , Text[2, {2
 delta, 1 + 3 delta, 0}] , Text[3, {2 delta, 2 delta, 1 + 3 delta}] , Text[4,
 {+3 delta, -delta, +3 delta}] } , Axes -> True, AxesOrigin -> {0, 0, 0}
 , AxesStyle -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2", "
\backslash
[Xi]_3"} , PlotRangePadding -> {Scaled[.1], Scaled[.1], Scaled[.1]} , ImageSize
 -> Medium , Boxed -> False ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
三维 四面体有限元 四个顶点的一阶 形函数定义为：
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{V_{1}}{V^{e}},\quad N_{2}^{(1)}=\frac{V_{2}}{V^{e}},\quad N_{3}^{(1)}=\frac{V_{3}}{V^{e}},\quad N_{4}^{(1)}=\frac{V_{4}}{V^{e}},
\]

\end_inset

其中
\begin_inset Formula 
\[
V^{e}=\frac{1}{6}\det\left[\begin{array}{cccc}
1 & x_{1}^{e} & y_{1}^{e} & z_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e} & z_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e} & z_{3}^{e}\\
1 & x_{4}^{e} & y_{4}^{e} & z_{4}^{e}
\end{array}\right]
\]

\end_inset

仿照二维情况，可以计算出 
\begin_inset Formula $V_{i}$
\end_inset

。例如
\begin_inset Formula 
\[
V_{1}=\frac{1}{6}\det\left[\begin{array}{cccc}
1 & x & y & z\\
1 & x_{2}^{e} & y_{2}^{e} & z_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e} & z_{3}^{e}\\
1 & x_{4}^{e} & y_{4}^{e} & z_{4}^{e}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Example
三维形函数 母坐标取值范围 
\begin_inset Formula $\xi,\eta,\zeta\in\left[0,1\right]$
\end_inset

，一阶形函数可以用 母坐标表示为：
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(1)}=1-\xi-\eta-\zeta\\
 & N_{2}^{(1)}=\xi\\
 & N_{3}^{(1)}=\eta\\
 & N_{4}^{(1)}=\zeta
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
母坐标 和 空间坐标 之间的变换关系，正变换为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
1\\
x\\
y\\
z
\end{array}\right]=\left[\begin{array}{cccc}
1 & 1 & 1 & 1\\
x_{1} & x_{2} & x_{3} & x_{4}\\
y_{1} & y_{2} & y_{3} & y_{4}\\
z_{1} & z_{2} & z_{3} & z_{4}
\end{array}\right]\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right],\quad\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right]=\left[\begin{array}{c}
1-\xi-\eta-\zeta\\
\xi\\
\eta\\
\zeta
\end{array}\right]
\]

\end_inset

这里按照常用的记号约定，也引入了 
\begin_inset Formula $L_{i}^{e}$
\end_inset

 表示 母坐标。对应的 逆变换 为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right]=\frac{1}{\det\left[J\right]}\left[\begin{array}{cccc}
a_{1} & b_{1} & c_{1} & d_{1}\\
a_{2} & b_{2} & c_{2} & d_{2}\\
a_{3} & b_{3} & c_{3} & d_{3}\\
a_{4} & b_{4} & c_{4} & d_{4}
\end{array}\right]\left[\begin{array}{c}
1\\
x\\
y\\
z
\end{array}\right]
\]

\end_inset

简记为：
\begin_inset Formula 
\begin{align*}
 & X_{\alpha}=T_{\alpha\beta}L_{\beta},\\
 & L_{\alpha}=T_{\alpha\beta}^{-1}X_{\beta}
\end{align*}

\end_inset

其中 
\begin_inset Formula $X=\left(1,x,y,z\right),$
\end_inset


\begin_inset Formula $L=\left(1-\xi-\eta-\zeta,\xi,\eta,\zeta\right)$
\end_inset

。
\end_layout

\begin_layout Example
其中各系数的值为：
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
b_{1} & c_{1} & d_{1}\\
b_{2} & c_{2} & d_{2}\\
b_{3} & c_{3} & d_{3}\\
b_{4} & c_{4} & d_{4}
\end{array}\right]=\left[\begin{array}{ccc}
y_{42}z_{32}-y_{32}z_{42} & x_{32}z_{42}-x_{42}z_{32} & x_{42}y_{32}-x_{32}y_{42}\\
y_{31}z_{43}-y_{34}z_{13} & x_{43}z_{31}-x_{31}z_{43} & x_{31}y_{43}-x_{43}y_{31}\\
y_{24}z_{14}-y_{14}z_{24} & x_{14}z_{24}-x_{24}z_{14} & x_{24}y_{14}-x_{14}y_{24}\\
y_{13}z_{21}-y_{21}z_{13} & x_{21}z_{13}-x_{13}z_{21} & x_{13}y_{21}-x_{21}y_{13}
\end{array}\right]
\]

\end_inset


\begin_inset Formula $T$
\end_inset

 的第一列的值为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
a_{1}\\
a_{2}\\
a_{3}\\
a_{4}
\end{array}\right]=\left[\begin{array}{c}
x_{2}\left(y_{3}z_{4}-y_{4}z_{3}\right)+x_{3}\left(y_{4}z_{2}-y_{2}z_{4}\right)+x_{4}\left(y_{2}z_{3}-y_{3}z_{2}\right)\\
x_{1}\left(y_{4}z_{3}-y_{3}z_{4}\right)+x_{3}\left(y_{1}z_{4}-y_{4}z_{1}\right)+x_{4}\left(y_{3}z_{1}-y_{1}z_{3}\right)\\
x_{1}\left(y_{2}z_{4}-y_{4}z_{2}\right)+x_{2}\left(y_{4}z_{1}-y_{1}z_{4}\right)+x_{4}\left(y_{1}z_{2}-y_{2}z_{1}\right)\\
x_{1}\left(y_{3}z_{2}-y_{2}z_{3}\right)+x_{2}\left(y_{1}z_{3}-y_{3}z_{1}\right)+x_{3}\left(y_{2}z_{1}-y_{1}z_{2}\right)
\end{array}\right]
\]

\end_inset


\begin_inset Formula 
\[
\det\left[J\right]=6V^{e}=x_{21}\left(y_{23}z_{34}-y_{34}z_{23}\right)+x_{32}\left(y_{34}z_{12}-y_{12}z_{34}\right)+x_{43}\left(y_{12}z_{23}-y_{23}z_{12}\right).
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
由坐标的逆变换矩阵，可以计算形函数的梯度
\begin_inset Formula 
\[
\left[\begin{array}{c}
\nabla L_{1}^{e}\\
\nabla L_{2}^{e}\\
\nabla L_{3}^{e}\\
\nabla L_{4}^{e}
\end{array}\right]=\frac{1}{\det\left[J\right]}\left[\begin{array}{ccc}
b_{1} & c_{1} & d_{1}\\
b_{2} & c_{2} & d_{2}\\
b_{3} & c_{3} & d_{3}\\
b_{4} & c_{4} & d_{4}
\end{array}\right]\left[\begin{array}{c}
\sbf e_{x}\\
\sbf e_{y}\\
\sbf e_{z}
\end{array}\right]
\]

\end_inset

约定：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $M=\left[b_{i},c_{i},d_{i}\right]$
\end_inset

矩阵；希腊字母表示
\begin_inset Formula $\{1,2,3,4\}$
\end_inset

，对应节点数；
\end_layout

\begin_layout Enumerate
拉丁字母表示 
\begin_inset Formula $\{1,2,3\}$
\end_inset

，对应三维空间坐标
\begin_inset Formula $x,y,z$
\end_inset

：
\end_layout

\begin_layout Standard
则 
\begin_inset Formula $\nabla L^{e}$
\end_inset

 的各分量形式为：
\begin_inset Formula 
\begin{equation}
\partial_{i}L_{\alpha}^{e}=\frac{1}{\det\left[J\right]}{\color{blue}M_{\alpha i}}\label{eq:shapeGrad}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
derivatives
\end_layout

\begin_layout Standard
Gradient
\begin_inset Formula $G_{\alpha j}=\partial N_{\alpha}/\partial\xi_{j}$
\end_inset

 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
L0 := 1 - Subscript[
\backslash
[Xi], 0] - Subscript[
\backslash
[Xi], 1] - Subscript[
\backslash
[Xi], 2]; L1 := Subscript[
\backslash
[Xi], 0]; L2 := Subscript[
\backslash
[Xi], 1]; L3 := Subscript[
\backslash
[Xi], 2]; dvlst = {Subscript[
\backslash
[Xi], 0], Subscript[
\backslash
[Xi], 1], Subscript[
\backslash
[Xi], 2]}; NShapelst = {L0 (2 L0 - 1), L1 (2 L1 - 1), L2 (2 L2 - 1), L3
 (2 L3 - 1), 4 L1*L0, 4 L2*L0, 4 L3*L0, 4 L1*L2, 4 L2*L3, 4 L3*L1}; (Grid[#,
 Frame -> All, FrameStyle -> Directive[Thin, Dashed, Orange, 5]] &@ FullSimplify
[D[#, {dvlst}] & /@ NShapelst]) // Print;
\end_layout

\begin_layout Plain Layout
Grid[{#}, Frame -> All, FrameStyle -> Directive[Thin, Gray, 5], Spacings
 -> {2, Automatic}] &@(Grid[#, Frame -> All, FrameStyle -> Directive[Thin,
 Dashed, Orange, 5]] & /@ Simplify[D[#, {dvlst, 2}] & /@ NShapelst]) //
 Print;
\end_layout

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{ccc}
-1 & -1 & -1\\
1 & 0 & 0\\
0 & 1 & 0\\
0 & 0 & 1
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
Hessian Matrix 
\begin_inset Formula $H_{\alpha ij}=\frac{\partial^{2}N_{\alpha}}{\partial\xi_{i}\partial\xi_{j}}$
\end_inset


\begin_inset Formula 
\[
\left[0\right]_{3\times3},\quad\left[0\right]_{3\times3},\quad\left[0\right]_{3\times3},\quad\left[0\right]_{3\times3}
\]

\end_inset


\end_layout

\begin_layout Subsection
四面体二阶
\end_layout

\begin_layout Standard
\align left
\begin_inset Graphics
	filename inset/tetrahedron-ele-o2.pdf
	lyxscale 80
	scale 55

\end_inset

使用IBE中的邻接关系约定
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; (fig = Graphics3D[{Line[{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}, {1,
 0, 0}}], Line[{{1, 0, 0}, {0, 0, 0}, {0, 1, 0}}], Line[{{0, 0, 1}, {0,
 0, 0}}], FontSize -> 13, Text[Style[0, Black, Medium], {1 + 2 delta, 2
 delta, 0}], Text[Style[1, Black, Medium], {2 delta, 1 + 2 delta, 0}], Text[Styl
e[2, Black, Medium], {2 delta, 2 delta, 1 + 1 delta}], Text[Style[3, Black,
 Medium], {+2 delta, -delta, +2 delta}],(*mid-side nodes*) Text[Style[4,
 Red, Medium], {.5 + 1 delta, .5 + 1 delta, 0}], Text[Style[6, Red, Medium],
 {.5 + 1 delta, 0, .5 + 1 delta}], Text[ Style[7, Red, Medium], {.5 + 0 delta,
 0 + 1 delta, 0 + 0 delta}], Text[ Style[5, Red, Medium], {0 + 0 delta,
 .5 + 1 delta, .5 + 1 delta}], Text[ Style[9, Red, Medium], {0 + 0 delta,
 0 + 1 delta, .5 + 0 delta}], Text[ Style[8, Red, Medium], {0 - 2 delta,
 0.5 + 0 delta, 0 + 0 delta}]}, Axes -> True, AxesOrigin -> {0, 0, 0}, AxesStyle
 -> Arrowheads[{0.07}], AxesLabel -> {"
\backslash
[Xi]1", "
\backslash
[Xi]2", "
\backslash
[Xi]3"}, PlotRangePadding -> {Scaled[.1], Scaled[.1], Scaled[.1]}, Ticks ->
 Automatic, TicksStyle -> Directive[Orange, 6], ImageSize -> Medium, Boxed
 -> False, ViewPoint -> {3, 1, 1}]) // Print; Export["C:/Users/yd/note/FiniteEM/
inset/tetrahedron-ele-o2.pdf", fig];
\end_layout

\end_inset


\end_layout

\begin_layout Standard
高阶单元用类似于三角形的方法推导，即建立适当的 Lagrange–type 公式，类似6.7，结果是
\begin_inset Formula 
\[
N_{a}=\ell_{I}^{I}(L_{0})\,\ell_{J}^{J}(L_{1})\,\ell_{K}^{K}(L_{2})\,\ell_{L}^{L}(L_{3}),\quad\text{with}\;I+J+K+L=M
\]

\end_inset

其中
\begin_inset Formula $L_{1}\sim L_{4}$
\end_inset

是母坐标分量。插值中使用的控制点，选取 
\begin_inset Formula $(I,J,K)$
\end_inset

 周围的节点，例如上图中节点
\begin_inset Formula $4$
\end_inset

 周围的是节点
\begin_inset Formula $\{0,1\}$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
其中使用了拉格朗日插值项（在
\begin_inset Formula $L_{a}$
\end_inset

为
\begin_inset Formula $1$
\end_inset

，在其他点为
\begin_inset Formula $0$
\end_inset

）
\begin_inset Formula 
\begin{align*}
\ell_{a}^{p}(L) & =\prod_{\begin{subarray}{c}
b=1\\
b\neq a
\end{subarray}}^{n}\frac{(L-L_{b})}{(L_{a}-L_{b})}\\
 & =\frac{(L-L_{1})(L-L_{2})(\cdots)(L-L_{a-1})(L-L_{a+1})(\cdots)(L-L_{n})}{(L_{a}-L_{1})(L_{a}-L_{2})(\cdots)(L_{a}-L_{a-1})(L_{a}-L_{a+1})(\cdots)(L_{a}-L_{n})}
\end{align*}

\end_inset

多项式的阶数为
\begin_inset Formula $p=n-1$
\end_inset

。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
其中
\begin_inset Formula $M$
\end_inset

是 tetrahedron 的 order，符号
\begin_inset Formula $L_{a}$
\end_inset

表示母坐标
\begin_inset Formula 
\[
L_{a}=\frac{V_{a}}{V},\quad a=0,1,2,3
\]

\end_inset

在母坐标下
\begin_inset Formula 
\[
L_{a}=\left[\begin{array}{cccc}
1-\xi_{0}-\xi_{1}-\xi_{2}, & \xi_{0}, & \xi_{1}, & \xi_{2}\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
Corner nodes：
\begin_inset Formula 
\[
N_{a}=L_{a}(2L_{a}-1),\quad a=0,1,2,3
\]

\end_inset

Mid–edge nodes:
\begin_inset Formula 
\begin{align*}
 & N_{4}=4L_{1}L_{0},\quad N_{5}=4L_{2}L_{0},\quad N_{6}=4L_{3}L_{0}\\
 & N_{7}=4L_{1}L_{2},\quad N_{8}=4L_{2}L_{3},\quad N_{9}=4L_{3}L_{1}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
derivatives
\end_layout

\begin_layout Standard
Gradient
\begin_inset Formula $G_{\alpha j}=\partial N_{\alpha}/\partial\xi_{j}$
\end_inset

 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
L0 := 1 - Subscript[
\backslash
[Xi], 0] - Subscript[
\backslash
[Xi], 1] - Subscript[
\backslash
[Xi], 2]; L1 := Subscript[
\backslash
[Xi], 0]; L2 := Subscript[
\backslash
[Xi], 1]; L3 := Subscript[
\backslash
[Xi], 2]; dvlst = {Subscript[
\backslash
[Xi], 0], Subscript[
\backslash
[Xi], 1], Subscript[
\backslash
[Xi], 2]}; NShapelst = { L0 (2 L0 - 1), L1 (2 L1 - 1), L2 (2 L2 - 1), L3
 (2 L3 - 1), (*-----------------*) 4 L1*L0, 4 L1*L2, 4 L2*L0, 4 L3*L0, 4
 L3*L1, 4 L2*L3 }; (Grid[#, Frame -> All, FrameStyle -> Directive[Thin,
 Dashed, Orange, 5]] &@ FullSimplify[D[#, {dvlst}] & /@ NShapelst]) // Print;
\end_layout

\begin_layout Plain Layout
Grid[{#}, Frame -> All, FrameStyle -> Directive[Thin, Gray, 5], Spacings
 -> {2, Automatic}] &@(Grid[#, Frame -> All, FrameStyle -> Directive[Thin,
 Dashed, Orange, 5]] & /@ Simplify[D[#, {dvlst, 2}] & /@ NShapelst]) //
 Print;
\end_layout

\end_inset

（使用IBE中约定的中点邻接关系）
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
4\xi_{0}+4\xi_{1}+4\xi_{2}-3 & 4\xi_{0}+4\xi_{1}+4\xi_{2}-3 & 4\xi_{0}+4\xi_{1}+4\xi_{2}-3\\
4\xi_{0}-1 & 0 & 0\\
0 & 4\xi_{1}-1 & 0\\
0 & 0 & 4\xi_{2}-1\\
-4\left(2\xi_{0}+\xi_{1}+\xi_{2}-1\right) & -4\xi_{0} & -4\xi_{0}\\
4\xi_{1} & 4\xi_{0} & 0\\
-4\xi_{1} & -4\left(\xi_{0}+2\xi_{1}+\xi_{2}-1\right) & -4\xi_{1}\\
-4\xi_{2} & -4\xi_{2} & -4\left(\xi_{0}+\xi_{1}+2\xi_{2}-1\right)\\
4\xi_{2} & 0 & 4\xi_{0}\\
0 & 4\xi_{2} & 4\xi_{1}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
Hessian Matrix 
\begin_inset Formula $H_{\alpha ij}=\frac{\partial^{2}N_{\alpha}}{\partial\xi_{i}\partial\xi_{j}}$
\end_inset


\begin_inset Formula 
\[
\begin{array}{cccc}
\left(\begin{array}{ccc}
4 & 4 & 4\\
4 & 4 & 4\\
4 & 4 & 4
\end{array}\right), & \left(\begin{array}{ccc}
4 & 0 & 0\\
0 & 0 & 0\\
0 & 0 & 0
\end{array}\right), & \left(\begin{array}{ccc}
0 & 0 & 0\\
0 & 4 & 0\\
0 & 0 & 0
\end{array}\right), & \left(\begin{array}{ccc}
0 & 0 & 0\\
0 & 0 & 0\\
0 & 0 & 4
\end{array}\right)\end{array}
\]

\end_inset


\begin_inset Formula 
\[
\begin{array}{ccc}
\left(\begin{array}{ccc}
-8 & -4 & -4\\
-4 & 0 & 0\\
-4 & 0 & 0
\end{array}\right), & \left(\begin{array}{ccc}
0 & 4 & 0\\
4 & 0 & 0\\
0 & 0 & 0
\end{array}\right), & \left(\begin{array}{ccc}
0 & -4 & 0\\
-4 & -8 & -4\\
0 & -4 & 0
\end{array}\right)\end{array}
\]

\end_inset


\begin_inset Formula 
\[
\begin{array}{ccc}
\left(\begin{array}{ccc}
0 & 0 & -4\\
0 & 0 & -4\\
-4 & -4 & -8
\end{array}\right), & \left(\begin{array}{ccc}
0 & 0 & 4\\
0 & 0 & 0\\
4 & 0 & 0
\end{array}\right), & \left(\begin{array}{ccc}
0 & 0 & 0\\
0 & 0 & 4\\
0 & 4 & 0
\end{array}\right)\end{array}
\]

\end_inset


\end_layout

\begin_layout Section
3D,Wedge, 三棱柱,楔形
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/wedge-ele.pdf
	lyxscale 80
	scale 60

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\backslash
[Delta] = 0.01; sty = Style[#, Red, 14] &; n0 = {0, 0, -1}; n1 = {1, 0, -1};
 n2 = {0, 1, -1}; n3 = {0, 0, 1}; n4 = {1, 0, 1}; n5 = {0, 1, 1}; list1
 = {n0, n1, n2, n0}; list2 = {n3, n4, n5}; list3 = {n0, n3, n5, n2}; list4
 = {n1, n2, n5, n4, n1}; Graphics3D[{ Line[list1], Line[list2], Line[list3],
 Line[list4] , sty@Text[0, n0 - 3 
\backslash
[Delta]], sty@Text[1, n1 + 3 
\backslash
[Delta]], sty@Text[2, n2 + 3 
\backslash
[Delta]] , sty@Text[3, n3 - 3 
\backslash
[Delta]], sty@Text[4, n4 + 3 
\backslash
[Delta]], sty@Text[5, n5 + 3 
\backslash
[Delta]] }, Boxed -> False , ImageSize -> Medium ]
\end_layout

\end_inset


\end_layout

\begin_layout Section
Jacobian相关计算
\end_layout

\begin_layout Standard
在每个单元上，根据 单元顶点的坐标组，定义了 
\color blue
空间坐标
\color inherit
（物理时空坐标）和 
\color blue
母坐标
\color inherit
 之间的变换关系。Jacobian 给出
\begin_inset Formula $(x,y)$
\end_inset

 与 
\begin_inset Formula $(\xi,\eta)$
\end_inset

 之间 微分的变换关系：例如对于一阶单元
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
iN = {1 - 
\backslash
[Xi]1 - 
\backslash
[Xi]2, 
\backslash
[Xi]1, 
\backslash
[Xi]2}; xL = {x1, x2, x3}; yL = {y1, y2, y3}; toX = iN .
 xL; toY = iN .
 yL; ret = Simplify[First@Solve[{ x == toX, y == toY }, {
\backslash
[Xi]1, 
\backslash
[Xi]2}]]; to
\backslash
[Xi]
\backslash
[Eta] = Values@ret; jm = D[{toX, toY}, {{
\backslash
[Xi]1, 
\backslash
[Xi]2}}]; jmInv = D[to
\backslash
[Xi]
\backslash
[Eta], {{x, y}}]; TableForm /@ Transpose /@ Simplify[{jm, jmInv, jm .
 jmInv}]
\end_layout

\end_inset

 
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\backslash
[CapitalDelta]e = Det[{{1, x1, y1}, {1, x2, y2}, {1, x3, y3}}]; ia = {{x2
 - x1, y2 - y1}, {x3 - x1, y3 - y1}}; ib = {{y3 - y1, y1 - y2}, {x1 - x3,
 x2 - x1}}; ia .
 ib/
\backslash
[CapitalDelta]e // Simplify
\end_layout

\end_inset


\begin_inset Formula 
\[
J_{ij}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]=\left[\begin{array}{cc}
x_{21} & y_{21}\\
x_{31} & y_{31}
\end{array}\right],\quad\overline{J}_{ij}=\left[\begin{array}{cc}
\frac{\partial\xi}{\partial x} & \frac{\partial\eta}{\partial x}\\
\frac{\partial\xi}{\partial y} & \frac{\partial\eta}{\partial y}
\end{array}\right]=\frac{1}{\Delta^{e}}\left[\begin{array}{cc}
y_{31} & y_{12}\\
x_{13} & x_{21}
\end{array}\right]
\]

\end_inset

满足
\begin_inset Formula 
\begin{align*}
 & \dd{x_{j}}=\dd{\xi_{i}}\,J_{ij},\quad\frac{\partial}{\partial\xi_{i}}=\frac{\partial x_{j}}{\partial\xi_{i}}\frac{\partial}{\partial x_{j}},\quad{\color{blue}\tilde{\partial}_{i}=J_{ij}\,\partial_{j}}\\
 & \dd{\xi_{j}}=\dd{x_{i}}\,\overline{J}_{ij},\quad\frac{\partial}{\partial x_{k}}=\frac{\partial\xi_{j}}{\partial x_{k}}\frac{\partial}{\partial\xi_{j}},\quad{\color{blue}\partial_{k}=\overline{J}_{kj}\,\tilde{\partial}_{j}}
\end{align*}

\end_inset

此约定是通常的雅可比矩阵的转置。
\end_layout

\begin_layout Enumerate
母坐标组 
\begin_inset Formula $\left\{ \xi_{\alpha}\right\} $
\end_inset

，对每个单元都写成
\begin_inset Formula $\xi_{1},\xi_{2}$
\end_inset

 (or 
\begin_inset Formula $\xi,\eta$
\end_inset

)，取值范围相同；但实际上一一mapping 到 空间坐标 
\begin_inset Formula $x_{i}$
\end_inset

。
\end_layout

\begin_layout Enumerate
对于确定类型的单元，坐标变换矩阵 
\begin_inset Formula $T$
\end_inset

 由单元决定，而单元由顶点决定，因此通过 顶点坐标
\begin_inset Formula $\{X_{i}\}$
\end_inset

，可以参数出 雅可比矩阵 
\begin_inset Formula $J=\partial X/\partial\xi$
\end_inset

；
\end_layout

\begin_layout Enumerate
单元内点的空间坐标总是参数化成 
\begin_inset Formula 
\begin{align}
x_{j} & =N_{\alpha}^{e}\left(\xi_{k}\right)X_{\alpha j}\nonumber \\
 & =N_{\alpha}^{e}\left[\xi_{k}(x_{m})\right]X_{\alpha j},\label{eq:7.9}
\end{align}

\end_inset


\series bold

\begin_inset Formula $\alpha$
\end_inset

是节点编号，
\begin_inset Formula $i$
\end_inset

是坐标次序
\series default
；单元的节点坐标组 
\begin_inset Formula $\{X_{\alpha i}\}$
\end_inset

 作为变换中的 parameters。由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:7.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

加上链式规则可知 
\begin_inset Formula $J\,\overline{J}=1$
\end_inset

。
\end_layout

\begin_layout Enumerate
形函数 
\begin_inset Formula $\{N_{\alpha}^{e}\}$
\end_inset

 可以取不同阶或形式（例如Serenpidity）
\begin_inset Formula 
\[
J_{ij}=\frac{\partial x_{j}}{\partial\xi_{i}}=\frac{\partial N_{\alpha}^{e}}{\partial\xi_{i}}\,X_{\alpha j},\quad\text{expressed in}\;\xi_{i}
\]

\end_inset

逆矩阵（注意指标次序）
\begin_inset Formula 
\[
\overline{J}_{{\color{red}i}{\color{blue}j}}=\frac{\partial{\color{blue}\xi_{j}}}{\partial{\color{red}x_{i}}}
\]

\end_inset

对于确定阶的形函数
\begin_inset Formula $N_{\alpha}^{e}$
\end_inset

，
\begin_inset Formula $\partial N_{\alpha}^{e}/\partial\xi_{j}$
\end_inset

只依赖于
\begin_inset Formula $N_{\alpha}^{e}(\xi_{j})$
\end_inset

 ，而不依赖于
\begin_inset Formula $X_{\alpha j}$
\end_inset

。采用下文的简记写作
\begin_inset Formula 
\begin{align*}
J_{{\color{blue}i}{\color{red}j}} & =\frac{\partial{\color{red}x_{j}}}{\partial{\color{blue}\xi_{i}}}=X_{\alpha j}\,N_{\alpha,\tilde{i}}\\
J_{ij}\;\overline{J}_{jk} & =\delta_{ik}=X_{\alpha j}\,N_{\alpha,\tilde{i}}\;\overline{J}_{jk}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate
IBE solver 中约定的 Jacobian 是 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula 
\[
\mathcal{J}=\left(\begin{array}{ccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}\\
x_{3} & y_{3}
\end{array}\right)
\]

\end_inset


\begin_inset Formula 
\[
\mathcal{J}_{{\color{blue}i}j}=[\tilde{\partial}_{i}N_{\alpha}].X_{\alpha j}=\frac{\partial x_{j}}{\partial{\color{blue}\xi_{i}}}
\]

\end_inset

与本文约定相同。
\end_layout

\begin_layout Enumerate
程序中的 形函数梯度为 
\begin_inset Formula $G_{i\alpha}=\tilde{\partial}_{i}N_{\alpha}=N_{\alpha,i}$
\end_inset

（行指标为母坐标分量），
\begin_inset Formula $J_{ij}=G_{i\alpha}X_{\alpha j}=\tilde{\partial}_{i}x_{j}=X_{\alpha j}N_{\alpha,i}$
\end_inset

。
\end_layout

\begin_layout Subsection
Jacobian导数
\end_layout

\begin_layout Standard
令
\begin_inset Formula $x_{i}$
\end_inset

表示单元内一点的空间坐标分量
\begin_inset Formula $i$
\end_inset

，
\begin_inset Formula $\xi_{i}$
\end_inset

表示母坐标分量
\begin_inset Formula $i$
\end_inset

，
\begin_inset Formula $X_{\alpha i}$
\end_inset

表示节点
\begin_inset Formula $\alpha$
\end_inset

的坐标分量
\begin_inset Formula $i$
\end_inset

。并定义 
\begin_inset Formula $J_{ki}=\partial x_{i}/\partial\xi_{k}$
\end_inset

，逆矩阵
\begin_inset Formula $\overline{J}_{i\ell}=\partial\xi_{\ell}/\partial x_{i}$
\end_inset

；引入简记 
\begin_inset Formula $\tilde{\partial}_{j}=\partial/\partial\xi_{j}$
\end_inset

，
\begin_inset Formula $\partial_{i}=\partial/\partial x_{i}$
\end_inset

，则
\begin_inset Formula 
\[
\partial_{j}=\overline{J}_{ji}\tilde{\partial}_{i}.
\]

\end_inset

以及
\begin_inset Formula 
\[
N_{\alpha,\tilde{j}}=\frac{\partial N_{\alpha}}{\partial\xi_{j}},\quad N_{\alpha,\tilde{j}\tilde{\ell}}=\frac{\partial^{2}N_{\alpha}}{\partial\xi_{\ell}\,\partial\xi_{j}},
\]

\end_inset

通常偏导数可以交换次序 
\begin_inset Formula $N_{\alpha,\tilde{j}\tilde{\ell}}=N_{\alpha,\tilde{\ell}\tilde{j}}$
\end_inset

。后文如果不加说明，所有形函数的导数都是对
\begin_inset Formula $\xi$
\end_inset

，并省略指标的 tilde；以及省略
\begin_inset Formula $N_{\alpha}^{e}$
\end_inset

中的
\begin_inset Formula $e$
\end_inset

（单元编号）。
\end_layout

\begin_layout Example
Jacobian的母导数为
\begin_inset Formula 
\begin{align*}
\frac{\partial J_{{\color{red}kj}}}{\partial\xi_{{\color{blue}i}}} & =\frac{\partial}{\partial\xi_{i}}\left(\frac{\partial N_{\alpha}}{\partial\xi_{k}}X_{\alpha j}\right)\\
\text{参数形式} & =X_{\alpha j}\,N_{\alpha,ki}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
Jacobian的空间导数为
\begin_inset Formula 
\begin{align*}
\frac{\partial J_{{\color{red}kj}}}{\partial x_{{\color{blue}i}}} & =\frac{\partial}{\partial x_{i}}\left(\frac{\partial N_{\alpha}}{\partial\xi_{k}}X_{\alpha j}\right)\\
 & =X_{\alpha{\color{red}j}}\;\overline{J}_{{\color{blue}i}\ell}\,\tilde{\partial}_{\ell}\tilde{\partial}_{k}N_{\alpha}\\
\text{参数形式} & =X_{\alpha{\color{red}j}}\;\overline{J}_{{\color{blue}i}\ell}\,N_{\alpha,{\color{red}k}\ell}\\
\text{空间形式} & =X_{\alpha{\color{red}j}}\;\partial_{{\color{blue}i}}\,N_{\alpha,{\color{red}k}}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
Jacobian的nodal导数为
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\frac{\partial J_{{\color{red}kj}}}{\partial X_{\alpha i}} & =\frac{\partial}{\partial X_{\alpha i}}\left(\frac{\partial N_{\alpha}}{\partial\xi_{k}}X_{\alpha j}\right)\\
\text{参数形式} & =\frac{\partial N_{\alpha}}{\partial\xi_{k}}\delta_{ji}=N_{\alpha,k}\,\delta_{ji}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
Jacobian逆的导数
\end_layout

\begin_layout Example
Jacobian逆的母导数为
\begin_inset Formula 
\begin{align*}
\frac{\partial\overline{J}_{kj}}{\partial\xi_{i}} & =-\overline{J}_{km}\frac{\partial J_{mn}}{\partial\xi_{i}}\overline{J}_{nj}\\
 & =-\overline{J}_{km}\left(X_{\alpha n}\,N_{\alpha,mi}\right)\overline{J}_{nj}\\
\text{参数形式} & =-\overline{J}_{nj}\,X_{\alpha n}\,\overline{J}_{km}\,N_{\alpha,mi}\\
\text{空间形式} & =-\overline{J}_{nj}\,X_{\alpha n}\;\partial_{k}\,N_{\alpha,i}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
Jacobian逆的空间导数为
\begin_inset Formula 
\begin{align*}
\frac{\partial\overline{J}_{kj}}{\partial x_{i}} & =-\overline{J}_{km}\frac{\partial J_{mn}}{\partial x_{i}}\overline{J}_{nj}\\
 & =-\overline{J}_{km}\left(X_{\alpha n}\,\overline{J}_{i\ell}\,N_{\alpha,m\ell}\right)\overline{J}_{nj}\\
\text{参数形式} & =-\overline{J}_{nj}\,X_{\alpha n}\,\overline{J}_{i\ell}\,\overline{J}_{km}\,N_{\alpha,m\ell}\\
\text{空间形式} & =-\overline{J}_{nj}\,X_{\alpha n}\,\partial_{i}\partial_{k}\,N_{\alpha}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
Jacobian逆的nodal导数为
\begin_inset Formula 
\begin{align*}
\frac{\partial\overline{J}_{kj}}{\partial X_{\alpha i}} & =-\overline{J}_{km}\frac{\partial J_{mn}}{\partial X_{\alpha i}}\overline{J}_{nj}\\
 & =-\overline{J}_{km}\,N_{\alpha,m}\delta_{ni}\,\overline{J}_{nj}\\
\text{参数形式} & =-\overline{J}_{ij}\,\overline{J}_{km}\,N_{\alpha,m}\\
\text{空间形式} & =-\overline{J}_{ij}\;\partial_{k}\,N_{\alpha}
\end{align*}

\end_inset

例如在三维直角坐标系中，nodel 导数写作 
\begin_inset Formula 
\[
\frac{\partial\overline{J}_{kj}}{\partial X_{\alpha i}}\sbf e_{i}=-\partial_{k}\,N_{\alpha}\;\overline{J}_{ij}\,\sbf e_{i},
\]

\end_inset

其中
\begin_inset Formula $\sbf e_{i}=(\sbf e_{x},\sbf e_{y},\sbf e_{z})$
\end_inset

。
\end_layout

\begin_layout Subsection
Jacobian行列式的导数
\end_layout

\begin_layout Lemma
令
\begin_inset Formula $X_{\alpha i}$
\end_inset

表示节点
\begin_inset Formula $\alpha$
\end_inset

的坐标分量
\begin_inset Formula $i$
\end_inset

，
\end_layout

\begin_layout Lemma
设矩阵
\begin_inset Formula $g_{\mu\lambda}$
\end_inset

，它的行列式为
\begin_inset Formula $g$
\end_inset

，
\begin_inset Formula $g$
\end_inset

可以按第
\begin_inset Formula $\mu$
\end_inset

行展开为
\begin_inset Formula $g=g_{\mu\lambda}A^{\mu\lambda}$
\end_inset

（只对
\begin_inset Formula $\lambda$
\end_inset

求和），其中
\begin_inset Formula $A^{\mu\lambda}$
\end_inset

是对应
\begin_inset Formula $g_{\mu\lambda}$
\end_inset

的代数余子式。所以
\begin_inset Formula $\partial g/\partial g_{\mu\lambda}=A^{\mu\lambda}$
\end_inset

。而
\begin_inset Formula $g_{\mu\lambda}$
\end_inset

的逆矩阵写作
\begin_inset Formula $g^{\lambda\mu}=A^{\mu\lambda}/g$
\end_inset

（注意指标位置），所以有
\begin_inset Formula 
\begin{equation}
\frac{\partial g}{\partial g_{\mu\lambda}}=A^{\mu\lambda}=gg^{\lambda\mu}.\label{eq:mat-eq}
\end{equation}

\end_inset

其中 
\begin_inset Formula $g^{\lambda\mu}$
\end_inset

 是 
\begin_inset Formula $g_{\mu\lambda}$
\end_inset

 对应的逆矩阵（注意指标位置）。可以看到，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mat-eq"
plural "false"
caps "false"
noprefix "false"

\end_inset

与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

具有类似的形式。
\end_layout

\begin_layout Lemma
如果是平直Euclidean空间，不需要考虑度规，则对于矩阵
\begin_inset Formula $A$
\end_inset


\begin_inset Formula 
\[
\frac{\partial\det[A]}{\partial A_{ij}}=\det[A]\,B_{ji}
\]

\end_inset

其中矩阵
\begin_inset Formula $B$
\end_inset

是
\begin_inset Formula $A$
\end_inset

的逆，
\begin_inset Formula $B^{\mu\nu}=C^{\nu\mu}/\det[A]$
\end_inset

，
\begin_inset Formula $C^{\mu\nu}$
\end_inset

是
\begin_inset Formula $A^{\mu\nu}$
\end_inset

的代数余子式。
\end_layout

\begin_layout Example
Jacobian Det 的母导数
\begin_inset Formula 
\begin{align*}
\frac{\partial\det[J]}{\partial\xi_{i}} & =\frac{\partial\det[J]}{\partial J_{jk}}\;{\color{blue}\frac{\partial J_{jk}}{\partial\xi_{i}}}\\
 & =\det[J]\,\overline{J}_{kj}{\color{blue}X_{\alpha k}\,N_{\alpha,ji}}\\
\text{参数形式} & =\det[J]\,X_{\alpha k}\,\overline{J}_{kj}\,N_{\alpha,ji}\\
\text{空间形式} & =\det[J]\,X_{\alpha k}\,\partial_{k}\,N_{\alpha,i}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
Jacobian Det 的空间导数
\begin_inset Formula 
\begin{align*}
\frac{\partial\det[J]}{\partial x_{i}} & =\frac{\partial\det[J]}{\partial J_{jk}}\;{\color{blue}\frac{\partial J_{jk}}{\partial x_{i}}}\\
 & =\det[J]\,\overline{J}_{kj}\;{\color{blue}X_{\alpha k}\,\overline{J}_{i\ell}\,N_{\alpha,j\ell}}\\
\text{参数形式} & =\det[J]\,X_{\alpha k}\,\overline{J}_{kj}{\color{blue}\,\overline{J}_{i\ell}\,N_{\alpha,j\ell}}\\
\text{空间形式} & =\det[J]\;X_{\alpha k}\,\partial_{i}\partial_{k}\,N_{\alpha}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
Jacobian Det行列式的nodal导数
\begin_inset Formula 
\begin{align*}
\frac{\partial J_{{\color{red}kj}}}{\partial X_{\alpha i}} & =\frac{\partial}{\partial X_{\alpha i}}\left(\frac{\partial N_{\alpha}}{\partial\xi_{k}}X_{\alpha j}\right)\\
\text{参数形式} & =\frac{\partial N_{\alpha}}{\partial\xi_{k}}\delta_{ji}=N_{\alpha,k}\,\delta_{ji}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
\frac{\partial\det[J]}{\partial X_{\alpha i}} & =\frac{\partial\det[J]}{\partial J_{jk}}\;{\color{blue}\frac{\partial J_{jk}}{\partial X_{\alpha i}}}\\
 & =\det[J]\;\overline{J}_{kj}\,{\color{blue}N_{\alpha,j}\delta_{ki}}\\
\text{参数形式} & =\det[J]\;\overline{J}_{ij}\,N_{\alpha,j}\\
\text{空间形式} & =\det[J]\;\partial_{i}\,N_{\alpha}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
例：各种矩阵的显式
\end_layout

\begin_layout Standard
在三维直角坐标系中，Jacobian 为
\begin_inset Formula 
\begin{equation}
J_{{\color{blue}\nu}}^{\circ\mu}=\frac{\partial x^{\circ\mu}}{\partial\xi^{\nu}}=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}\\
\frac{\partial x}{\partial\zeta} & \frac{\partial y}{\partial\zeta} & \frac{\partial z}{\partial\zeta}
\end{array}\right]=-\left[\begin{array}{ccc}
x_{12} & y_{12} & z_{12}\\
x_{13} & y_{13} & z_{13}\\
x_{14} & y_{14} & z_{14}
\end{array}\right].\label{eq:jacobi3d}
\end{equation}

\end_inset

行指标为
\begin_inset Formula $\xi$
\end_inset

，列指标为
\begin_inset Formula $x$
\end_inset

。其中记号约定为： 
\begin_inset Formula $x_{12}=x_{1}-x_{2}$
\end_inset

，其他类似。雅可比矩阵的逆矩阵为
\begin_inset Formula 
\[
\overline{J}=\frac{1}{\det\left[J\right]}\left[\begin{array}{ccc}
b_{2} & b_{3} & b_{4}\\
c_{2} & c_{3} & c_{4}\\
d_{2} & d_{3} & d_{4}
\end{array}\right].
\]

\end_inset

令 
\begin_inset Formula $X_{\alpha j}$
\end_inset

 表示四面体单元中，节点的坐标矩阵，
\begin_inset Formula 
\[
X_{\alpha j}=\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Section
为什么叫做等参单元
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "有限元中什么是等参单元"
target "https://www.zhihu.com/question/29564930/answer/77635688"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "邱小白"
target "https://www.zhihu.com/question/29564930/answer/77582890"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "有限元简单科普之——等参化"
target "https://zhuanlan.zhihu.com/p/92509191"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
对于场函数，例如位移场，我们可以通过 
\color blue
节点的场值
\color inherit
 与 
\color blue
插值函数
\color inherit
 来表示场内各点的场值。设节点数为
\begin_inset Formula $n$
\end_inset

。一般而言，此公式是表示在局域坐标下的：
\begin_inset Formula 
\[
u=\sum_{i=1}^{n}N_{i}^{e}(\xi_{1}\cdots)u_{i}
\]

\end_inset


\end_layout

\begin_layout Enumerate
将单元从规则的 局域坐标系（如三角形的面积坐标系）转化到 全局坐标系 中，我们需要建立两个坐标系之间的变换关系。坐标变换 和场变换类似，通过 全局坐标系
 下的 
\color blue
节点坐标
\color inherit
，和用 局部坐标 表示的 插值函数， 可以表出 单元内动点 的
\color blue
全局坐标
\color inherit
。设 节点数为
\begin_inset Formula $m$
\end_inset

，
\begin_inset Formula 
\[
x=\sum_{i=1}^{m}N_{i}^{e\prime}(\xi_{1}\cdots)x_{i}
\]

\end_inset

注意形函数
\begin_inset Formula $N_{i}^{e\prime}(\xi_{1}\cdots)$
\end_inset

对 母坐标
\begin_inset Formula $\{\xi_{1}\cdots\}$
\end_inset

的具体系数，与一众
\begin_inset Formula $\{x_{i}\}$
\end_inset

也有关系；也就是坐标变换特定于每个单元。如果 场函数插值 所用节点数，与 坐标变换所用节点数 相等时，即 
\begin_inset Formula $n=m$
\end_inset

，而且两者采用相同的插值函数，即 
\begin_inset Formula $N_{i}^{e\prime}=N_{i}^{e}$
\end_inset

。那么，我们称这种变换叫 
\color blue
等参变换
\color inherit
，这种单元叫 
\color blue
等参单元
\color inherit
。
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $n<m$
\end_inset

，即 场展开节点数
\begin_inset Formula $<$
\end_inset

坐标展开节点数，我们称为 
\series bold
超参变换
\series default
，单元为超参单元（坐标
\begin_inset Formula $>$
\end_inset

场）；
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $n>m$
\end_inset

，即 场展开节点数
\begin_inset Formula $>$
\end_inset

坐标展开节点数，我们称为 
\series bold
亚参变换
\series default
，单元为亚参单元。
\end_layout

\begin_layout Enumerate
为什么会出现等参单元，因为方便。局部坐标系下的单元是很规则的单元，我们可以很容易通过 Lagrange 插值、划线法、Hermite插值来构造
 单元内场的插值函数。而且，如果单元是等参单元的话，坐标变换也可以运用场的插值函数，把局部坐标系下的规则单元变换为笛卡尔坐标系、极坐标、球坐标下的各种离奇形状的
单元。即使这么做，对于刚阵、力向量的积分上也不会很困难，所以我们很热爱等参单元。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
很多时候划分网格后的单元是很不规则的，造成的结果是每个 element 都要用不同的 shape function，非常麻烦。于是有的哥们就思考能不能将单元标准
化，即把单元都 mapping 成同一个单元，这样不就简单了吗。拿简单的一维问题为例，如下图：
\end_layout

\begin_layout Example
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/element-mapping.png
	scale 50

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
母坐标变换
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
目标是将局部坐标系(local coordinates) 映射成范围是 
\begin_inset Formula $[-1,1]$
\end_inset

 的自然坐标系(natural coordinates)。可是如何做到呢，于是这个哥们深入思考发现：如果场函数插值(比如例子中的位移场)，和单元
 局部坐标系 到 自然坐标系 的变换使用同一个 shape function 不就行了吗？这样说可能比较抽象，下面的公式比较直观：
\begin_inset Formula 
\begin{align*}
 & x\left(\xi\right)=N_{i}\left(\xi\right)x_{i},\\
 & u\left(\xi\right)=N_{i}\left(\xi\right)u_{i}.
\end{align*}

\end_inset

其中 
\begin_inset Formula $x$
\end_inset

 是局部坐标系坐标，
\begin_inset Formula $x_{i}$
\end_inset

 是节点的局部坐标；
\begin_inset Formula $u_{i}$
\end_inset

 是节点在局部坐标系下的位移，
\begin_inset Formula $u$
\end_inset

 则是插值后的位移场。
\end_layout

\begin_layout Enumerate
举个例子，对于结点 
\begin_inset Formula $1$
\end_inset

(
\begin_inset Formula $i=1$
\end_inset

)，
\begin_inset Formula 
\[
N_{1}(-1)=1,N_{2}(-1)=0,
\]

\end_inset

 所以 
\begin_inset Formula $x\left(-1\right)=x_{1}$
\end_inset

，
\begin_inset Formula $u(-1)=u_{1}$
\end_inset

，两个插值使用同一个shape function。mapping 到 
\begin_inset Formula $\left[-1,1\right]$
\end_inset

 的另一个好处是积分方便，通常可以使用如下近似方程（以二维为例）：
\begin_inset Formula 
\[
\int_{-1}^{1}\int_{-1}^{1}\phi(\xi,\eta)\dd{\xi}\dd{\eta}\approx\phi(1/\sqrt{3},1/\sqrt{3})+\phi(-1/\sqrt{3},-1/\sqrt{3})+\phi(-1/\sqrt{3},1/\sqrt{3})+\phi(1/\sqrt{3},-1/\sqrt{3}).
\]

\end_inset

当然，由于 shape function 
\begin_inset Formula $N_{i}$
\end_inset

 现在是 
\begin_inset Formula $\xi$
\end_inset

 的函数，而积分时需要的经常是 
\begin_inset Formula $\partial N_{i}/\partial x$
\end_inset

，所以需要引入雅可比 
\begin_inset Formula $J$
\end_inset

(Jacobian)，即 
\begin_inset Formula $\dd{x}\dd{\xi}$
\end_inset

 。这样就可以通过链式法则：
\begin_inset Formula $\frac{\partial N_{i}}{\partial\xi}=\frac{\partial N_{i}}{\partial x}\frac{\dd{x}}{\dd{\xi}}$
\end_inset

 得出 
\begin_inset Formula $\frac{\partial N_{i}}{\partial x}=\frac{1}{J}\frac{\partial N_{i}}{\partial\xi}$
\end_inset

。
\end_layout

\begin_layout Enumerate
同理，对于三角形单元，可以将其 mapping 成直角边为 
\begin_inset Formula $1$
\end_inset

 的等腰直角三角形；对于四边形单元，可以将其 mapping 成顶点分别为 
\begin_inset Formula $(-1,-1)$
\end_inset

，
\begin_inset Formula $(-1,1)$
\end_inset

, 
\begin_inset Formula $(1,-1)$
\end_inset

, 
\begin_inset Formula $(1,1)$
\end_inset

 的正方形，等等。
\end_layout

\begin_layout Section
空间坐标与参数坐标
\end_layout

\begin_layout Enumerate
通过使用形函数
\begin_inset Formula $\{N_{i}^{e}\}$
\end_inset

，可以将 求解区域上的小单元（称作 
\series bold
物理单元
\series default
），一一映射到 母坐标空间的小单元（称作 
\series bold
参数单元
\series default
）。
\end_layout

\begin_layout Enumerate
对于两个一一映射的 
\series bold
物理单元
\series default
 与 
\series bold
参数单元
\series default
，当 
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

 在取值范围内变动时，勾勒出等参空间的标准单元形状（例如等腰直角三角形）；对应的 
\begin_inset Formula $\{x,y\}$
\end_inset

 将在物理空间变动，勾勒出物理空间的单元（即一般的三角形）。注意我们统一使用 
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

表示 母坐标，但是
\series bold
具体的坐标变换 对于不同的单元是不同的，也就是每个坐标变换局域于它的单元上
\series default
。具体来说，坐标变换的 
\series bold
系数
\series default
 依赖于 
\series bold
节点
\series default
 的空间坐标。
\end_layout

\begin_layout Enumerate
如果真实的求解区域是平面，物理单元中某点
\begin_inset Formula $(x_{0},y_{0})$
\end_inset

的邻域
\begin_inset Formula $\left\{ x_{0}+\dd{x},y_{0}+\dd{y}\right\} $
\end_inset

可以 精确对应到等参单元中的邻域 
\begin_inset Formula $\left\{ \xi_{0}+\dd{\xi},\eta_{0}+\dd{\xi}\right\} $
\end_inset

，因为单元都是线性的。
\end_layout

\begin_layout Enumerate
如果真实的求解区域是曲面，物理单元中某点
\begin_inset Formula $(x_{0},y_{0})$
\end_inset

的邻域，只是近似对应等参单元中的邻域。因为如果形函数是线性的，插值出来的只能是平面，不能还原出真实的曲面性质（只有节点处是精确的）。要想尽量贴合原先的单元，需要
采用更高阶的形函数，模拟出曲面的弯曲。
\end_layout

\begin_layout Standard
空间坐标与 母坐标的 变换式（映射关系）为：
\begin_inset Formula 
\begin{align}
 & x=\sum_{i}N_{i}^{e}\left(\xi,\eta\right)x_{i}\label{eq:coord}\\
 & y=\sum_{i}N_{i}^{e}\left(\xi,\eta\right)y_{i}\nonumber 
\end{align}

\end_inset

其中 
\begin_inset Formula $N_{i}^{e}$
\end_inset

 表示某个单元中，第
\begin_inset Formula $i$
\end_inset

个节点对应的形函数，对重复指标进行求和。程序中，如果取节点（单元插值点）的形式为
\begin_inset Formula 
\[
\overline{X}_{j\alpha}=\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}\\
x_{3} & y_{3}\\
\cdots & \cdots
\end{array}\right]
\]

\end_inset

为一
\begin_inset Formula $\left[n,2\right]$
\end_inset

矩阵。并将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:coord"
plural "false"
caps "false"
noprefix "false"

\end_inset

表示为矩阵乘法的形式：
\begin_inset Formula 
\begin{equation}
\left[\begin{array}{c}
x\\
y
\end{array}\right]=\left[\begin{array}{cccc}
x_{1} & x_{2} & x_{3} & \cdots\\
y_{1} & y_{2} & y_{3} & \cdots
\end{array}\right]\left[\begin{array}{c}
N_{1}\\
N_{2}\\
N_{3}\\
\cdots
\end{array}\right],\quad X=\overline{X}^{T}\cdot N(\xi)\label{eq:my61}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
总结：用指标表示，则小单元中动点的空间坐标是
\color blue

\begin_inset Formula 
\begin{equation}
X_{j}=\overline{X}_{j\alpha}N_{\alpha},\quad X=\overline{X}^{T}\cdot N(\xi)\label{eq:my61a}
\end{equation}

\end_inset


\color inherit
其中 
\begin_inset Formula $X=\left(x,y\right)$
\end_inset

 表示动点的 
\series bold
参数单元
\series default
 坐标，
\begin_inset Formula $\overline{X}_{j\alpha}$
\end_inset

 表示节点空间坐标，
\begin_inset Formula $N_{\alpha}$
\end_inset

 表示形函数。
\begin_inset Formula $j\in\left\{ 1,2\right\} $
\end_inset

 是空间的维数，
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是节点的数目。
\end_layout

\end_inset


\end_layout

\begin_layout Section
内部边界，法向，连续性，电场连续性
\end_layout

\begin_layout Standard
对于二维平面几何区域，边界是一维曲线。外边界上的单元中，节点的顺序逆时针给出，
\begin_inset Formula 
\begin{align*}
 & x=N_{\alpha}X_{\alpha}=(1-\zeta)X_{1}+(1+\zeta)X_{2}\\
 & \frac{\dd{x}}{\dd{\zeta}}=X_{2}-X_{1}
\end{align*}

\end_inset

所以曲线切线也是沿着逆时针方向；如果区域内部有洞（多连通），则内部边界的节点顺序是顺时针。
\end_layout

\begin_layout Standard
总之，如果使用
\begin_inset Formula $\sbf n=\sbf z\times\sbf\tau$
\end_inset

计算边界的法向
\begin_inset Formula $\sbf n$
\end_inset

，其中
\begin_inset Formula $\sbf z$
\end_inset

，
\begin_inset Formula $\sbf\tau$
\end_inset

分别是
\begin_inset Formula $z$
\end_inset

方向和切向单位矢量，则法向
\begin_inset Formula $\sbf n$
\end_inset

指向区域内部，与标准约定（指向体系外部）差一负号。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/common-edge.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
p1 = {0, 0}; p2 = {1, 0}; p3 = {0.2, 0.6}; p4 = {0.8, 0.7}; 
\backslash
[Delta] = 0.01; sty = Style[#, 13, Red, Bold] &; fig = Graphics[{ Thick,
 Line[{p1, p3}], Line[{p1, p2, p4, p3, p2}], sty@Text["1", p1 + {-2 
\backslash
[Delta], 0 
\backslash
[Delta]}], sty@Text["2", p2 + {2 
\backslash
[Delta], 0}], sty@Text["3", p3 + {-2 
\backslash
[Delta], 
\backslash
[Delta]}], sty@Text["4", p4 + {2 
\backslash
[Delta], 2 
\backslash
[Delta]}], sty@Text["A", 1/3*(p1 + p2 + p3)], sty@Text["B", 1/3*(p3 + p2
 + p4)] }, ImageSize -> Medium]
\end_layout

\begin_layout Plain Layout
Export[ FileNameJoin[{$HomeDirectory, "note", "FiniteEM", "inset", "common-edge.p
df"}] , fig]
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
具有公共边的两个单元
\begin_inset CommandInset label
LatexCommand label
name "fig:my7.18"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
如图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:my7.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

，具有公共边
\begin_inset Formula $E$
\end_inset

 的两个单元 
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $B$
\end_inset

；IBE 再输出边的几何信息时，都按逆时针，即 
\begin_inset Formula $3-2-4$
\end_inset

，
\begin_inset Formula $1-2-3$
\end_inset

。这样公共边的顺序分别是
\begin_inset Formula $3-2$
\end_inset

，
\begin_inset Formula $2-3$
\end_inset

，也就是刚好相反。如果都拿 
\begin_inset Formula $\hat{\sbf z}$
\end_inset

方向法矢作叉乘，得到的两个法向刚好是反向的。可用于计算下式
\begin_inset Formula 
\[
\sbf n\cdot(\sbf D_{2}-\sbf D_{1})
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nabla\phi=\partial_{i}\,N_{\alpha}\phi_{\alpha}=\phi_{\alpha}\overline{J}_{ij}\tilde{\partial}_{j}N_{\alpha}=\phi_{\alpha}\overline{J}_{ij}\,G_{j\alpha}
\]

\end_inset

其中 
\begin_inset Formula $G_{j\alpha}=\partial N_{\alpha}/\partial\xi_{j}$
\end_inset

；上划线表示求逆；
\begin_inset Formula 
\[
J_{ij}=\partial x_{j}/\partial\xi_{i}=\partial(N_{\beta}X_{\beta j})/\partial x_{i}=G_{i\beta}\,X_{\beta j}
\]

\end_inset


\begin_inset Formula 
\[
\nabla\phi=\overline{G.X}.G.\Phi
\]

\end_inset

使用数值方法，对
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:my7.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的单元进行测试
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(*gradient of shapeFun; order 1, independent of 
\backslash
[Xi]*) iG = {{-1, 1, 0} , {-1, 0, 1}}; (*nodal coord; 公共边*) p0 = {0, 0};
 p1 = {1, 0}; (*公共边上的两个法向*) norm[vec2_] := Take[#, 2] &@(Cross[{0, 0, 1},
 Append[#, 0] &@vec2]/ Sqrt@Dot[vec2, vec2]); nA = norm@(p1 - p0); nB =
 norm@(p0 - p1); (*nodal coord; 两个区别顶点*) p2 = {0.5, 1}; p3 = {0.5, -1}; (*nodal
 coord matrix*) iXA = {p0, p1, p2}; iXB = {p0, p3, p1}; (*nodal phi; common
 edge*) 
\backslash
[Phi]0 = 1; 
\backslash
[Phi]1 = 1; (*nodal phi; diff nodes*) 
\backslash
[Phi]2 = 2; 
\backslash
[Phi]3 = 3; 
\backslash
[Phi]A = {
\backslash
[Phi]0, 
\backslash
[Phi]1, 
\backslash
[Phi]2}; 
\backslash
[Phi]B = {
\backslash
[Phi]0, 
\backslash
[Phi]3, 
\backslash
[Phi]1}; EA = -Inverse[iG .
 iXA] .
 iG .
 
\backslash
[Phi]A; EB = -Inverse[iG .
 iXB] .
 iG .
 
\backslash
[Phi]B; {EA, EB} TableForm[ {{EA, EB}, {EA .
 nA, EB .
 nB} }, TableHeadings -> {{"Vec_E", "E_norm"}}, TableDepth -> 1]
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
Edge单元
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\sbf E^{e}=\sum_{i=1}^{4}\sbf N_{i}^{e}\,E_{i}^{e}\label{eq:j8.3}
\end{equation}

\end_inset

其中
\begin_inset Formula $E_{i}^{e}$
\end_inset

表示沿着第
\begin_inset Formula $i$
\end_inset

个棱边的切向场，
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

是矢量插值函数或基函数。
\end_layout

\begin_layout Standard
只要插值展开写成
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j8.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

的形式；如果两个单元上的展开 share 公共Edge，则能推导出： 
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

 只在第 
\begin_inset Formula $i$
\end_inset

 边上有切向分量，而在其它所有边上没有切向分量（离散正交性）。
\begin_inset Formula 
\[
\sbf N_{i}^{e}(e_{j})=\delta_{ij}
\]

\end_inset


\end_layout

\begin_layout Standard
在有限元方法计算磁场时，特别是三维磁场，通常会使用在单元边上定义的 Edge 单元（而非节点上定义的）作为待求未知量。图1.1为四面体单元上棱边与节点的对应关系，
在棱边 
\begin_inset Formula $i$
\end_inset

 上可以定义形函数：
\begin_inset Formula 
\[
\sbf N_{i}^{e}=\left(L_{i(1)}^{e}\nabla L_{i(2)}^{e}-L_{i(2)}^{e}\nabla L_{i(1)}^{e}\right)\ell_{i}^{e}
\]

\end_inset

其中 
\begin_inset Formula $i(1)$
\end_inset

与 
\begin_inset Formula $i(2)$
\end_inset

为与棱边
\begin_inset Formula $i$
\end_inset

 邻接的两个顶点。
\begin_inset Formula $\ell_{i}^{e}$
\end_inset

 的绝对值等于棱边的长度，正负号由节点的总体编号决定。
\begin_inset Formula $\nabla\cdot\sbf N_{i}^{e}=0$
\end_inset

，此性质只取决于上式的构造，不依赖于
\begin_inset Formula $L_{i(1)}^{e}$
\end_inset

和
\begin_inset Formula $L_{i(2)}^{e}$
\end_inset

的具体表达式。形函数 
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

 为一矢量，相应的矢量图可以参照图1.2所示的二维情况。
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/xl-1.2.png
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
二维三角形单元，相邻单元同一条棱边上形函数的矢量图分布。
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
形函数的旋度
\begin_inset Formula 
\begin{align*}
\nabla\times\sbf N_{\alpha}^{e} & =\nabla\times\left(L_{\alpha(1)}^{e}\nabla L_{\alpha(2)}^{e}-L_{\alpha(2)}^{e}\nabla L_{\alpha(1)}^{e}\right)\ell_{\alpha}^{e}\\
 & =2\left[{\color{blue}(\nabla L_{\alpha(1)}^{e})}\times\nabla L_{\alpha(2)}^{e}\right]\ell_{\alpha}^{e}
\end{align*}

\end_inset

形函数的二阶旋度
\begin_inset Formula 
\begin{align*}
\nabla\times\nabla\times\sbf N_{\alpha}^{e} & =2\left[(\nabla L_{\alpha(2)}^{e}\cdot\nabla){\color{blue}(\nabla L_{\alpha(1)}^{e})}+(\nabla^{2}L_{\alpha(2)}^{e}){\color{blue}(\nabla L_{\alpha(1)}^{e})}-({\color{blue}(\nabla L_{\alpha(1)}^{e})}\cdot\nabla)\nabla L_{\alpha(2)}^{e}-{\color{blue}(\nabla^{2}L_{\alpha(1)}^{e})}\nabla L_{\alpha(2)}^{e}\right]\\
 & =2\left[\nabla L_{\alpha(2)}^{e}\cdot{\color{blue}\nabla\nabla L_{\alpha(1)}^{e}}-{\color{blue}\nabla L_{\alpha(1)}^{e}}\cdot\nabla\nabla L_{\alpha(2)}^{e}\right]+2\left[\nabla^{2}L_{\alpha(2)}^{e}\,{\color{blue}\nabla L_{\alpha(1)}^{e}}-{\color{blue}\nabla^{2}L_{\alpha(1)}^{e}}\,\nabla L_{\alpha(2)}^{e}\right]
\end{align*}

\end_inset

其中 
\begin_inset Formula $\nabla\nabla$
\end_inset

是形函数的Hessian 矩阵，
\begin_inset Formula $\nabla^{2}$
\end_inset

是Hessian矩阵的迹，其中各block均可使用等参坐标计算。对于一阶形函数
\begin_inset Formula $\sbf N_{\alpha}^{e}$
\end_inset

，
\begin_inset Formula $\nabla\times\nabla\times\sbf N_{\alpha}^{e}=0$
\end_inset

。
\end_layout

\begin_layout Remark
使用了 
\begin_inset Formula 
\begin{align*}
 & \nabla\times(\varphi\sbf f)=(\nabla\varphi)\times\sbf f+\varphi(\nabla\times\sbf f)\\
 & \nabla\times(\sbf f\times\sbf g)=(\sbf g\cdot\nabla)\sbf f+(\nabla\cdot\sbf g)\sbf f-(\sbf f\cdot\nabla)\sbf g-(\nabla\cdot\sbf f)\sbf g\\
 & \nabla\times\nabla\varphi\equiv0\\
 & \nabla\cdot(\nabla\times\sbf f)\equiv0
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Subsection
形函数Hessian
\end_layout

\begin_layout Standard
使用
\begin_inset Formula 
\[
\frac{\partial\overline{J}_{{\color{red}12}}}{\partial\xi_{{\color{blue}3}}}=-\overline{J}_{1m}\frac{\partial J_{mn}}{\partial\xi_{3}}\overline{J}_{n2}=-\overline{J}_{b2}\,X_{\beta b}\,\overline{J}_{1c}\,N_{\beta,c3}
\]

\end_inset


\end_layout

\begin_layout Enumerate
计算形函数
\begin_inset Formula $N_{\alpha}$
\end_inset

的空间坐标Hessian矩阵
\begin_inset Formula 
\begin{align*}
\nabla\nabla N_{\alpha} & =\partial_{i}\partial_{j}N_{\alpha}\\
 & =\overline{J}_{ik}\tilde{\partial}_{k}\,\left(\overline{J}_{jm}\tilde{\partial}_{m}N_{\alpha}\right)\\
 & =\overline{J}_{ik}\left({\color{blue}\tilde{\partial}_{k}\overline{J}_{jm}}\right)N_{\alpha,m}+\overline{J}_{ik}\overline{J}_{jm}\,N_{\alpha,mk}\\
 & =\overline{J}_{ik}\left({\color{blue}-\overline{J}_{bm}\,X_{\beta b}\,\overline{J}_{jc}\,N_{\beta,ck}}\right)N_{\alpha,m}+\overline{J}_{ik}\overline{J}_{jm}\,N_{\alpha,mk}\\
 & =-(\overline{J}_{ik}\overline{J}_{jc}\,N_{\beta,ck})\,X_{\beta b}\,\overline{J}_{bm}\,N_{\alpha,m}+\overline{J}_{ik}\overline{J}_{jm}\,N_{\alpha,mk}
\end{align*}

\end_inset

矩阵形式为，
\begin_inset Formula 
\[
\nabla\nabla N_{\alpha}=-(\overline{J}\cdot H_{\beta}\cdot\overline{J}^{\mathrm{T}})_{ji}\,(X_{\beta\cdot}\cdot\overline{J}\cdot G_{\cdot\alpha})+(\overline{J}\cdot H_{\alpha}\cdot\overline{J}^{\mathrm{T}})_{ji}
\]

\end_inset

其中
\begin_inset Formula $H_{\beta}\equiv$
\end_inset

 节点
\begin_inset Formula $\beta$
\end_inset

的形函数
\begin_inset Formula $N_{\beta}$
\end_inset

的Hessian；在程序中
\begin_inset Formula $G_{k\alpha}=\tilde{\partial}_{k}N_{\alpha}=N_{\alpha,k}^{\mathrm{T}}$
\end_inset

，or 
\begin_inset Formula $N_{\alpha,k}=G_{k\alpha}^{\mathrm{T}}$
\end_inset

，
\begin_inset Formula $G$
\end_inset

 就是 dNdzeta。
\end_layout

\begin_layout Enumerate
Hessian 的迹（对坐标index求迹）为
\begin_inset Formula 
\begin{align*}
{\color{blue}\nabla^{2}N_{\alpha}} & =\partial_{i}\partial_{i}N_{\alpha}\\
 & =-(\overline{J}_{ik}\overline{J}_{ic}\,N_{\beta,ck})\,X_{\beta b}\,\overline{J}_{bm}\,N_{\alpha,m}+\overline{J}_{ik}\overline{J}_{im}\,N_{\alpha,mk}
\end{align*}

\end_inset

写成矩阵运算形式为
\begin_inset Formula 
\[
{\color{blue}\nabla^{2}N_{\alpha}}=-\tr[\overline{J}^{\mathrm{T}}\cdot\overline{J}\cdot H_{\beta}]\,(X_{\beta\cdot}\cdot\overline{J}\cdot G_{\cdot\alpha})+\tr[\overline{J}^{\mathrm{T}}\cdot\overline{J}\cdot H_{\alpha}]
\]

\end_inset

有限元解对应的 体电荷估计
\begin_inset Formula 
\begin{align*}
\rho^{h}= & -\epsilon_{0}\epsilon_{r}\,\phi_{\alpha}{\color{blue}\nabla^{2}N_{\alpha}}\\
= & -\epsilon_{0}\,\tr[\overline{J}^{\mathrm{T}}\cdot\overline{J}\cdot H_{\beta}]\,(X_{\beta\cdot}\cdot\overline{J}\cdot D)\\
 & -\epsilon_{0}\epsilon_{r}\tr[\overline{J}^{\mathrm{T}}\cdot\overline{J}\cdot H_{\alpha}]\phi_{\alpha}
\end{align*}

\end_inset

电位移矢量 
\begin_inset Formula $D_{k}^{h}=-\epsilon_{r}N_{\alpha,k}\,\phi_{\alpha}^{h}=-\epsilon_{r}\phi_{\alpha}G_{k\alpha}$
\end_inset

。
\end_layout

\begin_layout Chapter
FEM计算
\end_layout

\begin_layout Standard
指标约定：
\end_layout

\begin_layout Enumerate
用 
\begin_inset Formula $a$
\end_inset

，
\begin_inset Formula $b$
\end_inset

，
\begin_inset Formula $c$
\end_inset

 表示 母坐标（单元自然参数坐标 
\begin_inset Formula $\xi$
\end_inset

，
\begin_inset Formula $\eta$
\end_inset

）；用
\begin_inset Formula $i$
\end_inset

，
\begin_inset Formula $j$
\end_inset

，
\begin_inset Formula $k$
\end_inset

 表示空间坐标（模型全局坐标 
\begin_inset Formula $x$
\end_inset

，
\begin_inset Formula $y$
\end_inset

，
\begin_inset Formula $z$
\end_inset

）；
\end_layout

\begin_layout Enumerate
用字母 
\begin_inset Formula $\alpha$
\end_inset

，
\begin_inset Formula $\beta$
\end_inset

，
\begin_inset Formula $\gamma$
\end_inset

 表示单元上不同节点，以及相关的形函数（
\begin_inset Formula $N_{\alpha}^{e}$
\end_inset

）等。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $X_{\alpha j}$
\end_inset

表示单元的节点坐标矩阵。
\end_layout

\begin_layout Enumerate
如果有局域坐标系，则用 
\begin_inset Formula $u$
\end_inset

，
\begin_inset Formula $v$
\end_inset

，
\begin_inset Formula $w$
\end_inset

 表示。
\end_layout

\begin_layout Section
积分测度与雅可比矩阵Jm
\end_layout

\begin_layout Standard
在标准单元的方法中，独立空间坐标的个数和独立 母坐标的个数相同，例如对于二维都是
\begin_inset Formula $2$
\end_inset

。空间坐标与 母坐标微分的变换式是：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\dd{x}\dd{y}=\det[J]\left(\xi,\eta\right)\dd{\xi}\dd{\eta}
\]

\end_inset

其中引入了 Jacobi 矩阵 
\begin_inset Formula $J$
\end_inset

 （对于
\begin_inset Formula $2$
\end_inset

维几何是
\begin_inset Formula $2\times2$
\end_inset

矩阵），并定义为
\begin_inset Formula 
\begin{align}
J\left(\xi,\eta\right) & =\frac{\partial\left(N_{i}^{e}x_{i},N_{i}^{e}y_{i}\right)}{\partial\left(\xi,\eta\right)}=\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]\label{eq:jacobi}\\
 & =\sum_{i}\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{i} & y_{i}\end{array}\right)\nonumber 
\end{align}

\end_inset

IBE Solve中
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
定义的
\begin_inset Formula $J$
\end_inset

，行指标是
\begin_inset Formula $\xi$
\end_inset

，列指标是空间坐标
\begin_inset Formula $x,y,z$
\end_inset

。例如当 
\begin_inset Formula $i=1,2,3$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\begin{equation}
J\left(\xi,\eta\right)=\left(\begin{array}{ccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}\\
x_{3} & y_{3}
\end{array}\right)\label{eq:611}
\end{equation}

\end_inset

如果是高阶单元则节点数目增加，但公式类似，都表示成 
\begin_inset Formula $[2,n]\times[n,2]$
\end_inset

 的矩阵乘积，最后的结果是 
\begin_inset Formula $[2,2]$
\end_inset

 矩阵。在程序中写成矩阵符号相乘的形式
\begin_inset Formula 
\begin{equation}
J=(\tilde{\nabla}N)\cdot X,\label{eq:612}
\end{equation}

\end_inset

其中
\begin_inset Formula $\tilde{\nabla}N$
\end_inset

表示形函数对 母坐标的梯度；
\begin_inset Formula $X_{\alpha j}$
\end_inset

是节点坐标矩阵，每行存入一个节点的
\begin_inset Formula $x,y,z$
\end_inset

，列数等于维度。
\end_layout

\begin_layout Remark
雅可比矩阵 
\begin_inset Formula $J$
\end_inset

 可以理解为坐标微分的变换式
\begin_inset Formula 
\begin{equation}
\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]=\left[\begin{array}{cc}
\dd{\xi} & \dd{\eta}\end{array}\right]\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]\label{eq:jac1}
\end{equation}

\end_inset


\begin_inset Formula $\dd{\xi}\to\dd{x}$
\end_inset

的逆变换的矩阵，就是 
\begin_inset Formula $[J]$
\end_inset

 的逆矩阵（
\begin_inset Formula $[J]^{-1}$
\end_inset

 ）：
\begin_inset Formula 
\begin{align}
\left[\begin{array}{cc}
\dd{\xi} & \dd{\eta}\end{array}\right] & =\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]\left[\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}\right]^{-1}\nonumber \\
 & =\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]\left[\begin{array}{cc}
\frac{\partial\xi}{\partial x} & \frac{\partial\eta}{\partial x}\\
\frac{\partial\xi}{\partial y} & \frac{\partial\eta}{\partial y}
\end{array}\right]\label{eq:jac2}
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jac1"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的Jacobi 
\begin_inset Formula $[\partial x/\partial\xi]$
\end_inset

 自变量一般是 
\begin_inset Formula $\xi$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jac2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的自变量一般是
\begin_inset Formula $x$
\end_inset

；但实际上由于 
\begin_inset Formula $(x\leftrightarrow\xi)$
\end_inset

 的坐标变换关系；
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jac1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jac2"
plural "false"
caps "false"
noprefix "false"

\end_inset

都可以用 
\begin_inset Formula $\xi$
\end_inset

或
\begin_inset Formula $x$
\end_inset

表示。
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
总结：雅可比矩阵 
\begin_inset Formula $\partial\left(x,y\right)/\partial\left(\xi,\eta\right)$
\end_inset

为
\color blue

\begin_inset Formula 
\[
J_{ki}=\tilde{\partial}_{b}X_{i}=(\tilde{\partial}_{b}\,N_{\alpha})\,X_{\alpha i},\quad J=(\tilde{\nabla}N)\cdot X
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $b,i\in\left\{ 1,2\right\} $
\end_inset

是自由度数目（
\begin_inset Formula $\xi$
\end_inset

对应行指标，
\begin_inset Formula $x$
\end_inset

对应列指标）；
\end_layout

\begin_layout Enumerate
\begin_inset Formula $X_{\alpha i}$
\end_inset

 表示节点坐标；
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是插值点的数目；
\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{\alpha}$
\end_inset

 表示形函数，
\begin_inset Formula $\tilde{\partial}$
\end_inset

表示对 
\begin_inset Formula $\xi$
\end_inset

，
\begin_inset Formula $\eta$
\end_inset

 求偏导。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
母坐标逆变换
\end_layout

\begin_layout Standard
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my61"
plural "false"
caps "false"
noprefix "false"

\end_inset

中已经给出了 母坐标
\begin_inset Formula $\rightarrow$
\end_inset

空间坐标的变换关系
\begin_inset Formula 
\begin{equation}
\sbf X=X^{T}\cdot\sbf N(\sbf\xi)\label{eq:my61b}
\end{equation}

\end_inset

其中
\begin_inset Formula $\sbf X$
\end_inset

 是空间坐标，
\begin_inset Formula $X$
\end_inset

是节点空间坐标矩阵，
\begin_inset Formula $\sbf\xi$
\end_inset

 是 母坐标，
\begin_inset Formula $\sbf N(\sbf\xi)$
\end_inset

 是形函数；
\begin_inset Formula $\sbf X$
\end_inset

与
\begin_inset Formula $\sbf\xi$
\end_inset

是维度相同的矢量。程序中的坐标是列矢量（
\begin_inset Formula $[n,1]$
\end_inset

维，列优先存储）。
\end_layout

\begin_layout Standard
在高阶单元中，
\begin_inset Formula $\sbf N(\sbf\xi)$
\end_inset

 可能是高次多项式。所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my61b"
plural "false"
caps "false"
noprefix "false"

\end_inset

是非线性坐标变换，它的逆变换形式会比较复杂。但是可以一般地，把它当成函数零点问题求解：定义 
\begin_inset Formula $\sbf F(\sbf\xi)=X^{T}\cdot\sbf N(\sbf\xi)-\sbf X$
\end_inset

，则
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my61b"
plural "false"
caps "false"
noprefix "false"

\end_inset

相当于求解多元非线性方程组 
\begin_inset Formula $\sbf F(\sbf\xi)=0$
\end_inset

，可以使用牛顿法迭代
\begin_inset Formula 
\begin{align*}
\sbf\xi_{0} & =\text{初始向量}\\
\sbf\xi_{k+1} & =\sbf\xi_{k}-D_{F}(\sbf\xi_{k})^{-1}\cdot\sbf F(\sbf\xi_{k}),\quad k=0,1,2,\cdots
\end{align*}

\end_inset

在逆变换问题中，
\begin_inset Formula $X^{T}$
\end_inset

、
\begin_inset Formula $\sbf X$
\end_inset

 均当成常数矩阵，则
\begin_inset Formula 
\begin{align*}
D_{F}(\sbf\xi_{k}) & =\left[\frac{\partial X}{\partial\xi}\right]^{T}=X^{T}\cdot(\tilde{\nabla}N)\\
J_{ji} & =(\tilde{\partial}_{j}\,N_{\alpha})\,X_{\alpha i}
\end{align*}

\end_inset

其中
\begin_inset Formula $\tilde{\nabla}N$
\end_inset

表示形函数对 母坐标（参数坐标）的梯度。这里的
\begin_inset Formula $D_{F}$
\end_inset

对应程序中
\begin_inset Formula $J^{T}$
\end_inset

。因此
\end_layout

\begin_layout Standard
\begin_inset Box ovalbox
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset Formula 
\begin{align}
\sbf\xi_{0} & =\text{初始向量}\label{eq:my610}\\
\sbf\xi_{k+1} & =\sbf\xi_{k}-\left.J\right|_{\xi_{k}}^{-1,T}\cdot\left[X_{k}-X\right],\quad k=0,1,2,\cdots\nonumber 
\end{align}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
其中
\begin_inset Formula $X_{k}=X(\xi_{k})$
\end_inset

，是对应
\begin_inset Formula $\xi_{k}$
\end_inset

的空间坐标，
\begin_inset Formula $\left.J\right|_{\xi_{k}}^{-1}$
\end_inset

是对应
\begin_inset Formula $\xi_{k}$
\end_inset

的雅可比矩阵的逆再转置。
\end_layout

\begin_layout Subsection
边界单元坐标转换
\end_layout

\begin_layout Standard
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my610"
plural "false"
caps "false"
noprefix "false"

\end_inset

给出了空间坐标
\begin_inset Formula $\rightarrow$
\end_inset

母坐标。利用这一关系，可以实现边界单元的 母坐标
\begin_inset Formula $\rightarrow$
\end_inset

体单元的 母坐标。例如二维三角形网格的边界为线段，可以实现从线段上的 母坐标 
\begin_inset Formula $(\xi)$
\end_inset

 
\begin_inset Formula $\rightarrow$
\end_inset

 所属三角形单元的 母坐标
\begin_inset Formula $(\xi,\eta)$
\end_inset

。
\end_layout

\begin_layout Standard
由于 
\begin_inset Formula $(\xi)$
\end_inset

，
\begin_inset Formula $(\xi,\eta)$
\end_inset

 是对同一几何点的两种描述，此几何点的空间坐标是不变的，利用空间坐标作为桥梁，可以实现这一转换。即
\begin_inset Formula 
\[
(\xi)\quad\rightarrow\quad(X)\quad\rightarrow\quad(\xi,\eta)
\]

\end_inset

整个过程就是不断使用 母坐标变换和逆变换。
\end_layout

\begin_layout Section
形函数的梯度G
\end_layout

\begin_layout Standard
我们来计算 形函数 对空间坐标的梯度 
\begin_inset Formula $\nabla N_{i}^{e}$
\end_inset

，它可以通过 Jacobi 矩阵，和形函数对 母坐标（
\begin_inset Formula $\xi$
\end_inset

）的梯度表示（以二维为例）
\begin_inset Formula 
\begin{align*}
\nabla N_{i}^{e} & =\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial x}\\
\frac{\partial N_{i}^{e}}{\partial y}
\end{array}\right)=\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\frac{\partial\xi}{\partial x}+\frac{\partial N_{i}^{e}}{\partial\eta}\frac{\partial\eta}{\partial x}\\
\frac{\partial N_{i}^{e}}{\partial\xi}\frac{\partial\xi}{\partial y}+\frac{\partial N_{i}^{e}}{\partial\eta}\frac{\partial\eta}{\partial y}
\end{array}\right)\\
 & =\left(\begin{array}{cc}
\frac{\partial\xi}{\partial x} & \frac{\partial\eta}{\partial x}\\
\frac{\partial\xi}{\partial y} & \frac{\partial\eta}{\partial y}
\end{array}\right)\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)=\overline{J}(\xi,\eta)\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right).
\end{align*}

\end_inset

其中
\begin_inset Formula $\overline{J}$
\end_inset

是
\begin_inset Formula $J$
\end_inset

的逆。例如对于 
\begin_inset Formula $i\in\{1,2,3\}$
\end_inset

，可以写成矩阵形式：
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
\nabla N_{1}^{e} & \nabla N_{2}^{e} & \nabla N_{3}^{e}\end{array}\right]=\overline{J}(\xi,\eta)\left(\begin{array}{ccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta}
\end{array}\right).
\]

\end_inset

维数变换是 
\begin_inset Formula $\left[2,2\right]\times\left[2,n\right]\rightarrow\left[2,n\right]$
\end_inset

。
\begin_inset Formula $J\left(\xi,\eta\right)$
\end_inset

正是
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi"
plural "false"
caps "false"
noprefix "false"

\end_inset

定义的雅可比矩阵：
\begin_inset Formula 
\[
J\left(\xi,\eta\right)=\frac{\partial\left(N_{i}^{e}x_{i},N_{i}^{e}y_{i}\right)}{\partial\left(\xi,\eta\right)}=\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right].
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
总结：在单元内动点
\begin_inset Formula $p$
\end_inset

处，形函数的物理梯度 
\begin_inset Formula $\nabla N_{i}^{e}$
\end_inset

 可以表出为
\color blue

\begin_inset Formula 
\begin{equation}
\partial_{i}N_{\alpha}^{e}=\overline{J}_{ij}\;\tilde{\partial}_{j}\,N_{\alpha}^{e}.\label{eq:gradient}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $i,j\in\left\{ 1,2\right\} $
\end_inset

是自由度数目，
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是插值点的数目；
\end_layout

\begin_layout Enumerate
维度是
\begin_inset Formula $[\text{dim},\alpha]$
\end_inset

，dim 是空间维度；
\begin_inset Formula $\alpha$
\end_inset

 是插值点数目。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\partial$
\end_inset

 表示对空间坐标 
\begin_inset Formula $\left\{ x,y\right\} $
\end_inset

 求偏导，
\begin_inset Formula $\tilde{\partial}$
\end_inset

表示对 母坐标 
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

 求偏导。
\end_layout

\end_inset


\end_layout

\begin_layout Section
单元上的积分
\end_layout

\begin_layout Subsection
数值计算，高斯积分法
\end_layout

\begin_layout Standard
在计算有限元单元上的积分时，一般先通过坐标变换，将被积表达式从物理单元 映射到 等参单元，然后通过高斯积分法（Gauss quadrature）作数值估计。假设
小单元是三角形的，被积函数是 
\begin_inset Formula $P(x,y)$
\end_inset


\begin_inset Formula 
\begin{align}
\int_{\Delta}P\left(x,y\right)\,\dd{x}\dd{y} & =\int{\color{blue}P\left(\xi,\eta\right)\,\det[J\left(\xi,\eta\right)]}\dd{\xi}\dd{\eta}\label{eq:gauss-quad}\\
 & =\sum_{m}{\color{blue}P\left(\xi_{m},\eta_{m}\right)\,\det[J\left(\xi_{m},\eta_{m}\right)]}\;W\left(\xi_{m},\eta_{m}\right)\nonumber 
\end{align}

\end_inset

其中
\begin_inset Formula $W\left(\xi_{m},\eta_{m}\right)$
\end_inset

 是高斯积分法中的权函数（Weight）。在实际使用中，一般
\begin_inset Formula $N_{i}^{e}\left(\xi,\eta\right)$
\end_inset

 的具体形式事先已经确定 ：
\end_layout

\begin_layout Enumerate
由于节点坐标 
\begin_inset Formula $\{x_{i},y_{i}\}$
\end_inset

 是已知常数，再加上知晓 
\begin_inset Formula $N_{i}^{e}\left(\xi,\eta\right)$
\end_inset

的具体形式，所以能算出雅可比矩阵 
\begin_inset Formula $J(\xi,\eta)=\partial x/\partial\xi$
\end_inset

，以及行列式
\begin_inset Formula $\det J(\xi,\eta)$
\end_inset

。
\end_layout

\begin_layout Enumerate
至于高斯积分法的采样点 
\begin_inset Formula $\left\{ p_{m}\right\} $
\end_inset

，与权函数
\begin_inset Formula $W\left(\xi_{m},\eta_{m}\right)$
\end_inset

 ，可以通过查表获取，这些结果都使用 母坐标 
\begin_inset Formula $\left(\xi,\eta\right)$
\end_inset

 表示。
\end_layout

\begin_layout Enumerate
将被积函数 
\begin_inset Formula $P\left(x_{m},y_{m}\right)$
\end_inset

 变换到 
\begin_inset Formula $P\left(\xi_{m},\eta_{m}\right)$
\end_inset

 表示：对坐标的依赖使用 坐标变换，对微分 的依赖使用雅可比矩阵 和链式法则。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\det[J]$
\end_inset

正比于几何区域的面积，例如线性三角形单元的面积
\begin_inset Formula $\Delta^{e}=\frac{1}{2}\det[J]$
\end_inset

。在 Solver程序中，这个几何因子（
\begin_inset Formula $1/2$
\end_inset

）被吸收进 权重因子 
\begin_inset Formula $W_{i}^{\prime}$
\end_inset

，因此 Solver程序中高斯积分法的公式写作：
\begin_inset Formula 
\[
\iint_{\Omega^{e}}P\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{x}\dd{y}=\sum_{i=1}^{m}P\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset

这里的
\begin_inset Formula $L_{i}^{e}$
\end_inset

只是
\begin_inset Formula $\{1-\xi-\eta,\xi,\eta\}$
\end_inset

的另一种写法。
\end_layout

\begin_layout Subsection
解析计算
\end_layout

\begin_layout Standard
参考金建铭4.3.3.1。线性三角形单元上的一阶形函数积分满足下式
\begin_inset Formula 
\begin{equation}
\iint_{\Omega^{e}}\left(N_{1}^{e}\right)^{l}\left(N_{2}^{e}\right)^{m}\left(N_{3}^{e}\right)^{n}\dd{x}\dd{y}=\frac{l!m!n!}{\left(l+m+n+2\right)!}2\Delta^{e}.\label{eq:jm4.32}
\end{equation}

\end_inset

其中
\begin_inset Formula $\Delta^{e}$
\end_inset

是三角形的面积，
\begin_inset Formula $\Delta^{e}=\frac{1}{2}\det[J]$
\end_inset

。
\end_layout

\begin_layout Section
计算刚阵
\end_layout

\begin_layout Standard
再次列出静电场的泊松方程：
\begin_inset Formula 
\[
\sbf\nabla\left(\alpha\cdot\sbf\nabla\phi\right)+\beta\phi=f,\quad\left(x,y\right)\in\Omega.
\]

\end_inset

它对应的刚阵是
\begin_inset Formula 
\begin{align*}
 & K_{ij}^{e}=\iint_{\Omega^{e}}\left[(\nabla N_{i}^{e})\cdot\alpha\cdot(\nabla N_{j}^{e})+\beta N_{i}^{e}N_{j}^{e}\right]\dd{x}\dd{y},\\
 & b_{i}^{e}=\iint_{\Omega^{e}}fN_{i}^{e}\dd{x}\dd{y},\quad i,j=1,2,3
\end{align*}

\end_inset

代入前文讨论中的公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gradient"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gauss-quad"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到
\begin_inset Formula 
\[
K_{ij}^{e}=\iint_{\Omega^{e}}\left[\left(\tilde{\nabla}N\right)_{i}^{\mathrm{T}}\cdot\overline{J}^{\mathrm{T}}\cdot\alpha\,\overline{J}\cdot\left(\tilde{\nabla}N\right)_{j}+\beta N_{i}^{e}N_{j}^{e}\right]{\color{blue}\det\left[J\right]}\,\dd{\xi}\dd{\eta}
\]

\end_inset

其中 
\begin_inset Formula $\left(\tilde{\nabla}N\right)_{i}=\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)$
\end_inset

，是单元上第
\begin_inset Formula $i$
\end_inset

个形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

 对
\begin_inset Formula $\xi$
\end_inset

的梯度；上标中的
\begin_inset Formula $\,^{\mathrm{T}}$
\end_inset

表示矩阵转置。
\end_layout

\begin_layout Example
对于二维的一阶三角形（线性）单元，代入形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

的定义，得到雅可比矩阵 
\begin_inset Formula $[\partial X/\partial\xi]$
\end_inset

 为：
\begin_inset Formula 
\[
J\left(\xi,\eta\right)=\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{i} & y_{i}\end{array}\right)=\left(\begin{array}{cc}
x_{1}-x_{3} & y_{1}-y_{3}\\
x_{2}-x_{3} & y_{2}-y_{3}
\end{array}\right)=\left(\begin{array}{cc}
x_{1}-x_{3} & y_{1}-y_{3}\\
x_{2}-x_{3} & y_{2}-y_{3}
\end{array}\right)=\left[\begin{array}{cc}
c_{2}^{e} & -b_{2}^{e}\\
-c_{1}^{e} & b_{1}^{e}
\end{array}\right]
\]

\end_inset

因此对应的逆矩阵
\begin_inset Formula $\overline{J}$
\end_inset

，以及 
\begin_inset Formula $\overline{J}^{\mathrm{T}}\cdot\overline{J}$
\end_inset

为，
\begin_inset Formula 
\begin{align}
 & \overline{J}\left(\xi,\eta\right)=\frac{1}{2\Delta^{e}}\left[\begin{array}{cc}
b_{1}^{e} & b_{2}^{e}\\
c_{1}^{e} & c_{2}^{e}
\end{array}\right],\quad J^{-1,T}\left(\xi,\eta\right)=\frac{1}{2\Delta^{e}}\left[\begin{array}{cc}
b_{1}^{e} & c_{1}^{e}\\
b_{2}^{e} & c_{2}^{e}
\end{array}\right],\nonumber \\
 & \overline{J}^{\mathrm{T}}\cdot\overline{J}=\frac{1}{4\Delta^{e,2}}\left[\begin{array}{cc}
b_{1}^{e,2}+c_{1}^{e,2} & b_{1}^{e}b_{2}^{e}+c_{1}^{e}c_{2}^{e}\\
b_{1}^{e}b_{2}^{e}+c_{1}^{e}c_{2}^{e} & b_{2}^{e,2}+c_{2}^{e,2}
\end{array}\right]\label{eq:my-JJ}
\end{align}

\end_inset

列出二维一阶形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

的表达式：
\begin_inset Formula 
\[
N_{1}^{(1)}=1-\xi-\eta,\quad N_{2}^{(1)}=\xi,\quad N_{3}^{(1)}=\eta
\]

\end_inset


\begin_inset Formula $N_{i}^{e}$
\end_inset

对
\begin_inset Formula $\xi$
\end_inset

的梯度为
\begin_inset Formula 
\begin{equation}
\left(\tilde{\nabla}N\right)_{i}=\left(\begin{array}{ccc}
-1 & 1 & 0\\
-1 & 0 & 1
\end{array}\right),\label{eq:my-gradN}
\end{equation}

\end_inset

其中参数
\begin_inset Formula $\xi$
\end_inset

作为行指标，形函数编号
\begin_inset Formula $i$
\end_inset

作为列指标。
\end_layout

\begin_layout Example
从表达式易知，
\begin_inset Formula $K_{ij}$
\end_inset

为对称阵，
\begin_inset Formula 
\[
K_{ij}^{e}=\iint_{\Omega^{e}}\left[\left(\tilde{\nabla}N\right)_{i}^{\mathrm{T}}\cdot J^{-1,\mathrm{T}}\cdot\alpha J^{-1}\cdot\left(\tilde{\nabla}N\right)_{j}+\beta N_{i}^{e}N_{j}^{e}\right]\,\dd{x}\dd{y}
\]

\end_inset

从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my-JJ"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my-gradN"
plural "false"
caps "false"
noprefix "false"

\end_inset

可知，
\begin_inset Formula $K_{ij}$
\end_inset

被积式第一项为常数，使用解析公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jm4.32"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到积分结果是 
\begin_inset Formula $\frac{1}{4\Delta^{e}}\left(\alpha_{x}^{e}b_{i}^{e}b_{j}^{e}+\alpha_{y}^{e}c_{i}^{e}c_{j}^{e}\right)$
\end_inset

（这里还考虑了更一般地，
\begin_inset Formula $\alpha$
\end_inset

非各向同性）。同理，使用解析公式，被积式第二项的积分结果是
\begin_inset Formula $\frac{\Delta^{e}}{12}\beta^{e}(1+\delta_{ij})$
\end_inset

。
\begin_inset Formula $b_{i}^{e}$
\end_inset

的积分也可套公式得出。综合起来便是
\begin_inset Newline newline
\end_inset


\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset Formula 
\begin{align}
 & K_{ij}^{e}=\frac{1}{4\Delta^{e}}\left(\alpha_{x}^{e}b_{i}^{e}b_{j}^{e}+\alpha_{y}^{e}c_{i}^{e}c_{j}^{e}\right)+\frac{\Delta^{e}}{12}\beta^{e}\left(1+\delta_{ij}\right)\label{eq:jm4.33}\\
 & b_{i}^{e}=\frac{\Delta^{e}}{3}f^{e}\label{eq:jm4.34}
\end{align}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
以上使用了： 
\begin_inset Formula 
\begin{align*}
 & N_{1}^{e}=\frac{\Delta_{1}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{1}^{e}+b_{1}^{e}x+c_{1}^{e}y}{2}=1-\xi-\eta,\\
 & N_{2}^{e}=\frac{\Delta_{2}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{2}^{e}+b_{2}^{e}x+c_{2}^{e}y}{2}=\xi,\\
 & N_{3}^{e}=\frac{\Delta_{3}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{3}^{e}+b_{3}^{e}x+c_{3}^{e}y}{2}=\eta.
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align}
 & a_{1}^{e}=x_{2}^{e}y_{3}^{e}-y_{2}^{e}x_{3}^{e}; &  & b_{1}^{e}=y_{2}^{e}-y_{3}^{e}; &  & c_{1}^{e}=x_{3}^{e}-x_{2}^{e}\nonumber \\
 & a_{2}^{e}=x_{3}^{e}y_{1}^{e}-y_{3}^{e}x_{1}^{e}; &  & b_{2}^{e}=y_{3}^{e}-y_{1}^{e}; &  & c_{2}^{e}=x_{1}^{e}-x_{3}^{e}\label{eq:4.24-1}\\
 & a_{3}^{e}=x_{1}^{e}y_{2}^{e}-y_{1}^{e}x_{2}^{e}; &  & b_{3}^{e}=y_{1}^{e}-y_{2}^{e}; &  & c_{3}^{e}=x_{2}^{e}-x_{1}^{e}\nonumber 
\end{align}

\end_inset

满足 
\begin_inset Formula $\sum b_{i}=0$
\end_inset

，
\begin_inset Formula $\sum c_{i}=0$
\end_inset

。
\begin_inset Formula 
\[
\Delta^{e}=\frac{1}{2}\left|\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right|=\frac{1}{2}\left(b_{2}^{e}c_{3}^{e}-b_{3}^{e}c_{2}^{e}\right)=\text{第}e\text{个单元的面积}
\]

\end_inset

普通坐标和 母坐标之间的变换为：
\begin_inset Formula 
\begin{align*}
 & \left[\begin{array}{c}
x\\
y
\end{array}\right]=\left[\begin{array}{cc}
c_{3}^{e} & -c_{2}^{e}\\
-b_{3}^{e} & b_{2}^{e}
\end{array}\right]\left[\begin{array}{c}
\xi\\
\eta
\end{array}\right]+\left[\begin{array}{c}
x_{1}^{e}\\
y_{1}^{e}
\end{array}\right],\\
 & \left[\begin{array}{c}
\xi\\
\eta
\end{array}\right]=\frac{1}{2\Delta^{e}}\left\{ \left[\begin{array}{cc}
b_{2}^{e} & c_{2}^{e}\\
b_{3}^{e} & c_{3}^{e}
\end{array}\right]\left[\begin{array}{c}
x\\
y
\end{array}\right]+\left[\begin{array}{c}
a_{2}^{e}\\
a_{3}^{e}
\end{array}\right]\right\} ,\\
 & \frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\det J={\color{blue}\left(b_{2}^{e}c_{3}^{e}-b_{3}^{e}c_{2}^{e}\right)}=2{\color{blue}\Delta^{e}}.
\end{align*}

\end_inset


\end_layout

\begin_layout Chapter
矩阵方程与边界条件
\end_layout

\begin_layout Standard
以静电场方程为例，在很多情况它下它可以化为如下形式
\begin_inset Formula 
\begin{equation}
-\nabla\cdot\left(\varepsilon\nabla\phi\right)+\beta\phi=\rho(x)\label{eq:xl1.27}
\end{equation}

\end_inset

一般有边界条件
\begin_inset Formula 
\begin{align}
\phi & =p\quad\text{on}\quad\Gamma_{1}\label{eq:xl1.28}\\
\left(\varepsilon\nabla\phi\right)\cdot\sbf e_{n}+\gamma\phi & =q\quad\text{on}\quad\Gamma_{2}\label{eq:xl1.29}
\end{align}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.27"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.28"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.29"
plural "false"
caps "false"
noprefix "false"

\end_inset

所对应的方程等价于
\begin_inset Formula 
\begin{align}
 & \delta\mathcal{F}(\phi)=0\label{eq:xl1.30}\\
 & \phi=p\quad\text{on}\quad\Gamma_{1}\nonumber 
\end{align}

\end_inset

其中 
\begin_inset Formula $\mathcal{F}(\phi)$
\end_inset

 的构造见下文。
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.29"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的边界条件在
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.30"
plural "false"
caps "false"
noprefix "false"

\end_inset

中自动满足，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.28"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的边界条件可以通过适当的方式在有限元计算中添加。
\end_layout

\begin_layout Standard
不管是Ritz方法，还是Galerkin方法，
\series bold
泛函或残差的线性律都是非常重要的保证
\series default
。因为线性律，才可以把刚阵和力向量的计算，分解成导出局域矩阵和组装为全局矩阵两步。
\end_layout

\begin_layout Section
Ritz方法
\end_layout

\begin_layout Standard
在有限元框架下，
\begin_inset Formula $\mathcal{F}(\phi)$
\end_inset

 可以表示为
\begin_inset Formula 
\[
\mathcal{F}(\phi)=\sum_{e=1}^{M}\mathcal{F}^{e}\left(\phi^{e}\right)+\sum_{s=1}^{N}\mathcal{F}^{s}\left(\phi^{s}\right)
\]

\end_inset

其中
\begin_inset Formula $M$
\end_inset

是总的有限元单元数，
\begin_inset Formula $N$
\end_inset

 为表面边界单元的数目。而
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}\left(\phi^{e}\right) & =\frac{1}{2}\int_{\Omega^{e}}\left[(\nabla\phi^{e})\cdot\varepsilon(\nabla\phi^{e})+\beta\phi^{e;2}\right]\dd{\Omega}-\int_{\Omega^{e}}\rho\phi^{e}\dd{\Omega}\\
\mathcal{F}^{s}\left(\phi^{s}\right) & =\int_{\Gamma^{e}}\left[\frac{\gamma}{2}\left(\phi^{s}\right)^{2}-q\phi^{s}\right]\dd{\Gamma}
\end{align*}

\end_inset

泛函变分方程
\begin_inset Formula $\delta\mathcal{F}(\phi)=0$
\end_inset

给出对应的电势场方程和边界条件
\begin_inset Formula 
\begin{align*}
-\nabla\cdot\left(\varepsilon\nabla\phi\right)+\beta\phi & =\rho\\
\varepsilon\frac{\partial\phi}{\partial n}+\gamma\phi & =q\quad\text{on}\quad\Gamma_{2}
\end{align*}

\end_inset

其中考虑了分部积分给出的边界项 
\begin_inset Formula $\int_{\Gamma}\phi\varepsilon\frac{\partial\phi}{\partial n}\dd{\Gamma}$
\end_inset

，
\begin_inset Formula $\frac{\partial\phi}{\partial n}$
\end_inset

可以表示为
\begin_inset Formula $\nabla\phi\cdot\sbf e_{n}$
\end_inset

。
\end_layout

\begin_layout Remark
对于形如 
\begin_inset Formula $\mathcal{F}(\phi)=\frac{1}{2}\int_{\Omega}\left[(\nabla\phi)\cdot\varepsilon(\nabla\phi)\right]\dd{V}$
\end_inset

的泛函，使用第一标量格林定理
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jA.19"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\begin{align}
\mathcal{F}(\phi)= & \frac{1}{2}\int_{\Omega}\left[(\nabla\phi)\cdot\varepsilon(\nabla\phi)\right]\dd{V}+\int_{\Gamma}\left[\frac{\gamma}{2}\left(\phi^{s}\right)^{2}-q\phi^{s}\right]\dd{\Gamma}\label{eq:ym1}\\
= & -\frac{1}{2}\int_{\Omega}\phi\nabla\cdot\left(\varepsilon\nabla\phi\right)\dd{V}\label{eq:ym2}\\
 & +\oint_{\Gamma}\left[\frac{\varepsilon}{2}\phi^{s}\frac{\partial}{\partial n}\phi^{s}+\frac{\gamma}{2}\left(\phi^{s}\right)^{2}-q\phi^{s}\right]\dd{\sbf\Gamma}
\end{align}

\end_inset

考虑欧拉–拉格朗日方程：
\begin_inset Formula 
\[
\frac{\partial\mathcal{F}}{\partial\phi}=\partial_{\mu}\frac{\partial\mathcal{F}}{\partial(\partial_{\mu}\phi)},
\]

\end_inset

注意到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ym1"
plural "false"
caps "false"
noprefix "false"

\end_inset

是
\begin_inset Formula ${\color{blue}\nabla\phi}$
\end_inset

的二次型，代入E–L 方程求偏导时会有系数
\begin_inset Formula $2$
\end_inset

（刚好用来抵消
\begin_inset Formula $1/2$
\end_inset

）；相应地，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ym2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $\phi\nabla^{2}\phi$
\end_inset

 应该看作 
\begin_inset Formula $\phi$
\end_inset

 的二次型，其中的
\begin_inset Formula $\nabla^{2}$
\end_inset

应该看作类似 二次型的系数矩阵，只不过这里是无穷维线性空间，所以变成了算符
\begin_inset Formula $\nabla^{2}$
\end_inset

。只有这样，在使用高斯定理前后，E–L方程左右才能平衡，并给出相同的结果。另一方面，在推导 E–L 方程一开始就假设泛函 
\begin_inset Formula $\mathcal{F}$
\end_inset

的依赖形式是
\begin_inset Formula $\mathcal{F}(\phi,\nabla\phi)$
\end_inset

，即泛函依赖不包括 
\begin_inset Formula $\nabla^{2}\phi$
\end_inset

。从这个角度，我们也只能把 
\begin_inset Formula $\nabla^{2}\phi$
\end_inset

 看作是
\begin_inset Formula $\nabla^{2}$
\end_inset

作用在
\begin_inset Formula $\phi$
\end_inset

上，而不是把
\begin_inset Formula $\nabla^{2}\phi$
\end_inset

当作独立依赖。
\end_layout

\begin_layout Standard

\series bold
系统的泛函
\begin_inset Formula $\mathcal{F}(\phi)$
\end_inset

可以做局域分解，表示成线性和
\series default
，这一点十分重要：
\begin_inset Formula 
\begin{equation}
\mathcal{F}(\phi)=\sum_{e=1}^{M}\mathcal{F}^{e}(\phi)\label{eq:global-fl}
\end{equation}

\end_inset

单元中的
\begin_inset Formula $\phi$
\end_inset

可以用每个单元的形函数和单元节点上的
\begin_inset Formula $\phi_{i}$
\end_inset

表示为
\begin_inset Formula 
\[
\phi=\sum_{\alpha}N_{\alpha}^{e}\phi_{\alpha},
\]

\end_inset


\begin_inset Formula $\alpha$
\end_inset

是节点编号。因此
\begin_inset Formula $\mathcal{F}^{e}(\phi)$
\end_inset

可以表示为
\begin_inset Formula 
\[
\mathcal{F}^{e}(\phi)=\frac{1}{2}\int_{\Omega^{e}}\left(\nabla N_{i}^{e}\cdot\varepsilon_{r}\cdot\nabla N_{j}^{e}\right)\phi_{i}\phi_{j}\dd{\Omega}-\int_{\Omega^{e}}\frac{\rho}{\varepsilon_{0}}N_{i}^{e}\phi_{i}\dd{\Omega}.
\]

\end_inset

在这一步中，不可数自由度的连续体系被离散为有限自由度体系，自由度为
\begin_inset Formula $\phi_{i}$
\end_inset

。计算
\begin_inset Formula $\mathcal{F}^{e}$
\end_inset

对
\begin_inset Formula $\phi_{i}$
\end_inset

的导数可以得到
\begin_inset Formula 
\begin{equation}
\frac{\partial\mathcal{F}^{e}(\phi)}{\partial\phi_{i}}=K_{ij}^{e}\phi_{j}-b_{i}^{e}\label{eq:ritz2}
\end{equation}

\end_inset

其中
\begin_inset Formula 
\begin{align}
K_{ij}^{e} & =\int_{\Omega^{e}}\left(\nabla N_{i}^{e}\cdot\varepsilon_{r}\cdot\nabla N_{j}^{e}\right)\dd{\Omega},\label{eq:ritz0}\\
b_{i}^{e} & =\int_{\Omega^{e}}\frac{\rho}{\varepsilon_{0}}N_{i}^{e}\dd{\Omega}\nonumber 
\end{align}

\end_inset

其中
\begin_inset Formula $i,j$
\end_inset

表示单元上的局域节点编号。二阶偏导转化成二次型，一次项转化成常数项。根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:global-fl"
plural "false"
caps "false"
noprefix "false"

\end_inset

的
\begin_inset Formula $\delta\mathcal{F}(\phi)=0$
\end_inset

，可以得到矩阵方程
\begin_inset Formula 
\begin{equation}
\sum_{e}\left\{ \frac{\partial\mathcal{F}^{e}}{\partial\phi_{i}}\right\} =\sum_{e=1}^{M}[K_{ij}^{e}]\{\phi_{j}\}-\sum_{e=1}^{M}\{b_{i}^{e}\}=\{0\}.\label{eq:ritz1}
\end{equation}

\end_inset

这里仍然使用了
\series bold
线性律
\series default
，
\begin_inset Formula $\delta\mathcal{F}(\phi)=\delta\sum\mathcal{F}^{e}(\phi)$
\end_inset

。其中
\begin_inset Formula $i,j$
\end_inset

 表示全局节点编号，为求简便没有和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ritz2"
plural "false"
caps "false"
noprefix "false"

\end_inset

区分符号。除了
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ritz1"
plural "false"
caps "false"
noprefix "false"

\end_inset

之外，还要加上必要边界条件才能完全确定所有
\begin_inset Formula $\phi_{i}$
\end_inset

。
\end_layout

\begin_layout Remark
通过
\series bold
线性律
\series default
，泛函导数
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ritz2"
plural "false"
caps "false"
noprefix "false"

\end_inset

的计算可以在单元上迭代，即在每个单元上独立进行，方便于编程实现。但泛函极值条件
\begin_inset Formula $\delta\mathcal{F}(\phi)=0$
\end_inset

或
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ritz1"
plural "false"
caps "false"
noprefix "false"

\end_inset

需要在全局意义上满足。因为本身微分方程就是描述大块求解区域而不是独立单元的，不同单元的相邻节点之间存在约束，通过约束关系最终给定所有节点的值。所以中间还需要一个
\series bold
组合
\series default
的过程。具体来说，需要将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ritz0"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的局域矩阵 
\begin_inset Formula $K_{ij}^{e},b_{i}^{e}$
\end_inset

，例如
\begin_inset Formula $3\times3$
\end_inset

（每个单元的节点总数）；通过填
\begin_inset Formula $0$
\end_inset

扩充成全局矩阵，例如
\begin_inset Formula $100\times100$
\end_inset

（全局节点总数）。然后将扩充得到的稀疏矩阵全部相加，最终给出稀疏的带状矩阵。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
为什么是稀疏的带状矩阵：单元上的局域
\begin_inset Formula $K_{ij}^{e}$
\end_inset

描述单元内节点的相互作用，例如三角形三个节点上电势的约束关系
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/ele-tri3-2.pdf
	lyxscale 150
	scale 80

\end_inset


\begin_inset Formula 
\[
K_{ij}^{(1)}=\left[\begin{array}{ccc}
K_{11}^{(1)} & K_{12}^{(1)} & K_{13}^{(1)}\\
K_{21}^{(1)} & K_{22}^{(1)} & K_{23}^{(1)}\\
K_{31}^{(1)} & K_{32}^{(1)} & K_{33}^{(1)}
\end{array}\right],\quad K_{ij}^{(2)}={\color{blue}\left[\begin{array}{ccc}
K_{44}^{(2)} & K_{42}^{(2)} & K_{43}^{(2)}\\
K_{24}^{(2)} & K_{22}^{(2)} & K_{23}^{(2)}\\
K_{34}^{(2)} & K_{32}^{(2)} & K_{33}^{(2)}
\end{array}\right]}
\]

\end_inset

上标
\begin_inset Formula $(1)$
\end_inset

表示单元
\begin_inset Formula $(1)$
\end_inset

；
\begin_inset Formula $K_{11}^{(1)}$
\end_inset

描述单元
\begin_inset Formula $(1)$
\end_inset

中节点
\begin_inset Formula $1$
\end_inset

的“动能项”；
\begin_inset Formula $K_{12}^{(1)}$
\end_inset

描述节点
\begin_inset Formula $1,2$
\end_inset

的相互作用，并且
\begin_inset Formula $K_{12}^{(1)}=K_{21}^{(1)}$
\end_inset

，其余类似。为了方便示意，在
\begin_inset Formula $K_{ij}^{(2)}$
\end_inset

中直接使用了节点的全局编号。全局节点一共
\begin_inset Formula $4$
\end_inset

个，所以组合过程是
\begin_inset Formula 
\[
[K_{ij}^{(1)}]+[K_{ij}^{(2)}]=\left[\begin{array}{cccc}
K_{11}^{(1)} & K_{12}^{(1)} & K_{13}^{(1)} & 0\\
K_{21}^{(1)} & K_{22}^{(1)}+{\color{blue}K_{22}^{(2)}} & K_{23}^{(1)}+{\color{blue}K_{23}^{(2)}} & {\color{blue}K_{24}^{(2)}}\\
K_{31}^{(1)} & K_{32}^{(1)}+{\color{blue}K_{32}^{(2)}} & K_{33}^{(1)}+{\color{blue}K_{33}^{(2)}} & {\color{blue}K_{34}^{(2)}}\\
0 & {\color{blue}K_{42}^{(2)}} & {\color{blue}K_{43}^{(2)}} & {\color{blue}K_{44}^{(2)}}
\end{array}\right]
\]

\end_inset

上式以不同颜色标示了，两个局域单元的矩阵如何“混杂”到全局矩阵中，这些元素均可明确计算出。
\begin_inset Formula $1,4$
\end_inset

节点没有直接相互作用，因此全局矩阵
\begin_inset Formula $(1,4)$
\end_inset

，
\begin_inset Formula $(4,1)$
\end_inset

位置为零。其中的混合项 
\begin_inset Formula $K_{22}^{(1)}+{\color{blue}K_{22}^{(2)}}$
\end_inset

，
\begin_inset Formula $K_{33}^{(1)}+{\color{blue}K_{33}^{(2)}}$
\end_inset

，
\begin_inset Formula $K_{23}^{(1)}+{\color{blue}K_{23}^{(2)}}$
\end_inset

是由于边（2–3）是公共边，这些项描述了一个单元中的值如何“过渡”到另一个单元中。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Subsection
方程的量纲
\end_layout

\begin_layout Standard
对于静电场问题
\begin_inset Formula 
\[
K\phi=b
\]

\end_inset

其中
\begin_inset Formula $K_{ij}^{e}=\int_{\Omega^{e}}\left(\nabla N_{i}^{e}\cdot\varepsilon_{r}\cdot\nabla N_{j}^{e}\right)\dd{\Omega}$
\end_inset

的量纲是 
\begin_inset Formula $\mathrm{m}^{3}/\mathrm{m}/\mathrm{m}=\mathrm{m}$
\end_inset

，
\begin_inset Formula $\phi$
\end_inset

的量纲是（
\begin_inset Formula $\mathrm{V}$
\end_inset

），
\begin_inset Formula $b_{i}^{e}=\int_{\Omega^{e}}\frac{\rho}{\varepsilon_{0}}N_{i}^{e}\dd{\Omega}$
\end_inset

 的量纲是（ 
\begin_inset Formula $\mathrm{m\,V}$
\end_inset

）。
\end_layout

\begin_layout Section
Galerkin方法
\end_layout

\begin_layout Standard
ref: FEM-Gerard;p45/61;sec 1.3.11。静电场的基础公式是 ：
\begin_inset Formula 
\begin{align*}
 & \nabla\cdot\sbf D=\rho,\quad\sbf D=-\varepsilon\cdot\nabla\phi\\
 & -\nabla\cdot\left(\varepsilon\cdot\nabla\phi\right)=\rho
\end{align*}

\end_inset

类似Ritz方法中的泛函
\begin_inset Formula $\mathcal{F}(\phi)$
\end_inset

，全局残差
\begin_inset Formula $R(\phi)$
\end_inset

同样满足
\series bold
线性律
\series default
，可以表示成单元残差的线性和
\begin_inset Formula 
\begin{equation}
R(\phi)=\sum_{e}R^{e}\left(\phi;N_{\alpha}^{e}\right).\label{eq:gal0}
\end{equation}

\end_inset

在每个单元上，令加权的残差（residual error）和 为
\begin_inset Formula 
\begin{align}
R^{e}\left(\phi;N_{\alpha}^{e}\right) & =\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}N_{\alpha}^{e}\left({\color{blue}\nabla\cdot\sbf D}-\rho\right)\dd{\Omega}\label{eq:gal00}\\
\text{分部积分} & \Rightarrow{\color{blue}-\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}\nabla N_{\alpha}^{e}\cdot\sbf D\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}\nabla\cdot\left(N_{\alpha}^{e}\sbf D\right)\dd{\Omega}}-\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\nonumber \\
\text{散度定理} & \Rightarrow-\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\sbf D}\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}-\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\nonumber 
\end{align}

\end_inset

上面使用了分部积分，和高斯散度定理；通过分部积分引入了边界条件项 
\begin_inset Formula ${\color{brown}N_{\alpha}^{e}\sbf n\cdot\sbf D}$
\end_inset

。电势
\begin_inset Formula $\phi$
\end_inset

（电场
\begin_inset Formula $\sbf E$
\end_inset

）的稳态分布应该满足
\begin_inset Formula $R^{e}\left(\phi;N_{\alpha}^{e}\right)=0$
\end_inset

，即
\begin_inset Formula 
\begin{equation}
\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\sbf D}\dd{\Omega}=-\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}\label{eq:gal1}
\end{equation}

\end_inset

例如对于线性导体 
\begin_inset Formula $\sbf D=\varepsilon\sbf E$
\end_inset

，上式可以写成：
\begin_inset Formula 
\begin{equation}
\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\varepsilon\cdot\nabla\phi}\dd{\Omega}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\sbf n\cdot\varepsilon\cdot\nabla\phi}\dd{\Gamma}=\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\label{eq:gal2}
\end{equation}

\end_inset

对于齐次第二类（natural）边界条件 
\begin_inset Formula $\left(\alpha\nabla\phi\right)\cdot\sbf n=0$
\end_inset

（电位移 
\begin_inset Formula $\sbf D$
\end_inset

 平行于边界），可以直接去掉 
\begin_inset Formula $\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}$
\end_inset

 项。
\end_layout

\begin_layout Section
场的迭代方程
\end_layout

\begin_layout Standard
式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my4"
plural "false"
caps "false"
noprefix "false"

\end_inset

中已经给出了改进FPI的迭代步骤，应用到非线性矩阵方程
\begin_inset Formula $KD=b$
\end_inset

得
\begin_inset Formula 
\begin{align}
 & D_{0}=\text{初始估计}\nonumber \\
 & \Delta D_{i+1}=\lambda_{i}\left[K^{-1}\,b-D_{i}\right].\label{eq:gal3a}
\end{align}

\end_inset


\end_layout

\begin_layout Itemize
这里的待求自由度实际上还是节点电势，
\begin_inset Formula $D=-\varepsilon\cdot\nabla N_{\beta}\phi_{\beta}$
\end_inset

。只不过材料的曲线
\begin_inset Formula $D=D(E)$
\end_inset

 是非线性的（一般情况下也可能各向异性），也就是
\begin_inset Formula $D$
\end_inset

和
\begin_inset Formula $\phi_{\beta}$
\end_inset

的关系是非线性的。
\end_layout

\begin_layout Itemize
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal3a"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的
\begin_inset Formula $K$
\end_inset

，
\begin_inset Formula $b$
\end_inset

 也可能依赖于
\begin_inset Formula $\phi_{\beta}$
\end_inset

。此外逆矩阵
\begin_inset Formula $K^{-1}$
\end_inset

算起来比较麻烦。让我们回忆FPI的本质：它只需要给出根
\begin_inset Formula $x_{0}$
\end_inset

附近，方程左右不平衡性
\begin_inset Formula $\Delta x$
\end_inset

的估计方程。
\end_layout

\begin_layout Standard
因此直接对
\begin_inset Formula $D$
\end_inset

进行线性化
\begin_inset Formula 
\begin{equation}
KD=b,\quad\&\quad D=D^{0}+\left.\frac{\partial D}{\partial E}\right|_{D^{0}}\Delta E\label{eq:gal3b}
\end{equation}

\end_inset

联合给出
\begin_inset Formula 
\begin{align}
 & D_{0}=\text{初始估计},\nonumber \\
 & K_{i}\,\Delta D_{i+1}=\lambda_{i,\beta}\left[b_{i}-K_{i}\,D_{i}\right].\label{eq:gal3c}
\end{align}

\end_inset

其中已经引入了改善因子
\begin_inset Formula $\lambda_{i,\beta}$
\end_inset

。在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal3b"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，随着
\begin_inset Formula $D_{i}$
\end_inset

 收敛到根（渐进意义），
\begin_inset Formula $\Delta D$
\end_inset

越来越小，
\begin_inset Formula $\lim_{i\to\infty}\Delta D=\left.\frac{\partial D}{\partial E}\right|_{D^{0}}\Delta E$
\end_inset

。当
\begin_inset Formula $\Delta D_{i+1}$
\end_inset

和
\begin_inset Formula $b-K\,D_{i}$
\end_inset

都趋于零时，方程的不平衡性消除，迭代收敛到根；
\begin_inset Formula $\lambda$
\end_inset

的取值对最终根的位置没有影响，只是改善了这个过程。另一方面，也可以理解成
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal3a"
plural "false"
caps "false"
noprefix "false"

\end_inset

左右同乘刚阵
\begin_inset Formula $K$
\end_inset

。
\end_layout

\begin_layout Itemize
在程序中，计算 
\begin_inset Formula $K$
\end_inset

和
\begin_inset Formula $F_{\text{in}}$
\end_inset

（内力，见下文）使用的
\begin_inset Formula $\phi_{j}$
\end_inset

不是同步的。指标
\begin_inset Formula $i$
\end_inset

 标记非线性迭代步，
\begin_inset Formula $\beta$
\end_inset

标记线搜索次数；每次
\series bold
非线性迭代
\series default
都会再调用
\series bold
线搜索迭代
\series default
确定合适的
\begin_inset Formula $\lambda_{i,\beta}$
\end_inset

，即每一个
\begin_inset Formula $i$
\end_inset

可能对应多个
\begin_inset Formula $\beta$
\end_inset

。
\end_layout

\begin_layout Itemize
每一步非线性迭代中，
\begin_inset Formula $K$
\end_inset

可以保持不变，即
\begin_inset Formula $K_{i}$
\end_inset

；而 
\begin_inset Formula $F_{\text{in}}$
\end_inset

 需要随着 
\begin_inset Formula $\lambda_{i,\beta}$
\end_inset

 不停更新；当线搜索成功时，使用此时的
\begin_inset Formula $K_{i}$
\end_inset

，
\begin_inset Formula $F_{\text{in};i,\beta}$
\end_inset

 计算新的增量
\begin_inset Formula $\Delta\phi_{j}$
\end_inset

。因此 
\begin_inset Formula $K_{i}$
\end_inset

 的计算中，
\begin_inset Formula $\phi_{j}$
\end_inset

 使用 ACCUM 的结果； 
\begin_inset Formula $F_{\text{in}}$
\end_inset

 的计算中，
\begin_inset Formula $\phi_{j}$
\end_inset

 使用 
\begin_inset Formula $\text{ACCUM}+\text{SEARCH}$
\end_inset

 的结果。当达到收敛值时，SEACH 为零，两边是同步的。
\end_layout

\begin_layout Standard
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中给出了静电场问题的方程
\begin_inset Formula 
\[
\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot D}\dd{\Omega}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\sbf n\cdot D}\dd{\Gamma}=-\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}
\]

\end_inset

于是得到（以下变化量用
\begin_inset Formula $\delta\phi$
\end_inset

表示）
\begin_inset Formula 
\begin{align}
 & \frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\kappa(E^{0})\cdot\nabla\delta\phi}\dd{\Omega}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,\sbf n\cdot\kappa(E^{0})\cdot\nabla\delta\phi}\dd{\Gamma}\nonumber \\
 & =-\lambda\left[\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\varepsilon(E^{0})\cdot\nabla\phi^{0}}\dd{\Omega}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,\sbf n\cdot\varepsilon(E^{0})\cdot\nabla\phi^{0}}\dd{\Gamma}\right]+\lambda\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\label{eq:gal3}
\end{align}

\end_inset

其中 
\begin_inset Formula $\kappa(E)=\partial D/\partial E$
\end_inset

，
\begin_inset Formula $\varepsilon(E)=D/E$
\end_inset

，在几何上分别对应材料曲线的切线斜率和截线斜率。在迭代初期
\begin_inset Formula $\Delta D_{i+1}$
\end_inset

与
\begin_inset Formula $\frac{\partial D}{\partial E}\Delta E$
\end_inset

虽然偏离较大，但只要能收敛到根即可，即只需在渐近意义上成立。
\end_layout

\begin_layout Enumerate
方程左边组成
\begin_inset Formula $\delta\phi$
\end_inset

的“
\series bold
刚阵
\series default
”，由体单元和表面单元两部分的贡献组成；
\end_layout

\begin_layout Enumerate
方程右边的总和称为“
\series bold
力向量
\series default
”（也叫“激励向量”）反映了当前体系偏离平衡态的程度。
\begin_inset Formula $[\cdots]$
\end_inset

中的项是所谓的“
\series bold
内力项
\series default
”，由体单元和表面单元两部分组成。
\end_layout

\begin_layout Enumerate
最后一项
\begin_inset Formula $\int_{\Omega^{e}}N_{\alpha}^{e}\rho\dd{\Omega}$
\end_inset

 称为“
\series bold
外力项
\series default
”，是外源对场的激励，在对
\begin_inset Formula $\delta\phi$
\end_inset

的多次迭代中保持不变。
\end_layout

\begin_layout Standard
根据常规做法，代入 
\begin_inset Formula $\delta\phi$
\end_inset

 的插值展开 
\begin_inset Formula $\delta\phi=\sum_{e=1}^{N}N_{\beta}^{e}\delta\phi_{\beta}$
\end_inset

 得
\begin_inset Formula 
\begin{align}
\frac{1}{\varepsilon_{0}}\bigg[\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\kappa(E^{0})\cdot\nabla N_{\beta}^{e}}\dd{\Omega} & -\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,\sbf n\cdot\kappa(E^{0})\cdot\nabla N_{\beta}^{e}}\dd{\Gamma}\bigg]\delta\phi_{\beta}\nonumber \\
 & =\lambda\left[\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,\sbf n\cdot\sbf D^{0}}\dd{\Gamma}\right]+\lambda\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\label{eq:gal4}
\end{align}

\end_inset

此即 Galerkin 方法的迭代展开式。
\end_layout

\begin_layout Enumerate
对于
\begin_inset Formula $\Gamma_{1}$
\end_inset

上的
\series bold
第一类
\series default
（essential）边界条件，
\begin_inset Formula $\phi$
\end_inset

取给定值
\begin_inset Formula $\phi_{0}$
\end_inset

。因此
\begin_inset Formula $\delta\phi_{\beta}=0$
\end_inset

，从方程中直接删除对应的行和列，并将
\begin_inset Formula $\phi_{0}$
\end_inset

代入其他行的
\begin_inset Formula $b$
\end_inset

。
\end_layout

\begin_layout Enumerate
对于对于
\begin_inset Formula $\Gamma_{2}$
\end_inset

上的
\series bold
齐次第二类
\series default
（natural）边界条件，
\begin_inset Formula $\sbf n\cdot\left(-\varepsilon\nabla\phi\right)=0$
\end_inset

。在做迭代展开之前，就可以去掉
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的
\begin_inset Formula $\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}$
\end_inset

项，因此也不必考虑边界项的贡献。
\end_layout

\begin_layout Standard
总之，第一类和齐次第二类边界条件对刚度矩阵和激励都没有贡献。在这两种边界上可以直接将方程简化为
\begin_inset Formula 
\begin{equation}
\left[\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\kappa\cdot\nabla N_{\beta}^{e}}\dd{\Omega}\right]\delta\phi_{\beta}=\lambda\left\{ \frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\sbf D^{0}}\dd{\Omega}+\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\right\} .\label{eq:gal5}
\end{equation}

\end_inset

边界项的贡献只出现在 
\series bold
非齐次第二类
\series default
 或 
\series bold
第三类边界条件
\series default
 时（例如
\series bold
开放边界
\series default
，或
\series bold
外加电场
\series default
）。
\end_layout

\begin_layout Standard
程序中因为是 
\begin_inset Formula $F_{\text{v}}-F_{\text{in}}$
\end_inset

，所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal4"
plural "false"
caps "false"
noprefix "false"

\end_inset

右边 
\begin_inset Formula $\int_{\Omega^{e}}{\color{blue}\cdots\sbf D^{0}}\dd{\Omega}$
\end_inset

 项前面有负号。
\end_layout

\begin_layout Section
第一类边界条件
\end_layout

\begin_layout Standard
ref: JMJin P104, Sec 4.3.3。Dirichlet 边界条件定义为：
\begin_inset Formula 
\begin{equation}
\phi=p\quad\text{on}\quad\Gamma_{1}.\label{eq:bound1}
\end{equation}

\end_inset


\begin_inset Formula $\Gamma_{1}$
\end_inset

 是边界上的一部分。假设 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 上有 
\begin_inset Formula $N_{1}$
\end_inset

 个节点，如果把它们的 全局节点编号 存储在一矢量中，例如 
\begin_inset Formula $\text{nd}(i)$
\end_inset

；把给定的边界值存储在矢量 
\begin_inset Formula $p(i)$
\end_inset

 中。若对线性方程组进行下述操作，即相当于施加了第一类边界条件：
\end_layout

\begin_layout Enumerate
首先修改 1st边界 对应的 行方程：
\begin_inset Formula 
\begin{align}
 & b_{m}=p\left(i\right),\quad K_{m,m}=1;\label{eq:jm4.60}\\
\text{and:\ensuremath{\quad}} & K_{m,j}=0,\quad\text{for}\quad j\neq m.
\end{align}

\end_inset

其中
\begin_inset Formula $i$
\end_inset

索引1st边界节点， 
\begin_inset Formula $m=\text{nd}(i)$
\end_inset

，也就是 1st 边界对应的全局方程行位置。
\end_layout

\begin_layout Enumerate
以及修改对应的力向量：
\begin_inset Formula 
\[
b_{j}\to b_{j}-K_{j,m}\,p\left(i\right);\text{for}\quad j\neq m
\]

\end_inset

其中
\begin_inset Formula $i$
\end_inset

，
\begin_inset Formula $m$
\end_inset

 的含义同上，
\begin_inset Formula $j\in\{\text{除了边界节点}\}$
\end_inset

。总结以上操作就是令第一类边界边界条件相关行的非对角元 
\begin_inset Formula $K_{\text{nd}\left(i\right),j}$
\end_inset

，
\begin_inset Formula $K_{j,\text{nd}\left(i\right)}$
\end_inset

为零，并修改力向量。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
对于Solver 中的 Galerkin 迭代法，在位于 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 的节点上，
\begin_inset Formula $\phi$
\end_inset

为定值，则 
\begin_inset Formula $\delta\phi=0$
\end_inset

。套用上述处理手段，只需要：
\end_layout

\begin_layout Enumerate
在 
\begin_inset Formula $K$
\end_inset

 矩阵中， 把涉及 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 节点 的行和列去除；程序中，1st 约束节点的方程号为
\begin_inset Formula $-1$
\end_inset

，在组装矩阵时，
\begin_inset Formula $<0$
\end_inset

的方程号被忽略。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $b_{j}$
\end_inset

 作对应的处理，即
\series bold
减去刚阵乘以约束向量
\series default
。这一部分体现在计算 ElementFin 中。
\end_layout

\begin_layout Section
第三类边界条件
\end_layout

\begin_layout Standard
Robbin 边界条件：
\begin_inset Formula 
\begin{align}
 & \left(\varepsilon\nabla\phi\right)\cdot\sbf n=q-\gamma\phi\label{eq:bnd3}\\
\text{or}\quad & -\sbf D_{0}\cdot\sbf n=q,\quad\sbf n\cdot\kappa(E^{0})\cdot\sbf\nabla\delta\phi=-\gamma\delta\phi\label{eq:bnd3c}
\end{align}

\end_inset

其中
\begin_inset Formula $\sbf D=-\varepsilon\nabla\phi$
\end_inset

。将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:bnd3c"
plural "false"
caps "false"
noprefix "false"

\end_inset

代入到Galerkin迭代方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\begin{align*}
 & \frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\kappa(E^{0})\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,\sbf n\cdot\kappa(E^{0})\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\lambda\left[\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,\sbf n\cdot\sbf D^{0}}\dd{\Gamma}\right]+\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}
\end{align*}

\end_inset

得到第三类边界条件对应的Galerkin迭代方程
\begin_inset Formula 
\begin{align}
 & \frac{1}{\varepsilon_{0}}\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\kappa(E^{0})\cdot\nabla N_{\beta}^{e}}\dd{\Omega}\right]\delta\phi_{\beta}+\frac{1}{\varepsilon_{0}}{\color{brown}\left[\int_{\Gamma^{e}}\gamma N_{\alpha}^{e}N_{\beta}^{e}\dd{\Gamma}\right]}\delta\phi_{\beta}\nonumber \\
 & \qquad=\frac{\lambda}{\varepsilon_{0}}\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\sbf D^{0}}\dd{\Omega}\right]+\frac{\lambda}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,q}\dd{\Gamma}+\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\label{eq:gal-bnd3}
\end{align}

\end_inset

可以看到，
\series bold
第三类边界条件对刚阵和力向量都有贡献
\series default
。
\end_layout

\begin_layout Standard
符号说明：作为方程，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal-bnd3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中左右各项的符号是相对的。下面说明在程序中的符号约定。以下
\begin_inset Formula $F(\phi_{0})$
\end_inset

指非线性3rd 右函数 
\begin_inset Formula $\varepsilon\frac{\partial\phi}{\partial n}=F(\phi)$
\end_inset

；3rd 标准形式可以看作 
\begin_inset Formula $F(\phi)=-\gamma\phi+q$
\end_inset

，又因为电流定义为
\begin_inset Formula $J=-\sigma\nabla\phi$
\end_inset

，所以从界面向外流描述为
\begin_inset Formula $-\varepsilon\frac{\partial}{\partial n}\phi=-q>0$
\end_inset

。即
\begin_inset Formula $q<0$
\end_inset

对应电流（浓度流）逃出体系，
\begin_inset Formula $q>0$
\end_inset

对应电流（浓度流）进入体系。
\end_layout

\begin_layout Itemize
场强通常定义为
\begin_inset Formula $\sbf D=-\varepsilon\nabla\phi$
\end_inset

；以体刚阵项 
\begin_inset Formula $\left[\int_{\Omega^{e}}{\color{blue}\nabla N\cdots\nabla N}\dd{\Omega}\right]\delta\phi_{\beta}$
\end_inset

 的符号为基准，它对应
\begin_inset Formula $-\nabla N\cdot\delta\sbf D_{\beta}$
\end_inset

。可以把个符号，连同
\begin_inset Formula $\sbf D=-\varepsilon\nabla\phi$
\end_inset

作为标准符号约定。
\end_layout

\begin_layout Itemize
外力项
\begin_inset Formula $\rho$
\end_inset

位于等式右侧，
\color blue
外力
\begin_inset Formula $\rho$
\end_inset

的符号同
\begin_inset Formula $K_{e}$
\end_inset

 
\color inherit
。
\end_layout

\begin_layout Itemize
不管刚阵还是内力，体贡献和表面贡献总是差负号（来自于IBP）；
\begin_inset Formula $\frac{1}{\varepsilon_{0}}{\color{brown}\left[\int_{\Gamma^{e}}\cdots\dd{\Gamma}\right]}\delta\phi_{\beta}$
\end_inset

 表面
\begin_inset Formula $K_{e}$
\end_inset

项中，【IBP负号】与【
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:bnd3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中
\begin_inset Formula $\gamma$
\end_inset

的伴随负号】抵消；
\color blue
3rd表面
\begin_inset Formula $\gamma$
\end_inset

项符号同
\begin_inset Formula $K_{e}$
\end_inset

 ，
\color inherit
使用【
\begin_inset Formula $\gamma=-F^{(1)}(\phi_{0})$
\end_inset

】。
\end_layout

\begin_layout Itemize
外力和内力总是差负号（来自于FPI）；在程序中会给
\begin_inset Formula $\frac{\lambda}{\varepsilon_{0}}\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\sbf D^{0}}\dd{\Omega}\right]$
\end_inset

 强行添加负号，并在 
\begin_inset Formula $-F_{\text{in}}$
\end_inset

 那里抵消。
\color blue
体内力项和
\begin_inset Formula $K_{e}$
\end_inset

 相反，
\color inherit
使用【
\begin_inset Formula $-\nabla N\cdot\sbf D^{0}$
\end_inset

】。
\end_layout

\begin_layout Itemize
3rd边界的表面内力项 
\begin_inset Formula $q$
\end_inset

符号同 体内力项，即 
\color blue

\begin_inset Formula $q$
\end_inset

项和
\begin_inset Formula $K_{e}$
\end_inset

 相反
\color inherit
，使用【 
\begin_inset Formula $-q=-F(\phi_{0})$
\end_inset

】。
\end_layout

\begin_layout Remark
以上符号对应有另一种写法。边界条件
\begin_inset Formula $\varepsilon\frac{\partial\phi}{\partial n}=q-\gamma\phi$
\end_inset

作展开
\begin_inset Formula 
\begin{align}
 & \varepsilon\frac{\partial\phi_{0}}{\partial n}=q\label{eq:bnd3b}\\
 & \varepsilon\frac{\partial}{\partial n}\delta\phi=-\gamma\delta\phi\nonumber 
\end{align}

\end_inset

代入下面的迭代形式中，
\begin_inset Formula 
\begin{align*}
 & \frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\varepsilon\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,\varepsilon\,\frac{\partial}{\partial n}\delta\phi}\dd{\Gamma}\\
 & =\left[-\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\varepsilon\cdot\frac{\partial\phi_{0}}{\partial n}}\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,\varepsilon\,\frac{\partial\phi_{0}}{\partial n}}\dd{\Gamma}\right]+\int_{\Omega^{e}}N_{\alpha}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}
\end{align*}

\end_inset

立即得到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal-bnd3"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
第三类边界条件也可以是更一般的形式：
\begin_inset Formula 
\[
\varepsilon\frac{\partial\phi}{\partial n}=F(\phi)
\]

\end_inset

类似地，代入
\begin_inset Formula $\phi=\phi_{0}+\delta\phi$
\end_inset

作线性化得到
\begin_inset Formula 
\[
\varepsilon\frac{\partial\phi_{0}}{\partial n}=F(\phi_{0}),\quad\varepsilon\frac{\partial}{\partial n}\delta\phi=F^{(1)}(\phi_{0})\,\delta\phi
\]

\end_inset

则对比
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:bnd3b"
plural "false"
caps "false"
noprefix "false"

\end_inset

可知
\begin_inset Formula 
\[
q=F(\phi_{0}),\quad\gamma=-F^{(1)}(\phi_{0})
\]

\end_inset

依次代入
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal-bnd3"
plural "false"
caps "false"
noprefix "false"

\end_inset

即可。非线性迭代中，
\begin_inset Formula $\gamma$
\end_inset

对应的
\begin_inset Formula $\phi_{j}$
\end_inset

 是 ACCUM；
\begin_inset Formula $q$
\end_inset

 对应的
\begin_inset Formula $\phi_{j}$
\end_inset

 是 ACCUM+SEARCH，方程两边是错位的。只有当达到收敛时，方程两边是同步的，SEARCH为零，即
\begin_inset Formula $\delta\phi=0$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
对比Ritz法。参考JianMingJin 6.2.2，第三类边界条件对应的泛函是
\begin_inset Formula 
\begin{align*}
\mathcal{F}(\phi)= & \frac{1}{2}\int_{V}(\nabla\phi)\cdot\varepsilon\cdot(\nabla\phi)\dd{V}-\int_{V}\phi\rho\dd{V}+\int_{\Gamma_{2}}\left(\frac{1}{2}\gamma\phi^{2}-q\phi\right)\dd{\Gamma}\\
= & \frac{1}{2}\int_{V}\phi[-\nabla\cdot(\varepsilon\nabla\phi)]\dd{V}-\int_{V}\phi\rho\dd{V}\\
 & +\int_{\Gamma_{2}}\left(\frac{\varepsilon}{2}\phi\frac{\partial}{\partial n}\phi+\frac{1}{2}\gamma\phi^{2}-q\phi\right)\dd{\Gamma}
\end{align*}

\end_inset

这里的
\begin_inset Formula $1/2$
\end_inset

因子是由于Ritz法得到矩阵方程之前还要对
\begin_inset Formula $\Phi$
\end_inset

求偏导；而Galerkin法直接给出矩阵方程，所以没有
\begin_inset Formula $1/2$
\end_inset

。两种方法最终给出的矩阵方程是相同的。
\end_layout

\begin_layout Section
第二类边界条件
\end_layout

\begin_layout Standard
JMJin page 90: Neumann 边界条件，相当于在第三类边界条件中取 
\begin_inset Formula $\gamma=0$
\end_inset


\begin_inset Formula 
\begin{align}
 & \left(\varepsilon\nabla\phi\right)\cdot\sbf n=q\nonumber \\
\text{or}\quad & -\sbf D\cdot\sbf n=q\label{eq:bound2}
\end{align}

\end_inset

在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal-bnd3"
plural "false"
caps "false"
noprefix "false"

\end_inset

的方程取
\begin_inset Formula $\gamma=0$
\end_inset

得到第二类边界条件，Galerkin法的迭代方程
\begin_inset Formula 
\begin{align*}
 & \frac{1}{\varepsilon_{0}}\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\varepsilon\cdot\nabla N_{j}^{e}}\dd{\Omega}\right]\delta\phi_{j}\\
 & \qquad=\left[\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\frac{q}{\varepsilon_{0}}}\dd{\Gamma}\right]+\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}
\end{align*}

\end_inset


\series bold
第二类边界条件对力向量有贡献
\series default
。
\end_layout

\begin_layout Standard
此外还有齐次诺伊曼边界条件（homogeneous Neumann），相当于在第三类边界条件中取 
\begin_inset Formula $\gamma=q=0$
\end_inset


\begin_inset Formula 
\[
\left(\alpha\nabla\phi\right)\cdot\sbf n=0\quad\text{即}\quad\sbf D\cdot\sbf n=0
\]

\end_inset


\series bold
自然边界条件对刚阵和激励都没有贡献
\series default
，与Ritz法的结论相同。
\end_layout

\begin_layout Section
界面连续性条件
\end_layout

\begin_layout Standard
如果在两种介质的交界面上：
\end_layout

\begin_layout Itemize
材料性质参数例如 
\begin_inset Formula $\alpha_{x}$
\end_inset

，
\begin_inset Formula $\alpha_{y}$
\end_inset

，
\begin_inset Formula $\alpha_{z}$
\end_inset

 有突变（不连续）；
\end_layout

\begin_layout Itemize
并且假设在界面上没有任何表面源（surface source）。
\end_layout

\begin_layout Standard
则
\begin_inset Formula $\phi$
\end_inset

还应该满足连续性条件：
\begin_inset Formula 
\begin{equation}
\phi^{+}=\phi^{-},\quad\text{on}\quad\Gamma_{d}.\label{eq:jm4.4}
\end{equation}

\end_inset

以及
\begin_inset Formula 
\begin{equation}
\left(\alpha_{x}\frac{\partial\phi^{+}}{\partial x}\hat{x}+\alpha_{y}\frac{\partial\phi^{+}}{\partial y}\hat{y}+\alpha_{z}\frac{\partial\phi^{+}}{\partial z}\hat{z}\right)\cdot\hat{n}=\left(\alpha_{x}\frac{\partial\phi^{-}}{\partial x}\hat{x}+\alpha_{y}\frac{\partial\phi^{-}}{\partial y}\hat{y}+\alpha_{z}\frac{\partial\phi^{-}}{\partial z}\hat{z}\right)\cdot\hat{n}\quad\text{on}\quad\Gamma_{d}.\label{eq:jm4.5}
\end{equation}

\end_inset

即电势连续，电位移矢量 
\begin_inset Formula $\sbf D$
\end_inset

连续。
\begin_inset Formula 
\[
\varepsilon_{1}\phi_{i}\,\sbf n\cdot\nabla_{+}N_{i}=\varepsilon_{2}\phi_{i}\,\sbf n\cdot\nabla_{-}N_{i}
\]

\end_inset


\begin_inset Formula 
\[
\left.\varepsilon_{1}\phi_{i}\frac{\partial N_{i}}{\partial n}\right|_{0-}=\left.\varepsilon_{2}\phi_{i}\frac{\partial N_{i}}{\partial n}\right|_{0+}
\]

\end_inset


\end_layout

\begin_layout Example
有限元中界面连续性的保证。以Ritz方法为例，我们关注刚阵的部分，静电场的泛函经过分部积分可以给出边界项：
\begin_inset Formula 
\begin{align*}
\mathcal{F}(\phi)= & \frac{1}{2}\int_{V}(\nabla\phi)\cdot\varepsilon\cdot(\nabla\phi)\dd{V}\\
= & \frac{1}{2}\int_{V}\phi[-\nabla\cdot(\varepsilon\nabla\phi)]\dd{V}+{\color{blue}\int_{\Gamma}\left(\frac{\varepsilon}{2}\phi\frac{\partial}{\partial n}\phi\right)\dd{\Gamma}}
\end{align*}

\end_inset

考虑两个相邻的单元，它们总的泛函写作
\begin_inset Formula 
\begin{align}
\sum_{e}\mathcal{F}_{e}(\phi) & =\frac{1}{2}\sum_{e}\int_{V^{e}}(\nabla\phi_{e})\cdot\varepsilon_{e}\cdot(\nabla\phi_{e})\dd{V},\label{eq:ritz6}\\
 & =\frac{1}{2}\sum_{e}\int_{V^{e}}\phi_{e}[-\nabla\cdot(\varepsilon_{e}\nabla\phi_{e})]\dd{V}+\sum_{e}{\color{blue}\int_{\Gamma^{e}}\left(\frac{\varepsilon_{e}}{2}\phi_{e}\frac{\partial}{\partial n_{e}}\phi_{e}\right)\dd{\Gamma}}\nonumber 
\end{align}

\end_inset

其中
\begin_inset Formula $e=1,2$
\end_inset

，每个单元可以有多段边界。把相邻单元的公共边界记作
\begin_inset Formula $\Gamma^{c}$
\end_inset

，累加两个单元对
\begin_inset Formula $\Gamma^{c}$
\end_inset

的贡献， 
\begin_inset Formula 
\begin{equation}
{\color{blue}\int_{\Gamma^{c}}\left(\frac{\varepsilon_{1}}{2}\phi_{1}\frac{\partial}{\partial n_{1}}\phi_{1}\right)\dd{\Gamma}+\int_{\Gamma^{c}}\left(\frac{\varepsilon_{2}}{2}\phi_{2}\frac{\partial}{\partial n_{2}}\phi_{2}\right)\dd{\Gamma}}\label{eq:bnd5}
\end{equation}

\end_inset


\begin_inset Formula $\varepsilon_{1,2}$
\end_inset

表示两种相对介电常数；
\begin_inset Formula $n_{1,2}$
\end_inset

分别表示单元
\begin_inset Formula $(1,2)$
\end_inset

在边界（2–3） 上的法线，它们是平行反向的。根据
\begin_inset Formula $\delta\mathcal{F}(\phi)=0$
\end_inset

列出有限元全局方程时，我们会写出单元的体方程
\begin_inset Formula 
\begin{equation}
-\nabla\cdot(\varepsilon_{e}\nabla\phi_{e})=\frac{\rho}{\varepsilon_{0}}\quad\Leftrightarrow\quad\sum_{e}[K_{ij}^{e}]\{\phi_{j}\}=\sum_{e}b_{i}^{e}\label{eq:ritz7}
\end{equation}

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ritz6"
plural "false"
caps "false"
noprefix "false"

\end_inset

，要想让
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ritz7"
plural "false"
caps "false"
noprefix "false"

\end_inset

中两式完全等价还需满足
\begin_inset Formula 
\begin{align*}
 & \varepsilon_{1}\frac{\partial}{\partial n_{1}}\phi_{1}=\varepsilon_{2}\frac{\partial}{\partial n_{1}}\phi_{2},\\
\text{离散形式：}\quad & \sum_{s}[S_{ij}^{e}]\{\phi_{j}\}=0
\end{align*}

\end_inset

即法向电位移连续，其中使用了
\begin_inset Formula $n_{1}=-n_{2}$
\end_inset

。也就是泛函法
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ritz6"
plural "false"
caps "false"
noprefix "false"

\end_inset

内蕴了界面连续条件
\begin_inset Formula $D_{n1}=D_{n2}$
\end_inset

。在实际工作中
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:bnd5"
plural "false"
caps "false"
noprefix "false"

\end_inset

的贡献从不显式写出。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
以下图为例，在边界上 （2–3）上，电势被表示成插值
\begin_inset Formula $\text{\ensuremath{\phi=\sum_{\alpha}\phi_{\alpha}N_{\alpha}}}$
\end_inset

，插值节点是
\begin_inset Formula $\{2,3\}$
\end_inset

，相当于忽略了
\begin_inset Formula $(1,4)$
\end_inset

节点的影响。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/ele-tri3-2.pdf
	lyxscale 150
	scale 80

\end_inset


\begin_inset Newline newline
\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:bnd5"
plural "false"
caps "false"
noprefix "false"

\end_inset

对刚阵的贡献为：
\begin_inset Formula 
\[
S_{ij}^{e}=\int_{\Gamma^{c}}\varepsilon_{e}N_{i}\frac{\partial N_{j}}{\partial n_{e}}\dd{\Gamma}
\]

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{cc}
S_{22}^{(1)}+{\color{blue}S_{22}^{(2)}} & S_{23}^{(1)}+{\color{blue}S_{23}^{(2)}}\\
S_{32}^{(1)}+{\color{blue}S_{32}^{(2)}} & S_{33}^{(1)}+{\color{blue}S_{33}^{(2)}}
\end{array}\right]\left[\begin{array}{c}
\phi_{2}\\
\phi_{3}
\end{array}\right]=0
\]

\end_inset

这就是
\begin_inset Formula $\varepsilon_{1}\frac{\partial}{\partial n_{1}}\phi_{1}=\varepsilon_{2}\frac{\partial}{\partial n_{1}}\phi_{2}$
\end_inset

的离散矩阵形式，当然在实际工作中它从不显式出现在有限元矩阵方程中，常规的体方程已经内蕴了此条件。
\end_layout

\begin_layout Section
各种自由度记号
\end_layout

\begin_layout Enumerate
AXIS2：表示轴对称系统，取柱坐标系计算。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
NdNum()；节点数目。
\end_layout

\begin_layout Enumerate
DofNum()：自由度数目，取决于体系，例如每个单元中，自由度就是节点上的电势。
\end_layout

\begin_layout Enumerate
GSNum()，GsNumKe()，GsNumFe()，GsNumVe()：高斯点数目；对于阶数不同的多项式，需要的采样点数目不同，因此 Gauss
 点数目可能不同。
\end_layout

\begin_layout Subsection
程序变量
\end_layout

\begin_layout Standard
下面列出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal5"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的部件，在程序中对应的变量。 
\begin_inset Formula $W(\xi_{i})$
\end_inset

 是高斯积分的权重因子，
\begin_inset Formula $\det[J]$
\end_inset

 是雅可比矩阵的行列式。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $K$
\end_inset

：Sparse::GetMatrix<double>(
\begin_inset Quotes eld
\end_inset

K
\begin_inset Quotes erd
\end_inset

)，刚阵，Galerkin 方程左侧的稀疏矩阵。
\begin_inset Formula 
\[
K=\nabla N^{T}\cdot\varepsilon\cdot\nabla N*W*\det[J]
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $F_{\text{in}}$
\end_inset

：Fin，“内力”，Galerkin 方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal5"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，
\begin_inset Formula $\sbf D^{0}$
\end_inset

 引发的贡献
\begin_inset Formula 
\[
F_{\text{in}}=\nabla N^{T}\cdot\sbf D^{0}\cdot\left(-\det[J]*W\right)/\epsilon_{0}
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $F_{v}$
\end_inset

：Fv，“力”矢量，其实是电荷（电荷密度，或者外加电场）的贡献
\begin_inset Formula 
\[
F_{v}=N*\rho*\det[J]*W
\]

\end_inset


\end_layout

\begin_layout Enumerate
P_GFv_T 是 Global Fv，即 Fv 在所有单元上累加的结果；Fv vector中，的元素的存储次序，与全局/局域编号有关。
\end_layout

\begin_layout Enumerate
P_GFinAccum 是 Global Fin，即 Fin 在所有单元上累加的结果。
\end_layout

\begin_layout Enumerate
P_GRt，
\begin_inset Formula $\mathrm{P\_GRt}={\color{red}\mathrm{P\_GFv\_T}-\mathrm{P\_GFinAccum}}$
\end_inset

，两部分“力”的求和，注意这里的负号。
\end_layout

\begin_layout Enumerate
残差为 
\begin_inset Formula $\mathrm{res}=\sqrt{\sum_{i}\mathrm{P\_GRt}[i]}$
\end_inset

，即所有节点上力向量的平方和，再开方。
\end_layout

\begin_layout Enumerate
从单元的局域刚阵, 组装全局矩阵的过程，见 金建铭note 4.3.3.2。
\end_layout

\begin_layout Enumerate
STPBEG_POS：完整解，上一时间步的解。
\end_layout

\begin_layout Enumerate
STPBEG_ACCUM：非线性迭代某一步的完整解，逐渐逼近收敛解；当且仅当 非线性迭代 成功时，累加上线搜索值。
\end_layout

\begin_layout Enumerate
STP_SEARCH：线搜索解，自由度的增量，随着线搜索迭试探不停变小。
\end_layout

\begin_layout Section
非线性处理
\end_layout

\begin_layout Subsection
非线性材料
\end_layout

\begin_layout Standard
非线性材料：
\begin_inset Formula 
\[
\frac{\partial D}{\partial E}=\varepsilon(E)
\]

\end_inset


\end_layout

\begin_layout Subsection
复杂边界条件
\end_layout

\begin_layout Standard
通常的第三类边界条件写作
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
 & \left(\varepsilon\nabla\phi\right)\cdot\sbf n+\gamma\phi=q\\
\text{or}\quad & -\sbf D_{0}\cdot\sbf n=q,\quad\sbf n\cdot\varepsilon\cdot\sbf\nabla\delta\phi=-\gamma\delta\phi
\end{align*}

\end_inset

非线性边界条件的一般形式为
\begin_inset Formula 
\[
\left(\varepsilon\nabla\phi\right)\cdot\sbf n=f(\phi)
\]

\end_inset

但是按照迭代法的思想，在
\begin_inset Formula $\phi=\phi_{0}+\delta\phi$
\end_inset

附近作线性化，把它写成
\begin_inset Formula 
\[
-\sbf D_{0}\cdot\sbf n=f(\phi_{0}),\quad\sbf n\cdot\varepsilon\cdot\sbf\nabla\delta\phi=f'(\phi)\delta\phi
\]

\end_inset

相当于取
\begin_inset Formula 
\[
q=f(\phi_{0}),\quad\gamma=-f'(\phi)
\]

\end_inset

代入第三类边界条件的Galerkin迭代方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal-bnd3"
plural "false"
caps "false"
noprefix "false"

\end_inset

得到
\begin_inset Formula 
\begin{align*}
 & \frac{1}{\varepsilon_{0}}\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\varepsilon\cdot\nabla N_{j}^{e}}\dd{\Omega}\right]\delta\phi_{j}+\frac{1}{\varepsilon_{0}}{\color{brown}\left[\int_{\Gamma^{e}}-f'(\phi)N_{i}^{e}N_{j}^{e}\dd{\Gamma}\right]}\delta\phi_{j}\\
 & \qquad=\left[\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}\right]+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\frac{f(\phi_{0})}{\varepsilon_{0}}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}
\end{align*}

\end_inset

可以看到，一般对刚阵和力向量都有贡献。
\end_layout

\begin_layout Section
方程组
\end_layout

\begin_layout Standard
ref：《计算物理基础》P352。
\end_layout

\begin_layout Standard
对于方程组而言，狄利克雷边界条件是
\begin_inset Formula 
\begin{align*}
 & h_{11}\phi_{1}+h_{12}\phi_{2}=p_{1}\\
 & h_{21}\phi_{1}+h_{22}\phi_{2}=p_{2}
\end{align*}

\end_inset

简写为 
\begin_inset Formula 
\[
h.\phi=p
\]

\end_inset

其中
\begin_inset Formula $h$
\end_inset

，
\begin_inset Formula $p$
\end_inset

均为矩阵。
\end_layout

\begin_layout Standard
第三类边界条件是
\begin_inset Formula 
\begin{align*}
 & c_{11}\frac{\partial\phi_{1}}{\partial n}+c_{12}\frac{\partial\phi_{2}}{\partial n}+\gamma_{11}\phi_{1}+\gamma_{12}\phi_{2}=q_{1}\\
 & c_{21}\frac{\partial\phi_{1}}{\partial n}+c_{22}\frac{\partial\phi_{2}}{\partial n}+\gamma_{21}\phi_{1}+\gamma_{22}\phi_{2}=q_{2}
\end{align*}

\end_inset

写成矩阵的形式 
\begin_inset Formula 
\[
\left[\begin{array}{cc}
c_{11} & c_{12}\\
c_{21} & c_{22}
\end{array}\right]\left[\begin{array}{c}
\frac{\partial\phi_{1}}{\partial n}\\
\frac{\partial\phi_{2}}{\partial n}
\end{array}\right]=\left[\begin{array}{c}
q_{1}\\
q_{2}
\end{array}\right]-\left[\begin{array}{cc}
\gamma_{11} & \gamma_{12}\\
\gamma_{21} & \gamma_{22}
\end{array}\right]\left[\begin{array}{c}
\phi_{1}\\
\phi_{2}
\end{array}\right]
\]

\end_inset

求解方程，可以把
\begin_inset Formula $\partial\phi_{i}/\partial n$
\end_inset

用
\begin_inset Formula $q_{i}$
\end_inset

，
\begin_inset Formula $\phi_{i}$
\end_inset

表出，代入边界的刚阵和力向量。
\end_layout

\begin_layout Standard
混合边界条件则是
\begin_inset Formula 
\begin{align*}
 & h_{11}\phi_{1}+h_{12}\phi_{2}=p_{1}\\
 & c_{11}\frac{\partial\phi_{1}}{\partial n}+c_{12}\frac{\partial\phi_{2}}{\partial n}+\gamma_{11}\phi_{1}+\gamma_{12}\phi_{2}=q_{1}-h_{11}u\\
 & c_{21}\frac{\partial\phi_{1}}{\partial n}+c_{22}\frac{\partial\phi_{2}}{\partial n}+\gamma_{21}\phi_{1}+\gamma_{22}\phi_{2}=q_{2}-h_{12}u
\end{align*}

\end_inset

把
\begin_inset Formula $u$
\end_inset

也引入为自由度，整理成矩阵形式：
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
c_{11} & c_{12} & 0\\
c_{21} & c_{22} & 0\\
0 & 0 & 1
\end{array}\right]\left[\begin{array}{c}
\frac{\partial\phi_{1}}{\partial n}\\
\frac{\partial\phi_{2}}{\partial n}\\
\frac{\partial u}{\partial n}
\end{array}\right]=\left[\begin{array}{c}
q_{1}\\
q_{2}\\
p_{1}
\end{array}\right]-\left[\begin{array}{ccc}
\gamma_{11} & \gamma_{12} & h_{11}\\
\gamma_{21} & \gamma_{22} & h_{12}\\
h_{11} & h_{12} & 0
\end{array}\right]\left[\begin{array}{c}
\phi_{1}\\
\phi_{2}\\
u
\end{array}\right]
\]

\end_inset

并要求
\begin_inset Formula $u$
\end_inset

满足
\begin_inset Formula $\frac{\partial u}{\partial n}=0$
\end_inset

。
\end_layout

\begin_layout Section
点状源
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "如何用弱形式实现点源"
target "https://zhuanlan.zhihu.com/p/623459567"
literal "false"

\end_inset

。考虑原点处具有点状源的泊松方程
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nabla\cdot\left(\varepsilon\nabla\phi\right)+\beta\phi=-\delta(x)
\]

\end_inset

如往常使用Galerkin形式给出的方程是
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\varepsilon\cdot\nabla\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\sbf n\cdot\varepsilon\cdot\nabla\phi}\dd{\Gamma}=-\int_{\Omega^{e}}N_{\alpha}^{e}\,\delta(x)\,\dd{\Omega}
\]

\end_inset

利用
\begin_inset Formula $\delta$
\end_inset

函数的性质得到
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\varepsilon\cdot\nabla\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\sbf n\cdot\varepsilon\cdot\nabla\phi}\dd{\Gamma}=-N_{\alpha}^{e}(0)
\]

\end_inset

相当于力向量的外力部分添加 
\begin_inset Formula $-N_{\alpha}^{e}(0)$
\end_inset

 项。在单元上的局部矩阵相当于
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
K_{11} & \cdots & \cdots\\
\cdots & K_{22} & \cdots\\
\cdots & \cdots & K_{33}
\end{array}\right]\left[\begin{array}{c}
\phi_{1}\\
\phi_{2}\\
\phi_{3}
\end{array}\right]=-\sum_{q}\left[\begin{array}{c}
N_{1}^{e}(x_{q})\\
N_{2}^{e}(x_{q})\\
N_{3}^{e}(x_{q})
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $q\in\{1,2,3,\cdots\}$
\end_inset

，
\begin_inset Formula $x_{q}$
\end_inset

表示各粒子的位置。
\end_layout

\begin_layout Standard
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
单元编号
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
粒子1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
粒子2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
粒子3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $N_{10}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $Q_{11},\vec{x}_{11},\vec{v}_{11},\vec{a}_{11}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $Q_{12},\vec{x}_{12},\vec{v}_{12},\vec{a}_{12}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $N_{20}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $Q,\vec{x},\vec{v},\vec{a}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
3
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $N_{30}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $Q,\vec{x},\vec{v},\vec{a}$
\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
...
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Section
收敛判定标准
\end_layout

\begin_layout Standard
非线性迭代求解 
\begin_inset Formula $A\,X=b$
\end_inset

 的过程为 
\begin_inset Formula 
\begin{align*}
 & X_{0}=\text{initial}\\
 & X_{n}=X_{n-1}+\delta X_{n}
\end{align*}

\end_inset

其中
\begin_inset Formula $\delta X_{n}$
\end_inset

是第
\begin_inset Formula $n$
\end_inset

步迭代的修正向量。当满足以下任何一个判断标准收敛，程序认为迭代收敛。
\end_layout

\begin_layout Itemize
后向误差收敛判定
\begin_inset Formula 
\[
\frac{\text{FieldResidual}}{\max\left(\text{MinimumAbs},\text{FieldExtLoad}\right)}<\text{ResidualConvergeRatio}
\]

\end_inset

其中 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
FieldResidual 是全局激励向量（global rhs ）的模长，in L2 norm。 MinimumAbs 是用户输入；ResidualConve
rgeRatio
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color blue
（control 项 ResidualConvTol）
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
 是用户输入的收敛标准。FieldExtLoad 是外源激励幅值。为了处理 
\begin_inset Formula $\text{FieldExtLoad}=0$
\end_inset

 的情况，使用了 max 函数。
\end_layout

\begin_layout Itemize
前向误差收敛判定
\begin_inset Formula 
\[
\frac{\text{dFieldDataNorm}}{\max\left(\text{MinimumAbs},\text{FieldDataNorm}\right)}<\text{DispConvergeRatio}
\]

\end_inset

其中
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
 dFieldDataNorm 是当前解的模长（前向误差），FieldDataNorm 是解的累积模长；MinimumAbs同上；DispConvergeRat
io 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color blue
（control 项 IncrementConvTol）
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
 是用户输入收敛标准。
\end_layout

\begin_layout Itemize

\color blue
control 项 MaxStepNum，默认值1000
\color inherit
：非线性迭代中外迭代最大步数。
\end_layout

\begin_layout Section
Edge 场 mapping
\end_layout

\begin_layout Subsection
零空间，取规范
\end_layout

\begin_layout Standard
求解矩阵方程
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
A.x=b
\]

\end_inset

假设
\begin_inset Formula $A$
\end_inset

是退化的，例如
\begin_inset Formula 
\[
\left[\begin{array}{cccc}
1 & 2 & 2 & 2\\
1 & 2 & 3 & 4\\
3 & 6 & 8 & 10\\
2 & 4 & 6 & 8
\end{array}\right]\left[\begin{array}{c}
x_{1}\\
x_{2}\\
x_{3}\\
x_{4}
\end{array}\right]=\left[\begin{array}{c}
b_{1}\\
b_{2}\\
b_{3}\\
b_{4}
\end{array}\right]
\]

\end_inset


\begin_inset Formula $A$
\end_inset

的约化的行阶梯形式（rref）是
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
iA = { {1, 2, 2, 2}, {1, 2, 3, 4}, {3, 6, 8, 10}, {2, 4, 6, 8} }; {NullSpace@iA
 // TableForm, RowReduce@iA // TableForm}
\end_layout

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{cccc}
1 & 2 & 0 & -2\\
0 & 0 & 1 & 2\\
0 & 0 & 0 & 0\\
0 & 0 & 0 & 0
\end{array}\right]
\]

\end_inset

可以看出，主元列是
\begin_inset Formula $1,3$
\end_inset

，自由列是 
\begin_inset Formula $2,4$
\end_inset

；也就是 
\begin_inset Formula $x_{2},x_{4}$
\end_inset

的值可以随便选。根据 
\begin_inset Formula $\{1,3\}$
\end_inset

，
\begin_inset Formula $\{2,4\}$
\end_inset

 定义以下矩阵：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
P=\left[\begin{array}{cccc}
1 & 0 & 0 & 0\\
0 & 0 & 1 & 0
\end{array}\right],\quad Q=\left[\begin{array}{cccc}
0 & 1 & 0 & 0\\
0 & 0 & 0 & 1
\end{array}\right]
\]

\end_inset

将原线性系统 
\begin_inset Formula $Ax=b$
\end_inset

 改造成
\begin_inset Formula 
\[
P\,A\,\tps P\,P\,x=P\,b-P\,A\,\tps Q\,b
\]

\end_inset

可得，
\begin_inset Formula $A$
\end_inset

矩阵变换
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(*消去零行*) iA = { {1, 2, 2, 2}, {1, 2, 3, 4}, {3, 6, 8, 10}, {2, 4, 6, 8}
 }; iP = { {1, 0, 0, 0}, {0, 0, 1, 0}}; {iA
\backslash
[Prime] = iP .
 iA .
 iP
\backslash
[Transpose], RowReduce@iA
\backslash
[Prime]} (*---*) iQ = { {0, 1, 0, 0}, {0, 0, 0, 1}}; iA
\backslash
[Prime]
\backslash
[Prime] = iP .
 iA .
 iQ
\backslash
[Transpose]
\end_layout

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{cccc}
1 & 0 & 0 & 0\\
0 & 0 & 1 & 0
\end{array}\right]\left[\begin{array}{cccc}
{\color{blue}1} & {\color{red}2} & {\color{blue}2} & {\color{red}2}\\
1 & 2 & 3 & 4\\
{\color{blue}3} & {\color{red}6} & {\color{blue}8} & {\color{red}10}\\
2 & 4 & 6 & 8
\end{array}\right]\left[\begin{array}{cc}
1 & 0\\
0 & 0\\
0 & 1\\
0 & 0
\end{array}\right]=\left[\begin{array}{cc}
1 & 2\\
3 & 8
\end{array}\right]
\]

\end_inset

线性系统变成
\begin_inset Formula 
\[
\underbrace{\left[\begin{array}{cc}
{\color{blue}1} & {\color{blue}2}\\
{\color{blue}3} & {\color{blue}8}
\end{array}\right]\left[\begin{array}{c}
x_{1}\\
x_{3}
\end{array}\right]}_{P\,A\,\tps P\,P\,x}=\underbrace{\left[\begin{array}{c}
b_{1}\\
b_{3}
\end{array}\right]}_{P\,b}-\underbrace{\left[\begin{array}{cc}
{\color{red}2} & {\color{red}2}\\
{\color{red}6} & {\color{red}10}
\end{array}\right]\left[\begin{array}{c}
x_{2}\\
x_{4}
\end{array}\right]}_{P\,A\,\tps Q\,b}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula $A$
\end_inset

对应的零空间bases是（每列一个基向量）
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\left[\begin{array}{cc}
2 & -2\\
0 & 1\\
-2 & 0\\
1 & 0
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Chapter
静电场
\end_layout

\begin_layout Section
轴对称电场
\end_layout

\begin_layout Standard
柱坐标 
\begin_inset Formula $(r,\phi,z)$
\end_inset

 下的 
\begin_inset Formula $\nabla^{2}$
\end_inset

 算子：
\begin_inset Formula 
\[
\nabla^{2}\psi=\frac{1}{r}\partial_{r}\left(r\,\partial_{r}\psi\right)+\frac{1}{r^{2}}\partial_{\phi}^{2}\psi+\partial_{z}^{2}\psi
\]

\end_inset


\end_layout

\begin_layout Standard
轴对称情况下，电场方程 
\begin_inset Formula $-\varepsilon\nabla^{2}\Phi=\rho$
\end_inset

 在柱坐标系下可以写成：
\begin_inset Formula 
\[
-\frac{1}{r}\partial_{r}\left(\epsilon_{r}\,r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}
\]

\end_inset

将方程化简成如下形式
\begin_inset Formula 
\begin{equation}
-\partial_{r}\left(\epsilon_{r}r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}r\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}r\label{eq:xl2.5-1}
\end{equation}

\end_inset

如果作替换
\begin_inset Formula 
\begin{align*}
 & r\to x,\quad z\to y,\\
 & \epsilon_{r}r\to\tilde{\varepsilon}(x),\quad\rho r\to\tilde{\rho}(x)
\end{align*}

\end_inset

则原方程可以写作
\begin_inset Formula 
\begin{equation}
-\partial_{x}\left[\tilde{\varepsilon}(x)\,\partial_{x}\Phi\right]-\partial_{y}\left[\tilde{\varepsilon}(x)\,\partial_{y}\Phi\right]=\tilde{\rho}(x)\label{eq:xl2.5}
\end{equation}

\end_inset

此方程的求解和二维情况完全相同，即它对应的泛函和通常的二维情况相同。
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\Phi\right)=\frac{1}{2}\int_{\Omega^{e}}\left(\nabla N_{i}^{e}\cdot\epsilon_{r}\cdot\nabla N_{j}^{e}\right)\Phi_{i}\Phi_{j}\dd{\Omega}-\int_{\Omega^{e}}\frac{\rho}{\epsilon_{0}}N_{i}^{e}\Phi_{i}\dd{\Omega}.
\]

\end_inset

对上式的泛函变分时，自由度是电势
\begin_inset Formula $\Phi_{i}$
\end_inset

，因此与 
\begin_inset Formula ${\color{blue}\varepsilon}$
\end_inset

 是否依赖于空间坐标无关。仍然给出泊松方程
\begin_inset Formula 
\[
\nabla\cdot\epsilon_{r}\cdot\nabla\Phi=-\frac{\rho}{\epsilon_{0}}.
\]

\end_inset

只不过由于对称性，泛函的积分可以直接把 
\begin_inset Formula $\phi$
\end_inset

 积掉，给出 
\begin_inset Formula $2\pi$
\end_inset

 因子。
\end_layout

\begin_layout Standard
类似地，对于 Galerkin 方程，推导步骤也是相同的。只不过把其中的 
\begin_inset Formula $\varepsilon$
\end_inset

，
\begin_inset Formula $\rho$
\end_inset

 替换成相应的波浪线版本。
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\tilde{\rho}\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset


\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\left(-\tilde{\varepsilon}\right)\cdot\nabla\phi}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Remark
在 Simdroid 中，UI界面的对称轴是 
\begin_inset Formula $y$
\end_inset

 轴，不同于上述推导中的
\begin_inset Formula $z$
\end_inset

轴。但 
\begin_inset Formula $z$
\end_inset

 or 
\begin_inset Formula $y$
\end_inset

 只是一个标志，实际是什么无所谓。对于方程
\begin_inset Formula 
\[
-\frac{1}{r}\partial_{r}\left(\epsilon_{r}\,r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}
\]

\end_inset

重要的是 
\begin_inset Formula $r,z$
\end_inset

 坐标的相对次序，即
\begin_inset Formula $r$
\end_inset

 是坐标
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $z$
\end_inset

 是坐标
\begin_inset Formula $2$
\end_inset

。在随后的符号重排
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，
\begin_inset Formula $\tilde{\varepsilon}(r)=\epsilon_{r}\,r$
\end_inset

，
\begin_inset Formula $\tilde{\rho}(r)=\rho\,r$
\end_inset

，即
\begin_inset Formula $\tilde{\varepsilon}$
\end_inset

，
\begin_inset Formula $\tilde{\rho}$
\end_inset

 是坐标
\begin_inset Formula $1$
\end_inset

 的函数。由于轴对称边值问题被转化为 
\begin_inset Formula $x,y$
\end_inset

 平面上的问题，只要在求解算法中保持坐标次序即可，即这里应该把 
\begin_inset Formula $x$
\end_inset

 乘到 
\begin_inset Formula $\varepsilon,\rho$
\end_inset

 上。
\end_layout

\begin_layout Section
静电场的能量
\end_layout

\begin_layout Standard
目录:p18; Jackson p68/43; sec1.11
\end_layout

\begin_layout Standard
静电场能的两种表示方式：
\begin_inset Formula 
\begin{align}
 & W=\frac{1}{2}\int\rho(\sbf x)\Phi(\sbf x)\dd[3]{x},\quad W=\frac{1}{8\pi\epsilon_{0}}\sum_{i}\sum_{j}\frac{q_{i}q_{j}}{\abs{\sbf x_{i}-\sbf x_{j}}}\label{eq:j1.53}\\
 & W=\frac{\epsilon_{0}}{2}\int\abs{\sbf E}^{2}\dd[3]{x}.\label{eq:j1.54}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
第一行的公式分别是连续和离散情形。双求和忽略了 
\begin_inset Formula $i=j$
\end_inset

 的项，即“自能项”。
\end_layout

\begin_layout Enumerate
两种公式的物理图像分别为：电荷之间的相互作用能；电场中存储的能量。
\end_layout

\begin_layout Enumerate
电场的能量是正定的；相互作用能可能是负值。
\end_layout

\begin_layout Standard
考虑两个点电荷 
\begin_inset Formula $q_{1}$
\end_inset

，
\begin_inset Formula $q_{2}$
\end_inset

 组成的体系，空间一点
\begin_inset Formula $\sbf x$
\end_inset

处的电势和静电能分别为：
\begin_inset Formula 
\begin{align}
 & \sbf E=\frac{1}{4\pi\epsilon_{0}}\frac{q_{1}(\sbf x-\sbf x_{1})}{\abs{\sbf x-\sbf x_{1}}^{3}}+\frac{1}{4\pi\epsilon_{0}}\frac{q_{2}(\sbf x-\sbf x_{2})}{\abs{\sbf x-\sbf x_{2}}^{3}},\nonumber \\
 & 32\pi^{2}\epsilon_{0}w=\frac{q_{1}^{2}}{\abs{\sbf x-\sbf x_{1}}^{4}}+\frac{q_{2}^{2}}{\abs{\sbf x-\sbf x_{2}}^{4}}+2\frac{q_{1}q_{2}(\sbf x-\sbf x_{1})\cdot(\sbf x-\sbf x_{2})}{\abs{\sbf x-\sbf x_{1}}^{3}\abs{\sbf x-\sbf x_{2}}^{3}}.\label{eq:j1.56}
\end{align}

\end_inset

前两项是两个点电荷的自能，后一项是相互作用能。
\end_layout

\begin_layout Subsection
电容矩阵
\end_layout

\begin_layout Standard
FEM-Gerard; page 31/47; sec 1.3.8.8 
\end_layout

\begin_layout Standard
在含有 
\begin_inset Formula $n$
\end_inset

 个导体的系统中，第 
\begin_inset Formula $i$
\end_inset

 个导体上的电荷
\begin_inset Formula $Q_{i}$
\end_inset

 可以用所有导体上的电势
\begin_inset Formula $V_{j}$
\end_inset

，以及一些几何参数，共同表出：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
Q_{i}=\sum_{j=1}^{n}C_{ij}V_{j},\quad i=1,2,\cdots,n\label{eq:j1.61}
\end{equation}

\end_inset

系数 
\begin_inset Formula $C_{ii}$
\end_inset

 被称为电容（capacities or capacitances），非对角元
\begin_inset Formula $C_{ij}$
\end_inset

被称为互感系数。
\end_layout

\begin_layout Enumerate
导体的电容，等于它带单位电势时的电荷，同时保持其他导体电势为零。
\end_layout

\begin_layout Enumerate
电容矩阵 
\begin_inset Formula $C_{ij}$
\end_inset

 是对称矩阵，表示两个导体间的电荷相互作用是对等的。
\end_layout

\begin_layout Enumerate
非对角元 
\begin_inset Formula $C_{ij}$
\end_inset

 对应两个导体间的互作用能量。
\begin_inset Formula 
\[
C_{ij}V_{i}V_{j}=\int_{\Omega}\sbf E_{i}\cdot\sbf D_{j}\dd{\Omega},\quad i,j\,\text{不求和}
\]

\end_inset


\end_layout

\begin_layout Standard
导体系统的 静电能 可以表示为
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\sum_{i=1}^{n}Q_{i}V_{i}=\frac{1}{2}\sum_{i=1}^{n}\sum_{j=1}^{n}C_{ij}V_{i}V_{j}.\label{eq:j1.62}
\end{equation}

\end_inset


\begin_inset Formula $C_{ii}V_{i}^{2}$
\end_inset

是正定的，对应电荷的“自能”（self energy）；
\begin_inset Formula $C_{ij}V_{i}V_{j}$
\end_inset

对应相互作用能 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j1.53"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Section
电介质中的静电能
\end_layout

\begin_layout Standard
p190; sec 4.7 
\end_layout

\begin_layout Standard
见 Sec1.11，自由空间电荷系统的能量为：
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\int\rho(\sbf x)\Phi(\sbf x)\dd[3]{x}.\label{eq:j4.83}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
存在电介质的情况下，静电能的微小变分为：
\begin_inset Formula 
\begin{equation}
\delta W=\int\delta\rho(\sbf x)\Phi(\sbf x)\dd[3]{x}.\label{eq:j4.84}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\Phi(\sbf x)$
\end_inset

 是由于已存在电荷密度 
\begin_inset Formula $\rho(\sbf x)$
\end_inset

产生的电势。考虑到 
\begin_inset Formula $\nabla\cdot\sbf D=\rho$
\end_inset

，我们可以作替换
\begin_inset Formula 
\begin{equation}
\delta\rho=\nabla\cdot(\delta\sbf D).\label{eq:j4.85}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
\nabla\cdot(\Phi\delta\sbf D) & =(\nabla\phi)\cdot\delta\sbf D+\Phi\nabla\cdot\delta\sbf D\\
 & =-\sbf E\cdot\delta\sbf D+\Phi\delta\rho
\end{align*}

\end_inset

如果电荷分布在有限空间内，则 
\begin_inset Formula $\nabla\cdot(\Phi\delta\sbf D)$
\end_inset

 在全空间的积分为零（应用高斯散度定理）。因此可以把静电能的变分写成：
\begin_inset Formula 
\begin{equation}
\delta W=\int\sbf E\cdot\delta\sbf D\dd[3]{x}.\label{eq:j4.86}
\end{equation}

\end_inset

因此当
\begin_inset Formula $\sbf D$
\end_inset

从初始值
\begin_inset Formula $0$
\end_inset

变化到最终值时，在形式上可以把静电能写成：
\begin_inset Formula 
\begin{equation}
W=\int\dd[3]x\int_{0}^{D}\sbf E\cdot\delta\sbf D.\label{eq:j4.87}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
如果介质是 
\emph on
线性的
\emph default
，则
\begin_inset Formula 
\begin{equation}
\sbf E\cdot\delta\sbf D=\frac{1}{2}\delta\left(\sbf E\cdot\sbf D\right).\label{eq:4.88}
\end{equation}

\end_inset

总能量可以写成
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\int\sbf E\cdot\sbf D\dd[3]{x}.\label{eq:j4.89}
\end{equation}

\end_inset

如果假设 
\begin_inset Formula $\rho$
\end_inset

 和 
\begin_inset Formula $\Phi$
\end_inset

 是线性相关的，通过 
\begin_inset Formula $\sbf E=-\nabla\Phi$
\end_inset

 和 
\begin_inset Formula $\nabla\cdot\sbf D=\rho$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.89"
plural "false"
caps "false"
noprefix "false"

\end_inset

 可以回到
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.83"
plural "false"
caps "false"
noprefix "false"

\end_inset

或
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.84"
plural "false"
caps "false"
noprefix "false"

\end_inset

 。因此，
\emph on
只有当行为是线性的，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.83"
plural "false"
caps "false"
noprefix "false"

\end_inset

在宏观上才成立。
\emph default
否则，只能使用
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.87"
plural "false"
caps "false"
noprefix "false"

\end_inset

计算，最终的 静电能 依赖于极化历史。
\end_layout

\begin_layout Section
非线性材料的电容矩阵
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
g1 = Plot[x^(3/5), {x, 0, 5} , AxesLabel -> {"D", "E"} , ImageSize -> Small];
 g2 = Plot[Log[x + 1], {x, 0, 5} , AxesLabel -> {"Q", "U"} , ImageSize ->
 Small]; GraphicsRow[{g1, g2}]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/capacitance-curve.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Formula $E-D$
\end_inset

曲线与
\begin_inset Formula $U-Q$
\end_inset

曲线，静电能的等价表示形式为
\begin_inset Formula $\delta w=E\delta D$
\end_inset

，
\begin_inset Formula $\delta w=U\delta Q$
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
follow XuLei，两张图中，曲线上的点是一一对应的，根据对应关系有：
\begin_inset Formula 
\begin{align*}
\frac{1}{2}\delta\sbf E\cdot\delta\sbf D & =\frac{1}{2}\delta U\delta fQ\\
 & =\frac{1}{2}\delta U\;C\delta U
\end{align*}

\end_inset

假设由边值问题
\begin_inset Formula $\alpha$
\end_inset

，求解出了电场结果 
\begin_inset Formula $\beta$
\end_inset

。在确定的几何点
\begin_inset Formula $P$
\end_inset

，和电场 
\begin_inset Formula $\sbf E$
\end_inset

 下，
\begin_inset Formula $\varepsilon=\partial D/\partial E$
\end_inset

，
\begin_inset Formula $C=\partial Q/\partial U$
\end_inset

 都是确定的。这时候作完全线性化，完全按照线性系统处理，取 
\begin_inset Formula $\delta U=\SI{1}{V}$
\end_inset

，给出
\begin_inset Formula 
\[
C=\delta\sbf E\cdot\delta\sbf D.
\]

\end_inset

这个式子的含义是：
\end_layout

\begin_layout Enumerate
体系此时的电容，可以由 
\begin_inset Formula $\delta U=\SI{1}{V}$
\end_inset

 条件定出的电场得到；
\end_layout

\begin_layout Enumerate
在使用 Galerkin 方程计算过程中，认定 
\begin_inset Formula $\varepsilon=\partial D/\partial E$
\end_inset

 为常数，
\begin_inset Formula $\varepsilon$
\end_inset

 的每一几何点的具体值，由之前边值问题的解 
\begin_inset Formula $\beta$
\end_inset

 提供；材料性质的影响体现在此处。
\end_layout

\begin_layout Enumerate
而 
\begin_inset Formula $\sbf D$
\end_inset

与 
\begin_inset Formula $\sbf E$
\end_inset

 的关系，由材料在当前 
\begin_inset Formula $\sbf E$
\end_inset

 下的电介质数 
\begin_inset Formula $\varepsilon$
\end_inset

 决定。非线性材料的 电介质数 
\begin_inset Formula $\varepsilon$
\end_inset

 与 
\begin_inset Formula $\sbf E$
\end_inset

 的关系可能比较复杂，但在当前一点可以当成常数。
\end_layout

\begin_layout Enumerate
并且对于多导体系统，还类似地定义电容矩阵：
\begin_inset Formula 
\[
C_{ij}=\frac{1}{\delta U_{i}\delta U_{j}}\int_{\Omega}\sbf D_{i}\cdot\sbf E_{j}\dd{\Omega},
\]

\end_inset

积分区域是全系统空间，实际上还取了 
\begin_inset Formula $\delta U_{i}=\delta U_{j}=\SI{1}{V}$
\end_inset

。
\end_layout

\begin_layout Remark
体系的电容 
\begin_inset Formula $C$
\end_inset

 与体系的几何构型，以及材料的电介质数 
\begin_inset Formula $\varepsilon$
\end_inset

 相关。以上方法实际上就是：
\color blue
在点的局域上，把 非线性材料 权当成 线性材料 处理
\color inherit
。线性材料的互容矩阵实际上就是
\begin_inset Formula 
\[
C_{ij}=\frac{1}{U_{i}U_{j}}\int_{\Omega}\sbf D_{i}\cdot\sbf E_{j}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Section
虚功法
\end_layout

\begin_layout Standard
FEM-Gerard; sec 38/54;
\end_layout

\begin_layout Standard
刚体上的力和力矩（torque）也可以使用虚功原理（virtual work theorem）计算。在微小位移
\begin_inset Formula $\delta u$
\end_inset

下，装置的内能（internal energy）的变化 
\begin_inset Formula $\delta W_{e}$
\end_inset

，等于 外源（external sources）输入的电能，加上力 
\begin_inset Formula $-F_{u}$
\end_inset

（牛顿第三定律）的功：
\begin_inset Formula 
\begin{equation}
\delta W_{e}=\sum V_{k}\delta Q_{k}-F_{u}\delta u=\sum\frac{\partial W_{e}}{\partial Q_{k}}\delta Q_{k}+\frac{\partial W_{e}}{\partial u}\delta u.\label{eq:g1.117}
\end{equation}

\end_inset


\end_layout

\begin_layout Example
在实验一中，装置与外界电源隔离。电极上的电荷总量不变，即 
\begin_inset Formula $\delta Q_{k}=0$
\end_inset

，因此给出
\begin_inset Formula 
\begin{align}
 & F_{u}=-\frac{\partial W_{e}}{\partial u}.\label{eq:g1.118}\\
 & C_{\omega}=-\frac{\partial W_{e}}{\partial\theta}.\label{eq:g1.119}
\end{align}

\end_inset

其中 
\begin_inset Formula $C_{\omega}$
\end_inset

 表示绕旋转轴 
\begin_inset Formula $\omega$
\end_inset

 的力矩。求偏导时，保持 electric state variable（电极上的电荷）不变。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
在实验二中，把装置连接到 恒压源，电极上的电势 
\begin_inset Formula $V_{k}$
\end_inset

 保持不变，而电极上的电荷可能会变化 
\begin_inset Formula $\delta Q_{k}$
\end_inset

。现在，更适合用系统的共能（coenergy）去分析。
\begin_inset Formula 
\begin{align}
 & \sum V_{k}\delta Q_{k}-\sum\delta\left(V_{k}Q_{k}\right)-F_{u}\delta u=\delta W_{e}-\sum\delta\left(V_{k}Q_{k}\right).\label{eq:g1.120}\\
\Rightarrow & -\sum Q_{k}\delta V_{k}-F_{u}\delta u=-\delta W_{c}=-\sum\frac{\partial W_{c}}{\partial V_{k}}\delta V_{k}-\frac{\partial W_{c}}{\partial u}\delta u.\label{eq:g1.121}
\end{align}

\end_inset

现在，力和力矩可以用 共能 的偏导表示，
\begin_inset Formula 
\begin{align}
 & F_{u}=\frac{\partial W_{c}}{\partial u},\label{eq:g1.122}\\
 & C_{\omega}=\frac{\partial W_{c}}{\partial\theta}.\label{eq:g1.123}
\end{align}

\end_inset

求偏导时保持 electric state variable（电极上的电压）不变。
\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Plain Layout
page 20/36;
\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\begin{equation}
\frac{\partial W_{c}}{\partial v_{i}}=-\iint D\cdot\mathrm{grad}\varphi_{i}h\dd{x}\dd{y}-\iint\rho\varphi_{i}h\dd{x}\dd{y}=0\quad\text{for}\quad i=1,2,\cdots,N_{L}\label{eq:g1.52-1}
\end{equation}

\end_inset


\begin_inset Formula $v_{i}$
\end_inset

 表示节点上的值，一共有 
\begin_inset Formula $N_{L}$
\end_inset

个。
\end_layout

\begin_layout Plain Layout
page 14/30;
\begin_inset Formula 
\begin{equation}
W_{c}=\iint\left[\int_{0}^{-\nabla v}D\dd{E}-\rho v\right]h\dd{x}\dd{y}\label{eq:g1.35-1}
\end{equation}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Example
当电极上的电势保持常数时，coenergy 的有限元近似只是位移 
\begin_inset Formula $u$
\end_inset

 的函数，或者通过 
\color blue
节点的坐标直接依赖
\color inherit
，或者通过 
\color brown
节点电势间接依赖
\color inherit
：
\begin_inset Formula 
\begin{equation}
W_{c}=W_{c}\left[{\color{brown}v_{1}(u),v_{2}(u),\cdots,v_{N_{L}}(u)},{\color{blue}u}\right]=W_{c}(u).\label{eq:g1.126}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
F_{u}=\frac{\dd{W_{c}}}{\dd{u}}=\sum_{j=1}^{N_{L}}\frac{\partial W_{c}}{\partial v_{j}}\frac{\dd{v_{j}}}{\dd{u}}+\frac{\partial W_{c}}{\partial u}.\label{eq:g1.127}
\end{equation}

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g1.52-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，共能对 节点电势的偏导为零，因此
\begin_inset Formula 
\begin{equation}
F_{u}=\frac{\partial W_{c}}{\partial u}.\label{eq:g1.128}
\end{equation}

\end_inset

求偏导时保持 节点电势不变。
\end_layout

\begin_layout Example
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/Gerard-1.11.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Virtual deformation of the meshing。浅灰色的是弹性单元。白色的是刚体单元。空心节点表示能够运动。
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
开放边界/开域问题
\end_layout

\begin_layout Standard
有限元方法只能处理有限大的空间，因此对于电场的开域问题，需要在边界上施加适当的边界条件来模拟边界的性质。首先根据麦克斯韦方程组，可以得到开域情况下电势满足的积分
方程：
\begin_inset Formula 
\[
\Phi\left(\sbf r\right)=\frac{1}{4\pi\varepsilon_{0}}\int\dd[3]{r'}\frac{1}{\abs{r-r'}}\left[\rho\left(\sbf r'\right)-\nabla'\cdot\sbf P\left(\sbf r'\right)\right]
\]

\end_inset

由于源都是局域的，因此在远离源的位置可以做如下展开：
\begin_inset Formula 
\[
\frac{1}{\abs{\sbf r-\sbf r'}}=\frac{1}{\abs{\sbf r}}+\frac{\sbf r\cdot\sbf r'}{\abs{\sbf r}^{3}}+\cdots
\]

\end_inset


\end_layout

\begin_layout Standard
取决于源的分布情况，电势在远离源的位置可能是以 
\begin_inset Formula $r^{-1}$
\end_inset

，或 
\begin_inset Formula $r^{-2}$
\end_inset

的形式衰减到零。在忽略高阶项的情况下，可以在远离源的位置将电势近似为
\begin_inset Formula 
\begin{equation}
\Phi=\frac{a}{r^{n}},\label{eq:xl2.6}
\end{equation}

\end_inset

其中 
\begin_inset Formula $a$
\end_inset

 是与 
\begin_inset Formula $r$
\end_inset

 无关的量；
\begin_inset Formula $n$
\end_inset

 可以由电荷的分布情况决定，对于同种电荷 
\begin_inset Formula $n$
\end_inset

 一般取
\begin_inset Formula $1$
\end_inset

，对于电偶极子
\begin_inset Formula $n$
\end_inset

一般取
\begin_inset Formula $2$
\end_inset

。在有限元模型边界上可以采用截断法来模拟开域边界，即取 
\begin_inset Formula $\Phi=0$
\end_inset

，或 
\begin_inset Formula $\nabla\Phi=0$
\end_inset

。两种处理方式分别对应 第一、二类边界条件，理论上的计算精度分别为 
\begin_inset Formula $\order{r^{-n}}$
\end_inset

 和 
\begin_inset Formula $\order{r^{-n-1}}$
\end_inset

。另外使用 
\begin_inset Formula $\nabla\frac{1}{r}=\frac{1}{r^{2}}\sbf e_{r}=\frac{1}{r^{2}}\frac{\sbf r}{r}$
\end_inset

，从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到： 
\begin_inset Formula 
\begin{equation}
\nabla\Phi=-na\frac{1}{r^{n+1}}\frac{\sbf r}{r}=-n\frac{\Phi}{r}\frac{\sbf r}{r}.\label{eq:xl2.7}
\end{equation}

\end_inset

如果在边界上采用 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 处理模型边界上的电势，那么理论上的计算精度可以达到 
\begin_inset Formula $\order{r^{-n-2}}$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示的条件即为 渐近边界条件（Asymptotic boundary condition），对应有限元计算中的第三类边界条件。
\end_layout

\begin_layout Section
表面项
\end_layout

\begin_layout Standard
在泛函积分式(2.2)
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\Phi\right)=\frac{1}{2}\int_{\Omega}\nabla\Phi\cdot\epsilon_{r}\nabla\Phi\dd{\Omega}-\int\frac{\rho}{\epsilon_{0}}\Phi\dd{\Omega}.\label{eq:xl2.2}
\end{equation}

\end_inset

中添加一个表面项得到新的泛函积分
\begin_inset Formula 
\[
\mathcal{F}\left(\Phi\right)=\frac{1}{2}\int_{\Omega}\nabla\Phi\cdot\epsilon_{r}\nabla\Phi\dd{\Omega}-\int\frac{\rho}{\epsilon_{0}}\Phi\dd{\Omega}+{\color{blue}\int_{\Gamma}\epsilon_{r}\frac{n}{r}\frac{\Phi\epsilon_{r}\Phi}{2}}\dd{\Gamma}.
\]

\end_inset

对上式做变分可以得到（使用分部积分）
\begin_inset Formula 
\[
\delta\mathcal{F}\left(\Phi\right)=-\int_{\Omega}\left(\nabla\cdot\epsilon_{r}\nabla\Phi+\frac{\rho}{\epsilon_{0}}\right)\delta\Phi\dd{\Omega}+\int_{\Gamma}\left({\color{blue}\sbf e_{n}\cdot\epsilon_{r}\nabla\Phi+\frac{n}{r}\epsilon_{r}\Phi}\right)\delta\Phi\dd{\Gamma}.
\]

\end_inset

从方程中的第二项可得
\begin_inset Formula 
\[
\sbf e_{n}\cdot\nabla\Phi=-n\frac{\Phi}{r}
\]

\end_inset

它等价于
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\Phi=-n\frac{\Phi}{r}\frac{\sbf r}{r}$
\end_inset

。对比第三类边界条件的标准形式：
\begin_inset Formula 
\[
\left(\alpha\nabla\Phi\right)\cdot\sbf n=q-\gamma\Phi
\]

\end_inset

相当于取 
\begin_inset Formula $\alpha=1$
\end_inset

，
\begin_inset Formula $q=0$
\end_inset

，
\begin_inset Formula $-\gamma=-\frac{n}{r}$
\end_inset

。
\end_layout

\begin_layout Remark
综上，开域边界条件相当于
\begin_inset Formula 
\[
-\nabla\Phi=\frac{n}{r}\Phi\,\sbf e_{r}
\]

\end_inset

取上式的变分得（变分和微分交换次序）
\begin_inset Formula 
\[
-\nabla\delta\Phi=\frac{n}{r}\delta\Phi\,\sbf e_{r}
\]

\end_inset


\end_layout

\begin_layout Section
Galerkin法
\end_layout

\begin_layout Standard
对于Galerkin 方法，保持残差函数不变
\begin_inset Formula 
\[
R^{e}\left[N_{i}^{e}\right]=\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}N_{i}^{e}\left({\color{blue}\nabla\cdot\sbf D}-\rho\right)\dd{\Omega}
\]

\end_inset

推导中的分部积分会自然地引入边界条件的贡献。考察 Galerkin 方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的边界项
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}
\end{align*}

\end_inset

其中（在开放边界足够大，渐近于球形的近似下）
\begin_inset Formula 
\[
{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot(-\sbf\nabla\delta\phi)}\Rightarrow N_{i}^{e}\sbf e_{r}\cdot\frac{\partial D}{\partial E}\cdot\sbf e_{r}\;\frac{n}{r}\delta\Phi
\]

\end_inset

同理，若代入微扰展开 
\begin_inset Formula $\delta\phi=\sum_{e=1}^{N}N_{j}^{e}\delta\phi_{j}$
\end_inset

，相当于在刚阵中添加一项
\begin_inset Formula 
\begin{equation}
N_{i}^{e}\;\sbf e_{r}\cdot\frac{\partial D}{\partial E}\cdot\sbf e_{r}\frac{n}{r}\;N_{j}^{e}\label{eq:el-open}
\end{equation}

\end_inset

或者写成
\begin_inset Newline newline
\end_inset


\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset Formula 
\[
\sbf r\cdot\frac{\partial D}{\partial E}\cdot\sbf r\;\frac{n}{r^{3}}\;N_{i}^{e}N_{j}^{e}
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{i}^{e}N_{j}^{e}$
\end_inset

 可以理解为 
\begin_inset Formula $N_{i1}^{e}N_{1j}^{e}=\left(N^{e}\cdot N^{e,T}\right)_{ij}$
\end_inset

，
\begin_inset Formula $N_{i1}^{e}$
\end_inset

为列矩阵。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r=\sqrt{x^{2}+y^{2}+z^{2}}$
\end_inset

，表示原点
\begin_inset Formula $O$
\end_inset

 到场点 
\begin_inset Formula $P$
\end_inset

 的距离。
\end_layout

\begin_layout Enumerate
为了保证计算精度，程序中要求开域边界条件的几何边界尽量为球形或圆形。
\end_layout

\begin_layout Section
边界形状和误差
\end_layout

\begin_layout Standard
对于球形边界，垂直边界的矢量 
\begin_inset Formula $\sbf e_{n}=\frac{\sbf r}{r}$
\end_inset

，所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示的渐近边界条件可以通过在泛函积分中添加相应的表面项来处理。对于非球形边界，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

近似成立。这一项会在原来的 
\begin_inset Formula $\left[K_{ij}^{e}\right]$
\end_inset

 矩阵中增加表面项的贡献
\begin_inset Formula 
\begin{equation}
K_{ij}^{s}=\int_{\Gamma^{e}}\epsilon_{r}\frac{n}{r}N_{i}^{e}N_{j}^{e}\dd{\Gamma}.\label{eq:xl2.8}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
由于 
\begin_inset Formula $r$
\end_inset

 在球形边界是定值，可以直接提取到积分外面；即使对于非圆形边界，
\begin_inset Formula $1/r$
\end_inset

 在边界处表面单元中变换不大，所以依然可以提到积分号外面。下面分二维，轴对称和三位情况分别计算 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
三维有限元的边界为一平面，采用高斯积分法计算的表达式为
\begin_inset Formula 
\[
K_{ij}^{s}=\epsilon_{r}\frac{n}{r}\Delta^{s}\sum_{\alpha}N_{i}^{s}\left(\xi_{\alpha},\eta_{\alpha}\right)\,N_{j}^{s}\left(\xi_{\alpha},\eta_{\alpha}\right)\,W\left(\xi_{\alpha},\eta_{\alpha}\right)
\]

\end_inset

其中 
\begin_inset Formula $\Delta^{s}$
\end_inset

 为边界单元的面积。
\end_layout

\begin_layout Remark
ref：郭硕鸿 p63/77。电多级展开：
\begin_inset Formula 
\[
f\left(\sbf x-\sbf x'\right)=f\left(\sbf x\right)-\sbf x'\cdot\nabla f@\sbf x+\frac{1}{2!}\left(\sbf x'\cdot\nabla\right)^{2}f@\sbf x+\cdots
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\varphi\left(x\right)=\frac{1}{4\pi\varepsilon_{0}}\left(\frac{Q}{R}-\sbf p\cdot\nabla\frac{1}{R}+\frac{1}{6}\sum_{i,j}\mathcal{D}_{ij}\partial_{i}\partial_{j}\frac{1}{R}+\cdots\right)\label{eq:g6.7}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
Q & =\int_{V}\rho\left(\sbf x'\right)\dd{V'}\\
\sbf p & =\int_{V}\rho\left(\sbf x'\right)\dd{V'}\\
\mathcal{D}_{ij} & =\int_{V}3x'_{i}x'_{j}\,\rho\left(\sbf x'\right)\dd{V'}
\end{align*}

\end_inset

其中
\begin_inset Formula $R=\sqrt{x^{2}+y^{2}+z^{2}}$
\end_inset

，表示原点到场点 
\begin_inset Formula $P$
\end_inset

 的距离。
\end_layout

\begin_layout Section
外加电场
\end_layout

\begin_layout Subsection
解析解的例子
\end_layout

\begin_layout Standard
ref: 郭硕鸿 p51/65；均匀介质球的极化，球外为真空，半径为 
\begin_inset Formula $R_{0}$
\end_inset

，均匀外电场为 
\begin_inset Formula $\sbf E_{0}$
\end_inset

。
\begin_inset CommandInset label
LatexCommand label
name "ref:g51"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/GuoShuoHong-2.5.png
	lyxscale 50
	scale 40

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\sbf E_{0}$
\end_inset

 的方向为球坐标系 
\begin_inset Formula $z$
\end_inset

 轴，并过球心
\begin_inset Formula 
\begin{align}
\text{球外解：} & \varphi_{1}=-E_{0}R\cos\theta+\frac{\varepsilon-\epsilon_{0}}{\varepsilon+2\epsilon_{0}}\frac{E_{0}R_{0}^{3}\cos\theta}{R^{2}}\nonumber \\
\text{球内解：} & \varphi_{2}=-\frac{3\epsilon_{0}}{\varepsilon+2\epsilon_{0}}E_{0}R\cos\theta.\label{eq:g3.21}
\end{align}

\end_inset

球内是均匀电场，球内束缚电荷激发的场与原外场反向，使总电场减弱。在球内总电场作用下，介质的极化强度为
\begin_inset Formula 
\begin{equation}
\sbf P=\chi_{e}\epsilon_{0}\sbf E=\left(\varepsilon-\epsilon_{0}\right)\sbf E=\frac{\varepsilon-\epsilon_{0}}{\varepsilon+2\epsilon_{0}}3\epsilon_{0}\sbf E_{0}\label{eq:g3.22}
\end{equation}

\end_inset

 介质球的总电偶极矩为
\begin_inset Formula 
\begin{equation}
\sbf p=\frac{4\pi}{3}R_{0}^{3}\sbf P=\frac{\varepsilon-\epsilon_{0}}{\varepsilon+2\epsilon_{0}}4\pi\epsilon_{0}R_{0}^{3}\sbf E_{0}\label{eq:g3.23}
\end{equation}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.21"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的第二项正是此电偶极矩所产生的电势
\begin_inset Formula 
\begin{equation}
\frac{1}{4\pi\epsilon_{0}}\frac{\sbf p\cdot\sbf R}{R^{3}}=\frac{\varepsilon-\epsilon_{0}}{\varepsilon+2\epsilon_{0}}\frac{E_{0}R_{0}^{3}\cos\theta}{R^{2}}\label{eq:g3.24}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
有限元中的处理
\end_layout

\begin_layout Standard
在程序实现中，规定 
\color blue
外加电场
\color inherit
 总是配合 
\color blue
开域边界
\color inherit
 一同使用，且边界应当是球形，介质是线性的。令外加电场为 
\begin_inset Formula $\sbf E_{0}$
\end_inset

，除去它的影响之后，令 有限区域电荷产生的电势为 
\begin_inset Formula $\Phi$
\end_inset

，令总电势为 
\begin_inset Formula $\Phi_{t}=\Phi-\sbf E_{0}\cdot\sbf r$
\end_inset

， 
\begin_inset Formula $\Phi$
\end_inset

 应该满足 开域边界条件 的性质，即
\begin_inset Formula 
\begin{equation}
{\color{brown}-\nabla\Phi=\frac{n}{r}\Phi\,\sbf e_{r}}\label{eq:phi-local}
\end{equation}

\end_inset

代入 
\begin_inset Formula $\Phi={\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}$
\end_inset

， 
\begin_inset Formula 
\[
-\nabla\left({\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}\right)=\frac{n}{r}\left({\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}\right)\sbf e_{r}
\]

\end_inset

略微化简给出
\begin_inset Formula 
\begin{equation}
{\color{brown}-\nabla\Phi_{t}=\frac{n}{r}\Phi_{t}\sbf e_{r}}+\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{r}\right)\sbf e_{r}\label{eq:phi-global}
\end{equation}

\end_inset

可以看到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi-global"
plural "false"
caps "false"
noprefix "false"

\end_inset

 与 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi-local"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的区别是多了后面两项。代入Galerkin 方程 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gal3"
plural "false"
caps "false"
noprefix "false"

\end_inset

边界项 
\begin_inset Formula $N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot(\sbf\nabla\delta\phi)$
\end_inset

：并把 
\begin_inset Formula ${\color{brown}-\nabla\Phi_{t}=\frac{n}{r}\Phi_{t}\sbf e_{r}}$
\end_inset

 的贡献归入刚阵 
\begin_inset Formula $K_{ij}^{e}$
\end_inset

；把 
\begin_inset Formula $\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{r}\right)\sbf e_{r}$
\end_inset

 的贡献归入 载荷（Load），载荷项的形式为
\begin_inset Formula 
\[
-N_{i}\,\sbf e_{n}\cdot\varepsilon\cdot\left[\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{R}\right)\sbf e_{R}\right].
\]

\end_inset


\end_layout

\begin_layout Subsection
backup
\end_layout

\begin_layout Standard
在有限元框架下求解外加电场的问题，外加电场 
\begin_inset Formula $\sbf E_{0}$
\end_inset

 的影响体现在 两个边界项中。观察 Galerkin 方程
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}
\end{align*}

\end_inset


\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}$
\end_inset

这一项体现的是背景场（即
\begin_inset Formula $\sbf E_{0}$
\end_inset

 ）的贡献；而 
\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}$
\end_inset

 则类似于开域边界条件。
\end_layout

\begin_layout Standard
参考 
\begin_inset CommandInset ref
LatexCommand eqref
reference "ref:g51"
plural "false"
caps "false"
noprefix "false"

\end_inset

，在外加电场影响下，极化电荷在边界处的电势形如
\begin_inset Formula 
\[
\Phi=a\frac{\cos\theta}{R^{n}},
\]

\end_inset

对于电偶极子 
\begin_inset Formula $n=2$
\end_inset

，其中 
\begin_inset Formula $\cos\theta=\sbf E_{0}\cdot\sbf e_{R}$
\end_inset

。考察边界上的电势法向量，
\begin_inset Formula 
\[
-\nabla\Phi=a\frac{\cos\theta}{R^{n}}\frac{n}{R}\sbf e_{R}+a\frac{\sin\theta}{R^{n}}\frac{1}{R}\sbf e_{\theta}
\]

\end_inset

对应的变分是
\begin_inset Formula 
\[
-\sbf\nabla\delta\phi=\frac{n}{R}\sbf e_{R}\delta\Phi+(\cdots)\sbf e_{\theta}
\]

\end_inset

Galerkin 方程边界项的贡献是
\begin_inset Formula 
\[
-N_{i}^{e}\sbf e_{n}\cdot\varepsilon\cdot{\color{brown}\sbf\nabla\delta\phi}=N_{i}^{e}\sbf e_{n}\cdot\varepsilon\cdot{\color{brown}\sbf e_{R}\,\frac{n}{R}\delta\Phi}
\]

\end_inset


\end_layout

\begin_layout Remark
其中使用了球坐标下的梯度表达式
\begin_inset Formula 
\[
\nabla\psi=\sbf e_{r}\partial_{r}\psi+\frac{1}{r}\sbf e_{\theta}\partial_{\theta}\psi+\frac{1}{r\sin\theta}\partial_{\phi}\sbf e_{\phi}.
\]

\end_inset


\end_layout

\begin_layout Chapter
电流场分析
\end_layout

\begin_layout Section
稳态电流场
\end_layout

\begin_layout Standard
导体中的电流密度矢量会因为导体的几何构型出现不均匀的分布，通过建立电流场相关的方程，用有限元进行求解，可以得到导体目标区域的电流密度矢量分布情况，计算欧姆损耗等
。在稳态情况下，电流密度矢量可以通过欧姆定理表示为
\begin_inset Formula 
\[
\sbf J=\sigma\sbf E
\]

\end_inset

而电场又可以表示为势能的梯度，即
\begin_inset Formula 
\[
\sbf E=-\nabla\phi
\]

\end_inset

根据连续性方程
\begin_inset Formula $\nabla\cdot\sbf J=0$
\end_inset

，最终可以得到稳态电流场中，标量势所满足的方程
\begin_inset Formula 
\[
\nabla\cdot\sigma\nabla\phi=0.
\]

\end_inset

其表达式与静电场的方程类似，只是方程系数由介电常数换成电导率。另外电流密度矢量在沿着导体流动的截面上还需要满足约束方程
\begin_inset Formula 
\[
\int_{S}\sbf J\cdot\dd{\sbf S}=-\int_{S}\sigma\nabla\phi\cdot\dd{\sbf S}=I
\]

\end_inset


\end_layout

\begin_layout Standard
综合上述方程，就可以计算稳态电流场中的势能分布，进而计算出空间中的电流密度矢量等物理量。
\end_layout

\begin_layout Section
时谐和瞬态电流场
\end_layout

\begin_layout Standard
在稳态电流场的问题中，标量势
\begin_inset Formula $\phi$
\end_inset

的分布不随时间变化，但在瞬态问题或交流问题中，因为电流场随时间变化，需要考虑位移电流
\begin_inset Formula $\sbf D$
\end_inset

的影响。这种情况下，电流密度矢量可以表示为
\begin_inset Formula 
\[
\sbf J=-\varepsilon\frac{\partial\sbf E}{\partial t}-\sigma\sbf E.
\]

\end_inset

同样利用电场
\begin_inset Formula $\sbf E$
\end_inset

的势能表达式和连续性方程，可以得到
\begin_inset Formula 
\[
\nabla\cdot\varepsilon\frac{\partial\nabla\phi}{\partial t}+\nabla\cdot\sigma\nabla\phi=0.
\]

\end_inset

在时谐情况下，将势能表示为复数的形式 
\begin_inset Formula $\phi(t)=\phi\exp(i\omega t)$
\end_inset

 ，可以得到准静态方程
\begin_inset Formula 
\[
i\omega\nabla\cdot\varepsilon\nabla\phi+\nabla\cdot\sigma\nabla\phi=0.
\]

\end_inset


\end_layout

\begin_layout Section
电流场方程的有限元求解
\end_layout

\begin_layout Standard
在为模型划分好有限元网格之后，标量势可以用节点电势和单元形函数表示为
\begin_inset Formula 
\[
\phi(x,y,z)=N_{i}^{e}(x,y,z)\phi_{i}
\]

\end_inset

利用 Galerkin 方法或者构建泛函积分的方法，可以得到
\begin_inset Formula 
\[
\left(\int_{\Omega}\nabla N_{i}^{e}\cdot\varepsilon\nabla N_{j}^{e}\dd{\Omega}\right)\frac{\partial\phi_{j}}{\partial t}+\left(\int_{\Omega}\nabla N_{i}^{e}\cdot\sigma\nabla N_{j}^{e}\dd{\Omega}\right)\phi_{j}=0
\]

\end_inset

定义系数矩阵
\begin_inset Formula 
\begin{align*}
 & M_{ij}^{e}=\int_{\Omega}\nabla N_{i}^{e}\cdot\varepsilon\nabla N_{j}^{e}\dd{\Omega},\\
 & K_{ij}^{e}=\int_{\Omega}\nabla N_{i}^{e}\cdot\sigma\nabla N_{j}^{e}\dd{\Omega}.
\end{align*}

\end_inset

得到相应的矩阵方程
\begin_inset Formula 
\[
M_{ij}^{e}\frac{\partial\phi_{j}}{\partial t}+K_{ij}^{e}\phi_{j}=0.
\]

\end_inset


\end_layout

\begin_layout Enumerate
对于稳态问题，方程中的第一项不存在；
\end_layout

\begin_layout Enumerate
对于时谐问题，利用 
\begin_inset Formula $\partial_{t}\phi=i\omega\phi$
\end_inset

，可以将上述方程转化为准静态问题进行求解；
\end_layout

\begin_layout Standard
对于瞬态问题，可以用隐式欧拉方法，将
\begin_inset Formula $\partial_{t}\phi$
\end_inset

进行离散处理
\begin_inset Formula 
\[
\frac{\partial\phi}{\partial t}=\frac{\phi_{j}^{t+\Delta t}-\phi_{j}^{t}}{\Delta t}.
\]

\end_inset

然后基于时间离散后的矩阵方程，对时间迭代，得到各个时刻网格节点上的势能
\begin_inset Formula $\phi$
\end_inset

，进而得到电流密度矢量的分布。
\begin_inset Formula 
\[
\left(\frac{M_{ij}^{e}}{\Delta t}+K_{ij}^{e}\right)\phi_{j}^{t+\Delta t}=M_{ij}^{e}\frac{\phi_{j}^{t}}{\Delta t}
\]

\end_inset


\begin_inset Formula 
\[
\phi_{j}^{t+\Delta t}=\phi_{j}^{t}+\phi_{jA}^{t+\Delta t}+\delta\phi_{j}^{t+\Delta t}
\]

\end_inset


\begin_inset Formula 
\[
\left(\frac{M_{ij}^{e}}{\Delta t}+K_{ij}^{e}\right)\left(\phi_{j}^{t}+\phi_{jA}^{t+\Delta t}+\delta\phi_{j}^{t+\Delta t}\right)=\frac{M_{ij}^{e}}{\Delta t}\phi_{j}^{t}
\]

\end_inset


\begin_inset Formula 
\[
\left(\frac{M_{ij}^{e}}{\Delta t}+K_{ij}^{e}\right)\delta\phi_{t}^{j+\Delta t}=-\left[\frac{M_{ij}^{e}}{\Delta t}\phi_{j,A}^{t+\Delta t}+K_{ij}^{e}\left(\phi_{j}^{t}+\phi_{jA}^{t+\Delta t}\right)\right]
\]

\end_inset


\end_layout

\begin_layout Standard
在获得各个节点的电势后，通过形函数插值，进而得到空间各处的电流密度矢量和电场的分布。另外空间各处的欧姆损耗功率密度也可以通过电流密度矢量和电场进行计算，其表达式
为
\begin_inset Formula 
\[
P=\sbf J\cdot\sbf E
\]

\end_inset

导体总的欧姆损耗可以通过对空间各处的欧姆损耗功率密度
\begin_inset Formula $P$
\end_inset

进行积分得到。
\end_layout

\begin_layout Section
浮动导体，节点共自由度
\end_layout

\begin_layout Standard
有限元求解边值问题的公式推演如下
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
-\nabla\cdot\left(\sigma\nabla\phi\right)+\beta\phi & =\partial_{t}\rho\\
\sigma\frac{\partial\phi}{\partial n} & =q-\gamma\phi\quad\text{on}\quad\Gamma_{3}
\end{align*}

\end_inset

能量泛函
\begin_inset Formula 
\begin{align*}
\mathcal{F}(\phi)= & \frac{1}{2}\int_{\Omega}\left[(\nabla\phi)\cdot\sigma\cdot(\nabla\phi)\right]\dd{V}+\int_{\Gamma}\left[\frac{\gamma}{2}\left(\phi^{s}\right)^{2}-q\phi^{s}\right]\dd{\Gamma}\\
= & -\frac{1}{2}\int_{\Omega}\phi\nabla\cdot\left(\sigma\cdot\nabla\phi\right)\dd{V}\\
 & +\oint_{\Gamma}\left[\frac{\sigma}{2}\phi^{s}\frac{\partial}{\partial n}\phi^{s}+\frac{\gamma}{2}\left(\phi^{s}\right)^{2}-q\phi^{s}\right]\dd{\sbf\Gamma}
\end{align*}

\end_inset

非线性迭代
\begin_inset Formula 
\begin{align*}
 & \left[\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\kappa(E^{0})\cdot\nabla N_{\beta}^{e}}\dd{\Omega}\right]\delta\phi_{\beta}+{\color{brown}\left[\int_{\Gamma^{e}}\gamma N_{\alpha}^{e}N_{\beta}^{e}\dd{\Gamma}\right]}\delta\phi_{\beta}\\
 & \qquad=\lambda\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\sbf D^{0}}\dd{\Omega}\right]+\lambda\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,q}\dd{\Gamma}+\int_{\Omega^{e}}N_{\alpha}^{e}\,\partial_{t}\rho\,\dd{\Omega}
\end{align*}

\end_inset

对于电流场问题，如果在边界
\begin_inset Formula $\Gamma$
\end_inset

上给定了总电流
\begin_inset Formula $I$
\end_inset

，因为电流总是沿着边界的法向，根据
\begin_inset Formula $\sbf J=\sigma\sbf E$
\end_inset

，也就是电势梯度沿着边界法向，所以此时边界
\begin_inset Formula $\Gamma$
\end_inset

成为
\begin_inset Formula $\phi$
\end_inset

的等势面，可以将边界
\begin_inset Formula $\Gamma$
\end_inset

上的所有节点简化为单个节点，即所谓的
\series bold
共自由度问题
\series default
。电流密度边界条件相当于
\begin_inset Formula $q$
\end_inset

项，对于共节点问题，由于
\begin_inset Formula $\Gamma$
\end_inset

上的节点坍缩到单自由度，电流密度的积分 
\begin_inset Formula $\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,q}\dd{\Gamma}$
\end_inset

 坍缩到 总电流 
\begin_inset Formula $I$
\end_inset

。
\end_layout

\begin_layout Standard
浮动导体将增加额外1个边界自由度
\begin_inset Formula $\phi_{f}$
\end_inset

。刚度矩阵（方程 lhs）完全由体单元贡献，边界单元没有贡献，因为边界对应的3rd 
\begin_inset Formula $\gamma=0$
\end_inset

；rhs项为
\begin_inset Formula 
\[
\lambda\sum_{\{\alpha,e\}}\int_{\Gamma^{e}}{\color{brown}N_{\alpha}^{e}\,q}\dd{\Gamma}=\lambda\sum_{\{e\}}\int_{\Gamma^{e}}\left(\sum_{\alpha}N_{\alpha}^{e}\right){\color{brown}\,q}\dd{\Gamma}=\lambda\sum_{\{e\}}\int_{\Gamma^{e}}{\color{brown}q}\dd{\Gamma}=\lambda\,I_{\text{tot}}
\]

\end_inset

其中
\begin_inset Formula $\alpha$
\end_inset

 表示对节点指标求和，
\begin_inset Formula $e$
\end_inset

表示对边界单元求和，
\begin_inset Formula $I_{\text{tot}}$
\end_inset

表示总电流；并使用了
\begin_inset Formula 
\[
\sum_{\alpha}N_{\alpha}^{e}=1
\]

\end_inset

从单位制也可以看出，矩阵方程为
\begin_inset Formula 
\[
K\,\phi=b
\]

\end_inset

其中
\begin_inset Formula $K=\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{\alpha}^{e}\cdot\kappa(E^{0})\cdot\nabla N_{\beta}^{e}}\dd{\Omega}\right]\delta\phi_{\beta}$
\end_inset

，电导率
\begin_inset Formula $\sigma$
\end_inset

的单位是
\begin_inset Formula $[\mathrm{A\,V^{-1}\,m^{-1}}]$
\end_inset

，所以
\begin_inset Formula $K$
\end_inset

 的单位是 
\begin_inset Formula $[\mathrm{A\,V^{-1}}]$
\end_inset

，
\begin_inset Formula $\phi$
\end_inset

 的单位是
\begin_inset Formula $[\mathrm{V}]$
\end_inset

，因此
\begin_inset Formula $b$
\end_inset

 的单位是
\begin_inset Formula $[\mathrm{A}]$
\end_inset

。
\end_layout

\begin_layout Chapter
静磁场
\end_layout

\begin_layout Section
磁场的基本理论
\end_layout

\begin_layout Standard
根据 
\begin_inset Formula $\sbf B$
\end_inset

 和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系 
\begin_inset Formula $\sbf B(\sbf H)$
\end_inset

，可以分线性材料，永磁体 和 非线性材料 三种来计算静磁场。
\end_layout

\begin_layout Standard
下面先以最简单的线性材料为例，用有限元方法来计算静磁场，之后再讨论永磁铁和更复杂的非线性情况。首先磁场强度矢量 
\begin_inset Formula $\sbf H$
\end_inset

 满足方程
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\sbf J\label{eq:xl3.1}
\end{equation}

\end_inset

在线性介质中，磁感应强度 
\begin_inset Formula $\sbf B$
\end_inset

 和 磁场强度 
\begin_inset Formula $\sbf H$
\end_inset

 之间的关系为：
\begin_inset Formula 
\[
\sbf H=\frac{1}{\mu_{0}\mu_{r}}\sbf B
\]

\end_inset

相对磁导率 
\begin_inset Formula $\mu_{r}$
\end_inset

 是不随磁场变化的常数（但可以随空间坐标变化）。由于 
\begin_inset Formula $\nabla\cdot\sbf B=0$
\end_inset

，因此磁感应强度可以用矢势 
\begin_inset Formula $\sbf A$
\end_inset

 表示为
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A
\]

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以得到 
\begin_inset Formula $\sbf A$
\end_inset

 满足的方程
\begin_inset Formula 
\begin{equation}
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J\label{eq:xl3.2}
\end{equation}

\end_inset


\end_layout

\begin_layout Theorem
\begin_inset Argument 1
status open

\begin_layout Plain Layout
毕奥–萨伐尔定律
\end_layout

\end_inset

ref:郭硕鸿 p77/91，若取 
\begin_inset Formula $\sbf A$
\end_inset

满足规范条件 
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

，得矢势
\begin_inset Formula $\sbf A$
\end_inset

的微分方程：
\begin_inset Formula 
\begin{equation}
\nabla^{2}\sbf A=-\mu\sbf J\label{eq:g3.1.8}
\end{equation}

\end_inset

矢势方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的特解： 
\begin_inset Formula 
\begin{equation}
\sbf A(\sbf x)=\frac{\mu}{4\pi}\int_{V}\frac{\sbf J(\sbf x')\dd{V'}}{r}\label{eq:g3.1.9}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\sbf x'$
\end_inset

 是源点，
\begin_inset Formula $\sbf x$
\end_inset

 是长点，
\begin_inset Formula $r$
\end_inset

 为由 
\begin_inset Formula $\sbf x'$
\end_inset

 到 
\begin_inset Formula $\sbf x$
\end_inset

的距离。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

 满足 
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

。取旋度可求出
\begin_inset Formula $\sbf B$
\end_inset

：
\begin_inset Formula 
\begin{align*}
\sbf B & =\nabla\times\sbf A=\frac{\mu}{4\pi}\nabla\times\int_{V}\frac{\sbf J(\sbf x')\dd{V}}{r}\\
 & =\frac{\mu}{4\pi}\int_{V}(\nabla\frac{1}{r})\times\sbf J(\sbf x')\dd{V'}\\
 & =\frac{\mu}{4\pi}\int_{V}\frac{\sbf J\times\sbf r}{r^{3}}\dd{V'}
\end{align*}

\end_inset

过渡到线电流情形，设
\begin_inset Formula $I$
\end_inset

 为导线上电流的大小，作代换 
\begin_inset Formula $\sbf J\dd{V'}\to I\dd{\sbf l}$
\end_inset

得
\begin_inset Formula 
\begin{equation}
\sbf B=\frac{\mu}{4\pi}\oint_{L}\frac{I\dd{\sbf l}\times\sbf r}{r^{3}}\label{eq:g3.1.11}
\end{equation}

\end_inset

这就是 毕奥–萨伐尔 定律。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
柱坐标下的旋度：
\begin_inset Formula 
\[
\nabla\times\sbf A=\left(\frac{1}{r}\partial_{\phi}A_{z}-\partial_{z}A_{\phi}\right)\sbf e_{r}+\left(\partial_{z}A_{r}-\partial_{r}A_{z}\right)\sbf e_{\phi}+\left[\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)-\frac{1}{r}\partial_{\phi}A_{r}\right]\sbf e_{z}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Subsection
磁矢势的泛函
\end_layout

\begin_layout Standard
与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J$
\end_inset

 对应的泛函积分为
\begin_inset Formula 
\begin{equation}
\mathcal{F}(\sbf A)=\int_{\Omega}\dd{\Omega}\left[\frac{1}{\mu_{r}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\left(\nabla\times\sbf A\right)-\mu_{0}\,\sbf J\cdot\sbf A\right]\label{eq:xl3.3}
\end{equation}

\end_inset

计算 
\begin_inset Formula $\mathcal{F}(\sbf A)$
\end_inset

 的变分得：
\begin_inset Formula 
\[
\mathcal{F}(\sbf A)=\int_{\Omega}\dd{\Omega}\left[\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\cdot\left(\nabla\times\delta\sbf A\right)-\mu_{0}\,\sbf J\cdot\delta\sbf A\right]
\]

\end_inset

根据公式 
\begin_inset Formula $\nabla\cdot(\sbf a\times\sbf b)=\sbf b\cdot(\nabla\times\sbf a)-\sbf a\cdot(\nabla\times\sbf b)$
\end_inset

， 并使用高斯定理可以得到
\begin_inset Formula 
\begin{align*}
\delta\mathcal{F}(\sbf A) & =\int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\dd{\Omega}+\int_{\Gamma}\sbf e_{n}\cdot\left[\delta\sbf A\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\right]\dd{\Gamma}\\
 & =\int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\dd{\Omega}-\int_{\Gamma}\delta\sbf A\cdot\left[\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\right]\dd{\Gamma}
\end{align*}

\end_inset


\end_layout

\begin_layout Itemize
第一项可以给出矢势 
\begin_inset Formula $\sbf A$
\end_inset

 满足的方程，即
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Itemize
第二项给出矢势
\begin_inset Formula $\sbf A$
\end_inset

的自然边界条件：
\begin_inset Formula 
\[
\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=0
\]

\end_inset


\end_layout

\begin_layout Itemize
计算的区域 
\begin_inset Formula $\Omega$
\end_inset

 划分有限单元后，
\begin_inset Formula $\mathcal{F}(\sbf A)$
\end_inset

 可以表示为
\begin_inset Formula 
\[
\mathcal{F}(\sbf A)=\sum_{e}\mathcal{F}^{e}(\sbf A)
\]

\end_inset

其中
\begin_inset Formula 
\begin{equation}
\mathcal{F}^{e}(\sbf A^{e})=\frac{1}{2}\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf A^{e}\right)\cdot\left(\nabla\times\sbf A^{e}\right)\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf A^{e}\dd{\Omega}\label{eq:xl3.5}
\end{equation}

\end_inset

对于磁场，二维，轴对称和 三维问题 所采用的单元略有不同。
\end_layout

\begin_layout Subsection
二维情况
\end_layout

\begin_layout Standard
电流是垂直二维平面流过的，
\begin_inset Formula $\sbf A$
\end_inset

 也只有垂直二维平面的分量。即 
\begin_inset Formula $\sbf J=J_{z}\sbf e_{z}$
\end_inset

，有限元中的矢势可以用形函数和节点上定义的 
\begin_inset Formula $A_{z,\alpha}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(x,y)=\sum_{\alpha=1}^{n_{e}}N_{\alpha}^{e}(x,y)\,A_{z,\alpha}\sbf e_{z}.
\]

\end_inset


\end_layout

\begin_layout Subsection
轴对称情况
\end_layout

\begin_layout Standard
然后是磁感应强度 
\begin_inset Formula $\sbf B$
\end_inset

 轴对称情况，从毕奥–萨伐尔定律
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.11"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\sbf B=\frac{\mu}{4\pi}\oint_{L}\frac{I\dd{\sbf l}\times\sbf r}{r^{3}}
\]

\end_inset

取对称轴为柱坐标系下的 
\begin_inset Formula $\sbf e_{z}$
\end_inset

 坐标轴，如果电流
\begin_inset Formula $I\dd{l}$
\end_inset

只沿着
\begin_inset Formula $\sbf e_{\phi}$
\end_inset

方向，则
\begin_inset Formula $\sbf B$
\end_inset

将没有 
\begin_inset Formula $\sbf e_{\phi}$
\end_inset

方向的分量，并且其他方向分量也不依赖于 
\begin_inset Formula $\phi$
\end_inset

 坐标。因此令电流 
\begin_inset Formula $\sbf J=J_{\varphi}\sbf e_{\varphi}$
\end_inset

，对应地由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula $\sbf A=A_{\varphi}\sbf e_{\varphi}$
\end_inset

。有限元中的矢势可以用形函数 和节点上定义的 
\begin_inset Formula $A_{\varphi,i}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(\rho,z)=\sum_{\alpha=1}^{n_{e}}N_{\alpha}^{e}(\rho,z)\,A_{\varphi,\alpha}\sbf e_{\varphi}
\]

\end_inset


\end_layout

\begin_layout Subsection
三维磁场
\end_layout

\begin_layout Standard
对于三维磁场问题，采用的是棱边单元，相应的形函数是矢量。有限元中的矢势可以用形函数和棱边上定义的 
\begin_inset Formula $A_{\alpha}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(x,y,z)=\sum_{\alpha=1}^{n_{e}}\sbf N_{\alpha}^{e}(x,y,z)\,A_{\alpha}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
有限元矩阵
\end_layout

\begin_layout Standard
对于任一种情况，单元内的矢量势均可以统一表示为一种形式，即
\begin_inset Formula 
\begin{equation}
\sbf A^{e}=\sum_{\alpha=1}^{n_{e}}\sbf N_{\alpha}^{e}A_{\alpha}\label{eq:xl3.6}
\end{equation}

\end_inset

例如二维情况下，
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(x,y)\sbf e_{z}$
\end_inset

，
\begin_inset Formula $A_{\alpha}=A_{z,\alpha}$
\end_inset

；轴对称情况下 
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(\rho,z)\sbf e_{\varphi}$
\end_inset

，
\begin_inset Formula $A_{\alpha}=A_{\varphi,\alpha}$
\end_inset

。然后将 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

，代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\[
\mathcal{F}^{e}(\sbf A^{e})=\frac{1}{2}\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}A_{\alpha}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}A_{\beta}\right)\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}A_{\alpha}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Standard
计算 
\begin_inset Formula $\mathcal{F}^{e}(\sbf A^{e})$
\end_inset

 对 
\begin_inset Formula $A_{\alpha}$
\end_inset

 的导数，并根据 
\begin_inset Formula $\delta\mathcal{F}(\sbf A)=0$
\end_inset

，可以得到
\begin_inset Formula $A_{i}$
\end_inset

所满足的矩阵方程
\begin_inset Formula 
\begin{equation}
\sum_{e=1}^{M}[K_{\alpha\beta}^{e}]\{A_{\beta}\}=\sum_{e=1}^{M}\{b_{\alpha}^{e}\}\label{eq:xl3.7}
\end{equation}

\end_inset

其中
\begin_inset Formula 
\begin{align}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}\right)\dd{\Omega}\label{eq:xl3.8}\\
b_{\alpha}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}\dd{\Omega}\label{eq:xl3.9}
\end{align}

\end_inset


\end_layout

\begin_layout Section
二维静磁场
\end_layout

\begin_layout Standard
二维静磁问题中的电流是垂直二维平面流过的，
\begin_inset Formula $\sbf A$
\end_inset

只有垂直二维平面的分量
\begin_inset Formula 
\begin{align*}
\sbf N_{\alpha}^{e} & =N_{\alpha}^{e}\left(x,y\right)\sbf e_{z},\\
\sbf J & =J_{z}\sbf e_{z},\\
\sbf A & =A_{z,\alpha}\,N_{\alpha}^{e}(x,y)\,\sbf e_{z}.
\end{align*}

\end_inset

其中 
\begin_inset Formula $\alpha$
\end_inset

 标记单元节点局部编号。将其代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以得到
\begin_inset Formula 
\begin{align*}
\nabla\times N_{\alpha}^{e}\sbf e_{z} & =\left[\begin{array}{ccc}
\sbf e_{x} & \sbf e_{y} & \sbf e_{z}\\
\partial_{x} & \partial_{y} & \partial_{z}\\
0 & 0 & N_{\alpha}
\end{array}\right]\\
 & =\sbf e_{x}\,\partial_{y}N_{\alpha}-\sbf e_{y}\,\partial_{x}N_{\alpha}\\
\text{即}\;\mathrm{curl}N_{\alpha} & =\left[\begin{array}{c}
\partial_{y}N_{\alpha}\\
-\partial_{x}N_{\alpha}
\end{array}\right]
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
 & K_{\alpha\beta}^{e}=\frac{1}{\mu_{r}}\int_{\Omega^{e}}\left(\frac{\partial N_{\alpha}^{e}}{\partial x}\frac{\partial N_{\beta}^{e}}{\partial x}+\frac{\partial N_{\alpha}^{e}}{\partial y}\frac{\partial N_{\beta}^{e}}{\partial y}\right)\dd{\Omega}\\
 & b_{\alpha}^{e}=\mu_{0}\int_{\Omega^{e}}J_{z}N_{\alpha}^{e}\dd{\Omega}
\end{align*}

\end_inset

二维静磁场方程的形式和二维静电场方程的形式一样。
\end_layout

\begin_layout Section
轴对称静磁场
\end_layout

\begin_layout Standard
如果所研究的问题具有旋转对称性，可以沿着对称轴取一个截面在柱坐标下求解相应的电磁方程，即 
\begin_inset Formula $r,z$
\end_inset

 平面。轴对称情况下，矢势在柱坐标下只有
\begin_inset Formula $A_{\varphi}$
\end_inset

分量，相应的磁场可以用矢势表示为
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A=-\partial_{z}f_{\phi}\sbf e_{r}+\frac{1}{r}\partial_{r}\left(rf_{\phi}\right)\sbf e_{z}
\]

\end_inset

如上所述，磁感应
\begin_inset Formula $\sbf B$
\end_inset

分布在
\begin_inset Formula $r,z$
\end_inset

平面。
\end_layout

\begin_layout Remark
柱坐标下的旋度表示
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf A=\left(\frac{1}{r}\partial_{\phi}A_{z}-\partial_{z}A_{\phi}\right)\sbf e_{r}+\left(\partial_{z}A_{r}-\partial_{r}A_{z}\right)\sbf e_{\phi}+\left[\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)-\frac{1}{r}\partial_{\phi}A_{r}\right]\sbf e_{z}\label{eq:curl-cylin}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
另外需要注意的是，虽然在截面上划分的单元和二维情况下的划分完全一样。但实际上处理的有限元单元并不是一个平面单元，而是平面单元沿对称轴旋转 
\begin_inset Formula $360$
\end_inset

 度所形成的圆环，如图 3.1所示。
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
f
\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
轴对称单元对网格剖分的对应关系
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
在某个单元上的有限元泛函为（为了后续处理方便，
\begin_inset Formula $\mathcal{F}^{e}$
\end_inset

的表达式右边乘了系数
\begin_inset Formula $1/2\pi$
\end_inset

）
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\sbf A^{e}\right)=\frac{1}{2\pi}\int_{\Omega^{e}}\dd{\Omega}\left[\frac{1}{2}\frac{1}{\mu_{r}}\left(\nabla\times\sbf A^{e}\right)\cdot\left(\nabla\times\sbf A^{e}\right)-\mu_{0}\,\sbf J\cdot\sbf A^{e}\right]
\]

\end_inset

其中
\begin_inset Formula $\dd{\Omega}=r\dd{r}\dd{z}\dd{\varphi}$
\end_inset

，关于 
\begin_inset Formula $\varphi$
\end_inset

 的积分给出
\begin_inset Formula $2\pi$
\end_inset

因子，与前面的系数
\begin_inset Formula $1/2\pi$
\end_inset

 互相抵消。将 
\begin_inset Formula $\sbf A^{e}=N_{i}^{e}A_{i}\sbf e_{\varphi}$
\end_inset

，电流 
\begin_inset Formula $\sbf J=J_{\varphi}\sbf e_{\varphi}$
\end_inset

代入，
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\sbf A^{e}\right)=\sum_{i,j}^{n_{e}}\int_{\Omega^{e}}\dd{r}\dd{z}\left[\frac{1}{2}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}A_{\alpha}\right)\cdot\left(\nabla\times\sbf N_{\beta}^{e}A_{\beta}\right)-\mu_{0}\,\sbf J\cdot\sbf N_{\gamma}^{e}A_{\gamma}\right]
\]

\end_inset

轴对称情况下，形函数 
\begin_inset Formula $\sbf N_{i}^{e}=N_{i}^{e}(\rho,z)\sbf e_{\varphi}$
\end_inset

，计算可以得到
\begin_inset Formula 
\[
\nabla\times\sbf N_{i}^{e}=-\partial_{z}N_{i}^{e}\sbf e_{r}+\frac{1}{r}\partial_{r}(rN_{i}^{e})\sbf e_{z}
\]

\end_inset

相应的 
\begin_inset Formula $K_{ij}^{e}$
\end_inset

 矩阵和列向量 
\begin_inset Formula $b_{i}^{e}$
\end_inset

 可以分别表示为
\begin_inset Formula 
\begin{align*}
 & K_{\alpha\beta}^{e}=\int_{\Gamma^{e}}\frac{r}{\mu_{r}}\left[\partial_{z}N_{\alpha}^{e}\,\partial_{z}N_{\beta}^{e}+\left(\frac{N_{\alpha}^{e}}{r}+\partial_{r}N_{\alpha}^{e}\right)\left(\frac{N_{\beta}^{e}}{r}+\partial_{r}N_{\beta}^{e}\right)\right]\dd{r}\dd{z}\\
 & b_{\alpha}^{e}=\mu_{0}J_{\varphi}\int_{\Gamma^{e}}N_{\alpha}^{e}r\,\dd{r}\dd{z}.
\end{align*}

\end_inset

柱坐标下的旋度见
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:curl-cylin"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Section
三维磁场和树–余树规范
\end_layout

\begin_layout Standard
三维情况下的形函数有三个分量，可以取
\begin_inset Formula 
\begin{align*}
\sbf N_{\alpha}^{e} & =\left(L_{\alpha_{1}}^{e}\nabla L_{\alpha_{2}}^{e}-L_{\alpha_{2}}^{e}\nabla L_{\alpha_{1}}^{e}\right)\ell_{\alpha}^{e}\\
\nabla\times\sbf N_{\alpha}^{e} & =2\left(\nabla L_{\alpha_{1}}^{e}\times\nabla L_{\alpha_{2}}^{e}\right)\ell_{\alpha}^{e}
\end{align*}

\end_inset

因此
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\left(\nabla\times\sbf N_{\beta}^{e}\right)\dd{\Omega}\\
b_{\alpha}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
由于采用棱边单元定义的矩阵 
\begin_inset Formula $[K_{\alpha\beta}^{e}]$
\end_inset

 是奇异矩阵，即 
\begin_inset Formula $\det[K_{\alpha\beta}^{e}]=0$
\end_inset

。因此矩阵方程 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\sum_{e=1}^{M}[K_{\alpha\beta}^{e}]\{A_{\beta}\}=\sum_{e=1}^{M}\{b_{\alpha}^{e}\}$
\end_inset

 有无穷多解。采用棱边单元定义的矢势
\begin_inset Formula $\sbf A$
\end_inset

 在每个单元内部是满足库仑规范的 （
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

）。但是在单元的边界，库仑规范不满足，导致 矢势
\begin_inset Formula $\sbf A$
\end_inset

有无穷解。为了保证方程解的唯一性，即得到库仑规范下 
\begin_inset Formula $\sbf A$
\end_inset

的解，需要对 
\begin_inset Formula $\sbf A$
\end_inset

做一些拘束。取一个不闭合的任意矢量场
\begin_inset Formula $\sbf w$
\end_inset

，使得
\begin_inset Formula 
\[
\sbf A\cdot\sbf w=0,
\]

\end_inset

可以证明，在条件
\begin_inset Formula $\sbf A\cdot\sbf w=0$
\end_inset

的约束下，方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J$
\end_inset

的解是唯一的，证明如下。
\end_layout

\begin_layout Standard
如果
\begin_inset Formula $\sbf A$
\end_inset

和
\begin_inset Formula $\sbf A+\delta\sbf A$
\end_inset

都为方程的解，那么
\begin_inset Formula 
\[
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\delta\sbf A\right)=0
\]

\end_inset

进而可以得到
\begin_inset Formula 
\[
\int_{\Omega}(\nabla\times\delta\sbf A)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}=0
\]

\end_inset

 由于1/
\begin_inset Formula $\mu_{r}$
\end_inset

是正定的，上面的方程可以给出
\begin_inset Formula $\nabla\times\delta\sbf A=0$
\end_inset

，可以设
\begin_inset Formula $\delta\sbf A=\nabla\chi$
\end_inset

。如果固定空间中的一点
\begin_inset Formula $P$
\end_inset

，然后取空间任一点作为
\begin_inset Formula $Q$
\end_inset

，那么总是可以找到连接
\begin_inset Formula $P$
\end_inset

和
\begin_inset Formula $Q$
\end_inset

的一条积分路线，使得
\begin_inset Formula 
\[
\chi(Q)=\chi(P)+\int_{P}^{Q}\nabla\chi\cdot\dd{\sbf\ell}
\]

\end_inset

因为
\begin_inset Formula $\delta\sbf A=\nabla\chi$
\end_inset

，并且 
\begin_inset Formula $\sbf A\cdot\sbf w=0$
\end_inset

 ，所以 
\begin_inset Formula $\nabla\chi\cdot\sbf w=0$
\end_inset

。取
\begin_inset Formula $\dd{\sbf\ell}$
\end_inset

平行
\begin_inset Formula $\sbf w$
\end_inset

，则
\begin_inset Formula $\chi(Q)=\chi(P)$
\end_inset

。因此取适当的
\begin_inset Formula $\sbf w$
\end_inset

 可以保证 
\begin_inset Formula $\delta\sbf A=\nabla\chi=0$
\end_inset

，即
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示矩阵方程的唯一性。
\end_layout

\begin_layout Standard
图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的二维模型中，树–余树规范（Tree–Cotree gauge）对矢势
\begin_inset Formula $\sbf A$
\end_inset

的约束情况。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/xl-f3.2.png
	scale 90

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
二维有限元 树–余树 示意图。绿色边单元上的矢势取
\begin_inset Formula $0$
\end_inset

。
\begin_inset CommandInset label
LatexCommand label
name "fig:xl3.2"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
永磁材料
\begin_inset CommandInset label
LatexCommand label
name "sec:yongci"

\end_inset


\end_layout

\begin_layout Standard
在永磁材料中存在不为零的磁化强度，
\begin_inset Formula $\sbf B$
\end_inset

 和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系可以写为
\begin_inset Formula 
\[
\sbf H=\frac{1}{\mu_{0}}\sbf B-\sbf M
\]

\end_inset

硬体磁体中的 
\begin_inset Formula $\sbf M$
\end_inset

 几乎不随外磁场变化，可以当作常矢量（vary on 
\begin_inset Formula $\sbf H$
\end_inset

）处理。如果考虑更一般的情况，可以认为磁化强度 
\begin_inset Formula $\sbf M$
\end_inset

随磁场线性变化，即
\begin_inset Formula 
\[
\sbf M=\sbf M_{0}+\chi\sbf H.
\]

\end_inset

其中，
\begin_inset Formula $\sbf M_{0}$
\end_inset

 是没有外场情况下，永磁材料中的磁化强度，是常矢量。这样可以得到
\begin_inset Formula 
\begin{align*}
\sbf H & =\frac{1}{\mu_{0}\mu_{r}}\sbf B-\frac{1}{\mu_{r}}\sbf M_{0}\\
\mu_{r} & =1+\chi
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
计算的区域
\begin_inset Formula $\Omega$
\end_inset

存在永磁区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

，可以得到静磁场方程：
\begin_inset Formula 
\begin{equation}
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J+\frac{\mu_{0}}{\mu_{r}}{\color{red}\nabla\times\sbf M_{0}}\label{eq:xl3.10}
\end{equation}

\end_inset

以及相应的泛函积分
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\sbf A\right)=\int_{\Omega}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\left(\sbf J+\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}\right)\cdot\sbf A\dd{\Omega}\label{eq:xl3.11}
\end{equation}

\end_inset

同样，
\begin_inset Formula $\mathcal{F}\left(\sbf A\right)$
\end_inset

可以表示为各个有限元单元中 
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的和
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\sbf A\right)=\sum_{e}\mathcal{F}^{e}\left(\sbf A\right)\label{eq:xl3.12}
\end{equation}

\end_inset

如果单元积分区域属于线性材料区，
\begin_inset Formula $\Omega_{e}\in\Omega_{0}$
\end_inset

，
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的表达式和之前相同；如果单元积分区域实在永磁铁区，即 
\begin_inset Formula $\Omega_{e}\in\Omega_{m}$
\end_inset

，则
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\label{eq:xl3.13}\\
 & -{\color{blue}\int_{\Omega_{e}}\frac{\mu_{0}}{\mu_{r}}\left(\nabla\times\sbf M_{0}\right)\cdot\sbf A\dd{\Omega}}{\color{red}-\frac{\mu_{0}}{\mu_{r}}\int_{\Gamma_{e}}\left(\sbf M_{0}\times\sbf e_{n}\right)\cdot\sbf A\dd{\Gamma}}\label{eq:xl3.14}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
在 
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的表达式中，
\begin_inset Formula $\Gamma_{e}$
\end_inset

 是单元的表面，最后一项是在单元表面的积分，
\begin_inset Formula $\sbf e_{n}$
\end_inset

是垂直表面的单位矢量。
\end_layout

\begin_layout Enumerate
表面积分出现的原因是将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

改写为
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.12"
plural "false"
caps "false"
noprefix "false"

\end_inset

之后必然出现的。式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

中 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 对积分的贡献，完全来自 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 在空间中的变化，即 
\begin_inset Formula $\nabla\times\sbf M_{0}$
\end_inset

。将积分的区域 
\begin_inset Formula $\Omega$
\end_inset

 划分有限元网格之后，在计算
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 时，如果不考虑各个单元的表面积分，那么相邻单元边界处的 
\begin_inset Formula $\nabla\times\sbf M_{0}$
\end_inset

 会被忽视，见下文注
\begin_inset CommandInset ref
LatexCommand eqref
reference "rem2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 是一个常矢量（on 空间坐标），那么相邻单元在公共边处的 
\begin_inset Formula $\hat{\sbf e}_{n}$
\end_inset

 符号刚好相反，可以互相抵消，最后只留下永磁体区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

 边界处 
\begin_inset Formula $\Gamma_{m}$
\end_inset

 的表面积分，这一项就是
\series bold
面电流密度
\series default
。
\end_layout

\begin_layout Standard
使用等式 
\begin_inset Formula $\left(\nabla\times\sbf M_{0}\right)\cdot\sbf A=\nabla\cdot\left(\sbf M_{0}\times\sbf A\right)+\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)$
\end_inset

，并用高斯定律可以得到
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\\
 & -{\color{brown}\frac{\mu_{0}}{\mu_{r}}\int_{\Gamma^{e}}\hat{\sbf e}_{n}\cdot\left(\sbf M_{0}\times\sbf A\right)\dd{\Gamma}}-\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)\dd{\Omega}\\
 & -{\color{brown}\frac{\mu_{0}}{\mu_{r}}\int_{\Gamma^{e}}\left(\sbf M_{0}\times\hat{\sbf e}_{n}\right)\cdot\sbf A\dd{\Gamma}}
\end{align*}

\end_inset

可以看到表面积分的部分相互抵消，最后只留下体积分，即
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\label{eq:xl3.15}\\
 & -{\color{blue}\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)\dd{\Omega}}\label{eq:xl3.16}
\end{align}

\end_inset

因此在永磁材料中，力向量会多出一项永磁体的贡献
\begin_inset Formula 
\[
b_{i}^{e}=\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}+{\color{blue}\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Remark
\begin_inset CommandInset label
LatexCommand label
name "rem2"

\end_inset

考虑一个沿着
\begin_inset Formula $z$
\end_inset

方向均匀极化的永磁体球 
\begin_inset Formula $\sbf M=M_{0}\sbf e_{z}$
\end_inset

，代入球坐标系下的旋度公式；
\begin_inset Formula 
\[
\nabla\times\sbf f=\frac{1}{r\sin\theta}\left[\partial_{\theta}(\sin\theta f_{\phi})-\partial_{\phi}f_{\theta}\right]\sbf e_{r}+\frac{1}{r}\left[\frac{1}{\sin\theta}\partial_{\phi}f_{r}-\partial_{r}(rf_{\phi})\right]\sbf e_{\theta}+\frac{1}{r}\left[\partial_{r}(rf_{\theta})-\partial_{\theta}f_{r}\right]\sbf e_{\phi}
\]

\end_inset

并考虑到
\begin_inset Formula $\sbf e_{z}=\cos\theta\sbf e_{r}-\sin\theta\sbf e_{\theta}$
\end_inset

，可得在永磁体内部的连续区域
\begin_inset Formula 
\begin{align*}
\nabla\times\sbf M & =M_{0}\frac{1}{r}\left[\partial_{r}(-r\sin\theta)-\partial_{\theta}\cos\theta\right]\sbf e_{\phi}\\
 & =\frac{M_{0}}{r}\left[-\sin\theta+\sin\theta\right]\sbf e_{\phi}=0
\end{align*}

\end_inset

此外在永磁体的边界上 
\begin_inset Formula $\sbf M\times\sbf e_{n}=\sin\theta\sbf e_{\phi}$
\end_inset

，此即表面电流的物理图像：
\series bold
均匀磁化的永磁体的磁场，可以看作是磁体表面环形电流产生的磁场的叠加
\series default
。
\end_layout

\begin_layout Enumerate
因此，在均匀磁化的永磁体内部，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.10"
plural "false"
caps "false"
noprefix "false"

\end_inset

微分方程中的中
\begin_inset Formula ${\color{red}\nabla\times\sbf M_{0}}$
\end_inset

项等于零，无法体现永磁体的贡献；在数学上，常数项
\begin_inset Formula $\sbf M_{0}$
\end_inset

对
\begin_inset Formula $\sbf B$
\end_inset

的微分没有影响。
\end_layout

\begin_layout Enumerate
而
\begin_inset Formula $\sbf M_{0}$
\end_inset

作为预先给定值，不是泛函的自由度，对于均匀磁化的永磁体
\begin_inset Formula ${\color{blue}\int_{\Omega_{e}}\frac{\mu_{0}}{\mu_{r}}\left(\nabla\times\sbf M_{0}\right)\cdot\sbf A\dd{\Omega}}=0$
\end_inset

，那么泛函仿佛回到不含永磁体的情况，这显然是不对的。
\end_layout

\begin_layout Enumerate
解决的办法是在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.14"
plural "false"
caps "false"
noprefix "false"

\end_inset

中包含
\begin_inset Formula ${\color{red}-\int_{\Gamma_{e}}\left(\sbf M_{0}\times\sbf e_{n}\right)\cdot\sbf A\dd{\Gamma}}$
\end_inset

项，以包含永磁体表面等效电流的贡献；在数学上，此项出现在矢势
\begin_inset Formula $\sbf A$
\end_inset

的方程中，也只有在积分场（原函数）的边界上，常数项
\begin_inset Formula $\sbf M_{0}$
\end_inset

的意义才会体现。此外，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.14"
plural "false"
caps "false"
noprefix "false"

\end_inset

中表面电流项的负号是因为它是激励，即有限元中的
\begin_inset Formula $\{b_{i}\}$
\end_inset

项，类似于
\begin_inset Formula $\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}$
\end_inset

前面也有负号。后面通过分部积分，表面项互相抵消，但这不是无意义的，因为通过新的项
\begin_inset Formula ${\color{blue}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)\dd{\Omega}}$
\end_inset

，表面电流的影响已经均匀的分摊到永磁体内部的每一区域上了，可以不用再考虑表面电流，所以最后的泛函
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.16"
plural "false"
caps "false"
noprefix "false"

\end_inset

中不再含有表面项。
\end_layout

\begin_layout Section
非线性材料
\end_layout

\begin_layout Standard
非线性材料中 
\begin_inset Formula $\sbf B$
\end_inset

和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系比较复杂，一般无法写出关于 
\begin_inset Formula $\sbf A$
\end_inset

 的显式方程，但可以通过逐步迭代逼近的方法将 
\begin_inset Formula $\sbf A$
\end_inset

 求解出来。介质中的静磁场方程最一般的表达式为：
\begin_inset Formula 
\begin{align*}
 & \sbf B=\sbf B\left(\sbf H\right)\\
 & \nabla\times\sbf H=\sbf J
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
如果可以先确定出 
\begin_inset Formula $\sbf B$
\end_inset

，那么根据 BH 曲线就可以确定出 
\begin_inset Formula $\sbf H$
\end_inset

，得到的 
\begin_inset Formula $\sbf H$
\end_inset

 应该满足方程 
\begin_inset Formula $\nabla\times\sbf H=\sbf J$
\end_inset

。可以首先取 
\begin_inset Formula $\sbf B^{0}$
\end_inset

 作为方程的试探解，根据 BH 曲线可以得到 
\begin_inset Formula $\sbf H^{0}=\sbf H(\sbf B^{0})$
\end_inset

。
\end_layout

\begin_layout Enumerate
若 
\begin_inset Formula $\sbf H^{0}$
\end_inset

满足方程 
\begin_inset Formula $\nabla\times\sbf H^{0}=\sbf J$
\end_inset

，那么取 
\begin_inset Formula $\sbf B^{0}$
\end_inset

和 
\begin_inset Formula $\sbf H^{0}$
\end_inset

 就应该是所求的解。
\end_layout

\begin_layout Enumerate
若 
\begin_inset Formula $\sbf H^{0}$
\end_inset

不满足方程 
\begin_inset Formula $\nabla\times\sbf H^{0}=\sbf J$
\end_inset

，说明目前的 
\begin_inset Formula $\sbf B^{0}$
\end_inset

 值不正确，需要对 
\begin_inset Formula $\sbf B^{0}$
\end_inset

做修正。修正后 
\begin_inset Formula $\sbf B=\sbf B^{0}+\delta\sbf B$
\end_inset

。相应的 
\begin_inset Formula $\sbf H=\sbf H^{0}+\delta\sbf H$
\end_inset

，其中
\begin_inset Formula 
\[
\delta\sbf H=\frac{\partial H}{\partial B}\delta B
\]

\end_inset


\end_layout

\begin_layout Standard
如果是各向异性的情况，式中的 
\begin_inset Formula $\partial H/\partial B$
\end_inset

 就是张量。修正后 
\begin_inset Formula $\sbf H$
\end_inset

 应该满足方程
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\nabla\times\left(\sbf H^{0}+\frac{\partial H}{\partial B}\delta\sbf B\right)=\sbf J\label{eq:xl3.17}
\end{equation}

\end_inset

方程中只有 
\begin_inset Formula $\delta B$
\end_inset

 是未知量。由于 
\begin_inset Formula $\sbf B=\nabla\times\sbf A$
\end_inset

，因此 
\begin_inset Formula $\delta\sbf B=\nabla\times\delta\sbf A$
\end_inset

，代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.17"
plural "false"
caps "false"
noprefix "false"

\end_inset

得到
\begin_inset Formula 
\[
\nabla\times\left(\sbf H^{0}+\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J
\]

\end_inset


\end_layout

\begin_layout Standard
施加相应的边界条件，就可以解出 
\begin_inset Formula $\delta\sbf A$
\end_inset

，进而得到 
\begin_inset Formula $\delta\sbf B$
\end_inset

和 
\begin_inset Formula $\delta\sbf H$
\end_inset

，最后得到修正的
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

。如果修正后的 
\begin_inset Formula $\sbf H$
\end_inset

 仍然不满足方程 
\begin_inset Formula $\nabla\times\sbf H=\sbf J$
\end_inset

，那么就把修正后的
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

作为初始值，重复上面的步骤，直到 
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

趋近方程的真实解。每一步迭代所求解的方程为：
\begin_inset Formula 
\begin{equation}
\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J-\nabla\times\sbf H^{0}\label{eq:xl3.18}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
首先采用泛函积分的 Ritz 法来构造有限元计算流程。根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以写出关于 
\begin_inset Formula $\delta\sbf A$
\end_inset

 的泛函
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\delta\sbf A\right)=\mu_{0}\int_{\Omega}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\left(\sbf J-\nabla\times\sbf H^{0}\right)\cdot\delta\sbf A\dd{\Omega}\label{eq:xl3.19}
\end{equation}

\end_inset

然后有
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\delta\sbf A\right)=\sum_{e}\mathcal{F}^{e}\left(\delta\sbf A\right),\label{eq:xl3.19b}
\end{equation}

\end_inset

在单个有限元单元中
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\delta\sbf A\right)= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.20}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\delta\sbf A\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\left(\nabla\times\sbf H^{0}\right)\cdot\delta\sbf A\dd{\Omega}\label{eq:xl3.21}\\
 & +\mu_{0}\int_{\Gamma^{e}}\left(\sbf H^{0}\times\hat{\sbf e}_{n}\right)\cdot\delta\sbf A\dd{\Gamma}\label{eq:xl3.22}
\end{align}

\end_inset

式中最后一项是单元表面的积分。这一项出现的原因和永磁体一样，都是因为将原来的积分区域
\begin_inset Formula $\Omega$
\end_inset

 划分成网格后，利用式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.19b"
plural "false"
caps "false"
noprefix "false"

\end_inset

计算 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)$
\end_inset

 造成的。经过类似的处理，去掉边界项给出
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\delta\sbf A\right)= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.23}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\delta\sbf A\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.24}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\delta\sbf A=\sbf N_{j}^{e}\delta A_{j}$
\end_inset

，代入 
\begin_inset Formula $\mathcal{F}^{e}\left(\delta\sbf A\right)$
\end_inset

 中，可以得到
\begin_inset Formula 
\begin{align*}
\frac{\partial\mathcal{F}}{\partial\delta\sbf A_{i}}= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\delta A_{j}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

由于 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)$
\end_inset

 满足极值条件 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)=0$
\end_inset

，最后可以得到矩阵方程
\begin_inset Formula 
\[
\left\{ \frac{\partial\mathcal{F}}{\partial\delta\sbf A_{i}}\right\} =\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ \delta A_{j}\right\} -\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} =\left\{ 0\right\} 
\]

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{ij}^{e} & =\mu_{0}\int_{\Omega^{e}}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\\
b_{i}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
对于线性材料，
\begin_inset Formula $\sbf H=\sbf B/(\mu_{0}\mu_{r})$
\end_inset

，
\begin_inset Formula $\partial H/\partial B=1/(\mu_{0}\mu_{r})$
\end_inset

；对于永磁体，
\begin_inset Formula $\sbf H=\frac{1}{\mu_{0}\mu_{r}}\sbf B-\frac{1}{\mu_{r}}\sbf M_{0}$
\end_inset

，
\begin_inset Formula $\partial H/\partial B=1/(\mu_{0}\mu_{r})$
\end_inset

。将积分的区域
\begin_inset Formula $\Omega$
\end_inset

根据材料类型分为线性材料区域 
\begin_inset Formula $\Omega_{0}$
\end_inset

，永磁体材料区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

 和非线性材料区域 
\begin_inset Formula $\Omega_{n}$
\end_inset

。则
\begin_inset Formula 
\[
K_{ij}^{e}=\begin{cases}
\frac{1}{\mu_{r}}\int_{\Omega^{e}}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega} & \Omega^{e}\in\Omega_{0}+\Omega_{m}\\
\mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega} & \Omega^{e}\in\Omega_{n}
\end{cases}
\]

\end_inset


\end_layout

\begin_layout Example
Ritz 方法
\end_layout

\begin_layout Standard
根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J-\nabla\times\sbf H^{0}
\]

\end_inset

采用 Galerkin 法也可以得到和 Ritz 法相同的结果。首先以 
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

 为加权函数计算相应的余数
\begin_inset Formula 
\begin{align*}
R_{i}^{e}= & \mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\left[\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)-\sbf J+\nabla\times\sbf H^{0}\right]\dd{\Omega}\\
 & +\mu_{0}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\left(\sbf H^{0}\times\hat{\sbf e}_{n}\right)\dd{\Gamma}
\end{align*}

\end_inset

边界积分来源于单元的“表面电流” 
\begin_inset Formula $\sbf H^{0}\times\hat{\sbf e}_{n}$
\end_inset

，经过分部积分可得：
\begin_inset Formula 
\begin{align*}
R_{i}^{e}= & \mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\delta\sbf A\right)\dd{\Omega}+\mu_{0}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\left[\hat{\sbf e}_{n}\times\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\right]\dd{\Gamma}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\sbf J\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

式中的边界积分中，相邻单元的贡献在边界上互相抵消，最后只留下 
\begin_inset Formula $\Omega$
\end_inset

 边界上的积分，
\begin_inset Formula $\Omega$
\end_inset

 边界上的约束条件可以抵消掉该边界积分的贡献，因此表面积分可以去掉。最后将 
\begin_inset Formula $\delta\sbf A=\sbf N_{j}^{e}\delta A_{j}$
\end_inset

代入上式，可以得到矩阵形式下 
\begin_inset Formula $R_{i}^{e}$
\end_inset

 的表达式：
\begin_inset Formula 
\[
R_{i}^{e}=K_{ij}^{e}\delta A_{j}-b_{i}^{e}
\]

\end_inset

并且
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left\{ R_{i}^{e}\right\} =\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ \delta\sbf A_{j}\right\} -\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} =\left\{ 0\right\} 
\]

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{ij}^{e} & =\mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\\
b_{i}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\sbf J\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

和Ritz法得到的结果完全相同。
\end_layout

\begin_layout Section
计算电感
\end_layout

\begin_layout Section
磁场的开域问题
\end_layout

\begin_layout Standard
由于很少有材料可以屏蔽磁场，所以磁场的问题几乎都是开域问题。和静电场类似，磁场的开域问题也可以采用截断法或者精度更高的渐近边界条件来处理。首先矢势可以表示为
\begin_inset Formula 
\[
\sbf A\left(\sbf r\right)=\frac{\mu_{0}}{4\pi}\int\dd[3]{r'}\frac{\sbf J\left(\sbf r'\right)+\nabla'\times\sbf M\left(\sbf r'\right)}{\abs{\sbf r-\sbf r'}}
\]

\end_inset

同样在远离源的地方
\begin_inset Formula 
\[
\frac{1}{\abs{\sbf r-\sbf r'}}=\frac{1}{\abs{\sbf r}}+\frac{\sbf r\cdot\sbf r'}{\abs{\sbf r}^{3}}+\cdots
\]

\end_inset

这样可以得到最低阶的近似表达式：
\begin_inset Formula 
\begin{equation}
\sbf A=\frac{\sbf a}{r^{n}}\label{eq:xl3.25}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\sbf a$
\end_inset

 是与
\begin_inset Formula $r$
\end_inset

无关的矢量。采用截断法处理边界处的矢势，即取 
\begin_inset Formula $\sbf A=0$
\end_inset

 或 
\begin_inset Formula $\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=0$
\end_inset

，计算精度分别为 
\begin_inset Formula $\mathcal{O}\left(r^{-n}\right)$
\end_inset

和 
\begin_inset Formula $\mathcal{O}\left(r^{-n-1}\right)$
\end_inset

。根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.25"
plural "false"
caps "false"
noprefix "false"

\end_inset

得到
\begin_inset Formula $\sbf A$
\end_inset

满足的渐近边界条件：
\begin_inset Formula 
\[
\nabla\times\sbf A=\frac{-n}{r^{2}}\sbf r\times\sbf A
\]

\end_inset


\end_layout

\begin_layout Section
线性材料的开域问题
\end_layout

\begin_layout Standard
对于线性材料，在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的关于
\begin_inset Formula $\sbf A$
\end_inset

 的泛函积分中添加表面项的贡献，即
\begin_inset Formula 
\begin{align}
\mathcal{F}(\sbf A) & =\frac{1}{2}\int_{\Omega}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\sbf J\cdot\sbf A\dd{\Omega}\nonumber \\
 & +\int_{\Gamma}\frac{n}{2r^{3}}\left(\sbf r\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)\dd{\Gamma}\label{eq:xl3.25b}
\end{align}

\end_inset

对上式做变分可以得到：
\begin_inset Formula 
\begin{align*}
\delta\mathcal{F}(\sbf A)= & \int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\\
 & -\int_{\Gamma}\left[\hat{\sbf e}_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)+\frac{n}{r^{3}}\sbf r\times\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)\right]\cdot\delta\sbf A\dd{\Gamma}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Plain Layout
推导过程使用了
\begin_inset Formula 
\begin{align*}
 & \nabla\cdot\left[\sbf f\times\sbf g\right]=\left(\nabla\times f\right)\cdot g-f\cdot\left(\nabla\times g\right)\\
 & \left(\nabla\times\delta\sbf A\right)\cdot\left(\nabla\times\sbf A\right)=\nabla\cdot\left[\delta\sbf A\times\left(\nabla\times\sbf A\right)\right]+\delta\sbf A\cdot\left(\nabla\times\nabla\times\sbf A\right)
\end{align*}

\end_inset

以及混合积在轮换下不变：
\begin_inset Formula 
\[
\sbf a\cdot\left(\sbf b\times\sbf c\right)=\sbf c\cdot\left(\sbf a\times\sbf b\right)
\]

\end_inset

还有高斯散度定理。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
可以看到上式第二项给出
\begin_inset Formula 
\[
\hat{\sbf e}_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\frac{-n}{r^{3}}\sbf r\times\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)
\]

\end_inset

在圆形边界，上式即为关于
\begin_inset Formula $\sbf A$
\end_inset

 的渐近边界条件，表面积分对矩阵方程的贡献为：
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left(\left[K_{ij}^{e}\right]+\left[K_{ij}^{s}\right]\right)\left\{ \sbf A_{j}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} 
\]

\end_inset

其中（这个式子的形式实际上参考自
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.25b"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\[
K_{ij}^{s}=\frac{n}{r^{3}}\int_{\Gamma}\left(\sbf r\times\sbf N_{i}^{e}\right)\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf N_{j}^{e}\right)\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Subsection
二维情况
\end_layout

\begin_layout Standard
二维情况和电场的形式完全一样，二维形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

在边界上退化为一维形函数
\begin_inset Formula $N_{i}^{s}$
\end_inset

，即
\begin_inset Formula 
\[
K_{ij}^{s}=\frac{n}{r}\int_{\Gamma}\frac{N_{i}^{s}N_{j}^{s}}{\mu_{r}}\dd{\Gamma}
\]

\end_inset

这里的形式可以参考电场的结果：
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:el-open"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Subsection
轴对称
\end_layout

\begin_layout Standard
轴对称情况下，矢势在柱坐标下只有 
\begin_inset Formula $A_{\varphi}$
\end_inset

 分量，进而得到边单元对 
\begin_inset Formula $K$
\end_inset

 矩阵的贡献（这里和前面保持一致，前面乘上系数 
\begin_inset Formula $1/2\pi$
\end_inset

）
\begin_inset Formula 
\begin{equation}
K_{ij}^{s}=\frac{1}{2\pi}\frac{n}{r}\int_{\Gamma}\frac{N_{i}^{e}N_{j}^{e}}{\mu_{r}}\dd{\Gamma}\label{eq:xl3.26}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
上面的积分涉及边界上单元面积的积分，边界元形状如图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(a)所示，其中的剖面见图 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/xl-3.3.png
	scale 60

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
边界单元(a)及剖面(b)。
\begin_inset CommandInset label
LatexCommand label
name "fig:xl3.3"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
图中的 
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 和 
\begin_inset Formula $(\rho_{2},z_{2})$
\end_inset

 是边单元剖面的两个端点。左图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(a)所示的边单元上下底面的周长分别是 
\begin_inset Formula $2\pi\rho_{1}$
\end_inset

，
\begin_inset Formula $2\pi\rho_{2}$
\end_inset

，边单元面积可以表示为 
\begin_inset Formula $(2\pi\rho_{1}+2\pi\rho_{2})L_{s}/2$
\end_inset

，其中 
\begin_inset Formula $L_{s}$
\end_inset

 为端点
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 和 
\begin_inset Formula $(\rho_{2},z_{2})$
\end_inset

 之间的长度。将点 
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 到 
\begin_inset Formula $(\rho,z_{2})$
\end_inset

 之间的长度记为 
\begin_inset Formula $\ell_{s}$
\end_inset

，那么
\begin_inset Formula $\rho$
\end_inset

可以用
\begin_inset Formula $\ell_{s}$
\end_inset

表示为
\begin_inset Formula 
\[
\rho=\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}
\]

\end_inset

因此
\begin_inset Formula 
\begin{align*}
\dd{\Gamma} & =\frac{1}{2}\left[2\pi\rho+2\pi\left(\rho+\dd{\rho}\right)\right]\dd{\ell_{s}}\\
 & =2\pi\rho\dd{\ell_{s}}+\order{\varepsilon^{2}}\\
 & =2\pi\left(\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}\right)\dd{\ell_{s}}
\end{align*}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.26"
plural "false"
caps "false"
noprefix "false"

\end_inset

的积分可以表示为
\begin_inset Formula 
\[
K_{ij}^{s}=\frac{1}{2\pi}\int_{0}^{L_{s}}\frac{1}{r}\frac{N_{i}^{e}N_{j}^{e}}{\mu_{r}}2\pi\left(\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}\right)\dd{\ell_{s}}
\]

\end_inset


\end_layout

\begin_layout Standard
由于
\begin_inset Formula $r$
\end_inset

在面单元内变换不大，可以提到积分外面，二维形函数 
\begin_inset Formula $N_{i}^{e}$
\end_inset

 在边界上退化为一维形函数
\begin_inset Formula $N_{i}^{s}$
\end_inset

。然后取 
\begin_inset Formula $\eta=\ell_{s}/L_{s}$
\end_inset

，可以得到
\begin_inset Formula 
\[
K_{ij}^{s}=\frac{1}{r}\frac{1}{\mu_{r}}L_{s}\int_{0}^{1}N_{i}^{e}N_{j}^{e}\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\eta\right]\dd{\eta}
\]

\end_inset

一维形函数等参的取值范围是从 
\begin_inset Formula $-1$
\end_inset

 到 
\begin_inset Formula $1$
\end_inset

，下面再做变量代换
\begin_inset Formula 
\[
\eta=\frac{\xi+1}{2}
\]

\end_inset

可以得到
\begin_inset Formula 
\begin{align*}
K_{ij}^{s} & =\frac{n}{r}\frac{1}{\mu_{r}}\frac{L_{s}}{2}\int_{-1}^{+1}N_{i}^{s}N_{j}^{s}\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\frac{\xi+1}{2}\right]\dd{\eta}\\
 & =\frac{n}{r}\frac{1}{\mu_{r}}\frac{L_{s}}{2}\sum_{\alpha}N_{i}^{s}\left(\xi_{\alpha}\right)N_{j}^{s}\left(\xi_{\alpha}\right)\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\frac{\xi_{\alpha}+1}{2}\right]W\left(\xi_{\alpha}\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
三维情况
\end_layout

\begin_layout Standard
三维情况下的静磁问题采用的是棱边形函数，
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

是一个三维矢量，因此
\begin_inset Formula 
\begin{align*}
K_{ij}^{s} & =\frac{n}{r^{3}}\int_{\Gamma}{\color{blue}\left(\sbf r\times\sbf N_{i}^{e}\right)}\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf N_{j}^{e}\right)\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}{\color{blue}\varepsilon_{abc}\,\sbf r_{b}\,(\sbf N_{i}^{e})_{c}}\;\varepsilon_{afg}\,\sbf r_{f}\,(\sbf N_{j}^{e})_{g}\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\left(\delta_{bf}\delta_{cg}-\delta_{bg}\delta_{cf}\right)r_{b}\,r_{d}\;(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{g}\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\left[r_{b}r_{b}{\color{brown}(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{c}}-r_{b}r_{c}\;(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{b}\right]\dd{\Gamma}
\end{align*}

\end_inset

代入形函数表达式 
\begin_inset Formula $\sbf N_{i}^{e}=(L_{i_{1}}^{e}\nabla L_{i_{2}}^{e}-L_{i_{2}}^{e}\nabla L_{i_{1}}^{e})\ell_{i}^{e}$
\end_inset

得到：
\begin_inset Formula 
\begin{align*}
K_{ij}^{s}=\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\dd{\Gamma} & \Bigg[r_{b}r_{b}{\color{brown}\left(L_{i_{1}}^{e}\partial_{c}L_{i_{2}}^{e}-L_{i_{2}}^{e}\partial_{c}L_{i_{1}}^{e}\right)\ell_{i}^{e}\,\left(L_{j_{1}}^{e}\partial_{c}L_{j_{2}}^{e}-L_{j_{2}}^{e}\partial_{c}L_{j_{1}}^{e}\right)\ell_{j}^{e}}\\
 & -r_{b}r_{c}\left(L_{i_{1}}^{e}\partial_{c}L_{i_{2}}^{e}-L_{i_{2}}^{e}\partial_{c}L_{i_{1}}^{e}\right)\ell_{i}^{e}\,\left(L_{j_{1}}^{e}\partial_{b}L_{j_{2}}^{e}-L_{j_{2}}^{e}\partial_{b}L_{j_{1}}^{e}\right)\ell_{j}^{e}\Bigg]
\end{align*}

\end_inset

根据公式
\begin_inset Formula 
\[
\int_{\Gamma}L_{i}^{e}L_{j}^{e}\dd{\Gamma}=\frac{\Delta_{e}}{12}\Lambda_{i,j},\quad\Lambda_{i,j}=\begin{cases}
2 & i=j\\
1 & i\neq j
\end{cases}
\]

\end_inset

最后得到
\begin_inset Formula 
\begin{align*}
K_{ij}^{s}=\frac{n\ell_{i}^{e}\ell_{j}^{e}}{r^{3}\mu_{r}}\frac{\Delta_{e}}{12} & \Bigg[\Lambda_{i_{1},j_{1}}(\sbf r\times\nabla L_{i_{2}}^{e})\cdot(\sbf r\times\nabla L_{j_{2}}^{e})\\
 & -\Lambda_{i_{2},j_{1}}(\sbf r\times\nabla L_{i_{1}}^{e})\cdot(\sbf r\times\nabla L_{j_{2}}^{e})\\
 & -\Lambda_{i_{1},j_{2}}(\sbf r\times\nabla L_{i_{2}}^{e})\cdot(\sbf r\times\nabla L_{j_{1}}^{e})\\
 & +\Lambda_{i_{2},j_{2}}(\sbf r\times\nabla L_{i_{1}}^{e})\cdot(\sbf r\times\nabla L_{j_{1}}^{e})\Bigg]
\end{align*}

\end_inset


\end_layout

\begin_layout Section
非线性材料的开域问题
\end_layout

\begin_layout Standard
在前面已经得到非线性静磁问题的迭代求解的方程，设在第
\begin_inset Formula $k$
\end_inset

步迭代，失势
\begin_inset Formula $A$
\end_inset

的增量为
\begin_inset Formula $\Delta A_{j}^{k}$
\end_inset

，其满足方程
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}\Delta A_{j}^{k}}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} ,
\]

\end_inset

上述方程也可以写成
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ A_{j}^{k}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} +\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}A_{j}^{k-1}}\right\} .
\]

\end_inset


\end_layout

\begin_layout Standard
其中
\begin_inset Formula $A_{j}^{k}$
\end_inset

和
\begin_inset Formula $A_{j}^{k-1}$
\end_inset

分别为第
\begin_inset Formula $k$
\end_inset

步和第
\begin_inset Formula $k-1$
\end_inset

步得到的失势，
\begin_inset Formula $\Delta A_{j}^{k}=A_{j}^{k}-A_{j}^{k-1}$
\end_inset

。在计算第
\begin_inset Formula $k$
\end_inset

步的失势时，第
\begin_inset Formula $k-1$
\end_inset

 的失势
\begin_inset Formula $\left\{ A_{j}^{k-1}\right\} $
\end_inset

是已知的。在关于失势的矩阵方程中加上相应表面单元的贡献
\begin_inset Formula $\left[K_{ij}^{s}\right]$
\end_inset

，就可以在模型边界用渐近边界条件来模拟开域问题，因此非线性开域问题的矩阵方程可以写为：
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left([K_{ij}^{e}]+[K_{ij}^{s}]\right)\left\{ A_{j}^{k}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} +\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}A_{j}^{k-1}}\right\} ,
\]

\end_inset

或者
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left([K_{ij}^{e}]+[K_{ij}^{s}]\right)\left\{ {\color{blue}\Delta A_{j}^{k}}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} -\sum_{e=1}^{M}\left[K_{ij}^{s}\right]\left\{ A_{j}^{k-1}\right\} .
\]

\end_inset


\end_layout

\begin_layout Chapter
时谐磁场和暂态磁场
\end_layout

\begin_layout Section
低频磁场方程
\end_layout

\begin_layout Standard
随时间变化的电流产生的磁场也会随时间变化，根据法拉第定理，变化的磁场会产生电场。如果存在自由的电荷，电场会驱动电荷运动产生电流，进而影响到系统的总电流。磁场和电
场可以用标势和标势表示为
\begin_inset Formula 
\begin{align}
 & \sbf B=\nabla\times\sbf A\label{eq:xl4.1}\\
 & \sbf E=-\nabla\phi-\frac{\partial\sbf A}{\partial t}\label{eq:xl4.2}
\end{align}

\end_inset

 总电流
\begin_inset Formula $\sbf J_{\text{tot}}$
\end_inset

分为两部分，一个是外加电流
\begin_inset Formula $\sbf J(t)$
\end_inset

，另外一部分是电场诱导出的电流，即
\begin_inset Formula 
\[
\sbf J_{\text{tot}}=\sbf J_{\text{ex}}(t)+\sigma\sbf E
\]

\end_inset


\end_layout

\begin_layout Standard
电场和磁场满足麦克斯韦方程
\begin_inset Formula 
\[
\nabla\times\sbf H-\frac{\partial\sbf D}{\partial t}=\sbf J_{\text{ex}}(t)+\sigma\sbf E
\]

\end_inset

在低频情况下，
\color blue
可以忽略电位移矢量对时间的导数
\color inherit
，因此
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\sbf J_{\text{ex}}(t)+\sigma\sbf E\label{eq:xl4.3}
\end{equation}

\end_inset

 另外，电流要满足守恒方程
\begin_inset Formula $\nabla\cdot\sbf J_{\text{tot}}=0$
\end_inset

（忽略电荷累积
\begin_inset Formula $\partial\rho/\partial t$
\end_inset

），而外加电流总是满足守恒方程的，因此
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sigma\left(-\nabla\Phi-\frac{\partial\sbf A}{\partial t}\right)=0.\label{eq:xl4.4}
\end{equation}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

即为低频情况下，时谐磁场和瞬态磁场所满足的方程。
\end_layout

\begin_layout Remark
忽略电位移矢量（数量级估计）。
\begin_inset Formula 
\[
\nabla\times\sbf H={\color{blue}\epsilon_{0}\epsilon_{r}\frac{\partial}{\partial t}\sbf E}+{\color{brown}\sigma\sbf E}+\sbf J_{\text{ex}}(t)
\]

\end_inset

假设频率为
\begin_inset Formula $50\mathrm{Hz}$
\end_inset

，对于一般的良导体，例如铝，列出以下数据
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\epsilon_{r}\approx8.85*10^{-12}\mathrm{F/m}\\
 & \frac{\partial}{\partial t}\approx50\mathrm{Hz}\\
 & \sigma\approx3.5\times10^{7}\mathrm{S/m}
\end{align*}

\end_inset

所以 
\begin_inset Formula ${\color{blue}\epsilon_{0}\epsilon_{r}\frac{\partial}{\partial t}\sbf E}\approx10^{-10}$
\end_inset

，而 
\begin_inset Formula ${\color{brown}\sigma\sbf E}>10^{7}$
\end_inset

，两者相差
\begin_inset Formula $17$
\end_inset

个数量级以上，所以总是可以安全地忽略第一项。而第三项
\begin_inset Formula $\sbf J_{\text{ex}}(t)$
\end_inset

作为外加电流，其数量级不好一概而论，总是保留在式子中。顺带一提，
\series bold
良导体条件
\series default
为
\begin_inset Formula 
\[
\omega\ll\tau^{-1}=\sigma/\varepsilon\quad\text{或者}\quad\frac{\sigma}{\varepsilon\omega}\gg1.
\]

\end_inset

对于一般金属导体，
\begin_inset Formula $\tau$
\end_inset

的数量极为
\begin_inset Formula $10^{-17}\mathrm{s}$
\end_inset

。只要电磁波的频率不太高，一般金属导体都可以看做良导体。良导体内部没有净的自由电荷积聚，电荷只能分布于导体表面上。
\end_layout

\begin_layout Section
时谐磁场
\end_layout

\begin_layout Standard
对于时谐磁场，可以做傅立叶展开，将外加电流写成
\begin_inset Formula $\sbf J(t)=\sbf J_{0}\cos(\omega t+\varphi)$
\end_inset

，在求解式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

时，可以将电流和待求的电磁场表示为复数的形式（选定适当的初相位
\begin_inset Formula $\varphi$
\end_inset

），
\begin_inset Formula 
\begin{align*}
\sbf J_{\text{ex}}(t) & =\sbf J_{0\text{ex}}e^{-i(\omega t+\varphi)}\\
\sbf A & =\sbf A_{\omega}e^{-i\omega t}\\
\sbf\Phi & =\sbf\Phi_{\omega}e^{-i\omega t}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
考虑先行材料，取电流
\begin_inset Formula $\sbf J(t)$
\end_inset

，标势
\begin_inset Formula $\Phi$
\end_inset

和矢势
\begin_inset Formula $\sbf A$
\end_inset

的复数形式，将
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf E$
\end_inset

的表达式，即式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\begin{align*}
\nabla\cdot\sigma\left(-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}\right) & =0,\\
\nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A_{\omega}\right) & =\sbf J_{0\text{ex}}e^{-i\varphi}+\sigma\left(-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}\right)
\end{align*}

\end_inset

整理之后可得
\begin_inset Formula 
\begin{align*}
{\color{blue}\frac{i}{\omega}\nabla\cdot(\sigma\nabla\Phi_{\omega})}+{\color{brown}\nabla\cdot(\sigma\sbf A_{\omega})} & =0\\
{\color{blue}\nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A_{\omega}\right)-i\omega\sigma\sbf A_{\omega}}+{\color{brown}\sigma\nabla\Phi_{\omega}} & =\sbf J_{0}e^{-i\varphi}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
可以写出上述方程组对应的泛函积分
\begin_inset Formula 
\begin{align*}
\mathcal{F}(\sbf A_{\omega},\Phi_{\omega})=\int_{\Omega}\dd{\Omega}\Big\{ & \frac{1}{2}\left[{\color{blue}(\nabla\times\sbf A_{\omega})\cdot\frac{1}{\mu_{0}\mu_{r}}(\nabla\times\sbf A_{\omega})-i\omega\sigma\,\sbf A_{\omega}\cdot\sbf A_{\omega}}\right]\\
 & +{\color{blue}\frac{i}{\omega}\frac{1}{2}(\nabla\Phi_{\omega})\cdot\sigma(\nabla\Phi_{\omega})}-\sbf J_{0}e^{-i\varphi}\cdot\sbf A_{\omega}\\
 & +{\color{brown}\nabla\cdot(\Phi_{\omega}\sigma\sbf A_{\omega})}\Big\}
\end{align*}

\end_inset

其中使用了
\begin_inset Formula ${\color{brown}\nabla\cdot(\Phi_{\omega}\sigma\sbf A_{\omega})}=\nabla\Phi_{\omega}\cdot\sigma\sbf A_{\omega}+\Phi_{\omega}\nabla\cdot\sigma\sbf A_{\omega}$
\end_inset

。方程中的矢势和标势可以分别用形函数表示为
\begin_inset Formula 
\begin{align*}
\sbf A_{\omega} & =\sbf N_{i}^{e}A_{i}\\
\Phi_{\omega} & =L_{m}^{e}\Phi_{m}
\end{align*}

\end_inset

其中指标
\begin_inset Formula $i$
\end_inset

，
\begin_inset Formula $j$
\end_inset

表示矢势的自由度；
\begin_inset Formula $m$
\end_inset

，
\begin_inset Formula $n$
\end_inset

标势标势的自由度。因此每个单元中的泛函写成
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}(A_{i},\Phi_{\omega})=\int_{\Omega^{e}}\dd{\Omega} & \Big\{\frac{1}{2}\left[{\color{blue}\left(\nabla\times\sbf N_{i}^{e}A_{i}\right)\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf N_{j}^{e}A_{j}\right)-i\omega\sigma\sbf N_{i}^{e}A_{i}\cdot\sbf N_{j}^{e}A_{j}}\right]\\
 & +{\color{brown}\frac{i}{\omega}\frac{1}{2}(\nabla L_{m}^{e}\Phi_{m})\cdot\sigma(\nabla L_{n}^{e}\Phi_{n})}-\sbf J_{0}e^{-i\varphi}\cdot\sbf N_{i}^{e}A_{i}\\
 & +{\color{red}\nabla\cdot(L_{m}^{e}\Phi_{m}\,\sigma\sbf N_{i}^{e}A_{i}})\Big\}
\end{align*}

\end_inset

分别对
\begin_inset Formula $A_{i}$
\end_inset

和
\begin_inset Formula $\Phi_{m}$
\end_inset

求导可以得到
\begin_inset Formula 
\begin{align*}
\frac{\partial\mathcal{F}^{e}}{\partial A_{i}} & ={\color{blue}K_{ij}^{e}A_{j}}-b_{i}^{e}+{\color{red}C_{im}\Phi_{m}}\\
\frac{\partial\mathcal{F}^{e}}{\partial\Phi_{m}} & ={\color{brown}D_{mn}^{e}\phi_{n}}-b_{i}^{e}+{\color{red}C_{mi}A_{i}}
\end{align*}

\end_inset

 其中
\begin_inset Formula 
\begin{align*}
{\color{blue}K_{ij}^{e}} & =\int_{\Omega^{e}}\left[\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf N_{j}^{e}\right)-i\omega\sigma\sbf N_{i}^{e}\cdot\sbf N_{j}^{e}\right]\dd{\Omega}\\
b_{i}^{e} & =\int_{\Omega^{e}}\sbf J_{0\text{ex}}e^{-i\varphi}\cdot\sbf N_{i}^{e}\dd{\Omega}\\
{\color{red}C_{im}^{e}=C_{mi}^{e}} & =\int_{\Omega^{e}}\nabla\cdot(L_{m}^{e}\sigma\sbf N_{i}^{e})\dd{\Omega}\\
{\color{brown}D_{mn}^{e}} & =\int_{\Omega^{e}}\frac{i}{\omega}(\nabla L_{n}^{e})\cdot\sigma(\nabla L_{m}^{e})\dd{\Omega}
\end{align*}

\end_inset

最后得到矩阵方程
\begin_inset Formula 
\begin{equation}
\left[\begin{array}{cc}
[{\color{brown}D_{mn}^{e}}] & [{\color{red}C_{mj}^{e}}]\\{}
[{\color{red}C_{in}^{e}}] & [{\color{blue}K_{ij}^{e}}]
\end{array}\right]\left\{ \begin{array}{c}
\left\{ \Phi_{n}\right\} \\
\left\{ A_{j}\right\} 
\end{array}\right\} =\left\{ \begin{array}{c}
0\\
\left\{ b_{i}^{e}\right\} 
\end{array}\right\} .\label{eq:harmonic}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
暂态磁场
\end_layout

\begin_layout Standard
如果将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

直接代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\begin{align*}
\nabla\cdot\sigma\left(\nabla\Phi+\frac{\partial\sbf A}{\partial t}\right) & =0\\
\nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right) & =\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}+\sbf J_{\text{ex}}+\sigma\left(-\nabla\Phi-\frac{\partial\sbf A}{\partial t}\right)
\end{align*}

\end_inset

其中
\begin_inset Formula $\sbf M_{0}$
\end_inset

为零外加磁场下，永磁材料中的磁化强度。
\end_layout

\begin_layout Remark
这里使用了电磁场方程和永磁体的本构关系，即 
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A,\quad\sbf E=-\nabla\phi-\frac{\partial\sbf A}{\partial t}
\]

\end_inset

以及
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf H=\sbf J_{\text{ex}}+\sigma\sbf E\\
 & \sbf B=\mu_{0}\mu_{r}\sbf H+\mu_{0}\sbf M_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\Phi=\frac{\partial W}{\partial t}$
\end_inset

 可以得到
\begin_inset Formula 
\begin{align}
 & \nabla\cdot\sigma\frac{\partial}{\partial t}\left(\nabla W+\sbf A\right)=0,\quad\sbf E=-\partial_{t}\left(\nabla W+\sbf A\right)\label{eq:my18}\\
 & \nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right)=\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}+\sbf J_{\text{ex}}-\sigma\frac{\partial}{\partial t}\left(\nabla W+\sbf A\right)\label{eq:my19}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
以
\begin_inset Formula $\sbf N_{i}$
\end_inset

作为权函数，计算
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my19"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的加权残差得
\begin_inset Formula 
\begin{align}
R^{e}(\sbf N_{i}^{e}) & =\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\left[\nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right){\color{red}-\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}}-\sbf J_{\text{ex}}+\sigma\frac{\partial}{\partial t}\left(\nabla W+\sbf A\right)\right]\dd{\Omega}\nonumber \\
 & \quad+{\color{red}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\frac{1}{\mu_{r}}\left(\sbf e_{n}\times\sbf M_{0}\right)\dd{\Gamma}}\nonumber \\
 & \stackrel{\text{IBP}}{=}\int_{\Omega^{e}}\Big[{\color{blue}(\nabla\times\sbf N_{i}^{e})\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right)}-\sbf N_{i}^{e}\cdot\sbf J_{\text{ex}}\label{eq:my20}\\
 & \quad-\frac{1}{\mu_{r}}\sbf M_{0}\cdot(\nabla\times\sbf N_{i}^{e})+{\color{brown}\sbf N_{i}^{e}\cdot\sigma\frac{\partial}{\partial t}\nabla W}+{\color{magenta}\sbf N_{i}^{e}\cdot\sigma\frac{\partial}{\partial t}\sbf A}\Big]\dd{\Omega}\nonumber 
\end{align}

\end_inset


\end_layout

\begin_layout Remark
在推导
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my20"
plural "false"
caps "false"
noprefix "false"

\end_inset

时使用了公式
\begin_inset Formula 
\begin{align*}
\nabla\cdot\left(\sbf M_{0}\times\sbf N_{i}^{e}\right) & ={\color{red}\left(\nabla\times\sbf M_{0}\right)\cdot\sbf N_{i}^{e}}-\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\sbf M_{0}\\
\text{and}\;\int_{\Omega^{e}}\dd{\Omega}\nabla\cdot\left(\sbf M_{0}\times\sbf N_{i}^{e}\right) & =\int_{\Gamma^{e}}\sbf e_{n}\cdot\left(\sbf M_{0}\times\sbf N_{i}^{e}\right)\dd{\Gamma}={\color{red}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\left(\sbf e_{n}\times\sbf M_{0}\right)\dd{\Gamma}}
\end{align*}

\end_inset

并添加了
\begin_inset Formula ${\color{red}\int_{\Gamma^{e}}\cdots\dd{\Gamma}}$
\end_inset

用来抵消边界上的面积分项，参见
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:yongci"
plural "false"
caps "false"
noprefix "false"

\end_inset

那里的说明。
\end_layout

\begin_layout Standard
类似地，以
\begin_inset Formula $L_{m}^{e}$
\end_inset

作为权函数，计算
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my18"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的加权残差得
\begin_inset Formula 
\begin{align}
R^{e}(L_{m}^{e}) & =-\int_{\Omega^{e}}\left[L_{m}^{e}\nabla\cdot\sigma\,\partial_{t}(\nabla W+\sbf A)\right]\dd{\Omega}+\int_{\Gamma^{e}}\left[L_{m}^{e}\sbf e_{n}\cdot\sigma\,\partial_{t}(\nabla W+\sbf A)\right]\dd{\Gamma}\label{eq:my21}\\
 & \stackrel{\text{IBP}}{=}\int_{\Omega^{e}}\Big[{\color{red}\nabla L_{m}^{e}\cdot\sigma\,\partial_{t}\nabla W}+{\color{brown}\nabla L_{m}^{e}\cdot\sigma\,\partial_{t}\sbf A}\Big]\dd{\Omega}\nonumber 
\end{align}

\end_inset

在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my21"
plural "false"
caps "false"
noprefix "false"

\end_inset

中我们手动添加了 
\begin_inset Formula $\int_{\Gamma^{e}}\sbf e_{n}\cdot\cdots\dd{\Gamma}$
\end_inset

 ，它抵消掉了边界项。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my21"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的两项用
\begin_inset Formula $\rho$
\end_inset

，
\begin_inset Formula $\sbf J=\sigma\sbf E$
\end_inset

 表示
\begin_inset Formula 
\[
R^{e}(L_{m}^{e})=\int_{\Omega^{e}}L_{m}^{e}\frac{\partial\rho}{\partial t}\dd{\Omega}+\int_{\Gamma^{e}}L_{m}^{e}\left(-\sbf e_{n}\cdot\sbf J\right)\dd{\Gamma}
\]

\end_inset

第一项是求解域内部电荷堆积速率；第二项是经由求解域表面灌入电荷的速率，对于匀强
\begin_inset Formula $\sbf J$
\end_inset

，第二项为零。
\end_layout

\begin_layout Subsection
总结
\end_layout

\begin_layout Standard
作展开 
\begin_inset Formula $\sbf A=\sbf N_{i}^{e}A_{i}$
\end_inset

，
\begin_inset Formula $W=L_{m}^{e}W_{m}$
\end_inset

，其中
\begin_inset Formula $A_{i}$
\end_inset

 表示 Edge 
\begin_inset Formula $i$
\end_inset

 上的自由度；
\begin_inset Formula $W_{m}$
\end_inset

表示节点
\begin_inset Formula $m$
\end_inset

上的自由度。代入上述方程可得
\begin_inset Formula 
\begin{align*}
R^{e}(\sbf N_{i}^{e}) & ={\color{blue}K_{ij}^{e}}\,A_{j}-b_{i}^{e}+{\color{brown}C_{im}^{e}}\frac{\partial W_{m}}{\partial t}+{\color{magenta}M_{ij}^{e}}\frac{\partial A_{j}}{\partial t}\\
R^{e}(L_{m}^{e}) & ={\color{red}D_{mn}^{e}}\frac{\partial W_{n}}{\partial t}+{\color{brown}C_{mj}^{e}}\frac{\partial A_{j}}{\partial t}
\end{align*}

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{ij}^{e} & =\int_{\Omega^{e}}\left[{\color{blue}(\nabla\times\sbf N_{i}^{e})\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf N_{j}^{e}\right)}\right]\dd{\Omega}\\
b_{i}^{e} & =\int_{\Omega^{e}}\left[\sbf N_{i}^{e}\cdot\sbf J_{\text{ex}}+\frac{1}{\mu_{r}}\sbf M_{0}\cdot(\nabla\times\sbf N_{i}^{e})\right]\dd{\Omega}\\
C_{im}^{e}=C_{mi}^{e} & =\int_{\Omega^{e}}{\color{brown}\sigma\nabla L_{m}^{e}\cdot\sbf N_{i}^{e}}\dd{\Omega}\\
M_{ij}^{e} & =\int_{\Omega^{e}}{\color{magenta}\sigma\sbf N_{i}^{e}\cdot\sbf N_{j}^{e}}\dd{\Omega}\\
D_{mn}^{e} & =\int_{\Omega^{e}}{\color{red}\sigma\left(\nabla L_{m}^{e}\cdot\nabla L_{n}^{e}\right)}\dd{\Omega}
\end{align*}

\end_inset

最后可以得到两个矩阵方程
\begin_inset Formula 
\begin{align*}
 & \{R^{e}(\sbf N_{i}^{e})\}=[{\color{blue}K_{ij}^{e}}]\{A_{j}\}-\{b_{i}^{e}\}+[{\color{brown}C_{im}^{e}}]\frac{\partial\{W_{m}\}}{\partial t}+[{\color{magenta}M_{ij}^{e}}]\frac{\partial\{A_{j}\}}{\partial t}=\{0\}\\
 & \{R^{e}(L_{m}^{e})\}=[{\color{red}D_{mn}^{e}}]\frac{\partial\{W_{n}\}}{\partial t}+[{\color{brown}C_{mj}^{e}}]\frac{\partial\{A_{j}\}}{\partial t}=\{0\}
\end{align*}

\end_inset

整理之后可得
\begin_inset Formula 
\[
\left[\begin{array}{cc}
[0] & [0]\\{}
[0] & [{\color{blue}K_{ij}^{e}}]
\end{array}\right]\left\{ \begin{array}{c}
\{W_{n}\}\\
\{A_{j}\}
\end{array}\right\} +\left[\begin{array}{cc}
[{\color{red}D_{mn}^{e}}] & [{\color{brown}C_{mj}^{e}}]\\{}
[{\color{brown}C_{in}^{e}}] & [{\color{magenta}M_{ij}^{e}}]
\end{array}\right]\frac{\partial}{\partial t}\left\{ \begin{array}{c}
\{W_{n}\}\\
\{A_{j}\}
\end{array}\right\} =\left\{ \begin{array}{c}
\{0\}\\
\{b_{i}^{e}\}
\end{array}\right\} 
\]

\end_inset

将时间微分离散化
\begin_inset Formula 
\[
\left[\begin{array}{cc}
0 & 0\\
0 & {\color{blue}K_{ij}^{e}}
\end{array}\right]\left\{ \begin{array}{c}
W_{n}^{t+\Delta t}\\
A_{j}^{t+\Delta t}
\end{array}\right\} +\left[\begin{array}{cc}
{\color{red}D_{mn}^{e}} & {\color{brown}C_{mj}^{e}}\\
{\color{brown}C_{in}^{e}} & {\color{magenta}M_{ij}^{e}}
\end{array}\right]\frac{1}{\Delta t}\left\{ \begin{array}{c}
W_{n}^{t+\Delta t}-W_{n}^{t}\\
A_{j}^{t+\Delta t}-A_{j}^{t}
\end{array}\right\} =\left\{ \begin{array}{c}
0\\
b_{i}^{e}
\end{array}\right\} 
\]

\end_inset

最后得到
\begin_inset Formula 
\begin{align}
\Bigg(\left[\begin{array}{cc}
0 & 0\\
0 & {\color{blue}K_{ij}^{e}}
\end{array}\right]+\frac{1}{\Delta t}\left[\begin{array}{cc}
{\color{red}D_{mn}^{e}} & {\color{brown}C_{mj}^{e}}\\
{\color{brown}C_{in}^{e}} & {\color{magenta}M_{ij}^{e}}
\end{array}\right]\Bigg) & \left\{ \begin{array}{c}
W_{n}^{t+\Delta t}\\
A_{j}^{t+\Delta t}
\end{array}\right\} \label{eq:my22}\\
 & \qquad=\left\{ \begin{array}{c}
0\\
b_{i}^{e}
\end{array}\right\} +\frac{1}{\Delta t}\left[\begin{array}{cc}
{\color{red}D_{mn}^{e}} & {\color{brown}C_{mj}^{e}}\\
{\color{brown}C_{in}^{e}} & {\color{magenta}M_{ij}^{e}}
\end{array}\right]\left\{ \begin{array}{c}
W_{n}^{t}\\
A_{j}^{t}
\end{array}\right\} \nonumber 
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my22"
plural "false"
caps "false"
noprefix "false"

\end_inset

左边是
\begin_inset Formula $t+\Delta t$
\end_inset

时刻的场，右边是
\begin_inset Formula $t$
\end_inset

时刻的场；以
\begin_inset Formula $\{W_{n}^{t+\Delta t},A_{j}^{t+\Delta t}\}$
\end_inset

作为待求矢量，方程又化作 
\begin_inset Formula $AX=b$
\end_inset

 的形式。
\end_layout

\begin_layout Section
磁场A的mapping，不同网格之间
\end_layout

\begin_layout Chapter
有限元下计算电磁力
\end_layout

\begin_layout Section
Levi–Civita 符号
\end_layout

\begin_layout Standard
ref：
\begin_inset CommandInset href
LatexCommand href
name "Levi-Civita符号"
target "https://www.zhihu.com/question/445700749"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $\varepsilon^{123}=1$
\end_inset

，上标相同则为零，交换两个指标出负号。有等式：
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{def}=\left[\begin{array}{ccc}
\delta^{ad} & \delta^{ae} & \delta^{af}\\
\delta^{bd} & \delta^{be} & \delta^{bf}\\
\delta^{cd} & \delta^{ce} & \delta^{cf}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Enumerate
特殊情况一：单个指标求和，
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{aef}=\left[\begin{array}{ccc}
1 & 0 & 0\\
0 & \delta^{be} & \delta^{bf}\\
0 & \delta^{ce} & \delta^{cf}
\end{array}\right]=\left[\begin{array}{cc}
\delta^{be} & \delta^{bf}\\
\delta^{ce} & \delta^{cf}
\end{array}\right]=\delta^{be}\delta^{cf}-\delta^{bf}\delta^{ce}
\]

\end_inset


\end_layout

\begin_layout Enumerate
特殊情况二：双指标求和，
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{dbc}=\left[\begin{array}{ccc}
\delta^{ad} & 0 & 0\\
0 & 1 & 0\\
0 & 0 & 1
\end{array}\right]=\delta^{ad}
\]

\end_inset


\end_layout

\begin_layout Section
虚功法计算磁力
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:virtualforce"

\end_inset


\end_layout

\begin_layout Standard
假设导线中的电流从 
\begin_inset Formula $0$
\end_inset

 开始，在时间
\begin_inset Formula $t$
\end_inset

的时候达到 
\begin_inset Formula $I$
\end_inset

。那么在这个过程中，导线中存储的此能为：
\begin_inset Formula 
\begin{equation}
\mathcal{U}=-\int_{0}^{t}\mathcal{E}I\dd{t'}=-\int_{0}^{t}\frac{\dd{\Psi}}{\dd{t'}}I\dd{t'}=\int_{0}^{\Psi}I\dd{\Psi}.\label{eq:x6.1}
\end{equation}

\end_inset


\begin_inset Formula $\mathcal{E}$
\end_inset

螺旋与磁通成右手螺旋。
\end_layout

\begin_layout Standard
此外通过场源关系，磁能也可以表示成：
\begin_inset Formula 
\[
\mathcal{U}=\int_{\Omega}\left[\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right]\dd{\Omega}
\]

\end_inset

是用与线性和非线性情况，不包括永磁体材料。
\end_layout

\begin_layout Standard
根据磁能还可以定义 磁共能（coenergy）：
\begin_inset Formula 
\[
\mathcal{U}_{\text{co}}=I\Psi-\mathcal{U}=\int_{0}^{I}\Psi\dd{I'}
\]

\end_inset

在坐标平面上，具有明显的几何意义；
\begin_inset Formula $\mathcal{U}$
\end_inset

 和 
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

 分别对应 
\begin_inset Formula $I$
\end_inset

–
\begin_inset Formula $\Psi$
\end_inset

 曲线两侧的面积。
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

 同样可以用场表示成
\begin_inset Formula 
\[
\mathcal{U}_{\text{co}}=\int_{\Omega}\sbf H\cdot\sbf B\dd{\Omega}-\mathcal{U}=\int_{\Omega}\left(\int_{0}^{H}\sbf B\cdot\dd{\sbf H'}\right)\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Standard
根据使用 磁能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 还是 磁共能 
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

的计算思路，还有取 
\begin_inset Formula $\Psi$
\end_inset

 或 
\begin_inset Formula $I$
\end_inset

 作为 
\begin_inset Formula $x$
\end_inset

 之外的独立变量，可以得到磁力的四种表达式：
\begin_inset Formula 
\begin{align*}
F & =-\frac{\partial\mathcal{U}\left(\Psi,x\right)}{\partial x}\\
 & =-\frac{\partial\mathcal{U}\left(I,x\right)}{\partial x}+I\frac{\partial\Psi\left(I,x\right)}{\partial x}\\
 & =\frac{\partial\mathcal{U}_{\text{co}}\left(\Psi,x\right)}{\partial x}-\Psi\frac{\partial I\left(\Psi,x\right)}{\partial x}\\
 & =\frac{\partial\mathcal{U}_{\text{co}}\left(I,x\right)}{\partial x}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
磁能的磁场表示形式：
\begin_inset Formula 
\begin{align}
\mathcal{U} & =\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\dd{\Omega},\nonumber \\
\mathcal{U}_{\text{co}} & =\sum_{e}\int_{\Omega^{e}}\left[\sbf H\cdot\sbf B-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right]\dd{\Omega}.\label{eq:fem-uco}
\end{align}

\end_inset


\end_layout

\begin_layout Section
计算磁力
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:calc-magforce"

\end_inset


\end_layout

\begin_layout Standard
本节中的计算 与 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:virtualforce"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的理论不尽相同；在这里把 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 当成唯一的独立变量，计算电能的变分。
\end_layout

\begin_layout Standard
在有限元框架下，通过场的形式，将磁能表示成：
\begin_inset Formula 
\begin{align}
\mathcal{U} & =\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\dd{\Omega},\label{eq:fem-energy}
\end{align}

\end_inset

节点 
\begin_inset Formula $\alpha$
\end_inset

 上的磁力，表示成 磁能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 对节点 
\begin_inset Formula $\alpha$
\end_inset

 的坐标的偏导数：
\begin_inset Formula 
\[
\sbf F_{\alpha}=-\frac{\partial\mathcal{U}}{\partial\sbf r_{\alpha}}
\]

\end_inset

考虑到积分测度 
\begin_inset Formula $\dd{\Omega}=\dd{x}\dd{y}\dd{z}=\det[J]\dd{\xi}\dd{\eta}\dd{\zeta}$
\end_inset

，记 
\begin_inset Formula $\dd{\hat{\Omega}}=\dd{\xi}\dd{\eta}\dd{\zeta}$
\end_inset

，则根据磁共能式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:fem-uco"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\frac{\partial\det[J]}{\partial\sbf r_{\alpha}}-\left(\sbf H\cdot\frac{\partial\sbf B}{\partial\sbf r_{\alpha}}\right)\det[J]\right]\dd{\hat{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Remark
这里的变分理解为：
\end_layout

\begin_layout Enumerate
一方面节点坐标的改变，会影响到积分测度；
\end_layout

\begin_layout Enumerate
另一方面，会影响到空间场 
\begin_inset Formula $\sbf B$
\end_inset

 的分布；这里还是用了积分下求导的公式：
\begin_inset Formula 
\[
\frac{\dd}{\dd{x}}\int_{0}^{f\left(x\right)}g\left(x'\right)\dd{x'}=f'(x)g\left[f(x)\right]
\]

\end_inset

在这里就是
\begin_inset Formula 
\[
\frac{\partial}{\partial\sbf r_{\alpha}}\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\quad\Rightarrow\quad\sbf H(\sbf B)\cdot\frac{\partial\sbf B}{\partial\sbf r_{\alpha}}
\]

\end_inset


\end_layout

\begin_layout Subsection
二维电磁力计算
\end_layout

\begin_layout Standard
二维磁场 
\begin_inset Formula $\sbf B$
\end_inset

 的矢势 
\begin_inset Formula $\sbf A$
\end_inset

 只有
\begin_inset Formula $z$
\end_inset

 分量，
\begin_inset Formula $\sbf B$
\end_inset

 可以表示为：
\begin_inset Formula 
\begin{equation}
\sbf B=\frac{\partial A_{z}}{\partial y}\sbf e_{x}-\frac{\partial A_{z}}{\partial x}\sbf e_{y}=A_{i}\frac{\partial N_{i}^{e}}{\partial y}\sbf e_{x}-A_{i}\frac{\partial N_{i}^{e}}{\partial x}\sbf e_{y}=A_{i}\left(\nabla N_{i}^{e}\times\sbf e_{z}\right).\label{eq:xl6.10}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
也可以写出磁场的分量形式：
\begin_inset Formula 
\begin{equation}
B_{j}=A_{i}\varepsilon_{jk\ell}\partial_{k}N_{i}^{e}\left(\hat{e}_{z}\right)_{\ell}=\varepsilon_{jk3}\,A_{i}\partial_{k}N_{i}^{e}\label{eq:xl6.11}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\hat{e}_{z}$
\end_inset

 是
\begin_inset Formula $z$
\end_inset

方向坐标基矢，所以 
\begin_inset Formula $\left(\hat{e}_{z}\right)_{\ell}=\delta_{z\ell}$
\end_inset

。
\end_layout

\begin_layout Enumerate
上式中的 
\begin_inset Formula $\partial_{k}N_{i}^{e}$
\end_inset

 可以在 母坐标系下表示为：
\begin_inset Formula 
\[
\partial_{k}N_{i}^{e}=J_{k\ell}^{-1}\hat{\partial}_{\ell}N_{i}^{e}.
\]

\end_inset

其中 
\begin_inset Formula $\hat{\partial}_{\ell}$
\end_inset

 表示 母坐标系下的偏导。
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

 稍作变换可以得到另一种形式，两边同乘 
\begin_inset Formula $\varepsilon_{jk3}$
\end_inset

 得：
\begin_inset Formula 
\begin{align*}
 & \varepsilon_{jk3}A_{i}\partial_{k}N_{i}^{e}=B_{j}\\
\Rightarrow\quad & \varepsilon_{jk3}\;\varepsilon_{jk3}A_{i}\partial_{k}N_{i}^{e}=\varepsilon_{jk3}\;B_{j}
\end{align*}

\end_inset

即
\begin_inset Formula 
\begin{equation}
A_{i}\partial_{k}N_{i}^{e}=\varepsilon_{jk3}\,B_{j}\label{eq:xl6.11-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
使用
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

 （数字表示不同指标）得
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha m}} & =A_{i}\varepsilon_{jk3}\;{\color{blue}\frac{\partial J_{k\ell}^{-1}}{\partial r_{\alpha m}}}\;\hat{\partial}_{\ell}N_{i}^{e}=A_{i}\varepsilon_{jk3}\;{\color{blue}\left(-\partial_{k}L_{\alpha}^{e}\;J_{m\ell}^{-1}\right)}\;\hat{\partial}_{\ell}N_{i}^{e}\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(A_{i}J_{m\ell}^{-1}\hat{\partial}_{\ell}N_{i}^{e}\right)\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(A_{i}\partial_{m}N_{i}^{e}\right)\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(\varepsilon_{nm3}\,B_{n}\right)\\
 & =-\left(\delta_{jn}\delta_{km}-\delta_{jm}\delta_{kn}\right){\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{n}\\
 & =-{\color{blue}\left(\partial_{m}L_{\alpha}^{e}\right)}B_{j}+\delta_{jm}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{k}
\end{align*}

\end_inset

合并两项的贡献，给出节点 
\begin_inset Formula $\alpha$
\end_inset

 所受磁力的 
\begin_inset Formula $m$
\end_inset

 分量，
\begin_inset Formula 
\[
F_{\alpha m}=\sum_{e}\int_{\Omega^{e}}\left\{ -\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-H_{j}\left[\delta_{jm}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{k}-{\color{blue}\left(\partial_{m}L_{\alpha}^{e}\right)}B_{j}\right]\right\} \dd{\Omega}
\]

\end_inset

写成矢量形式，节点 
\begin_inset Formula $\alpha$
\end_inset

 上所受的力是，
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-\sbf H\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)+\left(\sbf H\cdot\sbf B\right)\nabla L_{\alpha}^{e}\right]\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Example
线性情况下 
\begin_inset Formula $\sbf B=\mu_{0}\mu_{r}\sbf H$
\end_inset

，节点 
\begin_inset Formula $\alpha$
\end_inset

 所受的力化简为：
\begin_inset Formula 
\begin{align*}
\sbf F_{\alpha} & =\sum_{e}\int_{\Omega^{e}}\left[-\frac{\sbf H\cdot\sbf B}{2}\nabla L_{\alpha}^{e}-\sbf H\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)+\left(\sbf H\cdot\sbf B\right)\nabla L_{\alpha}^{e}\right]\dd{\Omega}\\
 & =\sum_{e}\int_{\Omega^{e}}\left[\frac{-\sbf B\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)}{\mu_{0}\mu_{r}}+\frac{\sbf B\cdot\sbf B}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}\right]\dd{\Omega}
\end{align*}

\end_inset

代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.10"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到
\begin_inset Formula 
\begin{equation}
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[\frac{A_{\beta}A_{\gamma}}{\mu_{0}\mu_{r}}\left(\nabla L_{\alpha}^{e}\cdot\nabla N_{\beta}^{e}\right)\nabla N_{\gamma}^{e}-A_{\beta}A_{\gamma}\frac{\nabla N_{\beta}^{e}\cdot\nabla N_{\gamma}^{e}}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}\right]\dd{\Omega}\label{eq:xl6.12}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
三维电磁力计算
\end_layout

\begin_layout Standard
三维磁场可以用棱边性函数表示为：
\begin_inset Formula 
\[
\sbf B=(\nabla\times\sbf N_{\alpha}^{e})A_{\alpha}=2A_{\alpha}\ell_{\alpha}^{e}\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}
\]

\end_inset

其中 
\begin_inset Formula $\sbf N_{\alpha}^{e}=(L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}-L_{\alpha(2)}^{e}\times\nabla L_{\alpha(1)}^{e})\ell_{\alpha}^{e}$
\end_inset

。分量形式为：
\begin_inset Formula 
\begin{align*}
B_{j} & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\;{\color{blue}\partial_{k}L_{\alpha(1)}^{e}}\;{\color{brown}\partial_{m}L_{\alpha(2)}^{e}}\\
 & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\;{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}\hat{\partial}_{g}L_{\alpha(2)}^{e}}
\end{align*}

\end_inset

上式中的 Jacobi 矩阵和四面体棱边的长度 
\begin_inset Formula $\ell_{i}^{e}$
\end_inset

 均为 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 的函数，但在用棱边形函数进行有限元计算时，待求的独立变量应该是 
\begin_inset Formula $A_{i}\ell_{i}$
\end_inset

 而不是 
\begin_inset Formula $A_{i}$
\end_inset

；每条边上的 
\begin_inset Formula $A_{i}\ell_{i}$
\end_inset

 不变，也是保证四面体某个面上磁通不变的条件。因此在计算 
\begin_inset Formula $B_{j}$
\end_inset

 偏导的时候，只需计算 Jacobi 矩阵对 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 的导数。利用式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

可得
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha h}} & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left({\color{blue}\frac{\partial J_{kf}^{-1}}{\partial r_{\alpha h}}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}}+{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}\frac{J_{mg}^{-1}}{\partial r_{\alpha h}}}\right){\color{brown}\hat{\partial}_{g}L_{\alpha(2)}^{e}}\\
 & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}(-)\left({\color{blue}\partial_{k}L_{\alpha}^{e}\;J_{hf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}}+{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}\partial_{m}L_{\alpha}^{e}\;J_{hg}^{-1}}\right){\color{brown}\hat{\partial}_{g}L_{\alpha(2)}^{e}}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left(\partial_{k}L_{\alpha}^{e}\;{\color{red}J_{hf}^{-1}\hat{\partial}_{f}}\;L_{\alpha(1)}^{e}\;{\color{red}J_{mg}^{-1}\hat{\partial}_{g}}\;L_{\alpha(2)}^{e}+{\color{red}J_{kf}^{-1}\hat{\partial}_{f}}\;L_{\alpha(1)}^{e}\;\partial_{m}L_{\alpha}^{e}\;{\color{red}J_{hg}^{-1}\hat{\partial}_{g}}\;L_{\alpha(2)}^{e}\right)\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left(\partial_{k}L_{\alpha}^{e}\;{\color{red}\partial_{h}}\;L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}\;L_{\alpha(2)}^{e}+{\color{red}\partial_{k}}\;L_{\alpha(1)}^{e}\;\partial_{m}L_{\alpha}^{e}\;{\color{red}\partial_{h}}\;L_{\alpha(2)}^{e}\right)\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\partial_{k}L_{\alpha}^{e}\left({\color{red}\partial_{h}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}L_{\alpha(2)}^{e}-{\color{red}\partial_{m}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{h}}L_{\alpha(2)}^{e}\right)
\end{align*}

\end_inset

代入恒等式
\begin_inset Formula 
\[
{\color{red}\partial_{h}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}L_{\alpha(2)}^{e}-{\color{red}\partial_{m}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{h}}L_{\alpha(2)}^{e}=\varepsilon_{bhm}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\quad\text{反对称}
\]

\end_inset

得到
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha h}} & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\partial_{k}L_{\alpha}^{e}\;\varepsilon_{bhm}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\left[\begin{array}{cc}
\delta_{jb} & \delta_{jh}\\
\delta_{kb} & \delta_{kh}
\end{array}\right]\partial_{k}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\left[\partial_{h}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{j}-\delta_{jh}\partial_{k}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{k}\right]\\
 & =-B_{j}\;\partial_{h}L_{\alpha}^{e}+\delta_{jh}\;B_{k}\,\partial_{k}L_{\alpha}^{e}
\end{align*}

\end_inset

写成矢量形式是
\begin_inset Formula 
\[
\left[\begin{array}{c}
\partial/\partial r_{\alpha1}\\
\partial/\partial r_{\alpha2}\\
\partial/\partial r_{\alpha3}
\end{array}\right]B_{j}=-B_{j}\nabla L_{\alpha}^{e}+\sbf e_{j}\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)
\]

\end_inset

因此虚功法的磁力表达式
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-\sbf H\cdot\frac{\partial\sbf B}{\partial\sbf r_{k}}\right]
\]

\end_inset

给出
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}+\nabla L_{\alpha}^{e}\left(\sbf H\cdot\sbf B\right)-\left(\sbf B\cdot\nabla L_{\alpha}^{e}\right)\sbf H\right]
\]

\end_inset

对于线性材料 
\begin_inset Formula $\sbf B=\mu\mu_{0}\sbf H$
\end_inset

，结果化简为：
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\frac{\sbf B\cdot\sbf B}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}-\frac{\sbf B\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)}{\mu_{0}\mu_{r}}\right]
\]

\end_inset


\end_layout

\begin_layout Section
计算电力？？
\end_layout

\begin_layout Standard
理论公式：
\begin_inset Formula 
\[
\mathcal{U}=\int_{0}^{Q}V\dd{Q'}=\int_{\Omega}\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\dd{\Omega}
\]

\end_inset


\begin_inset Formula 
\[
\int_{0}^{\Psi}I\dd{\Psi'}\quad\Leftrightarrow\quad\int_{0}^{Q}V\dd{Q'}
\]

\end_inset

所以 
\begin_inset Formula $\Psi$
\end_inset

 对应 
\begin_inset Formula $Q$
\end_inset

，
\begin_inset Formula $I$
\end_inset

 对应 
\begin_inset Formula $V$
\end_inset

。
\begin_inset Formula 
\begin{align*}
\mathcal{U}_{\text{co}} & =VQ-\mathcal{U}=\int_{0}^{V}Q\dd{V'}\\
 & =\int_{\Omega}\left(\int_{0}^{E}\sbf D\cdot\dd{\sbf E'}\right)\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
类似磁力的计算 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:calc-magforce"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\mathcal{U}=\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\det[J]\dd{\hat{\Omega}}
\]

\end_inset

节点 
\begin_inset Formula $\alpha$
\end_inset

 上的电力，表示成 电能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 对节点 
\begin_inset Formula $\alpha$
\end_inset

 的坐标的偏导数：
\begin_inset Formula 
\[
\sbf F_{\alpha}=-\frac{\partial\mathcal{U}}{\partial\sbf r_{\alpha}}
\]

\end_inset


\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right){\color{blue}\frac{\partial\det[J]}{\partial\sbf r_{\alpha}}}-\left(\sbf E\cdot{\color{brown}\frac{\partial\sbf D}{\partial\sbf r_{\alpha}}}\right)\det[J]\right]\dd{\hat{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Example
代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\partial\det[J]/\partial r_{\alpha j}=\det[J]\,\partial_{j}L_{\alpha}^{e}$
\end_inset

，第一项的贡献表示为，
\begin_inset Formula 
\[
f_{\alpha,1}=-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right){\color{blue}\partial_{j}L_{\alpha}^{e}\,\det[J]}\dd{\hat{\Omega}}
\]

\end_inset

顺便改写积分测度：
\begin_inset Formula 
\[
\sbf f_{\alpha,1}=-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\nabla L_{\alpha}^{e}\,\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
再考虑第二项的贡献
\begin_inset Formula 
\begin{equation}
-\left(\sbf E\cdot{\color{brown}\frac{\partial\sbf D}{\partial\sbf r_{\alpha}}}\right)\det[J]\quad\Rightarrow\quad-E_{i}\frac{\partial D_{i}}{\partial r_{\alpha j}}\,\det[J]\label{eq:e-force2}
\end{equation}

\end_inset

右边是对应的分量形式。电位移
\begin_inset Formula $\sbf D$
\end_inset

 依赖于 电场强度 
\begin_inset Formula $\sbf E$
\end_inset

：
\begin_inset Formula 
\[
\frac{\partial D_{i}}{\partial r_{\alpha j}}=\mathcal{\varepsilon}_{ik}\frac{\partial E_{k}}{\partial r_{\alpha j}},\quad\mathcal{\varepsilon}_{ik}=\frac{\partial D_{i}}{\partial E_{k}}
\]

\end_inset


\begin_inset Formula $\mathcal{\varepsilon}_{ik}$
\end_inset

 是材料的介电张量。写出 
\begin_inset Formula $\sbf E=-\nabla\phi$
\end_inset

 的分量形式：
\end_layout

\begin_layout Example
\begin_inset Formula 
\[
E_{k}=-\partial_{k}\phi=-{\color{blue}\partial_{k}N_{\beta}^{e}\;\phi_{\beta}}
\]

\end_inset

其中 
\begin_inset Formula $\phi_{\beta}$
\end_inset

 是节点上的电势，为常数。将对 母坐标的偏导数记作 
\begin_inset Formula $\hat{\partial}_{k}=\left(\frac{\partial}{\partial\xi},\frac{\partial}{\partial\eta},\frac{\partial}{\partial\zeta}\right)$
\end_inset

，考虑雅可比矩阵得
\begin_inset Formula 
\begin{equation}
E_{k}=-{\color{brown}J_{k\ell}^{-1}}\;{\color{blue}\hat{\partial}_{\ell}N_{\beta}^{e}\,\phi_{\beta}}\label{eq:elec-field}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
其中 
\begin_inset Formula $\hat{\partial}_{\ell}N_{\beta}^{e}$
\end_inset

 表示 母坐标系下的偏导，此时形函数 
\begin_inset Formula $N_{\beta}^{e}$
\end_inset

 使用 母坐标表示，不包含节点 
\begin_inset Formula $\alpha$
\end_inset

 的空间坐标。
\end_layout

\begin_layout Enumerate
对节点 
\begin_inset Formula $\alpha$
\end_inset

 坐标的依赖 只包含在 
\begin_inset Formula ${\color{brown}J_{k\ell}^{-1}}$
\end_inset

 中。
\end_layout

\begin_layout Standard
代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

 （数字表示不同指标）得
\begin_inset Formula 
\begin{align*}
\frac{\partial E_{k}}{\partial r_{\alpha j}} & =-({\color{brown}-\partial_{k}L_{\alpha}^{e}\;J_{j\ell}^{-1}})\,{\color{blue}\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\\
 & =\partial_{k}L_{\alpha}^{e}\;{\color{blue}J_{j\ell}^{-1}\,\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\\
 & ={\color{blue}(-E_{j})}\;\partial_{k}L_{\alpha}^{e}
\end{align*}

\end_inset

将此结果代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e-force2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 得
\begin_inset Formula 
\[
-E_{i}\frac{\partial D_{i}}{\partial r_{\alpha j}}=-E_{i}\,\mathcal{\varepsilon}_{ik}\left(-E_{j}\right)\partial_{k}L_{\alpha}^{e}
\]

\end_inset

写成矢量形式是
\begin_inset Formula 
\[
f_{\alpha,2}=\sbf E\;\left(\sbf E\cdot\varepsilon\cdot\nabla L_{\alpha}^{e}\right)\dd{\Omega}
\]

\end_inset

其中 
\begin_inset Formula $\varepsilon=\partial D/\partial E$
\end_inset

，是材料的介电张量。
\end_layout

\begin_layout Standard
综合两项的贡献得到：
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\nabla L_{\alpha}^{e}+\sbf E\,\left(\sbf E\cdot\varepsilon\cdot\nabla L_{\alpha}^{e}\right)\right]\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Subsection
eeee
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
F_{\alpha}=\sum_{\langle e\rangle}\int_{\Omega^{e}}\left[\big(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\big)\nabla L_{\alpha}^{e}-\sbf E\,(\sbf D\cdot\nabla L_{\alpha}^{e})\right]\dd{\Omega}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
F_{\alpha} & =\sum_{\langle e\rangle}\int_{\Omega^{e}}\frac{\sbf E\cdot\sbf D}{2}\nabla L_{\alpha}^{e}\dd{\Omega}-\sum_{\langle e\rangle}\int_{\Omega^{e}}\left(\sbf D\cdot\nabla L_{\alpha}^{e}\right)\sbf E\dd{\Omega}\\
 & +\sum_{\langle e\rangle}\int_{\Omega^{e}}\frac{\sbf B\cdot\sbf H}{2}\nabla L_{\alpha}^{e}\dd{\Omega}-\sum_{\langle e\rangle}\int_{\Omega^{e}}\left(\sbf B\cdot\nabla L_{\alpha}^{e}\right)\sbf H\dd{\Omega}
\end{align*}

\end_inset

在上面的表达式中，
\begin_inset Formula $\langle e\rangle$
\end_inset

 表示仅对最近邻单元进行求和。将目标区域的节点上的电磁力进行求和，可以得到该目标区域所受到的总的电磁力。
\end_layout

\begin_layout Standard
另外根据力矩的计算公式，也可以得到各个节点上所受到的力矩，即
\begin_inset Formula 
\[
\sbf T_{k}=\left(\sbf r_{k}-\sbf r_{0}\right)\times\sbf F_{k}
\]

\end_inset

 其中 
\begin_inset Formula $\sbf r_{0}$
\end_inset

 为转轴的坐标，对目标区域的节点上的力矩进行求和，同样可以得到总的电磁力矩。
\end_layout

\begin_layout Section
麦克斯韦协强张量法
\end_layout

\begin_layout Standard
麦克斯韦协强张量法通常用来计算被真空包围的磁体在磁场作用下受到的合力。从洛伦兹力表达式
\begin_inset Formula 
\begin{equation}
\sbf F=\int_{V}\sbf J\times\sbf B\dd{V}\label{eq:xl6.18}
\end{equation}

\end_inset

出发，根据
\begin_inset Formula $\nabla\times\sbf B=\mu_{0}\sbf J$
\end_inset

 和 
\begin_inset Formula $\nabla\cdot\sbf B=\sbf0$
\end_inset

，可以得到
\begin_inset Formula 
\[
\sbf F=\int_{V}\frac{(\nabla\times\sbf B)\times\sbf B+(\nabla\cdot\sbf B)\sbf B}{\mu_{0}}\dd{V}
\]

\end_inset

分量形式下
\begin_inset Formula 
\begin{equation}
F_{a}=\int_{V}\frac{-(\partial_{a}B_{b})B_{b}+(\partial_{b}B_{a})B_{b}+B_{a}(\partial_{b}B_{b})}{\mu_{0}}\dd{V}\label{eq:xl6.19}
\end{equation}

\end_inset

在没有电场的情况下，麦克斯韦协强张量定义为
\begin_inset Formula 
\begin{equation}
\mathcal{T}_{ab}=\frac{1}{\mu_{0}}B_{a}B_{b}-\frac{B_{c}B_{c}}{2\mu_{0}}\delta_{ab}\label{eq:xl6.20}
\end{equation}

\end_inset

 计算可以得到
\begin_inset Formula 
\begin{align*}
\partial_{b}\mathcal{T}_{ab} & =\frac{1}{\mu_{0}}\partial_{b}(B_{a}B_{b})-\frac{\partial_{b}(B_{c}B_{c})}{2\mu_{0}}\delta_{ab}\\
 & =\frac{(\partial_{b}B_{a})B_{b}+B_{a}(\partial_{b}B_{b})}{\mu_{0}}-\frac{(\partial_{a}B_{b})B_{b}}{\mu_{0}}
\end{align*}

\end_inset

所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.19"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的洛伦兹力可以用麦克斯韦协强张量表示为：
\begin_inset Formula 
\[
F_{a}=\int_{V}\dd{V}\partial_{b}\,\mathcal{T}_{ab}=\oint_{S}\dd{S}\sbf n_{b}\,\mathcal{T}_{ab}
\]

\end_inset


\end_layout

\begin_layout Standard
存在表面电流的情况下
\begin_inset Formula 
\[
\sbf F=\iint_{S}\sbf J_{s}\times\frac{\sbf B^{+}+\sbf B^{-}}{2}\dd{S}
\]

\end_inset

根据边界条件 
\begin_inset Formula $\sbf n\cdot(\sbf B^{+}+\sbf B^{-})=0$
\end_inset

以及
\begin_inset Formula $\sbf n\times(\sbf B^{+}-\sbf B^{-})=\mu_{0}\sbf J_{s}$
\end_inset

，可以将洛伦兹力分量形式用磁场表示为
\begin_inset Formula 
\[
F_{a}=\iint_{s}\frac{2n_{b}B_{a}^{+}B_{b}^{-}-n_{a}B_{b}^{+}B_{b}^{+}+n_{a}B_{b}^{-}B_{b}^{-}-2n_{b}B_{a}^{-}B_{b}^{+}}{2\mu_{0}}\dd{S}
\]

\end_inset

另外根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.20"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的麦克斯韦协强张量的定义可得
\begin_inset Formula 
\[
n_{b}\left(\mathcal{T}_{ab}^{+}-\mathcal{T}_{ab}^{-}\right)=\frac{2n_{b}B_{a}^{+}B_{b}^{-}-n_{a}B_{b}^{+}B_{b}^{+}+n_{a}B_{b}^{-}B_{b}^{-}-2n_{b}B_{a}^{-}B_{b}^{+}}{2\mu_{0}}
\]

\end_inset

因此可以将表面电流下的洛伦兹力表示为
\begin_inset Formula 
\[
F_{a}=\iint_{S}n_{b}\left(\mathcal{T}_{ab}^{+}-\mathcal{T}_{ab}^{-}\right)\dd{S}
\]

\end_inset


\end_layout

\begin_layout Section
等价电流法
\end_layout

\begin_layout Standard
根据洛伦兹力的表达式，在静磁学中，一个局域电流分布受到的力为：
\begin_inset Formula 
\[
\sbf F=\int_{V}\sbf J(\sbf r')\times\sbf B(\sbf r')\dd[3]{r'}
\]

\end_inset

假设电流分布局域在原点附近，将外磁场在原点附近展开：
\begin_inset Formula $\sbf B(\sbf r')=\sbf B(\sbf0)+(\sbf r'\cdot\nabla)\sbf B(\sbf0)+\cdots$
\end_inset

，然后代入上式可得
\begin_inset Formula 
\[
F_{a}=\varepsilon_{abc}\int_{V}J_{b}(B_{c}+r_{d}^{\prime}\partial_{d}B_{c})\dd[3]{r'}
\]

\end_inset

第一项包含
\begin_inset Formula $\int\sbf J(\sbf r')\dd[3]{r'}$
\end_inset

，其值等于零（全空间稳恒电流守恒方程）；另外由等式
\begin_inset Formula $\int_{V}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})\dd[3]{r'}=0$
\end_inset

，可知 
\begin_inset Formula $\int_{V}J_{b}r_{c}^{\prime}\dd[3]{r'}$
\end_inset

为反对称张量。所以
\begin_inset Formula 
\begin{align*}
F_{a} & =\frac{\varepsilon_{abc}}{2}\int_{V}\left(J_{b}r_{d}^{\prime}-J_{d}r_{b}^{\prime}\right)\partial_{d}B_{c}\dd[3]{r'}\\
 & =\frac{-\varepsilon_{abc}}{2}\int_{V}\varepsilon_{bed}\left(\sbf J\times r^{\prime}\right)_{e}\partial_{d}B_{c}\dd[3]{r'}
\end{align*}

\end_inset

定义
\begin_inset Formula 
\[
\sbf m=\frac{1}{2}\int_{V}\sbf r'\times\sbf J(\sbf r')\dd[3]{r'}
\]

\end_inset

并根据
\begin_inset Formula $\nabla\cdot\sbf B=0$
\end_inset

，最后可以得到
\begin_inset Formula 
\[
F_{a}=m_{b}\partial_{a}B_{b}
\]

\end_inset

如果材料里面有连续分布的磁化强度，则合力的表达式为：
\begin_inset Formula 
\[
\sbf F=\int_{\Omega}\sbf M\cdot(\nabla\sbf B)\dd{\Omega}
\]

\end_inset

其中
\begin_inset Formula $\nabla\sbf B$
\end_inset

的结果是一个张量。
\end_layout

\begin_layout Remark
\begin_inset Formula $\int_{V}\dd[3]{r'}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})=\oint_{S}\dd{\sbf S}\cdot(\sbf Jr_{b}^{\prime}r_{c}^{\prime})=0$
\end_inset

（考虑到电流分布是局域的），另一方面
\begin_inset Formula 
\begin{align*}
\int_{V}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})\dd[3]{r'} & =\int_{V}\left[(\partial_{a}J_{a})r_{b}^{\prime}r_{c}^{\prime}+J_{b}r_{c}^{\prime}+J_{c}r_{b}^{\prime}\right]\dd[3]{r'}\\
 & =\int_{V}(J_{b}r_{c}^{\prime}+J_{c}r_{b}^{\prime})\dd[3]{r'}=0
\end{align*}

\end_inset

所以说
\begin_inset Formula $\int_{V}\,J_{b}r_{c}^{\prime}\dd[3]{r'}$
\end_inset

是反对称的。
\end_layout

\begin_layout Remark
若
\begin_inset Formula $W_{c}=\varepsilon_{abc}U_{a}V_{b}=\sbf U\times\sbf V$
\end_inset

，定义
\begin_inset Formula 
\[
T_{ab}=\varepsilon_{ab{\color{blue}c}}W_{{\color{blue}c}}
\]

\end_inset

根据
\begin_inset Formula $\varepsilon_{abc}\varepsilon_{abd}=\delta_{cd}$
\end_inset

，逆变换是
\begin_inset Formula 
\[
W_{{\color{blue}d}}=\varepsilon_{ab{\color{blue}d}}T_{ab}
\]

\end_inset

则根据迷向张量恒等式 
\begin_inset Formula $\varepsilon_{abc}\varepsilon_{ade}=\delta_{bd}\delta_{ce}-\delta_{be}\delta_{cd}$
\end_inset

可得
\begin_inset Formula 
\[
T_{de}=\varepsilon_{dea}\varepsilon_{abc}U_{b}V_{c}=U_{d}V_{e}-U_{e}V_{d}
\]

\end_inset


\end_layout

\begin_layout Chapter
三维空间曲面
\end_layout

\begin_layout Section
仿射变换，局域坐标系
\end_layout

\begin_layout Standard
约定：全局坐标表示为 笛卡尔坐标系中的 
\begin_inset Formula $\sbf r=\left(x,y,z\right)$
\end_inset

 ，二维平面局域坐标表示为 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

。对于三维空间中的曲面上的点，其全局坐标和局域坐标的变换关系为：
\begin_inset Formula 
\begin{align*}
\sbf r & =S.\sbf R+\sbf r_{n}\\
\sbf R & =S^{-1}.\left(\sbf r-\sbf r_{n}\right)
\end{align*}

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是第
\begin_inset Formula $n$
\end_inset

个单元的参考点。也可以写成
\begin_inset Formula 
\[
\left[\begin{array}{c}
\sbf r\\
1
\end{array}\right]=\left[\begin{array}{cc}
S & \sbf r_{n}\\
0 & 1
\end{array}\right]\left[\begin{array}{c}
\sbf R\\
1
\end{array}\right]
\]

\end_inset

其中坐标变换矩阵
\begin_inset Formula $S$
\end_inset

为
\begin_inset Formula 
\[
S_{ij}=\sbf d_{i}\cdot{\color{blue}\sbf e_{j}}.
\]

\end_inset

式中 
\begin_inset Formula $\sbf d_{i}$
\end_inset

 表示笛卡尔坐标基矢， 
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 表示局域坐标基矢。因此，
\begin_inset Formula $S$
\end_inset

 的每一列就是 
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 在原坐标系中的分量表示。这里的约定是
\begin_inset Formula 
\[
\left[e_{1}\right]=\left(\begin{array}{c}
e_{1,x}=\sbf d_{1}\cdot\sbf e_{1}\\
e_{1,y}=\sbf d_{2}\cdot\sbf e_{1}\\
e_{1,z}=\sbf d_{3}\cdot\sbf e_{1}
\end{array}\right),\quad\sbf e_{1}\,\text{分量形式为列向量}.
\]

\end_inset

用黑体表示矢量，普通字体表示矢量的分量数组，拉丁下标表示具体的分量。
\end_layout

\begin_layout Corollary
当 
\begin_inset Formula $\sbf d_{i}$
\end_inset

，
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 都是单位正交基时，
\begin_inset Formula $S$
\end_inset

 是正交矩阵，即
\begin_inset Formula 
\[
S^{-1}=S^{T},\quad S_{ij}^{-1}=S_{ji}.
\]

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{c}
X\\
Y\\
Z
\end{array}\right]=\left[\begin{array}{c}
e_{1}^{T}\\
e_{2}^{T}\\
e_{3}^{T}
\end{array}\right].\left([r]-[r_{n}]\right)
\]

\end_inset

其中 
\begin_inset Formula $[r]$
\end_inset

，
\begin_inset Formula $[r_{n}]$
\end_inset

 均为列向量。在局域坐标的小范围中，如果将 
\begin_inset Formula $\sbf e_{i}$
\end_inset

 当作常矢量，则有
\begin_inset Formula 
\begin{align*}
 & \dd{X}=[e_{1}^{T}]\cdot\dd{[r]}\\
 & \dd{Y}=[e_{2}^{T}]\cdot\dd{[r]}\\
 & \dd{Z}=[e_{3}^{T}]\cdot\dd{[r]}
\end{align*}

\end_inset

从几何直观上也是可以理解的。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
Frenet 标架
\end_layout

\begin_layout Standard
ref: 
\begin_inset CommandInset href
LatexCommand href
name "Frenet 标架"
target "https://zhuanlan.zhihu.com/p/144787656"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Frenet 公式：
\begin_inset Formula 
\[
\frac{\dd}{\dd{s}}\left[\begin{array}{c}
T(s)\\
N[s]\\
B[s]
\end{array}\right]=\left[\begin{array}{ccc}
0 & \kappa(s) & 0\\
-\kappa(s) & 0 & \tau(s)\\
0 & -\tau(s) & 0
\end{array}\right]\left[\begin{array}{c}
T(s)\\
N[s]\\
B[s]
\end{array}\right]
\]

\end_inset

以弧长作为参数：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf r(t)$
\end_inset

 变成了 
\begin_inset Formula $\sbf r(s)$
\end_inset

。
\end_layout

\begin_layout Enumerate
单位切向量 
\begin_inset Formula $\sbf T$
\end_inset

：
\begin_inset Formula 
\[
\sbf T(s)=\frac{\dd{\sbf r}}{\dd{s}}=\frac{\dd{\sbf r}/\dd{t}}{\dd{s}/\dd{t}}=\frac{\sbf v}{\abs{\sbf v}}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
曲率 
\begin_inset Formula $\kappa$
\end_inset

：描述了单位切向量随着曲线的改变，也可以看成曲线偏离直线的变化率：
\begin_inset Formula 
\[
\kappa(s)=\frac{\dd{T}}{\dd{s}}=\frac{1}{\abs{\sbf v}}\frac{\dd{\sbf T}}{\dd{t}}
\]

\end_inset


\end_layout

\begin_layout Enumerate
主法向量 
\begin_inset Formula $\sbf N$
\end_inset

：指向曲线转动的方向。定义在在 
\begin_inset Formula $\kappa\neq0$
\end_inset

 的点
\begin_inset Formula 
\[
\sbf N=\frac{1}{\kappa}\frac{\dd{T}}{\dd{s}}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
次法向量：垂直于 
\begin_inset Formula $\sbf T$
\end_inset

–
\begin_inset Formula $\sbf N$
\end_inset

平面
\begin_inset Formula 
\[
\sbf B=\sbf T\times\sbf N.
\]

\end_inset


\end_layout

\begin_layout Enumerate
挠率：
\begin_inset Formula $\tau=-\frac{\dd{\sbf B}}{\dd{s}}\cdot\sbf N$
\end_inset

，代表曲线偏离 
\begin_inset Formula $\sbf T$
\end_inset

–
\begin_inset Formula $\sbf N$
\end_inset

平面的速率。和 曲线的主单位法向量
\end_layout

\begin_layout Standard
三维曲面的边界为一空间曲线，计算其边界的主法线方向需要曲率 
\begin_inset Formula $\kappa\neq0$
\end_inset

；但是在线性单元的近似下，边界上的曲率为零，所以无法计算其主法线方向。
\end_layout

\begin_layout Section
曲面上的泊松方程
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:curve3D"

\end_inset


\end_layout

\begin_layout Standard
三维曲面上的泊松方程为
\begin_inset Formula 
\[
-\nabla_{t}\cdot\varepsilon\cdot\nabla_{t}\phi=\rho
\]

\end_inset


\begin_inset Formula $\nabla_{t}$
\end_inset

 表示沿着曲面切平面的梯度。对应的有限元方程中的系数矩阵为
\begin_inset Formula 
\[
K_{ij}^{e}=\int_{\Omega^{e}}\nabla_{t}N_{i}^{e}\cdot\varepsilon\cdot\nabla_{t}N_{j}^{e}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Example
三维中的曲面的四边形单元上的雅可比矩阵（对于某一确定单元 
\begin_inset Formula $e$
\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[J\right] & =\left[{\color{blue}\begin{array}{c}
\frac{\partial\sbf r}{\partial\xi}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}
\end{array}}\right]=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\vspace{1ex}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{ccc}
\frac{\partial N_{i}^{e}}{\partial\xi}x_{i} & \frac{\partial N_{i}^{e}}{\partial\xi}y_{i} & \frac{\partial N_{i}^{e}}{\partial\xi}z_{i}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}x_{i} & \frac{\partial N_{i}^{e}}{\partial\eta}y_{i} & \frac{\partial N_{i}^{e}}{\partial\eta}z_{i}
\end{array}\right],\quad\text{重复指标求和}\\
 & =\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]
\end{align*}

\end_inset

从雅可比矩阵可以定义出局域坐标的三个方向（正交归一基）
\begin_inset Formula 
\begin{align*}
 & \sbf e_{1}=\frac{\partial\sbf r}{\partial\xi}/\abs{\frac{\partial\sbf r}{\partial\xi}}\\
 & \sbf e_{3}=\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}/\abs{\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}}\\
 & \sbf e_{2}=\sbf e_{3}\times\sbf e_{1}
\end{align*}

\end_inset

注意曲面上的两切线
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}$
\end_inset

，
\begin_inset Formula $\frac{\partial\sbf r}{\partial\eta}$
\end_inset

 不一定是正交的；网格剖分时单元面积不为零，保证了 
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}\neq0$
\end_inset

。
\end_layout

\begin_layout Example
使用局域坐标系 
\begin_inset Formula $T^{ab}=T^{ab}\left(\sbf e_{1},\sbf e_{2},\sbf e_{3}\right)$
\end_inset

 ，实现全局坐标 
\begin_inset Formula $\sbf r=\left(x,y,z\right)$
\end_inset

 到二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

的转换
\begin_inset Formula 
\[
\sbf R=T^{ab}\cdot\sbf r
\]

\end_inset


\begin_inset Formula 
\[
\sbf R=S^{-1}.\left(\sbf r-\sbf r_{n}\right),\quad S^{-1}=\left[\begin{array}{c}
\sbf e_{1}^{T}\\
\sbf e_{2}^{T}\\
\sbf e_{3}^{T}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是局域原点的全局坐标。系数矩阵计算需要的形函数的切向梯度可以在二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

下计算（参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jac2"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial X} & \frac{\partial N_{2}^{e}}{\partial X} & \frac{\partial N_{3}^{e}}{\partial X} & \frac{\partial N_{4}^{e}}{\partial X}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial Y} & \frac{\partial N_{2}^{e}}{\partial Y} & \frac{\partial N_{3}^{e}}{\partial Y} & \frac{\partial N_{4}^{e}}{\partial Y}
\end{array}\right] & =\left[\begin{array}{cc}
\frac{\partial\xi}{\partial X} & \frac{\partial\eta}{\partial X}\vspace{1ex}\\
\frac{\partial\xi}{\partial Y} & \frac{\partial\eta}{\partial Y}
\end{array}\right]\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\vspace{1ex}\\
\frac{\partial X}{\partial\eta} & \frac{\partial Y}{\partial\eta}
\end{array}\right]^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\partial\sbf r}{\partial\xi}\cdot\sbf e_{1} & \frac{\partial\sbf r}{\partial\xi}\cdot\sbf e_{2}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}\cdot\sbf e_{1} & \frac{\partial\sbf r}{\partial\eta}\cdot\sbf e_{2}
\end{array}\right]^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left(\left[\begin{array}{c}
\frac{\partial\sbf r}{\partial\xi}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}
\end{array}\right]\left[\begin{array}{cc}
\sbf e_{1} & \sbf e_{2}\end{array}\right]\right)^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]
\end{align*}

\end_inset

其中使用了
\begin_inset Formula $\dd{r}=\dd{X}\sbf e_{1}+\dd{Y}\sbf e_{2}$
\end_inset

，即矢径的微元等于切矢的微元。
\end_layout

\begin_layout Section
约定和总结
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r_{j}$
\end_inset

 表示全局坐标，三维空间自由度 
\begin_inset Formula $j\in\left\{ 1,2,3\right\} $
\end_inset

，
\begin_inset Formula $\partial_{j}$
\end_inset

 表示对全局坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\overline{x}_{\alpha}$
\end_inset

 表示有限元中的采样点（node）， 
\begin_inset Formula $\alpha\in{1,2,\cdots,N}$
\end_inset

（希腊字母），一阶三角形单元
\begin_inset Formula $3$
\end_inset

个，二阶三角形
\begin_inset Formula $6$
\end_inset

个；一阶四边形
\begin_inset Formula $4$
\end_inset

个 等等。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $x_{p}^{\prime}$
\end_inset

 表示单元中二维平面的局域空间坐标 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

，
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{p}^{\prime}$
\end_inset

 表示对局域坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\xi_{p}$
\end_inset

 表示将二维局域坐标再变换到 母坐标 
\begin_inset Formula $\left(\xi_{1},\xi_{2}\right)$
\end_inset

，或记作
\begin_inset Formula $\left(\xi,\eta\right)$
\end_inset

，平面自由度 
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

（拉丁字母）；
\begin_inset Formula $\hat{\partial}_{p}$
\end_inset

 表示对
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

求导。
\end_layout

\begin_layout Enumerate
表达式右边标出了维度。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
全局空间坐标对 母坐标的雅可比行列式
\begin_inset Formula 
\begin{equation}
J_{pj}=\hat{\partial}_{p}{\color{blue}r_{j}}=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\vspace{1ex}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}
\end{array}\right]=\hat{\partial}_{p}\,{\color{blue}N_{\alpha}\,\overline{x}_{\alpha j}},\quad[2,3]\label{eq:jacobi9}
\end{equation}

\end_inset

其中 ，对于选定的单元 
\begin_inset Formula $N_{\alpha}$
\end_inset

 形式已知，
\begin_inset Formula $\overline{x}_{\alpha j}$
\end_inset

 是节点坐标为已知常量，所以 
\begin_inset Formula $J_{pj}$
\end_inset

 可以直接求得，维数是 
\begin_inset Formula $2\times3$
\end_inset

。
\end_layout

\begin_layout Enumerate
局域空间坐标的三个单位正交基
\begin_inset Formula 
\begin{align*}
\sbf e_{1} & =J_{1\cdot}/\abs{J_{1\cdot}},\quad\text{点表示取整列}\\
\sbf e_{3} & =J_{1\cdot}\times J_{2\cdot}/\abs{J_{1\cdot}\times J_{2\cdot}},\\
\sbf e_{2} & =\sbf e_{3}\times\sbf e_{1}.
\end{align*}

\end_inset

之所以按此序列构造，是为了保证 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

 是相互垂直的。求出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi9"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $J_{pj}$
\end_inset

，即可求出每个单元所属的 
\begin_inset Formula $\sbf e_{j}$
\end_inset

。可以把 
\begin_inset Formula $\left\{ \sbf e_{j}\right\} $
\end_inset

的分量写成数组形式（矩阵）。分量数组用普通字体表示，将 
\begin_inset Formula $[e_{i}]$
\end_inset

分别填入
\color blue
每列
\color inherit

\begin_inset Formula 
\begin{equation}
E_{ij}=\left[\begin{array}{ccc}
\vdots & \vdots & \vdots\\
e_{1} & e_{2} & e_{3}\\
\vdots & \vdots & \vdots
\end{array}\right],\quad[3,3]\label{eq:unitVector}
\end{equation}

\end_inset

则 指标
\begin_inset Formula $1$
\end_inset

索引 基矢的分量，指标
\begin_inset Formula $2$
\end_inset

索引 基矢的编号。
\end_layout

\begin_layout Enumerate
局域空间坐标 对 母坐标的 雅可比矩阵：
\begin_inset Formula 
\begin{equation}
L_{pq}=\hat{\partial}_{p}x_{q}^{\prime}=\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\vspace{1ex}\\
\frac{\partial X}{\partial\eta} & \frac{\partial Y}{\partial\eta}
\end{array}\right]=J_{pj}\,E_{jq},\quad[2,2]\label{eq:jacobi3}
\end{equation}

\end_inset


\begin_inset Formula $p,q\in\{1,2\}$
\end_inset

， 
\begin_inset Formula $J$
\end_inset

 和 
\begin_inset Formula $E$
\end_inset

 分别在 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi9"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:unitVector"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中求出。注意使用 
\begin_inset Formula $E$
\end_inset

 时只需取前
\begin_inset Formula $[2\times2]$
\end_inset

。
\end_layout

\begin_layout Enumerate
形函数 对 局域空间坐标 的梯度
\begin_inset Formula 
\[
{\color{blue}\partial_{p}^{\prime}}\,N_{\alpha}={\color{blue}L_{pq}^{-1}\,\hat{\partial}_{q}}N_{\alpha},\quad[2,N]
\]

\end_inset

其中
\begin_inset Formula $N$
\end_inset

是节点的数目，
\begin_inset Formula $L^{-1}$
\end_inset

是 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi3"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的逆。至此，
\begin_inset Formula $\nabla_{t}N_{i}^{e}$
\end_inset

已经求出。
\end_layout

\begin_layout Enumerate
计算均在
\begin_inset Formula $\xi\text{–}\eta$
\end_inset

参数坐标平面进行，即坐标变换步骤为 全局系的曲面
\begin_inset Formula $\Rightarrow$
\end_inset

局域系的平面
\begin_inset Formula $\Rightarrow$
\end_inset

参数系平面。最后需要在 
\begin_inset Formula $\xi$
\end_inset

–
\begin_inset Formula $\eta$
\end_inset

 参数系平面，用高斯积分法计算积分：
\begin_inset Formula 
\[
\iint_{\Omega^{\prime e}}F\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{X}\dd{Y}=\sum_{i=1}^{m}F\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset

与平直面元的区别是，现在 
\begin_inset Formula $\det[J]$
\end_inset

=
\begin_inset Formula $\frac{\partial(X,Y)}{\partial\left(\xi,\eta\right)}$
\end_inset

 在每个高斯点上可以不同。
\begin_inset Formula $\det[J]$
\end_inset

 在几何上等于局域基矢 
\begin_inset Formula $\{\frac{\partial\sbf r}{\partial\xi},\frac{\partial\sbf r}{\partial\eta}\}$
\end_inset

 架设的四边形的面积；在程序中此面积可直接用 
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}$
\end_inset

 计算。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Chapter
介电屏蔽条件
\end_layout

\begin_layout Section
介电屏蔽边界条件
\end_layout

\begin_layout Standard
电介质在外加电场
\begin_inset Formula $\sbf E_{0}$
\end_inset

下会产生极化电荷，假设电场线垂直于介质界面，根据
\begin_inset Formula $\sbf D$
\end_inset

法向在界面连续：
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\sbf E_{0}=\varepsilon\sbf E\quad\Rightarrow\quad{\color{blue}\sbf E=\frac{\epsilon_{0}}{\varepsilon}\sbf E_{0}}\\
 & \Delta\sbf E=\sbf E-\sbf E_{0}=\left(\frac{\epsilon_{0}}{\varepsilon}-1\right)\sbf E_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate

\color blue
即极化电荷产生与原外加电场反向的电场，削弱原场
\color inherit
。
\begin_inset Formula $\varepsilon$
\end_inset

越大，效果越明显，理想导体可以理解为 
\begin_inset Formula $\varepsilon\to\infty$
\end_inset

。
\end_layout

\begin_layout Enumerate
在理想导体的情况下，电场被完全屏蔽，导体内部无电场。在高
\begin_inset Formula $\varepsilon$
\end_inset

材料的情况下，会残余一丢丢电场。
\end_layout

\begin_layout Enumerate
在理想导体的情况下，电场线是垂直于导体表面的；在高
\begin_inset Formula $\varepsilon$
\end_inset

材料的情况下，材料表面的
\begin_inset Formula $\sbf E$
\end_inset

会与法向
\begin_inset Formula $\sbf n$
\end_inset

 略有偏离。
\end_layout

\begin_layout Example
一种理解方式
\end_layout

\begin_layout Enumerate
在高
\begin_inset Formula $\varepsilon$
\end_inset

介质表面求解电势分布，在界面附近，假设 
\begin_inset Formula $\sbf D_{n}$
\end_inset

 变化不大，在 
\begin_inset Formula $\nabla^{2}$
\end_inset

算子中忽略法向的贡献，只关注切向的变化。
\end_layout

\begin_layout Enumerate
表面微元上的面电荷密度是 
\begin_inset Formula $\sbf n\cdot\sbf D$
\end_inset

，
\begin_inset Formula 
\[
\sbf n\cdot\sbf D=-\nabla_{t}\cdot\left(d\,\epsilon_{0}\epsilon_{r}\cdot\nabla_{t}\phi\right)
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
另一种推导方式
\end_layout

\begin_layout Standard
选取适当的曲面坐标系，令曲线微元的表达式形如
\begin_inset Formula 
\[
\dd{\ell_{1}}=1\dd{u_{1}},\quad\dd{\ell_{2}}=1\dd{u_{2}},\quad\dd{\ell_{3}}=d\dd{u_{3}},
\]

\end_inset

假设介质中没有自由电荷，即 
\begin_inset Formula $\nabla\cdot\sbf D=0$
\end_inset

，按照公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:shI.30"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\nabla_{n}D_{n}=0
\]

\end_inset

假设 
\begin_inset Formula $d$
\end_inset

 非常小，为一薄层，
\begin_inset Formula $u_{3}$
\end_inset

变化单位长度
\begin_inset Formula $1$
\end_inset

，对应的 
\begin_inset Formula $\dd{\ell_{3}}=d$
\end_inset

 在实际中仍然是很小的尺度，把导数近似为差商；并认为由于高
\begin_inset Formula $\epsilon_{r}$
\end_inset

介质的屏蔽作用，薄层另一侧
\begin_inset Formula $\sbf D\approx0$
\end_inset

，给出
\begin_inset Formula 
\[
\nabla_{n}D_{n}\Rightarrow\frac{\sbf n\cdot\sbf D-\sbf n\cdot0}{1}=\sbf n\cdot\sbf D
\]

\end_inset

因此有
\begin_inset Formula 
\begin{equation}
\nabla_{t}\cdot\left(d\epsilon_{0}\sbf E_{t}\right)+\sbf n\cdot\epsilon_{0}\sbf E=0\label{eq:screen}
\end{equation}

\end_inset


\color blue

\begin_inset Formula $\sbf n$
\end_inset

 是法线方向，从高
\begin_inset Formula $\epsilon_{r}$
\end_inset

介质指向低
\begin_inset Formula $\epsilon_{0}$
\end_inset

介质
\color inherit
，
\begin_inset Formula $\epsilon_{0}$
\end_inset

是低介电材料的常数。
\end_layout

\begin_layout Subsection
存在的问题
\end_layout

\begin_layout Enumerate
推导过程需要用到 分部积分/高斯公式，对于曲面，或者曲线上的场，公式是否仍然成立，正确的形式是什么。
\end_layout

\begin_layout Enumerate
对于封闭的边界，如封闭曲面，或者封闭曲线，找不到边界，该如何应用分部积分，或者高斯公式。
\end_layout

\begin_layout Section
例：介电屏蔽的解析解
\end_layout

\begin_layout Enumerate
开放空间的均匀介质
\begin_inset Formula $\epsilon_{3}$
\end_inset

中，有一导体球壳
\begin_inset Formula $\epsilon_{2}$
\end_inset

，内部电介常数为
\begin_inset Formula $\epsilon_{1}$
\end_inset

，厚度为
\begin_inset Formula $d$
\end_inset

；
\end_layout

\begin_layout Enumerate
空间中存在均匀电场
\begin_inset Formula $\sbf E_{0}$
\end_inset

，求空间电场分布。
\end_layout

\begin_layout Enumerate
选取球坐标系，
\begin_inset Formula $z$
\end_inset

轴正向同
\begin_inset Formula $\sbf E_{0}$
\end_inset

方向，到内外球壳的半径分别为 
\begin_inset Formula $R_{1}$
\end_inset

，
\begin_inset Formula $R_{2}$
\end_inset

；
\end_layout

\begin_layout Standard
从球壳内到外部，电势依次为 
\begin_inset Formula $1,2,3$
\end_inset

；全部定解条件为：
\begin_inset Formula 
\begin{align*}
 & \nabla^{2}\varphi_{1}=0,\quad\nabla^{2}\varphi_{2}=0,\quad\nabla^{2}\varphi_{3}=0.\\
 & r=0:\quad\varphi_{1}=0\\
 & r\to\infty:\quad\varphi_{3}\to-E_{0}R\cos\theta,\quad\text{渐近条件}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
 & r=R_{1}:\quad\varphi_{1}\left(R_{1}\right)=\varphi_{2}\left(R_{1}\right),\quad\left.\varepsilon_{1}\frac{\partial\varphi_{1}}{\partial r}\right|_{R_{1}}=\left.\varepsilon_{2}\frac{\partial\varphi_{2}}{\partial r}\right|_{R_{1}}\\
 & r=R_{2}:\quad\varphi_{2}\left(R_{2}\right)=\varphi_{3}\left(R_{2}\right),\quad\left.\varepsilon_{2}\frac{\partial\varphi_{1}}{\partial r}\right|_{R_{2}}=\left.\varepsilon_{3}\frac{\partial\varphi_{2}}{\partial r}\right|_{R_{2}}
\end{align*}

\end_inset

根据渐近条件，假设解的形式：
\begin_inset Formula 
\begin{align*}
 & \varphi_{1}\left(r\right)=\sum_{n=1}^{\infty}a_{n}r^{n}P_{n}\left(\cos\theta\right),\quad\text{电势零点约定为}0\\
 & \varphi_{2}\left(r\right)=\sum_{n=0}^{\infty}\left(b_{n}r^{n}+\frac{c_{n}}{r^{n+1}}\right)P_{n}\left(\cos\theta\right)\\
 & \varphi_{3}\left(r\right)=d_{0}-E_{0}r\cos\theta+\sum_{n=0}^{\infty}\frac{e_{n}}{r^{n+1}}P_{n}\left(\cos\theta\right)
\end{align*}

\end_inset

代入边界条件，边界条件1–2：
\begin_inset Formula 
\begin{align}
n=0:\quad & 0=b_{0}+\frac{c_{0}}{R_{1}},\quad\varepsilon_{2}\frac{-c_{0}}{R_{1}}=0\nonumber \\
n\ge1:\quad & a_{n}R_{1}^{2n+1}=b_{n}R_{1}^{2n+1}+c_{n}\label{eq:my1}\\
n\ge1:\quad & a_{n}R_{1}^{2n+1}=\frac{\varepsilon_{2}}{\varepsilon_{1}}\left(b_{n}R_{1}^{2n+1}+\frac{-(n+1)}{n}c_{n}\right)\nonumber 
\end{align}

\end_inset

容易看出
\begin_inset Formula 
\[
a_{0}=b_{0}=c_{0}=0
\]

\end_inset

边界条件2–3：
\begin_inset Formula 
\begin{align*}
n=0:\quad & d_{0}+\frac{e_{0}}{R_{2}}=0,\quad\epsilon_{3}\frac{-e_{0}}{R_{2}^{2}}=0\\
n=1:\quad & ,b_{1}R_{2}+\frac{c_{1}}{R_{2}^{2}}=-E_{0}R_{2}+\frac{e_{1}}{R_{2}^{2}},\quad b_{1}+\frac{-2c_{1}}{R_{2}^{3}}=\frac{\epsilon_{3}}{\epsilon_{2}}\left(-E_{0}+\frac{-2e_{1}}{R_{2}^{3}}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align}
n\ge2:\quad & b_{n}R_{2}^{2n+1}+c_{n}=e_{n}\label{eq:my2}\\
n\ge2:\quad & b_{n}R_{2}^{2n+1}+\frac{-\left(n+1\right)}{n}c_{n}=\frac{\epsilon_{3}}{\epsilon_{2}}\frac{-\left(n+1\right)}{n}e_{n}\nonumber 
\end{align}

\end_inset

容易看出
\begin_inset Formula 
\[
d_{0}=e_{0}=0
\]

\end_inset

联立
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my2"
plural "false"
caps "false"
noprefix "false"

\end_inset

给出，当 
\begin_inset Formula $n\ge2$
\end_inset

时：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
equ = { an*R1^(2 n + 1) == bn*R1^(2 n + 1) + cn, an*R1^(2 n + 1) == 
\backslash
[CurlyEpsilon]2/
\backslash
[CurlyEpsilon]1 (bn* R1^(2 n + 1) + (-n - 1)/n cn), bn*R2^(2 n + 1) + cn
 == en, bn*R2^(2 n + 1) + (-n - 1)/ n cn == 
\backslash
[CurlyEpsilon]3/
\backslash
[CurlyEpsilon]2 ((-n - 1)/n en) }; Solve[equ, {an, bn, cn, en}]
\end_layout

\end_inset


\begin_inset Formula 
\[
a_{n}=0,\quad b_{n}=0,\quad c_{n}=0,\quad e_{n}=0,\quad n\ge2
\]

\end_inset

当
\begin_inset Formula $n=1$
\end_inset

时：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
equ = { a1*R1^3 == b1*R1^3 + c1, a1*R1^3 == 
\backslash
[Epsilon]2/
\backslash
[Epsilon]1 (b1*R1^3 + (-2) c1), b1*R2 + c1/R2^2 == -Subscript[
\backslash
[CapitalEpsilon], 0] R2 + e1/R2^2, b1 + (-2 c1)/ R2^3 == 
\backslash
[Epsilon]3/
\backslash
[Epsilon]2 (-Subscript[
\backslash
[CapitalEpsilon], 0] + (-2 e1)/R2^3) }; ans = First@Solve[equ, {a1, b1,
 c1, e1}] // Simplify; rule = {R2 -> Subscript[R, 2], R1 -> Subscript[R,
 1], 
\backslash
[Epsilon]2 -> Subscript[
\backslash
[Epsilon], 2], 
\backslash
[Epsilon]1 -> Subscript[
\backslash
[Epsilon], 1], 
\backslash
[Epsilon]3 -> Subscript[
\backslash
[Epsilon], 3]}; ans /.
 rule
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
 & a_{1}=-\frac{9R_{2}^{3}\epsilon_{2}\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & b_{1}=-\frac{3R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & c_{1}=\frac{3R_{1}^{3}R_{2}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & e_{1}=\frac{R_{2}^{3}\left(R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(2\epsilon_{2}+\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)\right)}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
简化情形
\end_layout

\begin_layout Standard
如果令 
\begin_inset Formula $\epsilon_{1}=\epsilon_{3}$
\end_inset

，即球壳内外具有相同的
\begin_inset Formula $\varepsilon$
\end_inset

，则化简为：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(ans2 = Simplify[ans /.
 {
\backslash
[Epsilon]3 -> 
\backslash
[Epsilon]1}]) /.
 rule; (ans3 = Simplify[ ans2 /.
 {
\backslash
[Epsilon]2 -> (S + 
\backslash
[CapitalDelta]), 
\backslash
[Epsilon]1 -> (S 
\backslash
 - 
\backslash
[CapitalDelta])}]) /.
 rule
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
 & a_{1}=-\frac{9E_{0}R_{2}^{3}(S-\Delta)(\Delta+S)}{R_{2}^{3}\left(9S^{2}-\Delta^{2}\right)-8\Delta^{2}R_{1}^{3}},\\
 & b_{1}=-\frac{3E_{0}R_{2}^{3}(S-\Delta)(\Delta+3S)}{R_{2}^{3}\left(9S^{2}-\Delta^{2}\right)-8\Delta^{2}R_{1}^{3}},\\
 & c_{1}=\frac{6\Delta E_{0}R_{1}^{3}R_{2}^{3}(S-\Delta)}{8\Delta^{2}R_{1}^{3}+R_{2}^{3}\left(\Delta^{2}-9S^{2}\right)},\\
 & e_{1}=-\frac{2\Delta E_{0}R_{2}^{3}\left(R_{2}^{3}-R_{1}^{3}\right)(\Delta+3S)}{8\Delta^{2}R_{1}^{3}+R_{2}^{3}\left(\Delta^{2}-9S^{2}\right)},
\end{align*}

\end_inset

其中 
\begin_inset Formula $S=(\epsilon_{1}+\epsilon_{2})/2$
\end_inset

， 
\begin_inset Formula $\Delta=(\epsilon_{2}-\epsilon_{1})/2$
\end_inset

。
\end_layout

\begin_layout Standard
如果进一步取 
\begin_inset Formula $\delta=\epsilon_{1}/\epsilon_{2}\rightarrow0$
\end_inset

 的极限：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify[Normal@ Series[Values@ ans2 /.
 {
\backslash
[Epsilon]1 -> 
\backslash
[Delta]*
\backslash
[Epsilon]2}, {
\backslash
[Delta], 0, 1}] /.
 rule]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
a_{1} & =\frac{9\delta E_{0}R_{2}^{3}}{2R_{1}^{3}-2R_{2}^{3}},\\
b_{1} & =\frac{3\delta E_{0}R_{2}^{3}}{R_{1}^{3}-R_{2}^{3}},\quad c_{1}=\frac{3\delta E_{0}R_{1}^{3}R_{2}^{3}}{2\left(R_{1}^{3}-R_{2}^{3}\right)},\\
e_{1} & =\frac{1}{2}E_{0}R_{2}^{3}\left(\frac{3\delta\left(R_{1}^{3}+2R_{2}^{3}\right)}{R_{1}^{3}-R_{2}^{3}}+2\right)
\end{align*}

\end_inset

代入电势的表达式得到：
\begin_inset Formula 
\begin{align*}
 & \varphi_{1}\left(r\right)=a_{1}r\cos\theta\\
 & \varphi_{2}\left(r\right)=\left(b_{1}r+c_{1}\frac{1}{r^{2}}\right)\cos\theta\\
 & \varphi_{3}\left(r\right)=\left(-E_{0}r+e_{1}\frac{1}{r^{2}}\right)\cos\theta
\end{align*}

\end_inset

如果令
\begin_inset Formula $R_{2}=\left(1+t\right)R_{1}$
\end_inset

，展开到
\begin_inset Formula $\left(\delta^{1},t^{1}\right)$
\end_inset

和
\begin_inset Formula $\left(\delta^{1},t^{0}\right)$
\end_inset

阶的结果分别是
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify[Normal@ Series[Values@ans2 /.
 {
\backslash
[Epsilon]1 -> 
\backslash
[Delta]*
\backslash
[Epsilon]2, R2 -> R1 (1 + t)} , {
\backslash
[Delta], 0, 1}, {t, 0, 0} ] /.
 rule]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
a_{1} & =-\frac{\delta E_{0}\left(2t^{2}+6t+3\right)}{2t}\approx-\frac{3\delta E_{0}(2t+1)}{2t},\\
b_{1} & =-\frac{\delta E_{0}\left(2t^{2}+6t+3\right)}{3t}\approx-\frac{\delta E_{0}(2t+1)}{t}\\
c_{1} & =-\frac{\delta E_{0}R_{1}^{3}\left(2t^{2}+6t+3\right)}{6t}\approx-\frac{\delta E_{0}R_{1}^{3}(2t+1)}{2t},\\
e_{1} & =\frac{E_{0}R_{1}^{3}\left(-3\delta+(6-20\delta)t^{2}+(2-12\delta)t\right)}{2t}\approx-\frac{E_{0}R_{1}^{3}(3\delta+2(6\delta-1)t)}{2t}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
电势和电场图像
\end_layout

\begin_layout Standard
电势的图像如下，可以看到中心处的电势接近于零。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(*dielectric, radius*) 
\backslash
[Epsilon]1 = 1; 
\backslash
[Epsilon]2 = 500; R1 = 1; R2 = 1.06; R3 = 2; E0 = 10; (*potential coeffcients*)
 S = (
\backslash
[Epsilon]1 + 
\backslash
[Epsilon]2)/ 2; 
\backslash
[CapitalDelta] = (
\backslash
[Epsilon]2 - 
\backslash
[Epsilon]1)/2; a1 = -((9 E0*R2^3 (S - 
\backslash
[CapitalDelta]) (S + 
\backslash
[CapitalDelta]))/( R2^3 (9 S^2 - 
\backslash
[CapitalDelta]^2) - 8 
\backslash
[CapitalDelta]^2 R1^3)); b1 = -((3 E0*R2^3 (S - 
\backslash
[CapitalDelta]) (
\backslash
[CapitalDelta] + 3 S))/( R2^3 (9 S^2 - 
\backslash
[CapitalDelta]^2) - 8 
\backslash
[CapitalDelta]^2 R1^3)); c1 = (6 
\backslash
[CapitalDelta]*E0*R1^3*R2^3 (S - 
\backslash
[CapitalDelta]))/( 8 
\backslash
[CapitalDelta]^2*R1^3 + R2^3 (
\backslash
[CapitalDelta]^2 - 9 S^2)); e1 = -((2 
\backslash
[CapitalDelta]*E0* R2^3 (R2^3 - R1^3) (
\backslash
[CapitalDelta] + 3 S))/( 8 
\backslash
[CapitalDelta]^2*R1^3 + R2^3 (
\backslash
[CapitalDelta]^2 - 9 S^2))); (*electric potential*) potE[{r_, 
\backslash
[Theta]_, 
\backslash
[Phi]_}] := -Piecewise[{ {a1*r*Cos[
\backslash
[Theta]], 0 < r <= R1}, {(b1*r + c1/r^2)*Cos[
\backslash
[Theta]], R1 < r <= R2}, {(-E0*r + e1/r^2)*Cos[
\backslash
[Theta]], R2 < r} }]; fig1 = DensityPlot[ potE@ToSphericalCoordinates[{0,
 y, z}] , {y, -2, 2}, {z, -2, 2} , ColorFunction -> "Rainbow" , AspectRatio
 -> 1, ImageSize -> 165, PlotLegends -> Automatic ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/jieDianPingBi1.png
	scale 80

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
电势云图，外加电场
\begin_inset Formula $\sbf E=10\,\mathrm{V/m}$
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
电场强度
\end_layout

\begin_layout Standard
根据电势表达式和球坐标 梯度表达式可以求出电场强度的表达式：
\begin_inset Formula 
\[
\nabla\phi=\partial_{r}\phi\sbf e_{r}+\frac{1}{r}\partial_{\theta}\phi\sbf e_{\theta}+\frac{1}{r\sin\theta}\partial_{\theta}\phi\sbf e_{\phi}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
-\nabla\varphi_{1} & =-a_{1}\left(\cos\theta\sbf e_{r}-\sin\theta\sbf e_{\theta}\right)\\
-\nabla\varphi_{2} & =-\frac{1}{r^{3}}\left[\left(b_{1}r^{3}-2c_{1}\right)\cos\theta\sbf e_{r}-\left(b_{1}r^{3}+c_{1}\right)\sin\theta\sbf e_{\theta}\right]\\
-\nabla\varphi_{3} & =-\frac{1}{r^{3}}\left[-\left(E_{0}r^{3}+2e_{1}\right)\cos\theta\sbf e_{r}+\left(E_{0}r^{3}-e_{1}\right)\sin\theta\sbf e_{\theta}\right]
\end{align*}

\end_inset

电场强度
\begin_inset Formula $\sbf E$
\end_inset

在界面处的分布如下，可以看到中间的电场强度也接近于零。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
vecE[{x_, y_, z_}] := Evaluate[Simplify@TransformedField[ "Spherical" ->
 "Cartesian", Simplify@ Grad[-potE[{r, 
\backslash
[Theta], 
\backslash
[Phi]}], {r, 
\backslash
[Theta], 
\backslash
[Phi]}, "Spherical"], {r, 
\backslash
[Theta], 
\backslash
[Phi]} -> {x, y, z}]]; fig2 = VectorPlot[ Rest@vecE@{10^-9, y, z} , {y,
 -1.2, 1.2}, {z, -1.2, 1.2} , VectorPoints -> {18, 18} , ImageSize -> Medium
 ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/jieDianPingBi2.png
	scale 80

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
电场强度在介质界面处的分布
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
Ritz方法
\end_layout

\begin_layout Standard
综上，当存在介电常数相差较大的两种材料，高
\begin_inset Formula $\varepsilon$
\end_inset

的材料形成一个薄层。则在高
\begin_inset Formula $\varepsilon$
\end_inset

壳的表面，应满足以下边界条件：
\begin_inset Formula 
\[
\sbf e_{n}\cdot\sbf D+\nabla_{t}\cdot\left(d\sbf D_{t}\right)=0,
\]

\end_inset

其中
\begin_inset Formula $d$
\end_inset

是界面薄层的厚度，
\begin_inset Formula $\sbf D=\varepsilon\sbf E$
\end_inset

。
\end_layout

\begin_layout Example
考虑三维情形。设求解区域为
\begin_inset Formula $\Omega$
\end_inset

，
\begin_inset Formula $\Omega$
\end_inset

的边界曲面记作
\begin_inset Formula $\Gamma=\partial\Omega$
\end_inset

，
\begin_inset Formula $\Gamma$
\end_inset

的边界曲线记作
\begin_inset Formula $C=\partial\Gamma$
\end_inset

。通常情况下，静电场的泊松方程的泛函写作
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}\left(\phi^{e}\right) & =\frac{1}{2}\int_{\Omega^{e}}\left[(\nabla\phi^{e})\cdot\epsilon_{0}\cdot(\nabla\phi^{e})+\beta\phi^{e;2}-f\phi^{e}\right]\dd{\Omega}\\
 & =\frac{1}{2}\int_{\Omega^{e}}\left[-\phi^{e}\cdot(\epsilon_{0}\nabla^{2})\phi^{e}+\beta\phi^{e;2}-f\phi^{e}\right]\dd{\Omega}+{\color{blue}\int_{\Gamma^{s}}\phi^{s}\,\sbf e_{n}\cdot(\epsilon_{0}\cdot\nabla\phi^{s})\dd{\Gamma}}
\end{align*}

\end_inset


\begin_inset Formula ${\color{blue}\int_{\Gamma^{e}}\cdots\dd{\Gamma}}$
\end_inset

 给出边界条件项，
\begin_inset Formula $\phi^{s}$
\end_inset

表示边界曲面
\begin_inset Formula $\Gamma$
\end_inset

上的场。
\color blue

\begin_inset Formula $\sbf e_{n}$
\end_inset

 是法线方向，指向求解区域外侧
\color inherit
（从低
\begin_inset Formula $\varepsilon$
\end_inset

指向高
\begin_inset Formula $\varepsilon$
\end_inset

）。为了加上介电屏蔽条件，在边界曲面
\begin_inset Formula $\Gamma$
\end_inset

上添加一项：
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{s}\left(\phi^{s}\right) & =\frac{1}{2}\int_{\Gamma^{s}}\left[(\nabla_{t}\phi^{s})\cdot d\varepsilon\cdot(\nabla_{t}\phi^{s})\right]\dd{\Gamma}\\
 & ={\color{blue}-\frac{1}{2}\int_{\Gamma^{s}}\left[\phi^{s}\,(\nabla_{t}\cdot d\epsilon_{0}\nabla_{t})\,\phi^{s}\right]\dd{\Gamma}}+{\color{brown}\int_{C^{\ell}}\phi^{\ell}\,\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})\dd{C}}
\end{align*}

\end_inset

其中：
\begin_inset Formula $\nabla_{t}$
\end_inset

表示沿着曲面切向的导数，即曲面上的局部坐标基矢
\begin_inset Formula $(\partial_{x},\partial_{y})$
\end_inset

；
\begin_inset Formula $\sbf e_{n}^{\ell}$
\end_inset

 是曲线
\begin_inset Formula $C$
\end_inset

的法向单位矢量。此外，上式使用了“曲面上的格林公式”
\begin_inset Formula $\int_{\Gamma}\left(\frac{\partial Q}{\partial x}-\frac{\partial P}{\partial y}\right)\dd{x}\dd{y}=\oint_{C}P\dd{x}+Q\dd{y}$
\end_inset

。
\end_layout

\begin_layout Example
如此，
\begin_inset Formula $\mathcal{F}^{e}\left(\phi^{e}\right)+\mathcal{F}^{s}\left(\phi^{s}\right)$
\end_inset

 的变分，将给出对应的电势场方程和边界条件为
\begin_inset Formula 
\begin{align}
-\nabla\cdot\left(\epsilon_{0}\nabla\phi\right)+\beta\phi=f\nonumber \\
{\color{blue}\sbf e_{n}\cdot(\epsilon_{0}\cdot\nabla\phi^{s})-(\nabla_{t}\cdot d\epsilon_{0}\nabla_{t})\,\phi^{s}=0} & \quad\text{在交界曲面上}\label{eq:di-screen3}\\
\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})=0 & \quad\text{在曲面的边界上}\nonumber 
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:di-screen3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的负号，是由于约定与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:screen"
plural "false"
caps "false"
noprefix "false"

\end_inset

相反；
\begin_inset Formula $\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})=0$
\end_inset

 类似于自然边界条件，物理含义是：在交界面的某边界线
\begin_inset Formula $C$
\end_inset

上，电位移
\begin_inset Formula $\sbf D$
\end_inset

沿曲线的法向分量为零（此法线平行主法线
\begin_inset Formula $\sbf N$
\end_inset

，后者指向曲线的转动方向）。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
考虑二维情形。设求解区域为
\begin_inset Formula $\Gamma$
\end_inset

，
\begin_inset Formula $\Gamma$
\end_inset

的边界曲线记作
\begin_inset Formula $C=\partial\Gamma$
\end_inset

，
\begin_inset Formula $C$
\end_inset

的两个端点记作
\begin_inset Formula $p_{1}$
\end_inset

，
\begin_inset Formula $p_{2}$
\end_inset

。通常情况下，静电场的泊松方程的泛函写作
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{s}\left(\phi^{s}\right) & =\frac{1}{2}\int_{\Gamma^{s}}\left[(\nabla\phi^{s})\cdot\epsilon_{0}\cdot(\nabla\phi^{s})+\beta\phi^{s;2}-f\phi^{s}\right]\dd{\Gamma}\\
 & =\frac{1}{2}\int_{\Gamma^{s}}\left[-\phi^{s}\cdot(\epsilon_{0}\nabla^{2})\phi^{s}+\beta\phi^{s;2}-f\phi^{s}\right]\dd{\Gamma}+{\color{blue}\int_{C^{\ell}}\phi^{\ell}\,\sbf e_{n}^{\ell}\cdot(\epsilon_{0}\cdot\nabla\phi^{\ell})\dd{C}}
\end{align*}

\end_inset

其中
\begin_inset Formula $\nabla=(\partial_{x},\partial_{y})$
\end_inset

是二维平面上的梯度算符。
\begin_inset Formula ${\color{blue}\int_{C^{\ell}}\cdots\dd{C}}$
\end_inset

 给出边界条件项，
\begin_inset Formula $\phi^{\ell}$
\end_inset

表示边界曲线
\begin_inset Formula $C$
\end_inset

上的场，
\begin_inset Formula $\sbf e_{n}^{\ell}$
\end_inset

 是曲线
\begin_inset Formula $C$
\end_inset

的法向单位矢量，
\color blue
指向求解区域外侧
\color inherit
（从低
\begin_inset Formula $\varepsilon$
\end_inset

指向高
\begin_inset Formula $\varepsilon$
\end_inset

）。为了加上介电屏蔽条件，在边界曲线
\begin_inset Formula $C$
\end_inset

上添加一项：
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{\ell}\left(\phi^{\ell}\right) & =\frac{1}{2}\int_{C^{\ell}}\left[(\partial_{t}\phi^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}\phi^{\ell})\right]\dd{C}\\
 & =-{\color{blue}\frac{1}{2}\int_{C^{\ell}}\left[\phi^{\ell}\,\left(\partial_{t}\cdot d\epsilon_{0}\,\partial_{t}\right)\,\phi^{\ell}\right]\dd{C}}+{\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}
\end{align*}

\end_inset

其中：
\begin_inset Formula $\partial_{t}$
\end_inset

表示沿曲线
\begin_inset Formula $C$
\end_inset

切向的导数，
\begin_inset Formula $\partial_{t}\phi^{\ell}$
\end_inset

为实数。若曲线
\begin_inset Formula $C=C(t)$
\end_inset

（即以
\begin_inset Formula $t$
\end_inset

为参数），则
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\phi^{\ell}=\frac{\dd{x^{\mu}(t)}}{\dd{t}}\frac{\partial}{\partial x^{\mu}}\phi^{\ell},\quad x^{\mu}=x,y.
\]

\end_inset

表达式
\begin_inset Formula $\int_{C^{\ell}}\cdots\dd{C}$
\end_inset

可以参数化为对
\begin_inset Formula $t$
\end_inset

的积分。所以通过分部积分，多出一个端点项。
\end_layout

\begin_layout Example
如此，
\begin_inset Formula $\mathcal{F}^{s}\left(\phi^{s}\right)+\mathcal{F}^{\ell}\left(\phi^{\ell}\right)$
\end_inset

 的变分，将给出对应的电势场方程和边界条件为
\begin_inset Formula 
\begin{align}
-\nabla\cdot\left(\epsilon_{0}\nabla\phi\right)+\beta\phi=f\nonumber \\
{\color{blue}\sbf e_{n}^{\ell}\cdot(\epsilon_{0}\cdot\nabla\phi^{\ell})-\left(\partial_{t}\cdot d\epsilon_{0}\,\partial_{t}\right)\,\phi^{\ell}=0} & \quad\text{在交界曲线上}\label{eq:di-screen2}\\
{\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}=0 & \quad\text{在曲线的端点}\nonumber 
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:di-screen2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的负号，是由于约定与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:screen"
plural "false"
caps "false"
noprefix "false"

\end_inset

相反。如果曲线
\begin_inset Formula $C$
\end_inset

是闭合的，则认为
\begin_inset Formula ${\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}=0$
\end_inset

总是满足的？
\end_layout

\begin_layout Section
具体公式–二维
\end_layout

\begin_layout Standard
所以综上，需要在交界面的泛函 
\begin_inset Formula $\mathcal{F}^{\ell}\left(\phi^{\ell}\right)$
\end_inset

 中添加一项 
\begin_inset Formula $-\frac{1}{2}\int_{C^{\ell}}\left[(\partial_{t}\phi^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}\phi^{\ell})\right]\dd{C}$
\end_inset

。其中 
\begin_inset Formula $\partial_{t}$
\end_inset

 表示沿曲线切向的方向导数。对应的有限元方程中的系数矩阵为（
\begin_inset Formula $1/2$
\end_inset

在作变分时去掉）
\begin_inset Formula 
\[
K_{ij}^{\ell}=-\int_{C^{\ell}}(\partial_{t}N_{i}^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}N_{j}^{\ell})\dd{C}.
\]

\end_inset


\end_layout

\begin_layout Subsection
雅可比矩阵
\end_layout

\begin_layout Example
参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:curve3D"
plural "false"
caps "false"
noprefix "false"

\end_inset

。以二维平面中的曲线的线性单元为例，雅可比矩阵
\begin_inset Formula $J$
\end_inset

为（对于某一确定单元 
\begin_inset Formula $e$
\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[J\right]_{1\times2} & =\left[{\color{blue}\begin{array}{c}
\frac{\dd{\sbf r}}{\dd{\xi}}\end{array}}\right]=\left[\begin{array}{cc}
\frac{\dd{x}}{\dd{\xi}} & \frac{\dd{y}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\dd{N_{i}^{e}}}{\dd{\xi}}x_{i} & \frac{\dd{N_{i}^{e}}}{\dd{\xi}}y_{i}\end{array}\right],\quad\text{重复指标求和}\\
 & =\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}
\end{array}\right]
\end{align*}

\end_inset

注意 
\begin_inset Formula $x$
\end_inset

，
\begin_inset Formula $y$
\end_inset

并不是独立的，因为曲线是一维的。代入一阶单元表达式
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{1-\xi}{2},\quad N_{2}^{(1)}=\frac{1+\xi}{2},
\]

\end_inset

 得到
\begin_inset Formula 
\begin{align*}
\left[J\right]_{1\times2} & =\frac{1}{2}\left[\begin{array}{cc}
-1 & 1\end{array}\right]\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}
\end{array}\right]\\
 & =\frac{1}{2}\left[\begin{array}{cc}
-x_{1}+x_{2} & -y_{1}+y_{2}\end{array}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
局域坐标系
\end_layout

\begin_layout Example
从雅可比矩阵可以定义出局域坐标的三个方向（正交归一基），
\begin_inset Formula 
\begin{align*}
 & \sbf e_{1}=\frac{\dd{\sbf r}}{\dd{\xi}}/\abs{\frac{\dd{\sbf r}}{\dd{\xi}}}\\
 & \sbf e_{3}=\sbf e_{z}=(0,0,1)\\
 & \sbf e_{2}=\sbf e_{3}\times\sbf e_{1}
\end{align*}

\end_inset

约定基矢
\begin_inset Formula $\{\sbf e_{i}\}$
\end_inset

的分量写成列矩阵形式。
\end_layout

\begin_layout Example
使用局域坐标系 
\begin_inset Formula $T^{ab}=T^{ab}\left(\sbf e_{1},\sbf e_{2}\right)$
\end_inset

，实现全局坐标 
\begin_inset Formula $\sbf r=\left(x,y\right)$
\end_inset

 到二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

的转换
\begin_inset Formula 
\[
\sbf R=T^{ab}\sbf r
\]

\end_inset

坐标分量的变换式为：
\begin_inset Formula 
\[
\sbf R=S^{-1}.\left(\sbf r-\sbf r_{n}\right),\quad S^{-1}=\left[\begin{array}{c}
\sbf e_{1}^{\mathrm{T}}\\
\sbf e_{2}^{\mathrm{T}}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是局域原点的全局坐标，
\begin_inset Formula $\sbf e_{1}^{\mathrm{T}}$
\end_inset

表示分量矩阵的转置。计算
\begin_inset Formula $K_{ij}^{\ell}$
\end_inset

 矩阵需要的形函数的切向导数 
\begin_inset Formula $\frac{\dd{N_{i}^{e}}}{\dd{X}}$
\end_inset

（况且形函数也只在切线上定义）。在二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

下计算（参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jac2"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{X}} & \frac{\dd{N_{2}^{e}}}{\dd{X}}\end{array}\right] & =\left[\begin{array}{c}
\frac{\dd{\xi}}{\dd{X}}\end{array}\right]\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{c}
\frac{\dd{X}}{\dd{\xi}}\end{array}\right]^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{c}
\frac{\dd{r}}{\dd{\xi}}\cdot\sbf e_{1}\end{array}\right]^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left(\left[\begin{array}{cc}
\frac{\dd{x}}{\dd{\xi}} & \frac{\dd{y}}{\dd{\xi}}\end{array}\right]\left[\begin{array}{c}
\sbf e_{1}\end{array}\right]_{2\times1}\right)^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]
\end{align*}

\end_inset

其中使用了 
\begin_inset Formula $\dd{\sbf r}=\dd{X}\sbf e_{1}+\dd{Y}\sbf e_{2}$
\end_inset

，即矢径微元等于切线微元。
\end_layout

\begin_layout Subsection
约定和总结
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r_{j}$
\end_inset

 ：表示全局坐标，二维空间自由度 
\begin_inset Formula $j\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{j}$
\end_inset

 表示对全局坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\overline{x}_{\alpha}$
\end_inset

： 表示有限元中的采样点（node）， 
\begin_inset Formula $\alpha\in{1,2,\cdots,S}$
\end_inset

（希腊字母），线性单元
\begin_inset Formula $2$
\end_inset

个，二阶单元
\begin_inset Formula $3$
\end_inset

个等等。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $x_{p}^{\prime}$
\end_inset

 ：表示单元中二维平面的局域空间坐标 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

，
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{x}^{\prime}$
\end_inset

 表示沿曲线切向求导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\xi$
\end_inset

 ：表示曲线参数（自由度）；
\begin_inset Formula $\partial_{\xi}$
\end_inset

 表示对 
\begin_inset Formula $\xi$
\end_inset

 求导。
\end_layout

\begin_layout Enumerate
表达式右边标出了维度。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
全局空间坐标对 母坐标的雅可比行列式
\begin_inset Formula 
\begin{equation}
J_{1i}=\partial_{\xi}{\color{blue}r_{i}}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\end{array}\right]=\partial_{\xi}\,{\color{blue}N_{\alpha}\,\overline{x}_{\alpha i}},\quad[1,2]\label{eq:j-2d}
\end{equation}

\end_inset

其中 ，对于选定的单元
\begin_inset Formula $N_{\alpha}$
\end_inset

 形式已知，
\begin_inset Formula $\overline{x}_{\alpha j}$
\end_inset

 是节点坐标为已知常量，所以可直接求得
\begin_inset Formula $J_{j}$
\end_inset

 ，维数是 
\begin_inset Formula $1\times2$
\end_inset

。对于一阶单元
\begin_inset Formula 
\[
[J]_{1\times2}=\frac{1}{2}\left[\begin{array}{cc}
\Delta x & \Delta y\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\Delta x=x_{2}-x_{1}$
\end_inset

，
\begin_inset Formula $\Delta y$
\end_inset

类似。
\end_layout

\begin_layout Enumerate
局域空间坐标的三个单位正交基
\begin_inset Formula 
\begin{align*}
\sbf e_{1} & =J_{1\cdot}/\abs{J_{1\cdot}},\quad\text{点表示取整行}\\
\sbf e_{3} & =(0,0,1)\\
\sbf e_{2} & =\sbf e_{3}\times\sbf e_{1}.
\end{align*}

\end_inset

之所以按此序列构造，是为了保证 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

 是相互垂直的。求出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-2d"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $J_{j}$
\end_inset

，即可求出每个单元所属的 
\begin_inset Formula $\sbf e_{j}$
\end_inset

。可以把 
\begin_inset Formula $\left\{ \sbf e_{j}\right\} $
\end_inset

的分量写成数组形式（矩阵），分量用普通字体表示，将 
\begin_inset Formula $[e_{i}]$
\end_inset

分别填入
\color blue
每列
\color inherit
，这里只用到左上的
\begin_inset Formula $2\times2$
\end_inset

的子矩阵。
\begin_inset Formula 
\begin{equation}
E_{ij}=\left[\begin{array}{ccc}
{\color{blue}e_{1x}} & {\color{blue}e_{2x}} & \vdots\\
{\color{blue}e_{1y}} & {\color{blue}e_{2y}} & e_{3}\\
\vdots & \vdots & \vdots
\end{array}\right],\quad[3,3]\label{eq:unitV-2D}
\end{equation}

\end_inset

则 指标
\begin_inset Formula $1$
\end_inset

索引 某
\begin_inset Formula $e$
\end_inset

的分量，指标
\begin_inset Formula $2$
\end_inset

索引 
\begin_inset Formula $e_{1},e_{2},e_{3}$
\end_inset

。例如对于一阶单元
\begin_inset Formula 
\[
E_{ij}=\frac{1}{\Delta\ell}\left[\begin{array}{cc}
{\color{blue}\Delta x} & {\color{blue}-\Delta y}\\
{\color{blue}\Delta y} & {\color{blue}\Delta x}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\Delta_{\ell}=\sqrt{\Delta x^{2}+\Delta y^{2}}$
\end_inset

。
\end_layout

\begin_layout Enumerate
局域空间坐标 对 参数坐标的 雅可比矩阵：
\begin_inset Formula 
\begin{equation}
L_{1q}=\partial_{\xi}\,x_{q}^{\prime}=\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\end{array}\right]=J_{1j}\,E_{jq},\quad[1,2]\label{eq:j-loc-2D}
\end{equation}

\end_inset


\begin_inset Formula $j,q=1,2$
\end_inset

， 
\begin_inset Formula $J$
\end_inset

 和 
\begin_inset Formula $E$
\end_inset

 分别在 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-2d"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:unitV-2D"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中求出，注意 
\begin_inset Formula $E$
\end_inset

 只取用 前
\begin_inset Formula $2\times2$
\end_inset

。对于一阶单元
\begin_inset Formula 
\[
L_{1q}=\frac{1}{2}\left[\begin{array}{cc}
\Delta\ell & 0\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Enumerate
形函数 对 局域空间坐标 的梯度
\begin_inset Formula 
\[
{\color{blue}\partial_{X}^{\prime}}\,N_{\alpha}={\color{blue}L_{11}^{-1}\,\partial_{\xi}}N_{\alpha},\quad[1,S]
\]

\end_inset

其中
\begin_inset Formula $S$
\end_inset

是节点的总数，
\begin_inset Formula $L^{-1}$
\end_inset

是 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-loc-2D"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的逆，这里只需元素
\begin_inset Formula $(1,1)$
\end_inset

。例如对于一阶单元
\begin_inset Formula 
\[
{\color{blue}\partial_{X}^{\prime}}\,N_{\alpha}=\frac{1}{\Delta\ell}\left[\begin{array}{cc}
-1 & 1\end{array}\right]
\]

\end_inset

至此，切向导数
\begin_inset Formula $\partial_{t}N_{i}^{\ell}$
\end_inset

 已求出。
\end_layout

\begin_layout Enumerate
计算均在
\begin_inset Formula $\xi$
\end_inset

参数轴上进行，即坐标变换步骤为：全局系的曲线
\begin_inset Formula $\Rightarrow$
\end_inset

局域系的直线
\begin_inset Formula $\Rightarrow$
\end_inset

参数系的直线，最后需在 
\begin_inset Formula $\xi$
\end_inset

 参数轴上积分：
\begin_inset Formula 
\begin{align*}
[K_{ij}^{\ell}] & =-\int_{C^{\ell}}(\partial_{t}N_{i}^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}N_{j}^{\ell})\dd{C}\\
 & =-\int_{-1}^{1}\frac{d\epsilon_{0}}{\Delta\ell^{2}}\left[\begin{array}{cc}
1 & -1\\
-1 & 1
\end{array}\right]\,\frac{\Delta\ell}{2}\dd{\xi}\\
 & =\frac{-d\epsilon_{0}}{\Delta\ell}\left[\begin{array}{cc}
1 & -1\\
-1 & 1
\end{array}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Section
Galerkin方法
\end_layout

\begin_layout Enumerate
边界条件为
\begin_inset Formula 
\[
\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\sbf e_{n}\cdot\sbf D=0
\]

\end_inset


\end_layout

\begin_layout Enumerate
求解区域为 
\begin_inset Formula $\Omega$
\end_inset

，区域边界
\begin_inset Formula $\Gamma=\partial\Omega$
\end_inset

，边界的边界
\begin_inset Formula $C=\partial\Gamma$
\end_inset

。
\end_layout

\begin_layout Enumerate
仿照Galerkin方法通常情况的微分方程 
\begin_inset Formula $\nabla\cdot\left(\sbf D\right)-\rho=0$
\end_inset

，给出介电屏蔽条件对应的残差；在求解区域的边界
\begin_inset Formula $\Gamma$
\end_inset

上，加上残差项：
\begin_inset Formula 
\[
R^{e}\left[N_{i}^{e}\right]=\int_{\Gamma^{e}}N_{i}^{e}\left[\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\sbf e_{n}\cdot\sbf D\right]\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Enumerate
例如对于三维问题，不同介质交界面是二维 
\begin_inset Formula $\Gamma^{e}$
\end_inset

，边界的边界是曲线
\begin_inset Formula $C^{e}$
\end_inset

；类似地，先用分部积分转移
\begin_inset Formula $\nabla$
\end_inset

，再使用二维情况下的散度定理，最终得到：
\begin_inset Formula 
\[
\int_{\Gamma^{e}}{\color{blue}\left(\nabla_{t}N_{i}^{e}\right)\cdot d\,\sbf D_{t}}\dd{\Gamma}=\int_{C^{e}}{\color{brown}N_{i}^{e}d\,\sbf D_{t}\cdot\sbf s_{n}}\dd{C}+\int_{\Gamma^{e}}N_{i}^{e}\sbf\,e_{n}\cdot\sbf D\dd{\Gamma}
\]

\end_inset

其中
\begin_inset Formula $\sbf e_{n}$
\end_inset

是 
\begin_inset Formula $\Gamma^{e}$
\end_inset

（二维单元）的法向单位矢量，
\begin_inset Formula $\sbf s_{n}$
\end_inset

 是
\begin_inset Formula $C^{e}$
\end_inset

（一维单元）的法向单位矢量。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
电流场中的介电屏蔽条件
\end_layout

\begin_layout Chapter
网格，几何
\end_layout

\begin_layout Section
IBEMesh 单元Face法向
\end_layout

\begin_layout Itemize
搭建正方体几何的测试案例，剖分成6个四面体单元。
\end_layout

\begin_layout Itemize
Simdroid UI 上，单元，节点，面的编号都是 1–based；mesh.dat，mesh.h5 中是 0–based。
\end_layout

\begin_layout Itemize
以第
\begin_inset Formula $5$
\end_inset

个单元为例，mesh.dat 中给出体
\begin_inset Formula $\to$
\end_inset

节点：
\begin_inset Formula $4\;[7,4,0,5]$
\end_inset

；也就是对应 UI 上 
\begin_inset Formula $5\;[8,5,1,6]$
\end_inset

。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
t$Sty = Style[#, Red] &; delta = 0.05; Graphics3D[{ Line[{{1, 0, 0}, {0,
 1, 0}, {0, 0, 1}, {1, 0, 0}}] , Line[{{1, 0, 0}, {0, 0, 0}, {0, 1, 0}}]
 , Line[{{0, 0, 1}, {0, 0, 0}}] , FontSize -> 13 , t$Sty@Text[6, {1 + 3
 delta, 2 delta, 0}], t$Sty@Text[1, {2 delta, 1 + 3 delta, 0}] , t$Sty@Text[8,
 {1 delta, 1 delta, 1 + 0 delta}] , t$Sty@Text[5, {+2 delta, -delta, +2
 delta}]} , Axes -> True, AxesOrigin -> {0, 0, 0} , AxesStyle -> Arrowheads[{0.07
}] , AxesLabel -> {"
\backslash
[Xi]1", "
\backslash
[Xi]2", "
\backslash
[Xi]3"} , Ticks -> None , PlotRangePadding -> {Scaled[.0], Scaled[.0], Scaled[.0]},
 ImageSize -> Medium, Boxed -> False]
\end_layout

\end_inset


\end_layout

\begin_layout Itemize
mesh.dat 中相关的 boundary face 的编号是 
\begin_inset Formula $6\;[4,5,7,4]$
\end_inset

，
\begin_inset Formula $13\;[4,0,5,4]$
\end_inset

；对应 UI 中的 
\begin_inset Formula $7\;[5,6,8,5]$
\end_inset

，
\begin_inset Formula $14\;[5,1,6,5]$
\end_inset

。第四位是face所属单元编号，前三位是节点编号，从图中可见，
\series bold
face的法向都指向单元外部
\series default
。
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ibe-normal-test.pdf
	lyxscale 60
	scale 35

\end_inset


\end_layout

\begin_layout Chapter
Mortor单元法
\end_layout

\begin_layout Section
Mortor连续条件
\end_layout

\begin_layout Standard
Mortar元法(mortar element method, MEM)是一种新型区域分解算法，它允许将求解区域分解为多个子域，在各个区域以最适合子域特征的方式
离散。在各个区域的交界面上，
\series bold
边界节点不要求逐点匹配
\series default
，而是通过建立加权积分形式的 Mortar条件使得交界面上的传递条件在分布意义上满足。 Mortar有限元法(mortar finite element
 method, MFEM)将 MEM 和有限元法(finite element method, FEM)相结合，在各区域中分别使用 FEM 网格离散，区域的交
界面上通过施加 Mortar条件实现区域间的自由度连续。根据子域网格位置关系的不同，MFEM 也可以分为重叠型 和非重叠型两种，本文只讨论非重叠
 MFEM(non- overlapping mortar finite element method, NO-MFEM)的基本原理和实现。
\end_layout

\begin_layout Standard
与传统 FEM 不同，MFEM 将求解区域分为多个子域，若 2 个子域的交集仅为以下情况之一：空集、 2 个区域的顶点、为整条边(面)，则称这种区域分解
 是几何协调的，否则是几何非协调的，如 图 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor1"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示。
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fem-mortor1.png
	lyxscale 80
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
左边是几何协调分解；右边是几何非协调分解。
\begin_inset CommandInset label
LatexCommand label
name "fig:mortor1"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
在几何协调的情况下，具体到网格时，又可以分成
\series bold
网格协调
\series default
和
\series bold
网格非协调
\series default
。网格协调是指不同区域间的公共面/边上，网格的节点是重合的，也就是共节点的概念。相应地，非协调是指两区域的公共面/边上，网格节点可以不重合，如图
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fem-mortor2.png
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
左边是协调网格；右边是非协调网格。
\begin_inset CommandInset label
LatexCommand label
name "fig:mortor2"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
对于图 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)中的非协调网格，需要用各个子域的解逼近全域解，关键是解决 内交界面 上节点自由度的连续问题。在 NO-MFEM 中，交界面的连续条件通过选择非
 Mortar 侧（从边）的有限元空间在交界面上的迹空间作为拉格朗日乘子空间，强制满足 Mortar 条件。例如对于图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)所示的区域 
\begin_inset Formula $m$
\end_inset

 的网格
\begin_inset Formula $\mathcal{T}_{m}$
\end_inset

和区 域 
\begin_inset Formula $n$
\end_inset

 的网格
\begin_inset Formula $\mathcal{T}_{n}$
\end_inset

，两套网格节点自由度在区域交界面
\begin_inset Formula $\Gamma_{mn}$
\end_inset

上满足
\begin_inset Formula 
\begin{equation}
\int_{\Gamma_{mn}^{-}}\mu\,u\,\dd{\Gamma}=\int_{\Gamma_{mn}^{-}}\mu\,v\,\dd{\Gamma}\label{eq:mo8}
\end{equation}

\end_inset

式中：
\begin_inset Formula $u$
\end_inset

 表示非 Mortar边（从边）的未知函数；
\begin_inset Formula $v$
\end_inset

 表示 Mortar 边（主边）的未知函数；
\begin_inset Formula $\mu$
\end_inset

表示试探函数。对
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo8"
plural "false"
caps "false"
noprefix "false"

\end_inset

离散可得矩阵形式的 Mortar连续条件，即 
\begin_inset Formula 
\begin{equation}
Cu=Dv\label{eq:mo9}
\end{equation}

\end_inset

将非Mortar边的节点自由度
\begin_inset Formula $u$
\end_inset

作为从节点自由 度，用 Mortar 边的主节点自由度 
\begin_inset Formula $v$
\end_inset

表示，即 
\begin_inset Formula 
\begin{equation}
u=C^{-1}D\,v=Qv\label{eq:mo10}
\end{equation}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo9"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo10"
plural "false"
caps "false"
noprefix "false"

\end_inset

中：系数矩阵 
\begin_inset Formula $C$
\end_inset

、
\begin_inset Formula $D$
\end_inset

 为中间矩阵；
\begin_inset Formula $Q$
\end_inset

 为 MEM 交界面连续条件矩阵。
\end_layout

\end_body
\end_document
