#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass ctex-book
\begin_preamble
\input{math-preamble}
\end_preamble
\options UTF8,dvipsnames,svgnames,x11names,hyperref,colorlinks=true
\use_default_options true
\begin_modules
theorems-ams-chap-bytype
graphicboxes
\end_modules
\maintain_unincluded_children false
\language chinese-simplified
\language_package none
\inputencoding utf8-plain
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures false
\graphics default
\default_output_format pdf4
\output_sync 0
\bibtex_command default
\index_command default
\float_placement H
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 2
\use_package amssymb 2
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
数学笔记
\end_layout

\begin_layout Author
Young
\end_layout

\begin_layout Chapter
预备知识
\end_layout

\begin_layout Section
范德蒙德行列式
\end_layout

\begin_layout Standard
ref: 
\begin_inset CommandInset href
LatexCommand href
name "范德蒙行列式"
target "https://zhuanlan.zhihu.com/p/161300510"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
范德蒙德行列式的形式：
\begin_inset Formula 
\[
D=\left[\begin{array}{ccccc}
1 & 1 & 1 & \cdots & 1\\
x_{1} & x_{2} & x_{3} & \cdots & x_{n}\\
x_{1}^{2} & x_{2}^{2} & x_{3}^{2} & \cdots & x_{n}^{2}\\
\cdots & \cdots & \cdots & \cdots & \cdots\\
x_{1}^{n-2} & x_{2}^{n-2} & \cdots & \cdots & x_{n}^{n-2}\\
x_{1}^{n-1} & x_{2}^{n-1} & \cdots & \cdots & x_{n}^{n-1}
\end{array}\right]
\]

\end_inset

遇到类似于上式的行列式时，可以使用范德蒙行列式公式计算：
\begin_inset Formula 
\[
\prod_{n\ge i\ge j\ge1}=(x_{i}-x_{j})
\]

\end_inset

即行列式
\begin_inset Formula $D$
\end_inset

的值为所有
\begin_inset Formula $(x_{i}-x_{j})$
\end_inset

 的乘积，其中
\begin_inset Formula $i>j$
\end_inset

。
\end_layout

\begin_layout Standard
例如
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
1 & 1 & 1\\
x_{1} & x_{2} & x_{3}\\
x_{1}^{2} & x_{2}^{2} & x_{3}^{2}
\end{array}\right]=\left(x_{2}-x_{1}\right)\left(x_{3}-x_{1}\right)\left(x_{3}-x_{2}\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
证明范德蒙行列式
\end_layout

\begin_layout Standard
通过观察范德蒙行列式，拿行列式的第一列来说，相邻的两个元素，上面的元素比下面的元素少乘一次 
\begin_inset Formula $x_{1}$
\end_inset

。根据这一特征，可以试着从第 
\begin_inset Formula $n$
\end_inset

 行开始，每个元素都减去前一行元素的 
\begin_inset Formula $x_{1}$
\end_inset

 倍，则可以提取出公因式
\begin_inset Formula 
\[
\left(x_{2}-x_{1}\right)\left(x_{3}-x_{1}\right)\cdots\left(x_{n}-x_{1}\right)\times\left[\begin{array}{cccc}
1 & 1 & \cdots & 1\\
x_{2} & x_{3} & \cdots & x_{n}\\
\cdots & \cdots & \cdots & \cdots\\
x_{2}^{n-3} & \cdots & \cdots & x_{n}^{n-3}\\
x_{2}^{n-2} & \cdots & \cdots & x_{n}^{n-2}
\end{array}\right]
\]

\end_inset

于是又产生了范德蒙德行列式，可以递归进行下去。因此得到公式
\begin_inset Formula 
\[
D=\prod_{n\ge i\ge j\ge1}=(x_{i}-x_{j}).
\]

\end_inset


\end_layout

\begin_layout Section
线搜索方法 Line search
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "线搜索(line search)方法"
target "https://www.cnblogs.com/kemaswill/p/3416231.html"
literal "false"

\end_inset

;
\end_layout

\begin_layout Standard
Numerical Optimization, Chapter 3, p35-p42.
 J.
 Nocedal, S.Wright.
\end_layout

\begin_layout Standard
在机器学习中, 通常需要求某个函数的最值(比如 最大似然中 需要求的 似然的最大值)。线搜索(line search)是求得一个函数
\begin_inset Formula $f(x)$
\end_inset

的最值的两种常用迭代方法之一(另外一个是 trust region)。其思想是首先求得一个下降方向,在这个方向上
\begin_inset Formula $f(x)$
\end_inset

会下降，然后是求得
\begin_inset Formula $f(x)$
\end_inset

在这个方向上下降的步长。求下降方向的方法有很多，比如梯度下降，牛顿方法 和 Quasi-Newton 方法, 而步长可以是固定值，也可以通过诸如回溯线搜索来求得
。
\end_layout

\begin_layout Subsection
线搜索
\end_layout

\begin_layout Standard
线搜索 是一种迭代的求得某个函数的最值的方法。 对于每次迭代, 线搜索会计算得到搜索的方向 
\begin_inset Formula $p_{k}$
\end_inset

 以及沿这个方向移动的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

。迭代过程可以表示为
\begin_inset Formula 
\begin{equation}
x_{k+1}=x_{k}+\alpha_{k}p_{k},\label{eq:w3.1}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\alpha_{k}$
\end_inset

 是正值标量，称为步长（step length）。线搜索的成功取决于方向 
\begin_inset Formula $p_{k}$
\end_inset

 和 步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 的有效选择。
\end_layout

\begin_layout Standard
大多数的线搜索方法都会要求 
\begin_inset Formula $p_{k}$
\end_inset

 是下降方向(descent direction)，亦即需要满足以下条件： 
\begin_inset Formula 
\[
p_{k}^{T}.\nabla f_{k}<0,
\]

\end_inset

这样就能够保证函数f(x)沿着这个方向是下降的。一般来说, 搜索方向的形式为
\begin_inset Formula 
\begin{equation}
p_{k}=-B_{k}^{-1}.\nabla f_{k},\label{eq:w3.2}
\end{equation}

\end_inset

其中 
\begin_inset Formula $B_{k}$
\end_inset

 是对称的非奇异矩阵。在最陡下降(steepest descent)方法中，
\begin_inset Formula $B_{k}$
\end_inset

是单位矩阵
\begin_inset Formula $I$
\end_inset

, 在牛顿方法(Newton)中
\begin_inset Formula $B_{k}$
\end_inset

 则是海森(Hessian)矩阵
\begin_inset Formula $\nabla^{2}f\left(x_{k}\right)$
\end_inset

，在 Quasi-Newton方法中通过迭代求得 Hessian 矩阵的近似矩阵。
\end_layout

\begin_layout Standard
当 
\begin_inset Formula $p_{k}$
\end_inset

 由上式定义, 且 
\begin_inset Formula $B_{k}$
\end_inset

 是正定矩阵时：
\begin_inset Formula 
\[
p_{k}^{T}\nabla f_{k}=-\nabla f_{k}^{T}.B_{k}^{-1}.\nabla f_{k}<0
\]

\end_inset

所以 
\begin_inset Formula $p_{k}$
\end_inset

 是下降方向(descent direction)。
\end_layout

\begin_layout Subsection
步长
\end_layout

\begin_layout Standard
步长 
\begin_inset Formula $\alpha$
\end_inset

 应该最小化下列函数
\begin_inset Formula 
\begin{equation}
\phi\left(\alpha\right)=f\left(x_{k}+\alpha p_{k}\right),\quad\alpha>0\label{eq:w3.3}
\end{equation}

\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.2.png
	lyxscale 50
	scale 45

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
在 
\begin_inset Formula $f$
\end_inset

 上不充分的下降。
\begin_inset Formula $f\left(x_{k}\right)=5/k$
\end_inset

, 
\begin_inset Formula $k=0,1,\cdots$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

但是 全局最小值对应的 
\begin_inset Formula $\alpha$
\end_inset

 比较困难，且计算量比较大，实际常用的方法是在可接受的计算量的情况下尽可能的求得较大的步长， 以使得 
\begin_inset Formula $\phi\left(\alpha\right)$
\end_inset

尽可能的降低。经典的线搜索方法通过迭代来求得
\begin_inset Formula $\alpha$
\end_inset

，直至达到某个停止条件。一般的线搜索方法都包含以下两个步骤：
\end_layout

\begin_layout Enumerate
bracketing: 求得一个包含 理想步长 的区间 
\end_layout

\begin_layout Enumerate
二分法或者插值法：在这个区间内使用二分法或者插值法来求得步长。
\end_layout

\begin_layout Subsection
对于凸函数的二分搜索算法
\end_layout

\begin_layout Standard
ref：
\begin_inset CommandInset href
LatexCommand href
name "凸函数定义"
target "https://zhuanlan.zhihu.com/p/56876303"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
如果 
\begin_inset Formula $f(x)$
\end_inset

 是一个可微分的凸函数, 即
\end_layout

\begin_layout Enumerate
函数 
\begin_inset Formula $f$
\end_inset

 的定义域 
\begin_inset Formula $\mathrm{dom}f$
\end_inset

 是一个凸集；
\end_layout

\begin_layout Enumerate
满足 
\begin_inset Formula $f\left[\theta x+\left(1-\theta\right)y\right]\le\theta f\left(x\right)+\left(1-\theta\right)f\left(y\right),\quad\theta\in\left(0,1\right)$
\end_inset


\end_layout

\begin_layout Standard
其函数图像类似 
\begin_inset Formula $x^{2}$
\end_inset

，定义域中任意两点连线组成的线段都在这两点的函数曲线上方。如果 
\begin_inset Formula $f(\vec{x})$
\end_inset

 是凸函数，则函数 
\begin_inset Formula $g(t)=f(\vec{x}+t\vec{v})$
\end_inset

 也是其定义域内的凸函数。
\end_layout

\begin_layout Standard
我们的目标是求得 
\begin_inset Formula $\alpha$
\end_inset

, 使得 
\begin_inset Formula 
\[
\alpha=\mathrm{arg}\min_{\lambda>0}f\left(x+\lambda p\right)
\]

\end_inset

在每一步迭代中我们令 
\begin_inset Formula $\phi(\alpha)=f\left(x_{k}+\alpha p_{k}\right)$
\end_inset

，
\begin_inset Formula $x_{k}$
\end_inset

是搜索起点，
\begin_inset Formula $p_{k}$
\end_inset

是梯度下降方向。其中 
\begin_inset Formula $\phi(\alpha)$
\end_inset

 是 
\begin_inset Formula $\alpha$
\end_inset

 的凸函数, 所以问题转化为求: 
\begin_inset Formula 
\[
\overline{\alpha}=\mathrm{arg}\min_{\alpha>0}\phi\left(\alpha\right)
\]

\end_inset


\end_layout

\begin_layout Itemize
因为 
\begin_inset Formula $\phi(\alpha)$
\end_inset

 是凸函数，所以 
\begin_inset Formula $\phi'(\overline{\alpha})=0$
\end_inset

。
\end_layout

\begin_layout Itemize
可以得到 
\begin_inset Formula $\phi'(\alpha)=\left[\nabla f\left(x+\alpha p\right)\right]^{T}.p$
\end_inset

，因为
\begin_inset Formula $p$
\end_inset

是梯度下降方向，满足 
\begin_inset Formula $p_{k}^{T}.\nabla f_{k}<0$
\end_inset

，所以 
\begin_inset Formula $\phi'(0)<0$
\end_inset

。
\end_layout

\begin_layout Standard
假设我们知道一个 
\begin_inset Formula $\beta$
\end_inset

 使得 
\begin_inset Formula $\phi'(\beta)>0$
\end_inset

，那么使得 
\begin_inset Formula $\phi'(\overline{\alpha})=0$
\end_inset

 的 
\begin_inset Formula $\alpha$
\end_inset

 肯定位于 
\begin_inset Formula $(0,\beta)$
\end_inset

 区间内。然后我们可以使用以下二分查找算法来求解 
\begin_inset Formula $\phi'(\alpha)\approx0$
\end_inset

。
\end_layout

\begin_layout Enumerate
令 
\begin_inset Formula $k=0$
\end_inset

，
\begin_inset Formula $\alpha_{\ell}\coloneqq0$
\end_inset

，
\begin_inset Formula $\alpha_{r}:=\beta$
\end_inset

；即 
\begin_inset Formula $\phi'(\alpha_{\ell})<0$
\end_inset

，
\begin_inset Formula $\phi'(\alpha_{r})>0$
\end_inset

。
\end_layout

\begin_layout Enumerate
令 
\begin_inset Formula $\overline{\alpha}=\frac{\alpha_{\ell}+\alpha_{r}}{2}$
\end_inset

，然后计算 
\begin_inset Formula $\phi'(\tilde{\alpha})$
\end_inset

：
\end_layout

\begin_deeper
\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\overline{\alpha})>0$
\end_inset

，则令 
\begin_inset Formula $\alpha_{r}\coloneqq\overline{\alpha}$
\end_inset

，
\begin_inset Formula $\alpha_{\ell}$
\end_inset

不变，令 
\begin_inset Formula $k\to k+1$
\end_inset


\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\overline{\alpha})<0$
\end_inset

，则令 
\begin_inset Formula $\alpha_{\ell}\coloneqq\overline{\alpha}$
\end_inset

，
\begin_inset Formula $\alpha_{r}$
\end_inset

不变，令 
\begin_inset Formula $k\to k+1$
\end_inset


\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\overline{\alpha})=0$
\end_inset

, 停止迭代。
\end_layout

\end_deeper
\begin_layout Subsection
回溯线搜索 backtracking line search
\end_layout

\begin_layout Standard
使用二分查找法来求步长的计算复杂度很高，因为在最小化 
\begin_inset Formula $f(x)$
\end_inset

 的每次迭代中我们都需要执行一次线搜索,，而每次线搜索都要用上述的二分查找算法。我们可以在牺牲一定的精度的条件下来加快计算速度，回溯线搜索是一种近似线搜索算法。
\end_layout

\begin_layout Standard
首先，我们要求每次的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 都使得
\begin_inset Formula $f(x)$
\end_inset

充分的降低：
\begin_inset Formula 
\begin{equation}
f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k}\label{eq:w3.4}
\end{equation}

\end_inset

上述条件称作充分下降条件，其中 
\begin_inset Formula $c_{1}\in(0,1)$
\end_inset

，一般来说 
\begin_inset Formula $c_{1}=10^{-4}$
\end_inset

。亦即 
\begin_inset Formula $f(x)$
\end_inset

 的下降应该至少和 
\begin_inset Formula $\alpha_{k}$
\end_inset

 以及 
\begin_inset Formula $\nabla f_{k}^{T}p_{k}$
\end_inset

 成正比。如下图所示, 上式的右边 
\begin_inset Formula $f(x_{k})+c_{1}\alpha\nabla f_{k}^{T}p_{k}$
\end_inset

 是线性函数, 可以表示为 
\begin_inset Formula $\ell(\alpha)$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.3.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
充分下降条件
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.3"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
充分下降条件规定只有使得 
\begin_inset Formula $\phi(\alpha)\le\ell(\alpha)$
\end_inset

 的 
\begin_inset Formula $\alpha$
\end_inset

 才满足条件。其区间如上图所示。
\end_layout

\begin_layout Standard
单独只有充分下降条件是不够的，因为如上图，所有充分小的 
\begin_inset Formula $\alpha$
\end_inset

 都满足上述条件，但是 
\begin_inset Formula $\alpha$
\end_inset

 太小会导致下降不充分, 为了排除这些小的 
\begin_inset Formula $\alpha$
\end_inset

，我们引入了第二个要求，亦即曲率条件(curvature condition)：
\begin_inset Formula 
\[
\nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k}
\]

\end_inset

其中 
\begin_inset Formula $c_{2}\in\left(c_{1},1\right)$
\end_inset

。上式的左边就是 
\begin_inset Formula $\phi'(\alpha_{k})$
\end_inset

，右边则是 
\begin_inset Formula $\phi'(0)$
\end_inset

，即上式相当于
\begin_inset Formula 
\[
\phi'(\alpha_{k})\ge c_{2}\phi'(0).
\]

\end_inset

这是因为如果 
\begin_inset Formula $\phi'(\alpha)$
\end_inset

 是很小的负数（下降得非常陡峭），则我们可以在这个方向上继续使得 
\begin_inset Formula $f(x)$
\end_inset

下降更多.
 如下图所示
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.4.png
	lyxscale 50
	scale 50

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
曲率条件（curvature condition）
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.4"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Typical values of 
\begin_inset Formula $c_{2}$
\end_inset

 are 
\begin_inset Formula $0.9$
\end_inset

 when the search direction 
\begin_inset Formula $p_{k}$
\end_inset

 is chosen by a Newton or quasi-Newton method, and 
\begin_inset Formula $0.1$
\end_inset

 when 
\begin_inset Formula $p_{k}$
\end_inset

 is obtained from a nonlinear conjugate gradient method。上述两个条件合起来称作 Wolfe
 条件：
\begin_inset Formula 
\begin{align}
 & f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k},\label{eq:w3.6a}\\
 & \nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k},\label{eq:w3.6b}
\end{align}

\end_inset

其中 
\begin_inset Formula $0<c_{1}<c_{2}<1$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.5.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
满足 Wolfe 条件的步长。
\begin_inset CommandInset label
LatexCommand label
name "fig:w-3.5"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
满足 Wolfe 条件的 步长 不一定离 
\begin_inset Formula $\phi$
\end_inset

 的极值点很近，如 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:w-3.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

。但是可以修改 curvature condition，来让 
\begin_inset Formula $\alpha_{k}$
\end_inset

 至少位于 
\begin_inset Formula $\phi$
\end_inset

 的 local minimizer 或 stationary point 附近。strong Wolfe condition 要求 
\begin_inset Formula $\alpha_{k}$
\end_inset

 满足：
\begin_inset Formula 
\begin{align}
 & f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k},\label{eq:w3.7a}\\
 & \nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k},\label{eq:w3.7b}
\end{align}

\end_inset

其中 
\begin_inset Formula $0<c_{1}<c_{2}<1$
\end_inset

。
\end_layout

\begin_layout Standard
对于任意光滑且有下界（smooth and bounded below）函数
\begin_inset Formula $f$
\end_inset

，不难证明存在满足 Wolfre 条件的步长。
\end_layout

\begin_layout Lemma
Suppose that 
\begin_inset Formula $f:\symbb R^{n}\to\symbb R$
\end_inset

 is continuously differentiable.
 Let pk be a descent direction at xk, and assume that f is bounded below
 along the ray 
\begin_inset Formula $\left\{ x_{k}+\alpha p_{k}|\alpha>0\right\} $
\end_inset

。Then if 
\begin_inset Formula $0<c1<c2<1$
\end_inset

, there exist intervals of step lengths satisfying the Wolfe conditions
 (3.6) and the strong Wolfe conditions 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.7a"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
Wolfe条件 在广义上是标度不变的（scale-invariant）。将目标函数乘以常数，或对变量进行仿射变换（affine）都不会改变它们。它们可以用在大多
数线搜索方法中，而且在实现准牛顿方法中特别重要，正如我们在第六章中看到的那样。
\end_layout

\begin_layout Subsection
Goldstein 条件
\end_layout

\begin_layout Standard
与 Wolfe条件 一样，Goldstein条件 确保步长 
\begin_inset Formula $\alpha$
\end_inset

 足够小，但不会太短。Goldstein条件 也可以被表述为一对不等式，具体方式如下：
\begin_inset Formula 
\begin{equation}
f(x_{k})+{\color{blue}(1-c)\alpha_{k}}\nabla f_{k}^{T}p_{k}\le f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+{\color{blue}c\alpha_{k}}\nabla f_{k}^{T}p_{k},\label{eq:w3.11}
\end{equation}

\end_inset

其中 
\begin_inset Formula $0<c<1/2$
\end_inset

。第二个不等式正是充分下降条件
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:w3.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

，并引入第一个不等式来控制 步长的下限。见图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:w3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.6.png
	lyxscale 50
	scale 50

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
The Goldstein conditions.
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.6"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
Goldstein条件 相对于Wolfe条件 的一个缺点是，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:w3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的第一个不等式可能会排除 
\begin_inset Formula $\phi$
\end_inset

 的所有极小值点（minimizers）。 然而，Goldstein和Wolfe条件有很多共同点，它们的收敛理论也非常相似。Goldstein条件
 经常用于牛顿型方法，但不太适合于保持 正定Hessian近似 的 准牛顿方法。
\end_layout

\begin_layout Remark
充分下降条件和回溯算法(BACKTRACKING)
\end_layout

\begin_layout Standard
我们已经提到，仅仅是充分减少条件
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.6a"
plural "false"
caps "false"
noprefix "false"

\end_inset

 并不足以确保，算法沿着给定的搜索方向取得合理的下降。 然而，如果 线搜索 算法适当地选择其候选步长，通过使用所谓的 回溯方法（backtracking
 approach），我们可以省去 额外的条件
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.6b"
plural "false"
caps "false"
noprefix "false"

\end_inset

，只使用 充分下降条件 来终止 线搜索 程序。在其最基本的形式中，回溯法的过程如下。
\end_layout

\begin_layout Example
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
算法3.1
\end_layout

\end_inset

 回溯线搜索Backtracking Line Search
\end_layout

\begin_layout Enumerate
选取 
\begin_inset Formula $\overline{\alpha}>0$
\end_inset

，
\begin_inset Formula ${\color{blue}\rho\in(0,1)}$
\end_inset

，
\begin_inset Formula ${\color{brown}c\in(0,1)}$
\end_inset

；令 
\begin_inset Formula $\alpha\leftarrow\overline{\alpha}$
\end_inset

；
\end_layout

\begin_layout Enumerate

\series bold
repeat 
\series default
until 
\begin_inset Formula $f(x_{k}+\alpha p_{k})\le f(x_{k})+{\color{brown}c}\,\alpha\nabla f_{k}^{T}p_{k}$
\end_inset

 （直到满足充分下降条件）
\begin_inset Formula 
\[
\alpha\leftarrow{\color{blue}\rho}\,\alpha;
\]

\end_inset


\series bold
end(repeat)
\begin_inset Newline newline
\end_inset


\series default
返回 
\begin_inset Formula $\alpha_{k}=\alpha$
\end_inset

。
\end_layout

\begin_layout Standard
在这个过程中，初始步长 
\begin_inset Formula $\overline{\alpha}$
\end_inset

 在牛顿和 quasi- Newton 方法中被选择为 
\begin_inset Formula $1$
\end_inset

，但在其他算法中可以有不同的值，如 最陡峭下降法（steepest descent） 或 共轭梯度法（conjugate gradient）。在有限次数的试验后
，能找到一个可接受的步长，因为 
\begin_inset Formula $\alpha_{k}$
\end_inset

 最终会变得足够小，以至于充分下降条件成立（见图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:w3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

）。在实践中，允许在直线搜索的每个迭代中，改变 收缩因子
\begin_inset Formula $\rho$
\end_inset

。例如，它可以通过保障性插值（safeguarded interpolation）来选择，我们将在后面介绍。我们只需要确保在每次迭代中，我们有
 
\begin_inset Formula $\rho\in[\rho_{\text{low}},\rho_{\text{high}}]$
\end_inset

，对于某些固定常数 
\begin_inset Formula $0<\rho_{\text{low}}<\rho_{\text{high}}<1$
\end_inset

。
\end_layout

\begin_layout Standard
回溯方法 确保所选择的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 要么是某固定值（初始选择
\begin_inset Formula $\overline{\alpha}$
\end_inset

），否则就是足够短以满足充分下降条件，但又不会太短。后一种说法成立，是因为 被接受值 
\begin_inset Formula $\alpha_{k}$
\end_inset

 相比于前一试验值（trial value，
\begin_inset Formula $\alpha_{k}/\rho$
\end_inset

）要乘上系数 
\begin_inset Formula $\rho$
\end_inset

；而前个值因违反 充分下降条件 被拒绝，也就是太长。
\end_layout

\begin_layout Standard
这种简单而流行的 终止线搜索 的策略很适合 牛顿法，但不太适合准牛顿和共轭梯度方法。
\end_layout

\begin_layout Section
局域坐标系和转动变换
\end_layout

\begin_layout Standard
给定任意两个非平行矢量 
\begin_inset Formula $\sbf A$
\end_inset

，
\begin_inset Formula $\sbf B$
\end_inset

，使用它们构建一个局域坐标系的方法是，
\end_layout

\begin_layout Enumerate
先令 
\begin_inset Formula $\sbf Z=\sbf A\times\sbf B$
\end_inset

，右手螺旋三元组为 
\begin_inset Formula $(\sbf Z,\sbf A,\sbf B)$
\end_inset


\end_layout

\begin_layout Enumerate
再令 
\begin_inset Formula $\sbf B'=\sbf Z\times\sbf A$
\end_inset

，现在右手螺旋三元组为 
\begin_inset Formula $(\sbf B',\sbf Z,\sbf A)$
\end_inset


\end_layout

\begin_layout Enumerate
再令 
\begin_inset Formula $\sbf A'=\sbf B'\times\sbf Z$
\end_inset

，现在右手螺旋三元组为 
\begin_inset Formula $(\sbf A',\sbf B',\sbf Z)$
\end_inset


\end_layout

\begin_layout Standard
现在三元组是两两垂直的，
\begin_inset Formula 
\begin{align*}
 & \sbf Z\times\sbf B'\\
 & =(\sbf A\times\sbf B)\times(\sbf Z\times\sbf A)\\
 & =(\sbf A\times\sbf B)\times(\sbf A\times\sbf B\times\sbf A)=0
\end{align*}

\end_inset


\begin_inset Formula $\sbf Z\times\sbf A'$
\end_inset

 同理。所以最终 
\begin_inset Formula $(\sbf A',\sbf B',\sbf Z)$
\end_inset

 即为局部正交基，
\begin_inset Formula $\sbf Z$
\end_inset

 垂直于原先的 
\begin_inset Formula $\sbf A$
\end_inset

–
\begin_inset Formula $\sbf B$
\end_inset

 平面
\end_layout

\begin_layout Subsection
坐标转动变换
\end_layout

\begin_layout Enumerate
旧坐标系下矢量记为 
\begin_inset Formula $X$
\end_inset

（例如全局坐标系），坐标基矢组为 
\begin_inset Formula $[\sbf e]$
\end_inset

；
\end_layout

\begin_layout Enumerate
新坐标系下矢量记为 
\begin_inset Formula $Y$
\end_inset

（例如局域坐标系）；坐标基矢组为 
\begin_inset Formula $[\sbf f]$
\end_inset

；
\end_layout

\begin_layout Enumerate
新旧坐标的 转动变换 矩阵为 
\begin_inset Formula $R$
\end_inset

，
\begin_inset Formula $R^{-1}=R^{T}$
\end_inset

，
\begin_inset Formula $R.R^{T}=\symbb1$
\end_inset

，为正交矩阵。
\end_layout

\begin_layout Standard
将坐标分量表示记为列矢量，约定 
\begin_inset Formula $Y=R.X$
\end_inset

，则
\begin_inset Formula 
\begin{align}
 & Y_{i}=R_{ij}X_{j}\label{eq:coordTrans}\\
 & X_{k}=R_{ki}^{-1}Y_{i}\nonumber 
\end{align}

\end_inset

同一矢量在两坐标系下具有不同的表示形式，但本质相同：
\begin_inset Formula 
\[
X_{i}\sbf e_{i}=Y_{j}\sbf f_{j}=R_{ji}X_{i}\sbf f_{j}
\]

\end_inset

从而得到 坐标基矢间的变换关系
\begin_inset Formula 
\[
\sbf e_{i}=\sbf f_{j}R_{ji},\quad\text{or}\quad\sbf f_{j}=\sbf e_{i}R_{ij}^{-1}
\]

\end_inset


\end_layout

\begin_layout Itemize
如果把坐标基矢组织到一起，可以写成行矩阵的形式：
\begin_inset Formula 
\[
[\begin{array}{ccc}
e_{1} & e_{2} & e_{3}\end{array}]=[\begin{array}{ccc}
f_{1} & f_{2} & f_{3}\end{array}].[R]
\]

\end_inset


\end_layout

\begin_layout Itemize
另一方面，坐标基矢本身可以用分量表示；新坐标系的基矢 
\begin_inset Formula $\sbf f_{1}$
\end_inset

 在新系的形式显然为 
\begin_inset Formula $[1,0,0]$
\end_inset

，根据 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:coordTrans"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\left[\begin{array}{c}
f_{1,1}\\
f_{1,2}\\
f_{1,3}
\end{array}\right]=R^{-1}\left[\begin{array}{c}
1\\
0\\
0
\end{array}\right],
\]

\end_inset

根据约定，
\begin_inset Formula $\left[f_{11},f_{12},f_{13}\right]^{T}$
\end_inset

 是新系基矢 
\begin_inset Formula $\sbf f_{1}$
\end_inset

 在旧系下的分量形式；而 式子右边相当于 
\begin_inset Formula $R^{-1}$
\end_inset

 的第一列。
\end_layout

\begin_layout Itemize
所以 
\begin_inset Formula $R^{-1}$
\end_inset

 的每一列，刚好是新基矢在旧坐标系下的分量形式。同理，
\begin_inset Formula $R$
\end_inset

的每一列是旧系基矢在新系下的分量形式。
\end_layout

\begin_layout Example
如果 
\begin_inset Formula $R$
\end_inset

 矩阵：旧坐标 
\begin_inset Formula $\stackrel{R}{\to}$
\end_inset

 新坐标（带撇的量）；或者说 
\begin_inset Formula $R$
\end_inset

 将新坐标用旧坐标表示，则
\begin_inset Formula 
\begin{align*}
 & X^{\prime}=RX,\quad\sbf e_{j}^{\prime}=\sbf e_{i}R_{ij}^{-1}\\
 & T^{\prime}=RTR^{-1}
\end{align*}

\end_inset


\begin_inset Formula $R^{-1}$
\end_inset

 的每一列，是 新系基矢 
\begin_inset Formula $\sbf e'$
\end_inset

 在旧系下的 分量形式；
\begin_inset Formula $R$
\end_inset

的每一列是旧系基矢 
\begin_inset Formula $\sbf e$
\end_inset

 在新系下的分量形式。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
新旧名称是相对的。所以等价地，如果 
\begin_inset Formula $U$
\end_inset

 矩阵：新坐标 
\begin_inset Formula $\stackrel{U}{\to}$
\end_inset

 旧坐标；或者说 
\color blue

\begin_inset Formula $U$
\end_inset

 将 旧坐标 用 新坐标表示
\color inherit
，
\begin_inset Formula 
\begin{align*}
 & X=UX^{\prime},\quad\sbf e_{j}=\sbf e_{i}^{\prime}U_{ij}^{-1}\\
 & T=UT^{\prime}U^{-1}
\end{align*}

\end_inset


\begin_inset Formula $U^{-1}$
\end_inset

的每一列是 旧系基矢 
\begin_inset Formula $\sbf e$
\end_inset

 在新系下的 分量形式；
\color blue

\begin_inset Formula $U$
\end_inset

 的每一列是新系 基矢在 旧系 下的分量形式
\color inherit
。
\end_layout

\begin_layout Section
快速傅立叶
\end_layout

\begin_layout Example
\begin_inset CommandInset href
LatexCommand href
name "FFT 超详解"
target "https://zhuanlan.zhihu.com/p/347091298"
literal "false"

\end_inset


\end_layout

\begin_layout Section
格林公式
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "从格林公式到柯西公式"
target "https://zhuanlan.zhihu.com/p/86297231"
literal "false"

\end_inset


\end_layout

\begin_layout Remark
关于曲线积分符号的规定，是由于物理界盛行右手定则，可能对数学符号规定方面造成了一定影响。所以对于曲线积分的符号做如下规定：当沿着区域的边界移动时，区域内部在你的
左侧，则符号为正。所以如果是环状结构的区域，外圈逆时针积分为正，内圈顺时针积分为正。所有没有标注顺时针还是逆时针的积分曲线（主要是公式中），默认取正方向。
\end_layout

\begin_layout Standard
格林公式为：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\oint_{C}P\dd{x}+Q\dd{y}=\iint_{D}\left(\frac{\partial Q}{\partial x}-\frac{\partial P}{\partial y}\right)\dd{x}\dd{y}
\]

\end_inset

其中，
\begin_inset Formula $D$
\end_inset

 是一单连通区域， 
\begin_inset Formula $C$
\end_inset

 是该区域的边界。它说一个闭区域边界上的曲线积分，等于被积函数经过一种操作以后在面积上积分。下面我们讨论两点：
\end_layout

\begin_layout Enumerate
因为要将原被积函数
\begin_inset Formula $f$
\end_inset

实现在
\begin_inset Formula $D$
\end_inset

上的积分，并且出现了导数结构，自然要求原被积函数
\begin_inset Formula $f$
\end_inset

需要在
\begin_inset Formula $D$
\end_inset

上定义，各偏导数都存在，且偏导数与函数在
\begin_inset Formula $D$
\end_inset

上都连续。
\end_layout

\begin_layout Enumerate
这个式子只能在单连通区域(没有“洞”)成立，所以对于复连通区域(有“洞”)，这个“洞”也叫奇点，就是不满足条件1的点。可以给奇点外面加一个边界形成一个新的、具有
两个边界的复连通区域，就像这样：
\begin_inset CommandInset href
LatexCommand href
name "region"
target "https://pic2.zhimg.com/80/v2-2d2a90cfd2925bb1b17def74806a8aa5_720w.webp"
literal "false"

\end_inset


\end_layout

\begin_layout Subsection
二维散度定理
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "2D Divergence Theorem [KhanAcademy]"
target "https://www.bilibili.com/video/BV15k4y1r7Uq?p=2&vd_source=a7a8fe02bc1634566f069ff312b17c99"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
假设 
\begin_inset Formula $\sbf v$
\end_inset

 是一矢量场，
\begin_inset Formula $C$
\end_inset

 是单连通区域
\begin_inset Formula $D$
\end_inset

的边界曲线，则
\begin_inset Formula $\sbf v$
\end_inset

沿逆时针对曲线法向单位矢量
\begin_inset Formula $\sbf n$
\end_inset

的内积的线积分： 
\begin_inset Formula 
\begin{align*}
\oint_{C}\sbf v\cdot\sbf n\dd{\ell} & =\oint_{C}\sbf v\cdot\frac{\left(\dd{y},-\dd{x}\right)}{\dd\ell}\\
 & =\oint_{C}v_{x}\dd{y}-v_{y}\dd{x}\\
\text{by Green Theorem}\; & =\iint_{D}\left(\frac{\partial v_{x}}{\partial x}+\frac{\partial v_{y}}{\partial y}\right)\dd{x}\dd{y}
\end{align*}

\end_inset

即二维情形的散度定理：
\begin_inset Formula $\oint_{C}\sbf v\cdot\sbf n\dd{\ell}=\iint_{D}\nabla\cdot\sbf v\dd{A}$
\end_inset

。以上使用了曲线法向的表达式 
\begin_inset Formula $\left(\dd{y},-\dd{x}\right)/\dd{\ell}$
\end_inset

和格林环路定理。
\end_layout

\begin_layout Subsection
一般曲线坐标系
\end_layout

\begin_layout Standard
在一般曲线正交坐标系中，空间一点
\begin_inset Formula $P$
\end_inset

的位置用三个坐标
\begin_inset Formula $u_{1}$
\end_inset

，
\begin_inset Formula $u_{2}$
\end_inset

和 
\begin_inset Formula $u_{3}$
\end_inset

表示。沿这些坐标增加方向的单位矢量为 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

。沿着三个方向的线元为
\begin_inset Formula 
\begin{equation}
\dd{\ell_{1}}=h_{1}\dd{u_{1}},\quad\dd{\ell_{2}}=h_{2}\dd{u_{2}},\quad\dd{\ell_{3}}=h_{3}\dd{u_{3}}.\label{eq:shI1.27}
\end{equation}

\end_inset

其中 
\begin_inset Formula $h_{1}$
\end_inset

，
\begin_inset Formula $h_{2}$
\end_inset

，
\begin_inset Formula $h_{3}$
\end_inset

一般为坐标的函数。在 
\begin_inset Formula $P$
\end_inset

 点上任一矢量可以写为
\begin_inset Formula 
\begin{equation}
\sbf f=f_{1}\sbf e_{1}+f_{2}\sbf e_{2}+f_{3}\sbf e_{3}\label{eq:sh.28}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
对于任意曲面，且对于上面任意一点
\begin_inset Formula $P$
\end_inset

，选择任意两条通过 
\begin_inset Formula $P$
\end_inset

 点的曲线，可以确定两条（不平行的）切线，可以确定切面；
\end_layout

\begin_layout Enumerate
然后也可以确定
\begin_inset Formula $P$
\end_inset

点处的法线，选为 
\begin_inset Formula $w$
\end_inset

 方向，在切面上选取 
\begin_inset Formula $u$
\end_inset

，
\begin_inset Formula $v$
\end_inset

 方向（有一定自由度）。
\end_layout

\begin_layout Enumerate
加入当前的线元表达式为
\begin_inset Formula 
\[
\dd{\ell_{1}}=h_{1}\dd{u_{1}},\quad\dd{\ell_{2}}=h_{2}\dd{u_{2}},\quad\dd{\ell_{3}}=h_{3}\dd{u_{3}},
\]

\end_inset

通过适当的坐标变换，令
\begin_inset Formula 
\[
\dd{\ell_{1}}=\dd{u},\quad\dd{\ell_{2}}=\dd{v},\quad\dd{\ell_{3}}=\dd{w}.
\]

\end_inset

即 
\begin_inset Formula $u$
\end_inset

，
\begin_inset Formula $v$
\end_inset

，
\begin_inset Formula $w$
\end_inset

 组成局域笛卡尔正交系，尽管不一定能找到显式的变换。
\end_layout

\begin_layout Standard
在曲线正交坐标系中有一般公式
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\nabla\psi=\frac{1}{h_{1}}\partial_{1}\psi\,\sbf e_{1}+\frac{1}{h_{2}}\partial_{2}\psi\,\sbf e_{2}+\frac{1}{h_{3}}\partial_{3}\psi\,\sbf e_{3}\label{eq:shI.29}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sbf f=\frac{1}{h_{1}h_{2}h_{3}}\left[\partial_{1}\left(h_{2}h_{3}f_{1}\right)+\partial_{2}\left(h_{3}h_{1}f_{2}\right)+\partial_{3}\left(h_{1}h_{2}f_{3}\right)\right]\label{eq:shI.30}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
\nabla^{2}\psi=\frac{1}{h_{1}h_{2}h_{3}}\left[\partial_{1}\left(\frac{h_{2}h_{3}}{h_{1}}\partial_{1}\psi\right)+\partial_{2}\left(\frac{h_{3}h_{1}}{h_{2}}\partial_{2}\psi\right)+\partial_{3}\left(\frac{h_{1}h_{2}}{h_{3}}\partial_{3}\psi\right)\right]\label{eq:shI.32}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\nabla^{2}\psi=\frac{1}{h_{3}}\left[\partial_{1}\left(h_{3}\partial_{1}\psi\right)+\partial_{2}\left(h_{3}\partial_{2}\psi\right)+\partial_{3}\left(\frac{1}{h_{3}}\partial_{3}\psi\right)\right]
\]

\end_inset


\end_layout

\begin_layout Chapter
泛函与弱形式
\end_layout

\begin_layout Section
变分法
\end_layout

\begin_layout Standard
ref:
\begin_inset CommandInset href
LatexCommand href
name "变分法简介Part 1"
target "https://zhuanlan.zhihu.com/p/20718489"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "变分法简介Part 2"
target "https://zhuanlan.zhihu.com/p/20727402"
literal "false"

\end_inset


\end_layout

\begin_layout Definition
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
泛函数 (Functionals)
\end_layout

\end_inset

 简而言之，泛函数是 函数 的函数，即它的输入是函数，输出是实数。而这个输出值取决于一个或多个函数（输入）在一整个路径上的积分，而非像一般函数一样取决于离散的变
量。
\end_layout

\begin_layout Standard
通常在变分法中，泛函数是一个积分，记做
\begin_inset Formula $I$
\end_inset

，例如
\begin_inset Formula 
\[
I=\int_{x_{1}}^{x^{2}}F\dd{x}.
\]

\end_inset

其中我们想要通过 选择被积函数 
\begin_inset Formula $F$
\end_inset

 来最大化或最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的值。同时我们称 
\begin_inset Formula $F$
\end_inset

 为拉格朗日函数(Lagrange function)。
\begin_inset Formula $F$
\end_inset

 可以是函数 
\begin_inset Formula $y(x)$
\end_inset

 和 
\begin_inset Formula $y(x)$
\end_inset

 各阶导数的函数(以下 
\begin_inset Formula $y(x)$
\end_inset

均简写成 
\begin_inset Formula $y$
\end_inset

)。
\end_layout

\begin_layout Definition
\begin_inset CommandInset label
LatexCommand label
name "def:extreme"

\end_inset


\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
泛函数的极值
\end_layout

\end_inset

 泛函数 
\begin_inset Formula $I$
\end_inset

 在区间 
\begin_inset Formula $[x_{1},x_{2}]$
\end_inset

 上的值取决于积分路径的选择，即取决于函数 
\begin_inset Formula $y(x)$
\end_inset

 的选择。我们有理由假设存在一个这样的 
\begin_inset Formula $y(x)$
\end_inset

，可以使得泛函数 
\begin_inset Formula $I$
\end_inset

 取到极值。而在这个 
\begin_inset Formula $y(x)$
\end_inset

 附近的任意路径我们记做 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

。另外，我们假设 
\begin_inset Formula $y(x)$
\end_inset

 两阶可微。通过引入一个微小量 
\begin_inset Formula $\epsilon\ll1$
\end_inset

 和一个任意可微函数 
\begin_inset Formula $\eta(x)$
\end_inset

，我们可以用 
\begin_inset Formula $y(x)$
\end_inset

 表示 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

：
\begin_inset Formula 
\[
\tilde{y}(x)=y(x)+\epsilon\eta(x).
\]

\end_inset


\end_layout

\begin_layout Standard
这样做的好处是对于一个给定的 
\begin_inset Formula $\eta(x)$
\end_inset

，我们可以通过改变的 
\begin_inset Formula $\eta$
\end_inset

 值来得到无穷多的路径，同时对于任何 
\begin_inset Formula $\eta(x)$
\end_inset

，当 
\begin_inset Formula $\epsilon(x)=0$
\end_inset

 的时候，
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 和 
\begin_inset Formula $y(x)$
\end_inset

 重合。图像直观表示如下图：
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/fanhan-1.png
	lyxscale 50
	scale 45

\end_inset


\end_layout

\begin_layout Standard
由于在边界条件的限制，需要要求 
\begin_inset Formula $\eta(x_{1})=\eta(x_{2})=0$
\end_inset

。这样就能保证 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 可以通过两个固定端点。这时我们可以说，
\begin_inset Formula $y(x)$
\end_inset

 所对应的泛函数 
\begin_inset Formula $I$
\end_inset

 的值是泛函数 
\begin_inset Formula $\tilde{I}=\int_{x_{1}}^{x^{2}}F\left(\tilde{y},\tilde{y}';x\right)\dd{x}$
\end_inset

 的极值。我们可以进一步用 
\begin_inset Formula $\epsilon$
\end_inset

 表示 
\begin_inset Formula $\tilde{I}$
\end_inset

：
\begin_inset Formula 
\[
\tilde{I}=\int_{x_{1}}^{x^{2}}F(\tilde{y},\tilde{y}';x)\dd{x}=\int_{x_{1}}^{x^{2}}F\left(y+\epsilon\eta,y'+\epsilon\eta';x\right)\dd{x}
\]

\end_inset

虽然 
\begin_inset Formula $y(x)$
\end_inset

 未知，但是根据之前的合理假设，
\begin_inset Formula $y(x)$
\end_inset

 是一个存在的确定函数。所以根据上式，如果给定一个特定的 
\begin_inset Formula $\eta(x)$
\end_inset

，
\begin_inset Formula $\tilde{I}$
\end_inset

 的变化只取决于 
\begin_inset Formula $\epsilon$
\end_inset

 的变化。所以我们现在可以把 
\begin_inset Formula $\tilde{I}$
\end_inset

 看做是 
\begin_inset Formula $\epsilon$
\end_inset

 的函数。用泰勒展开公式将 
\begin_inset Formula $\tilde{I}$
\end_inset

 在
\begin_inset Formula $\epsilon=0$
\end_inset

 处展开得到：
\begin_inset Formula 
\[
\tilde{I}(\epsilon)=\left.\tilde{I}\right|_{\epsilon=0}+\left.(\frac{\dd{\tilde{I}}}{\dd{\epsilon}})\right|_{\epsilon=0}\cdot\epsilon+\left.(\frac{\dd[2]{\tilde{I}}}{\dd{\epsilon^{2}}})\right|_{\epsilon=0}\cdot\frac{\epsilon^{2}}{2!}+\cdots=\tilde{I}_{0}+\tilde{I}_{1}\epsilon+\tilde{I}_{2}\epsilon^{2}+\cdots
\]

\end_inset

很明显，当 
\begin_inset Formula $\epsilon=0$
\end_inset

 时，
\begin_inset Formula $\left.\tilde{I}\right|_{\epsilon=0}=I$
\end_inset

，代入上式可得到：
\begin_inset Formula 
\[
\tilde{I}-I=\tilde{I}_{1}\epsilon+\tilde{I}_{2}\epsilon^{2}+\cdots
\]

\end_inset

这里我们记 
\begin_inset Formula $\delta I=\tilde{I}_{1}\epsilon=\left.(\frac{\dd{\tilde{I}}}{\dd{\epsilon}})\right|_{\epsilon=0}\cdot\epsilon$
\end_inset

，并称之为一阶变分。同理二阶变分为 
\begin_inset Formula $\delta I^{2}=\tilde{I}_{2}\epsilon^{2}$
\end_inset

。
\end_layout

\begin_layout Remark
这里插一句变分和微分的区别。变分在上图的直观解释是
\begin_inset Formula $\tilde{y}$
\end_inset

和 
\begin_inset Formula $y$
\end_inset

 在竖直方向上的距离，称之为 
\begin_inset Formula $\delta y$
\end_inset

，所以这个差是在同一个 
\begin_inset Formula $x$
\end_inset

 上计算的。而微分则是由于 
\begin_inset Formula $x$
\end_inset

 的微小变动引起的 
\begin_inset Formula $y$
\end_inset

 的变动。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
然后我们可以类比求函数极值时的做法。求函数极值时，我们会令函数的一阶导数为零。这里同样，为了求泛函数 
\begin_inset Formula $\tilde{I}$
\end_inset

 的极值，我们令一阶变分 
\begin_inset Formula $\delta I=0$
\end_inset

。计算 
\begin_inset Formula $\delta I$
\end_inset

，并通过分部积分得到
\begin_inset Formula 
\begin{equation}
\delta I=\int_{x_{1}}^{x^{2}}\left(\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}\right)\delta y\dd{x}+\left.{\color{blue}\frac{\partial F}{\partial y'}\delta y}\right|_{x_{1}}^{x_{2}}\label{eq:EL-equ}
\end{equation}

\end_inset

令 
\begin_inset Formula $\delta I=0$
\end_inset

 就能解得最小化泛函数的 
\begin_inset Formula $y$
\end_inset

。由于 
\begin_inset Formula $\delta y$
\end_inset

 是任意地，所以要想使上式等于零，需要
\begin_inset Formula 
\[
\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}=0,\quad x_{1}\le x\le x_{2}
\]

\end_inset

即 欧拉–拉格朗日方程（Euler–Lagrange equation）。而第二部分等于零则是边界条件。
\end_layout

\begin_layout Standard
对于边界条件：
\end_layout

\begin_layout Enumerate
如果在边界 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 
\begin_inset Formula ${\color{blue}\frac{\partial F}{\partial y'}}$
\end_inset

 等于零，那么我们称在 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 满足自然边界条件（
\series bold
Natural Boundary Condition
\series default
）。
\end_layout

\begin_layout Enumerate
对应的，如果在边界 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 
\begin_inset Formula ${\color{blue}\delta y}$
\end_inset

 等于零，我们就称 在 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 满足 
\series bold
Essential Boundary condition
\series default
。
\begin_inset Formula $\delta y=0$
\end_inset

 是一个比较模糊的概念，不好判断，所以我们把它等价转化一下。如果
\begin_inset Formula $y$
\end_inset

在某一点处的变分为零，说明它在这点的值是确定不变的。换句话说如果 
\begin_inset Formula $y$
\end_inset

 在边界上是确定的值(specified)，那么我们称这个是 essential boundary condition。
\end_layout

\begin_layout Subsection
含有高阶导数
\end_layout

\begin_layout Standard
当然上述问题中，
\begin_inset Formula $F$
\end_inset

 只是
\begin_inset Formula $y$
\end_inset

和
\begin_inset Formula $y'$
\end_inset

的函数，但是
\begin_inset Formula $F$
\end_inset

完全还可能是
\begin_inset Formula $y''$
\end_inset

甚至更高阶导数的函数。这时候我们用上节所说的设 
\begin_inset Formula $\tilde{y}=y(x)+\epsilon\eta(x)$
\end_inset

 的方法就有点麻烦了（但是也可行）。这里我们提供一个更高效的方法，直接对泛函数求变分。假如泛函数 
\begin_inset Formula $I=\int_{x_{1}}^{x^{2}}F(\tilde{y},\tilde{y}',y'';x)\dd{x}$
\end_inset

，那么它的一阶变分为：
\begin_inset Formula 
\[
\delta I=\int_{x_{1}}^{x^{2}}\frac{\partial F}{\partial y}\delta y+\frac{\partial F}{\partial y'}\delta y'+\frac{\partial F}{\partial y''}\delta y''\dd{x}
\]

\end_inset

然后再进行分部积分得到：
\begin_inset Formula 
\[
\delta I=\int_{x_{1}}^{x^{2}}\left(\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}+\frac{\dd[2]}{\dd{x^{2}}}\frac{\partial F}{\partial y''}\delta\right)\delta y\dd{x}+\left.\frac{\partial F}{\partial y''}\delta y'+\left[\frac{\partial F}{\partial y'}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y''}\right]\delta y\right|_{x_{1}}^{x_{2}}=0
\]

\end_inset

同样我们可以得到欧拉-拉格朗日方程：
\begin_inset Formula 
\[
\text{E-L:}\,\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}+\frac{\dd[2]}{\dd{x^{2}}}\frac{\partial F}{\partial y''}=0
\]

\end_inset

以及边界条件：
\begin_inset Formula 
\begin{align*}
\frac{\partial F}{\partial y''}=0,\;\text{(Natural)}\quad & \text{or}\quad\delta y'=0\;\text{(Essential)}\\
\frac{\partial F}{\partial y'}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y''}=0,\;\text{(Natural)}\quad & \text{or}\quad y=0\;\text{(Essential)}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
约束条件（拉格朗日乘数）
\end_layout

\begin_layout Standard
现在我们来讨论下如果我们需要求在满足一定条件下求泛函数的极值，应该如何求解。
\end_layout

\begin_layout Standard
举个简单的例子，如果给定一个区域的边界长度，我们想最大化该边界所围的区域。这类问题我们需要引进拉格朗日乘数(
\begin_inset Formula $\lambda$
\end_inset

)。
\end_layout

\begin_layout Standard
假设约束条件为：
\begin_inset Formula $J(y)=\int_{x_{1}}^{x_{2}}G(y,y';x)=\text{const.}$
\end_inset

那我们引入拉格朗日乘数在原泛函数的基础上构建新的泛函数：
\begin_inset Formula 
\[
I^{*}=I+\lambda J=\int_{x_{1}}^{x_{2}}(F+\lambda G)\dd{x}=\int_{x_{1}}^{x_{2}}F^{*}(y,y';x)\dd{x}
\]

\end_inset

然后我们就可以转化成之前的问题来解了。还是用刚才提到的最大化面积问题为例来阐述下这个过程：
\end_layout

\begin_layout Enumerate
面积：
\begin_inset Formula $A=\int_{x_{1}}^{x_{2}}y\dd{x}$
\end_inset

，
\end_layout

\begin_layout Enumerate
边界长度约束：
\begin_inset Formula $S=\int_{x_{1}}^{x_{2}}\sqrt{1+(y')}^{2}\dd{x}=\text{const.}$
\end_inset


\end_layout

\begin_layout Enumerate
则：
\begin_inset Formula $I^{*}=\int_{x_{1}}^{x_{2}}[y+\lambda\sqrt{1+(y')}^{2}]\dd{x}$
\end_inset


\end_layout

\begin_layout Enumerate
令一阶变分为零（
\begin_inset Formula $\delta I^{*}=0$
\end_inset

）：
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}[\delta y+\lambda\frac{y'}{\sqrt{1+(y')}^{2}}\delta y']\dd{x}=0
\]

\end_inset

依旧老朋友分部积分：
\begin_inset Formula 
\[
\delta I^{*}=\int_{x_{1}}^{x_{2}}[1-\lambda\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}]\delta y\dd{x}+\text{B.C.term}=0
\]

\end_inset

这里图方便我就将边界条件项用 B.C.term 代替啦。然后欧拉-拉格朗日方程为：
\begin_inset Formula 
\[
\text{E-L:}\,1-\lambda\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}=0,\quad x\in(x_{1},x_{2})
\]

\end_inset


\end_layout

\begin_layout Enumerate
现在我们可以解一下E-L方程：
\begin_inset Formula 
\[
\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}=\frac{1}{\lambda}\quad\Rightarrow\quad\frac{y''}{(1+y^{\prime2})^{3/2}}=\frac{1}{\lambda}.
\]

\end_inset

也就是说边界是曲率恒为 
\begin_inset Formula $\frac{1}{\lambda}$
\end_inset

 的曲线，即半径为 
\begin_inset Formula $\lambda$
\end_inset

 的圆，这也和我们常识一致。
\end_layout

\begin_layout Standard
上文说到了用 
\emph on
最小化泛函数
\emph default
 的方法求解问题，最终可以将问题转化为求解一个带有边界条件的偏微分方程（PDE）。但是实际上并不是所有的 PDE 都像上次那个两点间最短距离问题中的PDE那么好
解，这也就是为什么我们要有有限元方法，因为有限元可以避开求解复杂偏微分方程，用相对简单的方法来求解其近似解。一般有三种近似方法，分别是 
\series bold
Rayleigh-Ritz method
\series default
，
\series bold
Strong Form Galerkin
\series default
 (SFG) 和 
\series bold
Weak Form Galerkin
\series default
 (WFG)。后两者就是我们常听说的貌似比较高大上的 
\series bold
强形式
\series default
 和 
\series bold
弱形式
\series default
。后面会分别介绍和比较这三种方法。以后的文章会介绍如何将他们运用于有限元方法。
\end_layout

\begin_layout Standard
在最开始，首先要理清一个非常重要的思路。那就是通过变分法最小化泛函数得到的 PDE 和 原泛函数 之间的关系。如果理清了这个关系，上述三种方法的基本思想就算是掌
握了，剩下的就是一些数学而已了。它们之间的关系是：PDE 的解是能将原泛函数最小化的函数。
\end_layout

\begin_layout Standard
这层关系给我们提供了两条路走：
\end_layout

\begin_layout Enumerate
直接从泛函数出发，找出可以最小化它的函数。
\end_layout

\begin_layout Enumerate
通过变分法得到PDE，然后求解PDE（近似求解），这样得到的PDE的解（或近似解）就是方法1中所要求的函数。
\end_layout

\begin_layout Standard
上面提到的三种方法就是顺着这两条路走的。Rayleigh-Ritz 对应于第一条路，强弱形式对应于后一条路。看上去 Rayleigh-Ritz
 法和求解微分方程并没有什么关系，因为它跳过了通过变分法得到 PDE 这个步骤，但是根据上面提到的关系，我们可以把思维逆转过来，即 能够将 泛函数最小化的函数，
是使用变分法后得到的PDE的解。这样我们也可以强行把 Rayleigh-Ritz 法看成是近似求解微分方程的方法。
\end_layout

\begin_layout Section
Rayleigh-Ritz Method
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "Rayleigh-Ritz Method"
target "https://zhuanlan.zhihu.com/p/20882021"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
第一条路看似是更直接的捷径，但是世界上有无穷种函数，直接找出可以最小化一个泛函数的函数谈何容易。但是如果我们先假设一下这个函数的形式，那么未知的就只是一些系数了
，再将这个假设的函数代入 原泛函数，就可以将泛函数转化为未知系数的函数，而最小化函数对我们而言是轻而易举的（对未知系数求导等于零），解出未知系数后代入假设的函数
，就得到了最小化泛函数的近似解。这就是 Rayleigh-Ritz Method 的基本思想。一般来说，我们会将近似函数的形式设为多项式(polynomial)
，例如，这也是有限元里常用的形式。话不多说，看个简单的例子：
\end_layout

\begin_layout Example
如图，拉伸一个横截面积为 
\begin_inset Formula $A$
\end_inset

，长为 
\begin_inset Formula $L$
\end_inset

，杨氏模量为 
\begin_inset Formula $E$
\end_inset

 的杆，最右端的力为 
\begin_inset Formula $P$
\end_inset

，位移为 
\begin_inset Formula $u_{0}$
\end_inset

。我们想要用最小势能原理解出其位移场 
\begin_inset Formula $u(x)$
\end_inset

。虽然很明显精确解是 
\begin_inset Formula $u(x)=\frac{u_{0}}{L}x$
\end_inset

，但是就像之前的两点间直线最短的例子一样，例子虽然简单，但是可以帮助我们感受下这个方法的过程。
\end_layout

\begin_layout Example
\begin_inset Graphics
	filename inset/fanhan-2.png

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
我们可以写出系统势能（具体为什么是这个式子之后的文章会解释，这次着重于介绍方法的思想）：
\begin_inset Formula $\Pi=\frac{1}{2}\int_{0}^{L}EA\,u^{\prime2}\dd{x}-Pu_{0}$
\end_inset

。由于左端固定，右端位移已知，所以有两个 Essential Boundary Conditions: 
\begin_inset Formula $\left.u\right|_{x=0}=0$
\end_inset

 和 
\begin_inset Formula $\left.u\right|_{x=L}=u_{0}$
\end_inset

 。
\end_layout

\begin_layout Standard
根据上文的思路，我们设待求函数 
\begin_inset Formula $u(x)$
\end_inset

 的形式为多项式。这里姑且先设成二次形式。一般来说，设的次数越高，近似解越精确，但是由于本例精确解就是个一次线性方程，所以只要设的函数高于
\begin_inset Formula $1$
\end_inset

次，近似解就和精确解相同。另一个需要注意的是，使用 Rayleigh-Ritz 法时，设的近似方程（如本例中的
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 ）必须满足 Essential Boundary Conditions(不必须满足Natural Boundary Condition)。遵循这点，我们可以得
出两个等式：
\begin_inset Formula 
\[
\tilde{u}(0)=0,\quad\text{and}\quad\tilde{u}(L)=0,
\]

\end_inset

由上述两式可以解出 
\begin_inset Formula $a_{0}=0$
\end_inset

 以及 
\begin_inset Formula 
\[
a_{1}L+a_{2}L^{2}=u_{0}\Rightarrow a_{2}=\frac{u_{0}-a_{1}L}{L^{2}},
\]

\end_inset

将这两个结果代入 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 整理下得到：
\begin_inset Formula 
\[
\tilde{u}(x)=\frac{u_{0}}{L^{2}}x^{2}+a_{1}(x-\frac{x^{2}}{L}).
\]

\end_inset

也就是说我们只有 
\begin_inset Formula $1$
\end_inset

 个未知参数 
\begin_inset Formula $a_{1}$
\end_inset

。
\end_layout

\begin_layout Standard
通常我们会将 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 写成 
\begin_inset Formula $\tilde{u}(x)=\phi_{0}(x)+\sum_{j=1}^{n}c_{j}\phi_{j}(x)$
\end_inset

 的形式。对应这个例子
\begin_inset Formula 
\[
\phi_{0}=\frac{u_{0}}{L^{2}}x^{2},\quad c_{1}=a_{1},\quad\phi_{1}=\frac{x}{L}(L-x),
\]

\end_inset

如果有更多未知参数，则会有更高阶项。
\begin_inset Formula $\phi_{i}$
\end_inset

 有个 
\series bold
重要性质
\series default
：从 
\begin_inset Formula $\phi_{1}$
\end_inset

 开始，所有的 
\begin_inset Formula $\phi_{i}$
\end_inset

 在 Essential Boundary Condition 处都等于零。比如这个例子中，在 
\begin_inset Formula $x=0$
\end_inset

和
\begin_inset Formula $x=L$
\end_inset

处有 Essential Boundary Condition，那么
\begin_inset Formula $\phi_{1}$
\end_inset

 在
\begin_inset Formula $x=0$
\end_inset

和
\begin_inset Formula $x=L$
\end_inset

处必须等于零。我们可以发现确实满足，如果有更高阶项 
\begin_inset Formula $\phi_{2}$
\end_inset

，
\begin_inset Formula $\phi_{3}$
\end_inset

 等等，同样应该满足。这个性质可以帮助我们检查假设的 近似函数是否正确。现在需要做的就是把 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 代入到原泛函数中，即用 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 取代 
\begin_inset Formula $u(x)$
\end_inset

。
\begin_inset Formula 
\begin{align*}
 & \tilde{u}'(x)=\frac{2u_{0}}{L^{2}}x+c_{1}(1-\frac{2x}{L})\\
 & \Pi=\frac{1}{2}\int_{0}^{L}EA\,\tilde{u}'(x)^{2}\dd{x}-Pu_{0}=\frac{EA}{2}(\frac{4u_{0}^{2}}{3L}+\frac{c_{1}^{2}L}{3}-\frac{2u_{0}c_{1}}{3})-Pu_{0}
\end{align*}

\end_inset

这样 
\begin_inset Formula $\Pi$
\end_inset

 就仅是 
\begin_inset Formula $c_{1}$
\end_inset

 的函数而已，那么最小化就非常简单了，即令
\begin_inset Formula $\frac{\dd{\Pi}}{\dd{c_{1}}}=0$
\end_inset

：
\begin_inset Formula 
\[
\frac{\dd{\Pi}}{\dd{c_{1}}}=\frac{2}{3}c_{1}L-\frac{2}{3}u_{0}=0,
\]

\end_inset

解得 
\begin_inset Formula $c_{1}=\frac{u_{0}}{L}$
\end_inset

。代入
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 得到 
\begin_inset Formula $\tilde{u}(x)=\frac{u_{0}}{L}x$
\end_inset

。可以看到这和精确解一致，这是由于所设的近似方程的形式恰巧和精确解方程的形式一样，但是大多数问题中，精确解一般都不是多项式，所以如果将近似函数设为多项式，则会产
生误差，得出的结果则是近似解。
\end_layout

\begin_layout Standard
上面这个例子并不能令人感到兴奋，因为本身就是一眼就能看出精确解的问题硬生生算了半天，感觉很傻，所以再举个稍微复杂点的例子感受下。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset CommandInset label
LatexCommand label
name "exa:2.2"

\end_inset

泛函为
\begin_inset Formula 
\[
I[y(x);x]=\int_{0}^{2}\left[0.5(y'')^{2}+5(y')^{2}+2y^{2}+y\right]\dd{x}-10y(0),
\]

\end_inset


\end_layout

\begin_layout Enumerate
Essential Boundary Conditions: 
\begin_inset Formula $y(2)=0$
\end_inset

；
\begin_inset Formula $y'(0)=-2$
\end_inset

。
\end_layout

\begin_layout Enumerate
Natural Boundary Conditions: ; 
\begin_inset Formula $y'''(0)=-10$
\end_inset

；
\begin_inset Formula $y''(2)=0$
\end_inset

。
\end_layout

\begin_layout Standard
有兴趣的可以用 Rayleigh-Ritz方法求解下，可以最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的近似解函数 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

。
\end_layout

\begin_layout Section
强形式Galerkin
\end_layout

\begin_layout Standard
上文介绍了 Rayleigh-Ritz 法。一句话概括下就是：将 
\series bold
泛函数
\series default
 中的待求函数设成带有 
\series bold
未知系数
\series default
 的已知形式（如多项式），并将其带入 原泛函数，从而将 
\series bold
最小化泛函数
\series default
 的问题简化成我们熟悉的 
\series bold
最小化函数
\series default
 问题来求解未知系数，最后就得出了待求函数的近似解。而这次文章以及下次文章要说到的强形式和弱形式（Strong form & Weak form
 Galerkin）法是从求解 PDE 出发的。类似于 Rayleigh-Ritz 法的思路，我们可以把PDE的解近似为一系列基函数的叠加（需要满足边界条件）。
例如如果我们要解这样一个PDE：
\begin_inset Formula 
\[
A[w(x)]-f=0,
\]

\end_inset

其中 
\begin_inset Formula $A[w(x)]$
\end_inset

 代表对待求函数 
\begin_inset Formula $w(x)$
\end_inset

 的任意微分运算，例如 
\begin_inset Formula $A[w(x)]=\frac{\partial^{2}w}{\partial x^{2}}$
\end_inset

。那么我们可以用公式写出这个PDE 的近似解为：
\begin_inset Formula 
\[
\tilde{w}(x)=\phi_{0}(x)+\sum_{j=1}^{n}c_{j}\phi_{j}(x)
\]

\end_inset

其中 
\begin_inset Formula $\phi_{j}(x)$
\end_inset

 是已知的基函数(basis functions)，
\begin_inset Formula $c_{j}$
\end_inset

 是待解的未知系数。
\begin_inset Formula $\phi_{0}(x)$
\end_inset

 是用来满足非其次边界条件的，下面会结合例子说明。
\end_layout

\begin_layout Standard
很显然，除非精确解恰巧和我们设的近似解形式相同，不然近似解是和精确解有偏差的。换句话说，如果我们把近似解 
\begin_inset Formula $\tilde{w}(x)$
\end_inset

 代入原PDE，那么将不会等于
\begin_inset Formula $0$
\end_inset

，会带来一些 
\series bold
残差
\series default
 或余量。用公式表示就是 
\begin_inset Formula 
\[
A[\tilde{w}(x)]-f=R\neq0.
\]

\end_inset

这样问题就转化为求解出 
\begin_inset Formula $c_{j}$
\end_inset

 使得余量 
\begin_inset Formula $R$
\end_inset

 在求解域上尽可能小（尽可能接近
\begin_inset Formula $0$
\end_inset

），这样我们的近似解越逼近于精确解。
\end_layout

\begin_layout Standard
这时候我们需要使用 加权余量法(Method of Weighted Residual)。这种方法的基本思想是，既然不能找到准确解使余量
\begin_inset Formula $R$
\end_inset

在整个求解域上都完全等于零，那么我们至少要找到一个近似解使余量
\begin_inset Formula $R$
\end_inset

在求解域上的某种平均等于零。说到某种平均第一反应会是将
\begin_inset Formula $R$
\end_inset

在求解域上积分，即令 
\begin_inset Formula $\int R\dd{x}=0$
\end_inset

，但这其实是个比较糟糕的想法，满足这个式子的有无穷种可能性，根本不可解。合理的做法是令
\begin_inset Formula $R$
\end_inset

的加权积分为零，写成公式即：
\begin_inset Formula 
\[
\int R(x)\Phi_{i}(x)\dd{x}=0,\quad i=1,\cdots,n
\]

\end_inset

其中 
\begin_inset Formula $\Phi_{i}$
\end_inset

 是 
\series bold
权函数
\series default
(weighted function)。权函数的选择有多种方法，这里介绍的同时也是有限元中常用的一种即 Galerkin method。该方法将近似解中的
 
\series bold
基函数
\series default
 直接当做 权函数(一个用大写的 
\begin_inset Formula $\Phi_{i}$
\end_inset

 一个用小写的 
\begin_inset Formula $\phi$
\end_inset

，有没有一种钦定的感觉)。这样做的好处是，独立等式的数量（即
\begin_inset Formula $\phi_{i}$
\end_inset

的数量）和待解
\begin_inset Formula $c_{j}$
\end_inset

的数量相同，这样就能确保未知系数唯一且可解。解出后代入就可以得到近似解啦。
\end_layout

\begin_layout Standard
以上面的 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 为例，这次使用 Strong Form Galerkin，这里仅用一个未知系数。
\end_layout

\begin_layout Solution
首先大家可以用变分法证明下，能够最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的解和下面这个PDE的解是等价的。
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
y''''-10y''+4y+1=0,\quad0<x<2
\]

\end_inset

加上上述题目中的边界条件。
\end_layout

\begin_layout Standard
基本思路是写出 
\begin_inset Formula $I$
\end_inset

 的一阶变分
\begin_inset Formula 
\begin{equation}
\delta I=\int_{0}^{2}\left[y''\delta(y'')+10y'\delta(y')+4y\delta y+\delta y\right]\dd{x},\label{eq:variation1}
\end{equation}

\end_inset

然后再分部积分，即可得到 
\begin_inset CommandInset ref
LatexCommand eqref
reference "rem1"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\begin{equation}
\delta I=\int_{0}^{2}\left(y''''-10y''+4y+1\right)\delta y\dd{x}+\text{Boundary terms}.\label{eq:var-bound}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
总之现在问题就变成使用 Strong Form Galerkin求解一个带有边界条件的PDE。回顾下文章开头，第一步是设出PDE的近似解，我们一般采用多项式形式
。这里要注意，使用 Strong Form Galerkin 的时候，设的近似解既要满足 Essential boundary condition
 又要满足 Natural Boundary condition。也就是说在本例中，四个边界条件都需要满足。假设我们只用一个未知系数，那么这个多项式必须要是四次
的，即：
\begin_inset Formula 
\[
\tilde{y}=a_{1}x^{4}+a_{2}x^{3}+a_{3}x^{2}+a_{4}x+a_{5}.
\]

\end_inset

因为若要满足边界条件，我们需要列出四个等式，然后上式有五个未知系数，等于最终我们只有一个未知系数。现在我们将边界条件带入近似解：
\begin_inset Formula 
\[
\tilde{y}(2)=0;\quad\tilde{y}'(0)=-2;\quad\tilde{y}'''(0)=-10;\quad\tilde{y}''(2)=0.
\]

\end_inset

可以解得：
\begin_inset Formula 
\[
\tilde{y}(x)=-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}+a_{4}(x^{4}-24x^{2}+80),
\]

\end_inset

上式中， 
\begin_inset Formula $-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}$
\end_inset

 是
\begin_inset Formula $\phi_{0}$
\end_inset

，然后 
\begin_inset Formula $a_{4}$
\end_inset

是
\begin_inset Formula $c_{1}$
\end_inset

; 最后 
\begin_inset Formula $(x^{4}-24x^{2}+80)$
\end_inset

是
\begin_inset Formula $\phi_{1}$
\end_inset

。
\end_layout

\begin_layout Standard
接着计算残差或者余量：
\begin_inset Formula 
\[
R=\tilde{y}''''-10\tilde{y}''+4\tilde{y}+1,
\]

\end_inset

可见
\begin_inset Formula $R$
\end_inset

 是
\begin_inset Formula $a_{4}$
\end_inset

和
\begin_inset Formula $x$
\end_inset

的函数。最后计算加权积分：
\begin_inset Formula 
\[
\int_{0}^{2}\left[(\tilde{y}''''-10\tilde{y}''+4\tilde{y}+1)(x^{4}-24x^{2}+80)\right]\dd{x}=0.
\]

\end_inset

上式仅有一个未知数 
\begin_inset Formula $a_{4}$
\end_inset

，可以解得其值为 
\begin_inset Formula $0.2985$
\end_inset

，所以最终求得的近似解是：
\begin_inset Formula 
\[
\tilde{y}(x)=-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}+0.2985(x^{4}-24x^{2}+80),
\]

\end_inset

我用Matlab简单画了下上述近似解和精确解的比较，有没有很失望啊。这是由于我们只用了一个未知系数，如果用两个甚至更多的话，近似解是十分逼近精确解的，有兴趣的可
以自行尝试~
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/fanhan-3.png
	lyxscale 45
	scale 40

\end_inset


\end_layout

\begin_layout Remark
\begin_inset CommandInset label
LatexCommand label
name "rem1"

\end_inset

下面两个等式是由分部积分得来的：
\begin_inset Formula 
\begin{align*}
 & \int_{0}^{2}[y''\delta y'']\dd{x}=\int_{0}^{2}[y''''\delta y]\dd{x}-\left.y'''\delta y\right|_{0}^{2}+\left.y''\delta y'\right|_{0}^{2}\\
 & \int_{0}^{2}[10y'\delta y']\dd{x}=10(-\int_{0}^{2}[y''\delta y]\dd{x}+\left.y'\delta y\right|_{0}^{2})
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:var-bound"
plural "false"
caps "false"
noprefix "false"

\end_inset

 是把所有积分项合并，然后其余边界项统一称为 Boundary terms 得到的。
\end_layout

\begin_layout Section
弱形式Galerkin
\end_layout

\begin_layout Standard

\series bold
弱形式
\series default
 是应用最广也是被应用于有限元的方法。弱形式和强形式的本质是一致的，其实可以通过 
\series bold
分部积分
\series default
 将 强形式 转化为弱形式。强形式的主要缺点在于，所设的近似解函数需要有非常高阶的可微性。以 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 为例，待解的微分方程含有四阶导数项
\begin_inset Formula $y''''$
\end_inset

，所以所设的近似解函数需要保证四阶导数不为零，如果使用多项式形式的话，则最高次项至少要是四次。这和上文提到的由于四个边界条件都要满足，所以至少要是四次的结论是一
致的。
\end_layout

\begin_layout Standard
对应的，
\series bold
弱形式的优点在于可以通过分部积分将要求的可微次数减半，并且近似解函数只需满足 Essential boundary condition，不必满足
 Natural boundary condition
\series default
。直接说这个结论比较难以理解，还是结合一个简单的例子说明。
\end_layout

\begin_layout Standard
假设我们现在要解这样一个带边界条件的微分方程：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
y''-y-1=0;\quad\text{B.C.:}\;y(0)=1,\quad y'(1)=0
\]

\end_inset

其中 
\begin_inset Formula $y(0)=1$
\end_inset

 是 Essential boundary condition，
\begin_inset Formula $y'(1)=0$
\end_inset

 是Natural boundary condition。根据上一篇文章中强形式的思路，我们会将微分方程乘以一个 
\series bold
权函数
\series default
（基函数），然后令加权积分为零。在弱形式中，我们将乘的这个函数称为 
\series bold
检验函数
\series default
(test function)，用 
\begin_inset Formula $v(x)$
\end_inset

 表示。（后文会谈到这个 
\begin_inset Formula $v(x)$
\end_inset

 和待解函数的变分 
\begin_inset Formula $\delta y$
\end_inset

 不可告人的关系）。现在我们得到了下式：
\begin_inset Formula 
\[
\int_{0}^{1}\left[(y''-y-1)v\right]\dd{x}=\int_{0}^{1}y''v\dd{x}-\int_{0}^{1}yv\dd{x}-\int_{0}^{1}v\dd{x}=0.
\]

\end_inset

我们可以发现第二项积分内 
\begin_inset Formula $y$
\end_inset

 和 
\begin_inset Formula $v$
\end_inset

 的微分次数是一样的（都是零次微分），但是第一项积分内是二次微分而检验函数是零次微分。如果使用分部积分，就可以将一次微分转移到检验函数 
\begin_inset Formula $v$
\end_inset

上，
\series bold
这样 
\begin_inset Formula $y$
\end_inset

 的近似解函数只需是一阶线性的而不用是二次的了(对应上文提到的将要求的可微分次数减半)
\series default
。通过分部积分可得：
\begin_inset Formula 
\[
\int_{0}^{1}y''v\dd{x}=-\int_{0}^{1}y'v'\dd{x}+\left.y'v\right|_{0}^{1}
\]

\end_inset

这样积分内 
\begin_inset Formula $y$
\end_inset

 和 
\begin_inset Formula $v$
\end_inset

 的微分次数就一样了，看上去很舒服，处女座的福音啊，没错我就是。想起小学数学老师说的，数学是应该有美感的。不小心扯远了。。
\end_layout

\begin_layout Standard
现在我们来处理边界项 
\begin_inset Formula $\left.y'v\right|_{0}^{1}$
\end_inset

，
\begin_inset Formula 
\[
\left.y'v\right|_{0}^{1}=\left.y'v\right|_{x=1}-\left.y'v\right|_{x=0}=y'(1)v(1)-y'(0)v(0)
\]

\end_inset

由边界条件可知，
\begin_inset Formula $y'(1)=0$
\end_inset

 。另外由于在 
\begin_inset Formula $x=0$
\end_inset

 处有 Essential boundary condition 
\begin_inset Formula $y(0)=1$
\end_inset

 ，所以 
\begin_inset Formula $v(0)=0$
\end_inset

。（这是基函数的性质，即在有Essential boundary condition 的点处为零，后面会从另一个角度阐述这个性质）)。将 
\begin_inset Formula $y'(1)=0$
\end_inset

 和 
\begin_inset Formula $v(0)=0$
\end_inset

 代入边界项可得出边界项为零。当然这种情况只是巧合，一般情况下边界项不必是零。
\end_layout

\begin_layout Standard
现在，我们最初的加权积分等式被化简为了：
\begin_inset Formula 
\[
\int_{0}^{1}y'v'+yv+v\dd{x}=0.
\]

\end_inset

其实上式就已经是原微分方程的 
\series bold
弱形式
\series default
(Weak Form)了。
\end_layout

\begin_layout Standard
这里我希望大家能去变分法 
\begin_inset CommandInset ref
LatexCommand eqref
reference "def:extreme"
plural "false"
caps "false"
noprefix "false"

\end_inset

 那里 复习一下微分方程和原泛函数的关系。通过令 泛函数的一阶变分为零，经过分部积分的化简，可以得到积分内的微分方程。上文中我们从微分方程开始得到了弱形式，现在
可以继续反推到原泛函数。这么做的目的是为了显示泛函数和其对应的微分方程的可逆关系。具体步骤如下：
\end_layout

\begin_layout Enumerate
首先弱形式积分中的前两项(
\begin_inset Formula $y'v'$
\end_inset

 和 
\begin_inset Formula $yv$
\end_inset

 )中 
\begin_inset Formula $y$
\end_inset

 和
\begin_inset Formula $v$
\end_inset

（或者 
\begin_inset Formula $y^{(n)}$
\end_inset

和
\begin_inset Formula $v^{(n)}$
\end_inset

，上标
\begin_inset Formula $n$
\end_inset

代表
\begin_inset Formula $n$
\end_inset

次导数）都是线性的，而第三项只有线性的
\begin_inset Formula $v$
\end_inset

。所以我们定义：
\begin_inset Formula 
\[
B(y,v)=\int_{0}^{1}y'v'+yv\dd{x},\quad l(v)=\int_{0}^{1}v\dd{x}
\]

\end_inset

其中 
\begin_inset Formula $B(y,v)$
\end_inset

 称为双线性项(
\begin_inset Formula $y$
\end_inset

和
\begin_inset Formula $v$
\end_inset

或其微分都是线性的)，
\begin_inset Formula $l(v)$
\end_inset

 称为线性项。
\end_layout

\begin_layout Enumerate
这样，我们就可以得到对应微分方程的原泛函数是：
\begin_inset Formula 
\[
I(y)=\frac{1}{2}B(y,y)+l(y)=\frac{1}{2}\int_{0}^{1}(y')^{2}+y^{2}+2y\dd{x}
\]

\end_inset


\end_layout

\begin_layout Standard
有兴趣的可以试着用变分法将这个泛函数化为一开始的微分方程，可以发现是一致的。从弱形式到泛函数的过程中，实际上我们做了一个 
\begin_inset Formula $v\to\delta y$
\end_inset

 的替换。如果将弱形式中 
\begin_inset Formula $v$
\end_inset

 的替换成 
\begin_inset Formula $\delta y$
\end_inset

，则可以得到：
\begin_inset Formula 
\[
\int_{0}^{1}y'\delta y'+y\delta y+\delta y\dd{x}=0
\]

\end_inset

这个式子实际上就是泛函数 的一阶变分。一切都联系在一起了。如果将 
\begin_inset Formula $v$
\end_inset

 和 
\begin_inset Formula $\delta y$
\end_inset

 看成是等价，我们可以从另一个角度解释为什么 
\begin_inset Formula $v(x)$
\end_inset

 在 Essential boundary condition 的地方等于零。比如有 
\begin_inset Formula $y(0)=1$
\end_inset

 这个Essential B.C.，说明 
\begin_inset Formula $y(x)$
\end_inset

 在 
\begin_inset Formula $x=0$
\end_inset

 处是确定或固定的，只能等于
\begin_inset Formula $1$
\end_inset

，因此自然其变分
\begin_inset Formula $\delta y$
\end_inset

 在 
\begin_inset Formula $x=0$
\end_inset

 是等于零的，因为是确定的值没有变动的空间。
\end_layout

\begin_layout Standard
从弱形式还原到原泛函数 这段算是额外的内容，让我们回到如何用Weak Form Galerkin求解近似解。还是用那个大家已经看过两遍的 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的例子，方便和其余方法比较。
\end_layout

\begin_layout Standard
泛函为
\begin_inset Formula 
\[
I[y(x);x]=\int_{0}^{2}\left[0.5(y'')^{2}+5(y')^{2}+2y^{2}+y\right]\dd{x}-10y(0),
\]

\end_inset


\end_layout

\begin_layout Enumerate
Essential Boundary Conditions: 
\begin_inset Formula $y(2)=0$
\end_inset

；
\begin_inset Formula $y'(0)=-2$
\end_inset

。
\end_layout

\begin_layout Enumerate
Natural Boundary Conditions: ; 
\begin_inset Formula $y'''(0)=-10$
\end_inset

；
\begin_inset Formula $y''(2)=0$
\end_inset

。
\end_layout

\begin_layout Standard
求解最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的近似解函数 
\begin_inset Formula $y(x)$
\end_inset

。
\end_layout

\begin_layout Solution
和Strong Form Galerkin（SFG）一样， 我们从泛函数对应的微分方程开始：
\end_layout

\begin_layout Solution
\begin_inset Formula 
\[
y''''-10y''+4y+1=0,\quad0<x<2\quad\text{（加上上述题目中的边界条件）}
\]

\end_inset

第一步也和SFG类似，将微分方程乘以检验函数然后求积分:
\begin_inset Formula 
\[
\int_{0}^{2}y''''v-10y''v+4yv+v\dd{x}=0
\]

\end_inset

然后通过 分部积分 平衡微分，将 
\begin_inset Formula $y''''$
\end_inset

 中的两撇分给
\begin_inset Formula $v$
\end_inset

，
\begin_inset Formula $y''$
\end_inset

中的一撇分给 
\begin_inset Formula $v$
\end_inset

，可以得到：
\begin_inset Formula 
\[
\int_{0}^{2}y''v''+10y'v'+4yv+v\dd{x}+\left.(y'''-10y')v\right|_{0}^{2}-\left.y''v'\right|_{0}^{2}=0
\]

\end_inset

展开一下积分外的边界项：
\begin_inset Formula 
\[
\left[y'''(2)-10y'(2)\right]v(2)-\left[y'''[0]-10y'(0)\right]v(0)-y''(2)v'(2)+y''(0)v'(0)
\]

\end_inset

由于 
\begin_inset Formula $y(2)=0$
\end_inset

 和 
\begin_inset Formula $y'(0)=-2$
\end_inset

 这两个 Essential B.C, 可以得到 
\begin_inset Formula $v(2)=0$
\end_inset

 以及 
\begin_inset Formula $v'(0)=0$
\end_inset

。再加上那两个Natural B.C，边界项可最终化简为 
\begin_inset Formula $-10v(0)$
\end_inset

。
\series bold
注意 Natural B.C.
 正是被考虑在这里，所以近似函数直须满足 Essential B.C.
\series default
。这样整个式子就被化简为：
\begin_inset Formula 
\[
H(y,v)=\int_{0}^{2}y''v''+10y'v'+4yv+v\dd{x}-10v(0)=0.
\]

\end_inset

也就是弱形式。
\end_layout

\begin_layout Solution
和SFG一样，想要求解近似解，我们也需要先将其设成一个已知形式，这里我们依然使用多项式。这里弱形式的优势就显现出来了，现在多项式只需要保证二次导数不为零，同时只
有两个 Essential B.C.
 需要满足，因此多项式最少是二次的。如果设一个二次多项式，那么一共会有三个系数，为了满足两个 Essential B.C,最终只剩下一个未知待解系数。为了得到更精
确的解，这里我们设一个三次多项式，即含有两个未知系数。
\begin_inset Formula 
\[
\tilde{y}(x)=a_{0}+a_{1}x+a_{2}x^{2}+a_{3}x^{3}
\]

\end_inset


\series bold
代入两个Essential B.C.解得
\series default
：
\begin_inset Formula 
\[
\tilde{y}(x)=4-2x+a_{2}(x^{2}-4)+a_{3}(x^{3}-8)
\]

\end_inset

对比表标准形式 
\begin_inset Formula $\phi_{0}+\sum_{i}c_{i}\phi_{i}$
\end_inset

 ，发现上式中 
\begin_inset Formula $4-2x$
\end_inset

是 
\begin_inset Formula $\phi_{0}$
\end_inset

；
\begin_inset Formula $a_{2}$
\end_inset

 是 
\begin_inset Formula $c_{1}$
\end_inset

，
\begin_inset Formula $x^{2}-4$
\end_inset

 是 
\begin_inset Formula $\phi_{1}$
\end_inset

；
\begin_inset Formula $a_{3}$
\end_inset

 是 
\begin_inset Formula $c_{2}$
\end_inset

，
\begin_inset Formula $x^{3}-8$
\end_inset

 是
\begin_inset Formula $\phi_{2}$
\end_inset

。这样就可以把 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 统一成 
\begin_inset Formula $\tilde{y}(x)=\phi_{0}+c_{i}\phi_{i}$
\end_inset

的形式。
\end_layout

\begin_layout Solution
现在我们将弱形式 
\begin_inset Formula $H(y,v)$
\end_inset

 中的所有 
\begin_inset Formula $y$
\end_inset

 替换成 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

, 所有 
\begin_inset Formula $v$
\end_inset

 替换成 
\begin_inset Formula $\phi_{i}$
\end_inset

(不包括
\begin_inset Formula $\phi_{0}$
\end_inset

)。这样我们可以得到两个式子：
\begin_inset Formula 
\begin{align*}
 & H[\tilde{y}(x),\phi_{1}]=0\\
 & H[\tilde{y}(x),\phi_{2}]=0
\end{align*}

\end_inset

这两个方程中仅有 
\begin_inset Formula $c_{1}$
\end_inset

，
\begin_inset Formula $c_{2}$
\end_inset

 两个未知量，是可解的。最终解得 
\begin_inset Formula $c_{1}=1.0682$
\end_inset

，
\begin_inset Formula $c_{2}=-0.2341$
\end_inset

。所以通过Weak Form Galerkin得到的近似解为：
\begin_inset Formula 
\[
\tilde{y}(x)=-0.234x^{3}+1.068x^{2}-2x+1.600.
\]

\end_inset


\end_layout

\begin_layout Solution
同样，用Matlab将这次结果和精确解以及上一篇文章中的SFG的结果进行对比。可以发现这次逼近了精确解很多。这是由于这次使用了两个未知系数而上次SFG只用了一个
。我试过如果SFG也用两个未知系数，其结果会比WFG更精确（对于这个例子）。但是我们仍然可以看出弱形式的优势，对于这个例子，弱形式在使用更低次的多项式的情况下，
依然比强形式的结果逼近精确解（弱形式使用了三次多项式，强形式使用了四次多项式）。
\end_layout

\begin_layout Solution
\begin_inset Graphics
	filename inset/fanhan-4.png
	lyxscale 40
	scale 40

\end_inset


\end_layout

\begin_layout Chapter
再议变分
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "变分法中的欧拉方程的细致讲解&详细推导"
target "https://www.cnblogs.com/jiangongyuxiao/p/15088070.html"
literal "false"

\end_inset


\end_layout

\begin_layout Section
变分学基本引理
\end_layout

\begin_layout Standard
因为整个变分中都会大量用到这个引理，所以书中将其提出来单独作为一个引理。
\end_layout

\begin_layout Standard
当然，这个引理也是相当直观的，直观上，如果一个函数 
\begin_inset Formula $f(x)$
\end_inset

 和任一高阶可微的函数 
\begin_inset Formula $\eta(x)$
\end_inset

 正交，那么这个函数理应满足 
\begin_inset Formula $f(x)\equiv0$
\end_inset

。
\end_layout

\begin_layout Lemma
如果 
\begin_inset Formula $f(x)$
\end_inset

在 
\begin_inset Formula $[x_{1},x_{2}]$
\end_inset

 上连续，
\begin_inset Formula $\eta(x)$
\end_inset

 是在 
\begin_inset Formula $[x_{1},x_{2}]$
\end_inset

上 
\begin_inset Formula $N$
\end_inset

 次可微的任意函数（ 
\begin_inset Formula $N$
\end_inset

 可为任意自然数）。如果对于任意的 
\begin_inset Formula $\eta(x)$
\end_inset

，都恒有
\begin_inset Formula 
\begin{equation}
\int_{x_{1}}^{x_{2}}f(x)\eta(x)\dd{x}=0\label{eq:j1.1}
\end{equation}

\end_inset

则必有
\begin_inset Formula 
\[
f(x)\equiv0,\quad\forall x\in[x_{1},x_{2}]
\]

\end_inset


\end_layout

\begin_layout Section
单方程,单变量,欧拉方程
\end_layout

\begin_layout Subsection
单方程,单变量,一阶导
\end_layout

\begin_layout Theorem
设泛函
\begin_inset Formula 
\begin{equation}
I\left[y(\cdot)\right]=\int_{x_{1}}^{x_{2}}F(x,y,y')\dd{x}\label{eq:j2.1}
\end{equation}

\end_inset

其中
\begin_inset Formula $F$
\end_inset

是有着三个独立变量的已知函数，且具有二阶连续偏导数，其可取函数集为
\begin_inset Formula 
\begin{equation}
\mathbb{Y}_{1,1,1}=\left\{ y(x)\left|\begin{array}{c}
y(x)\in C_{[x_{1},x_{2}]}^{(2)}\\
y(x_{1})=y_{1},\;y(x_{2})=y_{2}
\end{array}\right.\right\} \label{eq:j2.2}
\end{equation}

\end_inset


\begin_inset Formula $Y(x)\in\mathbb{Y}_{1,1,1}$
\end_inset

使泛函
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

取得极小值的必要条件是：
\begin_inset Formula $Y(x)$
\end_inset

是下列微分方程的解
\begin_inset Formula 
\begin{equation}
F_{y}-\frac{\dd}{\dd{x}}F_{y'}=0\label{eq:j2.3}
\end{equation}

\end_inset

其中
\begin_inset Formula $F_{y}=\partial F/\partial y=F_{2}^{\prime}$
\end_inset

，
\begin_inset Formula $F_{y}^{\prime}=\partial F/\partial y'=F_{3}^{\prime}$
\end_inset

（下标的数字表示变量的槽位）。
\end_layout

\begin_layout Remark
\begin_inset Formula $\mathbb{Y}_{1,1,1}$
\end_inset

的含义是单方程，单变量，一阶导数。
\begin_inset Formula $C_{[x_{1},x_{2}]}^{(2)}$
\end_inset

 表示
\begin_inset Formula $2$
\end_inset

阶连续。
\begin_inset Formula $y(x_{1})=y_{1}$
\end_inset

，
\begin_inset Formula $y(x_{2})=y_{2}$
\end_inset

 是边界条件。
\end_layout

\begin_layout Proof
对于我们期望的极值函数
\begin_inset Formula $Y(x)$
\end_inset

，它应当满足这样的性质——我们将其叠加上一个任意的函数
\begin_inset Formula $\alpha\cdot\eta(x)$
\end_inset

，只要能使得 
\begin_inset Formula $y(x)=Y(x)+\alpha\cdot\eta(x)$
\end_inset

满足边界条件
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

，就有 
\begin_inset Formula $\left.\left[\frac{\dd{I(Y+\alpha\eta)}}{\dd{\alpha}}\right]\right|_{\alpha=0}=0$
\end_inset

。 其中 
\begin_inset Formula $\alpha$
\end_inset

 是一个充分小的实数，我们期望它的行为类似于 
\begin_inset Formula $\dd{x}$
\end_inset

，
\begin_inset Formula $\eta(x)$
\end_inset

 是满足下列条件的任意函数
\begin_inset Formula 
\begin{equation}
\mathbb{Y}_{1,1,1}^{(0)}=\left\{ \eta(x)\left|\begin{array}{c}
\eta(x)\in C_{[x_{1},x_{2}]}^{(2)}\\
\eta(x_{1})=0,\;\eta(x_{2})=0_{2}
\end{array}\right.\right\} \label{eq:j2.4}
\end{equation}

\end_inset


\begin_inset Box Frameless
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Enumerate
\begin_inset Formula $\alpha$
\end_inset

 理论上可以是任意实数，但实际上我们只会用到 
\begin_inset Formula $\left.\left[\frac{\dd{I[y(\cdot)]}}{\dd{\alpha}}\right]\right|_{\alpha=0}$
\end_inset

，所以我们可以把 
\begin_inset Formula $\alpha$
\end_inset

 当作类似于 
\begin_inset Formula $\varepsilon$
\end_inset

 的工具人。 
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\eta$
\end_inset

 满足的 
\begin_inset Formula $\mathbb{Y}_{1,1,1}^{(0)}$
\end_inset

 和 
\begin_inset Formula $y$
\end_inset

 满足的 
\begin_inset Formula $\mathbb{Y}_{1,1,1}$
\end_inset

唯一区别就在于边界条件为零，这是为了确保 
\begin_inset Formula $Y,y\in\mathbb{Y}_{1,1,1}$
\end_inset

。
\end_layout

\end_inset

证明过程中，需要用到分部积分，即
\begin_inset Formula 
\begin{align*}
\left.\frac{\dd{I(Y+\alpha\eta)}}{\dd{\alpha}}\right|_{\alpha=0} & =\int_{x_{1}}^{x_{2}}\eta\left(\frac{\partial F}{\partial y}+\eta'\frac{\partial F}{\partial y'}\right)\dd{x}\\
 & ={\color{blue}\left.\left(\eta\frac{\partial F}{\partial y'}\right)\right|_{x_{1}}^{x_{2}}}+\int_{x_{1}}^{x_{2}}\eta\left(\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}\right)\dd{x}
\end{align*}

\end_inset

有限元中公式中，这个边界项不一定能丢掉（若不满足 
\begin_inset Formula $\delta y=0$
\end_inset

 或 
\begin_inset Formula $\frac{\partial F}{\partial y'}=0$
\end_inset

）。
\end_layout

\begin_layout Subsection
单方程,单变量,高阶导
\end_layout

\begin_layout Standard
实际上， 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

 很容易向高次情形推广。如果约定 
\begin_inset Formula $\dd[0]{y}/\dd{x}^{0}=y$
\end_inset

 ， 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

 可以改写为
\begin_inset Formula 
\begin{equation}
\sum_{k=0}^{n}(-1)^{k}\left(\frac{\dd[k]}{\dd{x}^{k}}\frac{\partial F}{\partial y^{(k)}}\right)=0.\label{eq:j2.10}
\end{equation}

\end_inset

当泛函中最高含有
\begin_inset Formula $n$
\end_inset

阶导数时。
\end_layout

\begin_layout Theorem
设泛函
\begin_inset Formula 
\begin{equation}
I\left[y(\cdot)\right]=\int_{x_{1}}^{x_{2}}F(x,y,y',y'',\cdots,y^{(n)})\dd{x}\label{eq:j2.11}
\end{equation}

\end_inset

其中
\begin_inset Formula $F$
\end_inset

是以
\begin_inset Formula $x,y$
\end_inset

以及
\begin_inset Formula $y$
\end_inset

各阶导数做为独立变量的已知函数，且具有
\begin_inset Formula $n$
\end_inset

阶连续偏导数，其可取函数集为
\begin_inset Formula 
\begin{equation}
\mathbb{Y}_{1,1,n}=\left\{ y(x)\left|\begin{array}{c}
y(x)\in C_{[x_{1},x_{2}]}^{(2n)}\\
y^{(k)}(x_{1})=y_{1}^{(k)},\;y^{(k)}(x_{2})=y_{2}^{(k)},\;k=0,1,\cdots,r
\end{array}\right.\right\} \label{eq:j2.12}
\end{equation}

\end_inset


\begin_inset Formula $Y(x)\in\mathbb{Y}_{1,1,n}$
\end_inset

使泛函
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

取得极小值的必要条件是：
\begin_inset Formula $Y(x)$
\end_inset

是下列微分方程的解
\begin_inset Formula 
\begin{equation}
F_{y}-\frac{\dd}{\dd{x}}F_{y'}+\frac{\dd[2]}{\dd{x}^{2}}F_{y''}+\cdots+(-1)^{n}\frac{\dd[n]}{\dd{x}^{n}}F_{y^{(n)}}=0\label{eq:j2.13}
\end{equation}

\end_inset

或者采用求和的形式记录之，则为
\begin_inset Formula 
\[
\sum_{k=0}^{n}(-1)^{k}\left(\frac{\dd[k]}{\dd{x}^{k}}\frac{\partial F}{\partial y^{(k)}}\right)=0.
\]

\end_inset

其中 
\begin_inset Formula $\frac{\partial F}{\partial y^{(k)}}=F_{y^{(k)}}$
\end_inset

，表示
\begin_inset Formula $F$
\end_inset

的偏导数，对于
\begin_inset Formula $y$
\end_inset

的
\begin_inset Formula $n$
\end_inset

阶导数
\begin_inset Formula $y^{(k)}$
\end_inset

。
\end_layout

\begin_layout Proof
定理的理解与证明。该证明的核心就在于将
\begin_inset Formula $\eta(n)$
\end_inset

转化为
\begin_inset Formula $\eta$
\end_inset

，然后用变分学基本引理进行证明。回忆一下： 
\begin_inset Formula $1$
\end_inset

阶情形的证明方式是进行
\begin_inset Formula $1$
\end_inset

次分部积分。因此，我们不难想象
\begin_inset Formula $n$
\end_inset

阶的证明也是基于
\begin_inset Formula $n$
\end_inset

次分部积分。我们不加证明（事实上，证明只需对函数进行 
\begin_inset Formula $n$
\end_inset

 次分部积分即可，十分显明）地引入 
\begin_inset Formula $n$
\end_inset

 次分部积分的
\series bold
引理
\series default
——
\begin_inset Newline newline
\end_inset

若
\begin_inset Formula $\eta^{(k)}(x_{1})=0$
\end_inset

，
\begin_inset Formula $\eta^{(k)}(x_{2})=0$
\end_inset

 ，
\begin_inset Formula $\forall k=0,1,\cdots,n-1$
\end_inset

，则
\begin_inset Formula 
\begin{equation}
\int_{x_{1}}^{x_{2}}\eta^{(n)}\frac{\partial F}{\partial y^{(n)}}\dd{x}=(-1)^{n}\int_{x_{1}}^{x_{2}}\eta\left(\frac{\dd[n]}{\dd{x}^{n}}\frac{\partial F}{\partial y^{(n)}}\right)\dd{x}\label{eq:j2.15}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
后续的证明仿照 2.9 其实就水到渠成了。
\begin_inset Formula 
\[
\left.\frac{\dd{I(Y+\alpha\eta)}}{\dd{\alpha}}\right|_{\alpha=0}=\int_{x_{1}}^{x_{2}}\left(\eta\frac{\partial F}{\partial y}+\eta'\frac{\partial F}{\partial y'}+\cdots+\eta^{(n)}\frac{\partial F}{\partial y^{(n)}}\right)\dd{x}
\]

\end_inset


\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Theorem
如果不丢掉边界项：
\begin_inset Formula 
\begin{align*}
\int_{x_{1}}^{x_{2}}\eta^{(k)}\,f\dd{x} & ={\color{blue}\left.(-1)^{0}\left(\eta^{(k-1)}f\right)\right|_{x_{1}}^{x_{2}}}+(-1)^{1}\int_{x_{1}}^{x_{2}}\eta^{(k-1)}\frac{\dd}{\dd{x}}f\dd{x}\\
 & ={\color{blue}\cdots+(-1)^{1}\left.\left(\eta^{(k-2)}\frac{\dd}{\dd{x}}f\right)\right|_{x_{1}}^{x_{2}}}+(-1)^{2}\int_{x_{1}}^{x_{2}}\eta^{(k-2)}\frac{\dd[2]}{\dd{x}^{2}}f\dd{x}\\
 & ={\color{blue}\cdots\cdots}
\end{align*}

\end_inset

前面的推导中只不过是令
\begin_inset Formula $f=\partial F/\partial y^{(k)}$
\end_inset

。容易总结出含有边界项的一般形式：
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}\eta^{(k)}f\dd{x}={\color{blue}\sum_{\ell=0}^{k-1}\left.(-1)^{\ell}\left(\eta^{(k-1-\ell)}\frac{\dd[\ell]}{\dd{x}^{\ell}}f\right)\right|_{x_{1}}^{x_{2}}}+(-1)^{k}\int_{x_{1}}^{x_{2}}\eta\left(\frac{\dd[k]}{\dd{x}^{k}}f\right)\dd{x}
\]

\end_inset

with 
\begin_inset Formula $\frac{\dd[0]}{\dd{x}^{0}}f=f$
\end_inset

。
\end_layout

\begin_layout Example
应用到上面的
\begin_inset Formula $F(x,y,y',y'',\cdots,y^{(n)})$
\end_inset

，如果不丢掉边界项，
\begin_inset Formula $\delta F=0$
\end_inset

给出的方程应该是
\begin_inset Formula 
\begin{align*}
\delta F(y,\cdots) & =F_{y}\\
 & +{\color{blue}\left.\eta^{(0)}\,F_{y'}\right|_{x_{1}}^{x_{2}}}-\dd{F_{y'}}\\
 & +{\color{blue}\left.\eta^{(1)}\,F_{y^{(2)}}\right|_{x_{1}}^{x_{2}}-\left.\eta^{(0)}\,\dd{F_{y^{(2)}}}\right|_{x_{1}}^{x_{2}}}+\dd[2]{F_{y^{(2)}}}\\
 & +{\color{blue}\left.\eta^{(2)}\,F_{y^{(3)}}\right|_{x_{1}}^{x_{2}}-\left.\eta^{(1)}\,\dd{F_{y^{(3)}}}\right|_{x_{1}}^{x_{2}}+\left.\eta^{(0)}\,\dd[2]{F_{y^{(3)}}}\right|_{x_{1}}^{x_{2}}}-\dd[3]{F_{y^{(3)}}}
\end{align*}

\end_inset

其中
\begin_inset Formula $F_{y'}=\partial F/\partial y'$
\end_inset

，
\begin_inset Formula $\dd{F_{y'}}$
\end_inset

是
\begin_inset Formula $\frac{\dd{F_{y'}}}{\dd{x}}$
\end_inset

的简写，其他类似。
\end_layout

\begin_layout Section
多方程单变量欧拉方程
\end_layout

\begin_layout Standard
在实际问题中，我们可能遇到多个独立变元一起出现的约束极值问题，例如给出两个变元
\begin_inset Formula $y_{1}(x)$
\end_inset

和
\begin_inset Formula $y_{2}(x)$
\end_inset

，并令 
\begin_inset Formula $F=y_{1}^{\prime2}+y_{2}^{\prime2}+2y_{1}y_{2}$
\end_inset

，求泛函 
\begin_inset Formula $I[y_{1}(\cdot),y_{2}(\cdot)]=\int_{x_{1}}^{x_{2}}F(x,y_{1},y_{2};y_{1}^{\prime},y_{2}^{\prime})\dd{x}$
\end_inset

 的极值。
\end_layout

\begin_layout Subsection
两方程单变量一阶导
\end_layout

\begin_layout Standard
先考虑两方程情形，令 
\begin_inset Formula $y=Y_{k}+\alpha\eta_{k}$
\end_inset

，
\begin_inset Formula $k=1,2$
\end_inset

，并令
\begin_inset Formula 
\begin{align*}
\Phi(\alpha) & =I[y_{1}(\cdot),y_{2}(\cdot)]\\
 & =\int_{x_{1}}^{x_{2}}F(x,Y_{1}+\alpha\eta_{1},y_{2}+\alpha\eta_{2};Y_{1}^{\prime}+\alpha\eta_{1}^{\prime},Y_{2}^{\prime}+\alpha\eta_{2}^{\prime})\dd{x}
\end{align*}

\end_inset

则函数组
\begin_inset Formula $Y_{k}$
\end_inset

使得泛函取得极值的必要条件为
\begin_inset Formula $\Phi'(0)=0$
\end_inset

，即
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}\left(\eta_{1}\frac{\partial F}{\partial y_{1}}+\eta_{1}^{\prime}\frac{\partial F}{\partial y_{1}^{\prime}}\right)\dd{x}+\int_{x_{1}}^{x_{2}}\left(\eta_{2}\frac{\partial F}{\partial y_{2}}+\eta_{2}^{\prime}\frac{\partial F}{\partial y_{2}^{\prime}}\right)\dd{x}=0.
\]

\end_inset

应用分部积分引理
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.15"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}\eta_{1}\left(\frac{\partial F}{\partial y_{1}}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y_{1}^{\prime}}\right)\dd{x}+\int_{x_{1}}^{x_{2}}\eta_{2}\left(\frac{\partial F}{\partial y_{2}}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y_{2}^{\prime}}\right)\dd{x}=0.
\]

\end_inset

根据变分学基本引理
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

，以及
\begin_inset Formula $\eta_{1}$
\end_inset

，
\begin_inset Formula $\eta_{2}$
\end_inset

的任意性，自然得到：
\begin_inset Formula 
\begin{equation}
\begin{cases}
\frac{\partial F}{\partial y_{1}}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y_{1}^{\prime}}=0\\
\frac{\partial F}{\partial y_{2}}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y_{2}^{\prime}}=0
\end{cases}\label{eq:j3.4}
\end{equation}

\end_inset

也就是说，对于两方程情形，对应泛函取到极值的必要条件为上式。
\end_layout

\begin_layout Subsection
多方程单变量高阶导
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\begin{cases}
\sum_{n=0}^{N_{1}}(-1)^{n}\frac{\dd[n]}{\dd{x}^{n}}\frac{\partial F}{\partial y_{1}^{(n)}}=0\\
\sum_{n=0}^{N_{2}}(-1)^{n}\frac{\dd[n]}{\dd{x}^{n}}\frac{\partial F}{\partial y_{2}^{(n)}}=0\\
\vdots\\
\sum_{n=0}^{N_{M}}(-1)^{n}\frac{\dd[n]}{\dd{x}^{n}}\frac{\partial F}{\partial y_{M}^{(n)}}=0
\end{cases}\label{eq:3.8}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
多方程多变量的欧拉方程
\end_layout

\begin_layout Standard
通常来说，因为我们现实世界是三维的，所以我们会遇到多变量的函数。例如电场强度函数可能就是一个三维 
\begin_inset Formula $(x,y,z)$
\end_inset

函数，也就是三变量的函数。对于它的极值问题，我们依然可以类似地方法进行求解。
\end_layout

\begin_layout Subsection
分部积分向高维的推广
\end_layout

\begin_layout Standard
我们将
\begin_inset Formula $\eta'$
\end_inset

转换为
\begin_inset Formula $\eta$
\end_inset

中用到了一个重要的公式——分部积分公式。而分部积分公式基于
\begin_inset Quotes erd
\end_inset

牛顿莱布尼茨公式
\begin_inset Quotes erd
\end_inset

。
\series bold
而接下来我们要处理的函数，将是多变量的函数，此时我们就需要一个
\begin_inset Quotes erd
\end_inset

高维的牛顿莱布尼茨公式
\begin_inset Quotes erd
\end_inset


\series default
。幸运的是，我们高数学的
\begin_inset Quotes erd
\end_inset

格林公式
\begin_inset Quotes erd
\end_inset

和 
\begin_inset Quotes erd
\end_inset

高斯公式
\begin_inset Quotes erd
\end_inset

正是
\begin_inset Quotes erd
\end_inset

牛顿莱布尼茨公式
\begin_inset Quotes erd
\end_inset

向高维的推广，它们的推广被称为
\begin_inset Quotes erd
\end_inset

广义斯托克斯公式
\begin_inset Quotes erd
\end_inset

。如果有对“广义斯托克斯公式”感兴趣的同学，可以看文章
\begin_inset CommandInset href
LatexCommand href
name "广义斯托克斯公式-MamiyaHasaki的博客"
target "https://blog.csdn.net/MamiyaHasaki/article/details/119297305"
literal "false"

\end_inset

。
\end_layout

\begin_layout Example
二维：假设函数
\begin_inset Formula $\eta(x,y)$
\end_inset

定义在区域 
\begin_inset Formula $D$
\end_inset

上，区域 
\begin_inset Formula $D$
\end_inset

的边界 
\begin_inset Formula $\partial D=L$
\end_inset

，并满足边界条件：
\begin_inset Formula $\left.\eta\right|_{L}=0$
\end_inset

。高数讲的格林公式是：
\begin_inset Formula 
\begin{equation}
\int_{D}\left(\frac{\partial Q}{\partial x}-\frac{\partial P}{\partial y}\right)\dd{x}\dd{y}=\oint_{L}P\dd{x}+Q\dd{y}\label{eq:j4.1}
\end{equation}

\end_inset

将
\begin_inset Formula $Q=\eta\cdot f$
\end_inset

，
\begin_inset Formula $P=0$
\end_inset

代入，考虑到
\begin_inset Formula ${\color{blue}\left.\eta\right|_{L}=0}$
\end_inset

，得
\begin_inset Formula 
\begin{align}
 & \int_{D}\frac{\partial(\eta\cdot f)}{\partial x}\dd{x}\dd{y}={\color{blue}\oint_{L}\eta}(f\dd{y})=0\label{eq:j4.2}\\
\Rightarrow & \int_{D}(\frac{\partial\eta}{\partial x})f\cdot\dd{x}\dd{y}=-\int_{D}\eta(\frac{\partial f}{\partial x})\cdot\dd{x}\dd{y}\label{eq:j4.3}
\end{align}

\end_inset

如果我们假设
\begin_inset Formula $\left.\eta\right|_{L}$
\end_inset

 满足 
\begin_inset Formula $n−1$
\end_inset

 阶导的边界条件，即 
\begin_inset Formula $\left.\eta\right|_{L}=0$
\end_inset

，
\begin_inset Formula $\left.\frac{\partial\eta}{\partial x}\right|_{L}=0$
\end_inset

，
\begin_inset Formula $\cdots$
\end_inset

，
\begin_inset Formula $\left.\frac{\partial^{n-1}\eta}{\partial x^{n-1}}\right|_{L}=0$
\end_inset

，那么就可以得到二维的 
\begin_inset Formula $n$
\end_inset

 次分部积分公式
\begin_inset Formula 
\begin{equation}
\int_{D}\left(\frac{\partial^{n}\eta}{\partial x^{n}}\right)f\cdot\dd{x}\dd{y}=(-1)^{n}\int_{D}\eta\left(\frac{\partial^{n}f}{\partial x^{n}}\right)\cdot\dd{x}\dd{y}.\label{eq:j4.4}
\end{equation}

\end_inset

同理，令 
\begin_inset Formula $P=-\eta\cdot f$
\end_inset

，
\begin_inset Formula $Q=0$
\end_inset

代入
\begin_inset Formula 
\begin{equation}
\int_{D}\left(\frac{\partial^{n}\eta}{\partial y^{n}}\right)f\cdot\dd{x}\dd{y}=(-1)^{n}\int_{D}\eta\left(\frac{\partial^{n}f}{\partial y^{n}}\right)\cdot\dd{x}\dd{y}.\label{eq:j4.5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
三维情形也是同理，我们采用 
\series bold
高斯公式
\series default
：
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\left(\frac{\partial P}{\partial x}+\frac{\partial Q}{\partial y}+\frac{\partial R}{\partial z}\right)\dd{V}=\oint_{\partial\Omega}\left(P\cos\alpha+Q\cos\beta+R\cos\gamma\right)\dd{S}\label{eq:j4.6}
\end{equation}

\end_inset

其中
\begin_inset Formula $\alpha$
\end_inset

，
\begin_inset Formula $\beta$
\end_inset

，
\begin_inset Formula $\gamma$
\end_inset

 是曲线法向与笛卡尔系的
\begin_inset Formula $\sbf e_{x}$
\end_inset

，
\begin_inset Formula $\sbf e_{y}$
\end_inset

，
\begin_inset Formula $\sbf e_{z}$
\end_inset

所成的夹角。考虑区域
\begin_inset Formula $\Omega$
\end_inset

上的边界条件为
\begin_inset Formula $\left.\eta\right|_{\partial\Omega}=0$
\end_inset

，代入
\begin_inset Formula $P=\eta\cdot f$
\end_inset

，
\begin_inset Formula $Q=0$
\end_inset

，
\begin_inset Formula $R=0$
\end_inset

，等式右端为
\begin_inset Formula $0$
\end_inset

：
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\frac{\partial(\eta\cdot f)}{\partial x}\dd{V}=0\label{eq:j4.7}
\end{equation}

\end_inset

进行分部积分得到：
\begin_inset Formula 
\begin{equation}
\int_{\Omega}\left(\frac{\partial\eta}{\partial x}\right)f\dd{V}=-\int_{\Omega}\eta\left(\frac{\partial f}{\partial x}\right)\dd{V}.\label{eq:j4.8}
\end{equation}

\end_inset

仿照格林公式的方式，可以推广到每个维度的 
\begin_inset Formula $n$
\end_inset

阶导数
\begin_inset Formula 
\[
\int_{\Omega}\left(\frac{\partial^{n}\eta}{\partial x^{n}}\right)f\cdot\dd{V}=(-1)^{n}\int_{\Omega}\eta\left(\frac{\partial^{n}f}{\partial x^{n}}\right)\cdot\dd{V}
\]

\end_inset


\end_layout

\begin_layout Subsection
三维问题的边界项
\end_layout

\begin_layout Example
矢量场 
\begin_inset Formula $\varphi\,\sbf f$
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\int_{\Omega}\nabla\cdot\left(\varphi\,\sbf f\right)\dd{V}=\oint_{\partial\Omega}(\varphi\,\sbf f)\dd{\sbf S}
\]

\end_inset

即
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega}\left[(\nabla\varphi)\cdot\sbf f+\varphi\nabla\cdot\sbf f\right]\dd{V}=\oint_{\partial\Omega}(\varphi\,\sbf f)\dd{\sbf S}\\
\Rightarrow & \int_{\Omega}\left(\varphi\nabla\cdot\sbf f\right)\dd{V}=-\int_{\Omega}\left[(\nabla\varphi)\cdot\sbf f\right]\dd{V}+\oint_{\partial\Omega}(\varphi\,\sbf f)\dd{\sbf S}
\end{align*}

\end_inset


\end_layout

\begin_layout Example
标量场 
\begin_inset Formula $\varphi\,\psi$
\end_inset


\begin_inset Formula 
\[
\int_{\Omega}\nabla\cdot\nabla\left(\varphi\,\psi\right)\dd{V}=\oint_{\partial\Omega}\nabla\left(\varphi\,\psi\right)\dd{\sbf S}
\]

\end_inset

即
\begin_inset Formula 
\[
\int_{\Omega}\left[\nabla\cdot\left(\varphi\nabla\psi+\psi\nabla\varphi\right)\right]\dd{V}=\int_{\Omega}\left[\varphi\nabla^{2}\psi+\psi\nabla^{2}\varphi+2(\nabla\psi\cdot\nabla\varphi)\right]\dd{V}
\]

\end_inset

如果
\begin_inset Formula $\psi=\varphi=\phi$
\end_inset

，给出
\begin_inset Formula 
\[
\int_{\Omega}\phi\nabla^{2}\phi\dd{V}=\oint_{\partial\Omega}\phi\nabla\phi\dd{\sbf S}-\int_{\Omega}\nabla\phi\cdot\nabla\phi\dd{V}
\]

\end_inset


\end_layout

\begin_layout Chapter
广义斯托克斯公式
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "广义斯托克斯公式"
target "https://blog.csdn.net/MamiyaHasaki/article/details/119297305"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
梯度定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\dd{V}\nabla\phi=\oint_{S}\dd{\sbf S}\phi\label{eq:jA.13}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
散度定理（高斯定理）：
\begin_inset Formula 
\begin{equation}
\int_{V}\dd{V}\nabla\cdot\sbf A=\oint_{S}\dd{\sbf S}\cdot\sbf A\label{eq:jA.14}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
旋度定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\dd{V}\nabla\times\sbf A=\oint_{S}\dd{\sbf S}\times\sbf A\label{eq:jA.15}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
叉乘–梯度定理：
\begin_inset Formula 
\begin{equation}
\int_{S}\dd{\sbf S}\times\nabla\phi=\oint_{C}\dd{\sbf\ell}\,\phi\label{eq:jA.16}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
斯托克斯（stokes）定理：
\begin_inset Formula 
\begin{equation}
\int_{S}\dd{\sbf S}\nabla\times\sbf A=\oint_{C}\dd{\sbf\ell}\cdot\sbf A\label{eq:jA.17}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
叉乘–nabla–叉乘定理：
\begin_inset Formula 
\begin{equation}
\int_{S}\dd{\sbf S}\times\nabla\times\sbf A=\oint_{C}\dd{\sbf\ell}\times\sbf A\label{eq:jA.18}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
第一标量格林定理
\begin_inset Formula 
\begin{equation}
\int_{V}\left[a\nabla\cdot{\color{blue}(u\nabla b)}+u(\nabla a)\cdot(\nabla b)\right]\dd{V}=\oint_{S}a{\color{blue}u\frac{\partial b}{\partial n}}\dd{S}\label{eq:jA.19}
\end{equation}

\end_inset


\begin_inset Formula $u=1$
\end_inset

的简化形式为：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[a{\color{blue}(\nabla^{2}b)}+(\nabla a)\cdot(\nabla b)\right]\dd{V}=\oint_{S}a{\color{blue}\frac{\partial b}{\partial n}}\dd{S}\label{eq:jA.19b}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
第二标量格林定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[a\nabla\cdot{\color{blue}(u\nabla b)}-b\nabla\cdot{\color{brown}(u\nabla a)}\right]\dd{V}=\oint_{S}u({\color{blue}a\frac{\partial b}{\partial n}}{\color{brown}-b\frac{\partial a}{\partial n}})\dd{S}\label{eq:jA.20}
\end{equation}

\end_inset


\begin_inset Formula $u=1$
\end_inset

的简化形式为：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[a{\color{blue}(\nabla^{2}b)}-b{\color{brown}(\nabla^{2}a)}\right]\dd{V}=\oint_{S}({\color{blue}a\frac{\partial b}{\partial n}}{\color{brown}-b\frac{\partial a}{\partial n}})\dd{S}\label{eq:jA.20b}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
第一矢量格林定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[u{\color{blue}(\nabla\times\sbf a)}\cdot{\color{brown}(\nabla\times\sbf b)}-{\color{blue}\sbf a}\cdot(\nabla\times{\color{brown}u\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,u({\color{blue}\sbf a}\times{\color{brown}\nabla\times\sbf b})\cdot\sbf n\dd{S}\label{eq:jA.21}
\end{equation}

\end_inset


\begin_inset Formula $u=1$
\end_inset

的简化形式为：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[{\color{blue}(\nabla\times\sbf a)}\cdot{\color{brown}(\nabla\times\sbf b)}-{\color{blue}\sbf a}\cdot(\nabla\times{\color{brown}\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,({\color{blue}\sbf a}\times{\color{brown}\nabla\times\sbf b})\cdot\sbf n\dd{S}\label{eq:jA.21b}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
第二矢量格林定理：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[\sbf b\cdot(\nabla\times u{\color{blue}\nabla\times\sbf a})-\sbf a\cdot(\nabla\times u{\color{brown}\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,u(\sbf a\times{\color{brown}\nabla\times\sbf b}-\sbf b\times{\color{blue}\nabla\times\sbf a})\cdot\sbf n\dd{S}\label{eq:jA.22}
\end{equation}

\end_inset


\begin_inset Formula $u=1$
\end_inset

的简化形式为：
\begin_inset Formula 
\begin{equation}
\int_{V}\left[\sbf b\cdot(\nabla\times{\color{blue}\nabla\times\sbf a})-\sbf a\cdot(\nabla\times{\color{brown}\nabla\times\sbf b})\right]\dd{V}=\oint_{S}\,(\sbf a\times{\color{brown}\nabla\times\sbf b}-\sbf b\times{\color{blue}\nabla\times\sbf a})\cdot\sbf n\dd{S}\label{eq:jA.22b}
\end{equation}

\end_inset


\end_layout

\begin_layout Chapter
电磁场单位
\end_layout

\begin_layout Enumerate
质量（Kilogram）：
\begin_inset Formula $\mathrm{Kg}$
\end_inset


\end_layout

\begin_layout Enumerate
长度（meter）：
\begin_inset Formula $\mathrm{m}$
\end_inset


\end_layout

\begin_layout Enumerate
时间（time）：
\begin_inset Formula $\mathrm{s}$
\end_inset


\end_layout

\begin_layout Enumerate
力（Newton）：
\begin_inset Formula $\mathrm{N}=\mathrm{Kg}\cdot\mathrm{m}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
力矩（Torque）:
\begin_inset Formula $\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{2}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
安培（ampere）：
\begin_inset Formula $\mathrm{A}$
\end_inset


\end_layout

\begin_layout Enumerate
库仑（Coulomb）：
\begin_inset Formula $\mathrm{C}=\mathrm{A}\cdot\mathrm{s}$
\end_inset


\end_layout

\begin_layout Enumerate
能量（Joule）：
\begin_inset Formula $\mathrm{J}=\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{2}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
能量密度，共能密度：
\begin_inset Formula $\mathrm{J}\cdot\mathrm{m}^{-3}=\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{-1}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
电压，电势（Volt）：
\begin_inset Formula $\mathrm{V}=\mathrm{J}\cdot\mathrm{s}^{-1}\cdot\mathrm{A}^{-1}=\mathrm{Kg}\cdot\mathrm{m}^{2}\cdot\mathrm{s}^{-3}\cdot\mathrm{A}^{-1}$
\end_inset


\end_layout

\begin_layout Enumerate
电容（法拉）：
\begin_inset Formula $\mathrm{F}=\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{V}^{-1}=\mathrm{Kg}^{-1}\cdot\mathrm{m}^{-2}\cdot\mathrm{s}^{4}\cdot\mathrm{A}^{2}$
\end_inset


\end_layout

\begin_layout Enumerate
电场强度（
\begin_inset Formula $E$
\end_inset

）：
\begin_inset Formula $\mathrm{V}\cdot\mathrm{m}^{-1}=\mathrm{Kg}\cdot\mathrm{m}\cdot\mathrm{s}^{-3}\cdot\mathrm{A}^{-1}$
\end_inset


\end_layout

\begin_layout Enumerate
电位移（
\begin_inset Formula $D$
\end_inset

）：
\begin_inset Formula $\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{m}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
介电常数
\begin_inset Formula $\epsilon_{0}$
\end_inset

：
\begin_inset Formula $\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{m}^{-1}\cdot\mathrm{V}^{-1}=\mathrm{A}^{2}\cdot\mathrm{s}^{4}\cdot\mathrm{m}^{-3}\cdot\mathrm{Kg}^{-1}$
\end_inset


\end_layout

\begin_layout Chapter
电磁场基础理论
\end_layout

\begin_layout Section
电磁场的矢势和标势
\end_layout

\begin_layout Standard
简单起见，真空中的麦克斯韦方程组为
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf E=-\frac{\partial\sbf B}{\partial t}\\
 & \nabla\times H=\frac{\partial\sbf D}{\partial t}+\sbf J\\
 & \nabla\cdot\sbf D=\rho\\
 & \nabla\cdot\sbf B=0
\end{align*}

\end_inset

引入电磁势
\begin_inset Formula 
\begin{align}
\sbf E & =-\nabla\varphi-\frac{\partial\sbf A}{\partial t}\label{eq:g5.1.3}\\
\sbf B & =\nabla\times\sbf A\label{eq:g5.1.2}
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g5.1.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g5.1.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

把电磁场用矢势和标势表示出来。现在电场
\begin_inset Formula $\sbf E$
\end_inset

不再是保守立场，一般不存在势能的概念，标势
\begin_inset Formula $\varphi$
\end_inset

失去作为电场中势能的意义。因此，在高频系统中，电压的概念也是去确切的意义。在变化场中，磁场和电场是相互作用着的整体，必须把矢势和标势作为一个整体来描述电磁场。
\end_layout

\begin_layout Subsection
规范变换和规范不变性
\end_layout

\begin_layout Standard
用矢势和标势
\begin_inset Formula $\varphi$
\end_inset

描述电磁场不是唯一的，即给定的
\begin_inset Formula $\sbf E$
\end_inset

和
\begin_inset Formula $\sbf B$
\end_inset

并不对应唯一的
\begin_inset Formula $\sbf A$
\end_inset

和
\begin_inset Formula $\varphi$
\end_inset

。假设
\begin_inset Formula $\psi$
\end_inset

为是时空的任意函数，做变换
\begin_inset Formula 
\begin{align}
 & \sbf A\to\sbf A'=\sbf A+\nabla\psi\nonumber \\
 & \varphi\to\varphi'=\varphi-\frac{\partial\psi}{\partial t}\label{eq:g5.1.4}
\end{align}

\end_inset

则
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf A'=\nabla\times\sbf A=\sbf B\\
 & -\nabla\varphi'-\frac{\partial\sbf A'}{\partial t}=-\nabla\varphi-\frac{\partial\sbf A}{\partial t}=\sbf E
\end{align*}

\end_inset

 即 
\begin_inset Formula $(\sbf A',\varphi')$
\end_inset

与
\begin_inset Formula $(\sbf A,\varphi)$
\end_inset

描述同一电磁场。变换
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g5.1.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

称为势的规范变换。每一组
\begin_inset Formula $(\sbf A,\varphi)$
\end_inset

称为一种规范。
\end_layout

\begin_layout Standard
库仑规范
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sbf A=0\label{eq:g5.1.5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
洛伦兹规范
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sbf A+\frac{1}{c^{2}}\frac{\partial\varphi}{\partial t}=0.\label{eq:g5.1.6}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
介质交界面的边界条件
\end_layout

\begin_layout Standard
麦克斯韦方程组可以应用于任何连续介质内部。在两介质分界面上，由于一般出现面电荷电流分布，使物理量发生跃变，微分形式的麦克斯韦方程组不再适用。
\end_layout

\begin_layout Standard
在电场作用下，介质界面上一般出现面束缚电流和电流分布。这些电荷电流的存在又使得界面两侧常量发生跃变。研究边值关系的基础是积分形式的麦克斯韦方程组，下面分别求出场
量的法向分量和切向分量的跃变。麦克斯韦方程组的积分形式为
\begin_inset Formula 
\begin{align}
 & \oint_{L}\sbf E\cdot\dd{\sbf\ell}=-\frac{\dd}{\dd{t}}\int_{S}\sbf B\cdot\dd{\sbf S}\nonumber \\
 & \oint_{L}\sbf H\cdot\dd{\sbf\ell}=I_{f}+\frac{\dd}{\dd{t}}\int_{S}\sbf D\cdot\dd{\sbf S}\nonumber \\
 & \oint_{S}\sbf D\cdot\dd{\sbf S}=Q_{f}\label{eq:5.1}\\
 & \oint_{S}\sbf B\cdot\dd{\sbf S}=0\nonumber 
\end{align}

\end_inset

式中 
\begin_inset Formula $I_{f}$
\end_inset

 为通过曲面
\begin_inset Formula $S$
\end_inset

的总自由电流，
\begin_inset Formula $Q_{f}$
\end_inset

为闭合曲面内总自由电荷。对应的微分形式是
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf E=-\frac{\partial\sbf B}{\partial t}\\
 & \nabla\times H=\sbf j_{f}+\frac{\partial\sbf D}{\partial t}\\
 & \nabla\cdot\sbf D=\rho_{f}\\
 & \nabla\cdot\sbf B=0
\end{align*}

\end_inset

把这组方程应用到界面上可以得到两侧场量的关系。
\end_layout

\begin_layout Section
法向分量的跃变
\end_layout

\begin_layout Standard
电位移矢量 
\begin_inset Formula $\sbf D_{n}$
\end_inset

 的跃变取决于自由电荷面密度 
\begin_inset Formula $\sigma_{f}$
\end_inset

：
\begin_inset Formula 
\[
\sbf e_{1}\cdot\sbf D_{1}+\sbf e_{2}\cdot\sbf D_{2}=\sigma_{f}
\]

\end_inset


\begin_inset Formula $\sbf e_{1}$
\end_inset

 和 
\begin_inset Formula $\sbf e_{2}$
\end_inset

 分别是界面两侧的法向量（从界面指向介质内部）。考虑到 
\begin_inset Formula $\sbf e_{2}=-\sbf e_{1}$
\end_inset

，可以统一成
\begin_inset Formula 
\begin{equation}
\sbf e_{2}\cdot\left(\sbf D_{2}-\sbf D_{1}\right)=\sigma_{f}\label{eq:5.5}
\end{equation}

\end_inset

其中
\begin_inset Formula $\sbf e_{2}$
\end_inset

从介质
\begin_inset Formula $1$
\end_inset

指向介质
\begin_inset Formula $2$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename inset/GuoShuoHong-1.12.png
	lyxscale 70
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
法向分量的跃变
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
类似地可以得到：
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\sbf e_{2}\cdot\left(\sbf E_{2}-\sbf E_{1}\right)=\sigma_{f}+\sigma_{P}\\
 & \sbf e_{2}\cdot\left(\sbf P_{2}-\sbf P_{1}\right)=-\sigma_{P}
\end{align*}

\end_inset

即 
\begin_inset Formula $E_{n}$
\end_inset

 的跃变与总电荷面密度相关。
\end_layout

\begin_layout Section
切向分量的跃变
\end_layout

\begin_layout Standard
面电流分布使界面两侧磁场的切向分量发生跃变。沿轴向均匀磁化的铁棒，其内部分子磁矩的示意图如下。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/GuoShuoHong-1.13.png
	lyxscale 90
	scale 70

\end_inset


\begin_inset Newline newline
\end_inset

在铁棒内部，分子电流互相抵消，但在靠近棒侧面上的分子电流则构成宏观的磁化电流面分布。面电流实际上是在靠近表面的相当多分子层内的平均宏观效应。设理想薄层的厚度趋于
零，则通过电流的横截面变为横截线。定义电流线密度 
\begin_inset Formula $\sbf\alpha$
\end_inset

，其大小等于垂直通过单位横截线的电流，其线密度为 
\begin_inset Formula $\sbf\alpha$
\end_inset

，
\begin_inset Formula $\Delta\ell$
\end_inset

为横截线。垂直流过 
\begin_inset Formula $\Delta\ell$
\end_inset

 段的电流为
\begin_inset Formula 
\begin{equation}
\Delta I=\alpha\Delta\ell\label{eq:g5.7}
\end{equation}

\end_inset

面电流的对应量纲实际上是 
\begin_inset Formula $[L]$
\end_inset

，
\begin_inset Formula 
\[
[\text{面电流}]=\frac{[\text{电流}]}{[\text{长度}]},\quad[\text{面电荷}]=\frac{[\text{电荷}]}{[\text{面积}]}
\]

\end_inset


\end_layout

\begin_layout Standard
将 
\begin_inset Formula $\oint_{L}\sbf H\cdot\dd{\sbf\ell}=(H_{2t}-H_{1t})\Delta\ell$
\end_inset

应用到图 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:g1.14-15"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的积分回路上得到
\begin_inset Formula 
\begin{align}
 & \sbf e_{1}\times\sbf H_{1}+\sbf e_{2}\times\sbf H_{2}=\sbf\alpha_{f}\nonumber \\
\Rightarrow\quad & \sbf e_{2}\times\left(\sbf H_{2}-\sbf H_{1}\right)=\sbf\alpha_{f}\label{eq:g5.9}
\end{align}

\end_inset

此即 磁场切向分量的边值关系。类似可得电场分量的边值关系：
\begin_inset Formula 
\begin{equation}
\sbf e_{n}\times\left(\sbf E_{2}-\sbf E_{1}\right)=0\label{eq:g5.10}
\end{equation}

\end_inset

此式表示界面两侧 
\begin_inset Formula $\sbf E$
\end_inset

 的切向分量连续。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\begin_inset Graphics
	filename inset/GuoShuoHong-1.14-15.png
	lyxscale 60
	scale 60

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
面电流的积分回路 1.14-1.15 
\begin_inset CommandInset label
LatexCommand label
name "fig:g1.14-15"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
省略自由电荷密度和自由电流线密度，不再写出下角标
\begin_inset Formula $f$
\end_inset

。总括我们得到的边值关系为
\begin_inset Formula 
\begin{align}
 & \sbf e_{2}\times\left(\sbf E_{2}-\sbf E_{1}\right)=0\nonumber \\
 & \sbf e_{2}\times\left(\sbf H_{2}-\sbf H_{1}\right)=\sbf\alpha\label{eq:g5.11}\\
 & \sbf e_{2}\cdot\left(D_{2}-\sbf D_{1}\right)=\sigma\nonumber \\
 & \sbf e_{2}\cdot\left(B_{2}-\sbf B_{1}\right)=0\nonumber 
\end{align}

\end_inset

其中 
\begin_inset Formula $\sbf e_{2}$
\end_inset

是从界面指向介质
\begin_inset Formula $2$
\end_inset

 内部的法向单位矢量，或等价地，从介质
\begin_inset Formula $1$
\end_inset

指向介质
\begin_inset Formula $2$
\end_inset

。 边值关系表示界面两侧的场与界面上电荷电流的制约关系。
\end_layout

\begin_layout Standard
对于不包含自由面电荷，面电流的系统：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf E$
\end_inset

，
\begin_inset Formula $\sbf H$
\end_inset

 切向连续；
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf B$
\end_inset

，
\begin_inset Formula $\sbf D$
\end_inset

 法向连续。
\end_layout

\begin_layout Subsection
电场线平行，垂直
\end_layout

\begin_layout Standard
电场线垂直，例如在边界
\begin_inset Formula $\Gamma_{1}$
\end_inset

上 
\begin_inset Formula $\sbf E_{t}=0$
\end_inset

，即
\begin_inset Formula 
\[
\sbf e_{t}\cdot\nabla\phi=0\quad\Rightarrow\quad\sbf e_{n}\times\nabla\Phi=0
\]

\end_inset

所以边界
\begin_inset Formula $\Gamma_{1}$
\end_inset

为等势面，电势为常数。相当于第一类（狄利赫雷）边界条件。
\end_layout

\begin_layout Standard
电场线平行， 例如在边界 
\begin_inset Formula $\Gamma_{2}$
\end_inset

上 
\begin_inset Formula $\sbf E_{n}=0$
\end_inset

，即
\begin_inset Formula 
\[
\sbf e_{n}\cdot\nabla\phi=0
\]

\end_inset

对应第二类（诺伊曼）边界条件，如果泛函中没有非齐次项，是自动满足的，被称为自然边界条件（Natural Boundary condition）。
\end_layout

\begin_layout Section
势函数的边界条件
\end_layout

\begin_layout Standard
转换成用静电势
\begin_inset Formula $\varphi$
\end_inset

，静磁势
\begin_inset Formula $\sbf A$
\end_inset

表示，边值关系表示为
\begin_inset Formula 
\begin{align}
\varphi_{1}=\varphi_{2}\quad\Leftrightarrow\quad\sbf e_{n}\times(\sbf E_{2}-\sbf E_{1})=0\label{eq:g2.1.11}
\end{align}

\end_inset


\begin_inset Formula 
\begin{equation}
\varepsilon_{2}\frac{\partial\varphi_{2}}{\partial n}-\varepsilon_{1}\frac{\partial\varphi_{1}}{\partial n}=-\sigma\label{eq:g2.1.12}
\end{equation}

\end_inset

其中
\begin_inset Formula $\partial/\partial n$
\end_inset

 是法线方向的偏导数，
\begin_inset Formula $\sigma$
\end_inset

为界面上的自由电荷面密度。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g2.1.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g2.1.12"
plural "false"
caps "false"
noprefix "false"

\end_inset

式是在界面上静电势所满足的边值关系。
\end_layout

\begin_layout Standard
导体的静电条件归结如下：
\end_layout

\begin_layout Enumerate
导体内部不带静电荷，电荷只能分布于导体表面上；
\end_layout

\begin_layout Enumerate
导体内部电场为零；
\end_layout

\begin_layout Enumerate
导体表面上电场必沿法线方向，因此导体表面为等势体。整个导体的电势相等。
\end_layout

\begin_layout Standard
设导体表面所带自由电荷面密度为
\begin_inset Formula $\sigma$
\end_inset

，设它外面的介质电容率为
\begin_inset Formula $\varepsilon$
\end_inset

，由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g2.1.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g2.1.12"
plural "false"
caps "false"
noprefix "false"

\end_inset

式和导体静电条件得导体表面的边界条件
\begin_inset Formula 
\begin{align}
 & \varphi=\text{常量}\label{eq:g2.1.11a}\\
 & \varepsilon\frac{\partial\varphi}{\partial n}=-\sigma\label{eq:g2.1.12a}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
矢势边值关系：对于非铁磁性均匀介质，矢势的边值关系为
\begin_inset Formula 
\begin{align}
 & \sbf e_{n}\cdot\left(\nabla\times\sbf A_{2}-\nabla\times\sbf A_{1}\right)=0\label{eq:g3.1.14}\\
 & \sbf e_{n}\times\left(\frac{1}{\mu_{2}}\nabla\times\sbf A_{2}-\frac{1}{\mu_{1}}\nabla\times\sbf A_{1}\right)=\sbf\alpha\label{eq:g3.1.15}
\end{align}

\end_inset

其中
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.14"
plural "false"
caps "false"
noprefix "false"

\end_inset

等价于
\begin_inset Formula 
\[
A_{2t}=A_{1t},
\]

\end_inset

而
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

规范给出
\begin_inset Formula $A_{2n}=A_{1n}$
\end_inset

，综合起来给出
\begin_inset Formula 
\begin{equation}
\sbf A_{2}=\sbf A_{2}\label{eq:g3.1.18}
\end{equation}

\end_inset

也就是矢势
\begin_inset Formula $\sbf A$
\end_inset

在两介质分界面上连续。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以用来代替
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.14"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Chapter
插值和高斯积分
\end_layout

\begin_layout Section
有限元中的Lagrange插值与Gauss积分
\end_layout

\begin_layout Standard
ref:
\begin_inset CommandInset href
LatexCommand href
name "Lagrange插值与Gauss积分"
target "https://zhuanlan.zhihu.com/p/37768842"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Lagrange插值与Gauss积分是在学习FEM中不可回避的两部分，虽然说是两部分，其实在Gauss积分中，构造多项式的被积函数时，也用到了Lagrange插
值多项式，所以在讲关于参数单元刚度矩阵求积分的时候，在数值积分中一起提出。
\begin_inset Formula 
\begin{equation}
\int_{a}^{b}f\left(x\right)\dd{x}\approx\int_{a}^{b}P\left(x\right)\dd{x}\label{eq:5.145}
\end{equation}

\end_inset

以上表达式是说，对于比较难以积分的函数
\begin_inset Formula $f$
\end_inset

，我们找到了与之相似度很高的多项式函数
\begin_inset Formula $P$
\end_inset

，用
\begin_inset Formula $P$
\end_inset

的积分来代替f的积分，那么现在的问题就是如何找到多项式
\begin_inset Formula $P$
\end_inset

。
\end_layout

\begin_layout Subsection
Newton–Cotes 数值积分
\end_layout

\begin_layout Standard
基于 
\begin_inset Formula $n$
\end_inset

 个点（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

），将多项式取为 Lagrange 插值多项式，即
\begin_inset Formula 
\[
\varphi\left(\xi\right)=a_{0}+a_{1}\xi+\cdots+a_{n-1}\xi^{n-1}=\sum_{i=1}^{n}l_{i}^{(n-1)}\left(\xi\right)f\left(\xi_{i}\right).
\]

\end_inset

其中 
\begin_inset Formula $a_{0}$
\end_inset

，
\begin_inset Formula $a$
\end_inset

，
\begin_inset Formula $\cdots$
\end_inset

，
\begin_inset Formula $a_{n-1}$
\end_inset

为常数，
\begin_inset Formula $l_{i}^{(n-1)}$
\end_inset

为
\begin_inset Formula $n-1$
\end_inset

阶 Lagrange 插值函数，即
\begin_inset Formula 
\[
l_{i}^{(n-1)}\left(\xi\right)=\frac{\left(\xi-\xi_{1}\right)\left(\xi-\xi_{2}\right)\cdots{\color{blue}\left(\xi-\xi_{i-1}\right)\left(\xi-\xi_{i+1}\right)}\cdots\left(\xi-\xi_{n}\right)}{\left(\xi_{i}-\xi_{1}\right)\left(\xi_{i}-\xi_{2}\right)\cdots{\color{blue}\left(\xi_{i}-\xi_{i-1}\right)\left(\xi_{i}-\xi_{i+1}\right)}\cdots\left(\xi_{i}-\xi_{n}\right)}=\prod_{\substack{j=1\\
j\neq i
}
}^{n}\frac{\left(\xi-\xi_{j}\right)}{\left(\xi_{i}-\xi_{j}\right)}.
\]

\end_inset


\end_layout

\begin_layout Standard
Lagrange插值的定义: 如果已知 
\begin_inset Formula $n$
\end_inset

 个点的数值，那么可以构造一个
\begin_inset Formula $n-1$
\end_inset

阶的多项式，通过待定系数的方式，使得这个多项式在这
\begin_inset Formula $n$
\end_inset

个点的值就等于原本函数在这
\begin_inset Formula $n$
\end_inset

个点的数值。关于待定系数的求解，刚好是一个范德蒙德多项式：
\begin_inset Formula 
\[
\left[\begin{array}{ccccc}
1 & x_{1} & x_{1}^{2} & \cdots & x_{1}^{n-1}\\
1 & x_{2} & x_{2}^{2} & \cdots & x_{2}^{n-1}\\
\cdots & \cdots & \cdots & \cdots & \cdots\\
1 & x_{n} & x_{n}^{2} & \cdots & x_{n}^{n-1}
\end{array}\right]\left(\begin{array}{c}
a_{0}\\
a_{1}\\
\cdots\\
a_{n-1}
\end{array}\right)=\left(\begin{array}{c}
f\left(x_{1}\right)\\
f\left(x_{2}\right)\\
\cdots\\
f\left(x_{n}\right)
\end{array}\right)
\]

\end_inset

其中 
\begin_inset Formula $a_{0}$
\end_inset

，
\begin_inset Formula $a_{1}$
\end_inset

，
\begin_inset Formula $a_{n-1}$
\end_inset

 是拟合多项式中的各个系数。例如给三个点，得到的插值多项式形如：
\begin_inset Formula 
\[
y=l_{1}^{(2)}\left(x\right)y_{1}+l_{2}^{(2)}\left(x\right)y_{2}+l_{3}^{(2)}\left(x\right)y_{3}
\]

\end_inset

容易看出
\begin_inset Formula $f_{i}(x_{j})=\delta_{ij}$
\end_inset

，即在所有要插值的点，多项式插值的结果与原来的函数相等。因此 Lagrange 插值的一般表达式为
\begin_inset Formula 
\[
P\left(x\right)=\sum_{i=1}^{n}\left[\prod_{\substack{j=1\\
i\neq j
}
}\frac{\left(x-x_{j}\right)}{\left(x_{i}-x_{j}\right)}y_{i}\right].
\]

\end_inset

从而引出了 Newton–Cotes 数值积分公式
\begin_inset Formula 
\begin{align*}
I & =\int_{-1}^{1}f\left(\xi\right)\dd{\xi}\approx\int_{-1}^{1}\varphi\left(\xi\right)\dd{\xi}\\
 & =\sum_{i=1}^{n}{\color{blue}\left(\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}\right)}f\left(\xi_{i}\right)\\
 & =\sum_{i=1}^{n}A_{i}f\left(\xi_{i}\right)
\end{align*}

\end_inset

Newton-Cotes 数值积分将原积分转化为 
\series bold
权函数
\series default
 与 
\series bold
原函数值
\series default
 的线性组合（在离散点上）。
\end_layout

\begin_layout Subsection
Gauss积分, Gauss quadrature
\end_layout

\begin_layout Standard
然后，就是 FEM 里常用的 Gauss 积分了：
\end_layout

\begin_layout Standard
首先谈一下我的理解，上面的Newton-Cotes数值积分，是将 
\series bold
函数
\series default
 转换为 
\series bold
多项式
\series default
，采用的多项式是Lagrange插值多项式，对采用的n个点没有特殊的要求；下面的Gauss积分，就是要挑选优化过的积分点，同时确定积分点函数值的权函数。
\end_layout

\begin_layout Standard
如果调整 
\begin_inset Formula $n$
\end_inset

 个插值点的位置（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

），使 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

作为 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式对
\begin_inset Formula $f(\xi)$
\end_inset

 进行逼近，则可以大大提高积分精度；也就是调整插值点 
\begin_inset Formula $\xi_{i}$
\end_inset

 的位置，使其达到一个最优的组合，这种最优的位置点叫做 Gauss 积分点。
\end_layout

\begin_layout Standard
由函数逼近理论，可构造 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

 为
\begin_inset Formula 
\begin{equation}
\varphi\left(\xi\right)=\sum_{i=1}^{n}l_{i}^{(n-1)}(\xi)f(\xi_{i})+\sum_{i=0}^{n-1}\beta_{i}\xi^{i}P\left(\xi\right)\label{eq:5.149}
\end{equation}

\end_inset

其中 
\begin_inset Formula $l_{i}^{(n-1)}(\xi)$
\end_inset

 是 
\begin_inset Formula $\left(n-1\right)$
\end_inset

 次 Lagrange插值函数，
\begin_inset Formula $\beta_{i}$
\end_inset

 为系数，
\begin_inset Formula $P\left(\xi\right)$
\end_inset

 为 
\begin_inset Formula $n$
\end_inset

 次多项式，即
\begin_inset Formula 
\begin{equation}
P\left(\xi\right)=\left(\xi-\xi_{1}\right)\left(\xi-\xi_{2}\right)\cdots\left(\xi-\xi_{n}\right)=\prod_{i=1}^{n}\left(\xi-\xi_{i}\right).\label{eq:5.150}
\end{equation}

\end_inset

（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

）积分点由以下条件确定
\begin_inset Formula 
\begin{equation}
\int_{-1}^{1}\xi^{i}P\left(\xi\right)\dd{\xi}=0,\quad i=0,1,\cdots,n-1\label{eq:5.151}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Gauss积分的定义
\end_layout

\begin_layout Standard
可以看出，构造的高斯积分的函数虽然阶次提高到了
\begin_inset Formula $2n-1$
\end_inset

，它的两项中的第一项仍然为
\begin_inset Formula $n-1$
\end_inset

阶，并且就是之前的拉格朗日插值多项式，只是在后面添加了一个“辅助项”。其实为什么这么构造我是不清楚的，但是毋庸置疑的是：
\end_layout

\begin_layout Enumerate
辅助项在所有积分点处的值为零，即 
\begin_inset Formula $P\left(\xi_{i}\right)=0$
\end_inset

。
\end_layout

\begin_layout Enumerate
整个多项式的阶次被提高到 
\begin_inset Formula $2n-1$
\end_inset

次，相比于牛顿积分更精确；
\end_layout

\begin_layout Enumerate
利用上述的积分条件（共
\begin_inset Formula $n$
\end_inset

个），可以用来确定
\begin_inset Formula $n$
\end_inset

个积分点（采样点）的位置。
\end_layout

\begin_layout Standard
则积分
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:5.145"
plural "false"
caps "false"
noprefix "false"

\end_inset

为，
\begin_inset Formula 
\begin{align}
I & =\int_{-1}^{1}f\left(\xi\right)\dd{\xi}\approx\int_{-1}^{1}\varphi\left(\xi\right)\dd{\xi}\nonumber \\
 & =\sum_{i=1}^{n}\left[\left({\color{blue}\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}}\right)f\left(\xi_{i}\right)\right]+\sum_{i=0}^{n-1}\int_{-1}^{1}\beta_{i}\xi^{i}P\left(\xi\right)\dd{\xi}=\sum_{i=1}^{n}Af\left(\xi_{i}\right)\label{eq:5.152}
\end{align}

\end_inset

其中
\begin_inset Formula 
\begin{equation}
A_{i}={\color{blue}\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}}\label{eq:5.153}
\end{equation}

\end_inset

注意这时 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

 为 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式，
\color blue

\begin_inset Formula $\xi_{i}$
\end_inset

的位置由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:5.151"
plural "false"
caps "false"
noprefix "false"

\end_inset

 式确定
\color inherit
，因而整个积分的精度具有 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 阶。
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
Kare: 高斯积分运用的是正交多项式的性质。Lagrange 多项式那项已经保证了至少
\begin_inset Formula $n$
\end_inset

的精确度，后面的项则把精确度提高到
\begin_inset Formula $2n-1$
\end_inset

。精确度跟多项式的次数应当是没有关系的。而是跟特殊的取点有关系。
\end_layout

\end_inset


\end_layout

\begin_layout Remark
令 
\begin_inset Formula $J$
\end_inset

 表示物理坐标对等参坐标的雅可比矩阵，
\begin_inset Formula $\det[J]$
\end_inset

正比于几何区域的面积，例如对于三角形
\begin_inset Formula 
\[
S=\frac{1}{2}\det[J]
\]

\end_inset

在 Solver程序中，这个几何因子（
\begin_inset Formula $1/2$
\end_inset

）被吸收进 权重因子 
\begin_inset Formula $W_{i}$
\end_inset

 中。因此 Solver程序中高斯积分法的公式写作：
\begin_inset Formula 
\[
\iint_{\Omega^{e}}F\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{x}\dd{y}=\sum_{i=1}^{m}F\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset


\end_layout

\begin_layout Chapter
单元上的形函数
\end_layout

\begin_layout Standard
在有限元中，求解区域被划分成小单元。每个小单元内的点，包括边界，也使用形函数插值得到：
\begin_inset Formula 
\[
X=\sum_{i}N_{i}^{e}\left(\xi_{1},\cdots\xi_{n}\right)X_{i}
\]

\end_inset

其中 
\begin_inset Formula $X_{i}$
\end_inset

 是节点坐标，
\begin_inset Formula $X$
\end_inset

 是单元 
\begin_inset Formula $e$
\end_inset

 的内点，对应于等参平面上的点 
\begin_inset Formula $(\xi_{1},\cdots\xi_{n})$
\end_inset

 。如果区域不是平面/直线，例如对于圆弧边界，插值得到的
\begin_inset Formula $X$
\end_inset

 将作为精确点 
\begin_inset Formula $X_{0}$
\end_inset

 的近似。
\end_layout

\begin_layout Standard
形函数具有支撑性质 
\begin_inset Formula $N_{i}^{e}(x_{j})=\delta_{ij}$
\end_inset

，也就是 
\begin_inset Formula $x_{i}$
\end_inset

 点上定义的形函数，只在这一点的邻域不为零，在单元的其它点上都为零。这一性质保证了插值出的结果在单元边界上至少是 
\begin_inset Formula $C^{0}$
\end_inset

 连续的。例如下左图的两个三角形单元，
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\backslash
documentclass[tikz,border=10pt]{standalone} 
\end_layout

\begin_layout Plain Layout

\backslash
usepackage{tikz} 
\end_layout

\begin_layout Plain Layout

\backslash
usetikzlibrary{positioning} 
\end_layout

\begin_layout Plain Layout

\backslash
begin{document}
\end_layout

\begin_layout Plain Layout

\backslash
begin{tikzpicture}[scale=1] 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=left:$1$](A) at (0,0); 
\backslash
coordinate [label=right:$2$] (B) at (2,0); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$3$] (C) at (1.5,1); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$4$] (D) at (3,1); 
\end_layout

\begin_layout Plain Layout

\backslash
draw (A) -- (B)--(C)--cycle; 
\backslash
draw (B) -- (C)--(D)--cycle; 
\backslash
node at (3.5, .5) {$
\backslash
Rightarrow$}; 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=left:$1$](A) at (4,0); 
\backslash
coordinate [label=below:$2$] (B) at (5,0); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$3$] (C) at (5,1); 
\backslash
coordinate [label=right:$4$] (D) at (6,0);
\end_layout

\begin_layout Plain Layout

\backslash
draw (A) -- (B)--(C)--cycle; 
\backslash
draw (B) -- (C)--(D)--cycle;
\end_layout

\begin_layout Plain Layout

\backslash
end{tikzpicture}
\end_layout

\begin_layout Plain Layout

\backslash
end{document} 
\end_layout

\end_inset

它们具有公共边 
\begin_inset Formula $2$
\end_inset

–
\begin_inset Formula $3$
\end_inset

，经过等参坐标变换，所有单元都变成标准单元–边长为
\begin_inset Formula $1$
\end_inset

的直角三角形，即右图。在等参坐标系中，两个单元的形状完全相同。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/ele-tri3-2.pdf
	lyxscale 150
	scale 80

\end_inset


\begin_inset Newline newline
\end_inset

某个单元内的场量的插值，在等参坐标系下写作：
\begin_inset Formula 
\[
\phi\left(\xi,\eta\right)=\sum_{i=1}^{n}N_{i}^{e}\left(\xi,\eta\right)\phi_{i}
\]

\end_inset

公共边上的场量即可以用单元
\begin_inset Formula $1$
\end_inset

表示，也可以用单元
\begin_inset Formula $2$
\end_inset

表示，即
\begin_inset Formula 
\[
\phi=\sum_{i=1}^{n}N_{i}^{(1)}\left(\xi,\eta\right)\phi_{i}^{(1)}=\sum_{i=1}^{n}N_{i}^{(2)}\left(\xi,\eta\right)\phi_{i}^{(2)}
\]

\end_inset

公共边在两个单元中的等参坐标 
\begin_inset Formula $(\xi,\eta)$
\end_inset

 是相同的，形函数在两个单元中也取相同的形式，因此唯一的差别在于顶点 
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $4$
\end_inset

 上 
\begin_inset Formula $\phi_{i}$
\end_inset

的取值，而它们的值一般不相等。因此两个单元对公共边上的场给出不同的插值，解决冲突的办法之一就是要求形函数满足 
\begin_inset Formula $N_{i}^{e}(x_{j})=\delta_{ij}$
\end_inset

，这样公共边上的值只取决于节点 
\begin_inset Formula $2$
\end_inset

，
\begin_inset Formula $3$
\end_inset

，所以至少是
\begin_inset Formula $C^{0}$
\end_inset

连续的。
\end_layout

\begin_layout Section
等参单元形函数
\end_layout

\begin_layout Standard
下面附上一些常用的等参单元的 shape function。
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/triangle-ele.pdf
	scale 70

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics[{ Line[{ {0, 0}, {0, 1}, {1, 0}, {0, 0} }] , FontSize
 -> 13 , Text[1, {1, +3 delta}] , Text[2, {0 - 4 delta, 1 + delta}] , Text[3,
 {-6 delta, 2 delta}] } , Axes -> True, AxesOrigin -> {0, 0} , AxesStyle
 -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2"} , PlotRangePadding -> { {Scaled[0], Scaled[.1]}, {Scaled[0], Scaled[.1]}}
 , ImageSize -> Small ]
\end_layout

\end_inset


\begin_inset Formula 
\[
N^{(1)}=\xi_{1},\quad N^{(2)}=\xi_{2},\quad N^{(3)}=1-\xi_{1}-\xi_{2},
\]

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/rectangle-ele.pdf
	scale 70

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics[{ Line[{ {-1, -1}, {1, -1}, {1, 1}, {-1, 1}, {-1,
 -1} }] , FontSize -> 13 , Text[1, {-1 - 3 delta, -1 - 3 delta}] , Text[2,
 {1 + 3 delta, -1 - 3 delta}] , Text[3, {1 + 3 delta, 1 + 3 delta}] , Text[4,
 {-1 - 3 delta, 1 + 3 delta}] } , Axes -> True, AxesOrigin -> {0, 0} , AxesStyle
 -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2"} , PlotRangePadding -> { {Scaled[.1], Scaled[.1]}, {Scaled[.1], Scaled[.1]}}
 , ImageSize -> Small ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
N^{(1)} & =\frac{1}{4}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right),\\
N^{(2)} & =\frac{1}{4}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right),\\
N^{(3)} & =\frac{1}{4}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right),\\
N^{(4)} & =\frac{1}{4}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right).
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/Pyramid-ele.pdf
	lyxscale 50
	scale 55

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics3D[{ Line[{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}, {1, 0,
 0}}], Line[{{1, 0, 0}, {0, 0, 0}, {0, 1, 0}}], Line[{{0, 0, 1}, {0, 0,
 0}}], , FontSize -> 13 , Text[1, {1 + 3 delta, 2 delta, 0}] , Text[2, {2
 delta, 1 + 3 delta, 0}] , Text[3, {2 delta, 2 delta, 1 + 3 delta}] , Text[4,
 {+3 delta, -delta, +3 delta}] } , Axes -> True, AxesOrigin -> {0, 0, 0}
 , AxesStyle -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2", "
\backslash
[Xi]_3"} , PlotRangePadding -> {Scaled[.1], Scaled[.1], Scaled[.1]} , ImageSize
 -> Medium , Boxed -> False ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
 & N^{(1)}=\xi_{1},\quad N^{(2)}=\xi_{2},\quad N^{(3)}=\xi_{3},\\
 & N^{(4)}=1-\xi_{1}-\xi_{2}-\xi_{3},
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/cuboid-ele.pdf
	lyxscale 50
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics3D[{ Line[{{-1, -1, -1}, {1, -1, -1}, {1, 1, -1}, {-1,
 1, -1}, {-1, -1, -1}}], Line[{{-1, -1, 1}, {1, -1, 1}, {1, 1, 1}, {-1,
 1, 1}, {-1, -1, 1}}], Line[{{-1, -1, -1}, {-1, -1, 1}}], Line[{{1, -1,
 -1}, {1, -1, 1}}], Line[{{1, 1, -1}, {1, 1, 1}}], Line[{{-1, 1, -1}, {-1,
 1, 1} }], Line[{{0, 0, 1}, {0, 0, 0}}] , FontSize -> 13 , Text[1, {-1 -
 3 delta, -1 - 3 delta, -1 - 3 delta}], Text[5, {-1 - 3 delta, -1 - 3 delta,
 1 + 3 delta}] , Text[2, {1 + 3 delta, -1 - 3 delta, -1 - 3 delta}], Text[6,
 {1 + 3 delta, -1 - 3 delta, 1 + 3 delta}] , Text[3, {1 + 3 delta, 1 + 3
 delta, -1 - 3 delta}], Text[7, {1 + 3 delta, 1 + 3 delta, 1 + 3 delta}]
 , Text[4, {-1 - 3 delta, 1 + 3 delta, -1 - 3 delta}], Text[8, {-1 - 3 delta,
 1 + 3 delta, 1 + 3 delta}] } , Axes -> True, AxesOrigin -> {0, 0, 0} ,
 AxesStyle -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2", "
\backslash
[Xi]_3"} , PlotRangePadding -> {Scaled[.1], Scaled[.1], Scaled[.1]} , ImageSize
 -> Medium , Boxed -> False ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
N^{(1)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(2)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(3)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(4)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(5)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(6)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(7)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(8)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right)\left(1+\xi_{3}\right),
\end{align*}

\end_inset


\end_layout

\begin_layout Section
一维形函数：直线元
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-line2.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; d1 = {0, 0.05}; Graphics[{ Line[{v1, v2}], PointSize[.04
], Point[{v1, v2}], Text["1", v1 + d1], Text["2", v2 + d1] } , ImageSize
 -> Small ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
一维有限元单元为连接节点 
\begin_inset Formula $x_{1}^{e}$
\end_inset

 和 
\begin_inset Formula $x_{2}^{e}$
\end_inset

 的线段。两个节点上的一阶形函数为：
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{x_{2}^{e}-x}{x_{2}^{e}-x_{1}^{e}},\quad N_{2}^{(1)}=\frac{x-x_{1}^{e}}{x_{2}^{e}-x_{1}^{e}}.
\]

\end_inset

或用等参表示为
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{1-\xi}{2},\quad N_{2}^{(1)}=\frac{1+\xi}{2}
\]

\end_inset

其中 
\begin_inset Formula $\xi$
\end_inset

 的取值范围是 
\begin_inset Formula $[-1,1]$
\end_inset

，与坐标的转换关系为：
\begin_inset Formula 
\[
\xi=\frac{x-(x_{1}^{e}+x_{2}^{e})/2}{(x_{2}^{e}-x_{1}^{e})/2}
\]

\end_inset

单元中某个内点的坐标 
\begin_inset Formula $x$
\end_inset

 可以用形函数，以及相应的节点坐标 
\begin_inset Formula $x_{i}$
\end_inset

 表示为：
\begin_inset Formula 
\begin{equation}
x=\sum_{i=1}^{n_{e}}N_{i}^{e}(\xi)x_{i}=\sum_{i=1}^{n_{e}}N_{i}^{e\prime}(x,y)x_{i}\label{eq:interp1d}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
一阶单元是 
\series bold
线性单元
\series default
。例如把曲线的参数取为横坐标
\begin_inset Formula $x$
\end_inset

，两节点的纵坐标分别是 
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $2$
\end_inset

。有限元插值
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:interp1d"
plural "false"
caps "false"
noprefix "false"

\end_inset

给出的内点落在一条直线上。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/ele-o1-regionInterp.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1, 
\backslash
[Xi]_] := (1 - 
\backslash
[Xi])/2; nShape[2, 
\backslash
[Xi]_] := (1 + 
\backslash
[Xi])/2; xi = {1, 2}; coord[
\backslash
[Xi]_] := Sum[xi[[n]]*nShape[n, 
\backslash
[Xi]], {n, 2}]; Plot[coord[
\backslash
[Xi]], {
\backslash
[Xi], -1, 1}, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{1}^{(1)}$
\end_inset

形函数在 
\begin_inset Formula $x_{2}$
\end_inset

处为零，即满足 
\begin_inset Formula $N_{i}^{e}\left(x_{j}\right)=\delta_{ij}$
\end_inset

。但
\begin_inset Formula 
\[
\partial_{x}N_{1}^{(1)}=\frac{-1}{\ell},\quad\partial_{x}N_{2}^{(1)}=\frac{1}{\ell},
\]

\end_inset

在整个单元上为常数。如右图 
\begin_inset Formula $1,2$
\end_inset

组成单元
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $2,3$
\end_inset

为单元
\begin_inset Formula $B$
\end_inset

，
\begin_inset Graphics
	filename inset/ele-line-pair.pdf
	lyxscale 80
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; v3 = {2, 0}; d1 = {0, 0.1}; d2 = {0.5, 0.1}; Graphics[{
 Line[{v1, v2, v3}], PointSize[.04], Point[{v1, v2, v3}], Text["1", v1 +
 d1], Text["2", v2 + d1], Text["3", v3 + d1], Text["A", v1 + d2], Text["B",
 v2 + d2] } , ImageSize -> Small ]
\end_layout

\end_inset

。 点 
\begin_inset Formula $2$
\end_inset

是单元
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $B$
\end_inset

 的公共点，
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $B$
\end_inset

单元分别在点
\begin_inset Formula $2$
\end_inset

 有形函数，记作
\begin_inset Formula $N_{2}^{A}$
\end_inset

，
\begin_inset Formula $N_{2}^{B}$
\end_inset

 ，它们对点
\begin_inset Formula $2$
\end_inset

 的 
\begin_inset Formula $\phi$
\end_inset

 贡献相同，但是它们对点 
\begin_inset Formula $2$
\end_inset

 的梯度（一阶导数）的贡献是不同的，因为
\begin_inset Formula $\nabla\phi=\sum\phi_{\alpha}\nabla N_{\alpha}$
\end_inset

，通过考虑全局编号和局部编号关系可知 
\begin_inset Formula $N_{2}^{A}=\frac{1}{\ell}$
\end_inset

，
\begin_inset Formula $N_{2}^{A}=\frac{-1}{\ell}$
\end_inset

。
\end_layout

\begin_layout Subsection
一维二阶形函数
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-line3.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; v3 = {2, 0}; d1 = {0, 0.1}; d2 = {0.5, 0.1}; Graphics[{
 Line[{v1, v2, v3}], PointSize[.04], Point[{v1, v2, v3}], Text["1", v1 +
 d1], Text["2", v2 + d1], Text["3", v3 + d1] } , ImageSize -> Small ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
在一维有限元单元上添加中点，可以构造二阶形函数。二阶形函数可以由一阶形函数直接生成。首先，边中点形函数 
\begin_inset Formula $N_{3}^{(2)}$
\end_inset

 可以由两个节点的一阶形函数生成，即
\begin_inset Formula 
\[
N_{3}^{(2)}=4N_{1}^{(1)}N_{2}^{(1)}
\]

\end_inset

节点的二阶形函数可以由 节点的一阶形函数，和中点的二阶形函数生成，即
\begin_inset Formula 
\[
N_{i}^{(2)}=N_{i}^{(1)}-\frac{1}{2}N_{3}^{(2)},\quad i\in\{1,2\}
\]

\end_inset

最后得到二阶形函数的表达式：
\begin_inset Formula 
\begin{align*}
\text{端点形函数：} & N_{1}^{(2)}=\frac{\xi(\xi-1)}{2}\\
\text{端点形函数：} & N_{2}^{(2)}=\frac{\xi(\xi+1)}{2}\\
\text{中点形函数：} & N_{3}^{(2)}=(1+\xi)(1-\xi)
\end{align*}

\end_inset

类似地，单元内点由插值得到
\begin_inset Formula 
\begin{equation}
x=\sum_{i=1}^{n_{e}}N_{i}^{(2)}(\xi)x_{i},\quad\xi\in[-1,1]\label{eq:interp2d}
\end{equation}

\end_inset

对内点的二阶形函数插值，给出二阶单元，二阶单元可以精确拟合二次曲线。例如下图，两端点纵坐标都是
\begin_inset Formula $1$
\end_inset

，中点纵坐标是 
\begin_inset Formula $2$
\end_inset

，二阶单元给出的插值曲线为：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1, 
\backslash
[Xi]_] := (
\backslash
[Xi] (
\backslash
[Xi] - 1))/2; nShape[2, 
\backslash
[Xi]_] := (
\backslash
[Xi] (
\backslash
[Xi] + 1))/2; nShape[3, 
\backslash
[Xi]_] := (1 + 
\backslash
[Xi]) (1 - 
\backslash
[Xi]); xi = {1, 1, 2}; coord[
\backslash
[Xi]_] := Sum[xi[[n]]*nShape[n, 
\backslash
[Xi]], {n, 3}]; Plot[coord[
\backslash
[Xi]], {
\backslash
[Xi], -1, 1}, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-o2-regionInterp.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Standard
计算中经常会用到 几何坐标 和 等参坐标 微分之间的转换，即
\begin_inset Formula 
\[
J=\frac{\partial x}{\partial\xi}=\frac{\partial N_{i}^{e}}{\partial\xi}x_{i}
\]

\end_inset


\end_layout

\begin_layout Section
二维形函数：三角元
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-tri3.pdf
	lyxscale 70
	scale 40

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {-1, 0}; v2 = {1, 0}; v3 = {0, Sqrt[3]}; Graphics[{Line[{v1, v2, v3,
 v1}], PointSize[0.03], Point[{v1, v2, v3}], FontSize -> 14, Text["1", {-1.1,
 0}], Text["2", {1.1, 0}], Text["3", {0, Sqrt[3] + 0.1}] }, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
由二维三角形单元顶点的三个坐标可以定义相应的一阶形函数：
\begin_inset Formula 
\begin{align}
 & N_{1}^{(1)}=\frac{\Delta_{1}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{1}^{e}+b_{1}^{e}x+c_{1}^{e}y\right),\label{eq:shape-2-1}\\
 & N_{2}^{(1)}=\frac{\Delta_{2}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{2}^{e}+b_{2}^{e}x+c_{2}^{e}y\right),\nonumber \\
 & N_{3}^{(1)}=\frac{\Delta_{3}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{3}^{e}+b_{3}^{e}x+c_{3}^{e}y\right).\nonumber 
\end{align}

\end_inset

二维形函数的等参坐标取值为 
\begin_inset Formula $[0,1]$
\end_inset

，一阶形函数可以用等参坐标表示为：
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(1)}=1-\xi-\eta,\\
 & N_{2}^{(1)}=\xi\\
 & N_{3}^{(1)}=\eta
\end{align*}

\end_inset


\end_layout

\begin_layout Remark
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:shape-2-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

中系数的定义为
\begin_inset Formula 
\begin{align*}
 & a_{1}^{e}=x_{2}^{e}y_{3}^{e}-y_{2}^{e}x_{3}^{e}; &  & b_{1}^{e}=y_{2}^{e}-y_{3}^{e}; &  & c_{1}^{e}=x_{3}^{e}-x_{2}^{e}\\
 & a_{2}^{e}=x_{3}^{e}y_{1}^{e}-y_{3}^{e}x_{1}^{e}; &  & b_{2}^{e}=y_{3}^{e}-y_{1}^{e}; &  & c_{2}^{e}=x_{1}^{e}-x_{3}^{e}\\
 & a_{3}^{e}=x_{1}^{e}y_{2}^{e}-y_{1}^{e}x_{2}^{e}; &  & b_{3}^{e}=y_{1}^{e}-y_{2}^{e}; &  & c_{3}^{e}=x_{2}^{e}-x_{1}^{e}
\end{align*}

\end_inset

以及
\begin_inset Formula 
\[
\Delta^{e}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right]
\]

\end_inset


\begin_inset Formula 
\[
\Delta_{1}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x & y\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right],\quad\Delta_{2}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x & y\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right],\quad\Delta_{3}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x & y
\end{array}\right].
\]

\end_inset


\end_layout

\begin_layout Subsection
矩阵形式
\end_layout

\begin_layout Standard
一阶形函数变换可以写成矩阵形式：
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}
\end{array}\right\} =\frac{1}{2\Delta^{e}}\left[\begin{array}{ccc}
x_{2}y_{3}-x_{3}y_{2} & y_{2}-y_{3} & x_{3}-x_{2}\\
x_{3}y_{1}-x_{1}y_{3} & y_{3}-y_{1} & x_{1}-x_{3}\\
x_{1}y_{2}-x_{2}y_{1} & y_{1}-y_{2} & x_{2}-x_{1}
\end{array}\right]\left\{ \begin{array}{c}
1\\
x\\
y
\end{array}\right\} \label{eq:4.160}
\end{equation}

\end_inset


\begin_inset Formula 
\[
2\Delta^{e}=\det[J]=(y_{2}-y_{3})(x_{1}-x_{3})-(y_{3}-y_{1})(x_{3}-x_{2})
\]

\end_inset


\begin_inset Formula $L_{j}^{e}$
\end_inset

 就是一阶三角形单元的形函数。逆变换矩阵为
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{c}
1\\
x\\
y
\end{array}\right\} =\left[\begin{array}{ccc}
1 & 1 & 1\\
x_{1}^{e} & x_{2}^{e} & x_{3}^{e}\\
y_{1}^{e} & y_{2}^{e} & y_{3}^{e}
\end{array}\right]\left\{ \begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}
\end{array}\right\} .\label{eq:4.161}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
雅可比矩阵
\end_layout

\begin_layout Standard
雅可比矩阵可以给出 几何坐标 
\begin_inset Formula $(x,y)$
\end_inset

 与 等参坐标 
\begin_inset Formula $(\xi,\eta)$
\end_inset

 之间，微分的变换关系：
\begin_inset Formula 
\[
[J]=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]=\left[\begin{array}{cc}
-x_{1}+x_{2} & -y_{1}+y_{2}\\
-x_{1}+x_{3} & -y_{1}+y_{3}
\end{array}\right]
\]

\end_inset


\begin_inset Formula 
\[
\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)=[J]\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial x}\\
\frac{\partial N_{i}^{e}}{\partial y}
\end{array}\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
二维二阶形函数
\end_layout

\begin_layout Standard
在三角形单元各个边中点增加一个节点之后，可以构造出相应的二阶形函数，
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-Tri6.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Graphics[{ Line[{{-1, 0}, {1, 0}, {0, Sqrt[3]}, {-1, 0}}], PointSize[0.03],
 Point[{{0, 0}, {0.5, Sqrt[3]/2}, {-0.5, Sqrt[3]/2}}], Style[Text["1", {-1.1,
 0}], 16], Style[Text["4", {0, -0.16}], 16], Style[Text["2", {1.1, 0}], 16],
 Style[Text["5", {0.62, Sqrt[3]/2}], 16], Style[Text["3", {0, Sqrt[3] + 0.1}],
 16], Style[Text["6", {-0.62, Sqrt[3]/2}], 16] }, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
边中点形函数 
\begin_inset Formula $N_{i}^{(2)}$
\end_inset

 可以由两个节点的一阶形函数生成，即
\begin_inset Formula 
\begin{align*}
 & N_{4}^{(2)}=4N_{1}^{(1)}N_{2}^{(1)}\\
 & N_{5}^{(2)}=4N_{3}^{(1)}N_{2}^{(1)}\\
 & N_{6}^{(2)}=4N_{1}^{(1)}N_{3}^{(1)}
\end{align*}

\end_inset

顶点的二阶形函数，可以由顶点的一阶形函数，和 邻接边中点的二阶形函数生成
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(2)}=N_{1}^{(1)}-\frac{1}{2}[N_{4}^{(1)}+N_{6}^{(1)}]\\
 & N_{2}^{(2)}=N_{2}^{(1)}-\frac{1}{2}[N_{4}^{(1)}+N_{5}^{(1)}]\\
 & N_{3}^{(2)}=N_{3}^{(1)}-\frac{1}{2}[N_{5}^{(1)}+N_{6}^{(1)}]
\end{align*}

\end_inset

最后可以得到
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(2)}=\left(1-\xi-\eta\right)\left(1-2\xi-2\eta\right)\\
 & N_{2}^{(2)}=\xi\left(2\xi-1\right)\\
 & N_{3}^{(2)}=\eta\left(2\eta-1\right)\\
 & N_{4}^{(2)}=4\left(1-\xi-\eta\right)\xi\\
 & N_{5}^{(2)}=4\xi\eta\\
 & N_{6}^{(2)}=4\left(1-\xi-\eta\right)\eta
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
单元内点的坐标 
\begin_inset Formula $(x,y)$
\end_inset

 ，可以用 形函数 以及 节点处的坐标 
\begin_inset Formula $\left(x_{i},y_{i}\right)$
\end_inset

 表示为
\begin_inset Formula 
\begin{align*}
 & x=\sum_{i}N_{i}^{e}\left(x,y\right)x_{i}\\
 & y=\sum_{i}N_{i}^{e}\left(x,y\right)y_{i}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
如图，对于曲线边界的几何区域，使用二阶形函数插值能给出贴合得更好的单元
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1][
\backslash
[Xi]_, 
\backslash
[Eta]_] := (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) (1 - 2 
\backslash
[Xi] - 2 
\backslash
[Eta]); nShape[2][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 
\backslash
[Xi] (2 
\backslash
[Xi] - 1); nShape[3][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 
\backslash
[Eta] (2 
\backslash
[Eta] - 1);
\end_layout

\begin_layout Plain Layout
nShape[4][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) 
\backslash
[Xi]; nShape[5][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 
\backslash
[Xi] 
\backslash
[Eta]; nShape[6][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) 
\backslash
[Eta]; 
\backslash
[Delta] = 0.1;(*midpoint offset*) xi = { {-1, 0}, {1, 0}, {0, Sqrt[3]}, {0,
 0 - 
\backslash
[Delta]}, {0.5 - 
\backslash
[Delta], Sqrt[3]/2}, {-(0.5 + 
\backslash
[Delta]), Sqrt[3]/2} }; coord[
\backslash
[Xi]_, 
\backslash
[Eta]_] := Sum[xi[[n]]*nShape[n][
\backslash
[Xi], 
\backslash
[Eta]], {n, 6}]; ParametricPlot[ coord[
\backslash
[Xi], 
\backslash
[Eta]], {
\backslash
[Xi], 0, 1}, {
\backslash
[Eta], 0, 1 - 
\backslash
[Xi]}, ImageSize -> Tiny]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-tri6-RegionIntep.png
	scale 65

\end_inset


\end_layout

\begin_layout Standard
有限元计算中，经常用到下面公式所示的形函数积分性质：
\begin_inset Formula 
\[
\int_{\Omega^{e}}(L_{1}^{e})^{\ell}(L_{2}^{e})^{m}(L_{3}^{e})^{n}\dd{x}\dd{y}=\frac{\ell!m!n!}{(\ell+m+n+2)!}2\Delta^{e}
\]

\end_inset


\end_layout

\begin_layout Section
三维形函数：四面体
\end_layout

\begin_layout Standard
\align left
\begin_inset Graphics
	filename inset/Pyramid-ele.pdf
	lyxscale 50
	scale 55

\end_inset


\end_layout

\begin_layout Standard
三维 四面体有限元 四个顶点的一阶 形函数定义为：
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{V_{1}}{V^{e}},\quad N_{2}^{(1)}=\frac{V_{2}}{V^{e}},\quad N_{3}^{(1)}=\frac{V_{3}}{V^{e}},\quad N_{4}^{(1)}=\frac{V_{4}}{V^{e}},
\]

\end_inset

其中
\begin_inset Formula 
\[
V^{e}=\frac{1}{6}\det\left[\begin{array}{cccc}
1 & x_{1}^{e} & y_{1}^{e} & z_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e} & z_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e} & z_{3}^{e}\\
1 & x_{4}^{e} & y_{4}^{e} & z_{4}^{e}
\end{array}\right]
\]

\end_inset

仿照二维情况，可以计算出 
\begin_inset Formula $V_{i}$
\end_inset

。例如
\begin_inset Formula 
\[
V_{1}=\frac{1}{6}\det\left[\begin{array}{cccc}
1 & x & y & z\\
1 & x_{2}^{e} & y_{2}^{e} & z_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e} & z_{3}^{e}\\
1 & x_{4}^{e} & y_{4}^{e} & z_{4}^{e}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Example
三维形函数等参坐标取值范围 
\begin_inset Formula $\xi,\eta,\zeta\in\left[0,1\right]$
\end_inset

，一阶形函数可以用等参坐标表示为：
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(1)}=1-\xi-\eta-\zeta\\
 & N_{2}^{(1)}=\xi\\
 & N_{3}^{(1)}=\eta\\
 & N_{4}^{(1)}=\zeta
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
等参坐标 和 几何坐标 之间的变换关系，正变换为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
1\\
x\\
y\\
z
\end{array}\right]=\left[\begin{array}{cccc}
1 & 1 & 1 & 1\\
x_{1} & x_{2} & x_{3} & x_{4}\\
y_{1} & y_{2} & y_{3} & y_{4}\\
z_{1} & z_{2} & z_{3} & z_{4}
\end{array}\right]\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right],\quad\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right]=\left[\begin{array}{c}
1-\xi-\eta-\zeta\\
\xi\\
\eta\\
\zeta
\end{array}\right]
\]

\end_inset

这里按照常用的记号约定，也引入了 
\begin_inset Formula $L_{i}^{e}$
\end_inset

 表示等参坐标。对应的 逆变换 为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right]=\frac{1}{\det\left[J\right]}\left[\begin{array}{cccc}
a_{1} & b_{1} & c_{1} & d_{1}\\
a_{2} & b_{2} & c_{2} & d_{2}\\
a_{3} & b_{3} & c_{3} & d_{3}\\
a_{4} & b_{4} & c_{4} & d_{4}
\end{array}\right]\left[\begin{array}{c}
1\\
x\\
y\\
z
\end{array}\right]
\]

\end_inset

简记为：
\begin_inset Formula 
\begin{align*}
 & X_{\alpha}=T_{\alpha\beta}L_{\beta},\\
 & L_{\alpha}=T_{\alpha\beta}^{-1}X_{\beta}
\end{align*}

\end_inset

其中 
\begin_inset Formula $X=\left(1,x,y,z\right),$
\end_inset


\begin_inset Formula $L=\left(1-\xi-\eta-\zeta,\xi,\eta,\zeta\right)$
\end_inset

。
\end_layout

\begin_layout Example
其中各系数的值为：
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
b_{1} & c_{1} & d_{1}\\
b_{2} & c_{2} & d_{2}\\
b_{3} & c_{3} & d_{3}\\
b_{4} & c_{4} & d_{4}
\end{array}\right]=\left[\begin{array}{ccc}
y_{42}z_{32}-y_{32}z_{42} & x_{32}z_{42}-x_{42}z_{32} & x_{42}y_{32}-x_{32}y_{42}\\
y_{31}z_{43}-y_{34}z_{13} & x_{43}z_{31}-x_{31}z_{43} & x_{31}y_{43}-x_{43}y_{31}\\
y_{24}z_{14}-y_{14}z_{24} & x_{14}z_{24}-x_{24}z_{14} & x_{24}y_{14}-x_{14}y_{24}\\
y_{13}z_{21}-y_{21}z_{13} & x_{21}z_{13}-x_{13}z_{21} & x_{13}y_{21}-x_{21}y_{13}
\end{array}\right]
\]

\end_inset


\begin_inset Formula $T$
\end_inset

 的第一列的值为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
a_{1}\\
a_{2}\\
a_{3}\\
a_{4}
\end{array}\right]=\left[\begin{array}{c}
x_{2}\left(y_{3}z_{4}-y_{4}z_{3}\right)+x_{3}\left(y_{4}z_{2}-y_{2}z_{4}\right)+x_{4}\left(y_{2}z_{3}-y_{3}z_{2}\right)\\
x_{1}\left(y_{4}z_{3}-y_{3}z_{4}\right)+x_{3}\left(y_{1}z_{4}-y_{4}z_{1}\right)+x_{4}\left(y_{3}z_{1}-y_{1}z_{3}\right)\\
x_{1}\left(y_{2}z_{4}-y_{4}z_{2}\right)+x_{2}\left(y_{4}z_{1}-y_{1}z_{4}\right)+x_{4}\left(y_{1}z_{2}-y_{2}z_{1}\right)\\
x_{1}\left(y_{3}z_{2}-y_{2}z_{3}\right)+x_{2}\left(y_{1}z_{3}-y_{3}z_{1}\right)+x_{3}\left(y_{2}z_{1}-y_{1}z_{2}\right)
\end{array}\right]
\]

\end_inset


\begin_inset Formula 
\[
\det\left[J\right]=6V^{e}=x_{21}\left(y_{23}z_{34}-y_{34}z_{23}\right)+x_{32}\left(y_{34}z_{12}-y_{12}z_{34}\right)+x_{43}\left(y_{12}z_{23}-y_{23}z_{12}\right).
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
由坐标的逆变换矩阵，可以计算形函数的梯度
\begin_inset Formula 
\[
\left[\begin{array}{c}
\nabla L_{1}^{e}\\
\nabla L_{2}^{e}\\
\nabla L_{3}^{e}\\
\nabla L_{4}^{e}
\end{array}\right]=\frac{1}{\det\left[J\right]}\left[\begin{array}{ccc}
b_{1} & c_{1} & d_{1}\\
b_{2} & c_{2} & d_{2}\\
b_{3} & c_{3} & d_{3}\\
b_{4} & c_{4} & d_{4}
\end{array}\right]\left[\begin{array}{c}
\sbf e_{x}\\
\sbf e_{y}\\
\sbf e_{z}
\end{array}\right]
\]

\end_inset

约定：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $M=\left[b_{i},c_{i},d_{i}\right]$
\end_inset

矩阵；希腊字母表示
\begin_inset Formula $\{1,2,3,4\}$
\end_inset

，对应节点数；
\end_layout

\begin_layout Enumerate
拉丁字母表示 
\begin_inset Formula $\{1,2,3\}$
\end_inset

，对应三维空间坐标
\begin_inset Formula $x,y,z$
\end_inset

：
\end_layout

\begin_layout Standard
则 
\begin_inset Formula $\nabla L^{e}$
\end_inset

 的各分量形式为：
\begin_inset Formula 
\begin{equation}
\partial_{i}L_{\alpha}^{e}=\frac{1}{\det\left[J\right]}{\color{blue}M_{\alpha i}}\label{eq:shapeGrad}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
雅可比矩阵等式
\end_layout

\begin_layout Standard
在每个单元上，根据 单元顶点的坐标组，定义了 
\color blue
几何坐标
\color inherit
（物理时空坐标）和 
\color blue
等参坐标
\color inherit
 之间的变换关系。
\end_layout

\begin_layout Enumerate
等参坐标组 
\begin_inset Formula $\left\{ \xi\right\} $
\end_inset

，对每个单元形式上相同，实际上依赖于 全局几何坐标 
\begin_inset Formula $\{X\}$
\end_inset

。
\end_layout

\begin_layout Enumerate
对于确定类型的单元，坐标变换矩阵 
\begin_inset Formula $T$
\end_inset

 由单元决定，而单元由顶点决定，因此通过 顶点坐标
\begin_inset Formula $\{X_{i}\}$
\end_inset

，可以参数出 雅可比矩阵 
\begin_inset Formula $[J]=\partial X/\partial\xi$
\end_inset

；
\end_layout

\begin_layout Enumerate
单元内点的几何坐标总是参数化成 
\begin_inset Formula $X=\sum_{i}N_{i}^{e}\left(x,y\right)X_{i}$
\end_inset

，形函数 
\begin_inset Formula $\{N_{i}^{e}\}$
\end_inset

 可以取不同 order，则对应的雅可比 
\begin_inset Formula $[J]$
\end_inset

 取不同的形式。
\end_layout

\begin_layout Enumerate
对于确定 order 的形函数 
\begin_inset Formula $\{N_{i}^{e}\}$
\end_inset

，除了顶点坐标组 
\begin_inset Formula $\{X_{i}\}$
\end_inset

 带来的区别，
\begin_inset Formula $[J]$
\end_inset

 中其它系数是固定的，只和 
\begin_inset Formula $\{N_{i}^{e}\}$
\end_inset

 在等参系中的函数形式有关。
\end_layout

\begin_layout Standard
因此变换的 雅可比矩阵 可以通过 各个顶点
\end_layout

\begin_layout Standard
可以计算出在三维直角坐标系中，雅可比矩阵为：
\begin_inset Formula 
\begin{equation}
\left[J\right]=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}\\
\frac{\partial x}{\partial\zeta} & \frac{\partial y}{\partial\zeta} & \frac{\partial z}{\partial\zeta}
\end{array}\right]=-\left[\begin{array}{ccc}
x_{12} & y_{12} & z_{12}\\
x_{13} & y_{13} & z_{13}\\
x_{14} & y_{14} & z_{14}
\end{array}\right].\label{eq:jacobi3d}
\end{equation}

\end_inset

其中记号约定为： 
\begin_inset Formula $x_{12}=x_{1}-x_{2}$
\end_inset

，其他类似。雅可比矩阵的逆矩阵为
\begin_inset Formula 
\[
\left[J^{-1}\right]=\frac{1}{\det\left[J\right]}\left[\begin{array}{ccc}
b_{2} & b_{3} & b_{4}\\
c_{2} & c_{3} & c_{4}\\
d_{2} & d_{3} & d_{4}
\end{array}\right].
\]

\end_inset


\end_layout

\begin_layout Example
令 
\begin_inset Formula $r_{\alpha j}$
\end_inset

 表示四面体单元中，节点的坐标矩阵，
\begin_inset Formula 
\[
r_{\alpha j}=\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]
\]

\end_inset

根据 雅可比矩阵 的表达式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi3d"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以计算出：
\begin_inset Formula 
\[
\frac{\partial\det[J]}{\partial r_{\alpha j}}={\color{blue}M_{\alpha j}},\quad{\color{blue}M_{\alpha j}}=\left[\begin{array}{ccc}
b_{1} & c_{1} & d_{1}\\
b_{2} & c_{2} & d_{2}\\
b_{3} & c_{3} & d_{3}\\
b_{4} & c_{4} & d_{4}
\end{array}\right]
\]

\end_inset

 考虑到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:shapeGrad"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\partial_{i}L_{\alpha}^{e}=\frac{1}{\det\left[J\right]}{\color{blue}M_{\alpha i}}$
\end_inset

，因此有
\begin_inset Formula 
\begin{equation}
\frac{\partial\det[J]}{\partial r_{\alpha j}}=\det[J]\,\partial_{j}L_{\alpha}^{e}\label{eq:xl6.7}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi3d"
plural "false"
caps "false"
noprefix "false"

\end_inset

，计算出雅可比逆矩阵的偏导
\begin_inset Formula 
\[
\frac{\partial[J^{-1}]}{\partial\sbf r_{\alpha}}=-[J^{-1}]\frac{\partial J}{\partial\sbf r_{\alpha}}[J^{-1}]=-\frac{1}{\det[J]}\left[\begin{array}{c}
b_{\alpha}\\
c_{\alpha}\\
d_{\alpha}
\end{array}\right]\left[\begin{array}{ccc}
\sbf e_{x} & \sbf e_{y} & \sbf e_{z}\end{array}\right][J^{-1}]
\]

\end_inset

同样引入 节点坐标矩阵 
\begin_inset Formula $r_{\alpha j}=\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]$
\end_inset

，可以写成分量形式
\begin_inset Formula 
\begin{align}
\frac{\partial J_{kj}^{-1}}{\partial r_{\alpha i}}=-\partial_{k}L_{\alpha}^{e}\;J_{ij}^{-1}.\label{eq:xl6.8}
\end{align}

\end_inset

推导是在 三维直角坐标系 中进行的，即
\begin_inset Formula 
\[
\frac{\partial J_{kj}^{-1}}{\partial r_{\alpha i}}\sbf e_{i}=-\partial_{k}L_{\alpha}^{e}\;\sbf e_{i}\,J_{ij}^{-1},\quad\sbf e_{i}=(\sbf e_{x},\sbf e_{y},\sbf e_{z}).
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
设矩阵
\begin_inset Formula $g_{\mu\lambda}$
\end_inset

，它的行列式为
\begin_inset Formula $g$
\end_inset

，
\begin_inset Formula $g$
\end_inset

可以按第
\begin_inset Formula $\mu$
\end_inset

行展开为
\begin_inset Formula $g=g_{\mu\lambda}A^{\mu\lambda}$
\end_inset

，只对
\begin_inset Formula $\lambda$
\end_inset

求和，其中
\begin_inset Formula $A^{\mu\lambda}$
\end_inset

是
\begin_inset Formula $g_{\mu\lambda}$
\end_inset

的代数余子式。所以
\begin_inset Formula $\partial g/\partial g_{\mu\lambda}=A^{\mu\lambda}$
\end_inset

。而
\begin_inset Formula $g_{\mu\lambda}$
\end_inset

的逆矩阵写作
\begin_inset Formula $g^{\lambda\mu}=A^{\mu\lambda}/g$
\end_inset

，所以有
\begin_inset Formula 
\begin{equation}
\frac{\partial g}{\partial g_{\mu\lambda}}=A^{\mu\lambda}=gg^{\lambda\mu}.\label{eq:mat-eq}
\end{equation}

\end_inset

其中 
\begin_inset Formula $g^{\lambda\mu}$
\end_inset

 是 
\begin_inset Formula $g_{\mu\lambda}$
\end_inset

 对应的逆矩阵，并注意指标的变化。可以看到，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mat-eq"
plural "false"
caps "false"
noprefix "false"

\end_inset

与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

具有类似的形式。
\end_layout

\begin_layout Section
Edge单元
\end_layout

\begin_layout Standard
在有限元方法计算磁场时，特别是三维磁场，通常会使用在单元边上定义的 Edge 单元（而非节点上定义的）作为待求未知量。图1.1为四面体单元上棱边与节点的对应关系，
在棱边 
\begin_inset Formula $i$
\end_inset

 上可以定义形函数：
\begin_inset Formula 
\[
\sbf N_{i}^{e}=\left(L_{i(1)}^{e}\nabla L_{i(2)}^{e}-L_{i(2)}^{e}\nabla L_{i(1)}^{e}\right)\ell_{i}^{e}
\]

\end_inset

其中 
\begin_inset Formula $i(1)$
\end_inset

与 
\begin_inset Formula $i(2)$
\end_inset

为与棱边
\begin_inset Formula $i$
\end_inset

 邻接的两个顶点。
\begin_inset Formula $\ell_{i}^{e}$
\end_inset

 的绝对值等于棱边的长度，正负号由节点的总体编号决定。
\begin_inset Formula $\nabla\cdot\sbf N_{i}^{e}=0$
\end_inset

，此性质只取决于上式的构造，不依赖于
\begin_inset Formula $L_{i(1)}^{e}$
\end_inset

和
\begin_inset Formula $L_{i(2)}^{e}$
\end_inset

的具体表达式。形函数 
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

 为一矢量，相应的矢量图可以参照图1.2所示的二维情况。
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/xl-1.2.png
	scale 60

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
二维三角形单元，相邻单元同一条棱边上形函数的矢量图分布。
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
为什么叫做等参单元
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "有限元中什么是等参单元"
target "https://www.zhihu.com/question/29564930/answer/77635688"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "邱小白"
target "https://www.zhihu.com/question/29564930/answer/77582890"
literal "false"

\end_inset

 
\end_layout

\begin_layout Enumerate
对于场函数，例如位移场，我们可以通过 
\color blue
节点的场值
\color inherit
 与 
\color blue
插值函数
\color inherit
 来表示场内各点的场值。设节点数为
\begin_inset Formula $n$
\end_inset

。一般而言，此公式是表示在局域坐标下的：
\begin_inset Formula 
\[
u=\sum_{i=1}^{n}N_{i}^{e}(\xi_{1}\cdots)u_{i}
\]

\end_inset


\end_layout

\begin_layout Enumerate
将单元从规则的 局域坐标系（如三角形的面积坐标系）转化到 全局坐标系 中，我们需要建立两个坐标系之间的变换关系。坐标变换 和场变换类似，通过 全局坐标系
 下的 
\color blue
节点坐标
\color inherit
，和用 局部坐标 表示的 插值函数， 可以表出 单元内动点 的
\color blue
全局坐标
\color inherit
。设 节点数为
\begin_inset Formula $m$
\end_inset

，
\begin_inset Formula 
\[
x=\sum_{i=1}^{m}N_{i}^{e\prime}(\xi_{1}\cdots)x_{i}
\]

\end_inset

注意形函数
\begin_inset Formula $N_{i}^{e\prime}(\xi_{1}\cdots)$
\end_inset

对局域参数
\begin_inset Formula $\{\xi_{1}\cdots\}$
\end_inset

的具体系数，与一众
\begin_inset Formula $\{x_{i}\}$
\end_inset

也有关系；也就是坐标变换特定于每个单元。如果 场函数插值 所用节点数，与 坐标变换所用节点数 相等时，即 
\begin_inset Formula $n=m$
\end_inset

，而且两者采用相同的插值函数，即 
\begin_inset Formula $N_{i}^{e\prime}=N_{i}^{e}$
\end_inset

。那么，我们称这种变换叫 
\color blue
等参变换
\color inherit
，这种单元叫 
\color blue
等参单元
\color inherit
。
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $n<m$
\end_inset

，即 场展开节点数
\begin_inset Formula $<$
\end_inset

坐标展开节点数，我们称为 超参变换，单元为超参单元；
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $n>m$
\end_inset

，即 场展开节点数
\begin_inset Formula $>$
\end_inset

坐标展开节点数，我们称为亚参变换，单元为亚参单元。
\end_layout

\begin_layout Enumerate
为什么会出现等参单元，因为方便。局部坐标系下的单元是很规则的单元，我们可以很容易通过 Lagrange 插值、划线法、Hermite插值来构造
 单元内场的插值函数。而且，如果单元是等参单元的话，坐标变换也可以运用场的插值函数，把局部坐标系下的规则单元变换为笛卡尔坐标系、极坐标、球坐标下的各种离奇形状的
单元。即使这么做，对于刚度矩阵、力向量的积分上也不会很困难，所以我们很热爱等参单元。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
很多时候划分网格后的单元是很不规则的，造成的结果是每个 element 都要用不同的 shape function，非常麻烦。于是有的哥们就思考能不能将单元标准
化，即把单元都 mapping 成同一个单元，这样不就简单了吗。拿简单的一维问题为例，如下图：
\end_layout

\begin_layout Example
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/element-mapping.png
	scale 50

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
等参坐标变换
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
目标是将局部坐标系(local coordinates) 映射成范围是 
\begin_inset Formula $[-1,1]$
\end_inset

 的自然坐标系(natural coordinates)。可是如何做到呢，于是这个哥们深入思考发现：如果场函数插值(比如例子中的位移场)，和单元
 局部坐标系 到 自然坐标系 的变换使用同一个 shape function 不就行了吗？这样说可能比较抽象，下面的公式比较直观：
\begin_inset Formula 
\begin{align*}
 & x\left(\xi\right)=N_{i}\left(\xi\right)x_{i},\\
 & u\left(\xi\right)=N_{i}\left(\xi\right)u_{i}.
\end{align*}

\end_inset

其中 
\begin_inset Formula $x$
\end_inset

 是局部坐标系坐标，
\begin_inset Formula $x_{i}$
\end_inset

 是节点的局部坐标；
\begin_inset Formula $u_{i}$
\end_inset

 是节点在局部坐标系下的位移，
\begin_inset Formula $u$
\end_inset

 则是插值后的位移场。
\end_layout

\begin_layout Enumerate
举个例子，对于结点 
\begin_inset Formula $1$
\end_inset

(
\begin_inset Formula $i=1$
\end_inset

)，
\begin_inset Formula 
\[
N_{1}(-1)=1,N_{2}(-1)=0,
\]

\end_inset

 所以 
\begin_inset Formula $x\left(-1\right)=x_{1}$
\end_inset

，
\begin_inset Formula $u(-1)=u_{1}$
\end_inset

，两个插值使用同一个shape function。mapping 到 
\begin_inset Formula $\left[-1,1\right]$
\end_inset

 的另一个好处是积分方便，通常可以使用如下近似方程（以二维为例）：
\begin_inset Formula 
\[
\int_{-1}^{1}\int_{-1}^{1}\phi(\xi,\eta)\dd{\xi}\dd{\eta}\approx\phi(1/\sqrt{3},1/\sqrt{3})+\phi(-1/\sqrt{3},-1/\sqrt{3})+\phi(-1/\sqrt{3},1/\sqrt{3})+\phi(1/\sqrt{3},-1/\sqrt{3}).
\]

\end_inset

当然，由于 shape function 
\begin_inset Formula $N_{i}$
\end_inset

 现在是 
\begin_inset Formula $\xi$
\end_inset

 的函数，而积分时需要的经常是 
\begin_inset Formula $\partial N_{i}/\partial x$
\end_inset

，所以需要引入雅可比 
\begin_inset Formula $J$
\end_inset

(Jacobian)，即 
\begin_inset Formula $\dd{x}\dd{\xi}$
\end_inset

 。这样就可以通过链式法则：
\begin_inset Formula $\frac{\partial N_{i}}{\partial\xi}=\frac{\partial N_{i}}{\partial x}\frac{\dd{x}}{\dd{\xi}}$
\end_inset

 得出 
\begin_inset Formula $\frac{\partial N_{i}}{\partial x}=\frac{1}{J}\frac{\partial N_{i}}{\partial\xi}$
\end_inset

。
\end_layout

\begin_layout Enumerate
同理，对于三角形单元，可以将其 mapping 成直角边为 
\begin_inset Formula $1$
\end_inset

 的等腰直角三角形；对于四边形单元，可以将其 mapping 成顶点分别为 
\begin_inset Formula $(-1,-1)$
\end_inset

，
\begin_inset Formula $(-1,1)$
\end_inset

, 
\begin_inset Formula $(1,-1)$
\end_inset

, 
\begin_inset Formula $(1,1)$
\end_inset

 的正方形，等等。
\end_layout

\begin_layout Chapter
有限元的等参坐标方法
\end_layout

\begin_layout Section
物理坐标与参数坐标
\end_layout

\begin_layout Enumerate
通过使用形函数
\begin_inset Formula $\{N_{i}^{e}\}$
\end_inset

，可以将 求解区域上的小单元（称作 
\series bold
物理单元
\series default
），一一映射到 等参坐标空间的小单元（称作 
\series bold
参数单元
\series default
）。
\end_layout

\begin_layout Enumerate
对于两个一一映射的 
\series bold
物理单元
\series default
 与 
\series bold
参数单元
\series default
，当 
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

 在取值范围内变动时，勾勒出等参空间的标准单元形状（例如等腰直角三角形）；对应的 
\begin_inset Formula $\{x,y\}$
\end_inset

 将在物理空间变动，勾勒出物理空间的单元（即一般的三角形）。注意我们统一使用 
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

表示等参坐标，但是
\series bold
具体的坐标变换 对于不同的单元是不同的，也就是每个坐标变换局域于它的单元上
\series default
。具体来说，坐标变换的 
\series bold
系数
\series default
 依赖于 
\series bold
节点
\series default
 的物理坐标。
\end_layout

\begin_layout Enumerate
如果真实的求解区域是平面，物理单元中某点
\begin_inset Formula $(x_{0},y_{0})$
\end_inset

的邻域
\begin_inset Formula $\left\{ x_{0}+\dd{x},y_{0}+\dd{y}\right\} $
\end_inset

可以 精确对应到等参单元中的邻域 
\begin_inset Formula $\left\{ \xi_{0}+\dd{\xi},\eta_{0}+\dd{\xi}\right\} $
\end_inset

，因为单元都是线性的。
\end_layout

\begin_layout Enumerate
如果真实的求解区域是曲面，物理单元中某点
\begin_inset Formula $(x_{0},y_{0})$
\end_inset

的邻域，只是近似对应等参单元中的邻域。因为如果形函数是线性的，插值出来的只能是平面，不能还原出真实的曲面性质（只有节点处是精确的）。要想尽量贴合原先的单元，需要
采用更高阶的形函数，模拟出曲面的弯曲。
\end_layout

\begin_layout Standard
物理坐标与等参坐标的 变换式（映射关系）为：
\begin_inset Formula 
\begin{align}
 & x=\sum_{i}N_{i}^{e}\left(\xi,\eta\right)x_{i}\label{eq:coord}\\
 & y=\sum_{i}N_{i}^{e}\left(\xi,\eta\right)y_{i}\nonumber 
\end{align}

\end_inset

其中 
\begin_inset Formula $N_{i}^{e}$
\end_inset

 表示某个单元中，第
\begin_inset Formula $i$
\end_inset

个节点对应的形函数，对重复指标进行求和。实际计算中，如果取节点（单元插值点）的形式为
\begin_inset Formula 
\[
\overline{X}_{j\alpha}=\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}\\
x_{3} & y_{3}\\
\cdots & \cdots
\end{array}\right]
\]

\end_inset

为一
\begin_inset Formula $\left[n,2\right]$
\end_inset

矩阵。并将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:coord"
plural "false"
caps "false"
noprefix "false"

\end_inset

表示为矩阵乘法的形式：
\begin_inset Formula 
\[
\left[\begin{array}{c}
x\\
y
\end{array}\right]=\left[\begin{array}{cccc}
x_{1} & x_{2} & x_{3} & \cdots\\
y_{1} & y_{2} & y_{3} & \cdots
\end{array}\right]\left[\begin{array}{c}
N_{1}\\
N_{2}\\
N_{3}\\
\cdots
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
总结：用指标表示，则小单元中动点的物理坐标是
\color blue

\begin_inset Formula 
\[
X_{j}=\overline{X}_{j\alpha}N_{\alpha}
\]

\end_inset


\color inherit
其中 
\begin_inset Formula $X=\left(x,y\right)$
\end_inset

 表示动点的 
\series bold
参数单元
\series default
 坐标，
\begin_inset Formula $\overline{X}_{j\alpha}$
\end_inset

 表示节点物理坐标，
\begin_inset Formula $N_{\alpha}$
\end_inset

 表示形函数。
\begin_inset Formula $j\in\left\{ 1,2\right\} $
\end_inset

 是空间的维数，
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是节点的数目。
\end_layout

\end_inset


\end_layout

\begin_layout Section
积分测度与雅可比矩阵
\end_layout

\begin_layout Standard
在等参坐标的方法中，独立物理坐标的个数和独立参数的个数相等，例如对于二维都是
\begin_inset Formula $2$
\end_inset

。物理坐标与参数坐标微分的变换式是：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\dd{x}\dd{y}=\det[J]\left(\xi,\eta\right)\dd{\xi}\dd{\eta}
\]

\end_inset

其中引入了 Jacobi 矩阵 
\begin_inset Formula $J$
\end_inset

 （对于
\begin_inset Formula $2$
\end_inset

维是
\begin_inset Formula $2\times2$
\end_inset

矩阵），并定义为
\begin_inset Formula 
\begin{align}
J\left(\xi,\eta\right) & =\frac{\partial\left(N_{i}^{e}x_{i},N_{i}^{e}y_{i}\right)}{\partial\left(\xi,\eta\right)}=\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]\label{eq:jacobi}\\
 & =\sum_{i}\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{i} & y_{i}\end{array}\right)\nonumber 
\end{align}

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
注意到
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color inherit
 
\begin_inset Formula $J$
\end_inset

 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
的定义中，参数
\begin_inset Formula $\xi$
\end_inset

充当行指标，物理坐标
\begin_inset Formula $x$
\end_inset

充当列指标。例如当 
\begin_inset Formula $i=1,2,3$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula 
\[
J\left(\xi,\eta\right)=\left(\begin{array}{ccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}\\
x_{3} & y_{3}
\end{array}\right)
\]

\end_inset

如果是高阶单元则节点数目增加，但公式类似，都表示成 
\begin_inset Formula $[2,n]\times[n,2]$
\end_inset

 的矩阵乘积，最后的结果是 
\begin_inset Formula $[2,2]$
\end_inset

 矩阵。
\end_layout

\begin_layout Remark
雅可比矩阵 
\begin_inset Formula $J$
\end_inset

 就是坐标微分的变换式
\begin_inset Formula 
\[
\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]=\left[\begin{array}{cc}
\dd{\xi} & \dd{\eta}\end{array}\right]\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]
\]

\end_inset


\begin_inset Formula $J$
\end_inset

 对应的逆变换矩阵，就是 
\begin_inset Formula $J$
\end_inset

 的逆矩阵（
\begin_inset Formula $J^{-1}$
\end_inset

 ）：
\begin_inset Formula 
\begin{align}
\left[\begin{array}{cc}
\dd{\xi} & \dd{\eta}\end{array}\right] & =\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]\left[\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}\right]^{-1}\nonumber \\
 & =\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]\left[\begin{array}{cc}
\frac{\partial\xi}{\partial x} & \frac{\partial\eta}{\partial x}\\
\frac{\partial\xi}{\partial y} & \frac{\partial\eta}{\partial y}
\end{array}\right]\label{eq:jacobi2}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
总结：雅可比矩阵 
\begin_inset Formula $\partial\left(x,y\right)/\partial\left(\xi,\eta\right)$
\end_inset

为
\color blue

\begin_inset Formula 
\[
J_{ki}=(\tilde{\partial}_{k}\,N_{\alpha})\,\overline{X}_{\alpha i}
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $k,i\in\left\{ 1,2\right\} $
\end_inset

是自由度数目（
\begin_inset Formula $\xi$
\end_inset

对应行指标，
\begin_inset Formula $x$
\end_inset

对应列指标）；
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\overline{X}_{\alpha i}$
\end_inset

 表示节点坐标；
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是插值点的数目；
\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{\alpha}$
\end_inset

 表示形函数，
\begin_inset Formula $\tilde{\partial}$
\end_inset

表示对 
\begin_inset Formula $\xi$
\end_inset

，
\begin_inset Formula $\eta$
\end_inset

 求偏导。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
计算形函数的梯度
\end_layout

\begin_layout Standard
我们来计算 形函数 对物理坐标的梯度 
\begin_inset Formula $\nabla N_{i}^{e}$
\end_inset

，它可以通过 Jacobi 矩阵，和形函数对等参坐标（
\begin_inset Formula $\xi$
\end_inset

）的梯度表示（以二维为例）
\begin_inset Formula 
\begin{align*}
\nabla N_{i}^{e} & =\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial x}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial y}
\end{array}\right)=\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\frac{\partial\xi}{\partial x}+\frac{\partial N_{i}^{e}}{\partial\eta}\frac{\partial\eta}{\partial x}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\xi}\frac{\partial\xi}{\partial y}+\frac{\partial N_{i}^{e}}{\partial\eta}\frac{\partial\eta}{\partial y}
\end{array}\right)\\
 & =\left(\begin{array}{cc}
\frac{\partial\xi}{\partial x} & \frac{\partial\eta}{\partial x}\vspace{1ex}\\
\frac{\partial\xi}{\partial y} & \frac{\partial\eta}{\partial y}
\end{array}\right)\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)=\left[J\left(\xi,\eta\right)\right]^{-1}\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right).
\end{align*}

\end_inset

例如对于 
\begin_inset Formula $i\in\{1,2,3\}$
\end_inset

，可以写成矩阵形式：
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
\nabla N_{1}^{e} & \nabla N_{2}^{e} & \nabla N_{3}^{e}\end{array}\right]=\left[J\left(\xi,\eta\right)\right]^{-1}\left(\begin{array}{ccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta}
\end{array}\right).
\]

\end_inset

维数变换是 
\begin_inset Formula $\left[2,2\right]\times\left[2,n\right]\rightarrow\left[2,n\right]$
\end_inset

。
\begin_inset Formula $J\left(\xi,\eta\right)$
\end_inset

正是
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi"
plural "false"
caps "false"
noprefix "false"

\end_inset

定义的雅可比矩阵：
\begin_inset Formula 
\[
J\left(\xi,\eta\right)=\frac{\partial\left(N_{i}^{e}x_{i},N_{i}^{e}y_{i}\right)}{\partial\left(\xi,\eta\right)}=\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\vspace{1ex}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right].
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
总结：在单元内动点
\begin_inset Formula $p$
\end_inset

处，形函数的物理梯度 
\begin_inset Formula $\nabla N_{i}^{e}$
\end_inset

 可以表出为
\color blue

\begin_inset Formula 
\begin{equation}
\partial_{i}N_{\alpha}^{e}=\left(J^{-1}\right)_{ij}\tilde{\partial}_{j}N_{\alpha}^{e}.\label{eq:gradient}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $i,j\in\left\{ 1,2\right\} $
\end_inset

是自由度数目，
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是插值点的数目；
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\partial$
\end_inset

 表示对物理坐标 
\begin_inset Formula $\left\{ x,y\right\} $
\end_inset

 求偏导，
\begin_inset Formula $\tilde{\partial}$
\end_inset

表示对等参坐标 
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

 求偏导。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
单元上的积分
\end_layout

\begin_layout Subsection
数值计算，高斯积分法
\end_layout

\begin_layout Standard
在计算有限元单元上的积分时，一般先通过坐标变换，将被积表达式从物理单元 映射到 等参单元，然后通过高斯积分法（Gauss quadrature）作数值估计。假设
小单元是三角形的，被积函数是 
\begin_inset Formula $P(x,y)$
\end_inset


\begin_inset Formula 
\begin{align}
\int_{\Delta}P\left(x,y\right)\,\dd{x}\dd{y} & =\int{\color{blue}P\left(\xi,\eta\right)\,\det[J\left(\xi,\eta\right)]}\dd{\xi}\dd{\eta}\label{eq:gauss-quad}\\
 & =\sum_{m}{\color{blue}P\left(\xi_{m},\eta_{m}\right)\,\det[J\left(\xi_{m},\eta_{m}\right)]}\;W\left(\xi_{m},\eta_{m}\right)\nonumber 
\end{align}

\end_inset

其中
\begin_inset Formula $W\left(\xi_{m},\eta_{m}\right)$
\end_inset

 是高斯积分法中的权函数（Weight）。在实际使用中，一般
\begin_inset Formula $N_{i}^{e}\left(\xi,\eta\right)$
\end_inset

 的具体形式事先已经确定 ：
\end_layout

\begin_layout Enumerate
由于节点坐标 
\begin_inset Formula $\{x_{i},y_{i}\}$
\end_inset

 是已知常数，再加上知晓 
\begin_inset Formula $N_{i}^{e}\left(\xi,\eta\right)$
\end_inset

的具体形式，所以能算出雅可比矩阵 
\begin_inset Formula $J(\xi,\eta)=\partial x/\partial\xi$
\end_inset

，以及行列式
\begin_inset Formula $\det J(\xi,\eta)$
\end_inset

。
\end_layout

\begin_layout Enumerate
至于高斯积分法的采样点 
\begin_inset Formula $\left\{ p_{m}\right\} $
\end_inset

，与权函数
\begin_inset Formula $W\left(\xi_{m},\eta_{m}\right)$
\end_inset

 ，可以通过查表获取，这些结果都使用等参坐标 
\begin_inset Formula $\left(\xi,\eta\right)$
\end_inset

 表示。
\end_layout

\begin_layout Enumerate
将被积函数 
\begin_inset Formula $P\left(x_{m},y_{m}\right)$
\end_inset

 变换到 
\begin_inset Formula $P\left(\xi_{m},\eta_{m}\right)$
\end_inset

 表示：对坐标的依赖使用 坐标变换，对微分 的依赖使用雅可比矩阵 和链式法则。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\det[J]$
\end_inset

正比于几何区域的面积，例如线性三角形单元的面积
\begin_inset Formula $\Delta^{e}=\frac{1}{2}\det[J]$
\end_inset

。在 Solver程序中，这个几何因子（
\begin_inset Formula $1/2$
\end_inset

）被吸收进 权重因子 
\begin_inset Formula $W_{i}^{\prime}$
\end_inset

，因此 Solver程序中高斯积分法的公式写作：
\begin_inset Formula 
\[
\iint_{\Omega^{e}}P\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{x}\dd{y}=\sum_{i=1}^{m}P\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset

这里的
\begin_inset Formula $L_{i}^{e}$
\end_inset

只是
\begin_inset Formula $\{1-\xi-\eta,\xi,\eta\}$
\end_inset

的另一种写法。
\end_layout

\begin_layout Subsection
解析计算
\end_layout

\begin_layout Standard
参考金建铭4.3.3.1。线性三角形单元上的一阶形函数积分满足下式
\begin_inset Formula 
\begin{equation}
\iint_{\Omega^{e}}\left(N_{1}^{e}\right)^{l}\left(N_{2}^{e}\right)^{m}\left(N_{3}^{e}\right)^{n}\dd{x}\dd{y}=\frac{l!m!n!}{\left(l+m+n+2\right)!}2\Delta^{e}.\label{eq:jm4.32}
\end{equation}

\end_inset

其中
\begin_inset Formula $\Delta^{e}$
\end_inset

是三角形的面积，
\begin_inset Formula $\Delta^{e}=\frac{1}{2}\det[J]$
\end_inset

。
\end_layout

\begin_layout Section
计算刚度矩阵
\end_layout

\begin_layout Standard
再次列出静电场的泊松方程：
\begin_inset Formula 
\[
\sbf\nabla\left(\alpha\cdot\sbf\nabla\phi\right)+\beta\phi=f,\quad\left(x,y\right)\in\Omega.
\]

\end_inset

它对应的刚度矩阵是
\begin_inset Formula 
\begin{align*}
 & K_{ij}^{e}=\iint_{\Omega^{e}}\left[(\nabla N_{i}^{e})\cdot\alpha\cdot(\nabla N_{j}^{e})+\beta N_{i}^{e}N_{j}^{e}\right]\dd{x}\dd{y},\\
 & b_{i}^{e}=\iint_{\Omega^{e}}fN_{i}^{e}\dd{x}\dd{y},\quad i,j=1,2,3
\end{align*}

\end_inset

代入前文讨论中的公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gradient"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:gauss-quad"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到
\begin_inset Formula 
\[
K_{ij}^{e}=\iint_{\Omega^{e}}\left[\left(\tilde{\nabla}N\right)_{i}^{\mathrm{T}}\cdot J^{-1,\mathrm{T}}\cdot\alpha J^{-1}\cdot\left(\tilde{\nabla}N\right)_{j}+\beta N_{i}^{e}N_{j}^{e}\right]{\color{blue}\det\left[J\right]}\,\dd{\xi}\dd{\eta}
\]

\end_inset

其中 
\begin_inset Formula $\left(\tilde{\nabla}N\right)_{i}=\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)$
\end_inset

，是单元上第
\begin_inset Formula $i$
\end_inset

个形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

 对
\begin_inset Formula $\xi$
\end_inset

的梯度；上标中的
\begin_inset Formula $\,^{\mathrm{T}}$
\end_inset

表示矩阵转置。
\end_layout

\begin_layout Example
对于二维的一阶三角形（线性）单元，代入形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

的定义，得到雅可比矩阵 
\begin_inset Formula $[\partial X/\partial\xi]$
\end_inset

 为：
\begin_inset Formula 
\[
J\left(\xi,\eta\right)=\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{i} & y_{i}\end{array}\right)=\left(\begin{array}{cc}
x_{1}-x_{3} & y_{1}-y_{3}\\
x_{2}-x_{3} & y_{2}-y_{3}
\end{array}\right)=\left(\begin{array}{cc}
x_{1}-x_{3} & y_{1}-y_{3}\\
x_{2}-x_{3} & y_{2}-y_{3}
\end{array}\right)=\left[\begin{array}{cc}
c_{2}^{e} & -b_{2}^{e}\\
-c_{1}^{e} & b_{1}^{e}
\end{array}\right]
\]

\end_inset

因此对应的逆矩阵
\begin_inset Formula $J^{-1}$
\end_inset

，以及 
\begin_inset Formula $J^{-1,\mathrm{T}}\cdot J^{-1}$
\end_inset

为，
\begin_inset Formula 
\begin{align}
 & J^{-1}\left(\xi,\eta\right)=\frac{1}{2\Delta^{e}}\left[\begin{array}{cc}
b_{1}^{e} & b_{2}^{e}\\
c_{1}^{e} & c_{2}^{e}
\end{array}\right],\quad J^{-1,T}\left(\xi,\eta\right)=\frac{1}{2\Delta^{e}}\left[\begin{array}{cc}
b_{1}^{e} & c_{1}^{e}\\
b_{2}^{e} & c_{2}^{e}
\end{array}\right],\nonumber \\
 & J^{-1,\mathrm{T}}\cdot J^{-1}=\frac{1}{4\Delta^{e,2}}\left[\begin{array}{cc}
b_{1}^{e,2}+c_{1}^{e,2} & b_{1}^{e}b_{2}^{e}+c_{1}^{e}c_{2}^{e}\\
b_{1}^{e}b_{2}^{e}+c_{1}^{e}c_{2}^{e} & b_{2}^{e,2}+c_{2}^{e,2}
\end{array}\right]\label{eq:my-JJ}
\end{align}

\end_inset

列出二维一阶形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

的表达式：
\begin_inset Formula 
\[
N_{1}^{(1)}=1-\xi-\eta,\quad N_{2}^{(1)}=\xi,\quad N_{3}^{(1)}=\eta
\]

\end_inset


\begin_inset Formula $N_{i}^{e}$
\end_inset

对
\begin_inset Formula $\xi$
\end_inset

的梯度为
\begin_inset Formula 
\begin{equation}
\left(\tilde{\nabla}N\right)_{i}=\left(\begin{array}{ccc}
-1 & 1 & 0\\
-1 & 0 & 1
\end{array}\right),\label{eq:my-gradN}
\end{equation}

\end_inset

其中参数
\begin_inset Formula $\xi$
\end_inset

作为行指标，形函数编号
\begin_inset Formula $i$
\end_inset

作为列指标。
\end_layout

\begin_layout Example
从表达式易知，
\begin_inset Formula $K_{ij}$
\end_inset

为对称阵，
\begin_inset Formula 
\[
K_{ij}^{e}=\iint_{\Omega^{e}}\left[\left(\tilde{\nabla}N\right)_{i}^{\mathrm{T}}\cdot J^{-1,\mathrm{T}}\cdot\alpha J^{-1}\cdot\left(\tilde{\nabla}N\right)_{j}+\beta N_{i}^{e}N_{j}^{e}\right]\,\dd{x}\dd{y}
\]

\end_inset

从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my-JJ"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my-gradN"
plural "false"
caps "false"
noprefix "false"

\end_inset

可知，
\begin_inset Formula $K_{ij}$
\end_inset

被积式第一项为常数，使用解析公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jm4.32"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到积分结果是 
\begin_inset Formula $\frac{1}{4\Delta^{e}}\left(\alpha_{x}^{e}b_{i}^{e}b_{j}^{e}+\alpha_{y}^{e}c_{i}^{e}c_{j}^{e}\right)$
\end_inset

（这里还考虑了更一般地，
\begin_inset Formula $\alpha$
\end_inset

非各向同性）。同理，使用解析公式，被积式第二项的积分结果是
\begin_inset Formula $\frac{\Delta^{e}}{12}\beta^{e}(1+\delta_{ij})$
\end_inset

。
\begin_inset Formula $b_{i}^{e}$
\end_inset

的积分也可套公式得出。综合起来便是
\begin_inset Newline newline
\end_inset


\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset Formula 
\begin{align}
 & K_{ij}^{e}=\frac{1}{4\Delta^{e}}\left(\alpha_{x}^{e}b_{i}^{e}b_{j}^{e}+\alpha_{y}^{e}c_{i}^{e}c_{j}^{e}\right)+\frac{\Delta^{e}}{12}\beta^{e}\left(1+\delta_{ij}\right)\label{eq:jm4.33}\\
 & b_{i}^{e}=\frac{\Delta^{e}}{3}f^{e}\label{eq:jm4.34}
\end{align}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
以上使用了： 
\begin_inset Formula 
\begin{align*}
 & N_{1}^{e}=\frac{\Delta_{1}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{1}^{e}+b_{1}^{e}x+c_{1}^{e}y}{2}=1-\xi-\eta,\\
 & N_{2}^{e}=\frac{\Delta_{2}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{2}^{e}+b_{2}^{e}x+c_{2}^{e}y}{2}=\xi,\\
 & N_{3}^{e}=\frac{\Delta_{3}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{3}^{e}+b_{3}^{e}x+c_{3}^{e}y}{2}=\eta.
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align}
 & a_{1}^{e}=x_{2}^{e}y_{3}^{e}-y_{2}^{e}x_{3}^{e}; &  & b_{1}^{e}=y_{2}^{e}-y_{3}^{e}; &  & c_{1}^{e}=x_{3}^{e}-x_{2}^{e}\nonumber \\
 & a_{2}^{e}=x_{3}^{e}y_{1}^{e}-y_{3}^{e}x_{1}^{e}; &  & b_{2}^{e}=y_{3}^{e}-y_{1}^{e}; &  & c_{2}^{e}=x_{1}^{e}-x_{3}^{e}\label{eq:4.24-1}\\
 & a_{3}^{e}=x_{1}^{e}y_{2}^{e}-y_{1}^{e}x_{2}^{e}; &  & b_{3}^{e}=y_{1}^{e}-y_{2}^{e}; &  & c_{3}^{e}=x_{2}^{e}-x_{1}^{e}\nonumber 
\end{align}

\end_inset

满足 
\begin_inset Formula $\sum b_{i}=0$
\end_inset

，
\begin_inset Formula $\sum c_{i}=0$
\end_inset

。
\begin_inset Formula 
\[
\Delta^{e}=\frac{1}{2}\left|\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right|=\frac{1}{2}\left(b_{2}^{e}c_{3}^{e}-b_{3}^{e}c_{2}^{e}\right)=\text{第}e\text{个单元的面积}
\]

\end_inset

普通坐标和等参坐标之间的变换为：
\begin_inset Formula 
\begin{align*}
 & \left[\begin{array}{c}
x\\
y
\end{array}\right]=\left[\begin{array}{cc}
c_{3}^{e} & -c_{2}^{e}\\
-b_{3}^{e} & b_{2}^{e}
\end{array}\right]\left[\begin{array}{c}
\xi\\
\eta
\end{array}\right]+\left[\begin{array}{c}
x_{1}^{e}\\
y_{1}^{e}
\end{array}\right],\\
 & \left[\begin{array}{c}
\xi\\
\eta
\end{array}\right]=\frac{1}{2\Delta^{e}}\left\{ \left[\begin{array}{cc}
b_{2}^{e} & c_{2}^{e}\\
b_{3}^{e} & c_{3}^{e}
\end{array}\right]\left[\begin{array}{c}
x\\
y
\end{array}\right]+\left[\begin{array}{c}
a_{2}^{e}\\
a_{3}^{e}
\end{array}\right]\right\} ,\\
 & \frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\det J={\color{blue}\left(b_{2}^{e}c_{3}^{e}-b_{3}^{e}c_{2}^{e}\right)}=2{\color{blue}\Delta^{e}}.
\end{align*}

\end_inset


\end_layout

\begin_layout Chapter
有限元的矩阵方程
\end_layout

\begin_layout Standard
在很多情况下，电磁方程可以化为如下形式
\begin_inset Formula 
\begin{equation}
-\nabla\cdot\left(\alpha\nabla\phi\right)+\beta\phi=f\label{eq:xl1.27}
\end{equation}

\end_inset

一般有边界条件
\begin_inset Formula 
\begin{align}
\phi & =p\quad\text{on}\quad\Gamma_{1}\label{eq:xl1.28}\\
\left(\alpha\nabla\phi\right)\cdot\sbf e_{n}+\gamma\phi & =q\quad\text{on}\quad\Gamma_{2}\label{eq:xl1.29}
\end{align}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.27"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.28"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.29"
plural "false"
caps "false"
noprefix "false"

\end_inset

所对应的方程等价于
\begin_inset Formula 
\begin{align}
 & \delta\mathcal{F}(\phi)=0\label{eq:xl1.30}\\
 & \phi=p\quad\text{on}\quad\Gamma_{1}\nonumber 
\end{align}

\end_inset

其中 
\begin_inset Formula $\mathcal{F}(\phi)$
\end_inset

 的构造见下文。
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.29"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的边界条件在
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.30"
plural "false"
caps "false"
noprefix "false"

\end_inset

中自动满足，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:xl1.28"
plural "false"
caps "false"
noprefix "false"

\end_inset

对应的边界条件可以通过适当的方式在有限元计算中添加。
\end_layout

\begin_layout Section
Ritz方法
\end_layout

\begin_layout Standard
在有限元框架下，
\begin_inset Formula $\mathcal{F}(\phi)$
\end_inset

 可以表示为
\begin_inset Formula 
\[
\mathcal{F}(\phi)=\sum_{e=1}^{M}\mathcal{F}^{e}\left(\phi^{e}\right)+\sum_{s=1}^{N}\mathcal{F}^{s}\left(\phi^{s}\right)
\]

\end_inset

其中
\begin_inset Formula $M$
\end_inset

是总的有限元单元数，
\begin_inset Formula $N$
\end_inset

 为表面边界单元的数目。而
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}\left(\phi^{e}\right) & =\frac{1}{2}\int_{\Omega^{e}}\left[(\nabla\phi^{e})\cdot\epsilon(\nabla\phi^{e})+\beta\phi^{e;2}\right]\dd{\Omega}-\int_{\Omega^{e}}f\phi^{e}\dd{\Omega}\\
\mathcal{F}^{s}\left(\phi^{s}\right) & =\int_{\Gamma^{e}}\left[\frac{\gamma}{2}\left(\phi^{s}\right)^{2}-q\phi^{s}\right]\dd{\Gamma}
\end{align*}

\end_inset

泛函变分方程
\begin_inset Formula $\delta\mathcal{F}(\phi)=0$
\end_inset

给出对应的电势场方程和边界条件
\begin_inset Formula 
\begin{align*}
-\nabla\cdot\left(\epsilon\nabla\phi\right)+\beta\phi & =f\\
\left(\epsilon\nabla\phi\right)\cdot\sbf e_{n}+\gamma\phi & =q\quad\text{on}\quad\Gamma_{2}
\end{align*}

\end_inset

其中考虑了分部积分给出的边界项 
\begin_inset Formula $\int_{\Gamma}\phi\sbf e_{n}\cdot(\epsilon\nabla\phi)\dd{\Gamma}$
\end_inset


\end_layout

\begin_layout Remark
对于形如 
\begin_inset Formula $\mathcal{F}(\phi)=\frac{1}{2}\int_{\Omega}\left[(\nabla\phi)\cdot(\nabla\phi)\right]\dd{V}$
\end_inset

的泛函，由于存在高斯定理
\begin_inset Formula 
\begin{align}
\mathcal{F}(\phi) & =\frac{1}{2}\int_{\Omega}\left[(\nabla\phi)\cdot(\nabla\phi)\right]\dd{V}\label{eq:ym1}\\
 & =\frac{1}{2}\oint_{\partial\Omega}(\phi\nabla\phi)\cdot\dd{\sbf S}-\frac{1}{2}\int_{\Omega}\phi\nabla^{2}\phi\dd{V}\label{eq:ym2}
\end{align}

\end_inset

考虑欧拉–拉格朗日方程：
\begin_inset Formula 
\[
\frac{\partial\mathcal{F}}{\partial\phi}=\partial_{\mu}\frac{\partial\mathcal{F}}{\partial(\partial_{\mu}\phi)},
\]

\end_inset

注意到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ym1"
plural "false"
caps "false"
noprefix "false"

\end_inset

是
\begin_inset Formula ${\color{blue}\nabla\phi}$
\end_inset

的二次型，代入E–L 方程求偏导时会有系数
\begin_inset Formula $2$
\end_inset

（刚好用来抵消
\begin_inset Formula $1/2$
\end_inset

）；相应地，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:ym2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $\phi\nabla^{2}\phi$
\end_inset

 应该看作 
\begin_inset Formula $\phi$
\end_inset

 的二次型，其中的
\begin_inset Formula $\nabla^{2}$
\end_inset

应该看作类似 二次型的系数矩阵，只不过这里是无穷维线性空间，所以变成了算符
\begin_inset Formula $\nabla^{2}$
\end_inset

。只有这样，在使用高斯定理前后，E–L方程左右才能平衡，并给出相同的结果。另一方面，在推导 E–L 方程一开始就假设泛函 
\begin_inset Formula $\mathcal{F}$
\end_inset

的依赖形式是
\begin_inset Formula $\mathcal{F}(\phi,\nabla\phi)$
\end_inset

，即泛函依赖不包括 
\begin_inset Formula $\nabla^{2}\phi$
\end_inset

。从这个角度，我们也只能把 
\begin_inset Formula $\nabla^{2}\phi$
\end_inset

 看作是
\begin_inset Formula $\nabla^{2}$
\end_inset

作用在
\begin_inset Formula $\phi$
\end_inset

上，而不是把
\begin_inset Formula $\nabla^{2}\phi$
\end_inset

当作独立依赖。
\end_layout

\begin_layout Section
Galerkin 方法
\end_layout

\begin_layout Standard
ref: FEM-Gerard;p45/61;sec 1.3.11
\end_layout

\begin_layout Standard
首先基础的公式是 ：
\begin_inset Formula 
\begin{align*}
\nabla\cdot\sbf D & =\rho\\
\sbf D & =\sbf D\left(\sbf E\right)\\
\sbf E & =-\nabla\phi
\end{align*}

\end_inset

在每个单元上，令加权的残差（residual error）和 为
\begin_inset Formula 
\begin{align}
R^{e}\left[N_{i}^{e}\right] & =\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}N_{i}^{e}\left({\color{blue}\nabla\cdot\sbf D}-\rho\right)\dd{\Omega}\label{eq:error}\\
\text{分部积分} & \Rightarrow{\color{blue}-\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}\nabla N_{i}^{e}\cdot\sbf D\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}\nabla\cdot\left(N_{i}^{e}\sbf D\right)\dd{\Omega}}-\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\nonumber \\
\text{散度定理} & \Rightarrow-\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}-\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}=0\nonumber 
\end{align}

\end_inset

上面使用了分部积分，和高斯散度定理；通过分部积分引入了边界条件项 
\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}$
\end_inset

。稍微整理下
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset

例如对于线性导体 
\begin_inset Formula $\sbf D=\epsilon\sbf E$
\end_inset

，上式可以写成：
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\left(-\epsilon\nabla\phi\right)}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset

对于齐次第二类（natural）边界条件 
\begin_inset Formula $\left(\alpha\nabla\phi\right)\cdot\sbf n=0$
\end_inset

（电位移 
\begin_inset Formula $\sbf D$
\end_inset

 平行于边界），可以直接去掉 
\begin_inset Formula $\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}$
\end_inset

 项。
\end_layout

\begin_layout Subsection
微扰展开
\end_layout

\begin_layout Enumerate
如果考虑待求物理量 
\begin_inset Formula $\sbf D$
\end_inset

 和 
\begin_inset Formula $\phi$
\end_inset

 的微小变分：
\begin_inset Formula 
\begin{align*}
\sbf D & =\sbf D^{0}+{\color{blue}\epsilon}\,\delta\sbf E=\sbf D^{0}-{\color{blue}\epsilon}\,\sbf\nabla\delta\phi\\
\phi & =\phi^{0}+\delta\phi
\end{align*}

\end_inset

其中 
\begin_inset Formula $\epsilon=\frac{\partial D}{\partial E}$
\end_inset

，对于一般材料 
\begin_inset Formula $\frac{\partial D}{\partial E}$
\end_inset

 有可能是张量。代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:error"
plural "false"
caps "false"
noprefix "false"

\end_inset

 得：
\begin_inset Formula 
\begin{align*}
\Rightarrow & -\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Omega}\\
 & +\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D^{0}}\dd{\Gamma}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Gamma}-\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}
\end{align*}

\end_inset

移项得
\begin_inset Formula 
\begin{align}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\,\sbf n\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\nonumber \\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\,\sbf n\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}\label{eq:Galerkin}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
再代入 
\begin_inset Formula $\phi$
\end_inset

 的插值展开，
\begin_inset Formula $\delta\phi=\sum_{e=1}^{N}N_{j}^{e}\delta\phi_{j}$
\end_inset

 得
\begin_inset Formula 
\begin{align*}
\bigg[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\nabla N_{j}^{e}}\dd{\Omega} & -\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\,\sbf n\cdot\epsilon\cdot\nabla N_{j}^{e}}\dd{\Gamma}\bigg]\delta\phi_{j}\\
 & =\lambda\left\{ \int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\,\sbf n\cdot\sbf D^{0}}\dd{\Gamma}\right\} 
\end{align*}

\end_inset

此即 Galerkin 方法的迭代展开式。左边正比于 
\begin_inset Formula $N_{i}^{e}N_{j}^{e}$
\end_inset

，右边正比于 
\begin_inset Formula $N_{i}^{e}$
\end_inset

，因此在 尺度（scale）变换下，
\begin_inset Formula 
\[
\left[\cdots\right]\delta\phi_{j}=\lambda\left\{ \cdots\right\} ,\quad\lambda<1.
\]

\end_inset

相当于 
\begin_inset Formula $\delta\phi_{j}$
\end_inset

 获得更小的步长。
\end_layout

\begin_layout Enumerate
对于第一类（essential）边界条件，在边界上 
\begin_inset Formula $\delta\phi_{j}=0$
\end_inset

；对于齐次第二类（natural）边界条件，
\begin_inset Formula $n\cdot\sbf D^{0}=0$
\end_inset

；回忆推导欧拉–拉格朗日方程时
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:EL-equ"
plural "false"
caps "false"
noprefix "false"

\end_inset

，边界项是 
\begin_inset Formula $\left.{\color{blue}\frac{\partial F}{\partial y'}\delta y}\right|_{x_{1}}^{x_{2}}$
\end_inset

 ，在这两种情况下边界项都分别为零。因此在两种情况下都可以不考虑边界项，此时方程简化为，
\begin_inset Formula 
\begin{equation}
\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\nabla N_{j}^{e}}\dd{\Omega}\right]\delta\phi_{j}=\lambda\left\{ \int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}\right\} .\label{eq:Galerkin-2}
\end{equation}

\end_inset

只有第三类边界条件，例如开放边界，或外加电场时需要考虑边界项。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Subsection
程序变量
\end_layout

\begin_layout Standard
下面列出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Galerkin-2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的部件，在程序中对应的变量。 
\begin_inset Formula $W(\xi_{i})$
\end_inset

 是高斯积分的权重因子，
\begin_inset Formula $\det[J]$
\end_inset

 是雅可比矩阵的行列式。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $K$
\end_inset

：Sparse::GetMatrix<double>(
\begin_inset Quotes eld
\end_inset

K
\begin_inset Quotes erd
\end_inset

)，刚度矩阵，Galerkin 方程左侧的稀疏矩阵。
\begin_inset Formula 
\[
K=\nabla N^{T}\cdot\epsilon\cdot\nabla N*W*\det[J]
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $F_{\text{in}}$
\end_inset

：Fin，“内力”，Galerkin 方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Galerkin-2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，
\begin_inset Formula $\sbf D^{0}$
\end_inset

 引发的贡献
\begin_inset Formula 
\[
F_{\text{in}}=\nabla N^{T}\cdot\sbf D^{0}\cdot\left(-\det[J]*W\right)/\epsilon_{0}
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $F_{v}$
\end_inset

：Fv，“力”矢量，其实是电荷（电荷密度，或者外加电场）的贡献
\begin_inset Formula 
\[
F_{v}=N*\rho*\det[J]*W
\]

\end_inset


\end_layout

\begin_layout Enumerate
P_GFv_T 是 Global Fv，即 Fv 在所有单元上累加的结果；Fv vector中，的元素的存储次序，与全局/局域编号有关。
\end_layout

\begin_layout Enumerate
P_GFinAccum 是 Global Fin，即 Fin 在所有单元上累加的结果。
\end_layout

\begin_layout Enumerate
P_GRt，
\begin_inset Formula $\mathrm{P\_GRt}=\mathrm{P\_GFv\_T}-\mathrm{P\_GFinAccum}$
\end_inset

，两部分“力”的求和。 
\end_layout

\begin_layout Enumerate
从单元的局域刚度矩阵, 组装全局矩阵的过程，见 金建铭note 4.3.3.2。
\end_layout

\begin_layout Section
第一类边界条件
\end_layout

\begin_layout Standard
ref: JMJin P104, Sec 4.3.3。Dirichlet 边界条件定义为：
\begin_inset Formula 
\begin{equation}
\phi=p\quad\text{on}\quad\Gamma_{1}.\label{eq:bound1}
\end{equation}

\end_inset


\begin_inset Formula $\Gamma_{1}$
\end_inset

 是边界上的一部分。假设 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 上有 
\begin_inset Formula $N_{1}$
\end_inset

 个节点，如果把它们的 全局节点编号 存储在一矢量中，例如 
\begin_inset Formula $\text{nd}(i)$
\end_inset

；把给定的边界值存储在矢量 
\begin_inset Formula $p(i)$
\end_inset

 中。若对线性方程组进行下述操作，即相当于施加了第一类边界条件：
\end_layout

\begin_layout Enumerate
首先修改 边界节点对应的方程：
\begin_inset Formula 
\begin{align}
 & b_{\text{nd}(i)}=p\left(i\right),\quad K_{\text{nd}\left(i\right),\text{nd}\left(i\right)}=1;\label{eq:jm4.60}\\
\text{and:\ensuremath{\quad}} & K_{\text{nd}\left(i\right),j}=0,\quad\text{for}\quad j\neq\text{nd}(i).
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
以及修改对应的力向量：
\begin_inset Formula 
\begin{align*}
 & b_{j}\to b_{j}-K_{j,\text{nd}(i)}p\left(i\right);\\
\text{and}\quad & K_{j,\text{nd}\left(i\right)}=0\quad\text{for}\quad j\neq\text{nd}(i).
\end{align*}

\end_inset

其中 
\begin_inset Formula $i=1,2,3,\cdots,N_{1}$
\end_inset

，
\begin_inset Formula $j\in\{\text{全部节点}\}$
\end_inset

。综合起来就是令第一类边界边界条件相关行的非对角元 
\begin_inset Formula $K_{\text{nd}\left(i\right),j}$
\end_inset

，
\begin_inset Formula $K_{j,\text{nd}\left(i\right)}$
\end_inset

为零，并修改力向量。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
对于 Galerkin 迭代法，在位于 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 的节点上，
\begin_inset Formula $\phi$
\end_inset

为定值，则 
\begin_inset Formula $\delta\phi=0$
\end_inset

。套用上述处理手段，只需要：
\end_layout

\begin_layout Enumerate
在 
\begin_inset Formula $K$
\end_inset

 矩阵中， 把涉及 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 节点 的行和列去除；
\end_layout

\begin_layout Enumerate
而 
\begin_inset Formula $b_{j}$
\end_inset

 不需要做改动，因为此时 
\begin_inset Formula $p\left(i\right)=0$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
第三类边界条件
\end_layout

\begin_layout Standard
Robbin 边界条件：
\begin_inset Formula 
\begin{align}
 & \left(\alpha\nabla\phi\right)\cdot\sbf n+\gamma\phi=q\nonumber \\
\text{即}\quad & \sbf D\cdot\sbf n=q-\gamma\phi\label{eq:bound3}
\end{align}

\end_inset


\end_layout

\begin_layout Itemize
这里的约定是，电位移矢量 
\begin_inset Formula $\sbf D=\alpha_{x}\frac{\partial\phi}{\partial x}\hat{x}+\alpha_{y}\frac{\partial\phi}{\partial y}\hat{y}+\alpha_{z}\frac{\partial\phi}{\partial z}\hat{z}$
\end_inset

；
\end_layout

\begin_layout Itemize
注意对于线性材料，通常定义 
\begin_inset Formula $\sbf E=-\nabla\phi$
\end_inset

，
\begin_inset Formula $\sbf D=\alpha\sbf E$
\end_inset

，也就是有一个负号，所以上面的 
\begin_inset Formula $\alpha$
\end_inset

 为负数。
\end_layout

\begin_layout Standard
对于上面定义的加权残差，现在不展开 
\begin_inset Formula $\sbf n\cdot\sbf D$
\end_inset

 项：
\begin_inset Formula 
\[
R^{e}\left[N_{i}^{e}\right]=\frac{-1}{\varepsilon_{0}}\left[\left(\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}+N_{i}^{e}\rho\right)\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}\right]
\]

\end_inset

残差 
\begin_inset Formula $R^{e}\left[N_{i}^{e}\right]$
\end_inset

 趋于零给出的方程是
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Omega}=\int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset

代入势场展开 
\begin_inset Formula $\delta\phi=N_{j}^{e}\delta\phi_{j}$
\end_inset

，以及 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:bound3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\nabla N_{j}^{e}}\dd{\Omega}\right]\delta\phi_{j}=\int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\left(q-\gamma\phi\right)}\dd{\Gamma}
\]

\end_inset


\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
其中
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color inherit

\begin_inset Formula ${\color{brown}\phi=\phi_{0}+N_{j}\delta\phi_{j}}$
\end_inset

，
\begin_inset Formula $\phi_{0}$
\end_inset

 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\xout off
\uuline off
\uwave off
\noun off
\color none
是目前的累积解
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\xout default
\uuline default
\uwave default
\noun default
\color inherit
，全按形函数展开就是：
\begin_inset Formula 
\begin{align*}
\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\nabla N_{j}^{e}}\dd{\Omega}\right]\delta\phi_{j} & +{\color{brown}\left[\int_{\Gamma^{e}}\gamma N_{i}^{e}N_{j}^{e}\dd{\Gamma}\right]}\delta\phi_{j}\\
 & =\int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}q}\dd{\Gamma}+{\color{brown}\int_{\Gamma^{e}}\left(-\gamma N_{i}^{e}N_{j}^{e}\right)\dd{\Gamma}}\phi_{0;j}
\end{align*}

\end_inset


\end_layout

\begin_layout Section
第二类边界条件
\end_layout

\begin_layout Standard
JMJin page 90: Neumann 边界条件，相当于在第三类边界条件中取 
\begin_inset Formula $\gamma=0$
\end_inset


\begin_inset Formula 
\begin{align}
 & \left(\alpha\nabla\phi\right)\cdot\sbf n=q\nonumber \\
\text{即}\quad & \sbf D\cdot\sbf n=q\label{eq:bound2}
\end{align}

\end_inset

此外还有齐次诺伊曼边界条件（homogeneous Neumann），相当于在第三类边界条件中取 
\begin_inset Formula $\gamma=q=0$
\end_inset


\begin_inset Formula 
\[
\left(\alpha\nabla\phi\right)\cdot\sbf n=0\quad\text{即}\quad\sbf D\cdot\sbf n=0
\]

\end_inset


\end_layout

\begin_layout Subsection
界面连续性条件
\end_layout

\begin_layout Standard
如果在两种介质的交界面上：
\end_layout

\begin_layout Itemize
材料性质参数例如 
\begin_inset Formula $\alpha_{x}$
\end_inset

，
\begin_inset Formula $\alpha_{y}$
\end_inset

，
\begin_inset Formula $\alpha_{z}$
\end_inset

 有突变（不连续）；
\end_layout

\begin_layout Itemize
并且假设在界面上没有任何表面源（surface source）。
\end_layout

\begin_layout Standard
则
\begin_inset Formula $\phi$
\end_inset

还应该满足连续性条件：
\begin_inset Formula 
\begin{equation}
\phi^{+}=\phi^{-},\quad\text{on}\quad\Gamma_{d}.\label{eq:jm4.4}
\end{equation}

\end_inset

以及
\begin_inset Formula 
\begin{equation}
\left(\alpha_{x}\frac{\partial\phi^{+}}{\partial x}\hat{x}+\alpha_{y}\frac{\partial\phi^{+}}{\partial y}\hat{y}+\alpha_{z}\frac{\partial\phi^{+}}{\partial z}\hat{z}\right)\cdot\hat{n}=\left(\alpha_{x}\frac{\partial\phi^{-}}{\partial x}\hat{x}+\alpha_{y}\frac{\partial\phi^{-}}{\partial y}\hat{y}+\alpha_{z}\frac{\partial\phi^{-}}{\partial z}\hat{z}\right)\cdot\hat{n}\quad\text{on}\quad\Gamma_{d}.\label{eq:jm4.5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
即电势连续，电位移矢量 
\begin_inset Formula $\sbf D$
\end_inset

连续。
\end_layout

\begin_layout Section
各种自由度记号
\end_layout

\begin_layout Enumerate
AXIS2：表示轴对称系统，取柱坐标系计算。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
NdNum()；节点数目。
\end_layout

\begin_layout Enumerate
DofNum()：自由度数目，取决于体系，例如每个单元中，自由度就是节点上的电势。
\end_layout

\begin_layout Enumerate
GSNum()，GsNumKe()，GsNumFe()，GsNumVe()：高斯点数目；对于阶数不同的多项式，需要的采样点数目不同，因此 Gauss
 点数目可能不同。
\end_layout

\begin_layout Standard
EOF
\end_layout

\begin_layout Chapter
静电场
\end_layout

\begin_layout Section
轴对称电场
\end_layout

\begin_layout Standard
柱坐标 
\begin_inset Formula $(r,\phi,z)$
\end_inset

 下的 
\begin_inset Formula $\nabla^{2}$
\end_inset

 算子：
\begin_inset Formula 
\[
\nabla^{2}\psi=\frac{1}{r}\partial_{r}\left(r\,\partial_{r}\psi\right)+\frac{1}{r^{2}}\partial_{\phi}^{2}\psi+\partial_{z}^{2}\psi
\]

\end_inset


\end_layout

\begin_layout Standard
轴对称情况下，电场方程 
\begin_inset Formula $-\epsilon\nabla^{2}\Phi=\rho$
\end_inset

 在柱坐标系下可以写成：
\begin_inset Formula 
\[
-\frac{1}{r}\partial_{r}\left(\epsilon_{r}\,r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}
\]

\end_inset

将方程化简成如下形式
\begin_inset Formula 
\begin{equation}
-\partial_{r}\left(\epsilon_{r}r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}r\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}r\label{eq:xl2.5-1}
\end{equation}

\end_inset

如果作替换
\begin_inset Formula 
\begin{align*}
 & r\to x,\quad z\to y,\\
 & \epsilon_{r}r\to\tilde{\epsilon}(x),\quad\rho r\to\tilde{\rho}(x)
\end{align*}

\end_inset

则原方程可以写作
\begin_inset Formula 
\begin{equation}
-\partial_{x}\left[\tilde{\epsilon}(x)\,\partial_{x}\Phi\right]-\partial_{y}\left[\tilde{\epsilon}(x)\,\partial_{y}\Phi\right]=\tilde{\rho}(x)\label{eq:xl2.5}
\end{equation}

\end_inset

此方程的求解和二维情况完全相同，即它对应的泛函和通常的二维情况相同。
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\Phi\right)=\frac{1}{2}\int_{\Omega^{e}}\left(\nabla N_{i}^{e}\cdot\epsilon_{r}\cdot\nabla N_{j}^{e}\right)\Phi_{i}\Phi_{j}\dd{\Omega}-\int_{\Omega^{e}}\frac{\rho}{\epsilon_{0}}N_{i}^{e}\Phi_{i}\dd{\Omega}.
\]

\end_inset

对上式的泛函变分时，自由度是电势
\begin_inset Formula $\Phi_{i}$
\end_inset

，因此与 
\begin_inset Formula ${\color{blue}\epsilon}$
\end_inset

 是否依赖于空间坐标无关。仍然给出泊松方程
\begin_inset Formula 
\[
\nabla\cdot\epsilon_{r}\cdot\nabla\Phi=-\frac{\rho}{\epsilon_{0}}.
\]

\end_inset

只不过由于对称性，泛函的积分可以直接把 
\begin_inset Formula $\phi$
\end_inset

 积掉，给出 
\begin_inset Formula $2\pi$
\end_inset

 因子。
\end_layout

\begin_layout Standard
类似地，对于 Galerkin 方程，推导步骤也是相同的。只不过把其中的 
\begin_inset Formula $\epsilon$
\end_inset

，
\begin_inset Formula $\rho$
\end_inset

 替换成相应的波浪线版本。
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\tilde{\rho}\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset


\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\left(-\tilde{\epsilon}\right)\cdot\nabla\phi}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Remark
在 Simdroid 中，UI界面的对称轴是 
\begin_inset Formula $y$
\end_inset

 轴，不同于上述推导中的
\begin_inset Formula $z$
\end_inset

轴。但 
\begin_inset Formula $z$
\end_inset

 or 
\begin_inset Formula $y$
\end_inset

 只是一个标志，实际是什么无所谓。对于方程
\begin_inset Formula 
\[
-\frac{1}{r}\partial_{r}\left(\epsilon_{r}\,r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}
\]

\end_inset

重要的是 
\begin_inset Formula $r,z$
\end_inset

 坐标的相对次序，即
\begin_inset Formula $r$
\end_inset

 是坐标
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $z$
\end_inset

 是坐标
\begin_inset Formula $2$
\end_inset

。在随后的符号重排
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，
\begin_inset Formula $\tilde{\epsilon}(r)=\epsilon_{r}\,r$
\end_inset

，
\begin_inset Formula $\tilde{\rho}(r)=\rho\,r$
\end_inset

，即
\begin_inset Formula $\tilde{\epsilon}$
\end_inset

，
\begin_inset Formula $\tilde{\rho}$
\end_inset

 是坐标
\begin_inset Formula $1$
\end_inset

 的函数。由于轴对称边值问题被转化为 
\begin_inset Formula $x,y$
\end_inset

 平面上的问题，只要在求解算法中保持坐标次序即可，即将 
\begin_inset Formula $x$
\end_inset

 乘到 
\begin_inset Formula $\epsilon,\rho$
\end_inset

 上。
\end_layout

\begin_layout Section
静电场的能量
\end_layout

\begin_layout Standard
目录:p18; Jackson p68/43; sec1.11
\end_layout

\begin_layout Standard
静电场能的两种表示方式：
\begin_inset Formula 
\begin{align}
 & W=\frac{1}{2}\int\rho(\sbf x)\Phi(\sbf x)\dd[3]{x},\quad W=\frac{1}{8\pi\epsilon_{0}}\sum_{i}\sum_{j}\frac{q_{i}q_{j}}{\abs{\sbf x_{i}-\sbf x_{j}}}\label{eq:j1.53}\\
 & W=\frac{\epsilon_{0}}{2}\int\abs{\sbf E}^{2}\dd[3]{x}.\label{eq:j1.54}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
第一行的公式分别是连续和离散情形。双求和忽略了 
\begin_inset Formula $i=j$
\end_inset

 的项，即“自能项”。
\end_layout

\begin_layout Enumerate
两种公式的物理图像分别为：电荷之间的相互作用能；电场中存储的能量。
\end_layout

\begin_layout Enumerate
电场的能量是正定的；相互作用能可能是负值。
\end_layout

\begin_layout Standard
考虑两个点电荷 
\begin_inset Formula $q_{1}$
\end_inset

，
\begin_inset Formula $q_{2}$
\end_inset

 组成的体系，空间一点
\begin_inset Formula $\sbf x$
\end_inset

处的电势和静电能分别为：
\begin_inset Formula 
\begin{align}
 & \sbf E=\frac{1}{4\pi\epsilon_{0}}\frac{q_{1}(\sbf x-\sbf x_{1})}{\abs{\sbf x-\sbf x_{1}}^{3}}+\frac{1}{4\pi\epsilon_{0}}\frac{q_{2}(\sbf x-\sbf x_{2})}{\abs{\sbf x-\sbf x_{2}}^{3}},\nonumber \\
 & 32\pi^{2}\epsilon_{0}w=\frac{q_{1}^{2}}{\abs{\sbf x-\sbf x_{1}}^{4}}+\frac{q_{2}^{2}}{\abs{\sbf x-\sbf x_{2}}^{4}}+2\frac{q_{1}q_{2}(\sbf x-\sbf x_{1})\cdot(\sbf x-\sbf x_{2})}{\abs{\sbf x-\sbf x_{1}}^{3}\abs{\sbf x-\sbf x_{2}}^{3}}.\label{eq:j1.56}
\end{align}

\end_inset

前两项是两个点电荷的自能，后一项是相互作用能。
\end_layout

\begin_layout Subsection
电容矩阵
\end_layout

\begin_layout Standard
FEM-Gerard; page 31/47; sec 1.3.8.8 
\end_layout

\begin_layout Standard
在含有 
\begin_inset Formula $n$
\end_inset

 个导体的系统中，第 
\begin_inset Formula $i$
\end_inset

 个导体上的电荷
\begin_inset Formula $Q_{i}$
\end_inset

 可以用所有导体上的电势
\begin_inset Formula $V_{j}$
\end_inset

，以及一些几何参数，共同表出：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
Q_{i}=\sum_{j=1}^{n}C_{ij}V_{j},\quad i=1,2,\cdots,n\label{eq:j1.61}
\end{equation}

\end_inset

系数 
\begin_inset Formula $C_{ii}$
\end_inset

 被称为电容（capacities or capacitances），非对角元
\begin_inset Formula $C_{ij}$
\end_inset

被称为互感系数。
\end_layout

\begin_layout Enumerate
导体的电容，等于它带单位电势时的电荷，同时保持其他导体电势为零。
\end_layout

\begin_layout Enumerate
电容矩阵 
\begin_inset Formula $C_{ij}$
\end_inset

 是对称矩阵，表示两个导体间的电荷相互作用是对等的。
\end_layout

\begin_layout Enumerate
非对角元 
\begin_inset Formula $C_{ij}$
\end_inset

 对应两个导体间的互作用能量。
\begin_inset Formula 
\[
C_{ij}V_{i}V_{j}=\int_{\Omega}\sbf E_{i}\cdot\sbf D_{j}\dd{\Omega},\quad i,j\,\text{不求和}
\]

\end_inset


\end_layout

\begin_layout Standard
导体系统的 静电能 可以表示为
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\sum_{i=1}^{n}Q_{i}V_{i}=\frac{1}{2}\sum_{i=1}^{n}\sum_{j=1}^{n}C_{ij}V_{i}V_{j}.\label{eq:j1.62}
\end{equation}

\end_inset


\begin_inset Formula $C_{ii}V_{i}^{2}$
\end_inset

是正定的，对应电荷的“自能”（self energy）；
\begin_inset Formula $C_{ij}V_{i}V_{j}$
\end_inset

对应相互作用能 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j1.53"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Section
电介质中的静电能
\end_layout

\begin_layout Standard
p190; sec 4.7 
\end_layout

\begin_layout Standard
见 Sec1.11，自由空间电荷系统的能量为：
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\int\rho(\sbf x)\Phi(\sbf x)\dd[3]{x}.\label{eq:j4.83}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
存在电介质的情况下，静电能的微小变分为：
\begin_inset Formula 
\begin{equation}
\delta W=\int\delta\rho(\sbf x)\Phi(\sbf x)\dd[3]{x}.\label{eq:j4.84}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\Phi(\sbf x)$
\end_inset

 是由于已存在电荷密度 
\begin_inset Formula $\rho(\sbf x)$
\end_inset

产生的电势。考虑到 
\begin_inset Formula $\nabla\cdot\sbf D=\rho$
\end_inset

，我们可以作替换
\begin_inset Formula 
\begin{equation}
\delta\rho=\nabla\cdot(\delta\sbf D).\label{eq:j4.85}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
\nabla\cdot(\Phi\delta\sbf D) & =(\nabla\phi)\cdot\delta\sbf D+\Phi\nabla\cdot\delta\sbf D\\
 & =-\sbf E\cdot\delta\sbf D+\Phi\delta\rho
\end{align*}

\end_inset

如果电荷分布在有限空间内，则 
\begin_inset Formula $\nabla\cdot(\Phi\delta\sbf D)$
\end_inset

 在全空间的积分为零（应用高斯散度定理）。因此可以把静电能的变分写成：
\begin_inset Formula 
\begin{equation}
\delta W=\int\sbf E\cdot\delta\sbf D\dd[3]{x}.\label{eq:j4.86}
\end{equation}

\end_inset

因此当
\begin_inset Formula $\sbf D$
\end_inset

从初始值
\begin_inset Formula $0$
\end_inset

变化到最终值时，在形式上可以把静电能写成：
\begin_inset Formula 
\begin{equation}
W=\int\dd[3]x\int_{0}^{D}\sbf E\cdot\delta\sbf D.\label{eq:j4.87}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
如果介质是 
\emph on
线性的
\emph default
，则
\begin_inset Formula 
\begin{equation}
\sbf E\cdot\delta\sbf D=\frac{1}{2}\delta\left(\sbf E\cdot\sbf D\right).\label{eq:4.88}
\end{equation}

\end_inset

总能量可以写成
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\int\sbf E\cdot\sbf D\dd[3]{x}.\label{eq:j4.89}
\end{equation}

\end_inset

如果假设 
\begin_inset Formula $\rho$
\end_inset

 和 
\begin_inset Formula $\Phi$
\end_inset

 是线性相关的，通过 
\begin_inset Formula $\sbf E=-\nabla\Phi$
\end_inset

 和 
\begin_inset Formula $\nabla\cdot\sbf D=\rho$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.89"
plural "false"
caps "false"
noprefix "false"

\end_inset

 可以回到
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.83"
plural "false"
caps "false"
noprefix "false"

\end_inset

或
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.84"
plural "false"
caps "false"
noprefix "false"

\end_inset

 。因此，
\emph on
只有当行为是线性的，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.83"
plural "false"
caps "false"
noprefix "false"

\end_inset

在宏观上才成立。
\emph default
否则，只能使用
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.87"
plural "false"
caps "false"
noprefix "false"

\end_inset

计算，最终的 静电能 依赖于极化历史。
\end_layout

\begin_layout Section
非线性材料的电容矩阵
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
g1 = Plot[x^(3/5), {x, 0, 5} , AxesLabel -> {"D", "E"} , ImageSize -> Small];
 g2 = Plot[Log[x + 1], {x, 0, 5} , AxesLabel -> {"Q", "U"} , ImageSize ->
 Small]; GraphicsRow[{g1, g2}]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/capacitance-curve.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Formula $E-D$
\end_inset

曲线与
\begin_inset Formula $U-Q$
\end_inset

曲线，静电能的等价表示形式为
\begin_inset Formula $\delta w=E\delta D$
\end_inset

，
\begin_inset Formula $\delta w=U\delta Q$
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
follow XuLei，两张图中，曲线上的点是一一对应的，根据对应关系有：
\begin_inset Formula 
\begin{align*}
\frac{1}{2}\delta\sbf E\cdot\delta\sbf D & =\frac{1}{2}\delta U\delta fQ\\
 & =\frac{1}{2}\delta U\;C\delta U
\end{align*}

\end_inset

假设由边值问题
\begin_inset Formula $\alpha$
\end_inset

，求解出了电场结果 
\begin_inset Formula $\beta$
\end_inset

。在确定的几何点
\begin_inset Formula $P$
\end_inset

，和电场 
\begin_inset Formula $\sbf E$
\end_inset

 下，
\begin_inset Formula $\epsilon=\partial D/\partial E$
\end_inset

，
\begin_inset Formula $C=\partial Q/\partial U$
\end_inset

 都是确定的。这时候作完全线性化，完全按照线性系统处理，取 
\begin_inset Formula $\delta U=\SI{1}{V}$
\end_inset

，给出
\begin_inset Formula 
\[
C=\delta\sbf E\cdot\delta\sbf D.
\]

\end_inset

这个式子的含义是：
\end_layout

\begin_layout Enumerate
体系此时的电容，可以由 
\begin_inset Formula $\delta U=\SI{1}{V}$
\end_inset

 条件定出的电场得到；
\end_layout

\begin_layout Enumerate
在使用 Galerkin 方程计算过程中，认定 
\begin_inset Formula $\epsilon=\partial D/\partial E$
\end_inset

 为常数，
\begin_inset Formula $\epsilon$
\end_inset

 的每一几何点的具体值，由之前边值问题的解 
\begin_inset Formula $\beta$
\end_inset

 提供；材料性质的影响体现在此处。
\end_layout

\begin_layout Enumerate
而 
\begin_inset Formula $\sbf D$
\end_inset

与 
\begin_inset Formula $\sbf E$
\end_inset

 的关系，由材料在当前 
\begin_inset Formula $\sbf E$
\end_inset

 下的电介质数 
\begin_inset Formula $\epsilon$
\end_inset

 决定。非线性材料的 电介质数 
\begin_inset Formula $\epsilon$
\end_inset

 与 
\begin_inset Formula $\sbf E$
\end_inset

 的关系可能比较复杂，但在当前一点可以当成常数。
\end_layout

\begin_layout Enumerate
并且对于多导体系统，还类似地定义电容矩阵：
\begin_inset Formula 
\[
C_{ij}=\frac{1}{\delta U_{i}\delta U_{j}}\int_{\Omega}\sbf D_{i}\cdot\sbf E_{j}\dd{\Omega},
\]

\end_inset

积分区域是全系统空间，实际上还取了 
\begin_inset Formula $\delta U_{i}=\delta U_{j}=\SI{1}{V}$
\end_inset

。
\end_layout

\begin_layout Remark
体系的电容 
\begin_inset Formula $C$
\end_inset

 与体系的几何构型，以及材料的电介质数 
\begin_inset Formula $\epsilon$
\end_inset

 相关。以上方法实际上就是：
\color blue
在点的局域上，把 非线性材料 权当成 线性材料 处理
\color inherit
。线性材料的互容矩阵实际上就是
\begin_inset Formula 
\[
C_{ij}=\frac{1}{U_{i}U_{j}}\int_{\Omega}\sbf D_{i}\cdot\sbf E_{j}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Section
虚功法
\end_layout

\begin_layout Standard
FEM-Gerard; sec 38/54;
\end_layout

\begin_layout Standard
刚体上的力和力矩（torque）也可以使用虚功原理（virtual work theorem）计算。在微小位移
\begin_inset Formula $\delta u$
\end_inset

下，装置的内能（internal energy）的变化 
\begin_inset Formula $\delta W_{e}$
\end_inset

，等于 外源（external sources）输入的电能，加上力 
\begin_inset Formula $-F_{u}$
\end_inset

（牛顿第三定律）的功：
\begin_inset Formula 
\begin{equation}
\delta W_{e}=\sum V_{k}\delta Q_{k}-F_{u}\delta u=\sum\frac{\partial W_{e}}{\partial Q_{k}}\delta Q_{k}+\frac{\partial W_{e}}{\partial u}\delta u.\label{eq:g1.117}
\end{equation}

\end_inset


\end_layout

\begin_layout Example
在实验一中，装置与外界电源隔离。电极上的电荷总量不变，即 
\begin_inset Formula $\delta Q_{k}=0$
\end_inset

，因此给出
\begin_inset Formula 
\begin{align}
 & F_{u}=-\frac{\partial W_{e}}{\partial u}.\label{eq:g1.118}\\
 & C_{\omega}=-\frac{\partial W_{e}}{\partial\theta}.\label{eq:g1.119}
\end{align}

\end_inset

其中 
\begin_inset Formula $C_{\omega}$
\end_inset

 表示绕旋转轴 
\begin_inset Formula $\omega$
\end_inset

 的力矩。求偏导时，保持 electric state variable（电极上的电荷）不变。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
在实验二中，把装置连接到 恒压源，电极上的电势 
\begin_inset Formula $V_{k}$
\end_inset

 保持不变，而电极上的电荷可能会变化 
\begin_inset Formula $\delta Q_{k}$
\end_inset

。现在，更适合用系统的共能（coenergy）去分析。
\begin_inset Formula 
\begin{align}
 & \sum V_{k}\delta Q_{k}-\sum\delta\left(V_{k}Q_{k}\right)-F_{u}\delta u=\delta W_{e}-\sum\delta\left(V_{k}Q_{k}\right).\label{eq:g1.120}\\
\Rightarrow & -\sum Q_{k}\delta V_{k}-F_{u}\delta u=-\delta W_{c}=-\sum\frac{\partial W_{c}}{\partial V_{k}}\delta V_{k}-\frac{\partial W_{c}}{\partial u}\delta u.\label{eq:g1.121}
\end{align}

\end_inset

现在，力和力矩可以用 共能 的偏导表示，
\begin_inset Formula 
\begin{align}
 & F_{u}=\frac{\partial W_{c}}{\partial u},\label{eq:g1.122}\\
 & C_{\omega}=\frac{\partial W_{c}}{\partial\theta}.\label{eq:g1.123}
\end{align}

\end_inset

求偏导时保持 electric state variable（电极上的电压）不变。
\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Plain Layout
page 20/36;
\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\begin{equation}
\frac{\partial W_{c}}{\partial v_{i}}=-\iint D\cdot\mathrm{grad}\varphi_{i}h\dd{x}\dd{y}-\iint\rho\varphi_{i}h\dd{x}\dd{y}=0\quad\text{for}\quad i=1,2,\cdots,N_{L}\label{eq:g1.52-1}
\end{equation}

\end_inset


\begin_inset Formula $v_{i}$
\end_inset

 表示节点上的值，一共有 
\begin_inset Formula $N_{L}$
\end_inset

个。
\end_layout

\begin_layout Plain Layout
page 14/30;
\begin_inset Formula 
\begin{equation}
W_{c}=\iint\left[\int_{0}^{-\nabla v}D\dd{E}-\rho v\right]h\dd{x}\dd{y}\label{eq:g1.35-1}
\end{equation}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Example
当电极上的电势保持常数时，coenergy 的有限元近似只是位移 
\begin_inset Formula $u$
\end_inset

 的函数，或者通过 
\color blue
节点的坐标直接依赖
\color inherit
，或者通过 
\color brown
节点电势间接依赖
\color inherit
：
\begin_inset Formula 
\begin{equation}
W_{c}=W_{c}\left[{\color{brown}v_{1}(u),v_{2}(u),\cdots,v_{N_{L}}(u)},{\color{blue}u}\right]=W_{c}(u).\label{eq:g1.126}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
F_{u}=\frac{\dd{W_{c}}}{\dd{u}}=\sum_{j=1}^{N_{L}}\frac{\partial W_{c}}{\partial v_{j}}\frac{\dd{v_{j}}}{\dd{u}}+\frac{\partial W_{c}}{\partial u}.\label{eq:g1.127}
\end{equation}

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g1.52-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，共能对 节点电势的偏导为零，因此
\begin_inset Formula 
\begin{equation}
F_{u}=\frac{\partial W_{c}}{\partial u}.\label{eq:g1.128}
\end{equation}

\end_inset

求偏导时保持 节点电势不变。
\end_layout

\begin_layout Example
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/Gerard-1.11.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Virtual deformation of the meshing。浅灰色的是弹性单元。白色的是刚体单元。空心节点表示能够运动。
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Chapter
静电场的开域问题
\end_layout

\begin_layout Standard
有限元方法只能处理有限大的空间，因此对于电场的开域问题，需要在边界上施加适当的边界条件来模拟边界的性质。首先根据麦克斯韦方程组，可以得到开域情况下电势满足的积分
方程：
\begin_inset Formula 
\[
\Phi\left(\sbf r\right)=\frac{1}{4\pi\varepsilon_{0}}\int\dd[3]{r'}\frac{1}{\abs{r-r'}}\left[\rho\left(\sbf r'\right)-\nabla'\cdot\sbf P\left(\sbf r'\right)\right]
\]

\end_inset

由于源都是局域的，因此在远离源的位置可以做如下展开：
\begin_inset Formula 
\[
\frac{1}{\abs{\sbf r-\sbf r'}}=\frac{1}{\abs{\sbf r}}+\frac{\sbf r\cdot\sbf r'}{\abs{\sbf r}^{3}}+\cdots
\]

\end_inset


\end_layout

\begin_layout Standard
取决于源的分布情况，电势在远离源的位置可能是以 
\begin_inset Formula $r^{-1}$
\end_inset

，或 
\begin_inset Formula $r^{-2}$
\end_inset

的形式衰减到零。在忽略高阶项的情况下，可以在远离源的位置将电势近似为
\begin_inset Formula 
\begin{equation}
\Phi=\frac{a}{r^{n}},\label{eq:xl2.6}
\end{equation}

\end_inset

其中 
\begin_inset Formula $a$
\end_inset

 是与 
\begin_inset Formula $r$
\end_inset

 无关的量；
\begin_inset Formula $n$
\end_inset

 可以由电荷的分布情况决定，对于同种电荷 
\begin_inset Formula $n$
\end_inset

 一般取
\begin_inset Formula $1$
\end_inset

，对于电偶极子
\begin_inset Formula $n$
\end_inset

一般取
\begin_inset Formula $2$
\end_inset

。在有限元模型边界上可以采用截断法来模拟开域边界，即取 
\begin_inset Formula $\Phi=0$
\end_inset

，或 
\begin_inset Formula $\nabla\Phi=0$
\end_inset

。两种处理方式分别对应 第一、二类边界条件，理论上的计算精度分别为 
\begin_inset Formula $\order{r^{-n}}$
\end_inset

 和 
\begin_inset Formula $\order{r^{-n-1}}$
\end_inset

。另外使用 
\begin_inset Formula $\nabla\frac{1}{r}=\frac{1}{r^{2}}\sbf e_{r}=\frac{1}{r^{2}}\frac{\sbf r}{r}$
\end_inset

，从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到： 
\begin_inset Formula 
\begin{equation}
\nabla\Phi=-na\frac{1}{r^{n+1}}\frac{\sbf r}{r}=-n\frac{\Phi}{r}\frac{\sbf r}{r}.\label{eq:xl2.7}
\end{equation}

\end_inset

如果在边界上采用 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 处理模型边界上的电势，那么理论上的计算精度可以达到 
\begin_inset Formula $\order{r^{-n-2}}$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示的条件即为 渐近边界条件（Asymptotic boundary condition），对应有限元计算中的第三类边界条件。
\end_layout

\begin_layout Section
表面项
\end_layout

\begin_layout Standard
在泛函积分式(2.2)
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\Phi\right)=\frac{1}{2}\int_{\Omega}\nabla\Phi\cdot\epsilon_{r}\nabla\Phi\dd{\Omega}-\int\frac{\rho}{\epsilon_{0}}\Phi\dd{\Omega}.\label{eq:xl2.2}
\end{equation}

\end_inset

中添加一个表面项得到新的泛函积分
\begin_inset Formula 
\[
\mathcal{F}\left(\Phi\right)=\frac{1}{2}\int_{\Omega}\nabla\Phi\cdot\epsilon_{r}\nabla\Phi\dd{\Omega}-\int\frac{\rho}{\epsilon_{0}}\Phi\dd{\Omega}+{\color{blue}\int_{\Gamma}\epsilon_{r}\frac{n}{r}\frac{\Phi\epsilon_{r}\Phi}{2}}\dd{\Gamma}.
\]

\end_inset

对上式做变分可以得到（使用分部积分）
\begin_inset Formula 
\[
\delta\mathcal{F}\left(\Phi\right)=-\int_{\Omega}\left(\nabla\cdot\epsilon_{r}\nabla\Phi+\frac{\rho}{\epsilon_{0}}\right)\delta\Phi\dd{\Omega}+\int_{\Gamma}\left({\color{blue}\sbf e_{n}\cdot\epsilon_{r}\nabla\Phi+\frac{n}{r}\epsilon_{r}\Phi}\right)\delta\Phi\dd{\Gamma}.
\]

\end_inset

从方程中的第二项可得
\begin_inset Formula 
\[
\sbf e_{n}\cdot\nabla\Phi=-n\frac{\Phi}{r}
\]

\end_inset

它等价于
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\Phi=-n\frac{\Phi}{r}\frac{\sbf r}{r}$
\end_inset

。对比第三类边界条件的标准形式：
\begin_inset Formula 
\[
\left(\alpha\nabla\Phi\right)\cdot\sbf n=q-\gamma\Phi
\]

\end_inset

相当于取 
\begin_inset Formula $\alpha=1$
\end_inset

，
\begin_inset Formula $q=0$
\end_inset

，
\begin_inset Formula $-\gamma=-\frac{n}{r}$
\end_inset

。
\end_layout

\begin_layout Example
综上，开域边界条件相当于
\begin_inset Formula 
\[
-\nabla\Phi=\frac{n}{r}\Phi\,\sbf e_{r}
\]

\end_inset

取上式的变分得（变分和微分交换次序）
\begin_inset Formula 
\[
-\nabla\delta\Phi=\frac{n}{r}\delta\Phi\,\sbf e_{r}
\]

\end_inset


\end_layout

\begin_layout Example
对于Galerkin 方法，保持残差函数不变
\begin_inset Formula 
\[
R^{e}\left[N_{i}^{e}\right]=\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}N_{i}^{e}\left({\color{blue}\nabla\cdot\sbf D}-\rho\right)\dd{\Omega}
\]

\end_inset

推导中的分部积分会自然地引入边界条件的贡献。考察 Galerkin 方程中地边界项
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}
\end{align*}

\end_inset

其中（在开放边界足够大，渐近于球形的近似下）
\begin_inset Formula 
\[
{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot(-\sbf\nabla\delta\phi)}\Rightarrow N_{i}^{e}\sbf e_{r}\cdot\frac{\partial D}{\partial E}\cdot\sbf e_{r}\;\frac{n}{r}\delta\Phi
\]

\end_inset

同理，若代入微扰展开 
\begin_inset Formula $\delta\phi=\sum_{e=1}^{N}N_{j}^{e}\delta\phi_{j}$
\end_inset

，相当于在刚度矩阵中添加一项
\begin_inset Formula 
\begin{equation}
N_{i}^{e}\;\sbf e_{r}\cdot\frac{\partial D}{\partial E}\cdot\sbf e_{r}\frac{n}{r}\;N_{j}^{e}\label{eq:el-open}
\end{equation}

\end_inset

或者写成
\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Plain Layout
\begin_inset Formula 
\[
\sbf r\cdot\frac{\partial D}{\partial E}\cdot\sbf r\;\frac{n}{r^{3}}\;N_{i}^{e}N_{j}^{e}
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{i}^{e}N_{j}^{e}$
\end_inset

 可以理解为 
\begin_inset Formula $N_{i1}^{e}N_{1j}^{e}=\left(N^{e}\cdot N^{e,T}\right)_{ij}$
\end_inset

，
\begin_inset Formula $N_{i1}^{e}$
\end_inset

为列矩阵。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r=\sqrt{x^{2}+y^{2}+z^{2}}$
\end_inset

，表示原点
\begin_inset Formula $O$
\end_inset

 到场点 
\begin_inset Formula $P$
\end_inset

 的距离。
\end_layout

\begin_layout Enumerate
为了保证计算精度，程序中要求开域边界条件的几何边界尽量为球形或圆形。
\end_layout

\begin_layout Section
边界形状和误差
\end_layout

\begin_layout Standard
对于球形边界，垂直边界的矢量 
\begin_inset Formula $\sbf e_{n}=\frac{\sbf r}{r}$
\end_inset

，所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示的渐近边界条件可以通过在泛函积分中添加相应的表面项来处理。对于非球形边界，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

近似成立。这一项会在原来的 
\begin_inset Formula $\left[K_{ij}^{e}\right]$
\end_inset

 矩阵中增加表面项的贡献
\begin_inset Formula 
\begin{equation}
K_{ij}^{s}=\int_{\Gamma^{e}}\epsilon_{r}\frac{n}{r}N_{i}^{e}N_{j}^{e}\dd{\Gamma}.\label{eq:xl2.8}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
由于 
\begin_inset Formula $r$
\end_inset

 在球形边界是定值，可以直接提取到积分外面；即使对于非圆形边界，
\begin_inset Formula $1/r$
\end_inset

 在边界处表面单元中变换不大，所以依然可以提到积分号外面。下面分二维，轴对称和三位情况分别计算 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
三维有限元的边界为一平面，采用高斯积分法计算的表达式为
\begin_inset Formula 
\[
K_{ij}^{s}=\epsilon_{r}\frac{n}{r}\Delta^{s}\sum_{\alpha}N_{i}^{s}\left(\xi_{\alpha},\eta_{\alpha}\right)\,N_{j}^{s}\left(\xi_{\alpha},\eta_{\alpha}\right)\,W\left(\xi_{\alpha},\eta_{\alpha}\right)
\]

\end_inset

其中 
\begin_inset Formula $\Delta^{s}$
\end_inset

 为边界单元的面积。
\end_layout

\begin_layout Remark
ref：郭硕鸿 p63/77。电多级展开：
\begin_inset Formula 
\[
f\left(\sbf x-\sbf x'\right)=f\left(\sbf x\right)-\sbf x'\cdot\nabla f@\sbf x+\frac{1}{2!}\left(\sbf x'\cdot\nabla\right)^{2}f@\sbf x+\cdots
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\varphi\left(x\right)=\frac{1}{4\pi\varepsilon_{0}}\left(\frac{Q}{R}-\sbf p\cdot\nabla\frac{1}{R}+\frac{1}{6}\sum_{i,j}\mathcal{D}_{ij}\partial_{i}\partial_{j}\frac{1}{R}+\cdots\right)\label{eq:g6.7}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
Q & =\int_{V}\rho\left(\sbf x'\right)\dd{V'}\\
\sbf p & =\int_{V}\rho\left(\sbf x'\right)\dd{V'}\\
\mathcal{D}_{ij} & =\int_{V}3x'_{i}x'_{j}\,\rho\left(\sbf x'\right)\dd{V'}
\end{align*}

\end_inset

其中
\begin_inset Formula $R=\sqrt{x^{2}+y^{2}+z^{2}}$
\end_inset

，表示原点到场点 
\begin_inset Formula $P$
\end_inset

 的距离。
\end_layout

\begin_layout Section
外加电场
\end_layout

\begin_layout Subsection
解析解的例子
\end_layout

\begin_layout Standard
ref: 郭硕鸿 p51/65；均匀介质球的极化，球外为真空，半径为 
\begin_inset Formula $R_{0}$
\end_inset

，均匀外电场为 
\begin_inset Formula $\sbf E_{0}$
\end_inset

。
\begin_inset CommandInset label
LatexCommand label
name "ref:g51"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/GuoShuoHong-2.5.png
	lyxscale 50
	scale 40

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\sbf E_{0}$
\end_inset

 的方向为球坐标系 
\begin_inset Formula $z$
\end_inset

 轴，并过球心
\begin_inset Formula 
\begin{align}
\text{球外解：} & \varphi_{1}=-E_{0}R\cos\theta+\frac{\epsilon-\epsilon_{0}}{\epsilon+2\epsilon_{0}}\frac{E_{0}R_{0}^{3}\cos\theta}{R^{2}}\nonumber \\
\text{球内解：} & \varphi_{2}=-\frac{3\epsilon_{0}}{\epsilon+2\epsilon_{0}}E_{0}R\cos\theta.\label{eq:g3.21}
\end{align}

\end_inset

球内是均匀电场，球内束缚电荷激发的场与原外场反向，使总电场减弱。在球内总电场作用下，介质的极化强度为
\begin_inset Formula 
\begin{equation}
\sbf P=\chi_{e}\epsilon_{0}\sbf E=\left(\epsilon-\epsilon_{0}\right)\sbf E=\frac{\epsilon-\epsilon_{0}}{\epsilon+2\epsilon_{0}}3\epsilon_{0}\sbf E_{0}\label{eq:g3.22}
\end{equation}

\end_inset

 介质球的总电偶极矩为
\begin_inset Formula 
\begin{equation}
\sbf p=\frac{4\pi}{3}R_{0}^{3}\sbf P=\frac{\epsilon-\epsilon_{0}}{\epsilon+2\epsilon_{0}}4\pi\epsilon_{0}R_{0}^{3}\sbf E_{0}\label{eq:g3.23}
\end{equation}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.21"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的第二项正是此电偶极矩所产生的电势
\begin_inset Formula 
\begin{equation}
\frac{1}{4\pi\epsilon_{0}}\frac{\sbf p\cdot\sbf R}{R^{3}}=\frac{\epsilon-\epsilon_{0}}{\epsilon+2\epsilon_{0}}\frac{E_{0}R_{0}^{3}\cos\theta}{R^{2}}\label{eq:g3.24}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
有限元中的处理
\end_layout

\begin_layout Standard
在程序实现中，规定 
\color blue
外加电场
\color inherit
 总是配合 
\color blue
开域边界
\color inherit
 一同使用，且边界应当是球形，介质是线性的。令外加电场为 
\begin_inset Formula $\sbf E_{0}$
\end_inset

，除去它的影响之后，令 有限区域电荷产生的电势为 
\begin_inset Formula $\Phi$
\end_inset

，令总电势为 
\begin_inset Formula $\Phi_{t}=\Phi-\sbf E_{0}\cdot\sbf r$
\end_inset

， 
\begin_inset Formula $\Phi$
\end_inset

 应该满足 开域边界条件 的性质，即
\begin_inset Formula 
\begin{equation}
{\color{brown}-\nabla\Phi=\frac{n}{r}\Phi\,\sbf e_{r}}\label{eq:phi-local}
\end{equation}

\end_inset

代入 
\begin_inset Formula $\Phi={\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}$
\end_inset

， 
\begin_inset Formula 
\[
-\nabla\left({\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}\right)=\frac{n}{r}\left({\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}\right)\sbf e_{r}
\]

\end_inset

略微化简给出
\begin_inset Formula 
\begin{equation}
{\color{brown}-\nabla\Phi_{t}=\frac{n}{r}\Phi_{t}\sbf e_{r}}+\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{r}\right)\sbf e_{r}\label{eq:phi-global}
\end{equation}

\end_inset

可以看到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi-global"
plural "false"
caps "false"
noprefix "false"

\end_inset

 与 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi-local"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的区别是多了后面两项。代入Galerkin 方程 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Galerkin"
plural "false"
caps "false"
noprefix "false"

\end_inset

边界项 
\begin_inset Formula $N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot(\sbf\nabla\delta\phi)$
\end_inset

：并把 
\begin_inset Formula ${\color{brown}-\nabla\Phi_{t}=\frac{n}{r}\Phi_{t}\sbf e_{r}}$
\end_inset

 的贡献归入刚度矩阵 
\begin_inset Formula $K_{ij}^{e}$
\end_inset

；把 
\begin_inset Formula $\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{r}\right)\sbf e_{r}$
\end_inset

 的贡献归入 载荷（Load），载荷项的形式为
\begin_inset Formula 
\[
-N_{i}\,\sbf e_{n}\cdot\epsilon\cdot\left[\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{R}\right)\sbf e_{R}\right].
\]

\end_inset


\end_layout

\begin_layout Subsection
backup
\end_layout

\begin_layout Standard
在有限元框架下求解外加电场的问题，外加电场 
\begin_inset Formula $\sbf E_{0}$
\end_inset

 的影响体现在 两个边界项中。观察 Galerkin 方程
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}
\end{align*}

\end_inset


\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}$
\end_inset

这一项体现的是背景场（即
\begin_inset Formula $\sbf E_{0}$
\end_inset

 ）的贡献；而 
\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}$
\end_inset

 则类似于开域边界条件。
\end_layout

\begin_layout Standard
参考 
\begin_inset CommandInset ref
LatexCommand eqref
reference "ref:g51"
plural "false"
caps "false"
noprefix "false"

\end_inset

，在外加电场影响下，极化电荷在边界处的电势形如
\begin_inset Formula 
\[
\Phi=a\frac{\cos\theta}{R^{n}},
\]

\end_inset

对于电偶极子 
\begin_inset Formula $n=2$
\end_inset

，其中 
\begin_inset Formula $\cos\theta=\sbf E_{0}\cdot\sbf e_{R}$
\end_inset

。考察边界上的电势法向量，
\begin_inset Formula 
\[
-\nabla\Phi=a\frac{\cos\theta}{R^{n}}\frac{n}{R}\sbf e_{R}+a\frac{\sin\theta}{R^{n}}\frac{1}{R}\sbf e_{\theta}
\]

\end_inset

对应的变分是
\begin_inset Formula 
\[
-\sbf\nabla\delta\phi=\frac{n}{R}\sbf e_{R}\delta\Phi+(\cdots)\sbf e_{\theta}
\]

\end_inset

Galerkin 方程边界项的贡献是
\begin_inset Formula 
\[
-N_{i}^{e}\sbf e_{n}\cdot\epsilon\cdot{\color{brown}\sbf\nabla\delta\phi}=N_{i}^{e}\sbf e_{n}\cdot\epsilon\cdot{\color{brown}\sbf e_{R}\,\frac{n}{R}\delta\Phi}
\]

\end_inset


\end_layout

\begin_layout Remark
其中使用了球坐标下的梯度表达式
\begin_inset Formula 
\[
\nabla\psi=\sbf e_{r}\partial_{r}\psi+\frac{1}{r}\sbf e_{\theta}\partial_{\theta}\psi+\frac{1}{r\sin\theta}\partial_{\phi}\sbf e_{\phi}.
\]

\end_inset


\end_layout

\begin_layout Chapter
电流场分析
\end_layout

\begin_layout Section
稳态电流场
\end_layout

\begin_layout Standard
导体中的电流密度矢量会因为导体的几何构型出现不均匀的分布，通过建立电流场相关的方程，用有限元进行求解，可以得到导体目标区域的电流密度矢量分布情况，计算欧姆损耗等
。在稳态情况下，电流密度矢量可以通过欧姆定理表示为
\begin_inset Formula 
\[
\sbf J=\sigma\sbf E
\]

\end_inset

而电场又可以表示为势能的梯度，即
\begin_inset Formula 
\[
\sbf E=-\nabla\phi
\]

\end_inset

根据连续性方程
\begin_inset Formula $\nabla\cdot\sbf J=0$
\end_inset

，最终可以得到稳态电流场中，标量势所满足的方程
\begin_inset Formula 
\[
\nabla\cdot\sigma\nabla\phi=0.
\]

\end_inset

其表达式与静电场的方程类似，只是方程系数由介电常数换成电导率。另外电流密度矢量在沿着导体流动的截面上还需要满足约束方程
\begin_inset Formula 
\[
\int_{S}\sbf J\cdot\dd{\sbf S}=-\int_{S}\sigma\nabla\phi\cdot\dd{\sbf S}=I
\]

\end_inset


\end_layout

\begin_layout Standard
综合上述方程，就可以计算稳态电流场中的势能分布，进而计算出空间中的电流密度矢量等物理量。
\end_layout

\begin_layout Section
时谐和瞬态电流场
\end_layout

\begin_layout Standard
在稳态电流场的问题中，标量势
\begin_inset Formula $\phi$
\end_inset

的分布不随时间变化，但在瞬态问题或交流问题中，因为电流场随时间变化，需要考虑位移电流
\begin_inset Formula $\sbf D$
\end_inset

的影响。这种情况下，电流密度矢量可以表示为
\begin_inset Formula 
\[
\sbf J=-\epsilon\frac{\partial\sbf E}{\partial t}-\sigma\sbf E.
\]

\end_inset

同样利用电场
\begin_inset Formula $\sbf E$
\end_inset

的势能表达式和连续性方程，可以得到
\begin_inset Formula 
\[
\nabla\cdot\epsilon\frac{\partial\nabla\phi}{\partial t}+\nabla\cdot\sigma\nabla\phi=0.
\]

\end_inset

在时谐情况下，将势能表示为复数的形式 
\begin_inset Formula $\phi(t)=\phi\exp(i\omega t)$
\end_inset

 ，可以得到准静态方程
\begin_inset Formula 
\[
i\omega\nabla\cdot\epsilon\nabla\phi+\nabla\cdot\sigma\nabla\phi=0.
\]

\end_inset


\end_layout

\begin_layout Section
电流场方程的有限元求解
\end_layout

\begin_layout Standard
在为模型划分好有限元网格之后，标量势可以用节点电势和单元形函数表示为
\begin_inset Formula 
\[
\phi(x,y,z)=N_{i}^{e}(x,y,z)\phi_{i}
\]

\end_inset

利用 Galerkin 方法或者构建泛函积分的方法，可以得到
\begin_inset Formula 
\[
\left(\int_{\Omega}\nabla N_{i}^{e}\cdot\epsilon\nabla N_{j}^{e}\dd{\Omega}\right)\frac{\partial\phi_{j}}{\partial t}+\left(\int_{\Omega}\nabla N_{i}^{e}\cdot\sigma\nabla N_{j}^{e}\dd{\Omega}\right)\phi_{j}=0
\]

\end_inset

定义系数矩阵
\begin_inset Formula 
\begin{align*}
 & A_{ij}^{e}=\int_{\Omega}\nabla N_{i}^{e}\cdot\epsilon\nabla N_{j}^{e}\dd{\Omega},\\
 & B_{ij}^{e}=\int_{\Omega}\nabla N_{i}^{e}\cdot\sigma\nabla N_{j}^{e}\dd{\Omega}.
\end{align*}

\end_inset

得到相应的矩阵方程
\begin_inset Formula 
\[
A_{ij}^{e}\frac{\partial\phi_{j}}{\partial t}+B_{ij}^{e}\phi_{j}=0.
\]

\end_inset


\end_layout

\begin_layout Enumerate
对于稳态问题，方程中的第一项不存在；
\end_layout

\begin_layout Enumerate
对于时谐问题，利用 
\begin_inset Formula $\partial_{t}\phi=i\omega\phi$
\end_inset

，可以将上述方程转化为准静态问题进行求解；
\end_layout

\begin_layout Enumerate
对于瞬态问题，可以用隐式欧拉方法，将
\begin_inset Formula $\partial_{t}\phi$
\end_inset

进行离散处理
\begin_inset Formula 
\[
\frac{\partial\phi}{\partial t}=\frac{\phi_{j}^{t+\Delta t}-\phi_{j}^{t}}{\Delta t}.
\]

\end_inset

然后基于时间离散后的矩阵方程，对时间迭代，得到各个时刻网格节点上的势能
\begin_inset Formula $\phi$
\end_inset

，进而得到电流密度矢量的分布。
\begin_inset Formula 
\[
\left(\frac{A_{ij}^{e}}{\Delta t}+B_{ij}^{e}\right)\phi_{j}^{t+\Delta t}=A_{ij}^{e}\frac{\phi_{j}}{\Delta t}
\]

\end_inset


\end_layout

\begin_layout Standard
在获得各个节点的电势后，通过形函数插值，进而得到空间各处的电流密度矢量和电场的分布。另外空间各处的欧姆损耗功率密度也可以通过电流密度矢量和电场进行计算，其表达式
为
\begin_inset Formula 
\[
P=\sbf J\cdot\sbf E
\]

\end_inset

导体总的欧姆损耗可以通过对空间各处的欧姆损耗功率密度
\begin_inset Formula $P$
\end_inset

进行积分得到。
\end_layout

\begin_layout Chapter
静磁场
\end_layout

\begin_layout Section
磁场的基本理论
\end_layout

\begin_layout Standard
根据 
\begin_inset Formula $\sbf B$
\end_inset

 和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系 
\begin_inset Formula $\sbf B(\sbf H)$
\end_inset

，可以分线性材料，永磁体 和 非线性材料 三种来计算静磁场。
\end_layout

\begin_layout Standard
下面先以最简单的线性材料为例，用有限元方法来计算静磁场，之后再讨论永磁铁和更复杂的非线性情况。首先磁场强度矢量 
\begin_inset Formula $\sbf H$
\end_inset

 满足方程
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\sbf J\label{eq:xl3.1}
\end{equation}

\end_inset

在线性介质中，磁感应强度 
\begin_inset Formula $\sbf B$
\end_inset

 和 磁场强度 
\begin_inset Formula $\sbf H$
\end_inset

 之间的关系为：
\begin_inset Formula 
\[
\sbf H=\frac{1}{\mu_{0}\mu_{r}}\sbf B
\]

\end_inset

相对磁导率 
\begin_inset Formula $\mu_{r}$
\end_inset

 是不随磁场变化的常数（但可以随空间坐标变化）。由于 
\begin_inset Formula $\nabla\cdot\sbf B=0$
\end_inset

，因此磁感应强度可以用矢势 
\begin_inset Formula $\sbf A$
\end_inset

 表示为
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A
\]

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以得到 
\begin_inset Formula $\sbf A$
\end_inset

 满足的方程
\begin_inset Formula 
\begin{equation}
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J\label{eq:xl3.2}
\end{equation}

\end_inset


\end_layout

\begin_layout Theorem
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
毕奥–萨伐尔定律
\end_layout

\end_inset

ref:郭硕鸿 p77/91，若取 
\begin_inset Formula $\sbf A$
\end_inset

满足规范条件 
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

，得矢势
\begin_inset Formula $\sbf A$
\end_inset

的微分方程：
\begin_inset Formula 
\begin{equation}
\nabla^{2}\sbf A=-\mu\sbf J\label{eq:g3.1.8}
\end{equation}

\end_inset

矢势方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的特解： 
\begin_inset Formula 
\begin{equation}
\sbf A(\sbf x)=\frac{\mu}{4\pi}\int_{V}\frac{\sbf J(\sbf x')\dd{V'}}{r}\label{eq:g3.1.9}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\sbf x'$
\end_inset

 是源点，
\begin_inset Formula $\sbf x$
\end_inset

 是长点，
\begin_inset Formula $r$
\end_inset

 为由 
\begin_inset Formula $\sbf x'$
\end_inset

 到 
\begin_inset Formula $\sbf x$
\end_inset

的距离。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

 满足 
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

。取旋度可求出
\begin_inset Formula $\sbf B$
\end_inset

：
\begin_inset Formula 
\begin{align*}
\sbf B & =\nabla\times\sbf A=\frac{\mu}{4\pi}\nabla\times\int_{V}\frac{\sbf J(\sbf x')\dd{V}}{r}\\
 & =\frac{\mu}{4\pi}\int_{V}(\nabla\frac{1}{r})\times\sbf J(\sbf x')\dd{V'}\\
 & =\frac{\mu}{4\pi}\int_{V}\frac{\sbf J\times\sbf r}{r^{3}}\dd{V'}
\end{align*}

\end_inset

过渡到线电流情形，设
\begin_inset Formula $I$
\end_inset

 为导线上电流的大小，作代换 
\begin_inset Formula $\sbf J\dd{V'}\to I\dd{\sbf l}$
\end_inset

得
\begin_inset Formula 
\begin{equation}
\sbf B=\frac{\mu}{4\pi}\oint_{L}\frac{I\dd{\sbf l}\times\sbf r}{r^{3}}\label{eq:g3.1.11}
\end{equation}

\end_inset

这就是 毕奥–萨伐尔 定律。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
柱坐标下的旋度：
\begin_inset Formula 
\[
\nabla\times\sbf A=\left(\frac{1}{r}\partial_{\phi}A_{z}-\partial_{z}A_{\phi}\right)\sbf e_{r}+\left(\partial_{z}A_{r}-\partial_{r}A_{z}\right)\sbf e_{\phi}+\left[\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)-\frac{1}{r}\partial_{\phi}A_{r}\right]\sbf e_{z}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
磁矢势的泛函
\end_layout

\end_inset

与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J$
\end_inset

 对应的泛函积分为
\begin_inset Formula 
\begin{equation}
\mathcal{F}(\sbf A)=\int_{\Omega}\dd{\Omega}\left[\frac{1}{\mu_{r}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\left(\nabla\times\sbf A\right)-\mu_{0}\,\sbf J\cdot\sbf A\right]\label{eq:xl3.3}
\end{equation}

\end_inset

计算 
\begin_inset Formula $\mathcal{F}(\sbf A)$
\end_inset

 的变分得：
\begin_inset Formula 
\[
\mathcal{F}(\sbf A)=\int_{\Omega}\dd{\Omega}\left[\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\cdot\left(\nabla\times\delta\sbf A\right)-\mu_{0}\,\sbf J\cdot\delta\sbf A\right]
\]

\end_inset

根据公式 
\begin_inset Formula $\nabla\cdot(\sbf a\times\sbf b)=\sbf b\cdot(\nabla\times\sbf a)-\sbf a\cdot(\nabla\times\sbf b)$
\end_inset

， 并使用高斯定理可以得到
\begin_inset Formula 
\begin{align*}
\delta\mathcal{F}(\sbf A) & =\int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\dd{\Omega}+\int_{\Gamma}\sbf e_{n}\cdot\left[\delta\sbf A\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\right]\dd{\Gamma}\\
 & =\int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\dd{\Omega}-\int_{\Gamma}\delta\sbf A\cdot\left[\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\right]\dd{\Gamma}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
第一项可以给出矢势 
\begin_inset Formula $\sbf A$
\end_inset

 满足的方程，即
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。第二项给出矢势
\begin_inset Formula $\sbf A$
\end_inset

的自然边界条件：
\begin_inset Formula 
\[
\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=0
\]

\end_inset

将计算的区域 
\begin_inset Formula $\Omega$
\end_inset

 划分有限单元后，
\begin_inset Formula $\mathcal{F}(\sbf A)$
\end_inset

 可以表示为
\begin_inset Formula 
\[
\mathcal{F}(\sbf A)=\sum_{e}\mathcal{F}^{e}(\sbf A)
\]

\end_inset

其中
\begin_inset Formula 
\begin{equation}
\mathcal{F}^{e}(\sbf A^{e})=\frac{1}{2}\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf A^{e}\right)\cdot\left(\nabla\times\sbf A^{e}\right)\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf A^{e}\dd{\Omega}\label{eq:xl3.5}
\end{equation}

\end_inset

对于磁场，二维，轴对称和 三维问题 所采用的单元略有不同。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
二维情况
\end_layout

\end_inset

 电流是垂直二维平面流过的，
\begin_inset Formula $\sbf A$
\end_inset

 也只有垂直二维平面的分量。即 
\begin_inset Formula $\sbf J=J_{z}\sbf e_{z}$
\end_inset

，有限元中的矢势可以用形函数和节点上定义的 
\begin_inset Formula $A_{z,i}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(x,y)=\sum_{i=1}^{n_{e}}N_{i}^{e}(x,y)A_{z,i}\sbf e_{z},
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
轴对称情况
\end_layout

\end_inset

 然后是磁感应强度 
\begin_inset Formula $\sbf B$
\end_inset

 轴对称情况，从毕奥–萨伐尔定律
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.11"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\sbf B=\frac{\mu}{4\pi}\oint_{L}\frac{I\dd{\sbf l}\times\sbf r}{r^{3}}
\]

\end_inset

取对称轴为柱坐标系下的 
\begin_inset Formula $\sbf e_{z}$
\end_inset

 坐标轴，如果电流
\begin_inset Formula $I\dd{l}$
\end_inset

只沿着
\begin_inset Formula $\sbf e_{\phi}$
\end_inset

方向，则
\begin_inset Formula $\sbf B$
\end_inset

将没有 
\begin_inset Formula $\sbf e_{\phi}$
\end_inset

方向的分量，并且其他方向分量也不依赖于 
\begin_inset Formula $\phi$
\end_inset

 坐标。因此令电流 
\begin_inset Formula $\sbf J=J_{\varphi}\sbf e_{\varphi}$
\end_inset

，对应地由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula $\sbf A=A_{\varphi}\sbf e_{\varphi}$
\end_inset

。有限元中的矢势可以用形函数 和节点上定义的 
\begin_inset Formula $A_{\varphi,i}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(\rho,z)=\sum_{\alpha=1}^{n_{e}}N_{\alpha}^{e}(\rho,z)A_{\varphi,\alpha}\sbf e_{\varphi}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status collapsed

\begin_layout Plain Layout
三维磁场
\end_layout

\end_inset

 对于三维磁场问题，采用的是棱边单元，相应的形函数是矢量。有限元中的矢势可以用形函数和棱边上定义的 
\begin_inset Formula $A_{\alpha}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(x,y,z)=\sum_{\alpha=1}^{n_{e}}\sbf N_{\alpha}^{e}(x,y,z)A_{\alpha}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
有限元矩阵
\end_layout

\begin_layout Standard
对于任一种情况，单元内的矢量势均可以统一表示为一种形式，即
\begin_inset Formula 
\begin{equation}
\sbf A^{e}=\sum_{\alpha=1}^{n_{e}}\sbf N_{\alpha}^{e}A_{\alpha}\label{eq:xl3.6}
\end{equation}

\end_inset

例如二维情况下，
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(x,y)\sbf e_{z}$
\end_inset

，
\begin_inset Formula $A_{\alpha}=A_{z,\alpha}$
\end_inset

；轴对称情况下 
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(\rho,z)\sbf e_{\varphi}$
\end_inset

，
\begin_inset Formula $A_{\alpha}=A_{\varphi,\alpha}$
\end_inset

。然后将 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

，代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\[
\mathcal{F}^{e}(\sbf A^{e})=\frac{1}{2}\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}A_{\alpha}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}A_{\beta}\right)\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}A_{\alpha}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Standard
计算 
\begin_inset Formula $\mathcal{F}^{e}(\sbf A^{e})$
\end_inset

 对 
\begin_inset Formula $A_{\alpha}$
\end_inset

 的导数，并根据 
\begin_inset Formula $\delta\mathcal{F}(\sbf A)=0$
\end_inset

，可以得到
\begin_inset Formula $A_{i}$
\end_inset

所满足的矩阵方程
\begin_inset Formula 
\begin{equation}
\sum_{e=1}^{M}[K_{\alpha\beta}^{e}]\{A_{\beta}\}=\sum_{e=1}^{M}\{b_{\alpha}^{e}\}\label{eq:xl3.7}
\end{equation}

\end_inset

其中
\begin_inset Formula 
\begin{align}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}\right)\dd{\Omega}\label{eq:xl3.8}\\
b_{\alpha}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}\dd{\Omega}\label{eq:xl3.9}
\end{align}

\end_inset


\end_layout

\begin_layout Section
二维静磁场
\end_layout

\begin_layout Standard
二维静磁问题中的电流是垂直二维平面流过的，
\begin_inset Formula $\sbf A$
\end_inset

只有垂直二维平面的分量。即 
\begin_inset Formula $\sbf J=J_{z}\sbf e_{z}$
\end_inset

，
\begin_inset Formula $\sbf N_{i}^{e}=N_{i}^{e}\left(x,y\right)\sbf e_{z}$
\end_inset

，将其代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以得到
\begin_inset Formula 
\begin{align*}
 & K_{\alpha\beta}^{e}=\frac{1}{\mu_{r}}\int_{\Omega^{e}}\left(\frac{\partial N_{\alpha}^{e}}{\partial x}\frac{\partial N_{\beta}^{e}}{\partial x}+\frac{\partial N_{\alpha}^{e}}{\partial y}\frac{\partial N_{\beta}^{e}}{\partial y}\right)\dd{\Omega}\\
 & b_{\alpha}^{e}=\mu_{0}\int_{\Omega^{e}}J_{z}N_{\alpha}^{e}\dd{\Omega}
\end{align*}

\end_inset

二维静磁场方程的形式和二维静电场方程的形式一样。
\end_layout

\begin_layout Section
轴对称静磁场
\end_layout

\begin_layout Standard
如果所研究的问题具有旋转对称性，可以沿着对称轴取一个截面在柱坐标下求解相应的电磁方程，即 
\begin_inset Formula $r,z$
\end_inset

 平面。轴对称情况下，矢势在柱坐标下只有
\begin_inset Formula $A_{\varphi}$
\end_inset

分量，相应的磁场可以用矢势表示为
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A=-\partial_{z}f_{\phi}\sbf e_{r}+\frac{1}{r}\partial_{r}\left(rf_{\phi}\right)\sbf e_{z}
\]

\end_inset

如上所述，磁感应
\begin_inset Formula $\sbf B$
\end_inset

分布在
\begin_inset Formula $r,z$
\end_inset

平面。
\end_layout

\begin_layout Remark
柱坐标下的旋度表示
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf A=\left(\frac{1}{r}\partial_{\phi}A_{z}-\partial_{z}A_{\phi}\right)\sbf e_{r}+\left(\partial_{z}A_{r}-\partial_{r}A_{z}\right)\sbf e_{\phi}+\left[\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)-\frac{1}{r}\partial_{\phi}A_{r}\right]\sbf e_{z}\label{eq:curl-cylin}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
另外需要注意的是，虽然在截面上划分的单元和二维情况下的划分完全一样。但实际上处理的有限元单元并不是一个平面单元，而是平面单元沿对称轴旋转 
\begin_inset Formula $360$
\end_inset

 度所形成的圆环，如图 3.1所示。
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status collapsed

\begin_layout Plain Layout
f
\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
轴对称单元对网格剖分的对应关系
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
在某个单元上的有限元泛函为（为了后续处理方便，
\begin_inset Formula $\mathcal{F}^{e}$
\end_inset

的表达式右边乘了系数
\begin_inset Formula $1/2\pi$
\end_inset

）
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\sbf A^{e}\right)=\frac{1}{2\pi}\int_{\Omega^{e}}\dd{\Omega}\left[\frac{1}{2}\frac{1}{\mu_{r}}\left(\nabla\times\sbf A^{e}\right)\cdot\left(\nabla\times\sbf A^{e}\right)-\mu_{0}\,\sbf J\cdot\sbf A^{e}\right]
\]

\end_inset

其中
\begin_inset Formula $\dd{\Omega}=r\dd{r}\dd{z}\dd{\varphi}$
\end_inset

，关于 
\begin_inset Formula $\varphi$
\end_inset

 的积分给出
\begin_inset Formula $2\pi$
\end_inset

因子，与前面的系数
\begin_inset Formula $1/2\pi$
\end_inset

 互相抵消。将 
\begin_inset Formula $\sbf A^{e}=N_{i}^{e}A_{i}\sbf e_{\varphi}$
\end_inset

，电流 
\begin_inset Formula $\sbf J=J_{\varphi}\sbf e_{\varphi}$
\end_inset

代入，
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\sbf A^{e}\right)=\sum_{i,j}^{n_{e}}\int_{\Omega^{e}}\dd{r}\dd{z}\left[\frac{1}{2}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}A_{\alpha}\right)\cdot\left(\nabla\times\sbf N_{\beta}^{e}A_{\beta}\right)-\mu_{0}\,\sbf J\cdot\sbf N_{\gamma}^{e}A_{\gamma}\right]
\]

\end_inset

轴对称情况下，形函数 
\begin_inset Formula $\sbf N_{i}^{e}=N_{i}^{e}(\rho,z)\sbf e_{\varphi}$
\end_inset

，计算可以得到
\begin_inset Formula 
\[
\nabla\times\sbf N_{i}^{e}=-\partial_{z}N_{i}^{e}\sbf e_{r}+\frac{1}{r}\partial_{r}(rN_{i}^{e})\sbf e_{z}
\]

\end_inset

相应的 
\begin_inset Formula $K_{ij}^{e}$
\end_inset

 矩阵和列向量 
\begin_inset Formula $b_{i}^{e}$
\end_inset

 可以分别表示为
\begin_inset Formula 
\begin{align*}
 & K_{\alpha\beta}^{e}=\int_{\Gamma^{e}}\frac{r}{\mu_{r}}\left[\partial_{z}N_{\alpha}^{e}\,\partial_{z}N_{\beta}^{e}+\left(\frac{N_{\alpha}^{e}}{r}+\partial_{r}N_{\alpha}^{e}\right)\left(\frac{N_{\beta}^{e}}{r}+\partial_{r}N_{\beta}^{e}\right)\right]\dd{r}\dd{z}\\
 & b_{\alpha}^{e}=\mu_{0}J_{\varphi}\int_{\Gamma^{e}}N_{\alpha}^{e}r\,\dd{r}\dd{z}.
\end{align*}

\end_inset

柱坐标下的旋度见
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:curl-cylin"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Section
三维磁场和树–余树规范
\end_layout

\begin_layout Standard
三维情况下的形函数有三个分量，可以取
\begin_inset Formula 
\begin{align*}
\sbf N_{\alpha}^{e} & =\left(L_{\alpha_{1}}^{e}\nabla L_{\alpha_{2}}^{e}-L_{\alpha_{2}}^{e}\nabla L_{\alpha_{1}}^{e}\right)\ell_{\alpha}^{e}\\
\nabla\times\sbf N_{\alpha}^{e} & =2\left(\nabla L_{\alpha_{1}}^{e}\times\nabla L_{\alpha_{2}}^{e}\right)\ell_{\alpha}^{e}
\end{align*}

\end_inset

因此
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\left(\nabla\times\sbf N_{\beta}^{e}\right)\dd{\Omega}\\
b_{\alpha}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
由于采用棱边单元定义的矩阵 
\begin_inset Formula $[K_{\alpha\beta}^{e}]$
\end_inset

 是奇异矩阵，即 
\begin_inset Formula $\det[K_{\alpha\beta}^{e}]=0$
\end_inset

。因此矩阵方程 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\sum_{e=1}^{M}[K_{\alpha\beta}^{e}]\{A_{\beta}\}=\sum_{e=1}^{M}\{b_{\alpha}^{e}\}$
\end_inset

 有无穷多解。采用棱边单元定义的矢势
\begin_inset Formula $\sbf A$
\end_inset

 在每个单元内部是满足库仑规范的 （
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

）。但是在单元的边界，库仑规范不满足，导致 矢势
\begin_inset Formula $\sbf A$
\end_inset

有无穷解。为了保证方程解的唯一性，即得到库仑规范下 
\begin_inset Formula $\sbf A$
\end_inset

的解，需要对 
\begin_inset Formula $\sbf A$
\end_inset

做一些拘束。取一个不闭合的任意矢量场
\begin_inset Formula $\sbf w$
\end_inset

，使得
\begin_inset Formula 
\[
\sbf A\cdot\sbf w=0,
\]

\end_inset

可以证明，在条件
\begin_inset Formula $\sbf A\cdot\sbf w=0$
\end_inset

的约束下，方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J$
\end_inset

的解是唯一的，证明如下。
\end_layout

\begin_layout Standard
如果
\begin_inset Formula $\sbf A$
\end_inset

和
\begin_inset Formula $\sbf A+\delta\sbf A$
\end_inset

都为方程的解，那么
\begin_inset Formula 
\[
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\delta\sbf A\right)=0
\]

\end_inset

进而可以得到
\begin_inset Formula 
\[
\int_{\Omega}(\nabla\times\delta\sbf A)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}=0
\]

\end_inset

 由于1/
\begin_inset Formula $\mu_{r}$
\end_inset

是正定的，上面的方程可以给出
\begin_inset Formula $\nabla\times\delta\sbf A=0$
\end_inset

，可以设
\begin_inset Formula $\delta\sbf A=\nabla\chi$
\end_inset

。如果固定空间中的一点
\begin_inset Formula $P$
\end_inset

，然后取空间任一点作为
\begin_inset Formula $Q$
\end_inset

，那么总是可以找到连接
\begin_inset Formula $P$
\end_inset

和
\begin_inset Formula $Q$
\end_inset

的一条积分路线，使得
\begin_inset Formula 
\[
\chi(Q)=\chi(P)+\int_{P}^{Q}\nabla\chi\cdot\dd{\sbf\ell}
\]

\end_inset

因为
\begin_inset Formula $\delta\sbf A=\nabla\chi$
\end_inset

，并且 
\begin_inset Formula $\sbf A\cdot\sbf w=0$
\end_inset

 ，所以 
\begin_inset Formula $\nabla\chi\cdot\sbf w=0$
\end_inset

。取
\begin_inset Formula $\dd{\sbf\ell}$
\end_inset

平行
\begin_inset Formula $\sbf w$
\end_inset

，则
\begin_inset Formula $\chi(Q)=\chi(P)$
\end_inset

。因此取适当的
\begin_inset Formula $\sbf w$
\end_inset

 可以保证 
\begin_inset Formula $\delta\sbf A=\nabla\chi=0$
\end_inset

，即
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示矩阵方程的唯一性。
\end_layout

\begin_layout Standard
图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的二维模型中，树–余树规范（Tree–Cotree gauge）对矢势
\begin_inset Formula $\sbf A$
\end_inset

的约束情况。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/xl-f3.2.png
	scale 90

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
二维有限元 树–余树 示意图。绿色边单元上的矢势取
\begin_inset Formula $0$
\end_inset

。
\begin_inset CommandInset label
LatexCommand label
name "fig:xl3.2"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
永磁材料
\end_layout

\begin_layout Standard
在永磁材料中存在不为零的磁化强度，
\begin_inset Formula $\sbf B$
\end_inset

 和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系可以写为
\begin_inset Formula 
\[
\sbf H=\frac{1}{\mu_{0}}\sbf B-\sbf M
\]

\end_inset

硬体磁体中的 
\begin_inset Formula $\sbf M$
\end_inset

 几乎不随外磁场变化，可以当作常矢量（vary on 
\begin_inset Formula $\sbf H$
\end_inset

）处理。如果考虑更一般的情况，可以认为磁化强度 
\begin_inset Formula $\sbf M$
\end_inset

随磁场线性变化，即
\begin_inset Formula 
\[
\sbf M=\sbf M_{0}+\chi\sbf H.
\]

\end_inset

其中，
\begin_inset Formula $\sbf M_{0}$
\end_inset

 是没有外场情况下，永磁材料中的磁化强度，是常矢量。这样可以得到
\begin_inset Formula 
\begin{align*}
\sbf H & =\frac{1}{\mu_{0}\mu_{r}}\sbf B-\frac{1}{\mu_{r}}\sbf M_{0}\\
\mu_{r} & =1+\chi
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
计算的区域
\begin_inset Formula $\Omega$
\end_inset

存在永磁区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

，可以得到静磁场方程：
\begin_inset Formula 
\begin{equation}
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J+\frac{\mu_{0}}{\mu_{r}}\nabla\times\sbf M_{0}\label{eq:xl3.10}
\end{equation}

\end_inset

以及相应的泛函积分
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\sbf A\right)=\int_{\Omega}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\left(\sbf J+\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}\right)\cdot\sbf A\dd{\Omega}\label{eq:xl3.11}
\end{equation}

\end_inset

同样，
\begin_inset Formula $\mathcal{F}\left(\sbf A\right)$
\end_inset

可以表示为各个有限元单元中 
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的和
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\sbf A\right)=\sum_{e}\mathcal{F}^{e}\left(\sbf A\right)\label{eq:xl3.12}
\end{equation}

\end_inset

如果单元积分区域属于线性材料区，
\begin_inset Formula $\Omega_{e}\in\Omega_{0}$
\end_inset

，
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的表达式和之前相同；如果单元积分区域实在永磁铁区，即 
\begin_inset Formula $\Omega_{e}\in\Omega_{m}$
\end_inset

，则
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\label{eq:xl3.13}\\
 & -\left({\color{blue}\int_{\Omega_{e}}\frac{\mu_{0}}{\mu_{r}}\left(\nabla\times\sbf M_{0}\right)\cdot\sbf A\dd{\Omega}-\int_{\Gamma_{e}}\frac{\mu_{0}}{\mu_{r}}\left(\hat{\sbf e}_{n}\times\sbf M_{0}\right)\cdot\sbf A\dd{\Gamma}}\right)\label{eq:xl3.14}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
在 
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 的表达式中，
\begin_inset Formula $\Gamma_{e}$
\end_inset

 是单元的表面，最后一项是在单元表面的积分，
\begin_inset Formula $\hat{\sbf e}_{n}$
\end_inset

是垂直表面的单位矢量。
\end_layout

\begin_layout Enumerate
表面积分出现的原因是将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

改写为
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

之后必然出现的（体减去外壳）。式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

中 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 对积分的贡献，完全来自 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 在空间中的变化，即 
\begin_inset Formula $\nabla\times\sbf M_{0}$
\end_inset

。将积分的区域 
\begin_inset Formula $\Omega$
\end_inset

 划分有限元网格之后，在计算
\begin_inset Formula $\mathcal{F}^{e}\left(\sbf A\right)$
\end_inset

 时，如果不考虑各个单元的表面积分，那么相邻单元边界处的 
\begin_inset Formula $\nabla\times\sbf M_{0}$
\end_inset

 会被忽视。
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\sbf M_{0}$
\end_inset

 是一个常矢量（on 空间坐标），那么相邻单元在公共边处的 
\begin_inset Formula $\hat{\sbf e}_{n}$
\end_inset

 符号刚好相反，可以互相抵消，最后只留下永磁体区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

 边界处 
\begin_inset Formula $\Gamma_{m}$
\end_inset

 的表面积分，这一项就是电流密度。
\end_layout

\begin_layout Standard
使用等式 
\begin_inset Formula $\left(\nabla\times\sbf M_{0}\right)\cdot\sbf A=\nabla\cdot\left(\sbf M_{0}\times\sbf A\right)+\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)$
\end_inset

，并用高斯定律可以得到
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\\
 & -{\color{brown}\frac{\mu_{0}}{\mu_{r}}\int_{\Gamma^{e}}\hat{\sbf e}_{n}\cdot\left(\sbf M_{0}\times\sbf A\right)\dd{\Gamma}}-\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)\dd{\Omega}\\
 & -{\color{brown}\frac{\mu_{0}}{\mu_{r}}\int_{\Gamma^{e}}\left(\sbf M_{0}\times\hat{\sbf e}_{n}\right)\cdot\sbf A\dd{\Gamma}}
\end{align*}

\end_inset

可以看到表面积分的部分相互抵消，最后只留下体积分，即
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\sbf A\right) & =\int_{\Omega_{e}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf A\dd{\Omega}\label{eq:xl3.15}\\
 & -\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf A\right)\dd{\Omega}\label{eq:xl3.16}
\end{align}

\end_inset

因此在永磁材料中，激励向量会多出一项永磁体的贡献
\begin_inset Formula 
\[
b_{i}^{e}=\mu_{0}\int_{\Omega_{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}+\frac{\mu_{0}}{\mu_{r}}\int_{\Omega_{e}}\sbf M_{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Section
非线性材料
\end_layout

\begin_layout Standard
非线性材料中 
\begin_inset Formula $\sbf B$
\end_inset

和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系比较复杂，一般无法写出关于 
\begin_inset Formula $\sbf A$
\end_inset

 的显式方程，但可以通过逐步迭代逼近的方法将 
\begin_inset Formula $\sbf A$
\end_inset

 求解出来。介质中的静磁场方程最一般的表达式为：
\begin_inset Formula 
\begin{align*}
 & \sbf B=\sbf B\left(\sbf H\right)\\
 & \nabla\times\sbf H=\sbf J
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
如果可以先确定出 
\begin_inset Formula $\sbf B$
\end_inset

，那么根据 BH 曲线就可以确定出 
\begin_inset Formula $\sbf H$
\end_inset

，得到的 
\begin_inset Formula $\sbf H$
\end_inset

 应该满足方程 
\begin_inset Formula $\nabla\times\sbf H=\sbf J$
\end_inset

。可以首先取 
\begin_inset Formula $\sbf B^{0}$
\end_inset

 作为方程的试探解，根据 BH 曲线可以得到 
\begin_inset Formula $\sbf H^{0}=\sbf H(\sbf B^{0})$
\end_inset

。
\end_layout

\begin_layout Enumerate
若 
\begin_inset Formula $\sbf H^{0}$
\end_inset

满足方程 
\begin_inset Formula $\nabla\times\sbf H^{0}=\sbf J$
\end_inset

，那么取 
\begin_inset Formula $\sbf B^{0}$
\end_inset

和 
\begin_inset Formula $\sbf H^{0}$
\end_inset

 就应该是所求的解。
\end_layout

\begin_layout Enumerate
若 
\begin_inset Formula $\sbf H^{0}$
\end_inset

不满足方程 
\begin_inset Formula $\nabla\times\sbf H^{0}=\sbf J$
\end_inset

，说明目前的 
\begin_inset Formula $\sbf B^{0}$
\end_inset

 值不正确，需要对 
\begin_inset Formula $\sbf B^{0}$
\end_inset

做修正。修正后 
\begin_inset Formula $\sbf B=\sbf B^{0}+\delta\sbf B$
\end_inset

。相应的 
\begin_inset Formula $\sbf H=\sbf H^{0}+\delta\sbf H$
\end_inset

，其中
\begin_inset Formula 
\[
\delta\sbf H=\frac{\partial H}{\partial B}\delta B
\]

\end_inset


\end_layout

\begin_layout Standard
如果是各向异性的情况，式中的 
\begin_inset Formula $\partial H/\partial B$
\end_inset

 就是张量。修正后 
\begin_inset Formula $\sbf H$
\end_inset

 应该满足方程
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\nabla\times\left(\sbf H^{0}+\frac{\partial H}{\partial B}\delta\sbf B\right)=\sbf J\label{eq:xl3.17}
\end{equation}

\end_inset

方程中只有 
\begin_inset Formula $\delta B$
\end_inset

 是未知量。由于 
\begin_inset Formula $\sbf B=\nabla\times\sbf A$
\end_inset

，因此 
\begin_inset Formula $\delta\sbf B=\nabla\times\delta\sbf A$
\end_inset

，代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.17"
plural "false"
caps "false"
noprefix "false"

\end_inset

得到
\begin_inset Formula 
\[
\nabla\times\left(\sbf H^{0}+\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J
\]

\end_inset


\end_layout

\begin_layout Standard
施加相应的边界条件，就可以解出 
\begin_inset Formula $\delta\sbf A$
\end_inset

，进而得到 
\begin_inset Formula $\delta\sbf B$
\end_inset

和 
\begin_inset Formula $\delta\sbf H$
\end_inset

，最后得到修正的
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

。如果修正后的 
\begin_inset Formula $\sbf H$
\end_inset

 仍然不满足方程 
\begin_inset Formula $\nabla\times\sbf H=\sbf J$
\end_inset

，那么就把修正后的
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

作为初始值，重复上面的步骤，直到 
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf H$
\end_inset

趋近方程的真实解。每一步迭代所求解的方程为：
\begin_inset Formula 
\begin{equation}
\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J-\nabla\times\sbf H^{0}\label{eq:xl3.18}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
首先采用泛函积分的 Ritz 法来构造有限元计算流程。根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以写出关于 
\begin_inset Formula $\delta\sbf A$
\end_inset

 的泛函
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\delta\sbf A\right)=\mu_{0}\int_{\Omega}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\left(\sbf J-\nabla\times\sbf H^{0}\right)\cdot\delta\sbf A\dd{\Omega}\label{eq:xl3.19}
\end{equation}

\end_inset

然后有
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\delta\sbf A\right)=\sum_{e}\mathcal{F}^{e}\left(\delta\sbf A\right),\label{eq:xl3.19b}
\end{equation}

\end_inset

在单个有限元单元中
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\delta\sbf A\right)= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.20}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\delta\sbf A\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\left(\nabla\times\sbf H^{0}\right)\cdot\delta\sbf A\dd{\Omega}\label{eq:xl3.21}\\
 & +\mu_{0}\int_{\Gamma^{e}}\left(\sbf H^{0}\times\hat{\sbf e}_{n}\right)\cdot\delta\sbf A\dd{\Gamma}\label{eq:xl3.22}
\end{align}

\end_inset

式中最后一项是单元表面的积分。这一项出现的原因和永磁体一样，都是因为将原来的积分区域
\begin_inset Formula $\Omega$
\end_inset

 划分成网格后，利用式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.19b"
plural "false"
caps "false"
noprefix "false"

\end_inset

计算 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)$
\end_inset

 造成的。经过类似的处理，去掉边界项给出
\begin_inset Formula 
\begin{align}
\mathcal{F}^{e}\left(\delta\sbf A\right)= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\delta\sbf A\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.23}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\delta\sbf A\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\delta\sbf A\right)\dd{\Omega}\label{eq:xl3.24}
\end{align}

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\delta\sbf A=\sbf N_{j}^{e}\delta A_{j}$
\end_inset

，代入 
\begin_inset Formula $\mathcal{F}^{e}\left(\delta\sbf A\right)$
\end_inset

 中，可以得到
\begin_inset Formula 
\begin{align*}
\frac{\partial\mathcal{F}}{\partial\delta\sbf A_{i}}= & \mu_{0}\int_{\Omega^{e}}\frac{1}{2}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\delta A_{j}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

由于 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)$
\end_inset

 满足极值条件 
\begin_inset Formula $\mathcal{F}\left(\delta\sbf A\right)=0$
\end_inset

，最后可以得到矩阵方程
\begin_inset Formula 
\[
\left\{ \frac{\partial\mathcal{F}}{\partial\delta\sbf A_{i}}\right\} =\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ \delta A_{j}\right\} -\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} =\left\{ 0\right\} 
\]

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{ij}^{e} & =\mu_{0}\int_{\Omega^{e}}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\\
b_{i}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{i}^{e}\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
对于线性材料，
\begin_inset Formula $\sbf H=\sbf B/(\mu_{0}\mu_{r})$
\end_inset

，
\begin_inset Formula $\partial H/\partial B=1/(\mu_{0}\mu_{r})$
\end_inset

；对于永磁体，
\begin_inset Formula $\sbf H=\frac{1}{\mu_{0}\mu_{r}}\sbf B-\frac{1}{\mu_{r}}\sbf M_{0}$
\end_inset

，
\begin_inset Formula $\partial H/\partial B=1/(\mu_{0}\mu_{r})$
\end_inset

。将积分的区域
\begin_inset Formula $\Omega$
\end_inset

根据材料类型分为线性材料区域 
\begin_inset Formula $\Omega_{0}$
\end_inset

，永磁体材料区域 
\begin_inset Formula $\Omega_{m}$
\end_inset

 和非线性材料区域 
\begin_inset Formula $\Omega_{n}$
\end_inset

。则
\begin_inset Formula 
\[
K_{ij}^{e}=\begin{cases}
\frac{1}{\mu_{r}}\int_{\Omega^{e}}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega} & \Omega^{e}\in\Omega_{0}+\Omega_{m}\\
\mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega} & \Omega^{e}\in\Omega_{n}
\end{cases}
\]

\end_inset


\end_layout

\begin_layout Example
Ritz 方法
\end_layout

\begin_layout Standard
根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.18"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)=\sbf J-\nabla\times\sbf H^{0}
\]

\end_inset

采用 Galerkin 法也可以得到和 Ritz 法相同的结果。首先以 
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

 为加权函数计算相应的余数
\begin_inset Formula 
\begin{align*}
R_{i}^{e}= & \mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\left[\nabla\times\left(\frac{\partial H}{\partial B}\nabla\times\delta\sbf A\right)-\sbf J+\nabla\times\sbf H^{0}\right]\dd{\Omega}\\
 & +\mu_{0}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\left(\sbf H^{0}\times\hat{\sbf e}_{n}\right)\dd{\Gamma}
\end{align*}

\end_inset

边界积分来源于单元的“表面电流” 
\begin_inset Formula $\sbf H^{0}\times\hat{\sbf e}_{n}$
\end_inset

，经过分部积分可得：
\begin_inset Formula 
\begin{align*}
R_{i}^{e}= & \mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\delta\sbf A\right)\dd{\Omega}+\mu_{0}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\left[\hat{\sbf e}_{n}\times\frac{\partial H}{\partial B}\left(\nabla\times\delta\sbf A\right)\right]\dd{\Gamma}\\
 & -\mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\sbf J\dd{\Omega}+\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

式中的边界积分中，相邻单元的贡献在边界上互相抵消，最后只留下 
\begin_inset Formula $\Omega$
\end_inset

 边界上的积分，
\begin_inset Formula $\Omega$
\end_inset

 边界上的约束条件可以抵消掉该边界积分的贡献，因此表面积分可以去掉。最后将 
\begin_inset Formula $\delta\sbf A=\sbf N_{j}^{e}\delta A_{j}$
\end_inset

代入上式，可以得到矩阵形式下 
\begin_inset Formula $R_{i}^{e}$
\end_inset

 的表达式：
\begin_inset Formula 
\[
R_{i}^{e}=K_{ij}^{e}\delta A_{j}-b_{i}^{e}
\]

\end_inset

并且
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left\{ R_{i}^{e}\right\} =\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ \delta\sbf A_{j}\right\} -\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} =\left\{ 0\right\} 
\]

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{ij}^{e} & =\mu_{0}\int_{\Omega^{e}}\frac{\partial H}{\partial B}\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\left(\nabla\times\sbf N_{j}^{e}\right)\dd{\Omega}\\
b_{i}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\sbf J\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf H^{0}\cdot\left(\nabla\times\sbf N_{i}^{e}\right)\dd{\Omega}
\end{align*}

\end_inset

和Ritz法得到的结果完全相同。
\end_layout

\begin_layout Section
计算电感
\end_layout

\begin_layout Chapter
磁场的开域问题
\end_layout

\begin_layout Standard
由于很少有材料可以屏蔽磁场，所以磁场的问题几乎都是开域问题。和静电场类似，磁场的开域问题也可以采用截断法或者精度更高的渐近边界条件来处理。首先矢势可以表示为
\begin_inset Formula 
\[
\sbf A\left(\sbf r\right)=\frac{\mu_{0}}{4\pi}\int\dd[3]{r'}\frac{\sbf J\left(\sbf r'\right)+\nabla'\times\sbf M\left(\sbf r'\right)}{\abs{\sbf r-\sbf r'}}
\]

\end_inset

同样在远离源的地方
\begin_inset Formula 
\[
\frac{1}{\abs{\sbf r-\sbf r'}}=\frac{1}{\abs{\sbf r}}+\frac{\sbf r\cdot\sbf r'}{\abs{\sbf r}^{3}}+\cdots
\]

\end_inset

这样可以得到最低阶的近似表达式：
\begin_inset Formula 
\begin{equation}
\sbf A=\frac{\sbf a}{r^{n}}\label{eq:xl3.25}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\sbf a$
\end_inset

 是与
\begin_inset Formula $r$
\end_inset

无关的矢量。采用截断法处理边界处的矢势，即取 
\begin_inset Formula $\sbf A=0$
\end_inset

 或 
\begin_inset Formula $\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=0$
\end_inset

，计算精度分别为 
\begin_inset Formula $\mathcal{O}\left(r^{-n}\right)$
\end_inset

和 
\begin_inset Formula $\mathcal{O}\left(r^{-n-1}\right)$
\end_inset

。根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.25"
plural "false"
caps "false"
noprefix "false"

\end_inset

得到
\begin_inset Formula $\sbf A$
\end_inset

满足的渐近边界条件：
\begin_inset Formula 
\[
\nabla\times\sbf A=\frac{-n}{r^{2}}\sbf r\times\sbf A
\]

\end_inset


\end_layout

\begin_layout Section
线性材料的开域问题
\end_layout

\begin_layout Standard
对于线性材料，在
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的关于
\begin_inset Formula $\sbf A$
\end_inset

 的泛函积分中添加表面项的贡献，即
\begin_inset Formula 
\begin{align}
\mathcal{F}(\sbf A) & =\frac{1}{2}\int_{\Omega}\left(\nabla\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\dd{\Omega}-\mu_{0}\int_{\Omega}\sbf J\cdot\sbf A\dd{\Omega}\nonumber \\
 & +\int_{\Gamma}\frac{n}{2r^{3}}\left(\sbf r\times\sbf A\right)\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)\dd{\Gamma}\label{eq:xl3.25b}
\end{align}

\end_inset

对上式做变分可以得到：
\begin_inset Formula 
\begin{align*}
\delta\mathcal{F}(\sbf A)= & \int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\\
 & -\int_{\Gamma}\left[\hat{\sbf e}_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)+\frac{n}{r^{3}}\sbf r\times\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)\right]\cdot\delta\sbf A\dd{\Gamma}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status collapsed

\begin_layout Plain Layout
推导过程使用了
\begin_inset Formula 
\begin{align*}
 & \nabla\cdot\left[\sbf f\times\sbf g\right]=\left(\nabla\times f\right)\cdot g-f\cdot\left(\nabla\times g\right)\\
 & \left(\nabla\times\delta\sbf A\right)\cdot\left(\nabla\times\sbf A\right)=\nabla\cdot\left[\delta\sbf A\times\left(\nabla\times\sbf A\right)\right]+\delta\sbf A\cdot\left(\nabla\times\nabla\times\sbf A\right)
\end{align*}

\end_inset

以及混合积在轮换下不变：
\begin_inset Formula 
\[
\sbf a\cdot\left(\sbf b\times\sbf c\right)=\sbf c\cdot\left(\sbf a\times\sbf b\right)
\]

\end_inset

还有高斯散度定理。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
可以看到上式第二项给出
\begin_inset Formula 
\[
\hat{\sbf e}_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\frac{-n}{r^{3}}\sbf r\times\frac{1}{\mu_{r}}\left(\sbf r\times\sbf A\right)
\]

\end_inset

在圆形边界，上式即为关于
\begin_inset Formula $\sbf A$
\end_inset

 的渐近边界条件，表面积分对矩阵方程的贡献为：
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left(\left[K_{ij}^{e}\right]+\left[K_{ij}^{s}\right]\right)\left\{ \sbf A_{j}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} 
\]

\end_inset

其中（这个式子的形式实际上参考自
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.25b"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\[
K_{ij}^{s}=\frac{n}{r^{3}}\int_{\Gamma}\left(\sbf r\times\sbf N_{i}^{e}\right)\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf N_{j}^{e}\right)\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Subsection
二维情况
\end_layout

\begin_layout Standard
二维情况和电场的形式完全一样，二维形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

在边界上退化为一维形函数
\begin_inset Formula $N_{i}^{s}$
\end_inset

，即
\begin_inset Formula 
\[
K_{ij}^{s}=\frac{n}{r}\int_{\Gamma}\frac{N_{i}^{s}N_{j}^{s}}{\mu_{r}}\dd{\Gamma}
\]

\end_inset

这里的形式可以参考电场的结果：
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:el-open"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Subsection
轴对称
\end_layout

\begin_layout Standard
轴对称情况下，矢势在柱坐标下只有 
\begin_inset Formula $A_{\varphi}$
\end_inset

 分量，进而得到边单元对 
\begin_inset Formula $K$
\end_inset

 矩阵的贡献（这里和前面保持一致，前面乘上系数 
\begin_inset Formula $1/2\pi$
\end_inset

）
\begin_inset Formula 
\begin{equation}
K_{ij}^{s}=\frac{1}{2\pi}\frac{n}{r}\int_{\Gamma}\frac{N_{i}^{e}N_{j}^{e}}{\mu_{r}}\dd{\Gamma}\label{eq:xl3.26}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
上面的积分涉及边界上单元面积的积分，边界元形状如图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(a)所示，其中的剖面见图 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/xl-3.3.png
	scale 60

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
边界单元(a)及剖面(b)。
\begin_inset CommandInset label
LatexCommand label
name "fig:xl3.3"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
图中的 
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 和 
\begin_inset Formula $(\rho_{2},z_{2})$
\end_inset

 是边单元剖面的两个端点。左图
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:xl3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

(a)所示的边单元上下底面的周长分别是 
\begin_inset Formula $2\pi\rho_{1}$
\end_inset

，
\begin_inset Formula $2\pi\rho_{2}$
\end_inset

，边单元面积可以表示为 
\begin_inset Formula $(2\pi\rho_{1}+2\pi\rho_{2})L_{s}/2$
\end_inset

，其中 
\begin_inset Formula $L_{s}$
\end_inset

 为端点
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 和 
\begin_inset Formula $(\rho_{2},z_{2})$
\end_inset

 之间的长度。将点 
\begin_inset Formula $(\rho_{1},z_{1})$
\end_inset

 到 
\begin_inset Formula $(\rho,z_{2})$
\end_inset

 之间的长度记为 
\begin_inset Formula $\ell_{s}$
\end_inset

，那么
\begin_inset Formula $\rho$
\end_inset

可以用
\begin_inset Formula $\ell_{s}$
\end_inset

表示为
\begin_inset Formula 
\[
\rho=\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}
\]

\end_inset

因此
\begin_inset Formula 
\begin{align*}
\dd{\Gamma} & =\frac{1}{2}\left[2\pi\rho+2\pi\left(\rho+\dd{\rho}\right)\right]\dd{\ell_{s}}\\
 & =2\pi\rho\dd{\ell_{s}}+\order{\epsilon^{2}}\\
 & =2\pi\left(\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}\right)\dd{\ell_{s}}
\end{align*}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.26"
plural "false"
caps "false"
noprefix "false"

\end_inset

的积分可以表示为
\begin_inset Formula 
\[
K_{ij}^{s}=\frac{1}{2\pi}\int_{0}^{L_{s}}\frac{1}{r}\frac{N_{i}^{e}N_{j}^{e}}{\mu_{r}}2\pi\left(\rho_{1}+\frac{\rho_{2}-\rho_{1}}{L_{s}}\ell_{s}\right)\dd{\ell_{s}}
\]

\end_inset


\end_layout

\begin_layout Standard
由于
\begin_inset Formula $r$
\end_inset

在面单元内变换不大，可以提到积分外面，二维形函数 
\begin_inset Formula $N_{i}^{e}$
\end_inset

 在边界上退化为一维形函数
\begin_inset Formula $N_{i}^{s}$
\end_inset

。然后取 
\begin_inset Formula $\eta=\ell_{s}/L_{s}$
\end_inset

，可以得到
\begin_inset Formula 
\[
K_{ij}^{s}=\frac{1}{r}\frac{1}{\mu_{r}}L_{s}\int_{0}^{1}N_{i}^{e}N_{j}^{e}\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\eta\right]\dd{\eta}
\]

\end_inset

一维形函数等参的取值范围是从 
\begin_inset Formula $-1$
\end_inset

 到 
\begin_inset Formula $1$
\end_inset

，下面再做变量代换
\begin_inset Formula 
\[
\eta=\frac{\xi+1}{2}
\]

\end_inset

可以得到
\begin_inset Formula 
\begin{align*}
K_{ij}^{s} & =\frac{n}{r}\frac{1}{\mu_{r}}\frac{L_{s}}{2}\int_{-1}^{+1}N_{i}^{s}N_{j}^{s}\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\frac{\xi+1}{2}\right]\dd{\eta}\\
 & =\frac{n}{r}\frac{1}{\mu_{r}}\frac{L_{s}}{2}\sum_{\alpha}N_{i}^{s}\left(\xi_{\alpha}\right)N_{j}^{s}\left(\xi_{\alpha}\right)\left[\rho_{1}+\left(\rho_{2}-\rho_{1}\right)\frac{\xi_{\alpha}+1}{2}\right]W\left(\xi_{\alpha}\right)
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
三维情况
\end_layout

\begin_layout Standard
三维情况下的静磁问题采用的是棱边形函数，
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

是一个三维矢量，因此
\begin_inset Formula 
\begin{align*}
K_{ij}^{s} & =\frac{n}{r^{3}}\int_{\Gamma}{\color{blue}\left(\sbf r\times\sbf N_{i}^{e}\right)}\cdot\frac{1}{\mu_{r}}\left(\sbf r\times\sbf N_{j}^{e}\right)\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}{\color{blue}\varepsilon_{abc}\,\sbf r_{b}\,(\sbf N_{i}^{e})_{c}}\;\varepsilon_{afg}\,\sbf r_{f}\,(\sbf N_{j}^{e})_{g}\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\left(\delta_{bf}\delta_{cg}-\delta_{bg}\delta_{cf}\right)r_{b}\,r_{d}\;(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{g}\dd{\Gamma}\\
 & =\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\left[r_{b}r_{b}{\color{brown}(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{c}}-r_{b}r_{c}\;(\sbf N_{i}^{e})_{c}\,(\sbf N_{j}^{e})_{b}\right]\dd{\Gamma}
\end{align*}

\end_inset

代入形函数表达式 
\begin_inset Formula $\sbf N_{i}^{e}=(L_{i_{1}}^{e}\nabla L_{i_{2}}^{e}-L_{i_{2}}^{e}\nabla L_{i_{1}}^{e})\ell_{i}^{e}$
\end_inset

得到：
\begin_inset Formula 
\begin{align*}
K_{ij}^{s}=\frac{n}{r^{3}}\frac{1}{\mu_{r}}\int_{\Gamma}\dd{\Gamma} & \Bigg[r_{b}r_{b}{\color{brown}\left(L_{i_{1}}^{e}\partial_{c}L_{i_{2}}^{e}-L_{i_{2}}^{e}\partial_{c}L_{i_{1}}^{e}\right)\ell_{i}^{e}\,\left(L_{j_{1}}^{e}\partial_{c}L_{j_{2}}^{e}-L_{j_{2}}^{e}\partial_{c}L_{j_{1}}^{e}\right)\ell_{j}^{e}}\\
 & -r_{b}r_{c}\left(L_{i_{1}}^{e}\partial_{c}L_{i_{2}}^{e}-L_{i_{2}}^{e}\partial_{c}L_{i_{1}}^{e}\right)\ell_{i}^{e}\,\left(L_{j_{1}}^{e}\partial_{b}L_{j_{2}}^{e}-L_{j_{2}}^{e}\partial_{b}L_{j_{1}}^{e}\right)\ell_{j}^{e}\Bigg]
\end{align*}

\end_inset

根据公式
\begin_inset Formula 
\[
\int_{\Gamma}L_{i}^{e}L_{j}^{e}\dd{\Gamma}=\frac{\Delta_{e}}{12}\Lambda_{i,j},\quad\Lambda_{i,j}=\begin{cases}
2 & i=j\\
1 & i\neq j
\end{cases}
\]

\end_inset

最后得到
\begin_inset Formula 
\begin{align*}
K_{ij}^{s}=\frac{n\ell_{i}^{e}\ell_{j}^{e}}{r^{3}\mu_{r}}\frac{\Delta_{e}}{12} & \Bigg[\Lambda_{i_{1},j_{1}}(\sbf r\times\nabla L_{i_{2}}^{e})\cdot(\sbf r\times\nabla L_{j_{2}}^{e})\\
 & -\Lambda_{i_{2},j_{1}}(\sbf r\times\nabla L_{i_{1}}^{e})\cdot(\sbf r\times\nabla L_{j_{2}}^{e})\\
 & -\Lambda_{i_{1},j_{2}}(\sbf r\times\nabla L_{i_{2}}^{e})\cdot(\sbf r\times\nabla L_{j_{1}}^{e})\\
 & +\Lambda_{i_{2},j_{2}}(\sbf r\times\nabla L_{i_{1}}^{e})\cdot(\sbf r\times\nabla L_{j_{1}}^{e})\Bigg]
\end{align*}

\end_inset


\end_layout

\begin_layout Section
非线性材料的开域问题
\end_layout

\begin_layout Standard
在前面已经得到非线性静磁问题的迭代求解的方程，设在第
\begin_inset Formula $k$
\end_inset

步迭代，失势
\begin_inset Formula $A$
\end_inset

的增量为
\begin_inset Formula $\Delta A_{j}^{k}$
\end_inset

，其满足方程
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}\Delta A_{j}^{k}}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} ,
\]

\end_inset

上述方程也可以写成
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ A_{j}^{k}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} +\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}A_{j}^{k-1}}\right\} .
\]

\end_inset


\end_layout

\begin_layout Standard
其中
\begin_inset Formula $A_{j}^{k}$
\end_inset

和
\begin_inset Formula $A_{j}^{k-1}$
\end_inset

分别为第
\begin_inset Formula $k$
\end_inset

步和第
\begin_inset Formula $k-1$
\end_inset

步得到的失势，
\begin_inset Formula $\Delta A_{j}^{k}=A_{j}^{k}-A_{j}^{k-1}$
\end_inset

。在计算第
\begin_inset Formula $k$
\end_inset

步的失势时，第
\begin_inset Formula $k-1$
\end_inset

 的失势
\begin_inset Formula $\left\{ A_{j}^{k-1}\right\} $
\end_inset

是已知的。在关于失势的矩阵方程中加上相应表面单元的贡献
\begin_inset Formula $\left[K_{ij}^{s}\right]$
\end_inset

，就可以在模型边界用渐近边界条件来模拟开域问题，因此非线性开域问题的矩阵方程可以写为：
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left([K_{ij}^{e}]+[K_{ij}^{s}]\right)\left\{ A_{j}^{k}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} +\sum_{e=1}^{M}\left[K_{ij}^{e}\right]\left\{ {\color{blue}A_{j}^{k-1}}\right\} ,
\]

\end_inset

或者
\begin_inset Formula 
\[
\sum_{e=1}^{M}\left([K_{ij}^{e}]+[K_{ij}^{s}]\right)\left\{ {\color{blue}\Delta A_{j}^{k}}\right\} =\sum_{e=1}^{M}\left\{ b_{i}^{e}\right\} -\sum_{e=1}^{M}\left[K_{ij}^{s}\right]\left\{ A_{j}^{k-1}\right\} .
\]

\end_inset


\end_layout

\begin_layout Chapter
时谐磁场和暂态磁场
\end_layout

\begin_layout Section
低频磁场方程
\end_layout

\begin_layout Standard
随时间变化的电流产生的磁场也会随时间变化，根据法拉第定理，变化的磁场会产生电场。如果存在自由的电荷，电场会驱动电荷运动产生电流，进而影响到系统的总电流。磁场和电
场可以用标势和标势表示为
\begin_inset Formula 
\begin{align}
 & \sbf B=\nabla\times\sbf A\label{eq:xl4.1}\\
 & \sbf E=-\nabla\phi-\frac{\partial\sbf A}{\partial t}\label{eq:xl4.2}
\end{align}

\end_inset

 总电流
\begin_inset Formula $\sbf J_{\text{tot}}$
\end_inset

分为两部分，一个是外加电流
\begin_inset Formula $\sbf J(t)$
\end_inset

，另外一部分是电场诱导出的电流，即
\begin_inset Formula 
\[
\sbf J_{\text{tot}}=\sbf J_{\text{ex}}(t)+\sigma\sbf E
\]

\end_inset


\end_layout

\begin_layout Standard
电场和磁场满足麦克斯韦方程
\begin_inset Formula 
\[
\nabla\times\sbf H-\frac{\partial\sbf D}{\partial t}=\sbf J_{\text{ex}}(t)+\sigma\sbf E
\]

\end_inset

在低频情况下，
\color blue
可以忽略电位移矢量对时间的导数
\color inherit
，因此
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\sbf J_{\text{ex}}(t)+\sigma\sbf E\label{eq:xl4.3}
\end{equation}

\end_inset

 另外，电流要满足守恒方程
\begin_inset Formula $\nabla\cdot\sbf J=0$
\end_inset

，而外加电流总是满足守恒方程的，因此
\begin_inset Formula 
\begin{equation}
\nabla\cdot\sigma\left(-\nabla\Phi-\frac{\partial\sbf A}{\partial t}\right)=0.\label{eq:xl4.4}
\end{equation}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

即为低频情况下，时谐磁场和瞬态磁场所满足的方程。
\end_layout

\begin_layout Remark
忽略电位移矢量（数量级估计）。
\begin_inset Formula 
\[
\nabla\times\sbf H={\color{blue}\epsilon_{0}\epsilon_{r}\frac{\partial}{\partial t}\sbf E}+{\color{brown}\sigma\sbf E}+\sbf J_{\text{ex}}(t)
\]

\end_inset

假设频率为
\begin_inset Formula $50\mathrm{Hz}$
\end_inset

，对于一般的良导体，例如铝，列出以下数据
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\epsilon_{r}\approx8.85*10^{-12}\mathrm{F/m}\\
 & \frac{\partial}{\partial t}\approx50\mathrm{Hz}\\
 & \sigma\approx3.5\times10^{7}\mathrm{S/m}
\end{align*}

\end_inset

所以 
\begin_inset Formula ${\color{blue}\epsilon_{0}\epsilon_{r}\frac{\partial}{\partial t}\sbf E}\approx10^{-10}$
\end_inset

，而 
\begin_inset Formula ${\color{brown}\sigma\sbf E}>10^{7}$
\end_inset

，两者相差
\begin_inset Formula $17$
\end_inset

个数量级以上，所以总是可以安全地忽略第一项。而第三项
\begin_inset Formula $\sbf J_{\text{ex}}(t)$
\end_inset

作为外加电流，其数量级不好一概而论，总是保留在式子中。顺带一提，
\series bold
良导体条件
\series default
为
\begin_inset Formula 
\[
\omega\ll\tau^{-1}=\sigma/\varepsilon\quad\text{或者}\quad\frac{\sigma}{\varepsilon\omega}\gg1.
\]

\end_inset

对于一般金属导体，
\begin_inset Formula $\tau$
\end_inset

的数量极为
\begin_inset Formula $10^{-17}\mathrm{s}$
\end_inset

。只要电磁波的频率不太高，一般金属导体都可以看做良导体。良导体内部没有净的自由电荷积聚，电荷只能分布于导体表面上。
\end_layout

\begin_layout Section
时谐磁场
\end_layout

\begin_layout Standard
对于时谐磁场，可以做傅立叶展开，将外加电流写成
\begin_inset Formula $\sbf J(t)=\sbf J_{0}\cos(\omega t+\varphi)$
\end_inset

，在求解式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

时，可以将电流和待求的电磁场表示为复数的形式（选定适当的初相位
\begin_inset Formula $\varphi$
\end_inset

），
\begin_inset Formula 
\begin{align*}
\sbf J_{\text{ex}}(t) & =\sbf J_{0\text{ex}}e^{-i(\omega t+\varphi)}\\
\sbf A & =\sbf A_{\omega}e^{-i\omega t}\\
\sbf\Phi & =\sbf\Phi_{\omega}e^{-i\omega t}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
考虑先行材料，取电流
\begin_inset Formula $\sbf J(t)$
\end_inset

，标势
\begin_inset Formula $\Phi$
\end_inset

和失势
\begin_inset Formula $\sbf A$
\end_inset

的复数形式，将
\begin_inset Formula $\sbf B$
\end_inset

和
\begin_inset Formula $\sbf E$
\end_inset

的表达式，即式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\begin{align*}
\nabla\cdot\sigma\left(-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}\right) & =0\\
\nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A_{\omega}\right) & =\sbf J_{0\text{ex}}e^{-i\varphi}+\sigma\left(-\nabla\Phi_{\omega}+i\omega\sbf A_{\omega}\right)
\end{align*}

\end_inset

整理之后可得
\begin_inset Formula 
\begin{align*}
{\color{blue}\frac{i}{\omega}\nabla\cdot(\sigma\nabla\Phi_{\omega})}+{\color{brown}\nabla\cdot(\sigma\sbf A_{\omega})} & =0\\
{\color{blue}\nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A_{\omega}\right)-i\omega\sigma\sbf A_{\omega}}+{\color{brown}\sigma\nabla\Phi_{\omega}} & =\sbf J_{0}e^{-i\varphi}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
可以写出上述方程组对应的泛函积分
\begin_inset Formula 
\begin{align*}
\mathcal{F}(\sbf A_{\omega},\Phi_{\omega})=\int_{\Omega}\dd{\Omega}\Big\{ & \frac{1}{2}\left[{\color{blue}(\nabla\times\sbf A_{\omega})\cdot\frac{1}{\mu_{0}\mu_{r}}(\nabla\times\sbf A_{\omega})-i\omega\sigma\,\sbf A_{\omega}\cdot\sbf A_{\omega}}\right]\\
 & +{\color{blue}\frac{i}{\omega}\frac{1}{2}(\nabla\Phi_{\omega})\cdot\sigma(\nabla\Phi_{\omega})}-\sbf J_{0}e^{-i\varphi}\cdot\sbf A_{\omega}\\
 & +{\color{brown}\nabla\cdot(\Phi_{\omega}\sigma\sbf A_{\omega})}\Big\}
\end{align*}

\end_inset

其中使用了
\begin_inset Formula ${\color{brown}\nabla\cdot(\Phi_{\omega}\sigma\sbf A_{\omega})}=\nabla\Phi_{\omega}\cdot\sigma\sbf A_{\omega}+\Phi_{\omega}\nabla\cdot\sigma\sbf A_{\omega}$
\end_inset

。方程中的矢势和标势可以分别用形函数表示为
\begin_inset Formula 
\begin{align*}
\sbf A_{\omega} & =\sbf N_{i}^{e}A_{i}\\
\Phi_{\omega} & =L_{m}^{e}\Phi_{m}
\end{align*}

\end_inset

其中指标
\begin_inset Formula $i$
\end_inset

，
\begin_inset Formula $j$
\end_inset

表示失势的自由度；
\begin_inset Formula $m$
\end_inset

，
\begin_inset Formula $n$
\end_inset

标势标势的自由度。因此每个单元中的泛函写成
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}(A_{i},\Phi_{\omega})=\int_{\Omega^{e}}\dd{\Omega} & \Big\{\frac{1}{2}\left[{\color{blue}\left(\nabla\times\sbf N_{i}^{e}A_{i}\right)\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf N_{j}^{e}A_{j}\right)-i\omega\sigma\sbf N_{i}^{e}A_{i}\cdot\sbf N_{j}^{e}A_{j}}\right]\\
 & +{\color{brown}\frac{i}{\omega}\frac{1}{2}(\nabla L_{m}^{e}\Phi_{m})\cdot\sigma(\nabla L_{n}^{e}\Phi_{n})}-\sbf J_{0}e^{-i\varphi}\cdot\sbf N_{i}^{e}A_{i}\\
 & +{\color{red}\nabla\cdot(L_{m}^{e}\Phi_{m}\,\sigma\sbf N_{i}^{e}A_{i}})\Big\}
\end{align*}

\end_inset

分别对
\begin_inset Formula $A_{i}$
\end_inset

和
\begin_inset Formula $\Phi_{m}$
\end_inset

求导可以得到
\begin_inset Formula 
\begin{align*}
\frac{\partial\mathcal{F}^{e}}{\partial A_{i}} & ={\color{blue}K_{ij}^{e}A_{j}}-b_{i}^{e}+{\color{red}C_{im}\Phi_{m}}\\
\frac{\partial\mathcal{F}^{e}}{\partial\Phi_{m}} & ={\color{brown}D_{mn}^{e}\phi_{n}}-b_{i}^{e}+{\color{red}C_{mi}A_{i}}
\end{align*}

\end_inset

 其中
\begin_inset Formula 
\begin{align*}
{\color{blue}K_{ij}^{e}} & =\int_{\Omega^{e}}\left[\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf N_{j}^{e}\right)-i\omega\sigma\sbf N_{i}^{e}\cdot\sbf N_{j}^{e}\right]\dd{\Omega}\\
b_{i}^{e} & =\int_{\Omega^{e}}\sbf J_{0\text{ex}}e^{-i\varphi}\cdot\sbf N_{i}^{e}\dd{\Omega}\\
{\color{red}C_{im}^{e}=C_{mi}^{e}} & =\int_{\Omega^{e}}\nabla\cdot(L_{m}^{e}\sigma\sbf N_{i}^{e})\dd{\Omega}\\
{\color{brown}D_{mn}^{e}} & =\int_{\Omega^{e}}\frac{i}{\omega}(\nabla L_{n}^{e})\cdot\sigma(\nabla L_{m}^{e})\dd{\Omega}
\end{align*}

\end_inset

最后得到矩阵方程
\begin_inset Formula 
\begin{equation}
\left[\begin{array}{cc}
[{\color{brown}D_{mn}^{e}}] & [{\color{red}C_{mj}^{e}}]\\{}
[{\color{red}C_{in}^{e}}] & [{\color{blue}K_{ij}^{e}}]
\end{array}\right]\left\{ \begin{array}{c}
\left\{ \Phi_{n}\right\} \\
\left\{ A_{j}\right\} 
\end{array}\right\} =\left\{ \begin{array}{c}
0\\
\left\{ b_{i}^{e}\right\} 
\end{array}\right\} .\label{eq:harmonic}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
暂态磁场
\end_layout

\begin_layout Standard
如果将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

直接代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl4.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\begin{align*}
\nabla\cdot\sigma\left(\nabla\Phi+\frac{\partial\sbf A}{\partial t}\right) & =0\\
\nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right) & =\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}+\sbf J_{\text{ex}}+\sigma\left(-\nabla\Phi-\frac{\partial\sbf A}{\partial t}\right)
\end{align*}

\end_inset

其中
\begin_inset Formula $\sbf M_{0}$
\end_inset

为零外加磁场下，永磁材料中的磁化强度。
\end_layout

\begin_layout Remark
这里使用了电磁场方程和永磁体的本构关系，即 
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A,\quad\sbf E=-\nabla\phi-\frac{\partial\sbf A}{\partial t}
\]

\end_inset

以及
\begin_inset Formula 
\begin{align*}
 & \nabla\times\sbf H=\sbf J_{\text{ex}}+\sigma\sbf E\\
 & \sbf B=\mu_{0}\mu_{r}\sbf H+\mu_{0}\sbf M_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\Phi=\frac{\partial W}{\partial t}$
\end_inset

 可以得到
\begin_inset Formula 
\begin{align}
 & \nabla\cdot\sigma\frac{\partial}{\partial t}\left(\nabla W+\sbf A\right)=0,\label{eq:tot-div}\\
 & \nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right)=\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}+\sbf J_{\text{ex}}-\sigma\frac{\partial}{\partial t}\left(\nabla W+\sbf A\right)\nonumber 
\end{align}

\end_inset

使用高斯定理，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:tot-div"
plural "false"
caps "false"
noprefix "false"

\end_inset

又等价于
\begin_inset Formula 
\[
\sigma\frac{\partial}{\partial t}\left(\nabla W+\sbf A\right)=0,\quad\text{on}\quad\Gamma
\]

\end_inset


\end_layout

\begin_layout Standard
分别以
\begin_inset Formula $\sbf N_{i}$
\end_inset

和
\begin_inset Formula $L_{m}^{e}$
\end_inset

作为加权函数，计算对应的残差可以得到
\begin_inset Formula 
\begin{align*}
R^{e}(\sbf N_{i}^{e}) & =\int_{\Omega^{e}}\sbf N_{i}^{e}\cdot\left[\nabla\times\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right){\color{red}-\frac{1}{\mu_{r}}\nabla\times\sbf M_{0}}-\sbf J_{\text{ex}}+\sigma\frac{\partial}{\partial t}\left(\nabla W+\sbf A\right)\right]\dd{\Omega}\\
 & \quad+{\color{cyan}\int_{\Gamma^{e}}\sbf N_{i}^{e}\cdot\frac{1}{\mu_{r}}\left(\sbf e_{n}\times\sbf M_{0}\right)\dd{\Gamma}}\\
 & \stackrel{\text{IBP}}{=}\int_{\Omega^{e}}\Big[{\color{blue}(\nabla\times\sbf N_{i}^{e})\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right)}-\sbf N_{i}^{e}\cdot\sbf J_{\text{ex}}\\
 & \quad-\frac{1}{\mu_{r}}\sbf M_{0}\cdot(\nabla\times\sbf N_{i}^{e})+{\color{brown}\sbf N_{i}^{e}\cdot\sigma\frac{\partial}{\partial t}\nabla W}+{\color{magenta}\sbf N_{i}^{e}\cdot\sigma\frac{\partial}{\partial t}\sbf A}\Big]\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Remark
这里使用了公式
\begin_inset Formula 
\begin{align*}
 & -\nabla\cdot\left(\sbf M_{0}\times\sbf N_{i}^{e}\right)={\color{red}-\left(\nabla\times\sbf M_{0}\right)\cdot\sbf N_{i}^{e}}+\left(\nabla\times\sbf N_{i}^{e}\right)\cdot\sbf M_{0}\\
 & -\int\dd{\Omega}\nabla\cdot\left(\sbf M_{0}\times\sbf N_{i}^{e}\right)=-\int\dd{\Gamma}\sbf e_{n}\cdot\left(\sbf M_{0}\times\sbf N_{i}^{e}\right)=-{\color{cyan}\int\dd{\Gamma}\sbf N_{i}^{e}\cdot\left(\sbf e_{n}\times\sbf M_{0}\right)}
\end{align*}

\end_inset

并添加了
\begin_inset Formula ${\color{cyan}\int_{\Gamma^{e}}\cdots\dd{\Gamma}}$
\end_inset

用来抵消边界上的面积分项。
\end_layout

\begin_layout Standard
类似地，
\begin_inset Formula 
\begin{align*}
R^{e}(\sbf L_{m}^{e}) & =-\int_{\Omega^{e}}\left[L_{m}^{e}\nabla\cdot\sigma\frac{\partial}{\partial t}(\nabla W+\sbf A)\right]\dd{\Omega}+\int_{\Gamma^{e}}\sbf e_{n}\cdot\left(L_{m}^{e}\sigma\frac{\partial}{\partial t}(\nabla W+\sbf A)\right)\dd{\Gamma}\\
 & \stackrel{\text{IBP}}{=}\int_{\Omega^{e}}\Big[{\color{red}\nabla L_{m}^{e}\cdot\sigma\frac{\partial}{\partial t}\nabla W}+{\color{brown}\nabla L_{m}^{e}\cdot\sigma\frac{\partial}{\partial t}\sbf A}\dd{\Omega}
\end{align*}

\end_inset

作展开 
\begin_inset Formula $\sbf A=\sbf N_{i}^{e}A_{i}$
\end_inset

，
\begin_inset Formula $W=L_{m}^{e}W_{m}$
\end_inset

，代入上述方程可得
\begin_inset Formula 
\begin{align*}
R^{e}(\sbf N_{i}^{e}) & ={\color{blue}K_{ij}^{e}}\,A_{j}-b_{i}^{e}+{\color{brown}C_{im}^{e}}\frac{\partial W_{m}}{\partial t}+{\color{magenta}M_{ij}^{e}}\frac{\partial A_{j}}{\partial t}\\
R^{e}(L_{m}^{e}) & ={\color{red}D_{mn}^{e}}\frac{\partial W_{n}}{\partial t}+{\color{brown}C_{mj}^{e}}\frac{\partial A_{j}}{\partial t}
\end{align*}

\end_inset

其中
\begin_inset Formula 
\begin{align*}
K_{ij}^{e} & =\int_{\Omega^{e}}\left[{\color{blue}(\nabla\times\sbf N_{i}^{e})\cdot\frac{1}{\mu_{0}\mu_{r}}\left(\nabla\times\sbf A\right)}\right]\dd{\Omega}\\
b_{i}^{e} & =\int_{\Omega^{e}}\left[\sbf N_{i}^{e}\cdot\sbf J_{\text{ex}}+\frac{1}{\mu_{r}}\sbf M_{0}\cdot(\nabla\times\sbf N_{i}^{e})\right]\dd{\Omega}\\
C_{im}^{e}=C_{mi}^{e} & =\int_{\Omega^{e}}{\color{brown}\sigma\nabla L_{m}^{e}\cdot\sbf N_{i}^{e}}\dd{\Omega}\\
M_{ij}^{e} & =\int_{\Omega^{e}}{\color{magenta}\sigma\sbf N_{i}^{e}\cdot\sbf N_{j}^{e}}\dd{\Omega}\\
D_{mn}^{e} & =\int_{\Omega^{e}}{\color{red}\sigma\left(\nabla L_{m}^{e}\cdot\nabla L_{n}^{e}\right)}\dd{\Omega}
\end{align*}

\end_inset

最后可以得到两个矩阵方程
\begin_inset Formula 
\begin{align*}
 & \{R^{e}(\sbf N_{i}^{e})\}=[{\color{blue}K_{ij}^{e}}]\{A_{j}\}-\{b_{i}^{e}\}+[{\color{brown}C_{im}^{e}}]\frac{\partial\{W_{m}\}}{\partial t}+[{\color{magenta}M_{ij}^{e}}]\frac{\partial\{A_{j}\}}{\partial t}=\{0\}\\
 & \{R^{e}(L_{m}^{e})\}=[{\color{red}D_{mn}^{e}}]\frac{\partial\{W_{n}\}}{\partial t}+[{\color{brown}C_{mj}^{e}}]\frac{\partial\{A_{j}\}}{\partial t}=\{0\}
\end{align*}

\end_inset

整理之后可得
\begin_inset Formula 
\[
\left[\begin{array}{cc}
[0] & [0]\\{}
[0] & [{\color{blue}K_{ij}^{e}}]
\end{array}\right]\left\{ \begin{array}{c}
\{W_{n}\}\\
\{A_{j}\}
\end{array}\right\} +\left[\begin{array}{cc}
[{\color{red}D_{mn}^{e}}] & [{\color{brown}C_{mj}^{e}}]\\{}
[{\color{brown}C_{in}^{e}}] & [{\color{magenta}M_{ij}^{e}}]
\end{array}\right]\frac{\partial}{\partial t}\left\{ \begin{array}{c}
\{W_{n}\}\\
\{A_{j}\}
\end{array}\right\} =\left\{ \begin{array}{c}
\{0\}\\
\{b_{i}^{e}\}
\end{array}\right\} 
\]

\end_inset

将时间微分离散化
\begin_inset Formula 
\[
\left[\begin{array}{cc}
[0] & [0]\\{}
[0] & [{\color{blue}K_{ij}^{e}}]
\end{array}\right]\left\{ \begin{array}{c}
\{W_{n}\}\\
\{A_{j}\}
\end{array}\right\} +\left[\begin{array}{cc}
[{\color{red}D_{mn}^{e}}] & [{\color{brown}C_{mj}^{e}}]\\{}
[{\color{brown}C_{in}^{e}}] & [{\color{magenta}M_{ij}^{e}}]
\end{array}\right]\frac{1}{\Delta t}\left\{ \begin{array}{c}
\{W_{n}^{t+\Delta t}\}-\{W_{n}\}\\
\{A_{j}^{t+\Delta t}\}-\{A_{j}\}
\end{array}\right\} =\left\{ \begin{array}{c}
\{0\}\\
\{b_{i}^{e}\}
\end{array}\right\} 
\]

\end_inset

最后得到
\begin_inset Formula 
\begin{align*}
 & \Bigg(\left[\begin{array}{cc}
[0] & [0]\\{}
[0] & [{\color{blue}K_{ij}^{e}}]
\end{array}\right]+\frac{1}{\Delta t}\left[\begin{array}{cc}
[{\color{red}D_{mn}^{e}}] & [{\color{brown}C_{mj}^{e}}]\\{}
[{\color{brown}C_{in}^{e}}] & [{\color{magenta}M_{ij}^{e}}]
\end{array}\right]\Bigg)\left\{ \begin{array}{c}
\{W_{n}^{t+\Delta t}\}\\
\{A_{j}^{t+\Delta t}\}
\end{array}\right\} \\
 & \qquad=\left\{ \begin{array}{c}
\{0\}\\
\{b_{i}^{e}\}
\end{array}\right\} +\frac{1}{\Delta t}\left[\begin{array}{cc}
[{\color{red}D_{mn}^{e}}] & [{\color{brown}C_{mj}^{e}}]\\{}
[{\color{brown}C_{in}^{e}}] & [{\color{magenta}M_{ij}^{e}}]
\end{array}\right]\left\{ \begin{array}{c}
\{W_{n}\}\\
\{A_{j}\}
\end{array}\right\} 
\end{align*}

\end_inset


\end_layout

\begin_layout Chapter
有限元下计算电磁力
\end_layout

\begin_layout Section
Levi–Civita 符号
\end_layout

\begin_layout Standard
ref：
\begin_inset CommandInset href
LatexCommand href
name "Levi-Civita符号"
target "https://www.zhihu.com/question/445700749"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $\varepsilon^{123}=1$
\end_inset

，上标相同则为零，交换两个指标出负号。有等式：
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{def}=\left[\begin{array}{ccc}
\delta^{ad} & \delta^{ae} & \delta^{af}\\
\delta^{bd} & \delta^{be} & \delta^{bf}\\
\delta^{cd} & \delta^{ce} & \delta^{cf}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Enumerate
特殊情况一：单个指标求和，
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{aef}=\left[\begin{array}{ccc}
1 & 0 & 0\\
0 & \delta^{be} & \delta^{bf}\\
0 & \delta^{ce} & \delta^{cf}
\end{array}\right]=\left[\begin{array}{cc}
\delta^{be} & \delta^{bf}\\
\delta^{ce} & \delta^{cf}
\end{array}\right]=\delta^{be}\delta^{cf}-\delta^{bf}\delta^{ce}
\]

\end_inset


\end_layout

\begin_layout Enumerate
特殊情况二：双指标求和，
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{dbc}=\left[\begin{array}{ccc}
\delta^{ad} & 0 & 0\\
0 & 1 & 0\\
0 & 0 & 1
\end{array}\right]=\delta^{ad}
\]

\end_inset


\end_layout

\begin_layout Section
虚功法计算磁力
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:virtualforce"

\end_inset


\end_layout

\begin_layout Standard
假设导线中的电流从 
\begin_inset Formula $0$
\end_inset

 开始，在时间
\begin_inset Formula $t$
\end_inset

的时候达到 
\begin_inset Formula $I$
\end_inset

。那么在这个过程中，导线中存储的此能为：
\begin_inset Formula 
\begin{equation}
\mathcal{U}=-\int_{0}^{t}\mathcal{E}I\dd{t'}=-\int_{0}^{t}\frac{\dd{\Psi}}{\dd{t'}}I\dd{t'}=\int_{0}^{\Psi}I\dd{\Psi}.\label{eq:x6.1}
\end{equation}

\end_inset


\begin_inset Formula $\mathcal{E}$
\end_inset

螺旋与磁通成右手螺旋。
\end_layout

\begin_layout Standard
此外通过场源关系，磁能也可以表示成：
\begin_inset Formula 
\[
\mathcal{U}=\int_{\Omega}\left[\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right]\dd{\Omega}
\]

\end_inset

是用与线性和非线性情况，不包括永磁体材料。
\end_layout

\begin_layout Standard
根据磁能还可以定义 磁共能（coenergy）：
\begin_inset Formula 
\[
\mathcal{U}_{\text{co}}=I\Psi-\mathcal{U}=\int_{0}^{I}\Psi\dd{I'}
\]

\end_inset

在坐标平面上，具有明显的几何意义；
\begin_inset Formula $\mathcal{U}$
\end_inset

 和 
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

 分别对应 
\begin_inset Formula $I$
\end_inset

–
\begin_inset Formula $\Psi$
\end_inset

 曲线两侧的面积。
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

 同样可以用场表示成
\begin_inset Formula 
\[
\mathcal{U}_{\text{co}}=\int_{\Omega}\sbf H\cdot\sbf B\dd{\Omega}-\mathcal{U}=\int_{\Omega}\left(\int_{0}^{H}\sbf B\cdot\dd{\sbf H'}\right)\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Standard
根据使用 磁能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 还是 磁共能 
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

的计算思路，还有取 
\begin_inset Formula $\Psi$
\end_inset

 或 
\begin_inset Formula $I$
\end_inset

 作为 
\begin_inset Formula $x$
\end_inset

 之外的独立变量，可以得到磁力的四种表达式：
\begin_inset Formula 
\begin{align*}
F & =-\frac{\partial\mathcal{U}\left(\Psi,x\right)}{\partial x}\\
 & =-\frac{\partial\mathcal{U}\left(I,x\right)}{\partial x}+I\frac{\partial\Psi\left(I,x\right)}{\partial x}\\
 & =\frac{\partial\mathcal{U}_{\text{co}}\left(\Psi,x\right)}{\partial x}-\Psi\frac{\partial I\left(\Psi,x\right)}{\partial x}\\
 & =\frac{\partial\mathcal{U}_{\text{co}}\left(I,x\right)}{\partial x}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
磁能的磁场表示形式：
\begin_inset Formula 
\begin{align}
\mathcal{U} & =\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\dd{\Omega},\nonumber \\
\mathcal{U}_{\text{co}} & =\sum_{e}\int_{\Omega^{e}}\left[\sbf H\cdot\sbf B-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right]\dd{\Omega}.\label{eq:fem-uco}
\end{align}

\end_inset


\end_layout

\begin_layout Section
计算磁力
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:calc-magforce"

\end_inset


\end_layout

\begin_layout Standard
本节中的计算 与 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:virtualforce"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的理论不尽相同；在这里把 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 当成唯一的独立变量，计算电能的变分。
\end_layout

\begin_layout Standard
在有限元框架下，通过场的形式，将磁能表示成：
\begin_inset Formula 
\begin{align}
\mathcal{U} & =\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\dd{\Omega},\label{eq:fem-energy}
\end{align}

\end_inset

节点 
\begin_inset Formula $\alpha$
\end_inset

 上的磁力，表示成 磁能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 对节点 
\begin_inset Formula $\alpha$
\end_inset

 的坐标的偏导数：
\begin_inset Formula 
\[
\sbf F_{\alpha}=-\frac{\partial\mathcal{U}}{\partial\sbf r_{\alpha}}
\]

\end_inset

考虑到积分测度 
\begin_inset Formula $\dd{\Omega}=\dd{x}\dd{y}\dd{z}=\det[J]\dd{\xi}\dd{\eta}\dd{\zeta}$
\end_inset

，记 
\begin_inset Formula $\dd{\hat{\Omega}}=\dd{\xi}\dd{\eta}\dd{\zeta}$
\end_inset

，则根据磁共能式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:fem-uco"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\frac{\partial\det[J]}{\partial\sbf r_{\alpha}}-\left(\sbf H\cdot\frac{\partial\sbf B}{\partial\sbf r_{\alpha}}\right)\det[J]\right]\dd{\hat{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Remark
这里的变分理解为：
\end_layout

\begin_layout Enumerate
一方面节点坐标的改变，会影响到积分测度；
\end_layout

\begin_layout Enumerate
另一方面，会影响到空间场 
\begin_inset Formula $\sbf B$
\end_inset

 的分布；这里还是用了积分下求导的公式：
\begin_inset Formula 
\[
\frac{\dd}{\dd{x}}\int_{0}^{f\left(x\right)}g\left(x'\right)\dd{x'}=f'(x)g\left[f(x)\right]
\]

\end_inset

在这里就是
\begin_inset Formula 
\[
\frac{\partial}{\partial\sbf r_{\alpha}}\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\quad\Rightarrow\quad\sbf H(\sbf B)\cdot\frac{\partial\sbf B}{\partial\sbf r_{\alpha}}
\]

\end_inset


\end_layout

\begin_layout Subsection
二维电磁力计算
\end_layout

\begin_layout Standard
二维磁场 
\begin_inset Formula $\sbf B$
\end_inset

 的矢势 
\begin_inset Formula $\sbf A$
\end_inset

 只有
\begin_inset Formula $z$
\end_inset

 分量，
\begin_inset Formula $\sbf B$
\end_inset

 可以表示为：
\begin_inset Formula 
\begin{equation}
\sbf B=\frac{\partial A_{z}}{\partial y}\sbf e_{x}-\frac{\partial A_{z}}{\partial x}\sbf e_{y}=A_{i}\frac{\partial N_{i}^{e}}{\partial y}\sbf e_{x}-A_{i}\frac{\partial N_{i}^{e}}{\partial x}\sbf e_{y}=A_{i}\left(\nabla N_{i}^{e}\times\sbf e_{z}\right).\label{eq:xl6.10}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
也可以写出磁场的分量形式：
\begin_inset Formula 
\begin{equation}
B_{j}=A_{i}\varepsilon_{jk\ell}\partial_{k}N_{i}^{e}\left(\hat{e}_{z}\right)_{\ell}=\varepsilon_{jk3}\,A_{i}\partial_{k}N_{i}^{e}\label{eq:xl6.11}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\hat{e}_{z}$
\end_inset

 是
\begin_inset Formula $z$
\end_inset

方向坐标基矢，所以 
\begin_inset Formula $\left(\hat{e}_{z}\right)_{\ell}=\delta_{z\ell}$
\end_inset

。
\end_layout

\begin_layout Enumerate
上式中的 
\begin_inset Formula $\partial_{k}N_{i}^{e}$
\end_inset

 可以在等参坐标系下表示为：
\begin_inset Formula 
\[
\partial_{k}N_{i}^{e}=J_{k\ell}^{-1}\hat{\partial}_{\ell}N_{i}^{e}.
\]

\end_inset

其中 
\begin_inset Formula $\hat{\partial}_{\ell}$
\end_inset

 表示等参坐标系下的偏导。
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

 稍作变换可以得到另一种形式，两边同乘 
\begin_inset Formula $\varepsilon_{jk3}$
\end_inset

 得：
\begin_inset Formula 
\begin{align*}
 & \varepsilon_{jk3}A_{i}\partial_{k}N_{i}^{e}=B_{j}\\
\Rightarrow\quad & \varepsilon_{jk3}\;\varepsilon_{jk3}A_{i}\partial_{k}N_{i}^{e}=\varepsilon_{jk3}\;B_{j}
\end{align*}

\end_inset

即
\begin_inset Formula 
\begin{equation}
A_{i}\partial_{k}N_{i}^{e}=\varepsilon_{jk3}\,B_{j}\label{eq:xl6.11-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
使用
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

 （数字表示不同指标）得
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha m}} & =A_{i}\varepsilon_{jk3}\;{\color{blue}\frac{\partial J_{k\ell}^{-1}}{\partial r_{\alpha m}}}\;\hat{\partial}_{\ell}N_{i}^{e}=A_{i}\varepsilon_{jk3}\;{\color{blue}\left(-\partial_{k}L_{\alpha}^{e}\;J_{m\ell}^{-1}\right)}\;\hat{\partial}_{\ell}N_{i}^{e}\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(A_{i}J_{m\ell}^{-1}\hat{\partial}_{\ell}N_{i}^{e}\right)\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(A_{i}\partial_{m}N_{i}^{e}\right)\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(\varepsilon_{nm3}\,B_{n}\right)\\
 & =-\left(\delta_{jn}\delta_{km}-\delta_{jm}\delta_{kn}\right){\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{n}\\
 & =-{\color{blue}\left(\partial_{m}L_{\alpha}^{e}\right)}B_{j}+\delta_{jm}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{k}
\end{align*}

\end_inset

合并两项的贡献，给出节点 
\begin_inset Formula $\alpha$
\end_inset

 所受磁力的 
\begin_inset Formula $m$
\end_inset

 分量，
\begin_inset Formula 
\[
F_{\alpha m}=\sum_{e}\int_{\Omega^{e}}\left\{ -\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-H_{j}\left[\delta_{jm}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{k}-{\color{blue}\left(\partial_{m}L_{\alpha}^{e}\right)}B_{j}\right]\right\} \dd{\Omega}
\]

\end_inset

写成矢量形式，节点 
\begin_inset Formula $\alpha$
\end_inset

 上所受的力是，
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-\sbf H\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)+\left(\sbf H\cdot\sbf B\right)\nabla L_{\alpha}^{e}\right]\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Example
线性情况下 
\begin_inset Formula $\sbf B=\mu_{0}\mu_{r}\sbf H$
\end_inset

，节点 
\begin_inset Formula $\alpha$
\end_inset

 所受的力化简为：
\begin_inset Formula 
\begin{align*}
\sbf F_{\alpha} & =\sum_{e}\int_{\Omega^{e}}\left[-\frac{\sbf H\cdot\sbf B}{2}\nabla L_{\alpha}^{e}-\sbf H\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)+\left(\sbf H\cdot\sbf B\right)\nabla L_{\alpha}^{e}\right]\dd{\Omega}\\
 & =\sum_{e}\int_{\Omega^{e}}\left[\frac{-\sbf B\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)}{\mu_{0}\mu_{r}}+\frac{\sbf B\cdot\sbf B}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}\right]\dd{\Omega}
\end{align*}

\end_inset

代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.10"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到
\begin_inset Formula 
\begin{equation}
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[\frac{A_{\beta}A_{\gamma}}{\mu_{0}\mu_{r}}\left(\nabla L_{\alpha}^{e}\cdot\nabla N_{\beta}^{e}\right)\nabla N_{\gamma}^{e}-A_{\beta}A_{\gamma}\frac{\nabla N_{\beta}^{e}\cdot\nabla N_{\gamma}^{e}}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}\right]\dd{\Omega}\label{eq:xl6.12}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
三维电磁力计算
\end_layout

\begin_layout Standard
三维磁场可以用棱边性函数表示为：
\begin_inset Formula 
\[
\sbf B=(\nabla\times\sbf N_{\alpha}^{e})A_{\alpha}=2A_{\alpha}\ell_{\alpha}^{e}\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}
\]

\end_inset

其中 
\begin_inset Formula $\sbf N_{\alpha}^{e}=(L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}-L_{\alpha(2)}^{e}\times\nabla L_{\alpha(1)}^{e})\ell_{\alpha}^{e}$
\end_inset

。分量形式为：
\begin_inset Formula 
\begin{align*}
B_{j} & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\;{\color{blue}\partial_{k}L_{\alpha(1)}^{e}}\;{\color{brown}\partial_{m}L_{\alpha(2)}^{e}}\\
 & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\;{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}\hat{\partial}_{g}L_{\alpha(2)}^{e}}
\end{align*}

\end_inset

上式中的 Jacobi 矩阵和四面体棱边的长度 
\begin_inset Formula $\ell_{i}^{e}$
\end_inset

 均为 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 的函数，但在用棱边形函数进行有限元计算时，待求的独立变量应该是 
\begin_inset Formula $A_{i}\ell_{i}$
\end_inset

 而不是 
\begin_inset Formula $A_{i}$
\end_inset

；每条边上的 
\begin_inset Formula $A_{i}\ell_{i}$
\end_inset

 不变，也是保证四面体某个面上磁通不变的条件。因此在计算 
\begin_inset Formula $B_{j}$
\end_inset

 偏导的时候，只需计算 Jacobi 矩阵对 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 的导数。利用式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

可得
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha h}} & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left({\color{blue}\frac{\partial J_{kf}^{-1}}{\partial r_{\alpha h}}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}}+{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}\frac{J_{mg}^{-1}}{\partial r_{\alpha h}}}\right){\color{brown}\hat{\partial}_{g}L_{\alpha(2)}^{e}}\\
 & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}(-)\left({\color{blue}\partial_{k}L_{\alpha}^{e}\;J_{hf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}}+{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}\partial_{m}L_{\alpha}^{e}\;J_{hg}^{-1}}\right){\color{brown}\hat{\partial}_{g}L_{\alpha(2)}^{e}}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left(\partial_{k}L_{\alpha}^{e}\;{\color{red}J_{hf}^{-1}\hat{\partial}_{f}}\;L_{\alpha(1)}^{e}\;{\color{red}J_{mg}^{-1}\hat{\partial}_{g}}\;L_{\alpha(2)}^{e}+{\color{red}J_{kf}^{-1}\hat{\partial}_{f}}\;L_{\alpha(1)}^{e}\;\partial_{m}L_{\alpha}^{e}\;{\color{red}J_{hg}^{-1}\hat{\partial}_{g}}\;L_{\alpha(2)}^{e}\right)\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left(\partial_{k}L_{\alpha}^{e}\;{\color{red}\partial_{h}}\;L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}\;L_{\alpha(2)}^{e}+{\color{red}\partial_{k}}\;L_{\alpha(1)}^{e}\;\partial_{m}L_{\alpha}^{e}\;{\color{red}\partial_{h}}\;L_{\alpha(2)}^{e}\right)\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\partial_{k}L_{\alpha}^{e}\left({\color{red}\partial_{h}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}L_{\alpha(2)}^{e}-{\color{red}\partial_{m}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{h}}L_{\alpha(2)}^{e}\right)
\end{align*}

\end_inset

代入恒等式
\begin_inset Formula 
\[
{\color{red}\partial_{h}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}L_{\alpha(2)}^{e}-{\color{red}\partial_{m}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{h}}L_{\alpha(2)}^{e}=\varepsilon_{bhm}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\quad\text{反对称}
\]

\end_inset

得到
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha h}} & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\partial_{k}L_{\alpha}^{e}\;\varepsilon_{bhm}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\left[\begin{array}{cc}
\delta_{jb} & \delta_{jh}\\
\delta_{kb} & \delta_{kh}
\end{array}\right]\partial_{k}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\left[\partial_{h}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{j}-\delta_{jh}\partial_{k}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{k}\right]\\
 & =-B_{j}\;\partial_{h}L_{\alpha}^{e}+\delta_{jh}\;B_{k}\,\partial_{k}L_{\alpha}^{e}
\end{align*}

\end_inset

写成矢量形式是
\begin_inset Formula 
\[
\left[\begin{array}{c}
\partial/\partial r_{\alpha1}\\
\partial/\partial r_{\alpha2}\\
\partial/\partial r_{\alpha3}
\end{array}\right]B_{j}=-B_{j}\nabla L_{\alpha}^{e}+\sbf e_{j}\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)
\]

\end_inset

因此虚功法的磁力表达式
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-\sbf H\cdot\frac{\partial\sbf B}{\partial\sbf r_{k}}\right]
\]

\end_inset

给出
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}+\nabla L_{\alpha}^{e}\left(\sbf H\cdot\sbf B\right)-\left(\sbf B\cdot\nabla L_{\alpha}^{e}\right)\sbf H\right]
\]

\end_inset

对于线性材料 
\begin_inset Formula $\sbf B=\mu\mu_{0}\sbf H$
\end_inset

，结果化简为：
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\frac{\sbf B\cdot\sbf B}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}-\frac{\sbf B\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)}{\mu_{0}\mu_{r}}\right]
\]

\end_inset


\end_layout

\begin_layout Section
计算电力？？
\end_layout

\begin_layout Standard
理论公式：
\begin_inset Formula 
\[
\mathcal{U}=\int_{0}^{Q}V\dd{Q'}=\int_{\Omega}\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\dd{\Omega}
\]

\end_inset


\begin_inset Formula 
\[
\int_{0}^{\Psi}I\dd{\Psi'}\quad\Leftrightarrow\quad\int_{0}^{Q}V\dd{Q'}
\]

\end_inset

所以 
\begin_inset Formula $\Psi$
\end_inset

 对应 
\begin_inset Formula $Q$
\end_inset

，
\begin_inset Formula $I$
\end_inset

 对应 
\begin_inset Formula $V$
\end_inset

。
\begin_inset Formula 
\begin{align*}
\mathcal{U}_{\text{co}} & =VQ-\mathcal{U}=\int_{0}^{V}Q\dd{V'}\\
 & =\int_{\Omega}\left(\int_{0}^{E}\sbf D\cdot\dd{\sbf E'}\right)\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
类似磁力的计算 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:calc-magforce"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\mathcal{U}=\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\det[J]\dd{\hat{\Omega}}
\]

\end_inset

节点 
\begin_inset Formula $\alpha$
\end_inset

 上的电力，表示成 电能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 对节点 
\begin_inset Formula $\alpha$
\end_inset

 的坐标的偏导数：
\begin_inset Formula 
\[
\sbf F_{\alpha}=-\frac{\partial\mathcal{U}}{\partial\sbf r_{\alpha}}
\]

\end_inset


\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right){\color{blue}\frac{\partial\det[J]}{\partial\sbf r_{\alpha}}}-\left(\sbf E\cdot{\color{brown}\frac{\partial\sbf D}{\partial\sbf r_{\alpha}}}\right)\det[J]\right]\dd{\hat{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Example
代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\partial\det[J]/\partial r_{\alpha j}=\det[J]\,\partial_{j}L_{\alpha}^{e}$
\end_inset

，第一项的贡献表示为，
\begin_inset Formula 
\[
f_{\alpha,1}=-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right){\color{blue}\partial_{j}L_{\alpha}^{e}\,\det[J]}\dd{\hat{\Omega}}
\]

\end_inset

顺便改写积分测度：
\begin_inset Formula 
\[
\sbf f_{\alpha,1}=-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\nabla L_{\alpha}^{e}\,\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
再考虑第二项的贡献
\begin_inset Formula 
\begin{equation}
-\left(\sbf E\cdot{\color{brown}\frac{\partial\sbf D}{\partial\sbf r_{\alpha}}}\right)\det[J]\quad\Rightarrow\quad-E_{i}\frac{\partial D_{i}}{\partial r_{\alpha j}}\,\det[J]\label{eq:e-force2}
\end{equation}

\end_inset

右边是对应的分量形式。电位移
\begin_inset Formula $\sbf D$
\end_inset

 依赖于 电场强度 
\begin_inset Formula $\sbf E$
\end_inset

：
\begin_inset Formula 
\[
\frac{\partial D_{i}}{\partial r_{\alpha j}}=\mathcal{T}_{ik}\frac{\partial E_{k}}{\partial r_{\alpha j}},\quad\mathcal{T}_{ik}=\frac{\partial D_{i}}{\partial E_{k}}
\]

\end_inset


\begin_inset Formula $T_{ik}$
\end_inset

 是材料的介电张量。写出 
\begin_inset Formula $\sbf E=-\nabla\phi$
\end_inset

 的分量形式：
\end_layout

\begin_layout Example
\begin_inset Formula 
\[
E_{k}=-\partial_{k}\phi=-{\color{blue}\partial_{k}N_{\beta}^{e}\;\phi_{\beta}}
\]

\end_inset

其中 
\begin_inset Formula $\phi_{\beta}$
\end_inset

 是节点上的电势，为常数。将对等参坐标的偏导数记作 
\begin_inset Formula $\hat{\partial}_{k}=\left(\frac{\partial}{\partial\xi},\frac{\partial}{\partial\eta},\frac{\partial}{\partial\zeta}\right)$
\end_inset

，考虑雅可比矩阵得
\begin_inset Formula 
\begin{equation}
E_{k}=-{\color{brown}J_{k\ell}^{-1}}\;{\color{blue}\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\label{eq:elec-field}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
其中 
\begin_inset Formula $\hat{\partial}_{\ell}N_{\beta}^{e}$
\end_inset

 表示等参坐标系下的偏导，此时形函数 
\begin_inset Formula $N_{\beta}^{e}$
\end_inset

 使用等参坐标表示，不包含节点 
\begin_inset Formula $\alpha$
\end_inset

 的几何坐标。
\end_layout

\begin_layout Enumerate
对节点 
\begin_inset Formula $\alpha$
\end_inset

 坐标的依赖 只包含在 
\begin_inset Formula ${\color{brown}J_{k\ell}^{-1}}$
\end_inset

 中。
\end_layout

\begin_layout Standard
代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

 （数字表示不同指标）得
\begin_inset Formula 
\begin{align*}
\frac{\partial E_{k}}{\partial r_{\alpha j}} & =-({\color{brown}-\partial_{k}L_{\alpha}^{e}\;J_{j\ell}^{-1}})\,{\color{blue}\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\\
 & =\partial_{k}L_{\alpha}^{e}\;{\color{blue}J_{j\ell}^{-1}\,\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\\
 & ={\color{blue}(-E_{j})}\;\partial_{k}L_{\alpha}^{e}
\end{align*}

\end_inset

将此结果代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e-force2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 得
\begin_inset Formula 
\[
-E_{i}\frac{\partial D_{i}}{\partial r_{\alpha j}}=-E_{i}\mathcal{T}_{ik}\left(-E_{j}\right)\partial_{k}L_{\alpha}^{e}
\]

\end_inset

写成矢量形式是
\begin_inset Formula 
\[
f_{\alpha,2}=\sbf E\;\left(\sbf E\cdot\mathcal{T}\cdot\nabla L_{\alpha}^{e}\right)\dd{\Omega}
\]

\end_inset

其中 
\begin_inset Formula $\mathcal{T}=\partial D/\partial E$
\end_inset

，是材料的介电张量。
\end_layout

\begin_layout Standard
综合两项的贡献得到：
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\nabla L_{\alpha}^{e}+\sbf E\;\left(\sbf E\cdot\mathcal{T}\cdot\nabla L_{\alpha}^{e}\right)\right]\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Subsection
eeee
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
F_{\alpha}=\sum_{\langle e\rangle}\int_{\Omega^{e}}\left[\big(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\big)\nabla L_{\alpha}^{e}-\sbf E\,(\sbf D\cdot\nabla L_{\alpha}^{e})\right]\dd{\Omega}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
F_{\alpha} & =\sum_{\langle e\rangle}\int_{\Omega^{e}}\frac{\sbf E\cdot\sbf D}{2}\nabla L_{\alpha}^{e}\dd{\Omega}-\sum_{\langle e\rangle}\int_{\Omega^{e}}\left(\sbf D\cdot\nabla L_{\alpha}^{e}\right)\sbf E\dd{\Omega}\\
 & +\sum_{\langle e\rangle}\int_{\Omega^{e}}\frac{\sbf B\cdot\sbf H}{2}\nabla L_{\alpha}^{e}\dd{\Omega}-\sum_{\langle e\rangle}\int_{\Omega^{e}}\left(\sbf B\cdot\nabla L_{\alpha}^{e}\right)\sbf H\dd{\Omega}
\end{align*}

\end_inset

在上面的表达式中，
\begin_inset Formula $\langle e\rangle$
\end_inset

 表示仅对最近邻单元进行求和。将目标区域的节点上的电磁力进行求和，可以得到该目标区域所受到的总的电磁力。
\end_layout

\begin_layout Standard
另外根据力矩的计算公式，也可以得到各个节点上所受到的力矩，即
\begin_inset Formula 
\[
\sbf T_{k}=\left(\sbf r_{k}-\sbf r_{0}\right)\times\sbf F_{k}
\]

\end_inset

 其中 
\begin_inset Formula $\sbf r_{0}$
\end_inset

 为转轴的坐标，对目标区域的节点上的力矩进行求和，同样可以得到总的电磁力矩。
\end_layout

\begin_layout Section
麦克斯韦协强张量法
\end_layout

\begin_layout Standard
麦克斯韦协强张量法通常用来计算被真空包围的磁体在磁场作用下受到的合力。从洛伦兹力表达式
\begin_inset Formula 
\begin{equation}
\sbf F=\int_{V}\sbf J\times\sbf B\dd{V}\label{eq:xl6.18}
\end{equation}

\end_inset

出发，根据
\begin_inset Formula $\nabla\times\sbf B=\mu_{0}\sbf J$
\end_inset

 和 
\begin_inset Formula $\nabla\cdot\sbf B=\sbf0$
\end_inset

，可以得到
\begin_inset Formula 
\[
\sbf F=\int_{V}\frac{(\nabla\times\sbf B)\times\sbf B+(\nabla\cdot\sbf B)\sbf B}{\mu_{0}}\dd{V}
\]

\end_inset

分量形式下
\begin_inset Formula 
\begin{equation}
F_{a}=\int_{V}\frac{-(\partial_{a}B_{b})B_{b}+(\partial_{b}B_{a})B_{b}+B_{a}(\partial_{b}B_{b})}{\mu_{0}}\dd{V}\label{eq:xl6.19}
\end{equation}

\end_inset

在没有电场的情况下，麦克斯韦协强张量定义为
\begin_inset Formula 
\begin{equation}
\mathcal{T}_{ab}=\frac{1}{\mu_{0}}B_{a}B_{b}-\frac{B_{c}B_{c}}{2\mu_{0}}\delta_{ab}\label{eq:xl6.20}
\end{equation}

\end_inset

 计算可以得到
\begin_inset Formula 
\begin{align*}
\partial_{b}\mathcal{T}_{ab} & =\frac{1}{\mu_{0}}\partial_{b}(B_{a}B_{b})-\frac{\partial_{b}(B_{c}B_{c})}{2\mu_{0}}\delta_{ab}\\
 & =\frac{(\partial_{b}B_{a})B_{b}+B_{a}(\partial_{b}B_{b})}{\mu_{0}}-\frac{(\partial_{a}B_{b})B_{b}}{\mu_{0}}
\end{align*}

\end_inset

所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.19"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的洛伦兹力可以用麦克斯韦协强张量表示为：
\begin_inset Formula 
\[
F_{a}=\int_{V}\dd{V}\partial_{b}\,\mathcal{T}_{ab}=\oint_{S}\dd{S}\sbf n_{b}\,\mathcal{T}_{ab}
\]

\end_inset


\end_layout

\begin_layout Standard
存在表面电流的情况下
\begin_inset Formula 
\[
\sbf F=\iint_{S}\sbf J_{s}\times\frac{\sbf B^{+}+\sbf B^{-}}{2}\dd{S}
\]

\end_inset

根据边界条件 
\begin_inset Formula $\sbf n\cdot(\sbf B^{+}+\sbf B^{-})=0$
\end_inset

以及
\begin_inset Formula $\sbf n\times(\sbf B^{+}-\sbf B^{-})=\mu_{0}\sbf J_{s}$
\end_inset

，可以将洛伦兹力分量形式用磁场表示为
\begin_inset Formula 
\[
F_{a}=\iint_{s}\frac{2n_{b}B_{a}^{+}B_{b}^{-}-n_{a}B_{b}^{+}B_{b}^{+}+n_{a}B_{b}^{-}B_{b}^{-}-2n_{b}B_{a}^{-}B_{b}^{+}}{2\mu_{0}}\dd{S}
\]

\end_inset

另外根据式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.20"
plural "false"
caps "false"
noprefix "false"

\end_inset

所示的麦克斯韦协强张量的定义可得
\begin_inset Formula 
\[
n_{b}\left(\mathcal{T}_{ab}^{+}-\mathcal{T}_{ab}^{-}\right)=\frac{2n_{b}B_{a}^{+}B_{b}^{-}-n_{a}B_{b}^{+}B_{b}^{+}+n_{a}B_{b}^{-}B_{b}^{-}-2n_{b}B_{a}^{-}B_{b}^{+}}{2\mu_{0}}
\]

\end_inset

因此可以将表面电流下的洛伦兹力表示为
\begin_inset Formula 
\[
F_{a}=\iint_{S}n_{b}\left(\mathcal{T}_{ab}^{+}-\mathcal{T}_{ab}^{-}\right)\dd{S}
\]

\end_inset


\end_layout

\begin_layout Section
等价电流法
\end_layout

\begin_layout Standard
根据洛伦兹力的表达式，在静磁学中，一个局域电流分布受到的力为：
\begin_inset Formula 
\[
\sbf F=\int_{V}\sbf J(\sbf r')\times\sbf B(\sbf r')\dd[3]{r'}
\]

\end_inset

假设电流分布局域在原点附近，将外磁场在原点附近展开：
\begin_inset Formula $\sbf B(\sbf r')=\sbf B(\sbf0)+(\sbf r'\cdot\nabla)\sbf B(\sbf0)+\cdots$
\end_inset

，然后代入上式可得
\begin_inset Formula 
\[
F_{a}=\varepsilon_{abc}\int_{V}J_{b}(B_{c}+r_{d}^{\prime}\partial_{d}B_{c})\dd[3]{r'}
\]

\end_inset

第一项包含
\begin_inset Formula $\int\sbf J(\sbf r')\dd[3]{r'}$
\end_inset

，其值等于零（全空间稳恒电流守恒方程）；另外由等式
\begin_inset Formula $\int_{V}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})\dd[3]{r'}=0$
\end_inset

，可知 
\begin_inset Formula $\int_{V}J_{b}r_{c}^{\prime}\dd[3]{r'}$
\end_inset

为反对称张量。所以
\begin_inset Formula 
\begin{align*}
F_{a} & =\frac{\varepsilon_{abc}}{2}\int_{V}\left(J_{b}r_{d}^{\prime}-J_{d}r_{b}^{\prime}\right)\partial_{d}B_{c}\dd[3]{r'}\\
 & =\frac{-\varepsilon_{abc}}{2}\int_{V}\varepsilon_{bed}\left(\sbf J\times r^{\prime}\right)_{e}\partial_{d}B_{c}\dd[3]{r'}
\end{align*}

\end_inset

定义
\begin_inset Formula 
\[
\sbf m=\frac{1}{2}\int_{V}\sbf r'\times\sbf J(\sbf r')\dd[3]{r'}
\]

\end_inset

并根据
\begin_inset Formula $\nabla\cdot\sbf B=0$
\end_inset

，最后可以得到
\begin_inset Formula 
\[
F_{a}=m_{b}\partial_{a}B_{b}
\]

\end_inset

如果材料里面有连续分布的磁化强度，则合力的表达式为：
\begin_inset Formula 
\[
\sbf F=\int_{\Omega}\sbf M\cdot(\nabla\sbf B)\dd{\Omega}
\]

\end_inset

其中
\begin_inset Formula $\nabla\sbf B$
\end_inset

的结果是一个张量。
\end_layout

\begin_layout Remark
\begin_inset Formula $\int_{V}\dd[3]{r'}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})=\oint_{S}\dd{\sbf S}\cdot(\sbf Jr_{b}^{\prime}r_{c}^{\prime})=0$
\end_inset

（考虑到电流分布是局域的），另一方面
\begin_inset Formula 
\begin{align*}
\int_{V}\partial_{a}(J_{a}r_{b}^{\prime}r_{c}^{\prime})\dd[3]{r'} & =\int_{V}\left[(\partial_{a}J_{a})r_{b}^{\prime}r_{c}^{\prime}+J_{b}r_{c}^{\prime}+J_{c}r_{b}^{\prime}\right]\dd[3]{r'}\\
 & =\int_{V}(J_{b}r_{c}^{\prime}+J_{c}r_{b}^{\prime})\dd[3]{r'}=0
\end{align*}

\end_inset

所以说
\begin_inset Formula $\int_{V}\,J_{b}r_{c}^{\prime}\dd[3]{r'}$
\end_inset

是反对称的。
\end_layout

\begin_layout Remark
若
\begin_inset Formula $W_{c}=\varepsilon_{abc}U_{a}V_{b}=\sbf U\times\sbf V$
\end_inset

，定义
\begin_inset Formula 
\[
T_{ab}=\varepsilon_{ab{\color{blue}c}}W_{{\color{blue}c}}
\]

\end_inset

根据
\begin_inset Formula $\varepsilon_{abc}\varepsilon_{abd}=\delta_{cd}$
\end_inset

，逆变换是
\begin_inset Formula 
\[
W_{{\color{blue}d}}=\varepsilon_{ab{\color{blue}d}}T_{ab}
\]

\end_inset

则根据迷向张量恒等式 
\begin_inset Formula $\varepsilon_{abc}\varepsilon_{ade}=\delta_{bd}\delta_{ce}-\delta_{be}\delta_{cd}$
\end_inset

可得
\begin_inset Formula 
\[
T_{de}=\varepsilon_{dea}\varepsilon_{abc}U_{b}V_{c}=U_{d}V_{e}-U_{e}V_{d}
\]

\end_inset


\end_layout

\begin_layout Chapter
三维空间曲面
\end_layout

\begin_layout Section
仿射变换，局域坐标系
\end_layout

\begin_layout Standard
约定：全局坐标表示为 笛卡尔坐标系中的 
\begin_inset Formula $\sbf r=\left(x,y,z\right)$
\end_inset

 ，二维平面局域坐标表示为 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

。对于三维空间中的曲面上的点，其全局坐标和局域坐标的变换关系为：
\begin_inset Formula 
\begin{align*}
\sbf r & =S.\sbf R+\sbf r_{n}\\
\sbf R & =S^{-1}.\left(\sbf r-\sbf r_{n}\right)
\end{align*}

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是第
\begin_inset Formula $n$
\end_inset

个单元的参考点。也可以写成
\begin_inset Formula 
\[
\left[\begin{array}{c}
\sbf r\\
1
\end{array}\right]=\left[\begin{array}{cc}
S & \sbf r_{n}\\
0 & 1
\end{array}\right]\left[\begin{array}{c}
\sbf R\\
1
\end{array}\right]
\]

\end_inset

其中坐标变换矩阵
\begin_inset Formula $S$
\end_inset

为
\begin_inset Formula 
\[
S_{ij}=\sbf d_{i}\cdot{\color{blue}\sbf e_{j}}.
\]

\end_inset

式中 
\begin_inset Formula $\sbf d_{i}$
\end_inset

 表示笛卡尔坐标基矢， 
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 表示局域坐标基矢。因此，
\begin_inset Formula $S$
\end_inset

 的每一列就是 
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 在原坐标系中的分量表示。这里的约定是
\begin_inset Formula 
\[
\left[e_{1}\right]=\left(\begin{array}{c}
e_{1,x}=\sbf d_{1}\cdot\sbf e_{1}\\
e_{1,y}=\sbf d_{2}\cdot\sbf e_{1}\\
e_{1,z}=\sbf d_{3}\cdot\sbf e_{1}
\end{array}\right),\quad\sbf e_{1}\,\text{分量形式为列向量}.
\]

\end_inset

用黑体表示矢量，普通字体表示矢量的分量数组，拉丁下标表示具体的分量。
\end_layout

\begin_layout Corollary
当 
\begin_inset Formula $\sbf d_{i}$
\end_inset

，
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 都是单位正交基时，
\begin_inset Formula $S$
\end_inset

 是正交矩阵，即
\begin_inset Formula 
\[
S^{-1}=S^{T},\quad S_{ij}^{-1}=S_{ji}.
\]

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{c}
X\\
Y\\
Z
\end{array}\right]=\left[\begin{array}{c}
e_{1}^{T}\\
e_{2}^{T}\\
e_{3}^{T}
\end{array}\right].\left([r]-[r_{n}]\right)
\]

\end_inset

其中 
\begin_inset Formula $[r]$
\end_inset

，
\begin_inset Formula $[r_{n}]$
\end_inset

 均为列向量。在局域坐标的小范围中，如果将 
\begin_inset Formula $\sbf e_{i}$
\end_inset

 当作常矢量，则有
\begin_inset Formula 
\begin{align*}
 & \dd{X}=[e_{1}^{T}]\cdot\dd{[r]}\\
 & \dd{Y}=[e_{2}^{T}]\cdot\dd{[r]}\\
 & \dd{Z}=[e_{3}^{T}]\cdot\dd{[r]}
\end{align*}

\end_inset

从几何直观上也是可以理解的。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
Frenet 标架
\end_layout

\begin_layout Standard
ref: 
\begin_inset CommandInset href
LatexCommand href
name "Frenet 标架"
target "https://zhuanlan.zhihu.com/p/144787656"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Frenet 公式：
\begin_inset Formula 
\[
\frac{\dd}{\dd{s}}\left[\begin{array}{c}
T(s)\\
N[s]\\
B[s]
\end{array}\right]=\left[\begin{array}{ccc}
0 & \kappa(s) & 0\\
-\kappa(s) & 0 & \tau(s)\\
0 & -\tau(s) & 0
\end{array}\right]\left[\begin{array}{c}
T(s)\\
N[s]\\
B[s]
\end{array}\right]
\]

\end_inset

以弧长作为参数：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf r(t)$
\end_inset

 变成了 
\begin_inset Formula $\sbf r(s)$
\end_inset

。
\end_layout

\begin_layout Enumerate
单位切向量 
\begin_inset Formula $\sbf T$
\end_inset

：
\begin_inset Formula 
\[
\sbf T(s)=\frac{\dd{\sbf r}}{\dd{s}}=\frac{\dd{\sbf r}/\dd{t}}{\dd{s}/\dd{t}}=\frac{\sbf v}{\abs{\sbf v}}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
曲率 
\begin_inset Formula $\kappa$
\end_inset

：描述了单位切向量随着曲线的改变，也可以看成曲线偏离直线的变化率：
\begin_inset Formula 
\[
\kappa(s)=\frac{\dd{T}}{\dd{s}}=\frac{1}{\abs{\sbf v}}\frac{\dd{\sbf T}}{\dd{t}}
\]

\end_inset


\end_layout

\begin_layout Enumerate
主法向量 
\begin_inset Formula $\sbf N$
\end_inset

：指向曲线转动的方向。定义在在 
\begin_inset Formula $\kappa\neq0$
\end_inset

 的点
\begin_inset Formula 
\[
\sbf N=\frac{1}{\kappa}\frac{\dd{T}}{\dd{s}}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
次法向量：垂直于 
\begin_inset Formula $\sbf T$
\end_inset

–
\begin_inset Formula $\sbf N$
\end_inset

平面
\begin_inset Formula 
\[
\sbf B=\sbf T\times\sbf N.
\]

\end_inset


\end_layout

\begin_layout Enumerate
挠率：
\begin_inset Formula $\tau=-\frac{\dd{\sbf B}}{\dd{s}}\cdot\sbf N$
\end_inset

，代表曲线偏离 
\begin_inset Formula $\sbf T$
\end_inset

–
\begin_inset Formula $\sbf N$
\end_inset

平面的速率。和 曲线的主单位法向量
\end_layout

\begin_layout Standard
三维曲面的边界为一空间曲线，计算其边界的主法线方向需要曲率 
\begin_inset Formula $\kappa\neq0$
\end_inset

；但是在线性单元的近似下，边界上的曲率为零，所以无法计算其主法线方向。
\end_layout

\begin_layout Section
曲面上的泊松方程
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:curve3D"

\end_inset


\end_layout

\begin_layout Standard
三维曲面上的泊松方程为
\begin_inset Formula 
\[
-\nabla_{t}\cdot\epsilon\cdot\nabla_{t}\phi=\rho
\]

\end_inset


\begin_inset Formula $\nabla_{t}$
\end_inset

 表示沿着曲面切平面的梯度。对应的有限元方程中的系数矩阵为
\begin_inset Formula 
\[
K_{ij}^{e}=\int_{\Omega^{e}}\nabla_{t}N_{i}^{e}\cdot\epsilon\cdot\nabla_{t}N_{j}^{e}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Example
三维中的曲面的四边形单元上的雅可比矩阵（对于某一确定单元 
\begin_inset Formula $e$
\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[J\right] & =\left[{\color{blue}\begin{array}{c}
\frac{\partial\sbf r}{\partial\xi}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}
\end{array}}\right]=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\vspace{1ex}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{ccc}
\frac{\partial N_{i}^{e}}{\partial\xi}x_{i} & \frac{\partial N_{i}^{e}}{\partial\xi}y_{i} & \frac{\partial N_{i}^{e}}{\partial\xi}z_{i}\vspace{1ex}\\
\frac{\partial N_{i}^{e}}{\partial\eta}x_{i} & \frac{\partial N_{i}^{e}}{\partial\eta}y_{i} & \frac{\partial N_{i}^{e}}{\partial\eta}z_{i}
\end{array}\right],\quad\text{重复指标求和}\\
 & =\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]
\end{align*}

\end_inset

从雅可比矩阵可以定义出局域坐标的三个方向（正交归一基）
\begin_inset Formula 
\begin{align*}
 & \sbf e_{1}=\frac{\partial\sbf r}{\partial\xi}/\abs{\frac{\partial\sbf r}{\partial\xi}}\\
 & \sbf e_{3}=\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}/\abs{\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}}\\
 & \sbf e_{2}=\sbf e_{3}\times\sbf e_{1}
\end{align*}

\end_inset

注意曲面上的两切线
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}$
\end_inset

，
\begin_inset Formula $\frac{\partial\sbf r}{\partial\eta}$
\end_inset

 不一定是正交的；网格剖分时单元面积不为零，保证了 
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}\neq0$
\end_inset

。
\end_layout

\begin_layout Example
使用局域坐标系 
\begin_inset Formula $T^{ab}=T^{ab}\left(\sbf e_{1},\sbf e_{2},\sbf e_{3}\right)$
\end_inset

 ，实现全局坐标 
\begin_inset Formula $\sbf r=\left(x,y,z\right)$
\end_inset

 到二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

的转换
\begin_inset Formula 
\[
\sbf R=T^{ab}\cdot\sbf r
\]

\end_inset


\begin_inset Formula 
\[
\sbf R=S^{-1}.\left(\sbf r-\sbf r_{n}\right),\quad S^{-1}=\left[\begin{array}{c}
\sbf e_{1}^{T}\\
\sbf e_{2}^{T}\\
\sbf e_{3}^{T}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是局域原点的全局坐标。系数矩阵计算需要的形函数的切向梯度可以在二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

下计算（参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi2"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial X} & \frac{\partial N_{2}^{e}}{\partial X} & \frac{\partial N_{3}^{e}}{\partial X} & \frac{\partial N_{4}^{e}}{\partial X}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial Y} & \frac{\partial N_{2}^{e}}{\partial Y} & \frac{\partial N_{3}^{e}}{\partial Y} & \frac{\partial N_{4}^{e}}{\partial Y}
\end{array}\right] & =\left[\begin{array}{cc}
\frac{\partial\xi}{\partial X} & \frac{\partial\eta}{\partial X}\vspace{1ex}\\
\frac{\partial\xi}{\partial Y} & \frac{\partial\eta}{\partial Y}
\end{array}\right]\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\vspace{1ex}\\
\frac{\partial X}{\partial\eta} & \frac{\partial Y}{\partial\eta}
\end{array}\right]^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\partial\sbf r}{\partial\xi}\cdot\sbf e_{1} & \frac{\partial\sbf r}{\partial\xi}\cdot\sbf e_{2}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}\cdot\sbf e_{1} & \frac{\partial\sbf r}{\partial\eta}\cdot\sbf e_{2}
\end{array}\right]^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left(\left[\begin{array}{c}
\frac{\partial\sbf r}{\partial\xi}\vspace{1ex}\\
\frac{\partial\sbf r}{\partial\eta}
\end{array}\right]\left[\begin{array}{cc}
\sbf e_{1} & \sbf e_{2}\end{array}\right]\right)^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\vspace{1ex}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]
\end{align*}

\end_inset

其中使用了
\begin_inset Formula $\dd{r}=\dd{X}\sbf e_{1}+\dd{Y}\sbf e_{2}$
\end_inset

，即矢径的微元等于切矢的微元。
\end_layout

\begin_layout Section
约定和总结
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r_{j}$
\end_inset

 表示全局坐标，三维空间自由度 
\begin_inset Formula $j\in\left\{ 1,2,3\right\} $
\end_inset

，
\begin_inset Formula $\partial_{j}$
\end_inset

 表示对全局坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\overline{x}_{\alpha}$
\end_inset

 表示有限元中的采样点（node）， 
\begin_inset Formula $\alpha\in{1,2,\cdots,N}$
\end_inset

（希腊字母），一阶三角形单元
\begin_inset Formula $3$
\end_inset

个，二阶三角形
\begin_inset Formula $6$
\end_inset

个；一阶四边形
\begin_inset Formula $4$
\end_inset

个 等等。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $x_{p}^{\prime}$
\end_inset

 表示单元中二维平面的局域物理坐标 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

，
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{p}^{\prime}$
\end_inset

 表示对局域坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\xi_{p}$
\end_inset

 表示将二维局域坐标再变换到等参坐标 
\begin_inset Formula $\left(\xi_{1},\xi_{2}\right)$
\end_inset

，或记作
\begin_inset Formula $\left(\xi,\eta\right)$
\end_inset

，平面自由度 
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

（拉丁字母）；
\begin_inset Formula $\hat{\partial}_{p}$
\end_inset

 表示对
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

求导。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
全局物理坐标对等参坐标的雅可比行列式
\begin_inset Formula 
\begin{equation}
J_{pj}=\hat{\partial}_{p}{\color{blue}r_{j}}=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\vspace{1ex}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}
\end{array}\right]=\hat{\partial}_{p}\,{\color{blue}N_{\alpha}\,\overline{x}_{\alpha j}},\quad[2,3]\label{eq:jacobi9}
\end{equation}

\end_inset

其中 ，对于选定的单元 
\begin_inset Formula $N_{\alpha}$
\end_inset

 形式已知，
\begin_inset Formula $\overline{x}_{\alpha j}$
\end_inset

 是节点坐标为已知常量，所以 
\begin_inset Formula $J_{pj}$
\end_inset

 可以直接求得，维数是 
\begin_inset Formula $2\times3$
\end_inset

。
\end_layout

\begin_layout Enumerate
局域物理坐标的三个单位正交基
\begin_inset Formula 
\begin{align*}
\sbf e_{1} & =J_{1\cdot}/\abs{J_{1\cdot}},\quad\text{点表示取整列}\\
\sbf e_{3} & =J_{1\cdot}\times J_{2\cdot}/\abs{J_{1\cdot}\times J_{2\cdot}},\\
\sbf e_{2} & =\sbf e_{3}\times\sbf e_{1}.
\end{align*}

\end_inset

之所以按此序列构造，是为了保证 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

 是相互垂直的。求出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi9"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $J_{pj}$
\end_inset

，即可求出每个单元所属的 
\begin_inset Formula $\sbf e_{j}$
\end_inset

。可以把 
\begin_inset Formula $\left\{ \sbf e_{j}\right\} $
\end_inset

的分量写成数组形式（矩阵）。分量数组用普通字体表示，将 
\begin_inset Formula $[e_{i}]$
\end_inset

分别填入
\color blue
每列
\color inherit

\begin_inset Formula 
\begin{equation}
E_{ij}=\left[\begin{array}{ccc}
\vdots & \vdots & \vdots\\
e_{1} & e_{2} & e_{3}\\
\vdots & \vdots & \vdots
\end{array}\right],\quad[3,3]\label{eq:unitVector}
\end{equation}

\end_inset

则 指标
\begin_inset Formula $1$
\end_inset

索引 基矢的分量，指标
\begin_inset Formula $2$
\end_inset

索引 基矢的编号。
\end_layout

\begin_layout Enumerate
局域几何坐标 对 等参坐标的 雅可比矩阵：
\begin_inset Formula 
\begin{equation}
L_{pq}=\hat{\partial}_{p}x_{q}^{\prime}=\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\vspace{1ex}\\
\frac{\partial X}{\partial\eta} & \frac{\partial Y}{\partial\eta}
\end{array}\right]=J_{pj}\,E_{jq},\quad[2,2]\label{eq:jacobi3}
\end{equation}

\end_inset


\begin_inset Formula $p,q\in\{1,2\}$
\end_inset

， 
\begin_inset Formula $J$
\end_inset

 和 
\begin_inset Formula $E$
\end_inset

 分别在 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi9"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:unitVector"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中求出。注意使用 
\begin_inset Formula $E$
\end_inset

 时只需取前
\begin_inset Formula $[2\times2]$
\end_inset

。
\end_layout

\begin_layout Enumerate
形函数 对 局域几何坐标 的梯度
\begin_inset Formula 
\[
{\color{blue}\partial_{p}^{\prime}}\,N_{\alpha}={\color{blue}L_{pq}^{-1}\,\hat{\partial}_{q}}N_{\alpha},\quad[2,N]
\]

\end_inset

其中
\begin_inset Formula $N$
\end_inset

是节点的数目，
\begin_inset Formula $L^{-1}$
\end_inset

是 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi3"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的逆。至此，
\begin_inset Formula $\nabla_{t}N_{i}^{e}$
\end_inset

已经求出。
\end_layout

\begin_layout Enumerate
计算均在
\begin_inset Formula $\xi\text{–}\eta$
\end_inset

参数坐标平面进行，即坐标变换步骤为 全局系的曲面
\begin_inset Formula $\Rightarrow$
\end_inset

局域系的平面
\begin_inset Formula $\Rightarrow$
\end_inset

参数系平面。最后需要在 
\begin_inset Formula $\xi$
\end_inset

–
\begin_inset Formula $\eta$
\end_inset

 参数系平面，用高斯积分法计算积分：
\begin_inset Formula 
\[
\iint_{\Omega^{\prime e}}F\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{X}\dd{Y}=\sum_{i=1}^{m}F\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset

与平直面元的区别是，现在 
\begin_inset Formula $\det[J]$
\end_inset

=
\begin_inset Formula $\frac{\partial(X,Y)}{\partial\left(\xi,\eta\right)}$
\end_inset

 在每个高斯点上可以不同。
\begin_inset Formula $\det[J]$
\end_inset

 在几何上等于局域基矢 
\begin_inset Formula $\{\frac{\partial\sbf r}{\partial\xi},\frac{\partial\sbf r}{\partial\eta}\}$
\end_inset

 架设的四边形的面积；在程序中此面积可直接用 
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}$
\end_inset

 计算。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Chapter
介电屏蔽条件
\end_layout

\begin_layout Section
介电屏蔽边界条件
\end_layout

\begin_layout Standard
电介质在外加电场
\begin_inset Formula $\sbf E_{0}$
\end_inset

下会产生极化电荷，假设电场线垂直于介质界面，根据
\begin_inset Formula $\sbf D$
\end_inset

法向在界面连续：
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\sbf E_{0}=\epsilon\sbf E\quad\Rightarrow\quad{\color{blue}\sbf E=\frac{\epsilon_{0}}{\epsilon}\sbf E_{0}}\\
 & \Delta\sbf E=\sbf E-\sbf E_{0}=\left(\frac{\epsilon_{0}}{\epsilon}-1\right)\sbf E_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate

\color blue
即极化电荷产生与原外加电场反向的电场，削弱原场
\color inherit
。
\begin_inset Formula $\epsilon$
\end_inset

越大，效果越明显，理想导体可以理解为 
\begin_inset Formula $\epsilon\to\infty$
\end_inset

。
\end_layout

\begin_layout Enumerate
在理想导体的情况下，电场被完全屏蔽，导体内部无电场。在高
\begin_inset Formula $\epsilon$
\end_inset

材料的情况下，会残余一丢丢电场。
\end_layout

\begin_layout Enumerate
在理想导体的情况下，电场线是垂直于导体表面的；在高
\begin_inset Formula $\epsilon$
\end_inset

材料的情况下，材料表面的
\begin_inset Formula $\sbf E$
\end_inset

会与法向
\begin_inset Formula $\sbf n$
\end_inset

 略有偏离。
\end_layout

\begin_layout Example
一种理解方式
\end_layout

\begin_layout Enumerate
在高
\begin_inset Formula $\epsilon$
\end_inset

介质表面求解电势分布，在界面附近，假设 
\begin_inset Formula $\sbf D_{n}$
\end_inset

 变化不大，在 
\begin_inset Formula $\nabla^{2}$
\end_inset

算子中忽略法向的贡献，只关注切向的变化。
\end_layout

\begin_layout Enumerate
表面微元上的面电荷密度是 
\begin_inset Formula $\sbf n\cdot\sbf D$
\end_inset

，
\begin_inset Formula 
\[
\sbf n\cdot\sbf D=-\nabla_{t}\cdot\left(d\,\epsilon_{0}\epsilon_{r}\cdot\nabla_{t}\phi\right)
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
另一种推导方式
\end_layout

\begin_layout Standard
选取适当的曲面坐标系，令曲线微元的表达式形如
\begin_inset Formula 
\[
\dd{\ell_{1}}=1\dd{u_{1}},\quad\dd{\ell_{2}}=1\dd{u_{2}},\quad\dd{\ell_{3}}=d\dd{u_{3}},
\]

\end_inset

假设介质中没有自由电荷，即 
\begin_inset Formula $\nabla\cdot\sbf D=0$
\end_inset

，按照公式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:shI.30"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\nabla_{n}D_{n}=0
\]

\end_inset

假设 
\begin_inset Formula $d$
\end_inset

 非常小，为一薄层，
\begin_inset Formula $u_{3}$
\end_inset

变化单位长度
\begin_inset Formula $1$
\end_inset

，对应的 
\begin_inset Formula $\dd{\ell_{3}}=d$
\end_inset

 在实际中仍然是很小的尺度，把导数近似为差商；并认为由于高
\begin_inset Formula $\epsilon_{r}$
\end_inset

介质的屏蔽作用，薄层另一侧
\begin_inset Formula $\sbf D\approx0$
\end_inset

，给出
\begin_inset Formula 
\[
\nabla_{n}D_{n}\Rightarrow\frac{\sbf n\cdot\sbf D-\sbf n\cdot0}{1}=\sbf n\cdot\sbf D
\]

\end_inset

因此有
\begin_inset Formula 
\begin{equation}
\nabla_{t}\cdot\left(d\epsilon_{0}\sbf E_{t}\right)+\sbf n\cdot\epsilon_{0}\sbf E=0\label{eq:screen}
\end{equation}

\end_inset


\color blue

\begin_inset Formula $\sbf n$
\end_inset

 是法线方向，从高
\begin_inset Formula $\epsilon_{r}$
\end_inset

介质指向低
\begin_inset Formula $\epsilon_{0}$
\end_inset

介质
\color inherit
，
\begin_inset Formula $\epsilon_{0}$
\end_inset

是低介电材料的常数。
\end_layout

\begin_layout Subsection
存在的问题
\end_layout

\begin_layout Enumerate
推导过程需要用到 分部积分/高斯公式，对于曲面，或者曲线上的场，公式是否仍然成立，正确的形式是什么。
\end_layout

\begin_layout Enumerate
对于封闭的边界，如封闭曲面，或者封闭曲线，找不到边界，该如何应用分部积分，或者高斯公式。
\end_layout

\begin_layout Section
例：介电屏蔽的解析解
\end_layout

\begin_layout Enumerate
开放空间的均匀介质
\begin_inset Formula $\epsilon_{3}$
\end_inset

中，有一导体球壳
\begin_inset Formula $\epsilon_{2}$
\end_inset

，内部电介常数为
\begin_inset Formula $\epsilon_{1}$
\end_inset

，厚度为
\begin_inset Formula $d$
\end_inset

；
\end_layout

\begin_layout Enumerate
空间中存在均匀电场
\begin_inset Formula $\sbf E_{0}$
\end_inset

，求空间电场分布。
\end_layout

\begin_layout Enumerate
选取球坐标系，
\begin_inset Formula $z$
\end_inset

轴正向同
\begin_inset Formula $\sbf E_{0}$
\end_inset

方向，到内外球壳的半径分别为 
\begin_inset Formula $R_{1}$
\end_inset

，
\begin_inset Formula $R_{2}$
\end_inset

；
\end_layout

\begin_layout Standard
从球壳内到外部，电势依次为 
\begin_inset Formula $1,2,3$
\end_inset

；全部定解条件为：
\begin_inset Formula 
\begin{align*}
 & \nabla^{2}\varphi_{1}=0,\quad\nabla^{2}\varphi_{2}=0,\quad\nabla^{2}\varphi_{3}=0.\\
 & r=0:\quad\varphi_{1}=0\\
 & r\to\infty:\quad\varphi_{3}\to-E_{0}R\cos\theta,\quad\text{渐近条件}
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align*}
 & r=R_{1}:\quad\varphi_{1}\left(R_{1}\right)=\varphi_{2}\left(R_{1}\right),\quad\left.\varepsilon_{1}\frac{\partial\varphi_{1}}{\partial r}\right|_{R_{1}}=\left.\varepsilon_{2}\frac{\partial\varphi_{2}}{\partial r}\right|_{R_{1}}\\
 & r=R_{2}:\quad\varphi_{2}\left(R_{2}\right)=\varphi_{3}\left(R_{2}\right),\quad\left.\varepsilon_{2}\frac{\partial\varphi_{1}}{\partial r}\right|_{R_{2}}=\left.\varepsilon_{3}\frac{\partial\varphi_{2}}{\partial r}\right|_{R_{2}}
\end{align*}

\end_inset

根据渐近条件，假设解的形式：
\begin_inset Formula 
\begin{align*}
 & \varphi_{1}\left(r\right)=\sum_{n=1}^{\infty}a_{n}r^{n}P_{n}\left(\cos\theta\right),\quad\text{电势零点约定为}0\\
 & \varphi_{2}\left(r\right)=\sum_{n=0}^{\infty}\left(b_{n}r^{n}+\frac{c_{n}}{r^{n+1}}\right)P_{n}\left(\cos\theta\right)\\
 & \varphi_{3}\left(r\right)=d_{0}-E_{0}r\cos\theta+\sum_{n=0}^{\infty}\frac{e_{n}}{r^{n+1}}P_{n}\left(\cos\theta\right)
\end{align*}

\end_inset

代入边界条件，边界条件1–2：
\begin_inset Formula 
\begin{align}
n=0:\quad & 0=b_{0}+\frac{c_{0}}{R_{1}},\quad\varepsilon_{2}\frac{-c_{0}}{R_{1}}=0\nonumber \\
n\ge1:\quad & a_{n}R_{1}^{2n+1}=b_{n}R_{1}^{2n+1}+c_{n}\label{eq:my1}\\
n\ge1:\quad & a_{n}R_{1}^{2n+1}=\frac{\varepsilon_{2}}{\varepsilon_{1}}\left(b_{n}R_{1}^{2n+1}+\frac{-(n+1)}{n}c_{n}\right)\nonumber 
\end{align}

\end_inset

容易看出
\begin_inset Formula 
\[
a_{0}=b_{0}=c_{0}=0
\]

\end_inset

边界条件2–3：
\begin_inset Formula 
\begin{align*}
n=0:\quad & d_{0}+\frac{e_{0}}{R_{2}}=0,\quad\epsilon_{3}\frac{-e_{0}}{R_{2}^{2}}=0\\
n=1:\quad & ,b_{1}R_{2}+\frac{c_{1}}{R_{2}^{2}}=-E_{0}R_{2}+\frac{e_{1}}{R_{2}^{2}},\quad b_{1}+\frac{-2c_{1}}{R_{2}^{3}}=\frac{\epsilon_{3}}{\epsilon_{2}}\left(-E_{0}+\frac{-2e_{1}}{R_{2}^{3}}\right)
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align}
n\ge2:\quad & b_{n}R_{2}^{2n+1}+c_{n}=e_{n}\label{eq:my2}\\
n\ge2:\quad & b_{n}R_{2}^{2n+1}+\frac{-\left(n+1\right)}{n}c_{n}=\frac{\epsilon_{3}}{\epsilon_{2}}\frac{-\left(n+1\right)}{n}e_{n}\nonumber 
\end{align}

\end_inset

容易看出
\begin_inset Formula 
\[
d_{0}=e_{0}=0
\]

\end_inset

联立
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my1"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:my2"
plural "false"
caps "false"
noprefix "false"

\end_inset

给出，当 
\begin_inset Formula $n\ge2$
\end_inset

时：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
equ = { an*R1^(2 n + 1) == bn*R1^(2 n + 1) + cn, an*R1^(2 n + 1) == 
\backslash
[CurlyEpsilon]2/
\backslash
[CurlyEpsilon]1 (bn* R1^(2 n + 1) + (-n - 1)/n cn), bn*R2^(2 n + 1) + cn
 == en, bn*R2^(2 n + 1) + (-n - 1)/ n cn == 
\backslash
[CurlyEpsilon]3/
\backslash
[CurlyEpsilon]2 ((-n - 1)/n en) }; Solve[equ, {an, bn, cn, en}]
\end_layout

\end_inset


\begin_inset Formula 
\[
a_{n}=0,\quad b_{n}=0,\quad c_{n}=0,\quad e_{n}=0,\quad n\ge2
\]

\end_inset

当
\begin_inset Formula $n=1$
\end_inset

时：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
equ = { a1*R1^3 == b1*R1^3 + c1, a1*R1^3 == 
\backslash
[Epsilon]2/
\backslash
[Epsilon]1 (b1*R1^3 + (-2) c1), b1*R2 + c1/R2^2 == -Subscript[
\backslash
[CapitalEpsilon], 0] R2 + e1/R2^2, b1 + (-2 c1)/ R2^3 == 
\backslash
[Epsilon]3/
\backslash
[Epsilon]2 (-Subscript[
\backslash
[CapitalEpsilon], 0] + (-2 e1)/R2^3) }; ans = First@Solve[equ, {a1, b1,
 c1, e1}] // Simplify; rule = {R2 -> Subscript[R, 2], R1 -> Subscript[R,
 1], 
\backslash
[Epsilon]2 -> Subscript[
\backslash
[Epsilon], 2], 
\backslash
[Epsilon]1 -> Subscript[
\backslash
[Epsilon], 1], 
\backslash
[Epsilon]3 -> Subscript[
\backslash
[Epsilon], 3]}; ans /.
 rule
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
 & a_{1}=-\frac{9R_{2}^{3}\epsilon_{2}\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & b_{1}=-\frac{3R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & c_{1}=\frac{3R_{1}^{3}R_{2}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\epsilon_{3}}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0},\\
 & e_{1}=\frac{R_{2}^{3}\left(R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(2\epsilon_{2}+\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)\right)}{2R_{1}^{3}\left(\epsilon_{1}-\epsilon_{2}\right)\left(\epsilon_{2}-\epsilon_{3}\right)+R_{2}^{3}\left(\epsilon_{1}+2\epsilon_{2}\right)\left(\epsilon_{2}+2\epsilon_{3}\right)}E_{0}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
简化情形
\end_layout

\begin_layout Standard
如果令 
\begin_inset Formula $\epsilon_{1}=\epsilon_{3}$
\end_inset

，即球壳内外具有相同的
\begin_inset Formula $\epsilon$
\end_inset

，则化简为：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(ans2 = Simplify[ans /.
 {
\backslash
[Epsilon]3 -> 
\backslash
[Epsilon]1}]) /.
 rule; (ans3 = Simplify[ ans2 /.
 {
\backslash
[Epsilon]2 -> (S + 
\backslash
[CapitalDelta]), 
\backslash
[Epsilon]1 -> (S 
\backslash
 - 
\backslash
[CapitalDelta])}]) /.
 rule
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
 & a_{1}=-\frac{9E_{0}R_{2}^{3}(S-\Delta)(\Delta+S)}{R_{2}^{3}\left(9S^{2}-\Delta^{2}\right)-8\Delta^{2}R_{1}^{3}},\\
 & b_{1}=-\frac{3E_{0}R_{2}^{3}(S-\Delta)(\Delta+3S)}{R_{2}^{3}\left(9S^{2}-\Delta^{2}\right)-8\Delta^{2}R_{1}^{3}},\\
 & c_{1}=\frac{6\Delta E_{0}R_{1}^{3}R_{2}^{3}(S-\Delta)}{8\Delta^{2}R_{1}^{3}+R_{2}^{3}\left(\Delta^{2}-9S^{2}\right)},\\
 & e_{1}=-\frac{2\Delta E_{0}R_{2}^{3}\left(R_{2}^{3}-R_{1}^{3}\right)(\Delta+3S)}{8\Delta^{2}R_{1}^{3}+R_{2}^{3}\left(\Delta^{2}-9S^{2}\right)},
\end{align*}

\end_inset

其中 
\begin_inset Formula $S=(\epsilon_{1}+\epsilon_{2})/2$
\end_inset

， 
\begin_inset Formula $\Delta=(\epsilon_{2}-\epsilon_{1})/2$
\end_inset

。
\end_layout

\begin_layout Standard
如果进一步取 
\begin_inset Formula $\delta=\epsilon_{1}/\epsilon_{2}\rightarrow0$
\end_inset

 的极限：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify[Normal@ Series[Values@ ans2 /.
 {
\backslash
[Epsilon]1 -> 
\backslash
[Delta]*
\backslash
[Epsilon]2}, {
\backslash
[Delta], 0, 1}] /.
 rule]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
a_{1} & =\frac{9\delta E_{0}R_{2}^{3}}{2R_{1}^{3}-2R_{2}^{3}},\\
b_{1} & =\frac{3\delta E_{0}R_{2}^{3}}{R_{1}^{3}-R_{2}^{3}},\quad c_{1}=\frac{3\delta E_{0}R_{1}^{3}R_{2}^{3}}{2\left(R_{1}^{3}-R_{2}^{3}\right)},\\
e_{1} & =\frac{1}{2}E_{0}R_{2}^{3}\left(\frac{3\delta\left(R_{1}^{3}+2R_{2}^{3}\right)}{R_{1}^{3}-R_{2}^{3}}+2\right)
\end{align*}

\end_inset

代入电势的表达式得到：
\begin_inset Formula 
\begin{align*}
 & \varphi_{1}\left(r\right)=a_{1}r\cos\theta\\
 & \varphi_{2}\left(r\right)=\left(b_{1}r+c_{1}\frac{1}{r^{2}}\right)\cos\theta\\
 & \varphi_{3}\left(r\right)=\left(-E_{0}r+e_{1}\frac{1}{r^{2}}\right)\cos\theta
\end{align*}

\end_inset

如果令
\begin_inset Formula $R_{2}=\left(1+t\right)R_{1}$
\end_inset

，展开到
\begin_inset Formula $\left(\delta^{1},t^{1}\right)$
\end_inset

和
\begin_inset Formula $\left(\delta^{1},t^{0}\right)$
\end_inset

阶的结果分别是
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Simplify[Normal@ Series[Values@ans2 /.
 {
\backslash
[Epsilon]1 -> 
\backslash
[Delta]*
\backslash
[Epsilon]2, R2 -> R1 (1 + t)} , {
\backslash
[Delta], 0, 1}, {t, 0, 0} ] /.
 rule]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
a_{1} & =-\frac{\delta E_{0}\left(2t^{2}+6t+3\right)}{2t}\approx-\frac{3\delta E_{0}(2t+1)}{2t},\\
b_{1} & =-\frac{\delta E_{0}\left(2t^{2}+6t+3\right)}{3t}\approx-\frac{\delta E_{0}(2t+1)}{t}\\
c_{1} & =-\frac{\delta E_{0}R_{1}^{3}\left(2t^{2}+6t+3\right)}{6t}\approx-\frac{\delta E_{0}R_{1}^{3}(2t+1)}{2t},\\
e_{1} & =\frac{E_{0}R_{1}^{3}\left(-3\delta+(6-20\delta)t^{2}+(2-12\delta)t\right)}{2t}\approx-\frac{E_{0}R_{1}^{3}(3\delta+2(6\delta-1)t)}{2t}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
电势和电场图像
\end_layout

\begin_layout Standard
电势的图像如下，可以看到中心处的电势接近于零。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
(*dielectric, radius*) 
\backslash
[Epsilon]1 = 1; 
\backslash
[Epsilon]2 = 500; R1 = 1; R2 = 1.06; R3 = 2; E0 = 10; (*potential coeffcients*)
 S = (
\backslash
[Epsilon]1 + 
\backslash
[Epsilon]2)/ 2; 
\backslash
[CapitalDelta] = (
\backslash
[Epsilon]2 - 
\backslash
[Epsilon]1)/2; a1 = -((9 E0*R2^3 (S - 
\backslash
[CapitalDelta]) (S + 
\backslash
[CapitalDelta]))/( R2^3 (9 S^2 - 
\backslash
[CapitalDelta]^2) - 8 
\backslash
[CapitalDelta]^2 R1^3)); b1 = -((3 E0*R2^3 (S - 
\backslash
[CapitalDelta]) (
\backslash
[CapitalDelta] + 3 S))/( R2^3 (9 S^2 - 
\backslash
[CapitalDelta]^2) - 8 
\backslash
[CapitalDelta]^2 R1^3)); c1 = (6 
\backslash
[CapitalDelta]*E0*R1^3*R2^3 (S - 
\backslash
[CapitalDelta]))/( 8 
\backslash
[CapitalDelta]^2*R1^3 + R2^3 (
\backslash
[CapitalDelta]^2 - 9 S^2)); e1 = -((2 
\backslash
[CapitalDelta]*E0* R2^3 (R2^3 - R1^3) (
\backslash
[CapitalDelta] + 3 S))/( 8 
\backslash
[CapitalDelta]^2*R1^3 + R2^3 (
\backslash
[CapitalDelta]^2 - 9 S^2))); (*electric potential*) potE[{r_, 
\backslash
[Theta]_, 
\backslash
[Phi]_}] := -Piecewise[{ {a1*r*Cos[
\backslash
[Theta]], 0 < r <= R1}, {(b1*r + c1/r^2)*Cos[
\backslash
[Theta]], R1 < r <= R2}, {(-E0*r + e1/r^2)*Cos[
\backslash
[Theta]], R2 < r} }]; fig1 = DensityPlot[ potE@ToSphericalCoordinates[{0,
 y, z}] , {y, -2, 2}, {z, -2, 2} , ColorFunction -> "Rainbow" , AspectRatio
 -> 1, ImageSize -> 165, PlotLegends -> Automatic ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/jieDianPingBi1.png
	scale 80

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
电势云图，外加电场
\begin_inset Formula $\sbf E=10\,\mathrm{V/m}$
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
电场强度
\end_layout

\begin_layout Standard
根据电势表达式和球坐标 梯度表达式可以求出电场强度的表达式：
\begin_inset Formula 
\[
\nabla\phi=\partial_{r}\phi\sbf e_{r}+\frac{1}{r}\partial_{\theta}\phi\sbf e_{\theta}+\frac{1}{r\sin\theta}\partial_{\theta}\phi\sbf e_{\phi}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
-\nabla\varphi_{1} & =-a_{1}\left(\cos\theta\sbf e_{r}-\sin\theta\sbf e_{\theta}\right)\\
-\nabla\varphi_{2} & =-\frac{1}{r^{3}}\left[\left(b_{1}r^{3}-2c_{1}\right)\cos\theta\sbf e_{r}-\left(b_{1}r^{3}+c_{1}\right)\sin\theta\sbf e_{\theta}\right]\\
-\nabla\varphi_{3} & =-\frac{1}{r^{3}}\left[-\left(E_{0}r^{3}+2e_{1}\right)\cos\theta\sbf e_{r}+\left(E_{0}r^{3}-e_{1}\right)\sin\theta\sbf e_{\theta}\right]
\end{align*}

\end_inset

电场强度
\begin_inset Formula $\sbf E$
\end_inset

在界面处的分布如下，可以看到中间的电场强度也接近于零。
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
vecE[{x_, y_, z_}] := Evaluate[Simplify@TransformedField[ "Spherical" ->
 "Cartesian", Simplify@ Grad[-potE[{r, 
\backslash
[Theta], 
\backslash
[Phi]}], {r, 
\backslash
[Theta], 
\backslash
[Phi]}, "Spherical"], {r, 
\backslash
[Theta], 
\backslash
[Phi]} -> {x, y, z}]]; fig2 = VectorPlot[ Rest@vecE@{10^-9, y, z} , {y,
 -1.2, 1.2}, {z, -1.2, 1.2} , VectorPoints -> {18, 18} , ImageSize -> Medium
 ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/jieDianPingBi2.png
	scale 80

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
电场强度在介质界面处的分布
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Section
Ritz方法
\end_layout

\begin_layout Standard
综上，当存在介电常数相差较大的两种材料，高
\begin_inset Formula $\epsilon$
\end_inset

的材料形成一个薄层。则在高
\begin_inset Formula $\epsilon$
\end_inset

壳的表面，应满足以下边界条件：
\begin_inset Formula 
\[
\sbf e_{n}\cdot\sbf D+\nabla_{t}\cdot\left(d\sbf D_{t}\right)=0,
\]

\end_inset

其中
\begin_inset Formula $d$
\end_inset

是界面薄层的厚度，
\begin_inset Formula $\sbf D=\epsilon\sbf E$
\end_inset

。
\end_layout

\begin_layout Example
考虑三维情形。设求解区域为
\begin_inset Formula $\Omega$
\end_inset

，
\begin_inset Formula $\Omega$
\end_inset

的边界曲面记作
\begin_inset Formula $\Gamma=\partial\Omega$
\end_inset

，
\begin_inset Formula $\Gamma$
\end_inset

的边界曲线记作
\begin_inset Formula $C=\partial\Gamma$
\end_inset

。通常情况下，静电场的泊松方程的泛函写作
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{e}\left(\phi^{e}\right) & =\frac{1}{2}\int_{\Omega^{e}}\left[(\nabla\phi^{e})\cdot\epsilon_{0}\cdot(\nabla\phi^{e})+\beta\phi^{e;2}-f\phi^{e}\right]\dd{\Omega}\\
 & =\frac{1}{2}\int_{\Omega^{e}}\left[-\phi^{e}\cdot(\epsilon_{0}\nabla^{2})\phi^{e}+\beta\phi^{e;2}-f\phi^{e}\right]\dd{\Omega}+{\color{blue}\int_{\Gamma^{s}}\phi^{s}\,\sbf e_{n}\cdot(\epsilon_{0}\cdot\nabla\phi^{s})\dd{\Gamma}}
\end{align*}

\end_inset


\begin_inset Formula ${\color{blue}\int_{\Gamma^{e}}\cdots\dd{\Gamma}}$
\end_inset

 给出边界条件项，
\begin_inset Formula $\phi^{s}$
\end_inset

表示边界曲面
\begin_inset Formula $\Gamma$
\end_inset

上的场。
\color blue

\begin_inset Formula $\sbf e_{n}$
\end_inset

 是法线方向，指向求解区域外侧
\color inherit
（从低
\begin_inset Formula $\epsilon$
\end_inset

指向高
\begin_inset Formula $\epsilon$
\end_inset

）。为了加上介电屏蔽条件，在边界曲面
\begin_inset Formula $\Gamma$
\end_inset

上添加一项：
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{s}\left(\phi^{s}\right) & =\frac{1}{2}\int_{\Gamma^{s}}\left[(\nabla_{t}\phi^{s})\cdot d\epsilon\cdot(\nabla_{t}\phi^{s})\right]\dd{\Gamma}\\
 & ={\color{blue}-\frac{1}{2}\int_{\Gamma^{s}}\left[\phi^{s}\,(\nabla_{t}\cdot d\epsilon_{0}\nabla_{t})\,\phi^{s}\right]\dd{\Gamma}}+{\color{brown}\int_{C^{\ell}}\phi^{\ell}\,\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})\dd{C}}
\end{align*}

\end_inset

其中：
\begin_inset Formula $\nabla_{t}$
\end_inset

表示沿着曲面切向的导数，即曲面上的局部坐标基矢
\begin_inset Formula $(\partial_{x},\partial_{y})$
\end_inset

；
\begin_inset Formula $\sbf e_{n}^{\ell}$
\end_inset

 是曲线
\begin_inset Formula $C$
\end_inset

的法向单位矢量。此外，上式使用了“曲面上的格林公式”
\begin_inset Formula $\int_{\Gamma}\left(\frac{\partial Q}{\partial x}-\frac{\partial P}{\partial y}\right)\dd{x}\dd{y}=\oint_{C}P\dd{x}+Q\dd{y}$
\end_inset

。
\end_layout

\begin_layout Example
如此，
\begin_inset Formula $\mathcal{F}^{e}\left(\phi^{e}\right)+\mathcal{F}^{s}\left(\phi^{s}\right)$
\end_inset

 的变分，将给出对应的电势场方程和边界条件为
\begin_inset Formula 
\begin{align}
-\nabla\cdot\left(\epsilon_{0}\nabla\phi\right)+\beta\phi=f\nonumber \\
{\color{blue}\sbf e_{n}\cdot(\epsilon_{0}\cdot\nabla\phi^{s})-(\nabla_{t}\cdot d\epsilon_{0}\nabla_{t})\,\phi^{s}=0} & \quad\text{在交界曲面上}\label{eq:di-screen3}\\
\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})=0 & \quad\text{在曲面的边界上}\nonumber 
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:di-screen3"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的负号，是由于约定与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:screen"
plural "false"
caps "false"
noprefix "false"

\end_inset

相反；
\begin_inset Formula $\sbf e_{n}^{\ell}\cdot(d\epsilon_{0}\cdot\nabla_{t}\phi^{\ell})=0$
\end_inset

 类似于自然边界条件，物理含义是：在交界面的某边界线
\begin_inset Formula $C$
\end_inset

上，电位移
\begin_inset Formula $\sbf D$
\end_inset

沿曲线的法向分量为零（此法线平行主法线
\begin_inset Formula $\sbf N$
\end_inset

，后者指向曲线的转动方向）。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
考虑二维情形。设求解区域为
\begin_inset Formula $\Gamma$
\end_inset

，
\begin_inset Formula $\Gamma$
\end_inset

的边界曲线记作
\begin_inset Formula $C=\partial\Gamma$
\end_inset

，
\begin_inset Formula $C$
\end_inset

的两个端点记作
\begin_inset Formula $p_{1}$
\end_inset

，
\begin_inset Formula $p_{2}$
\end_inset

。通常情况下，静电场的泊松方程的泛函写作
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{s}\left(\phi^{s}\right) & =\frac{1}{2}\int_{\Gamma^{s}}\left[(\nabla\phi^{s})\cdot\epsilon_{0}\cdot(\nabla\phi^{s})+\beta\phi^{s;2}-f\phi^{s}\right]\dd{\Gamma}\\
 & =\frac{1}{2}\int_{\Gamma^{s}}\left[-\phi^{s}\cdot(\epsilon_{0}\nabla^{2})\phi^{s}+\beta\phi^{s;2}-f\phi^{s}\right]\dd{\Gamma}+{\color{blue}\int_{C^{\ell}}\phi^{\ell}\,\sbf e_{n}^{\ell}\cdot(\epsilon_{0}\cdot\nabla\phi^{\ell})\dd{C}}
\end{align*}

\end_inset

其中
\begin_inset Formula $\nabla=(\partial_{x},\partial_{y})$
\end_inset

是二维平面上的梯度算符。
\begin_inset Formula ${\color{blue}\int_{C^{\ell}}\cdots\dd{C}}$
\end_inset

 给出边界条件项，
\begin_inset Formula $\phi^{\ell}$
\end_inset

表示边界曲线
\begin_inset Formula $C$
\end_inset

上的场，
\begin_inset Formula $\sbf e_{n}^{\ell}$
\end_inset

 是曲线
\begin_inset Formula $C$
\end_inset

的法向单位矢量，
\color blue
指向求解区域外侧
\color inherit
（从低
\begin_inset Formula $\epsilon$
\end_inset

指向高
\begin_inset Formula $\epsilon$
\end_inset

）。为了加上介电屏蔽条件，在边界曲线
\begin_inset Formula $C$
\end_inset

上添加一项：
\begin_inset Formula 
\begin{align*}
\mathcal{F}^{\ell}\left(\phi^{\ell}\right) & =\frac{1}{2}\int_{C^{\ell}}\left[(\partial_{t}\phi^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}\phi^{\ell})\right]\dd{C}\\
 & =-{\color{blue}\frac{1}{2}\int_{C^{\ell}}\left[\phi^{\ell}\,\left(\partial_{t}\cdot d\epsilon_{0}\,\partial_{t}\right)\,\phi^{\ell}\right]\dd{C}}+{\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}
\end{align*}

\end_inset

其中：
\begin_inset Formula $\partial_{t}$
\end_inset

表示沿曲线
\begin_inset Formula $C$
\end_inset

切向的导数，
\begin_inset Formula $\partial_{t}\phi^{\ell}$
\end_inset

为实数。若曲线
\begin_inset Formula $C=C(t)$
\end_inset

（即以
\begin_inset Formula $t$
\end_inset

为参数），则
\begin_inset Formula 
\[
\frac{\partial}{\partial t}\phi^{\ell}=\frac{\dd{x^{\mu}(t)}}{\dd{t}}\frac{\partial}{\partial x^{\mu}}\phi^{\ell},\quad x^{\mu}=x,y.
\]

\end_inset

表达式
\begin_inset Formula $\int_{C^{\ell}}\cdots\dd{C}$
\end_inset

可以参数化为对
\begin_inset Formula $t$
\end_inset

的积分。所以通过分部积分，多出一个端点项。
\end_layout

\begin_layout Example
如此，
\begin_inset Formula $\mathcal{F}^{s}\left(\phi^{s}\right)+\mathcal{F}^{\ell}\left(\phi^{\ell}\right)$
\end_inset

 的变分，将给出对应的电势场方程和边界条件为
\begin_inset Formula 
\begin{align}
-\nabla\cdot\left(\epsilon_{0}\nabla\phi\right)+\beta\phi=f\nonumber \\
{\color{blue}\sbf e_{n}^{\ell}\cdot(\epsilon_{0}\cdot\nabla\phi^{\ell})-\left(\partial_{t}\cdot d\epsilon_{0}\,\partial_{t}\right)\,\phi^{\ell}=0} & \quad\text{在交界曲线上}\label{eq:di-screen2}\\
{\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}=0 & \quad\text{在曲线的端点}\nonumber 
\end{align}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:di-screen2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的负号，是由于约定与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:screen"
plural "false"
caps "false"
noprefix "false"

\end_inset

相反。如果曲线
\begin_inset Formula $C$
\end_inset

是闭合的，则认为
\begin_inset Formula ${\color{brown}\left.\phi^{\ell}\left(d\epsilon_{0}\cdot\partial_{t}\phi^{\ell}\right)\right|_{p_{1}}^{p_{2}}}=0$
\end_inset

总是满足的？
\end_layout

\begin_layout Section
具体公式–二维
\end_layout

\begin_layout Standard
所以综上，需要在交界面的泛函 
\begin_inset Formula $\mathcal{F}^{\ell}\left(\phi^{\ell}\right)$
\end_inset

 中添加一项 
\begin_inset Formula $-\frac{1}{2}\int_{C^{\ell}}\left[(\partial_{t}\phi^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}\phi^{\ell})\right]\dd{C}$
\end_inset

。其中 
\begin_inset Formula $\partial_{t}$
\end_inset

 表示沿曲线切向的方向导数。对应的有限元方程中的系数矩阵为（
\begin_inset Formula $1/2$
\end_inset

在作变分时去掉）
\begin_inset Formula 
\[
K_{ij}^{\ell}=-\int_{C^{\ell}}(\partial_{t}N_{i}^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}N_{j}^{\ell})\dd{C}.
\]

\end_inset


\end_layout

\begin_layout Subsection
雅可比矩阵
\end_layout

\begin_layout Example
参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:curve3D"
plural "false"
caps "false"
noprefix "false"

\end_inset

。以二维平面中的曲线的线性单元为例，雅可比矩阵
\begin_inset Formula $J$
\end_inset

为（对于某一确定单元 
\begin_inset Formula $e$
\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[J\right]_{1\times2} & =\left[{\color{blue}\begin{array}{c}
\frac{\dd{\sbf r}}{\dd{\xi}}\end{array}}\right]=\left[\begin{array}{cc}
\frac{\dd{x}}{\dd{\xi}} & \frac{\dd{y}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\dd{N_{i}^{e}}}{\dd{\xi}}x_{i} & \frac{\dd{N_{i}^{e}}}{\dd{\xi}}y_{i}\end{array}\right],\quad\text{重复指标求和}\\
 & =\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}
\end{array}\right]
\end{align*}

\end_inset

注意 
\begin_inset Formula $x$
\end_inset

，
\begin_inset Formula $y$
\end_inset

并不是独立的，因为曲线是一维的。代入一阶单元表达式
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{1-\xi}{2},\quad N_{2}^{(1)}=\frac{1+\xi}{2},
\]

\end_inset

 得到
\begin_inset Formula 
\begin{align*}
\left[J\right]_{1\times2} & =\frac{1}{2}\left[\begin{array}{cc}
-1 & 1\end{array}\right]\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}
\end{array}\right]\\
 & =\frac{1}{2}\left[\begin{array}{cc}
-x_{1}+x_{2} & -y_{1}+y_{2}\end{array}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
局域坐标系
\end_layout

\begin_layout Example
从雅可比矩阵可以定义出局域坐标的三个方向（正交归一基），
\begin_inset Formula 
\begin{align*}
 & \sbf e_{1}=\frac{\dd{\sbf r}}{\dd{\xi}}/\abs{\frac{\dd{\sbf r}}{\dd{\xi}}}\\
 & \sbf e_{3}=\sbf e_{z}=(0,0,1)\\
 & \sbf e_{2}=\sbf e_{3}\times\sbf e_{1}
\end{align*}

\end_inset

约定基矢
\begin_inset Formula $\{\sbf e_{i}\}$
\end_inset

的分量写成列矩阵形式。
\end_layout

\begin_layout Example
使用局域坐标系 
\begin_inset Formula $T^{ab}=T^{ab}\left(\sbf e_{1},\sbf e_{2}\right)$
\end_inset

，实现全局坐标 
\begin_inset Formula $\sbf r=\left(x,y\right)$
\end_inset

 到二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

的转换
\begin_inset Formula 
\[
\sbf R=T^{ab}\sbf r
\]

\end_inset

坐标分量的变换式为：
\begin_inset Formula 
\[
\sbf R=S^{-1}.\left(\sbf r-\sbf r_{n}\right),\quad S^{-1}=\left[\begin{array}{c}
\sbf e_{1}^{\mathrm{T}}\\
\sbf e_{2}^{\mathrm{T}}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是局域原点的全局坐标，
\begin_inset Formula $\sbf e_{1}^{\mathrm{T}}$
\end_inset

表示分量矩阵的转置。计算
\begin_inset Formula $K_{ij}^{\ell}$
\end_inset

 矩阵需要的形函数的切向导数 
\begin_inset Formula $\frac{\dd{N_{i}^{e}}}{\dd{X}}$
\end_inset

（况且形函数也只在切线上定义）。在二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

下计算（参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi2"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{X}} & \frac{\dd{N_{2}^{e}}}{\dd{X}}\end{array}\right] & =\left[\begin{array}{c}
\frac{\dd{\xi}}{\dd{X}}\end{array}\right]\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{c}
\frac{\dd{X}}{\dd{\xi}}\end{array}\right]^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left[\begin{array}{c}
\frac{\dd{r}}{\dd{\xi}}\cdot\sbf e_{1}\end{array}\right]^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]\\
 & =\left(\left[\begin{array}{cc}
\frac{\dd{x}}{\dd{\xi}} & \frac{\dd{y}}{\dd{\xi}}\end{array}\right]\left[\begin{array}{c}
\sbf e_{1}\end{array}\right]_{2\times1}\right)^{-1}\left[\begin{array}{cc}
\frac{\dd{N_{1}^{e}}}{\dd{\xi}} & \frac{\dd{N_{2}^{e}}}{\dd{\xi}}\end{array}\right]
\end{align*}

\end_inset

其中使用了 
\begin_inset Formula $\dd{\sbf r}=\dd{X}\sbf e_{1}+\dd{Y}\sbf e_{2}$
\end_inset

，即矢径微元等于切线微元。
\end_layout

\begin_layout Subsection
约定和总结
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r_{j}$
\end_inset

 ：表示全局坐标，二维空间自由度 
\begin_inset Formula $j\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{j}$
\end_inset

 表示对全局坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\overline{x}_{\alpha}$
\end_inset

： 表示有限元中的采样点（node）， 
\begin_inset Formula $\alpha\in{1,2,\cdots,N}$
\end_inset

（希腊字母），线性单元
\begin_inset Formula $2$
\end_inset

个，二阶单元
\begin_inset Formula $3$
\end_inset

个等等。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $x_{p}^{\prime}$
\end_inset

 ：表示单元中二维平面的局域物理坐标 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

，
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{x}^{\prime}$
\end_inset

 表示沿曲线切向求导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\xi$
\end_inset

 ：表示曲线参数（自由度）；
\begin_inset Formula $\partial_{\xi}$
\end_inset

 表示对 
\begin_inset Formula $\xi$
\end_inset

 求导。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
全局物理坐标对等参坐标的雅可比行列式
\begin_inset Formula 
\begin{equation}
J_{1i}=\partial_{\xi}{\color{blue}r_{i}}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\end{array}\right]=\partial_{\xi}\,{\color{blue}N_{\alpha}\,\overline{x}_{\alpha i}},\quad[1,2]\label{eq:j-2d}
\end{equation}

\end_inset

其中 ，对于选定的单元
\begin_inset Formula $N_{\alpha}$
\end_inset

 形式已知，
\begin_inset Formula $\overline{x}_{\alpha j}$
\end_inset

 是节点坐标为已知常量，所以可直接求得
\begin_inset Formula $J_{j}$
\end_inset

 ，维数是 
\begin_inset Formula $1\times2$
\end_inset

。对于一阶单元
\begin_inset Formula 
\[
[J]_{1\times2}=\frac{1}{2}\left[\begin{array}{cc}
\Delta x & \Delta y\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\Delta x=x_{2}-x_{1}$
\end_inset

，
\begin_inset Formula $\Delta y$
\end_inset

类似。
\end_layout

\begin_layout Enumerate
局域物理坐标的三个单位正交基
\begin_inset Formula 
\begin{align*}
\sbf e_{1} & =J_{1\cdot}/\abs{J_{1\cdot}},\quad\text{点表示取整行}\\
\sbf e_{3} & =(0,0,1)\\
\sbf e_{2} & =\sbf e_{3}\times\sbf e_{1}.
\end{align*}

\end_inset

之所以按此序列构造，是为了保证 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

 是相互垂直的。求出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-2d"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $J_{j}$
\end_inset

，即可求出每个单元所属的 
\begin_inset Formula $\sbf e_{j}$
\end_inset

。可以把 
\begin_inset Formula $\left\{ \sbf e_{j}\right\} $
\end_inset

的分量写成数组形式（矩阵），分量用普通字体表示，将 
\begin_inset Formula $[e_{i}]$
\end_inset

分别填入
\color blue
每列
\color inherit
，这里只用到左上的
\begin_inset Formula $2\times2$
\end_inset

的子矩阵。
\begin_inset Formula 
\begin{equation}
E_{ij}=\left[\begin{array}{ccc}
{\color{blue}e_{1x}} & {\color{blue}e_{2x}} & \vdots\\
{\color{blue}e_{1y}} & {\color{blue}e_{2y}} & e_{3}\\
\vdots & \vdots & \vdots
\end{array}\right],\quad[3,3]\label{eq:unitV-2D}
\end{equation}

\end_inset

则 指标
\begin_inset Formula $1$
\end_inset

索引 某
\begin_inset Formula $e$
\end_inset

的分量，指标
\begin_inset Formula $2$
\end_inset

索引 
\begin_inset Formula $e_{1},e_{2},e_{3}$
\end_inset

。对于一阶单元
\begin_inset Formula 
\[
E_{ij}=\frac{1}{\Delta\ell}\left[\begin{array}{cc}
{\color{blue}\Delta x} & {\color{blue}-\Delta y}\\
{\color{blue}\Delta y} & {\color{blue}\Delta x}
\end{array}\right]
\]

\end_inset

其中
\begin_inset Formula $\Delta_{\ell}=\sqrt{\Delta x^{2}+\Delta y^{2}}$
\end_inset

。
\end_layout

\begin_layout Enumerate
局域物理坐标 对 参数坐标的 雅可比矩阵：
\begin_inset Formula 
\begin{equation}
L_{1q}=\partial_{\xi}\,x_{q}^{\prime}=\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\end{array}\right]=J_{1j}\,E_{jq},\quad[1,2]\label{eq:j-loc-2D}
\end{equation}

\end_inset


\begin_inset Formula $j,q=1,2$
\end_inset

， 
\begin_inset Formula $J$
\end_inset

 和 
\begin_inset Formula $E$
\end_inset

 分别在 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-2d"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:unitV-2D"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中求出，注意 
\begin_inset Formula $E$
\end_inset

 只取用 前
\begin_inset Formula $2\times2$
\end_inset

。对于一阶单元
\begin_inset Formula 
\[
L_{1q}=\frac{1}{2}\left[\begin{array}{cc}
\Delta\ell & 0\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Enumerate
形函数 对 局域几何坐标 的梯度
\begin_inset Formula 
\[
{\color{blue}\partial_{X}^{\prime}}\,N_{\alpha}={\color{blue}L_{11}^{-1}\,\partial_{\xi}}N_{\alpha},\quad[1,N]
\]

\end_inset

其中
\begin_inset Formula $N$
\end_inset

是节点的数目，
\begin_inset Formula $L^{-1}$
\end_inset

是 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:j-loc-2D"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的逆，这里只需元素
\begin_inset Formula $(1,1)$
\end_inset

。对于一阶单元
\begin_inset Formula 
\[
{\color{blue}\partial_{X}^{\prime}}\,N_{\alpha}=\frac{1}{\Delta\ell}\left[\begin{array}{cc}
-1 & 1\end{array}\right]
\]

\end_inset

至此，
\begin_inset Formula $\partial_{t}N_{i}^{\ell}$
\end_inset

 已求出。
\end_layout

\begin_layout Enumerate
计算均在
\begin_inset Formula $\xi$
\end_inset

参数轴上进行，即坐标变换步骤为：全局系的曲线
\begin_inset Formula $\Rightarrow$
\end_inset

局域系的直线
\begin_inset Formula $\Rightarrow$
\end_inset

参数系的直线，最后需在 
\begin_inset Formula $\xi$
\end_inset

 参数轴上积分：
\begin_inset Formula 
\begin{align*}
[K_{ij}^{\ell}] & =-\int_{C^{\ell}}(\partial_{t}N_{i}^{\ell})\cdot d\epsilon_{0}\cdot(\partial_{t}N_{j}^{\ell})\dd{C}\\
 & =-\int_{-1}^{1}\frac{d\epsilon_{0}}{\Delta\ell^{2}}\left[\begin{array}{cc}
1 & -1\\
-1 & 1
\end{array}\right]\,\frac{\Delta\ell}{2}\dd{\xi}\\
 & =\frac{-d\epsilon_{0}}{\Delta\ell}\left[\begin{array}{cc}
1 & -1\\
-1 & 1
\end{array}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Section
Galerkin方法
\end_layout

\begin_layout Enumerate
边界条件为
\begin_inset Formula 
\[
\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\sbf e_{n}\cdot\sbf D=0
\]

\end_inset


\end_layout

\begin_layout Enumerate
求解区域为 
\begin_inset Formula $\Omega$
\end_inset

，区域边界
\begin_inset Formula $\Gamma=\partial\Omega$
\end_inset

，边界的边界
\begin_inset Formula $C=\partial\Gamma$
\end_inset

。
\end_layout

\begin_layout Enumerate
仿照Galerkin方法通常情况的微分方程 
\begin_inset Formula $\nabla\cdot\left(\sbf D\right)-\rho=0$
\end_inset

，给出介电屏蔽条件对应的残差；在求解区域的边界
\begin_inset Formula $\Gamma$
\end_inset

上，加上残差项：
\begin_inset Formula 
\[
R^{e}\left[N_{i}^{e}\right]=\int_{\Gamma^{e}}N_{i}^{e}\left[\nabla_{t}\cdot\left(d\sbf D_{t}\right)+\sbf e_{n}\cdot\sbf D\right]\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Enumerate
例如对于三维问题，不同介质交界面是二维 
\begin_inset Formula $\Gamma^{e}$
\end_inset

，边界的边界是曲线
\begin_inset Formula $C^{e}$
\end_inset

；类似地，先用分部积分转移
\begin_inset Formula $\nabla$
\end_inset

，再使用二维情况下的散度定理，最终得到：
\begin_inset Formula 
\[
\int_{\Gamma^{e}}{\color{blue}\left(\nabla_{t}N_{i}^{e}\right)\cdot d\,\sbf D_{t}}\dd{\Gamma}=\int_{C^{e}}{\color{brown}N_{i}^{e}d\,\sbf D_{t}\cdot\sbf s_{n}}\dd{C}+\int_{\Gamma^{e}}N_{i}^{e}\sbf\,e_{n}\cdot\sbf D\dd{\Gamma}
\]

\end_inset

其中
\begin_inset Formula $\sbf e_{n}$
\end_inset

是 
\begin_inset Formula $\Gamma^{e}$
\end_inset

（二维单元）的法向单位矢量，
\begin_inset Formula $\sbf s_{n}$
\end_inset

 是
\begin_inset Formula $C^{e}$
\end_inset

（一维单元）的法向单位矢量。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
电流场中的介电屏蔽条件
\end_layout

\begin_layout Chapter
网格
\end_layout

\begin_layout Standard
过任意三个不共线的点
\begin_inset Formula $(x_{i},y_{i})$
\end_inset

，
\begin_inset Formula $i=1,2,3$
\end_inset

的圆，其圆心
\begin_inset Formula $(x_{0},y_{0})$
\end_inset

 和半径平方
\begin_inset Formula $r^{2}$
\end_inset

为
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
equ = { (Subscript[x, 1] - Subscript[x, 0])^2 + (Subscript[y, 1] - Subscript[y,
 0])^2 == r2, (Subscript[x, 2] - Subscript[x, 0])^2 + (Subscript[y, 2] -
 Subscript[y, 0])^2 == r2, (Subscript[x, 3] - Subscript[x, 0])^2 + (Subscript[y,
 3] - Subscript[y, 0])^2 == r2}; ans = Simplify[ First@Solve[equ, {Subscript[x,
 0], Subscript[y, 0], r2}], r2 > 0 ]
\end_layout

\end_inset


\begin_inset Formula 
\begin{align*}
 & x_{0}=\frac{x_{1}^{2}y_{23}+x_{2}^{2}y_{31}+x_{3}^{2}y_{12}+y_{23}y_{12}y_{13}}{a},\\
 & y_{0}=\frac{x_{1}b_{23}+x_{2}b_{31}+x_{3}b_{12}}{a},\\
 & r^{2}=\frac{\left(x_{12}^{2}+y_{12}^{2}\right)\left(x_{13}^{2}+y_{13}^{2}\right)\left(x_{23}^{2}+y_{23}^{2}\right)}{a^{2}}
\end{align*}

\end_inset

其中定义了 
\begin_inset Formula $a$
\end_inset

，
\begin_inset Formula $b_{ij}$
\end_inset

，
\begin_inset Formula $x_{ij}$
\end_inset

：
\begin_inset Formula 
\begin{align*}
 & a=2(x_{3}y_{12}+x_{1}y_{23}+x_{2}y_{31})\\
 & b_{ij}=x_{i}^{2}+y_{i}^{2}-x_{j}^{2}-y_{j}^{2}\\
 & x_{ij}=x_{i}-x_{j}\text{，}y_{ij}=y_{i}-y_{j}
\end{align*}

\end_inset


\end_layout

\begin_layout Remark
讨论特殊情况：上面的解假设了三点不共线。给定任意三点，不妨通过坐标系转动使得
\begin_inset Formula $x_{1}=x_{2}$
\end_inset

且
\begin_inset Formula $y_{1}\neq y_{2}$
\end_inset

（非同一点），令
\begin_inset Formula $a=0$
\end_inset

，解得 
\begin_inset Formula $x_{1}=x_{3}$
\end_inset

，则 
\begin_inset Formula $x_{1}=x_{2}=x_{3}$
\end_inset

，表明只有三点共线，才会令分母
\begin_inset Formula $a=0$
\end_inset

。同样，如果我们令
\begin_inset Formula $y_{1}=y_{2}$
\end_inset

且
\begin_inset Formula $x_{1}\neq x_{2}$
\end_inset

，
\begin_inset Formula $a=0$
\end_inset

 将迫使
\begin_inset Formula $y_{1}=y_{2}=y_{3}$
\end_inset

。结论就是，只要三点不共线，上面的解始终适用。
\end_layout

\begin_layout Chapter
Mortor单元法
\end_layout

\begin_layout Section
拉格朗日乘子
\end_layout

\begin_layout Section
Mortor连续条件
\end_layout

\begin_layout Standard
Mortar元法(mortar element method, MEM)是一种新型区域分解算法，它允许将求解区域分解为多个子域，在各个区域以最适合子域特征的方式
离散。在各个区域的交界面上，
\series bold
边界节点不要求逐点匹配
\series default
，而是通过建立加权积分形式的 Mortar条件使得交界面上的传递条件在分布意义上满足。 Mortar有限元法(mortar finite element
 method, MFEM)将 MEM 和有限元法(finite element method, FEM)相结合，在各区域中分别使用 FEM 网格离散，区域的交
界面上通过施加 Mortar条件实现区域间的自由度连续。根据子域网格位置关系的不同，MFEM 也可以分为重叠型 和非重叠型两种，本文只讨论非重叠
 MFEM(non- overlapping mortar finite element method, NO-MFEM)的基本原理和实现。
\end_layout

\begin_layout Standard
与传统 FEM 不同，MFEM 将求解区域分为多个子域，若 2 个子域的交集仅为以下情况之一：空集、 2 个区域的顶点、为整条边(面)，则称这种区域分解
 是几何协调的，否则是几何非协调的，如 图 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor1"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示。
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fem-mortor1.png
	lyxscale 80
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
左边是几何协调分解；右边是几何非协调分解。
\begin_inset CommandInset label
LatexCommand label
name "fig:mortor1"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
在几何协调的情况下，具体到网格时，又可以分成
\series bold
网格协调
\series default
和
\series bold
网格非协调
\series default
。网格协调是指不同区域间的公共面/边上，网格的节点是重合的，也就是共节点的概念。相应地，非协调是指两区域的公共面/边上，网格节点可以不重合，如图
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/fem-mortor2.png
	scale 70

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
左边是协调网格；右边是非协调网格。
\begin_inset CommandInset label
LatexCommand label
name "fig:mortor2"

\end_inset


\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
对于图 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)中的非协调网格，需要用各个子域的解逼近全域解，关键是解决 内交界面 上节点自由度的连续问题。在 NO-MFEM 中，交界面的连续条件通过选择非
 Mortar 侧（从边）的有限元空间在交界面上的迹空间作为拉格朗日乘子空间，强制满足 Mortar 条件。例如对于图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:mortor2"
plural "false"
caps "false"
noprefix "false"

\end_inset

(b)所示的区域 
\begin_inset Formula $m$
\end_inset

 的网格
\begin_inset Formula $\mathcal{T}_{m}$
\end_inset

和区 域 
\begin_inset Formula $n$
\end_inset

 的网格
\begin_inset Formula $\mathcal{T}_{n}$
\end_inset

，两套网格节点自由度在区域交界面
\begin_inset Formula $\Gamma_{mn}$
\end_inset

上满足
\begin_inset Formula 
\begin{equation}
\int_{\Gamma_{mn}^{-}}\mu\,u\,\dd{\Gamma}=\int_{\Gamma_{mn}^{-}}\mu\,v\,\dd{\Gamma}\label{eq:mo8}
\end{equation}

\end_inset

式中：
\begin_inset Formula $u$
\end_inset

 表示非 Mortar边（从边）的未知函数；
\begin_inset Formula $v$
\end_inset

 表示 Mortar 边（主边）的未知函数；
\begin_inset Formula $\mu$
\end_inset

表示试探函数。对
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo8"
plural "false"
caps "false"
noprefix "false"

\end_inset

离散可得矩阵形式的 Mortar连续条件，即 
\begin_inset Formula 
\begin{equation}
Cu=Dv\label{eq:mo9}
\end{equation}

\end_inset

将非Mortar边的节点自由度
\begin_inset Formula $u$
\end_inset

作为从节点自由 度，用 Mortar 边的主节点自由度 
\begin_inset Formula $v$
\end_inset

表示，即 
\begin_inset Formula 
\begin{equation}
u=C^{-1}D\,v=Qv\label{eq:mo10}
\end{equation}

\end_inset

式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo9"
plural "false"
caps "false"
noprefix "false"

\end_inset

和
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:mo10"
plural "false"
caps "false"
noprefix "false"

\end_inset

中：系数矩阵 
\begin_inset Formula $C$
\end_inset

、
\begin_inset Formula $D$
\end_inset

 为中间矩阵；
\begin_inset Formula $Q$
\end_inset

 为 MEM 交界面连续条件矩阵。
\end_layout

\end_body
\end_document
