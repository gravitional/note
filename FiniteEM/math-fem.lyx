#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass ctex-book
\begin_preamble
\input{math-preamble}
\end_preamble
\options UTF8,dvipsnames,svgnames,x11names,hyperref,colorlinks=true
\use_default_options true
\begin_modules
theorems-ams-chap-bytype
graphicboxes
\end_modules
\maintain_unincluded_children false
\language chinese-simplified
\language_package none
\inputencoding utf8-plain
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures false
\graphics default
\default_output_format pdf4
\output_sync 0
\bibtex_command default
\index_command default
\float_placement H
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 2
\use_package amssymb 2
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style english
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Title
数学笔记
\end_layout

\begin_layout Author
Young
\end_layout

\begin_layout Chapter
线性代数
\end_layout

\begin_layout Section
范德蒙德行列式
\end_layout

\begin_layout Standard
ref: 
\begin_inset CommandInset href
LatexCommand href
name "范德蒙行列式"
target "https://zhuanlan.zhihu.com/p/161300510"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
范德蒙德行列式的形式：
\begin_inset Formula 
\[
D=\left[\begin{array}{ccccc}
1 & 1 & 1 & \cdots & 1\\
x_{1} & x_{2} & x_{3} & \cdots & x_{n}\\
x_{1}^{2} & x_{2}^{2} & x_{3}^{2} & \cdots & x_{n}^{2}\\
\cdots & \cdots & \cdots & \cdots & \cdots\\
x_{1}^{n-2} & x_{2}^{n-2} & \cdots & \cdots & x_{n}^{n-2}\\
x_{1}^{n-1} & x_{2}^{n-1} & \cdots & \cdots & x_{n}^{n-1}
\end{array}\right]
\]

\end_inset

遇到类似于上式的行列式时，可以使用范德蒙行列式公式计算：
\begin_inset Formula 
\[
\prod_{n\ge i\ge j\ge1}=(x_{i}-x_{j})
\]

\end_inset

即行列式
\begin_inset Formula $D$
\end_inset

的值为所有
\begin_inset Formula $(x_{i}-x_{j})$
\end_inset

 的乘积，其中
\begin_inset Formula $i>j$
\end_inset

。
\end_layout

\begin_layout Standard
例如
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
1 & 1 & 1\\
x_{1} & x_{2} & x_{3}\\
x_{1}^{2} & x_{2}^{2} & x_{3}^{2}
\end{array}\right]=\left(x_{2}-x_{1}\right)\left(x_{3}-x_{1}\right)\left(x_{3}-x_{2}\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
证明范德蒙行列式
\end_layout

\begin_layout Standard
通过观察范德蒙行列式，拿行列式的第一列来说，相邻的两个元素，上面的元素比下面的元素少乘一次 
\begin_inset Formula $x_{1}$
\end_inset

。根据这一特征，可以试着从第 
\begin_inset Formula $n$
\end_inset

 行开始，每个元素都减去前一行元素的 
\begin_inset Formula $x_{1}$
\end_inset

 倍，则可以提取出公因式
\begin_inset Formula 
\[
\left(x_{2}-x_{1}\right)\left(x_{3}-x_{1}\right)\cdots\left(x_{n}-x_{1}\right)\times\left[\begin{array}{cccc}
1 & 1 & \cdots & 1\\
x_{2} & x_{3} & \cdots & x_{n}\\
\cdots & \cdots & \cdots & \cdots\\
x_{2}^{n-3} & \cdots & \cdots & x_{n}^{n-3}\\
x_{2}^{n-2} & \cdots & \cdots & x_{n}^{n-2}
\end{array}\right]
\]

\end_inset

于是又产生了范德蒙德行列式，可以递归进行下去。因此得到公式
\begin_inset Formula 
\[
D=\prod_{n\ge i\ge j\ge1}=(x_{i}-x_{j}).
\]

\end_inset


\end_layout

\begin_layout Section
线搜索方法 Line search
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "线搜索(line search)方法"
target "https://www.cnblogs.com/kemaswill/p/3416231.html"
literal "false"

\end_inset

;
\end_layout

\begin_layout Standard
Numerical Optimization, Chapter 3, p35-p42.
 J.
 Nocedal, S.Wright.
\end_layout

\begin_layout Standard
在机器学习中, 通常需要求某个函数的最值(比如 最大似然中 需要求的 似然的最大值)。线搜索(line search)是求得一个函数
\begin_inset Formula $f(x)$
\end_inset

的最值的两种常用迭代方法之一(另外一个是 trust region)。其思想是首先求得一个下降方向,在这个方向上
\begin_inset Formula $f(x)$
\end_inset

会下降，然后是求得
\begin_inset Formula $f(x)$
\end_inset

在这个方向上下降的步长。求下降方向的方法有很多，比如梯度下降，牛顿方法 和 Quasi-Newton 方法, 而步长可以是固定值，也可以通过诸如回溯线搜索来求得
。
\end_layout

\begin_layout Subsection
线搜索
\end_layout

\begin_layout Standard
线搜索 是一种迭代的求得某个函数的最值的方法。 对于每次迭代, 线搜索会计算得到搜索的方向 
\begin_inset Formula $p_{k}$
\end_inset

 以及沿这个方向移动的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

。迭代过程可以表示为
\begin_inset Formula 
\begin{equation}
x_{k+1}=x_{k}+\alpha_{k}p_{k},\label{eq:w3.1}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\alpha_{k}$
\end_inset

 是正值标量，称为步长（step length）。线搜索的成功取决于方向 
\begin_inset Formula $p_{k}$
\end_inset

 和 步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 的有效选择。
\end_layout

\begin_layout Standard
大多数的线搜索方法都会要求 
\begin_inset Formula $p_{k}$
\end_inset

 是下降方向(descent direction)，亦即需要满足以下条件： 
\begin_inset Formula 
\[
p_{k}^{T}\nabla f_{k}<0.
\]

\end_inset

，这样就能够保证函数f(x)沿着这个方向是下降的。一般来说, 搜索方向的形式为
\begin_inset Formula 
\begin{equation}
p_{k}=-B_{k}^{-1}\nabla f_{k},\label{eq:w3.2}
\end{equation}

\end_inset

其中 
\begin_inset Formula $B_{k}$
\end_inset

 是对称的非奇异矩阵。在最陡下降(steepest descent)方法中，
\begin_inset Formula $B_{k}$
\end_inset

是单位矩阵
\begin_inset Formula $I$
\end_inset

, 在牛顿方法(Newton)中
\begin_inset Formula $B_{k}$
\end_inset

 则是海森(Hessian)矩阵
\begin_inset Formula $\nabla^{2}f\left(x_{k}\right)$
\end_inset

，在 Quasi-Newton方法中通过迭代求得 Hessian 矩阵的近似矩阵。
\end_layout

\begin_layout Standard
当 
\begin_inset Formula $p_{k}$
\end_inset

 由上式定义, 且 
\begin_inset Formula $B_{k}$
\end_inset

 是正定矩阵时：
\begin_inset Formula 
\[
p_{k}^{T}\nabla f_{k}=-\nabla f_{k}^{T}B_{k}^{-1}\nabla f_{k}<0
\]

\end_inset

所以 
\begin_inset Formula $p_{k}$
\end_inset

 是下降方向(descent direction)。
\end_layout

\begin_layout Subsection
步长
\end_layout

\begin_layout Standard
步长 
\begin_inset Formula $\alpha$
\end_inset

 应该最小化下列函数
\begin_inset Formula 
\begin{equation}
\phi\left(\alpha\right)=f\left(x_{k}+\alpha p_{k}\right),\quad\alpha>0\label{eq:w3.3}
\end{equation}

\end_inset


\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.2.png
	lyxscale 50
	scale 45

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
在 
\begin_inset Formula $f$
\end_inset

 上不充分的下降。
\begin_inset Formula $f\left(x_{k}\right)=5/k$
\end_inset

, 
\begin_inset Formula $k=0,1,\cdots$
\end_inset


\end_layout

\end_inset


\end_layout

\end_inset

但是 全局最小值对应的 
\begin_inset Formula $\alpha$
\end_inset

 比较困难，且计算量比较大，实际常用的方法是在可接受的计算量的情况下尽可能的求得较大的步长， 以使得 
\begin_inset Formula $\phi\left(\alpha\right)$
\end_inset

尽可能的降低。经典的线搜索方法通过迭代来求得
\begin_inset Formula $\alpha$
\end_inset

，直至达到某个停止条件。一般的线搜索方法都包含以下两个步骤：
\end_layout

\begin_layout Enumerate
bracketing: 求得一个包含 理想步长 的区间 
\end_layout

\begin_layout Enumerate
二分法或者插值法：在这个区间内使用二分法或者插值法来求得步长。
\end_layout

\begin_layout Subsection
对于凸函数的二分搜索算法
\end_layout

\begin_layout Standard
如果 
\begin_inset Formula $f(x)$
\end_inset

 是一个可微分的凸函数, 则我们的目标是求得 
\begin_inset Formula $\alpha$
\end_inset

, 使得 
\begin_inset Formula 
\[
\alpha=\mathrm{arg}\min_{\lambda>0}f\left(x+\lambda p\right)
\]

\end_inset

令 
\begin_inset Formula $\phi(\alpha)=f\left(x_{k}+\alpha p_{k}\right)$
\end_inset

，其中 
\begin_inset Formula $\phi(\alpha)$
\end_inset

 是 
\begin_inset Formula $\alpha$
\end_inset

 的凸函数, 所以问题转化为求: 
\begin_inset Formula 
\[
\overline{\alpha}=\mathrm{arg}\min_{\alpha>0}\phi\left(\alpha\right)
\]

\end_inset

因为 
\begin_inset Formula $\phi(\alpha)$
\end_inset

 是凸函数, 所以 
\begin_inset Formula $\phi'(\overline{\alpha})=0$
\end_inset

。可以得到 
\begin_inset Formula $\phi'(\alpha)=\nabla f\left(x+\alpha p\right)^{T}p$
\end_inset

，因为
\begin_inset Formula $p$
\end_inset

是梯度下降方向，所以 
\begin_inset Formula $\phi'(0)<0$
\end_inset

。
\end_layout

\begin_layout Standard
假设我们知道一个 
\begin_inset Formula $\hat{\alpha}$
\end_inset

 使得 
\begin_inset Formula $\phi'(\hat{\alpha})>0$
\end_inset

，那么使得 
\begin_inset Formula $\phi'(\overline{\alpha})=0$
\end_inset

 的 
\begin_inset Formula $\alpha$
\end_inset

 肯定位于 
\begin_inset Formula $(0,\hat{\alpha})$
\end_inset

 区间内。然后我们可以使用以下二分查找算法来求解 
\begin_inset Formula $\phi'(\alpha)\approx0$
\end_inset

。
\end_layout

\begin_layout Enumerate
令 
\begin_inset Formula $k=0$
\end_inset

，
\begin_inset Formula $\alpha_{l}\coloneqq0$
\end_inset

，
\begin_inset Formula $\alpha_{r}:=\hat{\alpha}$
\end_inset

；即 
\begin_inset Formula $\phi'(\alpha_{l})<0$
\end_inset

，
\begin_inset Formula $\phi'(\alpha_{r})>0$
\end_inset

。
\end_layout

\begin_layout Enumerate
令 
\begin_inset Formula $\tilde{\alpha}=\frac{\alpha_{l}+\alpha_{r}}{2}$
\end_inset

，然后计算 
\begin_inset Formula $\phi'(\tilde{\alpha})$
\end_inset

：
\end_layout

\begin_deeper
\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\tilde{\alpha})>0$
\end_inset

，则令 
\begin_inset Formula $\alpha_{r}\coloneqq\tilde{\alpha}$
\end_inset

，
\begin_inset Formula $\alpha_{l}$
\end_inset

不变，令 
\begin_inset Formula $k\to k+1$
\end_inset


\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\tilde{\alpha})<0$
\end_inset

，则令 
\begin_inset Formula $\alpha_{l}\coloneqq\tilde{\alpha}$
\end_inset

，
\begin_inset Formula $\alpha_{r}$
\end_inset

不变，令 
\begin_inset Formula $k\to k+1$
\end_inset


\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $\phi'(\tilde{\alpha})=0$
\end_inset

, 停止迭代。
\end_layout

\end_deeper
\begin_layout Subsection
回溯线搜索 backtracking line search
\end_layout

\begin_layout Standard
使用二分查找法来求步长的计算复杂度很高，因为在最小化 
\begin_inset Formula $f(x)$
\end_inset

 的每次迭代中我们都需要执行一次线搜索,，而每次线搜索都要用上述的二分查找算法。我们可以在牺牲一定的精度的条件下来加快计算速度，回溯线搜索是一种近似线搜索算法。
\end_layout

\begin_layout Standard
首先，我们要求每次的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 都使得
\begin_inset Formula $f(x)$
\end_inset

充分的降低：
\begin_inset Formula 
\begin{equation}
f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k}\label{eq:w3.4}
\end{equation}

\end_inset

上述条件称作充分下降条件，其中 
\begin_inset Formula $c_{1}\in(0,1)$
\end_inset

，一般来说 
\begin_inset Formula $c_{1}=10^{-4}$
\end_inset

。亦即 
\begin_inset Formula $f(x)$
\end_inset

 的下降应该至少和 
\begin_inset Formula $\alpha_{k}$
\end_inset

 以及 
\begin_inset Formula $\nabla f_{k}^{T}p_{k}$
\end_inset

 成正比。如下图所示, 上式的右边 
\begin_inset Formula $f(x_{k})+c_{1}\alpha\nabla f_{k}^{T}p_{k}$
\end_inset

 是线性函数, 可以表示为 
\begin_inset Formula $\ell(\alpha)$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.3.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
充分下降条件
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.3"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
充分下降条件规定只有使得 
\begin_inset Formula $\phi(\alpha)\le\ell(\alpha)$
\end_inset

 的 
\begin_inset Formula $\alpha$
\end_inset

 才满足条件。其区间如上图所示。
\end_layout

\begin_layout Standard
单独只有充分下降条件是不够的，因为如上图，所有充分小的 
\begin_inset Formula $\alpha$
\end_inset

 都满足上述条件，但是 
\begin_inset Formula $\alpha$
\end_inset

 太小会导致下降不充分, 为了排除这些小的 
\begin_inset Formula $\alpha$
\end_inset

，我们引入了第二个要求，亦即曲率条件(curvature condition)：
\begin_inset Formula 
\[
\nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k}
\]

\end_inset

其中 
\begin_inset Formula $c_{2}\in\left(c_{1},1\right)$
\end_inset

。上式的左边就是 
\begin_inset Formula $\phi'(\alpha_{k})$
\end_inset

，右边则是 
\begin_inset Formula $\phi'(0)$
\end_inset

，即上式相当于
\begin_inset Formula 
\[
\phi'(\alpha_{k})\ge c_{2}\phi'(0).
\]

\end_inset

这是因为如果 
\begin_inset Formula $\phi'(\alpha)$
\end_inset

 是很小的负数（下降得非常陡峭），则我们可以在这个方向上继续使得 
\begin_inset Formula $f(x)$
\end_inset

下降更多.
 如下图所示
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.4.png
	lyxscale 50
	scale 50

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
曲率条件（curvature condition）
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.4"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
Typical values of 
\begin_inset Formula $c_{2}$
\end_inset

 are 
\begin_inset Formula $0.9$
\end_inset

 when the search direction 
\begin_inset Formula $p_{k}$
\end_inset

 is chosen by a Newton or quasi-Newton method, and 
\begin_inset Formula $0.1$
\end_inset

 when 
\begin_inset Formula $p_{k}$
\end_inset

 is obtained from a nonlinear conjugate gradient method。上述两个条件合起来称作 Wolfe
 条件：
\begin_inset Formula 
\begin{align}
 & f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k},\label{eq:w3.6a}\\
 & \nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k},\label{eq:w3.6b}
\end{align}

\end_inset

其中 
\begin_inset Formula $0<c_{1}<c_{2}<1$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.5.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
满足 Wolfe 条件的步长。
\begin_inset CommandInset label
LatexCommand label
name "fig:w-3.5"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
满足 Wolfe 条件的 步长 不一定离 
\begin_inset Formula $\phi$
\end_inset

 的极值点很近，如 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:w-3.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

。但是可以修改 curvature condition，来让 
\begin_inset Formula $\alpha_{k}$
\end_inset

 至少位于 
\begin_inset Formula $\phi$
\end_inset

 的 local minimizer 或 stationary point 附近。strong Wolfe condition 要求 
\begin_inset Formula $\alpha_{k}$
\end_inset

 满足：
\begin_inset Formula 
\begin{align}
 & f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c_{1}\alpha_{k}\nabla f_{k}^{T}p_{k},\label{eq:w3.7a}\\
 & \nabla f(x_{k}+\alpha p_{k})^{T}p_{k}\ge c_{2}\nabla f_{k}^{T}p_{k},\label{eq:w3.7b}
\end{align}

\end_inset

其中 
\begin_inset Formula $0<c_{1}<c_{2}<1$
\end_inset

。
\end_layout

\begin_layout Standard
It is not difficult to prove that there exist step lengths that satisfy
 the Wolfe conditions for every function f that is smooth and bounded below。
\end_layout

\begin_layout Lemma
Suppose that 
\begin_inset Formula $f:\symbb R^{n}\to\symbb R$
\end_inset

 is continuously differentiable.
 Let pk be a descent direction at xk, and assume that f is bounded below
 along the ray 
\begin_inset Formula $\left\{ x_{k}+\alpha p_{k}|\alpha>0\right\} $
\end_inset

。Then if 
\begin_inset Formula $0<c1<c2<1$
\end_inset

, there exist intervals of step lengths satisfying the Wolfe conditions
 (3.6) and the strong Wolfe conditions 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.7a"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
The Wolfe conditions are scale-invariant in a broad sense: Multiplying the
 objective function by a constant or making an affine change of variables
 does not alter them.
 They can be used in most line search methods, and are particularly important
 in the implementation of quasi-Newton methods, as we see in Chapter 6.
\end_layout

\begin_layout Subsection
Goldstein 条件
\end_layout

\begin_layout Standard
Like the Wolfe conditions, the Goldstein conditions ensure that the step
 length 
\begin_inset Formula $\alpha$
\end_inset

 achieves sufficient decrease but is not too short.
 The Goldstein conditions can also be stated as a pair of inequalities,
 in the following way：
\begin_inset Formula 
\begin{equation}
f(x_{k})+(1-c)\alpha_{k}\nabla f_{k}^{T}p_{k}\le f(x_{k}+\alpha_{k}p_{k})\le f(x_{k})+c\alpha_{k}\nabla f_{k}^{T}p_{k},\label{eq:w3.11}
\end{equation}

\end_inset

其中 
\begin_inset Formula $0<c<1/2$
\end_inset

。第二个不等式正是充分下降条件
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.4"
plural "false"
caps "false"
noprefix "false"

\end_inset

，并引入第一个不等式来控制 步长的下限。见图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:w3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/wright-fig-3.6.png
	lyxscale 50
	scale 50

\end_inset


\begin_inset Caption Standard

\begin_layout Plain Layout
The Goldstein conditions.
\begin_inset CommandInset label
LatexCommand label
name "fig:w3.6"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
A disadvantage of the Goldstein conditions vis-a-vis the Wolfe conditions
 is that the first inequality in (3.11) may exclude all minimizers of 
\begin_inset Formula $\phi$
\end_inset

。 However, the Goldstein and Wolfe conditions have much in common, and their
 convergence theories are quite similar.
 The Goldstein conditions are often used in Newton-type methods but are
 not well suited for quasi-Newton methods that maintain a positive definite
 Hessian approximation。
\end_layout

\begin_layout Standard
充分下降条件和回溯算法(BACKTRACKING)
\end_layout

\begin_layout Standard
我们已经提到，仅仅是充分减少条件
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.6a"
plural "false"
caps "false"
noprefix "false"

\end_inset

 并不足以确保，算法沿着给定的搜索方向取得合理的下降。 然而，如果 线搜索 算法适当地选择其候选步长，通过使用所谓的 回溯方法（backtracking
 approach），我们可以省去 额外的条件
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:w3.6b"
plural "false"
caps "false"
noprefix "false"

\end_inset

，只使用 充分下降条件 来终止 线搜索 程序。在其最基本的形式中，回溯法的过程如下。
\end_layout

\begin_layout Example
\begin_inset Argument 1
status open

\begin_layout Plain Layout
算法3.1
\end_layout

\end_inset

 Backtracking Line Search
\end_layout

\begin_layout Enumerate
选取 
\begin_inset Formula $\overline{\alpha}>0$
\end_inset

，
\begin_inset Formula ${\color{blue}\rho\in(0,1)}$
\end_inset

，
\begin_inset Formula ${\color{brown}c\in(0,1)}$
\end_inset

；令 
\begin_inset Formula $\alpha\leftarrow\overline{\alpha}$
\end_inset

；
\end_layout

\begin_layout Enumerate

\series bold
repeat 
\series default
until 
\begin_inset Formula $f(x_{k}+\alpha p_{k})\le f(x_{k})+{\color{brown}c}\,\alpha\nabla f_{k}^{T}p_{k}$
\end_inset

 （直到满足充分下降条件）
\begin_inset Formula 
\[
\alpha\leftarrow{\color{blue}\rho}\,\alpha;
\]

\end_inset


\series bold
end(repeat)
\begin_inset Newline newline
\end_inset


\series default
返回 
\begin_inset Formula $\alpha_{k}=\alpha$
\end_inset

。
\end_layout

\begin_layout Standard
在这个过程中，初始步长 
\begin_inset Formula $\overline{\alpha}$
\end_inset

 在牛顿和 quasi- Newton 方法中被选择为 
\begin_inset Formula $1$
\end_inset

，但在其他算法中可以有不同的值，如 最陡峭下降法（steepest descent） 或 共轭梯度法（conjugate gradient）。在有限次数的试验后
，能找到一个可接受的步长，因为 
\begin_inset Formula $\alpha_{k}$
\end_inset

 最终会变得足够小，以至于充分下降条件成立（见图
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:w3.3"
plural "false"
caps "false"
noprefix "false"

\end_inset

）。在实践中，允许在直线搜索的每个迭代中，改变 收缩因子
\begin_inset Formula $\rho$
\end_inset

。例如，它可以通过保障性插值（safeguarded interpolation）来选择，我们将在后面介绍。我们只需要确保在每次迭代中，我们有
 
\begin_inset Formula $\rho\in[\rho_{\text{low}},\rho_{\text{high}}]$
\end_inset

，对于某些固定常数 
\begin_inset Formula $0<\rho_{\text{low}}<\rho_{\text{high}}<1$
\end_inset

。
\end_layout

\begin_layout Standard
回溯方法 确保所选择的步长 
\begin_inset Formula $\alpha_{k}$
\end_inset

 要么是某固定值（初始选择
\begin_inset Formula $\overline{\alpha}$
\end_inset

），否则就是足够短以满足充分下降条件，但又不会太短。后一种说法成立，是因为 被接受值 
\begin_inset Formula $\alpha_{k}$
\end_inset

 相比于前一试验值（trial value，
\begin_inset Formula $\alpha_{k}/\rho$
\end_inset

）要乘上系数 
\begin_inset Formula $\rho$
\end_inset

；而前个值因违反 充分下降条件 被拒绝，也就是太长。
\end_layout

\begin_layout Standard
这种简单而流行的 终止线搜索 的策略很适合 牛顿法，但不太适合准牛顿和共轭梯度方法。
\end_layout

\begin_layout Section
坐标转动变换
\end_layout

\begin_layout Enumerate
旧坐标系下矢量记为 
\begin_inset Formula $X$
\end_inset

（例如全局坐标系），坐标基矢组为 
\begin_inset Formula $[\sbf e]$
\end_inset

；
\end_layout

\begin_layout Enumerate
新坐标系下矢量记为 
\begin_inset Formula $Y$
\end_inset

（例如局域坐标系）；坐标基矢组为 
\begin_inset Formula $[\sbf f]$
\end_inset

；
\end_layout

\begin_layout Enumerate
新旧坐标的 转动变换 矩阵为 
\begin_inset Formula $R$
\end_inset

，
\begin_inset Formula $R^{-1}=R^{T}$
\end_inset

，
\begin_inset Formula $R.R^{T}=\symbb1$
\end_inset

，为正交矩阵。
\end_layout

\begin_layout Standard
将坐标分量表示记为列矢量，约定 
\begin_inset Formula $Y=R.X$
\end_inset

，则
\begin_inset Formula 
\begin{align}
 & Y_{i}=R_{ij}X_{j}\label{eq:coordTrans}\\
 & X_{k}=R_{ki}^{-1}Y_{i}\nonumber 
\end{align}

\end_inset

同一矢量在两坐标系下具有不同的表示形式，但本质相同：
\begin_inset Formula 
\[
X_{i}\sbf e_{i}=Y_{j}\sbf f_{j}=R_{ji}X_{i}\sbf f_{j}
\]

\end_inset

从而得到 坐标基矢间的变换关系
\begin_inset Formula 
\[
\sbf e_{i}=\sbf f_{j}R_{ji},\quad\text{or}\quad\sbf f_{j}=\sbf e_{i}R_{ij}^{-1}
\]

\end_inset


\end_layout

\begin_layout Itemize
如果把坐标基矢组织到一起，可以写成行矩阵的形式：
\begin_inset Formula 
\[
[\begin{array}{ccc}
e_{1} & e_{2} & e_{3}\end{array}]=[\begin{array}{ccc}
f_{1} & f_{2} & f_{3}\end{array}].[R]
\]

\end_inset


\end_layout

\begin_layout Itemize
另一方面，坐标基矢本身可以用分量表示；新坐标系的基矢 
\begin_inset Formula $\sbf f_{1}$
\end_inset

 在新系的形式显然为 
\begin_inset Formula $[1,0,0]$
\end_inset

，根据 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:coordTrans"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula 
\[
\left[\begin{array}{c}
f_{1,1}\\
f_{1,2}\\
f_{1,3}
\end{array}\right]=R^{-1}\left[\begin{array}{c}
1\\
0\\
0
\end{array}\right],
\]

\end_inset

根据约定，
\begin_inset Formula $\left[f_{11},f_{12},f_{13}\right]^{T}$
\end_inset

 是新系基矢 
\begin_inset Formula $\sbf f_{1}$
\end_inset

 在旧系下的分量形式；而 式子右边相当于 
\begin_inset Formula $R^{-1}$
\end_inset

 的第一列。
\end_layout

\begin_layout Itemize
所以 
\begin_inset Formula $R^{-1}$
\end_inset

 的每一列，刚好是新基矢在旧坐标系下的分量形式。同理，
\begin_inset Formula $R$
\end_inset

的每一列是旧系基矢在新系下的分量形式。
\end_layout

\begin_layout Example
如果 
\begin_inset Formula $R$
\end_inset

 矩阵：旧坐标 
\begin_inset Formula $\stackrel{R}{\to}$
\end_inset

 新坐标（带撇的量）；或者说 
\begin_inset Formula $R$
\end_inset

 将新坐标用旧坐标表示，则
\begin_inset Formula 
\begin{align*}
 & X^{\prime}=RX,\quad\sbf e_{j}^{\prime}=\sbf e_{i}R_{ij}^{-1}\\
 & T^{\prime}=RTR^{-1}
\end{align*}

\end_inset


\begin_inset Formula $R^{-1}$
\end_inset

 的每一列，是 新系基矢 
\begin_inset Formula $\sbf e'$
\end_inset

 在旧系下的 分量形式；
\begin_inset Formula $R$
\end_inset

的每一列是旧系基矢 
\begin_inset Formula $\sbf e$
\end_inset

 在新系下的分量形式。
\end_layout

\begin_layout Example
新旧名称是相对的。所以等价地，如果 
\begin_inset Formula $U$
\end_inset

 矩阵：新坐标 
\begin_inset Formula $\stackrel{U}{\to}$
\end_inset

 旧坐标；或者说 
\color blue

\begin_inset Formula $U$
\end_inset

 将 旧坐标 用 新坐标表示
\color inherit
，
\begin_inset Formula 
\begin{align*}
 & X=UX^{\prime},\quad\sbf e_{j}=\sbf e_{i}^{\prime}U_{ij}^{-1}\\
 & T=UT^{\prime}U^{-1}
\end{align*}

\end_inset


\begin_inset Formula $U^{-1}$
\end_inset

的每一列是 旧系基矢 
\begin_inset Formula $\sbf e$
\end_inset

 在新系下的 分量形式；
\color blue

\begin_inset Formula $U$
\end_inset

 的每一列是新系 基矢在 旧系 下的分量形式
\color inherit
。
\end_layout

\begin_layout Section
快速傅立叶
\end_layout

\begin_layout Example
\begin_inset CommandInset href
LatexCommand href
name "FFT 超详解"
target "https://zhuanlan.zhihu.com/p/347091298"
literal "false"

\end_inset


\end_layout

\begin_layout Section
局域坐标系
\end_layout

\begin_layout Standard
给定任意两个非平行矢量 
\begin_inset Formula $\sbf A$
\end_inset

，
\begin_inset Formula $\sbf B$
\end_inset

，使用它们构建一个局域坐标系的方法是，
\end_layout

\begin_layout Enumerate
先令 
\begin_inset Formula $\sbf Z=\sbf A\times\sbf B$
\end_inset

，右手螺旋三元组为 
\begin_inset Formula $(\sbf Z,\sbf A,\sbf B)$
\end_inset


\end_layout

\begin_layout Enumerate
再令 
\begin_inset Formula $\sbf B'=\sbf Z\times\sbf A$
\end_inset

，现在右手螺旋三元组为 
\begin_inset Formula $(\sbf B',\sbf Z,\sbf A)$
\end_inset


\end_layout

\begin_layout Enumerate
再令 
\begin_inset Formula $\sbf A'=\sbf B'\times\sbf Z$
\end_inset

，现在右手螺旋三元组为 
\begin_inset Formula $(\sbf A',\sbf B',\sbf Z)$
\end_inset


\end_layout

\begin_layout Standard
现在三元组是两两垂直的，
\begin_inset Formula 
\begin{align*}
 & \sbf Z\times\sbf B'\\
 & =(\sbf A\times\sbf B)\times(\sbf Z\times\sbf A)\\
 & =(\sbf A\times\sbf B)\times(\sbf A\times\sbf B\times\sbf A)=0
\end{align*}

\end_inset


\begin_inset Formula $\sbf Z\times\sbf A'$
\end_inset

 同理。所以最终 
\begin_inset Formula $(\sbf A',\sbf B',\sbf Z)$
\end_inset

 即为局部正交基，
\begin_inset Formula $\sbf Z$
\end_inset

 垂直于原先的 
\begin_inset Formula $\sbf A$
\end_inset

–
\begin_inset Formula $\sbf B$
\end_inset

 平面
\end_layout

\begin_layout Chapter
泛函与弱形式
\end_layout

\begin_layout Section
变分法
\end_layout

\begin_layout Standard
ref:
\begin_inset CommandInset href
LatexCommand href
name "变分法简介Part 1"
target "https://zhuanlan.zhihu.com/p/20718489"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "变分法简介Part 2"
target "https://zhuanlan.zhihu.com/p/20727402"
literal "false"

\end_inset


\end_layout

\begin_layout Definition
\begin_inset Argument 1
status open

\begin_layout Plain Layout
泛函数 (Functionals)
\end_layout

\end_inset

 简而言之，泛函数是 函数 的函数，即它的输入是函数，输出是实数。而这个输出值取决于一个或多个函数（输入）在一整个路径上的积分，而非像一般函数一样取决于离散的变
量。
\end_layout

\begin_layout Standard
通常在变分法中，泛函数是一个积分，记做
\begin_inset Formula $I$
\end_inset

，例如
\begin_inset Formula 
\[
I=\int_{x_{1}}^{x^{2}}F\dd{x}.
\]

\end_inset

其中我们想要通过 选择被积函数 
\begin_inset Formula $F$
\end_inset

 来最大化或最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的值。同时我们称 
\begin_inset Formula $F$
\end_inset

 为拉格朗日函数(Lagrange function)。
\begin_inset Formula $F$
\end_inset

 可以是函数 
\begin_inset Formula $y(x)$
\end_inset

 和 
\begin_inset Formula $y(x)$
\end_inset

 各阶导数的函数(以下 
\begin_inset Formula $y(x)$
\end_inset

均简写成 
\begin_inset Formula $y$
\end_inset

)。
\end_layout

\begin_layout Definition
\begin_inset CommandInset label
LatexCommand label
name "def:extreme"

\end_inset


\begin_inset Argument 1
status open

\begin_layout Plain Layout
泛函数的极值
\end_layout

\end_inset

 泛函数 
\begin_inset Formula $I$
\end_inset

 在区间 
\begin_inset Formula $[x_{1},x_{2}]$
\end_inset

 上的值取决于积分路径的选择，即取决于函数 
\begin_inset Formula $y(x)$
\end_inset

 的选择。我们有理由假设存在一个这样的 
\begin_inset Formula $y(x)$
\end_inset

，可以使得泛函数 
\begin_inset Formula $I$
\end_inset

 取到极值。而在这个 
\begin_inset Formula $y(x)$
\end_inset

 附近的任意路径我们记做 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

。另外，我们假设 
\begin_inset Formula $y(x)$
\end_inset

 两阶可微。通过引入一个微小量 
\begin_inset Formula $\epsilon\ll1$
\end_inset

 和一个任意可微函数 
\begin_inset Formula $\eta(x)$
\end_inset

，我们可以用 
\begin_inset Formula $y(x)$
\end_inset

 表示 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

：
\begin_inset Formula 
\[
\tilde{y}(x)=y(x)+\epsilon\eta(x).
\]

\end_inset


\end_layout

\begin_layout Standard
这样做的好处是对于一个给定的 
\begin_inset Formula $\eta(x)$
\end_inset

，我们可以通过改变的 
\begin_inset Formula $\eta$
\end_inset

 值来得到无穷多的路径，同时对于任何 
\begin_inset Formula $\eta(x)$
\end_inset

，当 
\begin_inset Formula $\epsilon(x)=0$
\end_inset

 的时候，
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 和 
\begin_inset Formula $y(x)$
\end_inset

 重合。图像直观表示如下图：
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/fanhan-1.png
	lyxscale 50
	scale 45

\end_inset


\end_layout

\begin_layout Standard
由于在边界条件的限制，需要要求 
\begin_inset Formula $\eta(x_{1})=\eta(x_{2})=0$
\end_inset

。这样就能保证 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 可以通过两个固定端点。这时我们可以说，
\begin_inset Formula $y(x)$
\end_inset

 所对应的泛函数 
\begin_inset Formula $I$
\end_inset

 的值是泛函数 
\begin_inset Formula $\tilde{I}=\int_{x_{1}}^{x^{2}}F\left(\tilde{y},\tilde{y}';x\right)\dd{x}$
\end_inset

 的极值。我们可以进一步用 
\begin_inset Formula $\epsilon$
\end_inset

 表示 
\begin_inset Formula $\tilde{I}$
\end_inset

：
\begin_inset Formula 
\[
\tilde{I}=\int_{x_{1}}^{x^{2}}F(\tilde{y},\tilde{y}';x)\dd{x}=\int_{x_{1}}^{x^{2}}F\left(y+\epsilon\eta,y'+\epsilon\eta';x\right)\dd{x}
\]

\end_inset

虽然 
\begin_inset Formula $y(x)$
\end_inset

 未知，但是根据之前的合理假设，
\begin_inset Formula $y(x)$
\end_inset

 是一个存在的确定函数。所以根据上式，如果给定一个特定的 
\begin_inset Formula $\eta(x)$
\end_inset

，
\begin_inset Formula $\tilde{I}$
\end_inset

 的变化只取决于 
\begin_inset Formula $\epsilon$
\end_inset

 的变化。所以我们现在可以把 
\begin_inset Formula $\tilde{I}$
\end_inset

 看做是 
\begin_inset Formula $\epsilon$
\end_inset

 的函数。用泰勒展开公式将 
\begin_inset Formula $\tilde{I}$
\end_inset

 在
\begin_inset Formula $\epsilon=0$
\end_inset

 处展开得到：
\begin_inset Formula 
\[
\tilde{I}(\epsilon)=\left.\tilde{I}\right|_{\epsilon=0}+\left.(\frac{\dd{\tilde{I}}}{\dd{\epsilon}})\right|_{\epsilon=0}\cdot\epsilon+\left.(\frac{\dd[2]{\tilde{I}}}{\dd{\epsilon^{2}}})\right|_{\epsilon=0}\cdot\frac{\epsilon^{2}}{2!}+\cdots=\tilde{I}_{0}+\tilde{I}_{1}\epsilon+\tilde{I}_{2}\epsilon^{2}+\cdots
\]

\end_inset

很明显，当 
\begin_inset Formula $\epsilon=0$
\end_inset

 时，
\begin_inset Formula $\left.\tilde{I}\right|_{\epsilon=0}=I$
\end_inset

，代入上式可得到：
\begin_inset Formula 
\[
\tilde{I}-I=\tilde{I}_{1}\epsilon+\tilde{I}_{2}\epsilon^{2}+\cdots
\]

\end_inset

这里我们记 
\begin_inset Formula $\delta I=\tilde{I}_{1}\epsilon=\left.(\frac{\dd{\tilde{I}}}{\dd{\epsilon}})\right|_{\epsilon=0}\cdot\epsilon$
\end_inset

，并称之为一阶变分。同理二阶变分为 
\begin_inset Formula $\delta I^{2}=\tilde{I}_{2}\epsilon^{2}$
\end_inset

。
\end_layout

\begin_layout Remark
这里插一句变分和微分的区别。变分在上图的直观解释是
\begin_inset Formula $\tilde{y}$
\end_inset

和 
\begin_inset Formula $y$
\end_inset

 在竖直方向上的距离，称之为 
\begin_inset Formula $\delta y$
\end_inset

，所以这个差是在同一个 
\begin_inset Formula $x$
\end_inset

 上计算的。而微分则是由于 
\begin_inset Formula $x$
\end_inset

 的微小变动引起的 
\begin_inset Formula $y$
\end_inset

 的变动。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
然后我们可以类比求函数极值时的做法。求函数极值时，我们会令函数的一阶导数为零。这里同样，为了求泛函数 
\begin_inset Formula $\tilde{I}$
\end_inset

 的极值，我们令一阶变分 
\begin_inset Formula $\delta I=0$
\end_inset

。计算 
\begin_inset Formula $\delta I$
\end_inset

，并通过分部积分得到
\begin_inset Formula 
\[
\delta I=\int_{x_{1}}^{x^{2}}\left(\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}\right)\delta y\dd{x}+\left.\frac{\partial F}{\partial y'}\delta y\right|_{x_{1}}^{x_{2}}
\]

\end_inset

令 
\begin_inset Formula $\delta I=0$
\end_inset

 就能解得最小化泛函数的 
\begin_inset Formula $y$
\end_inset

。由于 
\begin_inset Formula $\delta y$
\end_inset

 是任意地，所以要想使上式等于零，需要
\begin_inset Formula 
\[
\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}=0,\quad x_{1}\le x\le x_{2}
\]

\end_inset

即 欧拉–拉格朗日方程（Euler–Lagrange equation）。而第二部分等于零则是边界条件。
\end_layout

\begin_layout Standard
对于边界条件：
\end_layout

\begin_layout Enumerate
如果在边界 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 
\begin_inset Formula $\frac{\partial F}{\partial y'}$
\end_inset

 等于零，那么我们称在 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 满足 
\series bold
Natural Boundary Condition
\series default
。
\end_layout

\begin_layout Enumerate
对应的，如果在边界 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 
\begin_inset Formula $\delta y$
\end_inset

 等于零，我们就称 在 
\begin_inset Formula $x_{1}$
\end_inset

 或 
\begin_inset Formula $x_{2}$
\end_inset

 处 满足 
\series bold
Essential Boundary condition
\series default
。
\begin_inset Formula $\delta y=0$
\end_inset

 是一个比较模糊的概念，不好判断，所以我们把它等价转化一下。如果
\begin_inset Formula $y$
\end_inset

在某一点处的变分为零，说明它在这点的值是确定不变的。换句话说如果 
\begin_inset Formula $y$
\end_inset

 在边界上是确定的值(specified)，那么我们称这个是 essential boundary condition。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
当然上述问题中，
\begin_inset Formula $F$
\end_inset

 只是
\begin_inset Formula $y$
\end_inset

和
\begin_inset Formula $y'$
\end_inset

的函数，但是
\begin_inset Formula $F$
\end_inset

完全还可能是
\begin_inset Formula $y''$
\end_inset

甚至更高阶导数的函数。这时候我们用上节所说的设 
\begin_inset Formula $\tilde{y}=y(x)+\epsilon\eta(x)$
\end_inset

 的方法就有点麻烦了（但是也可行）。这里我们提供一个更高效的方法，直接对泛函数求变分。假如泛函数 
\begin_inset Formula $I=\int_{x_{1}}^{x^{2}}F(\tilde{y},\tilde{y}',y'';x)\dd{x}$
\end_inset

，那么它的一阶变分为：
\begin_inset Formula 
\[
\delta I=\int_{x_{1}}^{x^{2}}\frac{\partial F}{\partial y}\delta y+\frac{\partial F}{\partial y'}\delta y'+\frac{\partial F}{\partial y''}\delta y''\dd{x}
\]

\end_inset

然后再进行分部积分得到：
\begin_inset Formula 
\[
\delta I=\int_{x_{1}}^{x^{2}}\left(\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}+\frac{\dd[2]}{\dd{x^{2}}}\frac{\partial F}{\partial y''}\delta\right)\delta y\dd{x}+\frac{\partial F}{\partial y''}\delta y'+\left.\left[\frac{\partial F}{\partial y'}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y''}\right]\delta y\right|_{x_{1}}^{x_{2}}=0
\]

\end_inset

同样我们可以得到欧拉-拉格朗日方程：
\begin_inset Formula 
\[
\text{E-L:}\,\frac{\partial F}{\partial y}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y'}+\frac{\dd[2]}{\dd{x^{2}}}\frac{\partial F}{\partial y''}=0
\]

\end_inset

以及边界条件：
\begin_inset Formula 
\begin{align*}
\frac{\partial F}{\partial y''}=0,\;\text{(Natural)}\quad & \text{or}\quad\delta y'=0\;\text{(Essential)}\\
\frac{\partial F}{\partial y'}-\frac{\dd}{\dd{x}}\frac{\partial F}{\partial y''}=0,\;\text{(Natural)}\quad & \text{or}\quad y=0\;\text{(Essential)}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection
约束条件（拉格朗日乘数）
\end_layout

\begin_layout Standard
现在我们来讨论下如果我们需要求在满足一定条件下求泛函数的极值，应该如何求解。
\end_layout

\begin_layout Standard
举个简单的例子，如果给定一个区域的边界长度，我们想最大化该边界所围的区域。这类问题我们需要引进拉格朗日乘数(
\begin_inset Formula $\lambda$
\end_inset

)。
\end_layout

\begin_layout Standard
假设约束条件为：
\begin_inset Formula $J(y)=\int_{x_{1}}^{x_{2}}G(y,y';x)=\text{const.}$
\end_inset

那我们引入拉格朗日乘数在原泛函数的基础上构建新的泛函数：
\begin_inset Formula 
\[
I^{*}=I+\lambda J=\int_{x_{1}}^{x_{2}}(F+\lambda G)\dd{x}=\int_{x_{1}}^{x_{2}}F^{*}(y,y';x)\dd{x}
\]

\end_inset

然后我们就可以转化成之前的问题来解了。还是用刚才提到的最大化面积问题为例来阐述下这个过程：
\end_layout

\begin_layout Enumerate
面积：
\begin_inset Formula $A=\int_{x_{1}}^{x_{2}}y\dd{x}$
\end_inset

，
\end_layout

\begin_layout Enumerate
边界长度约束：
\begin_inset Formula $S=\int_{x_{1}}^{x_{2}}\sqrt{1+(y')}^{2}\dd{x}=\text{const.}$
\end_inset


\end_layout

\begin_layout Enumerate
则：
\begin_inset Formula $I^{*}=\int_{x_{1}}^{x_{2}}[y+\lambda\sqrt{1+(y')}^{2}]\dd{x}$
\end_inset


\end_layout

\begin_layout Enumerate
令一阶变分为零（
\begin_inset Formula $\delta I^{*}=0$
\end_inset

）：
\begin_inset Formula 
\[
\int_{x_{1}}^{x_{2}}[\delta y+\lambda\frac{y'}{\sqrt{1+(y')}^{2}}\delta y']\dd{x}=0
\]

\end_inset

依旧老朋友分部积分：
\begin_inset Formula 
\[
\delta I^{*}=\int_{x_{1}}^{x_{2}}[1-\lambda\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}]\delta y\dd{x}+\text{B.C.term}=0
\]

\end_inset

这里图方便我就将边界条件项用 B.C.term 代替啦。然后欧拉-拉格朗日方程为：
\begin_inset Formula 
\[
\text{E-L:}\,1-\lambda\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}=0,\quad x\in(x_{1},x_{2})
\]

\end_inset


\end_layout

\begin_layout Enumerate
现在我们可以解一下E-L方程：
\begin_inset Formula 
\[
\frac{\dd}{\dd{x}}\frac{y'}{\sqrt{1+(y')}^{2}}=\frac{1}{\lambda}\quad\Rightarrow\quad\frac{y''}{(1+y^{\prime2})^{3/2}}=\frac{1}{\lambda}.
\]

\end_inset

也就是说边界是曲率恒为 
\begin_inset Formula $\frac{1}{\lambda}$
\end_inset

 的曲线，即半径为 
\begin_inset Formula $\lambda$
\end_inset

 的圆，这也和我们常识一致。
\end_layout

\begin_layout Standard
上文说到了用 
\emph on
最小化泛函数
\emph default
 的方法求解问题，最终可以将问题转化为求解一个带有边界条件的偏微分方程（PDE）。但是实际上并不是所有的 PDE 都像上次那个两点间最短距离问题中的PDE那么好
解，这也就是为什么我们要有有限元方法，因为有限元可以避开求解复杂偏微分方程，用相对简单的方法来求解其近似解。一般有三种近似方法，分别是 
\series bold
Rayleigh-Ritz method
\series default
，
\series bold
Strong Form Galerkin
\series default
 (SFG) 和 
\series bold
Weak Form Galerkin
\series default
 (WFG)。后两者就是我们常听说的貌似比较高大上的 
\series bold
强形式
\series default
 和 
\series bold
弱形式
\series default
。后面会分别介绍和比较这三种方法。以后的文章会介绍如何将他们运用于有限元方法。
\end_layout

\begin_layout Standard
在最开始，首先要理清一个非常重要的思路。那就是通过变分法最小化泛函数得到的 PDE 和 原泛函数 之间的关系。如果理清了这个关系，上述三种方法的基本思想就算是掌
握了，剩下的就是一些数学而已了。它们之间的关系是：PDE 的解是能将原泛函数最小化的函数。
\end_layout

\begin_layout Standard
这层关系给我们提供了两条路走：
\end_layout

\begin_layout Enumerate
直接从泛函数出发，找出可以最小化它的函数。
\end_layout

\begin_layout Enumerate
通过变分法得到PDE，然后求解PDE（近似求解），这样得到的PDE的解（或近似解）就是方法1中所要求的函数。
\end_layout

\begin_layout Standard
上面提到的三种方法就是顺着这两条路走的。Rayleigh-Ritz 对应于第一条路，强弱形式对应于后一条路。看上去 Rayleigh-Ritz
 法和求解微分方程并没有什么关系，因为它跳过了通过变分法得到 PDE 这个步骤，但是根据上面提到的关系，我们可以把思维逆转过来，即 能够将 泛函数最小化的函数，
是使用变分法后得到的PDE的解。这样我们也可以强行把 Rayleigh-Ritz 法看成是近似求解微分方程的方法。
\end_layout

\begin_layout Section
Rayleigh-Ritz Method
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "Rayleigh-Ritz Method"
target "https://zhuanlan.zhihu.com/p/20882021"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
第一条路看似是更直接的捷径，但是世界上有无穷种函数，直接找出可以最小化一个泛函数的函数谈何容易。但是如果我们先假设一下这个函数的形式，那么未知的就只是一些系数了
，再将这个假设的函数代入 原泛函数，就可以将泛函数转化为未知系数的函数，而最小化函数对我们而言是轻而易举的（对未知系数求导等于零），解出未知系数后代入假设的函数
，就得到了最小化泛函数的近似解。这就是 Rayleigh-Ritz Method 的基本思想。一般来说，我们会将近似函数的形式设为多项式(polynomial)
，例如，这也是有限元里常用的形式。话不多说，看个简单的例子：
\end_layout

\begin_layout Example
如图，拉伸一个横截面积为 
\begin_inset Formula $A$
\end_inset

，长为 
\begin_inset Formula $L$
\end_inset

，杨氏模量为 
\begin_inset Formula $E$
\end_inset

 的杆，最右端的力为 
\begin_inset Formula $P$
\end_inset

，位移为 
\begin_inset Formula $u_{0}$
\end_inset

。我们想要用最小势能原理解出其位移场 
\begin_inset Formula $u(x)$
\end_inset

。虽然很明显精确解是 
\begin_inset Formula $u(x)=\frac{u_{0}}{L}x$
\end_inset

，但是就像之前的两点间直线最短的例子一样，例子虽然简单，但是可以帮助我们感受下这个方法的过程。
\end_layout

\begin_layout Example
\begin_inset Graphics
	filename inset/fanhan-2.png

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
我们可以写出系统势能（具体为什么是这个式子之后的文章会解释，这次着重于介绍方法的思想）：
\begin_inset Formula $\Pi=\frac{1}{2}\int_{0}^{L}EA\,u^{\prime2}\dd{x}-Pu_{0}$
\end_inset

。由于左端固定，右端位移已知，所以有两个 Essential Boundary Conditions: 
\begin_inset Formula $\left.u\right|_{x=0}=0$
\end_inset

 和 
\begin_inset Formula $\left.u\right|_{x=L}=u_{0}$
\end_inset

 。
\end_layout

\begin_layout Standard
根据上文的思路，我们设待求函数 
\begin_inset Formula $u(x)$
\end_inset

 的形式为多项式。这里姑且先设成二次形式。一般来说，设的次数越高，近似解越精确，但是由于本例精确解就是个一次线性方程，所以只要设的函数高于
\begin_inset Formula $1$
\end_inset

次，近似解就和精确解相同。另一个需要注意的是，使用 Rayleigh-Ritz 法时，设的近似方程（如本例中的
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 ）必须满足 Essential Boundary Conditions(不必须满足Natural Boundary Condition)。遵循这点，我们可以得
出两个等式：
\begin_inset Formula 
\[
\tilde{u}(0)=0,\quad\text{and}\quad\tilde{u}(L)=0,
\]

\end_inset

由上述两式可以解出 
\begin_inset Formula $a_{0}=0$
\end_inset

 以及 
\begin_inset Formula 
\[
a_{1}L+a_{2}L^{2}=u_{0}\Rightarrow a_{2}=\frac{u_{0}-a_{1}L}{L^{2}},
\]

\end_inset

将这两个结果代入 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 整理下得到：
\begin_inset Formula 
\[
\tilde{u}(x)=\frac{u_{0}}{L^{2}}x^{2}+a_{1}(x-\frac{x^{2}}{L}).
\]

\end_inset

也就是说我们只有 
\begin_inset Formula $1$
\end_inset

 个未知参数 
\begin_inset Formula $a_{1}$
\end_inset

。
\end_layout

\begin_layout Standard
通常我们会将 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 写成 
\begin_inset Formula $\tilde{u}(x)=\phi_{0}(x)+\sum_{j=1}^{n}c_{j}\phi_{j}(x)$
\end_inset

 的形式。对应这个例子
\begin_inset Formula 
\[
\phi_{0}=\frac{u_{0}}{L^{2}}x^{2},\quad c_{1}=a_{1},\quad\phi_{1}=\frac{x}{L}(L-x),
\]

\end_inset

如果有更多未知参数，则会有更高阶项。
\begin_inset Formula $\phi_{i}$
\end_inset

 有个 
\series bold
重要性质
\series default
：从 
\begin_inset Formula $\phi_{1}$
\end_inset

 开始，所有的 
\begin_inset Formula $\phi_{i}$
\end_inset

 在 Essential Boundary Condition 处都等于零。比如这个例子中，在 
\begin_inset Formula $x=0$
\end_inset

和
\begin_inset Formula $x=L$
\end_inset

处有 Essential Boundary Condition，那么
\begin_inset Formula $\phi_{1}$
\end_inset

 在
\begin_inset Formula $x=0$
\end_inset

和
\begin_inset Formula $x=L$
\end_inset

处必须等于零。我们可以发现确实满足，如果有更高阶项 
\begin_inset Formula $\phi_{2}$
\end_inset

，
\begin_inset Formula $\phi_{3}$
\end_inset

 等等，同样应该满足。这个性质可以帮助我们检查假设的 近似函数是否正确。现在需要做的就是把 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 代入到原泛函数中，即用 
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 取代 
\begin_inset Formula $u(x)$
\end_inset

。
\begin_inset Formula 
\begin{align*}
 & \tilde{u}'(x)=\frac{2u_{0}}{L^{2}}x+c_{1}(1-\frac{2x}{L})\\
 & \Pi=\frac{1}{2}\int_{0}^{L}EA\,\tilde{u}'(x)^{2}\dd{x}-Pu_{0}=\frac{EA}{2}(\frac{4u_{0}^{2}}{3L}+\frac{c_{1}^{2}L}{3}-\frac{2u_{0}c_{1}}{3})-Pu_{0}
\end{align*}

\end_inset

这样 
\begin_inset Formula $\Pi$
\end_inset

 就仅是 
\begin_inset Formula $c_{1}$
\end_inset

 的函数而已，那么最小化就非常简单了，即令
\begin_inset Formula $\frac{\dd{\Pi}}{\dd{c_{1}}}=0$
\end_inset

：
\begin_inset Formula 
\[
\frac{\dd{\Pi}}{\dd{c_{1}}}=\frac{2}{3}c_{1}L-\frac{2}{3}u_{0}=0,
\]

\end_inset

解得 
\begin_inset Formula $c_{1}=\frac{u_{0}}{L}$
\end_inset

。代入
\begin_inset Formula $\tilde{u}(x)$
\end_inset

 得到 
\begin_inset Formula $\tilde{u}(x)=\frac{u_{0}}{L}x$
\end_inset

。可以看到这和精确解一致，这是由于所设的近似方程的形式恰巧和精确解方程的形式一样，但是大多数问题中，精确解一般都不是多项式，所以如果将近似函数设为多项式，则会产
生误差，得出的结果则是近似解。
\end_layout

\begin_layout Standard
上面这个例子并不能令人感到兴奋，因为本身就是一眼就能看出精确解的问题硬生生算了半天，感觉很傻，所以再举个稍微复杂点的例子感受下。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset CommandInset label
LatexCommand label
name "exa:2.2"

\end_inset

泛函为
\begin_inset Formula 
\[
I[y(x);x]=\int_{0}^{2}\left[0.5(y'')^{2}+5(y')^{2}+2y^{2}+y\right]\dd{x}-10y(0),
\]

\end_inset


\end_layout

\begin_layout Enumerate
Essential Boundary Conditions: 
\begin_inset Formula $y(2)=0$
\end_inset

；
\begin_inset Formula $y'(0)=-2$
\end_inset

。
\end_layout

\begin_layout Enumerate
Natural Boundary Conditions: ; 
\begin_inset Formula $y'''(0)=-10$
\end_inset

；
\begin_inset Formula $y''(2)=0$
\end_inset

。
\end_layout

\begin_layout Standard
有兴趣的可以用 Rayleigh-Ritz方法求解下，可以最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的近似解函数 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

。
\end_layout

\begin_layout Section
Strong Form Galerkin
\end_layout

\begin_layout Standard
上文介绍了 Rayleigh-Ritz 法。一句话概括下就是：将 
\series bold
泛函数
\series default
 中的待求函数设成带有 
\series bold
未知系数
\series default
 的已知形式（如多项式），并将其带入 原泛函数，从而将 
\series bold
最小化泛函数
\series default
 的问题简化成我们熟悉的 
\series bold
最小化函数
\series default
 问题来求解未知系数，最后就得出了待求函数的近似解。而这次文章以及下次文章要说到的强形式和弱形式（Strong form & Weak form
 Galerkin）法是从求解 PDE 出发的。类似于 Rayleigh-Ritz 法的思路，我们可以把PDE的解近似为一系列基函数的叠加（需要满足边界条件）。
例如如果我们要解这样一个PDE：
\begin_inset Formula 
\[
A[w(x)]-f=0,
\]

\end_inset

其中 
\begin_inset Formula $A[w(x)]$
\end_inset

 代表对待求函数 
\begin_inset Formula $w(x)$
\end_inset

 的任意微分运算，例如 
\begin_inset Formula $A[w(x)]=\frac{\partial^{2}w}{\partial x^{2}}$
\end_inset

。那么我们可以用公式写出这个PDE 的近似解为：
\begin_inset Formula 
\[
\tilde{w}(x)=\phi_{0}(x)+\sum_{j=1}^{n}c_{j}\phi_{j}(x)
\]

\end_inset

其中 
\begin_inset Formula $\phi_{j}(x)$
\end_inset

 是已知的基函数(basis functions)，
\begin_inset Formula $c_{j}$
\end_inset

 是待解的未知系数。
\begin_inset Formula $\phi_{0}(x)$
\end_inset

 是用来满足非其次边界条件的，下面会结合例子说明。
\end_layout

\begin_layout Standard
很显然，除非精确解恰巧和我们设的近似解形式相同，不然近似解是和精确解有偏差的。换句话说，如果我们把近似解 
\begin_inset Formula $\tilde{w}(x)$
\end_inset

 代入原PDE，那么将不会等于
\begin_inset Formula $0$
\end_inset

，会带来一些 
\series bold
残差
\series default
 或余量。用公式表示就是 
\begin_inset Formula 
\[
A[\tilde{w}(x)]-f=R\neq0.
\]

\end_inset

这样问题就转化为求解出 
\begin_inset Formula $c_{j}$
\end_inset

 使得余量 
\begin_inset Formula $R$
\end_inset

 在求解域上尽可能小（尽可能接近
\begin_inset Formula $0$
\end_inset

），这样我们的近似解越逼近于精确解。
\end_layout

\begin_layout Standard
这时候我们需要使用 加权余量法(Method of Weighted Residual)。这种方法的基本思想是，既然不能找到准确解使余量
\begin_inset Formula $R$
\end_inset

在整个求解域上都完全等于零，那么我们至少要找到一个近似解使余量
\begin_inset Formula $R$
\end_inset

在求解域上的某种平均等于零。说到某种平均第一反应会是将
\begin_inset Formula $R$
\end_inset

在求解域上积分，即令 
\begin_inset Formula $\int R\dd{x}=0$
\end_inset

，但这其实是个比较糟糕的想法，满足这个式子的有无穷种可能性，根本不可解。合理的做法是令
\begin_inset Formula $R$
\end_inset

的加权积分为零，写成公式即：
\begin_inset Formula 
\[
\int R(x)\Phi_{i}(x)\dd{x}=0,\quad i=1,\cdots,n
\]

\end_inset

其中 
\begin_inset Formula $\Phi_{i}$
\end_inset

 是 
\series bold
权函数
\series default
(weighted function)。权函数的选择有多种方法，这里介绍的同时也是有限元中常用的一种即 Galerkin method。该方法将近似解中的
 
\series bold
基函数
\series default
 直接当做 权函数(一个用大写的 
\begin_inset Formula $\Phi_{i}$
\end_inset

 一个用小写的 
\begin_inset Formula $\phi$
\end_inset

，有没有一种钦定的感觉)。这样做的好处是，独立等式的数量（即
\begin_inset Formula $\phi_{i}$
\end_inset

的数量）和待解
\begin_inset Formula $c_{j}$
\end_inset

的数量相同，这样就能确保未知系数唯一且可解。解出后代入就可以得到近似解啦。
\end_layout

\begin_layout Standard
以上面的 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 为例，这次使用 Strong Form Galerkin，这里仅用一个未知系数。
\end_layout

\begin_layout Solution
首先大家可以用变分法证明下，能够最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的解和下面这个PDE的解是等价的。
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
y''''-10y''+4y+1=0,\quad0<x<2
\]

\end_inset

加上上述题目中的边界条件。
\end_layout

\begin_layout Standard
基本思路是写出 
\begin_inset Formula $I$
\end_inset

 的一阶变分
\begin_inset Formula 
\begin{equation}
\delta I=\int_{0}^{2}\left[y''\delta(y'')+10y'\delta(y')+4y\delta y+\delta y\right]\dd{x},\label{eq:variation1}
\end{equation}

\end_inset

然后再分部积分，即可得到 
\begin_inset CommandInset ref
LatexCommand eqref
reference "rem1"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\begin{equation}
\delta I=\int_{0}^{2}\left(y''''-10y''+4y+1\right)\delta y\dd{x}+\text{Boundary terms}.\label{eq:var-bound}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
总之现在问题就变成使用 Strong Form Galerkin求解一个带有边界条件的PDE。回顾下文章开头，第一步是设出PDE的近似解，我们一般采用多项式形式
。这里要注意，使用 Strong Form Galerkin 的时候，设的近似解既要满足 Essential boundary condition
 又要满足 Natural Boundary condition。也就是说在本例中，四个边界条件都需要满足。假设我们只用一个未知系数，那么这个多项式必须要是四次
的，即：
\begin_inset Formula 
\[
\tilde{y}=a_{1}x^{4}+a_{2}x^{3}+a_{3}x^{2}+a_{4}x+a_{5}.
\]

\end_inset

因为若要满足边界条件，我们需要列出四个等式，然后上式有五个未知系数，等于最终我们只有一个未知系数。现在我们将边界条件带入近似解：
\begin_inset Formula 
\[
\tilde{y}(2)=0;\quad\tilde{y}'(0)=-2;\quad\tilde{y}'''(0)=-10;\quad\tilde{y}''(2)=0.
\]

\end_inset

可以解得：
\begin_inset Formula 
\[
\tilde{y}(x)=-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}+a_{4}(x^{4}-24x^{2}+80),
\]

\end_inset

上式中， 
\begin_inset Formula $-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}$
\end_inset

 是
\begin_inset Formula $\phi_{0}$
\end_inset

，然后 
\begin_inset Formula $a_{4}$
\end_inset

是
\begin_inset Formula $c_{1}$
\end_inset

; 最后 
\begin_inset Formula $(x^{4}-24x^{2}+80)$
\end_inset

是
\begin_inset Formula $\phi_{1}$
\end_inset

。
\end_layout

\begin_layout Standard
接着计算残差或者余量：
\begin_inset Formula 
\[
R=\tilde{y}''''-10\tilde{y}''+4\tilde{y}+1,
\]

\end_inset

可见
\begin_inset Formula $R$
\end_inset

 是
\begin_inset Formula $a_{4}$
\end_inset

和
\begin_inset Formula $x$
\end_inset

的函数。最后计算加权积分：
\begin_inset Formula 
\[
\int_{0}^{2}\left[(\tilde{y}''''-10\tilde{y}''+4\tilde{y}+1)(x^{4}-24x^{2}+80)\right]\dd{x}=0.
\]

\end_inset

上式仅有一个未知数 
\begin_inset Formula $a_{4}$
\end_inset

，可以解得其值为 
\begin_inset Formula $0.2985$
\end_inset

，所以最终求得的近似解是：
\begin_inset Formula 
\[
\tilde{y}(x)=-\frac{5}{3}x^{3}+10x^{2}-2x-\frac{68}{3}+0.2985(x^{4}-24x^{2}+80),
\]

\end_inset

我用Matlab简单画了下上述近似解和精确解的比较，有没有很失望啊。这是由于我们只用了一个未知系数，如果用两个甚至更多的话，近似解是十分逼近精确解的，有兴趣的可
以自行尝试~
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/fanhan-3.png
	lyxscale 45
	scale 40

\end_inset


\end_layout

\begin_layout Remark
\begin_inset CommandInset label
LatexCommand label
name "rem1"

\end_inset

下面两个等式是由分部积分得来的：
\begin_inset Formula 
\begin{align*}
 & \int_{0}^{2}[y''\delta y'']\dd{x}=\int_{0}^{2}[y''''\delta y]\dd{x}-\left.y'''\delta y\right|_{0}^{2}+\left.y''\delta y'\right|_{0}^{2}\\
 & \int_{0}^{2}[10y'\delta y']\dd{x}=10(-\int_{0}^{2}[y''\delta y]\dd{x}+\left.y'\delta y\right|_{0}^{2})
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:var-bound"
plural "false"
caps "false"
noprefix "false"

\end_inset

 是把所有积分项合并，然后其余边界项统一称为 Boundary terms 得到的。
\end_layout

\begin_layout Section
Weak Form Galerkin
\end_layout

\begin_layout Standard

\series bold
弱形式
\series default
 是应用最广也是被应用于有限元的方法。弱形式和强形式的本质是一致的，其实可以通过 
\series bold
分部积分
\series default
 将 强形式 转化为弱形式。强形式的主要缺点在于，所设的近似解函数需要有非常高阶的可微性。以 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 为例，待解的微分方程含有四阶导数项
\begin_inset Formula $y''''$
\end_inset

，所以所设的近似解函数需要保证四阶导数不为零，如果使用多项式形式的话，则最高次项至少要是四次。这和上文提到的由于四个边界条件都要满足，所以至少要是四次的结论是一
致的。
\end_layout

\begin_layout Standard
对应的，
\series bold
弱形式的优点在于可以通过分部积分将要求的可微次数减半，并且近似解函数只需满足 Essential boundary condition，不必满足
 Natural boundary condition
\series default
。直接说这个结论比较难以理解，还是结合一个简单的例子说明。
\end_layout

\begin_layout Standard
假设我们现在要解这样一个带边界条件的微分方程：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
y''-y-1=0;\quad\text{B.C.:}\;y(0)=1,\quad y'(1)=0
\]

\end_inset

其中 
\begin_inset Formula $y(0)=1$
\end_inset

 是 Essential boundary condition，
\begin_inset Formula $y'(1)=0$
\end_inset

 是Natural boundary condition。根据上一篇文章中强形式的思路，我们会将微分方程乘以一个 
\series bold
权函数
\series default
（基函数），然后令加权积分为零。在弱形式中，我们将乘的这个函数称为 
\series bold
检验函数
\series default
(test function)，用 
\begin_inset Formula $v(x)$
\end_inset

 表示。（后文会谈到这个 
\begin_inset Formula $v(x)$
\end_inset

 和待解函数的变分 
\begin_inset Formula $\delta y$
\end_inset

 不可告人的关系）。现在我们得到了下式：
\begin_inset Formula 
\[
\int_{0}^{1}\left[(y''-y-1)v\right]\dd{x}=\int_{0}^{1}y''v\dd{x}-\int_{0}^{1}yv\dd{x}-\int_{0}^{1}v\dd{x}=0.
\]

\end_inset

我们可以发现第二项积分内 
\begin_inset Formula $y$
\end_inset

 和 
\begin_inset Formula $v$
\end_inset

 的微分次数是一样的（都是零次微分），但是第一项积分内是二次微分而检验函数是零次微分。如果使用分部积分，就可以将一次微分转移到检验函数 
\begin_inset Formula $v$
\end_inset

上，
\series bold
这样 
\begin_inset Formula $y$
\end_inset

 的近似解函数只需是一阶线性的而不用是二次的了(对应上文提到的将要求的可微分次数减半)
\series default
。通过分部积分可得：
\begin_inset Formula 
\[
\int_{0}^{1}y''v\dd{x}=-\int_{0}^{1}y'v'\dd{x}+\left.y'v\right|_{0}^{1}
\]

\end_inset

这样积分内 
\begin_inset Formula $y$
\end_inset

 和 
\begin_inset Formula $v$
\end_inset

 的微分次数就一样了，看上去很舒服，处女座的福音啊，没错我就是。想起小学数学老师说的，数学是应该有美感的。不小心扯远了。。
\end_layout

\begin_layout Standard
现在我们来处理边界项 
\begin_inset Formula $\left.y'v\right|_{0}^{1}$
\end_inset

，
\begin_inset Formula 
\[
\left.y'v\right|_{0}^{1}=\left.y'v\right|_{x=1}-\left.y'v\right|_{x=0}=y'(1)v(1)-y'(0)v(0)
\]

\end_inset

由边界条件可知，
\begin_inset Formula $y'(1)=0$
\end_inset

 。另外由于在 
\begin_inset Formula $x=0$
\end_inset

 处有 Essential boundary condition 
\begin_inset Formula $y(0)=1$
\end_inset

 ，所以 
\begin_inset Formula $v(0)=0$
\end_inset

。（这是基函数的性质，即在有Essential boundary condition 的点处为零，后面会从另一个角度阐述这个性质）)。将 
\begin_inset Formula $y'(1)=0$
\end_inset

 和 
\begin_inset Formula $v(0)=0$
\end_inset

 代入边界项可得出边界项为零。当然这种情况只是巧合，一般情况下边界项不必是零。
\end_layout

\begin_layout Standard
现在，我们最初的加权积分等式被化简为了：
\begin_inset Formula 
\[
\int_{0}^{1}y'v'+yv+v\dd{x}=0.
\]

\end_inset

其实上式就已经是原微分方程的 
\series bold
弱形式
\series default
(Weak Form)了。
\end_layout

\begin_layout Standard
这里我希望大家能去变分法 
\begin_inset CommandInset ref
LatexCommand eqref
reference "def:extreme"
plural "false"
caps "false"
noprefix "false"

\end_inset

 那里 复习一下微分方程和原泛函数的关系。通过令 泛函数的一阶变分为零，经过分部积分的化简，可以得到积分内的微分方程。上文中我们从微分方程开始得到了弱形式，现在
可以继续反推到原泛函数。这么做的目的是为了显示泛函数和其对应的微分方程的可逆关系。具体步骤如下：
\end_layout

\begin_layout Enumerate
首先弱形式积分中的前两项(
\begin_inset Formula $y'v'$
\end_inset

 和 
\begin_inset Formula $yv$
\end_inset

 )中 
\begin_inset Formula $y$
\end_inset

 和
\begin_inset Formula $v$
\end_inset

（或者 
\begin_inset Formula $y^{(n)}$
\end_inset

和
\begin_inset Formula $v^{(n)}$
\end_inset

，上标
\begin_inset Formula $n$
\end_inset

代表
\begin_inset Formula $n$
\end_inset

次导数）都是线性的，而第三项只有线性的
\begin_inset Formula $v$
\end_inset

。所以我们定义：
\begin_inset Formula 
\[
B(y,v)=\int_{0}^{1}y'v'+yv\dd{x},\quad l(v)=\int_{0}^{1}v\dd{x}
\]

\end_inset

其中 
\begin_inset Formula $B(y,v)$
\end_inset

 称为双线性项(
\begin_inset Formula $y$
\end_inset

和
\begin_inset Formula $v$
\end_inset

或其微分都是线性的)，
\begin_inset Formula $l(v)$
\end_inset

 称为线性项。
\end_layout

\begin_layout Enumerate
这样，我们就可以得到对应微分方程的原泛函数是：
\begin_inset Formula 
\[
I(y)=\frac{1}{2}B(y,y)+l(y)=\frac{1}{2}\int_{0}^{1}(y')^{2}+y^{2}+2y\dd{x}
\]

\end_inset


\end_layout

\begin_layout Standard
有兴趣的可以试着用变分法将这个泛函数化为一开始的微分方程，可以发现是一致的。从弱形式到泛函数的过程中，实际上我们做了一个 
\begin_inset Formula $v\to\delta y$
\end_inset

 的替换。如果将弱形式中 
\begin_inset Formula $v$
\end_inset

 的替换成 
\begin_inset Formula $\delta y$
\end_inset

，则可以得到：
\begin_inset Formula 
\[
\int_{0}^{1}y'\delta y'+y\delta y+\delta y\dd{x}=0
\]

\end_inset

这个式子实际上就是泛函数 的一阶变分。一切都联系在一起了。如果将 
\begin_inset Formula $v$
\end_inset

 和 
\begin_inset Formula $\delta y$
\end_inset

 看成是等价，我们可以从另一个角度解释为什么 
\begin_inset Formula $v(x)$
\end_inset

 在 Essential boundary condition 的地方等于零。比如有 
\begin_inset Formula $y(0)=1$
\end_inset

 这个Essential B.C.，说明 
\begin_inset Formula $y(x)$
\end_inset

 在 
\begin_inset Formula $x=0$
\end_inset

 处是确定或固定的，只能等于
\begin_inset Formula $1$
\end_inset

，因此自然其变分
\begin_inset Formula $\delta y$
\end_inset

 在 
\begin_inset Formula $x=0$
\end_inset

 是等于零的，因为是确定的值没有变动的空间。
\end_layout

\begin_layout Standard
从弱形式还原到原泛函数 这段算是额外的内容，让我们回到如何用Weak Form Galerkin求解近似解。还是用那个大家已经看过两遍的 
\begin_inset CommandInset ref
LatexCommand eqref
reference "exa:2.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的例子，方便和其余方法比较。
\end_layout

\begin_layout Standard
泛函为
\begin_inset Formula 
\[
I[y(x);x]=\int_{0}^{2}\left[0.5(y'')^{2}+5(y')^{2}+2y^{2}+y\right]\dd{x}-10y(0),
\]

\end_inset


\end_layout

\begin_layout Enumerate
Essential Boundary Conditions: 
\begin_inset Formula $y(2)=0$
\end_inset

；
\begin_inset Formula $y'(0)=-2$
\end_inset

。
\end_layout

\begin_layout Enumerate
Natural Boundary Conditions: ; 
\begin_inset Formula $y'''(0)=-10$
\end_inset

；
\begin_inset Formula $y''(2)=0$
\end_inset

。
\end_layout

\begin_layout Standard
求解最小化泛函数 
\begin_inset Formula $I$
\end_inset

 的近似解函数 
\begin_inset Formula $y(x)$
\end_inset

。
\end_layout

\begin_layout Solution
和Strong Form Galerkin（SFG）一样， 我们从泛函数对应的微分方程开始：
\end_layout

\begin_layout Solution
\begin_inset Formula 
\[
y''''-10y''+4y+1=0,\quad0<x<2\quad\text{（加上上述题目中的边界条件）}
\]

\end_inset

第一步也和SFG类似，将微分方程乘以检验函数然后求积分:
\begin_inset Formula 
\[
\int_{0}^{2}y''''v-10y''v+4yv+v\dd{x}=0
\]

\end_inset

然后通过 分部积分 平衡微分，将 
\begin_inset Formula $y''''$
\end_inset

 中的两撇分给
\begin_inset Formula $v$
\end_inset

，
\begin_inset Formula $y''$
\end_inset

中的一撇分给 
\begin_inset Formula $v$
\end_inset

，可以得到：
\begin_inset Formula 
\[
\int_{0}^{2}y''v''+10y'v'+4yv+v\dd{x}+\left.(y'''-10y')v\right|_{0}^{2}-\left.y''v'\right|_{0}^{2}=0
\]

\end_inset

展开一下积分外的边界项：
\begin_inset Formula 
\[
\left[y'''(2)-10y'(2)\right]v(2)-\left[y'''[0]-10y'(0)\right]v(0)-y''(2)v'(2)+y''(0)v'(0)
\]

\end_inset

由于 
\begin_inset Formula $y(2)=0$
\end_inset

 和 
\begin_inset Formula $y'(0)=-2$
\end_inset

 这两个 Essential B.C, 可以得到 
\begin_inset Formula $v(2)=0$
\end_inset

 以及 
\begin_inset Formula $v'(0)=0$
\end_inset

。再加上那两个Natural B.C，边界项可最终化简为 
\begin_inset Formula $-10v(0)$
\end_inset

。
\series bold
注意 Natural B.C.
 正是被考虑在这里，所以近似函数直须满足 Essential B.C.
\series default
。这样整个式子就被化简为：
\begin_inset Formula 
\[
H(y,v)=\int_{0}^{2}y''v''+10y'v'+4yv+v\dd{x}-10v(0)=0.
\]

\end_inset

也就是弱形式。
\end_layout

\begin_layout Solution
和SFG一样，想要求解近似解，我们也需要先将其设成一个已知形式，这里我们依然使用多项式。这里弱形式的优势就显现出来了，现在多项式只需要保证二次导数不为零，同时只
有两个 Essential B.C.
 需要满足，因此多项式最少是二次的。如果设一个二次多项式，那么一共会有三个系数，为了满足两个 Essential B.C,最终只剩下一个未知待解系数。为了得到更精
确的解，这里我们设一个三次多项式，即含有两个未知系数。
\begin_inset Formula 
\[
\tilde{y}(x)=a_{0}+a_{1}x+a_{2}x^{2}+a_{3}x^{3}
\]

\end_inset


\series bold
代入两个Essential B.C.解得
\series default
：
\begin_inset Formula 
\[
\tilde{y}(x)=4-2x+a_{2}(x^{2}-4)+a_{3}(x^{3}-8)
\]

\end_inset

对比表标准形式 
\begin_inset Formula $\phi_{0}+\sum_{i}c_{i}\phi_{i}$
\end_inset

 ，发现上式中 
\begin_inset Formula $4-2x$
\end_inset

是 
\begin_inset Formula $\phi_{0}$
\end_inset

；
\begin_inset Formula $a_{2}$
\end_inset

 是 
\begin_inset Formula $c_{1}$
\end_inset

，
\begin_inset Formula $x^{2}-4$
\end_inset

 是 
\begin_inset Formula $\phi_{1}$
\end_inset

；
\begin_inset Formula $a_{3}$
\end_inset

 是 
\begin_inset Formula $c_{2}$
\end_inset

，
\begin_inset Formula $x^{3}-8$
\end_inset

 是
\begin_inset Formula $\phi_{2}$
\end_inset

。这样就可以把 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

 统一成 
\begin_inset Formula $\tilde{y}(x)=\phi_{0}+c_{i}\phi_{i}$
\end_inset

的形式。
\end_layout

\begin_layout Solution
现在我们将弱形式 
\begin_inset Formula $H(y,v)$
\end_inset

 中的所有 
\begin_inset Formula $y$
\end_inset

 替换成 
\begin_inset Formula $\tilde{y}(x)$
\end_inset

, 所有 
\begin_inset Formula $v$
\end_inset

 替换成 
\begin_inset Formula $\phi_{i}$
\end_inset

(不包括
\begin_inset Formula $\phi_{0}$
\end_inset

)。这样我们可以得到两个式子：
\begin_inset Formula 
\begin{align*}
 & H[\tilde{y}(x),\phi_{1}]=0\\
 & H[\tilde{y}(x),\phi_{2}]=0
\end{align*}

\end_inset

这两个方程中仅有 
\begin_inset Formula $c_{1}$
\end_inset

，
\begin_inset Formula $c_{2}$
\end_inset

 两个未知量，是可解的。最终解得 
\begin_inset Formula $c_{1}=1.0682$
\end_inset

，
\begin_inset Formula $c_{2}=-0.2341$
\end_inset

。所以通过Weak Form Galerkin得到的近似解为：
\begin_inset Formula 
\[
\tilde{y}(x)=-0.234x^{3}+1.068x^{2}-2x+1.600.
\]

\end_inset


\end_layout

\begin_layout Solution
同样，用Matlab将这次结果和精确解以及上一篇文章中的SFG的结果进行对比。可以发现这次逼近了精确解很多。这是由于这次使用了两个未知系数而上次SFG只用了一个
。我试过如果SFG也用两个未知系数，其结果会比WFG更精确（对于这个例子）。但是我们仍然可以看出弱形式的优势，对于这个例子，弱形式在使用更低次的多项式的情况下，
依然比强形式的结果逼近精确解（弱形式使用了三次多项式，强形式使用了四次多项式）。
\end_layout

\begin_layout Solution
\begin_inset Graphics
	filename inset/fanhan-4.png
	lyxscale 40
	scale 40

\end_inset


\end_layout

\begin_layout Chapter
电磁场单位
\end_layout

\begin_layout Enumerate
质量（Kilogram）：
\begin_inset Formula $\mathrm{Kg}$
\end_inset


\end_layout

\begin_layout Enumerate
长度（meter）：
\begin_inset Formula $\mathrm{m}$
\end_inset


\end_layout

\begin_layout Enumerate
时间（time）：
\begin_inset Formula $\mathrm{s}$
\end_inset


\end_layout

\begin_layout Enumerate
力（Newton）：
\begin_inset Formula $\mathrm{N}=\mathrm{Kg}\cdot\mathrm{m}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
安培（ampere）：
\begin_inset Formula $\mathrm{A}$
\end_inset


\end_layout

\begin_layout Enumerate
库仑（Coulomb）：
\begin_inset Formula $\mathrm{C}=\mathrm{A}\cdot\mathrm{s}$
\end_inset


\end_layout

\begin_layout Enumerate
能量（Joule）：
\begin_inset Formula $\mathrm{J}=\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{2}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
能量密度：
\begin_inset Formula $\mathrm{J}\cdot\mathrm{m}^{-3}=\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{-1}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
共能密度：
\begin_inset Formula $\mathrm{J}\cdot\mathrm{m}^{-3}=\mathrm{N}\cdot\mathrm{m}=\mathrm{Kg}\cdot\mathrm{m}^{-1}\cdot\mathrm{s}^{-2}$
\end_inset


\end_layout

\begin_layout Enumerate
电压，电势（Volt）：
\begin_inset Formula $\mathrm{V}=\mathrm{J}\cdot\mathrm{s}^{-1}\cdot\mathrm{A}^{-1}=\mathrm{Kg}\cdot\mathrm{m}^{2}\cdot\mathrm{s}^{-3}\cdot\mathrm{A}^{-1}$
\end_inset


\end_layout

\begin_layout Enumerate
电容（法拉）：
\begin_inset Formula $\mathrm{F}=\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{V}^{-1}=\mathrm{Kg}^{-1}\cdot\mathrm{m}^{-2}\cdot\mathrm{s}^{4}\cdot\mathrm{A}^{2}$
\end_inset


\end_layout

\begin_layout Enumerate
电场强度（
\begin_inset Formula $E$
\end_inset

）：
\begin_inset Formula $\mathrm{E}=\mathrm{V}\cdot\mathrm{m}^{-1}=\mathrm{Kg}\cdot\mathrm{m}\cdot\mathrm{s}^{-3}\cdot\mathrm{A}^{-1}$
\end_inset


\end_layout

\begin_layout Enumerate
电位移（
\begin_inset Formula $D$
\end_inset

）：
\begin_inset Formula $\mathrm{D}=\mathrm{A}\cdot\mathrm{s}\cdot\mathrm{m}^{-2}$
\end_inset


\end_layout

\begin_layout Chapter
介质交界面的边界条件
\end_layout

\begin_layout Standard
麦克斯韦方程组可以应用于任何连续介质内部。在两介质分界面上，由于一般出现面电荷电流分布，使物理量发生跃变，微分形式的麦克斯韦方程组不再适用。
\end_layout

\begin_layout Standard
在电场作用下，介质界面上一般出现面束缚电流和电流分布。这些电荷电流的存在又使得界面两侧常量发生跃变。研究边值关系的基础是积分形式的麦克斯韦方程组，下面分别求出场
量的法向分量和切向分量的跃变。麦克斯韦方程组的积分形式为
\begin_inset Formula 
\begin{align}
 & \oint_{L}\sbf E\cdot\dd{\sbf\ell}=-\frac{\dd}{\dd{t}}\int_{S}\sbf B\cdot\dd{\sbf S}\nonumber \\
 & \oint_{L}\sbf H\cdot\dd{\sbf\ell}=I_{f}+\frac{\dd}{\dd{t}}\int_{S}\sbf D\cdot\dd{\sbf S}\nonumber \\
 & \oint_{S}\sbf D\cdot\dd{\sbf S}=Q_{f}\label{eq:5.1}\\
 & \oint_{S}\sbf B\cdot\dd{\sbf S}=0\nonumber 
\end{align}

\end_inset

式中 
\begin_inset Formula $I_{f}$
\end_inset

 为通过曲面
\begin_inset Formula $S$
\end_inset

的总自由电流，
\begin_inset Formula $Q_{f}$
\end_inset

为闭合曲面内总自由电荷。把这组方程应用到界面上可以得到两侧场量的关系。
\end_layout

\begin_layout Section
法向分量的跃变
\end_layout

\begin_layout Standard
电位移矢量 
\begin_inset Formula $\sbf D_{n}$
\end_inset

 的跃变取决于自由电荷面密度 
\begin_inset Formula $\sigma_{f}$
\end_inset

：
\begin_inset Formula 
\[
\sbf e_{1}\cdot\sbf D_{1}+\sbf e_{2}\cdot\sbf D_{2}=\sigma_{f}
\]

\end_inset


\begin_inset Formula $\sbf e_{1}$
\end_inset

 和 
\begin_inset Formula $\sbf e_{2}$
\end_inset

 分别是界面两侧的法向量（从界面指向介质内部）。考虑到 
\begin_inset Formula $\sbf e_{2}=-\sbf e_{1}$
\end_inset

，可以统一成
\begin_inset Formula 
\begin{equation}
\sbf e_{2}\cdot\left(\sbf D_{2}-\sbf D_{1}\right)=\sigma_{f}\label{eq:5.5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/GuoShuoHong-1.12.png
	lyxscale 70
	scale 70

\end_inset


\end_layout

\begin_layout Standard
类似地可以得到：
\begin_inset Formula 
\begin{align*}
 & \epsilon_{0}\sbf e_{2}\cdot\left(\sbf E_{2}-\sbf E_{1}\right)=\sigma_{f}+\sigma_{P}\\
 & \sbf e_{2}\cdot\left(\sbf P_{2}-\sbf P_{1}\right)=-\sigma_{P}
\end{align*}

\end_inset

即 
\begin_inset Formula $E_{n}$
\end_inset

 的跃变与总电荷面密度相关。
\end_layout

\begin_layout Section
切向分量的跃变
\end_layout

\begin_layout Standard
面电流分布使界面两侧磁场的切向分量发生跃变。沿轴向均匀磁化的铁棒，其内部分子磁矩的示意图如下。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/GuoShuoHong-1.13.png
	lyxscale 90
	scale 70

\end_inset


\begin_inset Newline newline
\end_inset

在铁棒内部，分子电流互相抵消，但在靠近棒侧面上的分子电流则构成宏观的磁化电流面分布。面电流实际上是在靠近表面的相当多分子层内的平均宏观效应。设理想薄层的厚度趋于
零，则通过电流的横截面变为横截线。定义电流线密度 
\begin_inset Formula $\sbf\alpha$
\end_inset

，其大小等于垂直通过单位横截线的电流，其线密度为 
\begin_inset Formula $\sbf\alpha$
\end_inset

，
\begin_inset Formula $\Delta\ell$
\end_inset

为横截线。垂直流过 
\begin_inset Formula $\Delta\ell$
\end_inset

 段的电流为
\begin_inset Formula 
\begin{equation}
\Delta I=\alpha\Delta\ell\label{eq:g5.7}
\end{equation}

\end_inset

面电流的对应量纲实际上是 
\begin_inset Formula $[L]$
\end_inset

，
\begin_inset Formula 
\[
[\text{面电流}]=\frac{[\text{电流}]}{[\text{长度}]},\quad[\text{面电荷}]=\frac{[\text{电荷}]}{[\text{面积}]}
\]

\end_inset


\end_layout

\begin_layout Standard
将 
\begin_inset Formula $\oint_{L}\sbf H\cdot\dd{\sbf\ell}=(H_{2t}-H_{1t})\Delta\ell$
\end_inset

应用到图 
\begin_inset CommandInset ref
LatexCommand eqref
reference "fig:g1.14-15"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的积分回路上得到
\begin_inset Formula 
\begin{align}
 & \sbf e_{1}\times\sbf H_{1}+\sbf e_{2}\times\sbf H_{2}=\sbf\alpha_{f}\nonumber \\
\Rightarrow\quad & \sbf e_{2}\times\left(\sbf H_{2}-\sbf H_{1}\right)=\sbf\alpha_{f}\label{eq:g5.9}
\end{align}

\end_inset

此即 磁场切向分量的边值关系。类似可得电场分量的边值关系：
\begin_inset Formula 
\begin{equation}
\sbf e_{n}\times\left(\sbf E_{2}-\sbf E_{1}\right)=0\label{eq:g5.10}
\end{equation}

\end_inset

此式表示界面两侧 
\begin_inset Formula $\sbf E$
\end_inset

 的切向分量连续。
\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Graphics
	filename inset/GuoShuoHong-1.14-15.png
	lyxscale 60
	scale 60

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
面电流的积分回路 1.14-1.15 
\begin_inset CommandInset label
LatexCommand label
name "fig:g1.14-15"

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
省略自由电荷密度和自由电流线密度，不再写出下角标
\begin_inset Formula $f$
\end_inset

。总括我们得到的边值关系为
\begin_inset Formula 
\begin{align}
 & \sbf e_{2}\times\left(\sbf E_{2}-\sbf E_{1}\right)=0\nonumber \\
 & \sbf e_{2}\times\left(\sbf H_{2}-\sbf H_{1}\right)=\sbf\alpha\label{eq:g5.11}\\
 & \sbf e_{2}\cdot\left(D_{2}-\sbf D_{1}\right)=\sigma\nonumber \\
 & \sbf e_{2}\cdot\left(B_{2}-\sbf B_{1}\right)=0\nonumber 
\end{align}

\end_inset

其中 
\begin_inset Formula $\sbf e_{2}$
\end_inset

是从界面指向介质
\begin_inset Formula $2$
\end_inset

 内部的法向单位矢量，或等价地，从介质
\begin_inset Formula $1$
\end_inset

指向介质
\begin_inset Formula $2$
\end_inset

。 边值关系表示界面两侧的场与界面上电荷电流的制约关系。
\end_layout

\begin_layout Standard
对于不包含自由面电荷，面电流的系统：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf E$
\end_inset

，
\begin_inset Formula $\sbf H$
\end_inset

 切向连续；
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf B$
\end_inset

，
\begin_inset Formula $\sbf D$
\end_inset

 法向连续。
\end_layout

\begin_layout Subsection
电场线平行，垂直
\end_layout

\begin_layout Standard
电场线垂直，例如在边界
\begin_inset Formula $\Gamma_{1}$
\end_inset

上 
\begin_inset Formula $\sbf E_{t}=0$
\end_inset

，即
\begin_inset Formula 
\[
\sbf e_{t}\cdot\nabla\phi=0\quad\Rightarrow\quad\sbf e_{n}\times\nabla\Phi=0
\]

\end_inset

所以边界
\begin_inset Formula $\Gamma_{1}$
\end_inset

为等势面，电势为常数。相当于第一类（狄利赫雷）边界条件。
\end_layout

\begin_layout Standard
电场线平行， 例如在边界 
\begin_inset Formula $\Gamma_{2}$
\end_inset

上 
\begin_inset Formula $\sbf E_{n}=0$
\end_inset

，即
\begin_inset Formula 
\[
\sbf e_{n}\cdot\nabla\phi=0
\]

\end_inset

对应第二类（诺伊曼）边界条件，如果泛函中没有非齐次项，是自动满足的，被称为自然边界条件（Natural Boundary condition）。
\end_layout

\begin_layout Chapter
插值和高斯积分
\end_layout

\begin_layout Section
有限元中的Lagrange插值与Gauss积分
\end_layout

\begin_layout Standard
ref:
\begin_inset CommandInset href
LatexCommand href
name "Lagrange插值与Gauss积分"
target "https://zhuanlan.zhihu.com/p/37768842"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Lagrange插值与Gauss积分是在学习FEM中不可回避的两部分，虽然说是两部分，其实在Gauss积分中，构造多项式的被积函数时，也用到了Lagrange插
值多项式，所以在讲关于参数单元刚度矩阵求积分的时候，在数值积分中一起提出。
\begin_inset Formula 
\begin{equation}
\int_{a}^{b}f\left(x\right)\dd{x}\approx\int_{a}^{b}P\left(x\right)\dd{x}\label{eq:5.145}
\end{equation}

\end_inset

以上表达式是说，对于比较难以积分的函数
\begin_inset Formula $f$
\end_inset

，我们找到了与之相似度很高的多项式函数
\begin_inset Formula $P$
\end_inset

，用
\begin_inset Formula $P$
\end_inset

的积分来代替f的积分，那么现在的问题就是如何找到多项式
\begin_inset Formula $P$
\end_inset

。
\end_layout

\begin_layout Subsection
Newton–Cotes 数值积分
\end_layout

\begin_layout Standard
基于 
\begin_inset Formula $n$
\end_inset

 个点（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

），将多项式取为 Lagrange 插值多项式，即
\begin_inset Formula 
\[
\varphi\left(\xi\right)=a_{0}+a_{1}\xi+\cdots+a_{n-1}\xi^{n-1}=\sum_{i=1}^{n}l_{i}^{(n-1)}\left(\xi\right)f\left(\xi_{i}\right).
\]

\end_inset

其中 
\begin_inset Formula $a_{0}$
\end_inset

，
\begin_inset Formula $a$
\end_inset

，
\begin_inset Formula $\cdots$
\end_inset

，
\begin_inset Formula $a_{n-1}$
\end_inset

为常数，
\begin_inset Formula $l_{i}^{(n-1)}$
\end_inset

为
\begin_inset Formula $n-1$
\end_inset

阶 Lagrange 插值函数，即
\begin_inset Formula 
\[
l_{i}^{(n-1)}\left(\xi\right)=\frac{\left(\xi-\xi_{1}\right)\left(\xi-\xi_{2}\right)\cdots{\color{blue}\left(\xi-\xi_{i-1}\right)\left(\xi-\xi_{i+1}\right)}\cdots\left(\xi-\xi_{n}\right)}{\left(\xi_{i}-\xi_{1}\right)\left(\xi_{i}-\xi_{2}\right)\cdots{\color{blue}\left(\xi_{i}-\xi_{i-1}\right)\left(\xi_{i}-\xi_{i+1}\right)}\cdots\left(\xi_{i}-\xi_{n}\right)}=\prod_{\substack{j=1\\
j\neq i
}
}^{n}\frac{\left(\xi-\xi_{j}\right)}{\left(\xi_{i}-\xi_{j}\right)}.
\]

\end_inset


\end_layout

\begin_layout Standard
Lagrange插值的定义: 如果已知 
\begin_inset Formula $n$
\end_inset

 个点的数值，那么可以构造一个
\begin_inset Formula $n-1$
\end_inset

阶的多项式，通过待定系数的方式，使得这个多项式在这
\begin_inset Formula $n$
\end_inset

个点的值就等于原本函数在这
\begin_inset Formula $n$
\end_inset

个点的数值。关于待定系数的求解，刚好是一个范德蒙德多项式：
\begin_inset Formula 
\[
\left[\begin{array}{ccccc}
1 & x_{1} & x_{1}^{2} & \cdots & x_{1}^{n-1}\\
1 & x_{2} & x_{2}^{2} & \cdots & x_{2}^{n-1}\\
\cdots & \cdots & \cdots & \cdots & \cdots\\
1 & x_{n} & x_{n}^{2} & \cdots & x_{n}^{n-1}
\end{array}\right]\left(\begin{array}{c}
a_{0}\\
a_{1}\\
\cdots\\
a_{n-1}
\end{array}\right)=\left(\begin{array}{c}
f\left(x_{1}\right)\\
f\left(x_{2}\right)\\
\cdots\\
f\left(x_{n}\right)
\end{array}\right)
\]

\end_inset

其中 
\begin_inset Formula $a_{0}$
\end_inset

，
\begin_inset Formula $a_{1}$
\end_inset

，
\begin_inset Formula $a_{n-1}$
\end_inset

 是拟合多项式中的各个系数。例如给三个点，得到的插值多项式形如：
\begin_inset Formula 
\[
y=l_{1}^{(2)}\left(x\right)y_{1}+l_{2}^{(2)}\left(x\right)y_{2}+l_{3}^{(2)}\left(x\right)y_{3}
\]

\end_inset

容易看出
\begin_inset Formula $f_{i}(x_{j})=\delta_{ij}$
\end_inset

，即在所有要插值的点，多项式插值的结果与原来的函数相等。因此 Lagrange 插值的一般表达式为
\begin_inset Formula 
\[
P\left(x\right)=\sum_{i=1}^{n}\left[\prod_{\substack{j=1\\
i\neq j
}
}\frac{\left(x-x_{j}\right)}{\left(x_{i}-x_{j}\right)}y_{i}\right].
\]

\end_inset

从而引出了 Newton–Cotes 数值积分公式
\begin_inset Formula 
\begin{align*}
I & =\int_{-1}^{1}f\left(\xi\right)\dd{\xi}\approx\int_{-1}^{1}\varphi\left(\xi\right)\dd{\xi}\\
 & =\sum_{i=1}^{n}{\color{blue}\left(\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}\right)}f\left(\xi_{i}\right)\\
 & =\sum_{i=1}^{n}A_{i}f\left(\xi_{i}\right)
\end{align*}

\end_inset

Newton-Cotes 数值积分将原积分转化为 
\series bold
权函数
\series default
 与 
\series bold
原函数值
\series default
 的线性组合（在离散点上）。
\end_layout

\begin_layout Subsection
Gauss积分, Gauss quadrature
\end_layout

\begin_layout Standard
然后，就是 FEM 里常用的 Gauss 积分了：
\end_layout

\begin_layout Standard
首先谈一下我的理解，上面的Newton-Cotes数值积分，是将 
\series bold
函数
\series default
 转换为 
\series bold
多项式
\series default
，采用的多项式是Lagrange插值多项式，对采用的n个点没有特殊的要求；下面的Gauss积分，就是要挑选优化过的积分点，同时确定积分点函数值的权函数。
\end_layout

\begin_layout Standard
如果调整 
\begin_inset Formula $n$
\end_inset

 个插值点的位置（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

），使 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

作为 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式对
\begin_inset Formula $f(\xi)$
\end_inset

 进行逼近，则可以大大提高积分精度；也就是调整插值点 
\begin_inset Formula $\xi_{i}$
\end_inset

 的位置，使其达到一个最优的组合，这种最优的位置点叫做 Gauss 积分点。
\end_layout

\begin_layout Standard
由函数逼近理论，可构造 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

 为
\begin_inset Formula 
\begin{equation}
\varphi\left(\xi\right)=\sum_{i=1}^{n}l_{i}^{(n-1)}(\xi)f(\xi_{i})+\sum_{i=0}^{n-1}\beta_{i}\xi^{i}P\left(\xi\right)\label{eq:5.149}
\end{equation}

\end_inset

其中 
\begin_inset Formula $l_{i}^{(n-1)}(\xi)$
\end_inset

 是 
\begin_inset Formula $\left(n-1\right)$
\end_inset

 次 Lagrange插值函数，
\begin_inset Formula $\beta_{i}$
\end_inset

 为系数，
\begin_inset Formula $P\left(\xi\right)$
\end_inset

 为 
\begin_inset Formula $n$
\end_inset

 次多项式，即
\begin_inset Formula 
\begin{equation}
P\left(\xi\right)=\left(\xi-\xi_{1}\right)\left(\xi-\xi_{2}\right)\cdots\left(\xi-\xi_{n}\right)=\prod_{i=1}^{n}\left(\xi-\xi_{i}\right).\label{eq:5.150}
\end{equation}

\end_inset

（
\begin_inset Formula $\xi,\:i=1,2,\cdots,n$
\end_inset

）积分点由以下条件确定
\begin_inset Formula 
\begin{equation}
\int_{-1}^{1}\xi^{i}P\left(\xi\right)\dd{\xi}=0,\quad i=0,1,\cdots,n-1\label{eq:5.151}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Gauss积分的定义
\end_layout

\begin_layout Standard
可以看出，构造的高斯积分的函数虽然阶次提高到了
\begin_inset Formula $2n-1$
\end_inset

，它的两项中的第一项仍然为
\begin_inset Formula $n-1$
\end_inset

阶，并且就是之前的拉格朗日插值多项式，只是在后面添加了一个“辅助项”。其实为什么这么构造我是不清楚的，但是毋庸置疑的是：
\end_layout

\begin_layout Enumerate
辅助项在所有积分点处的值为零，即 
\begin_inset Formula $P\left(\xi_{i}\right)=0$
\end_inset

。
\end_layout

\begin_layout Enumerate
整个多项式的阶次被提高到 
\begin_inset Formula $2n-1$
\end_inset

次，相比于牛顿积分更精确；
\end_layout

\begin_layout Enumerate
利用上述的积分条件（共
\begin_inset Formula $n$
\end_inset

个），可以用来确定
\begin_inset Formula $n$
\end_inset

个积分点（采样点）的位置。
\end_layout

\begin_layout Standard
则积分
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:5.145"
plural "false"
caps "false"
noprefix "false"

\end_inset

为，
\begin_inset Formula 
\begin{align}
I & =\int_{-1}^{1}f\left(\xi\right)\dd{\xi}\approx\int_{-1}^{1}\varphi\left(\xi\right)\dd{\xi}\nonumber \\
 & =\sum_{i=1}^{n}\left[\left({\color{blue}\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}}\right)f\left(\xi_{i}\right)\right]+\sum_{i=0}^{n-1}\int_{-1}^{1}\beta_{i}\xi^{i}P\left(\xi\right)\dd{\xi}=\sum_{i=1}^{n}Af\left(\xi_{i}\right)\label{eq:5.152}
\end{align}

\end_inset

其中
\begin_inset Formula 
\begin{equation}
A_{i}={\color{blue}\int_{-1}^{1}l_{i}^{(n-1)}\left(\xi\right)\dd{\xi}}\label{eq:5.153}
\end{equation}

\end_inset

注意这时 
\begin_inset Formula $\varphi\left(\xi\right)$
\end_inset

 为 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 次多项式，
\color blue

\begin_inset Formula $\xi_{i}$
\end_inset

的位置由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:5.151"
plural "false"
caps "false"
noprefix "false"

\end_inset

 式确定
\color inherit
，因而整个积分的精度具有 
\begin_inset Formula $\left(2n-1\right)$
\end_inset

 阶。
\end_layout

\begin_layout Standard
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
Kare: 高斯积分运用的是正交多项式的性质。Lagrange 多项式那项已经保证了至少
\begin_inset Formula $n$
\end_inset

的精确度，后面的项则把精确度提高到
\begin_inset Formula $2n-1$
\end_inset

。精确度跟多项式的次数应当是没有关系的。而是跟特殊的取点有关系。
\end_layout

\end_inset


\end_layout

\begin_layout Remark
令 
\begin_inset Formula $J$
\end_inset

 表示几何坐标对等参坐标的雅可比矩阵，
\begin_inset Formula $\det[J]$
\end_inset

正比于几何区域的面积，例如对于三角形
\begin_inset Formula 
\[
S=\frac{1}{2}\det[J]
\]

\end_inset

在计算程序中，这个几何常数被吸收进 权重因子 
\begin_inset Formula $W_{i}$
\end_inset

 中。因此程序中高斯积分法的形式为：
\begin_inset Formula 
\[
\iint_{\Omega^{e}}F\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{x}\dd{y}=\sum_{i=1}^{m}F\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset


\end_layout

\begin_layout Chapter
有限元等参坐标方法
\end_layout

\begin_layout Example
平面单元的空间坐标
\begin_inset Formula $\left\{ x,y\right\} $
\end_inset

，通过形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

和顶点坐标映射到 等参坐标 
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

 平面
\begin_inset Formula 
\begin{align}
 & x=\sum_{i}N_{i}^{e}\left(\xi,\eta\right)x_{i}\label{eq:coord}\\
 & y=\sum_{i}N_{i}^{e}\left(\xi,\eta\right)y_{i}\nonumber 
\end{align}

\end_inset

其中 
\begin_inset Formula $N_{i}^{e}$
\end_inset

 表示某个单元中，第
\begin_inset Formula $i$
\end_inset

个节点对应的形函数，对重复指标进行求和。实际计算中，如果取单元插值点的形式为
\begin_inset Formula 
\[
\left[\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}\\
x_{3} & y_{3}\\
\cdots & \cdots
\end{array}\right]
\]

\end_inset

为一
\begin_inset Formula $\left[n,2\right]$
\end_inset

矩阵。并将
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:coord"
plural "false"
caps "false"
noprefix "false"

\end_inset

表示为矩阵乘法的形式：
\begin_inset Formula 
\[
\left[\begin{array}{c}
x\\
y
\end{array}\right]=\left[\begin{array}{cccc}
x_{1} & x_{2} & x_{3} & \cdots\\
y_{1} & y_{2} & y_{3} & \cdots
\end{array}\right]\left[\begin{array}{c}
N_{1}\\
N_{2}\\
N_{3}\\
\cdots
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
或者用指标表示，则坐标矢量为
\color blue

\begin_inset Formula 
\[
X_{d}=\overline{X}_{j\alpha}N_{\alpha}
\]

\end_inset


\color inherit
其中 
\begin_inset Formula $X=\left(x,y\right)$
\end_inset

 表示单元内点的坐标，
\begin_inset Formula $\overline{X}_{j\alpha}$
\end_inset

 表示插值点，
\begin_inset Formula $N_{\alpha}$
\end_inset

 表示形函数。
\begin_inset Formula $j\in\left\{ 1,2\right\} $
\end_inset

 是空间的维数，
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是插值点的数目。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
积分测度的变换为
\begin_inset Formula 
\[
\dd{x}\dd{y}=\det J\left(\xi,\eta\right)\dd{\xi}\dd{\eta}
\]

\end_inset

其中 Jacobi 矩阵定义为
\begin_inset Formula 
\begin{align}
J\left(\xi,\eta\right) & =\frac{\partial\left(N_{i}^{e}x_{i},N_{i}^{e}y_{i}\right)}{\partial\left(\xi,\eta\right)}=\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]\label{eq:jacobi}\\
 & =\sum_{i}\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{i} & y_{i}\end{array}\right)\nonumber \\
\text{例如}i\in\left\{ 1,2,3\right\} \quad & =\left(\begin{array}{ccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{1} & y_{1}\\
x_{2} & y_{2}\\
x_{3} & y_{3}
\end{array}\right)
\end{align}

\end_inset

如果是高阶单元，插值点增多，但公式是类似的，都可以表示成 
\begin_inset Formula $[2,n]\times[n,2]$
\end_inset

 的矩阵乘积，最后结果是 
\begin_inset Formula $[2,2]$
\end_inset

 矩阵。
\end_layout

\begin_layout Example
雅可比矩阵就是微分的变换
\begin_inset Formula 
\[
\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]=\left[\begin{array}{cc}
\dd{\xi} & \dd{\eta}\end{array}\right]\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]
\]

\end_inset

所以对应的逆变换为，
\begin_inset Formula 
\begin{align}
\left[\begin{array}{cc}
\dd{\xi} & \dd{\eta}\end{array}\right] & =\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]\left[\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}\right]^{-1}\nonumber \\
 & =\left[\begin{array}{cc}
\dd{x} & \dd{y}\end{array}\right]\left[\begin{array}{cc}
\frac{\partial\xi}{\partial x} & \frac{\partial\eta}{\partial x}\\
\frac{\partial\xi}{\partial y} & \frac{\partial\eta}{\partial y}
\end{array}\right]\label{eq:jacobi2}
\end{align}

\end_inset


\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
雅可比矩阵 
\begin_inset Formula $\partial\left(x,y\right)/\partial\left(\xi,\eta\right)$
\end_inset

为
\color blue

\begin_inset Formula 
\[
J_{ki}=\tilde{\partial}_{k}N_{\alpha}\overline{X}_{\alpha i}
\]

\end_inset


\color inherit

\begin_inset Formula $k,i\in\left\{ 1,2\right\} $
\end_inset

是空间的维数或等参坐标个数；
\begin_inset Formula $\overline{X}_{\alpha i}$
\end_inset

 表示插值点，
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是插值点的数目；
\begin_inset Formula $N_{\alpha}$
\end_inset

 表示形函数，
\begin_inset Formula $\tilde{\partial}$
\end_inset

表示对 
\begin_inset Formula $\xi$
\end_inset

，
\begin_inset Formula $\eta$
\end_inset

 求偏导。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
形函数梯度的计算，可以通过 Jacobi 矩阵和形函数对等参坐标的偏导计算（这里是二维形式）
\begin_inset Formula 
\begin{align*}
\nabla N_{i}^{e} & =\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial x}\\
\frac{\partial N_{i}^{e}}{\partial y}
\end{array}\right)=\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\frac{\partial\xi}{\partial x}+\frac{\partial N_{i}^{e}}{\partial\eta}\frac{\partial\eta}{\partial x}\\
\frac{\partial N_{i}^{e}}{\partial\xi}\frac{\partial\xi}{\partial y}+\frac{\partial N_{i}^{e}}{\partial\eta}\frac{\partial\eta}{\partial y}
\end{array}\right)\\
 & =\left(\begin{array}{cc}
\frac{\partial\xi}{\partial x} & \frac{\partial\eta}{\partial x}\\
\frac{\partial\xi}{\partial y} & \frac{\partial\eta}{\partial y}
\end{array}\right)\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)=\left[J\left(\xi,\eta\right)\right]^{-1}\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right).
\end{align*}

\end_inset

类似地，如果写成矩阵形式：
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
\nabla N_{1}^{e} & \nabla N_{2}^{e} & \nabla N_{3}^{e}\end{array}\right]=\left[J\left(\xi,\eta\right)\right]^{-1}\left(\begin{array}{ccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta}
\end{array}\right).
\]

\end_inset

维数变换是 
\begin_inset Formula $\left[2,2\right]\times\left[2,n\right]\rightarrow\left[2,n\right]$
\end_inset

。
\begin_inset Formula $J\left(\xi,\eta\right)$
\end_inset

正是
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi"
plural "false"
caps "false"
noprefix "false"

\end_inset

定义的雅可比矩阵：
\begin_inset Formula 
\[
J\left(\xi,\eta\right)=\frac{\partial\left(N_{i}^{e}x_{i},N_{i}^{e}y_{i}\right)}{\partial\left(\xi,\eta\right)}=\frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right].
\]

\end_inset


\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
形函数的梯度为：
\color blue

\begin_inset Formula 
\[
\partial_{i}N_{\alpha}^{e}=\left(J^{-1}\right)_{ij}\tilde{\partial}_{j}N_{\alpha}^{e}
\]

\end_inset


\color inherit

\begin_inset Formula $i,j\in\left\{ 1,2\right\} $
\end_inset

是空间的维数，
\begin_inset Formula $\alpha\in\left\{ 1,2,3,\cdots\right\} $
\end_inset

是插值点的数目；
\begin_inset Formula $\partial$
\end_inset

表示对单元内点坐标 
\begin_inset Formula $\left\{ x,y\right\} $
\end_inset

 求导，
\begin_inset Formula $\tilde{\partial}$
\end_inset

表示对等参坐标 
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

 求偏导。
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
因此在平面单元上进行的积分可以先映射到等参坐标平面，再通过高斯积分（Gauss quadrature）计算
\begin_inset Formula 
\begin{align*}
\int_{\Delta}P\left(x,y\right)\dd{x}\dd{y} & =\int{\color{blue}P\left(\xi,\eta\right)\det J\left(\xi,\eta\right)}\dd{\xi}\dd{\eta}\\
 & =\sum_{m}{\color{blue}P\left(\xi_{m},\eta_{m}\right)\det J\left(\xi_{m},\eta_{m}\right)}\;W\left(\xi_{m},\eta_{m}\right)
\end{align*}

\end_inset


\begin_inset Formula $W\left(\xi_{m},\eta_{m}\right)$
\end_inset

 是高斯数值积分中的权函数。
\end_layout

\begin_layout Standard
实际应用中，一般先构造 
\begin_inset Formula $N_{i}^{e}\left(\xi,\eta\right)$
\end_inset

 的形式：
\end_layout

\begin_layout Enumerate
由于节点坐标 
\begin_inset Formula $x_{i}$
\end_inset

，
\begin_inset Formula $y_{i}$
\end_inset

视为已知常数，则能计算出 
\begin_inset Formula $J\left(\xi,\eta\right)=\partial\left(x,y\right)/\partial\left(\xi,\eta\right)$
\end_inset

，
\begin_inset Formula $\det J$
\end_inset

。
\end_layout

\begin_layout Enumerate
高斯积分法的采样点 
\begin_inset Formula $\left\{ m\right\} $
\end_inset

，与权函数 
\begin_inset Formula $W\left(\xi_{m},\eta_{m}\right)$
\end_inset

 ，可以通过查表获得，通常使用等参坐标 
\begin_inset Formula $\left(\xi,\eta\right)$
\end_inset

 表示。
\end_layout

\begin_layout Enumerate
将被积函数 
\begin_inset Formula $P\left(x_{m},y_{m}\right)$
\end_inset

 转换到 
\begin_inset Formula $P\left(\xi_{m},\eta_{m}\right)$
\end_inset

 表示下：使用坐标变换方程，或者微分的使用链式法则。
\end_layout

\begin_layout Section
刚度矩阵的计算
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\sbf\nabla\left(\alpha\cdot\sbf\nabla\phi\right)+\beta\phi=f,\quad\left(x,y\right)\in\Omega.
\]

\end_inset

对于刚度矩阵
\begin_inset Formula 
\begin{align*}
 & K_{ij}^{e}=\iint_{\Omega^{e}}\left(\nabla N_{i}^{e}\cdot\alpha\nabla N_{j}^{e}+\beta N_{i}^{e}N_{j}^{e}\right)\dd{x}\dd{y},\\
 & b_{i}^{e}=\iint_{\Omega^{e}}fN_{i}^{e}\dd{x}\dd{y},\quad i,j=1,2,3
\end{align*}

\end_inset

代入上述讨论中的公式
\begin_inset Formula 
\[
K_{ij}^{e}=\iint_{\Omega^{e}}\left(G_{i}^{T}.J^{-1,T}\cdot\alpha J^{-1}.G_{j}+\beta N_{i}^{e}N_{j}^{e}\right){\color{blue}\det\left[J\right]}\dd{\xi}\dd{\eta}
\]

\end_inset

其中 
\begin_inset Formula $G_{i}=\left[\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right]$
\end_inset

，是梯度矢量。
\end_layout

\begin_layout Example
对于一阶线性单元，代入形函数
\begin_inset Formula $N_{i}^{e}$
\end_inset

的定义
\begin_inset Formula 
\begin{align*}
 & J\left(\xi,\eta\right)=\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)\left(\begin{array}{cc}
x_{i} & y_{i}\end{array}\right)=\left(\begin{array}{cc}
x_{1}-x_{3} & y_{1}-y_{3}\\
x_{2}-x_{3} & y_{2}-y_{3}
\end{array}\right)=\left(\begin{array}{cc}
x_{1}-x_{3} & y_{1}-y_{3}\\
x_{2}-x_{3} & y_{2}-y_{3}
\end{array}\right)=\left[\begin{array}{cc}
c_{2}^{e} & -b_{2}^{e}\\
-c_{1}^{e} & b_{1}^{e}
\end{array}\right]\\
 & J^{-1}\left(\xi,\eta\right)=\frac{1}{2\Delta^{e}}\left[\begin{array}{cc}
b_{1}^{e} & b_{2}^{e}\\
c_{1}^{e} & c_{2}^{e}
\end{array}\right],\quad J^{-1,T}\left(\xi,\eta\right)=\frac{1}{2\Delta^{e}}\left[\begin{array}{cc}
b_{1}^{e} & c_{1}^{e}\\
b_{2}^{e} & c_{2}^{e}
\end{array}\right],\quad J^{-1,T}\cdot J^{-1}=\frac{1}{4\Delta^{e,2}}\left[\begin{array}{cc}
b_{1}^{e,2}+c_{1}^{e,2} & b_{1}^{e}b_{2}^{e}+c_{1}^{e}c_{2}^{e}\\
b_{1}^{e}b_{2}^{e}+c_{1}^{e}c_{2}^{e} & b_{2}^{e,2}+c_{2}^{e,2}
\end{array}\right]
\end{align*}

\end_inset

以及梯度矢量：
\begin_inset Formula 
\[
G_{i}=\left(\begin{array}{c}
1\\
0
\end{array}\right),\left(\begin{array}{c}
0\\
1
\end{array}\right),\left(\begin{array}{c}
-1\\
-1
\end{array}\right),\quad\text{for }j=1,2,3
\]

\end_inset


\end_layout

\begin_layout Example
\begin_inset Formula $K_{ij}$
\end_inset

为对称阵：
\begin_inset Formula 
\begin{align*}
K= & \frac{\alpha}{2\Delta^{e}}\iint_{\Omega^{e}}\dd{\xi}\dd{\eta}\left[\begin{array}{ccc}
b_{1}^{e,2}+c_{1}^{e,2} & b_{1}^{e}b_{2}^{e}+c_{1}^{e}c_{2}^{e} & b_{1}^{e}b_{3}^{e}+c_{1}^{e}c_{3}^{e}\\
\cdots & b_{2}^{e,2}+c_{2}^{e,2} & b_{2}^{e}b_{3}^{e}+c_{2}^{e}c_{3}^{e}\\
\cdots & \cdots & b_{3}^{e,2}+c_{3}^{e,2}
\end{array}\right]\\
 & +2\Delta^{e}\beta\iint_{\Omega^{e}}\dd{\xi}\dd{\eta}\left[\begin{array}{ccc}
\left(1-\xi-\eta\right)^{2} & \xi\left(1-\xi-\eta\right) & \eta\left(1-\xi-\eta\right)\\
\cdots & \xi^{2} & \xi\eta\\
\cdots & \cdots & \eta^{2}
\end{array}\right]\Bigg\}
\end{align*}

\end_inset

以及常数矢量： 
\begin_inset Formula 
\[
b_{i}^{e}=2\Delta^{e}f\iint_{\Omega^{e}}\dd{\xi}\dd{\eta}\left[\begin{array}{c}
1-\xi-\eta\\
\xi\\
\eta
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
以上使用了： 
\begin_inset Formula 
\begin{align*}
 & N_{1}^{e}=\frac{\Delta_{1}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{1}^{e}+b_{1}^{e}x+c_{1}^{e}y}{2}=1-\xi-\eta,\\
 & N_{2}^{e}=\frac{\Delta_{2}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{2}^{e}+b_{2}^{e}x+c_{2}^{e}y}{2}=\xi,\\
 & N_{3}^{e}=\frac{\Delta_{3}}{\Delta^{e}}=\frac{1}{\Delta^{e}}\frac{a_{3}^{e}+b_{3}^{e}x+c_{3}^{e}y}{2}=\eta.
\end{align*}

\end_inset


\begin_inset Formula 
\begin{align}
 & a_{1}^{e}=x_{2}^{e}y_{3}^{e}-y_{2}^{e}x_{3}^{e}; &  & b_{1}^{e}=y_{2}^{e}-y_{3}^{e}; &  & c_{1}^{e}=x_{3}^{e}-x_{2}^{e}\nonumber \\
 & a_{2}^{e}=x_{3}^{e}y_{1}^{e}-y_{3}^{e}x_{1}^{e}; &  & b_{2}^{e}=y_{3}^{e}-y_{1}^{e}; &  & c_{2}^{e}=x_{1}^{e}-x_{3}^{e}\label{eq:4.24-1}\\
 & a_{3}^{e}=x_{1}^{e}y_{2}^{e}-y_{1}^{e}x_{2}^{e}; &  & b_{3}^{e}=y_{1}^{e}-y_{2}^{e}; &  & c_{3}^{e}=x_{2}^{e}-x_{1}^{e}\nonumber 
\end{align}

\end_inset

满足 
\begin_inset Formula $\sum b_{i}=0$
\end_inset

，
\begin_inset Formula $\sum c_{i}=0$
\end_inset

。
\begin_inset Formula 
\[
\Delta^{e}=\frac{1}{2}\left|\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right|=\frac{1}{2}\left(b_{2}^{e}c_{3}^{e}-b_{3}^{e}c_{2}^{e}\right)=\text{第}e\text{个单元的面积}
\]

\end_inset

普通坐标和等参坐标之间的变换为：
\begin_inset Formula 
\begin{align*}
 & \left[\begin{array}{c}
x\\
y
\end{array}\right]=\left[\begin{array}{cc}
c_{3}^{e} & -c_{2}^{e}\\
-b_{3}^{e} & b_{2}^{e}
\end{array}\right]\left[\begin{array}{c}
\xi\\
\eta
\end{array}\right]+\left[\begin{array}{c}
x_{1}^{e}\\
y_{1}^{e}
\end{array}\right],\\
 & \left[\begin{array}{c}
\xi\\
\eta
\end{array}\right]=\frac{1}{2\Delta^{e}}\left\{ \left[\begin{array}{cc}
b_{2}^{e} & c_{2}^{e}\\
b_{3}^{e} & c_{3}^{e}
\end{array}\right]\left[\begin{array}{c}
x\\
y
\end{array}\right]+\left[\begin{array}{c}
a_{2}^{e}\\
a_{3}^{e}
\end{array}\right]\right\} ,\\
 & \frac{\partial\left(x,y\right)}{\partial\left(\xi,\eta\right)}=\det J={\color{blue}\left(b_{2}^{e}c_{3}^{e}-b_{3}^{e}c_{2}^{e}\right)}=2{\color{blue}\Delta^{e}}.
\end{align*}

\end_inset


\end_layout

\begin_layout Section
有限元中的等参单元
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
name "有限元中什么是等参单元"
target "https://www.zhihu.com/question/29564930/answer/77635688"
literal "false"

\end_inset

，
\begin_inset CommandInset href
LatexCommand href
name "邱小白"
target "https://www.zhihu.com/question/29564930/answer/77582890"
literal "false"

\end_inset

 
\end_layout

\begin_layout Example
对于场函数，例如位移场，我们可以通过 
\color blue
节点场值
\color inherit
 与 
\color blue
插值函数
\color inherit
 来表示场内各点的场值。设结点数为
\begin_inset Formula $n$
\end_inset

。一般而言，此公式是表示在局部坐标下的。
\begin_inset Formula 
\[
u=\sum_{i=1}^{n}N_{i}u_{i}
\]

\end_inset

将单元从规则的 局部坐标系（如面积坐标系）转化到 全局坐标系 中，我们需要建立两个坐标系之间的变换关系。同理，通过 全局坐标系 表示的 
\color blue
结点坐标
\color inherit
 与 局部坐标 表示的 插值函数， 可以表示 单元内 各点的 
\color blue
全局坐标
\color inherit
。设 节点数为 
\begin_inset Formula $m$
\end_inset

。
\begin_inset Formula 
\[
x=\sum_{i=1}^{m}N_{i}^{\prime}x_{i}
\]

\end_inset

如果，场函数插值 所用节点数 与 坐标变换所用节点数 相等时，即 
\begin_inset Formula $n=m$
\end_inset

，而且两者采用相同的插值函数，即 
\begin_inset Formula $N_{i}^{\prime}=N_{i}$
\end_inset

。那么，我们称这种变换叫 
\color blue
等参变换
\color inherit
，这种单元叫 
\color blue
等参单元
\color inherit
。
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $n<m$
\end_inset

，我们称为 超参变换，单元为超参单元；
\end_layout

\begin_layout Enumerate
如果 
\begin_inset Formula $n>m$
\end_inset

，我们称为亚参变换，单元为亚参单元。
\end_layout

\begin_layout Enumerate
为什么会出现等参单元，因为方便。局部坐标系下的单元是很规则的单元，我们可以很容易通过 Lagrange 插值、划线法、Hermite插值来构造
 单元内场的插值函数。而且，如果单元是等参单元的话，坐标变换也可以运用场的插值函数，把局部坐标系下的规则单元变换为笛卡尔坐标系、极坐标、球坐标下的各种离奇形状的
单元。即使这么做，对于刚度矩阵、力向量的积分上也不会很困难，所以我们很热爱等参单元。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
很多时候划分网格后的单元是很不规则的，造成的结果是每个 element 都要用不同的 shape function，非常麻烦。于是有的哥们就思考能不能将单元标准
化，即把单元都 mapping 成同一个单元，这样不就简单了吗。拿简单的一维问题为例，如下图：
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/element-mapping.png
	scale 50

\end_inset


\end_layout

\begin_layout Enumerate
目标是将局部坐标系(local coordinates) 映射成范围是 
\begin_inset Formula $-1$
\end_inset

 到 
\begin_inset Formula $1$
\end_inset

 的自然坐标系(natural coordinates)。可是如何做到呢，于是这个哥们深入思考发现：如果场函数插值(比如例子中的位移场)，和单元
 局部坐标系 到 自然坐标系 的变换使用同一个 shape function 不就行了吗？这样说可能比较抽象，下面的公式比较直观：
\begin_inset Formula 
\begin{align*}
 & x\left(\xi\right)=N_{i}\left(\xi\right)x_{i},\\
 & u\left(\xi\right)=N_{i}\left(\xi\right)u_{i}.
\end{align*}

\end_inset

其中 
\begin_inset Formula $x$
\end_inset

 是局部坐标系坐标，
\begin_inset Formula $x_{i}$
\end_inset

 是结点的局部坐标，
\begin_inset Formula $u_{i}$
\end_inset

 是节点在局部坐标系下的位移，
\begin_inset Formula $u$
\end_inset

 则是插值后的位移场。
\end_layout

\begin_layout Enumerate
举个例子，对于结点 
\begin_inset Formula $1$
\end_inset

(
\begin_inset Formula $i=1$
\end_inset

)，
\begin_inset Formula 
\[
N_{1}(-1)=1,N_{2}(-1)=0,
\]

\end_inset

 所以 
\begin_inset Formula $x\left(-1\right)=x_{1}$
\end_inset

，
\begin_inset Formula $u(-1)=u_{1}$
\end_inset

，两个插值使用同一个shape function。mapping 到 
\begin_inset Formula $\left[-1,1\right]$
\end_inset

 的另一个好处是积分方便，通常可以使用如下近似方程（以二维为例）：
\begin_inset Formula 
\[
\int_{-1}^{1}\int_{-1}^{1}\phi(\xi,\eta)\dd{\xi}\dd{\eta}\approx\phi(1/\sqrt{3},1/\sqrt{3})+\phi(-1/\sqrt{3},-1/\sqrt{3})+\phi(-1/\sqrt{3},1/\sqrt{3})+\phi(1/\sqrt{3},-1/\sqrt{3}).
\]

\end_inset

当然，由于 shape function 
\begin_inset Formula $N_{i}$
\end_inset

 现在是 
\begin_inset Formula $\xi$
\end_inset

 的函数，而积分时需要的经常是 
\begin_inset Formula $\partial N_{i}/\partial x$
\end_inset

，所以需要引入雅可比 
\begin_inset Formula $J$
\end_inset

(Jacobian)，即 
\begin_inset Formula $\dd{x}\dd{\xi}$
\end_inset

 。这样就可以通过链式法则：
\begin_inset Formula $\frac{\partial N_{i}}{\partial\xi}=\frac{\partial N_{i}}{\partial x}\frac{\dd{x}}{\dd{\xi}}$
\end_inset

 得出 
\begin_inset Formula $\frac{\partial N_{i}}{\partial x}=\frac{1}{J}\frac{\partial N_{i}}{\partial\xi}$
\end_inset

。
\end_layout

\begin_layout Enumerate
同理，对于三角形单元，可以将其 mapping 成直角边为 
\begin_inset Formula $1$
\end_inset

 的等腰直角三角形；对于四边形单元，可以将其 mapping 成顶点分别为 
\begin_inset Formula $(-1,-1)$
\end_inset

，
\begin_inset Formula $(-1,1)$
\end_inset

, 
\begin_inset Formula $(1,-1)$
\end_inset

, 
\begin_inset Formula $(1,1)$
\end_inset

 的正方形，等等。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Chapter
形函数
\end_layout

\begin_layout Standard
在有限元中，求解区域被划分成小单元。每个小单元内的点，包括边界，也使用形函数插值得到：
\begin_inset Formula 
\[
X=\sum_{i}N_{i}^{e}\left(\xi_{1},\cdots\xi_{n}\right)X_{i}
\]

\end_inset

其中 
\begin_inset Formula $X_{i}$
\end_inset

 是节点坐标，
\begin_inset Formula $X$
\end_inset

 是单元 
\begin_inset Formula $e$
\end_inset

 的内点，对应于等参平面上的点 
\begin_inset Formula $(\xi_{1},\cdots\xi_{n})$
\end_inset

 。如果区域不是平面/直线，例如对于圆弧边界，插值得到的
\begin_inset Formula $X$
\end_inset

 将作为精确点 
\begin_inset Formula $X_{0}$
\end_inset

 的近似。
\end_layout

\begin_layout Standard
形函数具有支撑性质 
\begin_inset Formula $N_{i}^{e}(x_{j})=\delta_{ij}$
\end_inset

，也就是 
\begin_inset Formula $x_{i}$
\end_inset

 点上定义的形函数，只在这一点的邻域不为零，在单元的其它点上都为零。这一性质保证了插值出的结果在单元边界上至少是 
\begin_inset Formula $C^{0}$
\end_inset

 连续的。例如下左图的两个三角形单元，
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout

\backslash
documentclass[tikz,border=10pt]{standalone} 
\end_layout

\begin_layout Plain Layout

\backslash
usepackage{tikz} 
\end_layout

\begin_layout Plain Layout

\backslash
usetikzlibrary{positioning} 
\end_layout

\begin_layout Plain Layout

\backslash
begin{document}
\end_layout

\begin_layout Plain Layout

\backslash
begin{tikzpicture}[scale=1] 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=left:$1$](A) at (0,0); 
\backslash
coordinate [label=right:$2$] (B) at (2,0); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$3$] (C) at (1.5,1); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$4$] (D) at (3,1); 
\end_layout

\begin_layout Plain Layout

\backslash
draw (A) -- (B)--(C)--cycle; 
\backslash
draw (B) -- (C)--(D)--cycle; 
\backslash
node at (3.5, .5) {$
\backslash
Rightarrow$}; 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=left:$1$](A) at (4,0); 
\backslash
coordinate [label=below:$2$] (B) at (5,0); 
\end_layout

\begin_layout Plain Layout

\backslash
coordinate [label=above:$3$] (C) at (5,1); 
\backslash
coordinate [label=right:$4$] (D) at (6,0);
\end_layout

\begin_layout Plain Layout

\backslash
draw (A) -- (B)--(C)--cycle; 
\backslash
draw (B) -- (C)--(D)--cycle;
\end_layout

\begin_layout Plain Layout

\backslash
end{tikzpicture}
\end_layout

\begin_layout Plain Layout

\backslash
end{document} 
\end_layout

\end_inset

它们具有公共边 
\begin_inset Formula $2$
\end_inset

–
\begin_inset Formula $3$
\end_inset

，经过等参坐标变换，所有单元都变成标准单元–边长为
\begin_inset Formula $1$
\end_inset

的直角三角形，即右图。在等参坐标系中，两个单元的形状完全相同。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/ele-tri3-2.pdf
	lyxscale 150
	scale 80

\end_inset


\begin_inset Newline newline
\end_inset

某个单元内的场量的插值，在等参坐标系下写作：
\begin_inset Formula 
\[
\phi\left(\xi,\eta\right)=\sum_{i=1}^{n}N_{i}^{e}\left(\xi,\eta\right)\phi_{i}
\]

\end_inset

公共边上的场量即可以用单元
\begin_inset Formula $1$
\end_inset

表示，也可以用单元
\begin_inset Formula $2$
\end_inset

表示，即
\begin_inset Formula 
\[
\phi=\sum_{i=1}^{n}N_{i}^{(1)}\left(\xi,\eta\right)\phi_{i}^{(1)}=\sum_{i=1}^{n}N_{i}^{(2)}\left(\xi,\eta\right)\phi_{i}^{(2)}
\]

\end_inset

公共边在两个单元中的等参坐标 
\begin_inset Formula $(\xi,\eta)$
\end_inset

 是相同的，形函数在两个单元中也取相同的形式，因此唯一的差别在于顶点 
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $4$
\end_inset

 上 
\begin_inset Formula $\phi_{i}$
\end_inset

的取值，而它们的值一般不相等。因此两个单元对公共边上的场给出不同的插值，解决冲突的办法之一就是要求形函数满足 
\begin_inset Formula $N_{i}^{e}(x_{j})=\delta_{ij}$
\end_inset

，这样公共边上的值只取决于节点 
\begin_inset Formula $2$
\end_inset

，
\begin_inset Formula $3$
\end_inset

，所以至少是
\begin_inset Formula $C^{0}$
\end_inset

连续的。
\end_layout

\begin_layout Section
等参单元形函数
\end_layout

\begin_layout Standard
下面附上一些常用的等参单元的 shape function。
\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/triangle-ele.pdf
	scale 70

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics[{ Line[{ {0, 0}, {0, 1}, {1, 0}, {0, 0} }] , FontSize
 -> 13 , Text[1, {1, +3 delta}] , Text[2, {0 - 4 delta, 1 + delta}] , Text[3,
 {-6 delta, 2 delta}] } , Axes -> True, AxesOrigin -> {0, 0} , AxesStyle
 -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2"} , PlotRangePadding -> { {Scaled[0], Scaled[.1]}, {Scaled[0], Scaled[.1]}}
 , ImageSize -> Small ]
\end_layout

\end_inset


\begin_inset Formula 
\[
N^{(1)}=\xi_{1},\quad N^{(2)}=\xi_{2},\quad N^{(3)}=1-\xi_{1}-\xi_{2},
\]

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/rectangle-ele.pdf
	scale 70

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics[{ Line[{ {-1, -1}, {1, -1}, {1, 1}, {-1, 1}, {-1,
 -1} }] , FontSize -> 13 , Text[1, {-1 - 3 delta, -1 - 3 delta}] , Text[2,
 {1 + 3 delta, -1 - 3 delta}] , Text[3, {1 + 3 delta, 1 + 3 delta}] , Text[4,
 {-1 - 3 delta, 1 + 3 delta}] } , Axes -> True, AxesOrigin -> {0, 0} , AxesStyle
 -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2"} , PlotRangePadding -> { {Scaled[.1], Scaled[.1]}, {Scaled[.1], Scaled[.1]}}
 , ImageSize -> Small ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
N^{(1)} & =\frac{1}{4}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right),\\
N^{(2)} & =\frac{1}{4}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right),\\
N^{(3)} & =\frac{1}{4}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right),\\
N^{(4)} & =\frac{1}{4}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right).
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/Pyramid-ele.pdf
	lyxscale 50
	scale 55

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics3D[{ Line[{{1, 0, 0}, {0, 1, 0}, {0, 0, 1}, {1, 0,
 0}}], Line[{{1, 0, 0}, {0, 0, 0}, {0, 1, 0}}], Line[{{0, 0, 1}, {0, 0,
 0}}], , FontSize -> 13 , Text[1, {1 + 3 delta, 2 delta, 0}] , Text[2, {2
 delta, 1 + 3 delta, 0}] , Text[3, {2 delta, 2 delta, 1 + 3 delta}] , Text[4,
 {+3 delta, -delta, +3 delta}] } , Axes -> True, AxesOrigin -> {0, 0, 0}
 , AxesStyle -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2", "
\backslash
[Xi]_3"} , PlotRangePadding -> {Scaled[.1], Scaled[.1], Scaled[.1]} , ImageSize
 -> Medium , Boxed -> False ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
 & N^{(1)}=\xi_{1},\quad N^{(2)}=\xi_{2},\quad N^{(3)}=\xi_{3},\\
 & N^{(4)}=1-\xi_{1}-\xi_{2}-\xi_{3},
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename inset/cuboid-ele.pdf
	lyxscale 50
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
delta = 0.05; Graphics3D[{ Line[{{-1, -1, -1}, {1, -1, -1}, {1, 1, -1}, {-1,
 1, -1}, {-1, -1, -1}}], Line[{{-1, -1, 1}, {1, -1, 1}, {1, 1, 1}, {-1,
 1, 1}, {-1, -1, 1}}], Line[{{-1, -1, -1}, {-1, -1, 1}}], Line[{{1, -1,
 -1}, {1, -1, 1}}], Line[{{1, 1, -1}, {1, 1, 1}}], Line[{{-1, 1, -1}, {-1,
 1, 1} }], Line[{{0, 0, 1}, {0, 0, 0}}] , FontSize -> 13 , Text[1, {-1 -
 3 delta, -1 - 3 delta, -1 - 3 delta}], Text[5, {-1 - 3 delta, -1 - 3 delta,
 1 + 3 delta}] , Text[2, {1 + 3 delta, -1 - 3 delta, -1 - 3 delta}], Text[6,
 {1 + 3 delta, -1 - 3 delta, 1 + 3 delta}] , Text[3, {1 + 3 delta, 1 + 3
 delta, -1 - 3 delta}], Text[7, {1 + 3 delta, 1 + 3 delta, 1 + 3 delta}]
 , Text[4, {-1 - 3 delta, 1 + 3 delta, -1 - 3 delta}], Text[8, {-1 - 3 delta,
 1 + 3 delta, 1 + 3 delta}] } , Axes -> True, AxesOrigin -> {0, 0, 0} ,
 AxesStyle -> Arrowheads[{0.07}] , AxesLabel -> {"
\backslash
[Xi]_1", "
\backslash
[Xi]_2", "
\backslash
[Xi]_3"} , PlotRangePadding -> {Scaled[.1], Scaled[.1], Scaled[.1]} , ImageSize
 -> Medium , Boxed -> False ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Formula 
\begin{align*}
N^{(1)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(2)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(3)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(4)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right)\left(1-\xi_{3}\right),\\
N^{(5)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1-\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(6)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1-\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(7)} & =\frac{1}{8}\left(1+\xi_{1}\right)\left(1+\xi_{2}\right)\left(1+\xi_{3}\right),\\
N^{(8)} & =\frac{1}{8}\left(1-\xi_{1}\right)\left(1+\xi_{2}\right)\left(1+\xi_{3}\right),
\end{align*}

\end_inset


\end_layout

\begin_layout Section
一维形函数：直线元
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-line2.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; d1 = {0, 0.05}; Graphics[{ Line[{v1, v2}], PointSize[.04
], Point[{v1, v2}], Text["1", v1 + d1], Text["2", v2 + d1] } , ImageSize
 -> Small ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
一维有限元单元为连接节点 
\begin_inset Formula $x_{1}^{e}$
\end_inset

 和 
\begin_inset Formula $x_{2}^{e}$
\end_inset

 的线段。两个节点上的一阶形函数为：
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{x_{2}^{e}-x}{x_{2}^{e}-x_{1}^{e}},\quad N_{2}^{(1)}=\frac{x-x_{1}^{e}}{x_{2}^{e}-x_{1}^{e}}.
\]

\end_inset

或用等参表示为
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{1-\xi}{2},\quad N_{2}^{(1)}=\frac{1+\xi}{2}
\]

\end_inset

其中 
\begin_inset Formula $\xi$
\end_inset

 的取值范围是 
\begin_inset Formula $[-1,1]$
\end_inset

，与坐标的转换关系为：
\begin_inset Formula 
\[
\xi=\frac{x-(x_{1}^{e}+x_{2}^{e})/2}{(x_{2}^{e}-x_{1}^{e})/2}
\]

\end_inset

单元中某个内点的坐标 
\begin_inset Formula $x$
\end_inset

 可以用形函数，以及相应的节点坐标 
\begin_inset Formula $x_{i}$
\end_inset

 表示为：
\begin_inset Formula 
\begin{equation}
x=\sum_{i=1}^{n_{e}}N_{i}^{e}(\xi)x_{i}=\sum_{i=1}^{n_{e}}N_{i}^{e\prime}(x,y)x_{i}\label{eq:interp1d}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
一阶单元是 
\series bold
线性单元
\series default
。例如把曲线的参数取为横坐标
\begin_inset Formula $x$
\end_inset

，两节点的纵坐标分别是 
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $2$
\end_inset

。有限元插值
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:interp1d"
plural "false"
caps "false"
noprefix "false"

\end_inset

给出的内点落在一条直线上。
\begin_inset Newline newline
\end_inset


\begin_inset Graphics
	filename inset/ele-o1-regionInterp.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1, 
\backslash
[Xi]_] := (1 - 
\backslash
[Xi])/2; nShape[2, 
\backslash
[Xi]_] := (1 + 
\backslash
[Xi])/2; xi = {1, 2}; coord[
\backslash
[Xi]_] := Sum[xi[[n]]*nShape[n, 
\backslash
[Xi]], {n, 2}]; Plot[coord[
\backslash
[Xi]], {
\backslash
[Xi], -1, 1}, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{1}^{(1)}$
\end_inset

形函数在 
\begin_inset Formula $x_{2}$
\end_inset

处为零，即满足 
\begin_inset Formula $N_{i}^{e}\left(x_{j}\right)=\delta_{ij}$
\end_inset

。但
\begin_inset Formula 
\[
\partial_{x}N_{1}^{(1)}=\frac{-1}{\ell},\quad\partial_{x}N_{2}^{(1)}=\frac{1}{\ell},
\]

\end_inset

在整个单元上为常数。如右图 
\begin_inset Formula $1,2$
\end_inset

组成单元
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $2,3$
\end_inset

为单元
\begin_inset Formula $B$
\end_inset

，
\begin_inset Graphics
	filename inset/ele-line-pair.pdf
	lyxscale 80
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; v3 = {2, 0}; d1 = {0, 0.1}; d2 = {0.5, 0.1}; Graphics[{
 Line[{v1, v2, v3}], PointSize[.04], Point[{v1, v2, v3}], Text["1", v1 +
 d1], Text["2", v2 + d1], Text["3", v3 + d1], Text["A", v1 + d2], Text["B",
 v2 + d2] } , ImageSize -> Small ]
\end_layout

\end_inset

。 点 
\begin_inset Formula $2$
\end_inset

是单元
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $B$
\end_inset

 的公共点，
\begin_inset Formula $A$
\end_inset

，
\begin_inset Formula $B$
\end_inset

单元分别在点
\begin_inset Formula $2$
\end_inset

 有形函数，记作
\begin_inset Formula $N_{2}^{A}$
\end_inset

，
\begin_inset Formula $N_{2}^{B}$
\end_inset

 ，它们对点
\begin_inset Formula $2$
\end_inset

 的 
\begin_inset Formula $\phi$
\end_inset

 贡献相同，但是它们对点 
\begin_inset Formula $2$
\end_inset

 的梯度（一阶导数）的贡献是不同的，因为
\begin_inset Formula $\nabla\phi=\sum\phi_{\alpha}\nabla N_{\alpha}$
\end_inset

，通过考虑全局编号和局部编号关系可知 
\begin_inset Formula $N_{2}^{A}=\frac{1}{\ell}$
\end_inset

，
\begin_inset Formula $N_{2}^{A}=\frac{-1}{\ell}$
\end_inset

。
\end_layout

\begin_layout Subsection
一维二阶形函数
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-line3.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {0, 0}; v2 = {1, 0}; v3 = {2, 0}; d1 = {0, 0.1}; d2 = {0.5, 0.1}; Graphics[{
 Line[{v1, v2, v3}], PointSize[.04], Point[{v1, v2, v3}], Text["1", v1 +
 d1], Text["2", v2 + d1], Text["3", v3 + d1] } , ImageSize -> Small ]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
在一维有限元单元上添加中点，可以构造二阶形函数。二阶形函数可以由一阶形函数直接生成。首先，边中点形函数 
\begin_inset Formula $N_{3}^{(2)}$
\end_inset

 可以由两个节点的一阶形函数生成，即
\begin_inset Formula 
\[
N_{3}^{(2)}=4N_{1}^{(1)}N_{2}^{(1)}
\]

\end_inset

节点的二阶形函数可以由 节点的一阶形函数，和中点的二阶形函数生成，即
\begin_inset Formula 
\[
N_{i}^{(2)}=N_{i}^{(1)}-\frac{1}{2}N_{3}^{(2)},\quad i\in\{1,2\}
\]

\end_inset

最后得到二阶形函数的表达式：
\begin_inset Formula 
\begin{align*}
\text{端点形函数：} & N_{1}^{(2)}=\frac{\xi(\xi-1)}{2}\\
\text{端点形函数：} & N_{2}^{(2)}=\frac{\xi(\xi+1)}{2}\\
\text{中点形函数：} & N_{3}^{(2)}=(1+\xi)(1-\xi)
\end{align*}

\end_inset

类似地，单元内点由插值得到
\begin_inset Formula 
\begin{equation}
x=\sum_{i=1}^{n_{e}}N_{i}^{(2)}(\xi)x_{i},\quad\xi\in[-1,1]\label{eq:interp2d}
\end{equation}

\end_inset

对内点的二阶形函数插值，给出二阶单元，二阶单元可以精确拟合二次曲线。例如下图，两端点纵坐标都是
\begin_inset Formula $1$
\end_inset

，中点纵坐标是 
\begin_inset Formula $2$
\end_inset

，二阶单元给出的插值曲线为：
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1, 
\backslash
[Xi]_] := (
\backslash
[Xi] (
\backslash
[Xi] - 1))/2; nShape[2, 
\backslash
[Xi]_] := (
\backslash
[Xi] (
\backslash
[Xi] + 1))/2; nShape[3, 
\backslash
[Xi]_] := (1 + 
\backslash
[Xi]) (1 - 
\backslash
[Xi]); xi = {1, 1, 2}; coord[
\backslash
[Xi]_] := Sum[xi[[n]]*nShape[n, 
\backslash
[Xi]], {n, 3}]; Plot[coord[
\backslash
[Xi]], {
\backslash
[Xi], -1, 1}, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-o2-regionInterp.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Standard
计算中经常会用到 几何坐标 和 等参坐标 微分之间的转换，即
\begin_inset Formula 
\[
J=\frac{\partial x}{\partial\xi}=\frac{\partial N_{i}^{e}}{\partial\xi}x_{i}
\]

\end_inset


\end_layout

\begin_layout Section
二维形函数：三角元
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-tri3.pdf
	lyxscale 70
	scale 40

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
v1 = {-1, 0}; v2 = {1, 0}; v3 = {0, Sqrt[3]}; Graphics[{Line[{v1, v2, v3,
 v1}], PointSize[0.03], Point[{v1, v2, v3}], FontSize -> 14, Text["1", {-1.1,
 0}], Text["2", {1.1, 0}], Text["3", {0, Sqrt[3] + 0.1}] }, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
由二维三角形单元顶点的三个坐标可以定义相应的一阶形函数：
\begin_inset Formula 
\begin{align}
 & N_{1}^{(1)}=\frac{\Delta_{1}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{1}^{e}+b_{1}^{e}x+c_{1}^{e}y\right),\label{eq:shape-2-1}\\
 & N_{2}^{(1)}=\frac{\Delta_{2}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{2}^{e}+b_{2}^{e}x+c_{2}^{e}y\right),\nonumber \\
 & N_{3}^{(1)}=\frac{\Delta_{3}}{\Delta^{e}}=\frac{1}{2\Delta^{e}}\left(a_{3}^{e}+b_{3}^{e}x+c_{3}^{e}y\right).\nonumber 
\end{align}

\end_inset

二维形函数的等参坐标取值为 
\begin_inset Formula $[0,1]$
\end_inset

，一阶形函数可以用等参坐标表示为：
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(1)}=1-\xi-\eta,\\
 & N_{2}^{(1)}=\xi\\
 & N_{3}^{(1)}=\eta
\end{align*}

\end_inset


\end_layout

\begin_layout Remark
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:shape-2-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

中系数的定义为
\begin_inset Formula 
\begin{align*}
 & a_{1}^{e}=x_{2}^{e}y_{3}^{e}-y_{2}^{e}x_{3}^{e}; &  & b_{1}^{e}=y_{2}^{e}-y_{3}^{e}; &  & c_{1}^{e}=x_{3}^{e}-x_{2}^{e}\\
 & a_{2}^{e}=x_{3}^{e}y_{1}^{e}-y_{3}^{e}x_{1}^{e}; &  & b_{2}^{e}=y_{3}^{e}-y_{1}^{e}; &  & c_{2}^{e}=x_{1}^{e}-x_{3}^{e}\\
 & a_{3}^{e}=x_{1}^{e}y_{2}^{e}-y_{1}^{e}x_{2}^{e}; &  & b_{3}^{e}=y_{1}^{e}-y_{2}^{e}; &  & c_{3}^{e}=x_{2}^{e}-x_{1}^{e}
\end{align*}

\end_inset

以及
\begin_inset Formula 
\[
\Delta^{e}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right]
\]

\end_inset


\begin_inset Formula 
\[
\Delta_{1}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x & y\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right],\quad\Delta_{2}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x & y\\
1 & x_{3}^{e} & y_{3}^{e}
\end{array}\right],\quad\Delta_{3}=\frac{1}{2}\det\left[\begin{array}{ccc}
1 & x_{1}^{e} & y_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e}\\
1 & x & y
\end{array}\right].
\]

\end_inset


\end_layout

\begin_layout Subsection
矩阵形式
\end_layout

\begin_layout Standard
一阶形函数变换可以写成矩阵形式：
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}
\end{array}\right\} =\frac{1}{2\Delta^{e}}\left[\begin{array}{ccc}
x_{2}y_{3}-x_{3}y_{2} & y_{2}-y_{3} & x_{3}-x_{2}\\
x_{3}y_{1}-x_{1}y_{3} & y_{3}-y_{1} & x_{1}-x_{3}\\
x_{1}y_{2}-x_{2}y_{1} & y_{1}-y_{2} & x_{2}-x_{1}
\end{array}\right]\left\{ \begin{array}{c}
1\\
x\\
y
\end{array}\right\} \label{eq:4.160}
\end{equation}

\end_inset


\begin_inset Formula 
\[
2\Delta^{e}=\det[J]=(y_{2}-y_{3})(x_{1}-x_{3})-(y_{3}-y_{1})(x_{3}-x_{2})
\]

\end_inset


\begin_inset Formula $L_{j}^{e}$
\end_inset

 就是一阶三角形单元的形函数。逆变换矩阵为
\begin_inset Formula 
\begin{equation}
\left\{ \begin{array}{c}
1\\
x\\
y
\end{array}\right\} =\left[\begin{array}{ccc}
1 & 1 & 1\\
x_{1}^{e} & x_{2}^{e} & x_{3}^{e}\\
y_{1}^{e} & y_{2}^{e} & y_{3}^{e}
\end{array}\right]\left\{ \begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}
\end{array}\right\} .\label{eq:4.161}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
雅可比矩阵
\end_layout

\begin_layout Standard
雅可比矩阵可以给出 几何坐标 
\begin_inset Formula $(x,y)$
\end_inset

 与 等参坐标 
\begin_inset Formula $(\xi,\eta)$
\end_inset

 之间，微分的变换关系：
\begin_inset Formula 
\[
[J]=\left[\begin{array}{cc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta}
\end{array}\right]=\left[\begin{array}{cc}
-x_{1}+x_{2} & -y_{1}+y_{2}\\
-x_{1}+x_{3} & -y_{1}+y_{3}
\end{array}\right]
\]

\end_inset


\begin_inset Formula 
\[
\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial\xi}\\
\frac{\partial N_{i}^{e}}{\partial\eta}
\end{array}\right)=[J]\left(\begin{array}{c}
\frac{\partial N_{i}^{e}}{\partial x}\\
\frac{\partial N_{i}^{e}}{\partial y}
\end{array}\right)
\]

\end_inset


\end_layout

\begin_layout Subsection
二维二阶形函数
\end_layout

\begin_layout Standard
在三角形单元各个边中点增加一个节点之后，可以构造出相应的二阶形函数，
\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-Tri6.pdf
	scale 50

\end_inset


\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
Graphics[{ Line[{{-1, 0}, {1, 0}, {0, Sqrt[3]}, {-1, 0}}], PointSize[0.03],
 Point[{{0, 0}, {0.5, Sqrt[3]/2}, {-0.5, Sqrt[3]/2}}], Style[Text["1", {-1.1,
 0}], 16], Style[Text["4", {0, -0.16}], 16], Style[Text["2", {1.1, 0}], 16],
 Style[Text["5", {0.62, Sqrt[3]/2}], 16], Style[Text["3", {0, Sqrt[3] + 0.1}],
 16], Style[Text["6", {-0.62, Sqrt[3]/2}], 16] }, ImageSize -> Small]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
边中点形函数 
\begin_inset Formula $N_{i}^{(2)}$
\end_inset

 可以由两个节点的一阶形函数生成，即
\begin_inset Formula 
\begin{align*}
 & N_{4}^{(2)}=4N_{1}^{(1)}N_{2}^{(1)}\\
 & N_{5}^{(2)}=4N_{3}^{(1)}N_{2}^{(1)}\\
 & N_{6}^{(2)}=4N_{1}^{(1)}N_{3}^{(1)}
\end{align*}

\end_inset

顶点的二阶形函数，可以由顶点的一阶形函数，和 邻接边中点的二阶形函数生成
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(2)}=N_{1}^{(1)}-\frac{1}{2}[N_{4}^{(1)}+N_{6}^{(1)}]\\
 & N_{2}^{(2)}=N_{2}^{(1)}-\frac{1}{2}[N_{4}^{(1)}+N_{5}^{(1)}]\\
 & N_{3}^{(2)}=N_{3}^{(1)}-\frac{1}{2}[N_{5}^{(1)}+N_{6}^{(1)}]
\end{align*}

\end_inset

最后可以得到
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(2)}=\left(1-\xi-\eta\right)\left(1-2\xi-2\eta\right)\\
 & N_{2}^{(2)}=\xi\left(2\xi-1\right)\\
 & N_{3}^{(2)}=\eta\left(2\eta-1\right)\\
 & N_{4}^{(2)}=4\left(1-\xi-\eta\right)\xi\\
 & N_{5}^{(2)}=4\xi\eta\\
 & N_{6}^{(2)}=4\left(1-\xi-\eta\right)\eta
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
单元内点的坐标 
\begin_inset Formula $(x,y)$
\end_inset

 ，可以用 形函数 以及 节点处的坐标 
\begin_inset Formula $\left(x_{i},y_{i}\right)$
\end_inset

 表示为
\begin_inset Formula 
\begin{align*}
 & x=\sum_{i}N_{i}^{e}\left(x,y\right)x_{i}\\
 & y=\sum_{i}N_{i}^{e}\left(x,y\right)y_{i}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
如图，对于曲线边界的几何区域，使用二阶形函数插值能给出贴合得更好的单元
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
nShape[1][
\backslash
[Xi]_, 
\backslash
[Eta]_] := (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) (1 - 2 
\backslash
[Xi] - 2 
\backslash
[Eta]); nShape[2][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 
\backslash
[Xi] (2 
\backslash
[Xi] - 1); nShape[3][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 
\backslash
[Eta] (2 
\backslash
[Eta] - 1);
\end_layout

\begin_layout Plain Layout
nShape[4][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) 
\backslash
[Xi]; nShape[5][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 
\backslash
[Xi] 
\backslash
[Eta]; nShape[6][
\backslash
[Xi]_, 
\backslash
[Eta]_] := 4 (1 - 
\backslash
[Xi] - 
\backslash
[Eta]) 
\backslash
[Eta]; 
\backslash
[Delta] = 0.1;(*midpoint offset*) xi = { {-1, 0}, {1, 0}, {0, Sqrt[3]}, {0,
 0 - 
\backslash
[Delta]}, {0.5 - 
\backslash
[Delta], Sqrt[3]/2}, {-(0.5 + 
\backslash
[Delta]), Sqrt[3]/2} }; coord[
\backslash
[Xi]_, 
\backslash
[Eta]_] := Sum[xi[[n]]*nShape[n][
\backslash
[Xi], 
\backslash
[Eta]], {n, 6}]; ParametricPlot[ coord[
\backslash
[Xi], 
\backslash
[Eta]], {
\backslash
[Xi], 0, 1}, {
\backslash
[Eta], 0, 1 - 
\backslash
[Xi]}, ImageSize -> Tiny]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/ele-tri6-RegionIntep.png
	scale 65

\end_inset


\end_layout

\begin_layout Standard
有限元计算中，经常用到下面公式所示的形函数积分性质：
\begin_inset Formula 
\[
\int_{\Omega^{e}}(L_{1}^{e})^{\ell}(L_{2}^{e})^{m}(L_{3}^{e})^{n}\dd{x}\dd{y}=\frac{\ell!m!n!}{(\ell+m+n+2)!}2\Delta^{e}
\]

\end_inset


\end_layout

\begin_layout Section
三维形函数：四面体
\end_layout

\begin_layout Standard
\align left
\begin_inset Graphics
	filename inset/Pyramid-ele.pdf
	lyxscale 50
	scale 55

\end_inset


\end_layout

\begin_layout Standard
三维 四面体有限元 四个顶点的一阶 形函数定义为：
\begin_inset Formula 
\[
N_{1}^{(1)}=\frac{V_{1}}{V^{e}},\quad N_{2}^{(1)}=\frac{V_{2}}{V^{e}},\quad N_{3}^{(1)}=\frac{V_{3}}{V^{e}},\quad N_{4}^{(1)}=\frac{V_{4}}{V^{e}},
\]

\end_inset

其中
\begin_inset Formula 
\[
V^{e}=\frac{1}{6}\det\left[\begin{array}{cccc}
1 & x_{1}^{e} & y_{1}^{e} & z_{1}^{e}\\
1 & x_{2}^{e} & y_{2}^{e} & z_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e} & z_{3}^{e}\\
1 & x_{4}^{e} & y_{4}^{e} & z_{4}^{e}
\end{array}\right]
\]

\end_inset

仿照二维情况，可以计算出 
\begin_inset Formula $V_{i}$
\end_inset

。例如
\begin_inset Formula 
\[
V_{1}=\frac{1}{6}\det\left[\begin{array}{cccc}
1 & x & y & z\\
1 & x_{2}^{e} & y_{2}^{e} & z_{2}^{e}\\
1 & x_{3}^{e} & y_{3}^{e} & z_{3}^{e}\\
1 & x_{4}^{e} & y_{4}^{e} & z_{4}^{e}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Example
三维形函数等参坐标取值范围 
\begin_inset Formula $\xi,\eta,\zeta\in\left[0,1\right]$
\end_inset

，一阶形函数可以用等参坐标表示为：
\begin_inset Formula 
\begin{align*}
 & N_{1}^{(1)}=1-\xi-\eta-\zeta\\
 & N_{2}^{(1)}=\xi\\
 & N_{3}^{(1)}=\eta\\
 & N_{4}^{(1)}=\zeta
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
等参坐标 和 几何坐标 之间的变换关系，正变换为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
1\\
x\\
y\\
z
\end{array}\right]=\left[\begin{array}{cccc}
1 & 1 & 1 & 1\\
x_{1} & x_{2} & x_{3} & x_{4}\\
y_{1} & y_{2} & y_{3} & y_{4}\\
z_{1} & z_{2} & z_{3} & z_{4}
\end{array}\right]\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right],\quad\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right]=\left[\begin{array}{c}
1-\xi-\eta-\zeta\\
\xi\\
\eta\\
\zeta
\end{array}\right]
\]

\end_inset

这里按照常用的记号约定，也引入了 
\begin_inset Formula $L_{i}^{e}$
\end_inset

 表示等参坐标。对应的 逆变换 为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
L_{1}^{e}\\
L_{2}^{e}\\
L_{3}^{e}\\
L_{4}^{e}
\end{array}\right]=\frac{1}{\det\left[J\right]}\left[\begin{array}{cccc}
a_{1} & b_{1} & c_{1} & d_{1}\\
a_{2} & b_{2} & c_{2} & d_{2}\\
a_{3} & b_{3} & c_{3} & d_{3}\\
a_{4} & b_{4} & c_{4} & d_{4}
\end{array}\right]\left[\begin{array}{c}
1\\
x\\
y\\
z
\end{array}\right]
\]

\end_inset

简记为：
\begin_inset Formula 
\begin{align*}
 & X_{\alpha}=T_{\alpha\beta}L_{\beta},\\
 & L_{\alpha}=T_{\alpha\beta}^{-1}X_{\beta}
\end{align*}

\end_inset

其中 
\begin_inset Formula $X=\left(1,x,y,z\right),$
\end_inset


\begin_inset Formula $L=\left(1-\xi-\eta-\zeta,\xi,\eta,\zeta\right)$
\end_inset

。
\end_layout

\begin_layout Example
其中各系数的值为：
\begin_inset Formula 
\[
\left[\begin{array}{ccc}
b_{1} & c_{1} & d_{1}\\
b_{2} & c_{2} & d_{2}\\
b_{3} & c_{3} & d_{3}\\
b_{4} & c_{4} & d_{4}
\end{array}\right]=\left[\begin{array}{ccc}
y_{42}z_{32}-y_{32}z_{42} & x_{32}z_{42}-x_{42}z_{32} & x_{42}y_{32}-x_{32}y_{42}\\
y_{31}z_{43}-y_{34}z_{13} & x_{43}z_{31}-x_{31}z_{43} & x_{31}y_{43}-x_{43}y_{31}\\
y_{24}z_{14}-y_{14}z_{24} & x_{14}z_{24}-x_{24}z_{14} & x_{24}y_{14}-x_{14}y_{24}\\
y_{13}z_{21}-y_{21}z_{13} & x_{21}z_{13}-x_{13}z_{21} & x_{13}y_{21}-x_{21}y_{13}
\end{array}\right]
\]

\end_inset


\begin_inset Formula $T$
\end_inset

 的第一列的值为：
\begin_inset Formula 
\[
\left[\begin{array}{c}
a_{1}\\
a_{2}\\
a_{3}\\
a_{4}
\end{array}\right]=\left[\begin{array}{c}
x_{2}\left(y_{3}z_{4}-y_{4}z_{3}\right)+x_{3}\left(y_{4}z_{2}-y_{2}z_{4}\right)+x_{4}\left(y_{2}z_{3}-y_{3}z_{2}\right)\\
x_{1}\left(y_{4}z_{3}-y_{3}z_{4}\right)+x_{3}\left(y_{1}z_{4}-y_{4}z_{1}\right)+x_{4}\left(y_{3}z_{1}-y_{1}z_{3}\right)\\
x_{1}\left(y_{2}z_{4}-y_{4}z_{2}\right)+x_{2}\left(y_{4}z_{1}-y_{1}z_{4}\right)+x_{4}\left(y_{1}z_{2}-y_{2}z_{1}\right)\\
x_{1}\left(y_{3}z_{2}-y_{2}z_{3}\right)+x_{2}\left(y_{1}z_{3}-y_{3}z_{1}\right)+x_{3}\left(y_{2}z_{1}-y_{1}z_{2}\right)
\end{array}\right]
\]

\end_inset


\begin_inset Formula 
\[
\det\left[J\right]=6V^{e}=x_{21}\left(y_{23}z_{34}-y_{34}z_{23}\right)+x_{32}\left(y_{34}z_{12}-y_{12}z_{34}\right)+x_{43}\left(y_{12}z_{23}-y_{23}z_{12}\right).
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
由坐标的逆变换矩阵，可以计算形函数的梯度
\begin_inset Formula 
\[
\left[\begin{array}{c}
\nabla L_{1}^{e}\\
\nabla L_{2}^{e}\\
\nabla L_{3}^{e}\\
\nabla L_{4}^{e}
\end{array}\right]=\frac{1}{\det\left[J\right]}\left[\begin{array}{ccc}
b_{1} & c_{1} & d_{1}\\
b_{2} & c_{2} & d_{2}\\
b_{3} & c_{3} & d_{3}\\
b_{4} & c_{4} & d_{4}
\end{array}\right]\left[\begin{array}{c}
\sbf e_{x}\\
\sbf e_{y}\\
\sbf e_{z}
\end{array}\right]
\]

\end_inset

约定：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $M=\left[b_{i},c_{i},d_{i}\right]$
\end_inset

矩阵；希腊字母表示
\begin_inset Formula $\{1,2,3,4\}$
\end_inset

，对应节点数；
\end_layout

\begin_layout Enumerate
拉丁字母表示 
\begin_inset Formula $\{1,2,3\}$
\end_inset

，对应三维空间坐标
\begin_inset Formula $x,y,z$
\end_inset

：
\end_layout

\begin_layout Standard
则 
\begin_inset Formula $\nabla L^{e}$
\end_inset

 的各分量形式为：
\begin_inset Formula 
\begin{equation}
\partial_{i}L_{\alpha}^{e}=\frac{1}{\det\left[J\right]}{\color{blue}M_{\alpha i}}\label{eq:shapeGrad}
\end{equation}

\end_inset


\end_layout

\begin_layout Section
雅可比矩阵等式
\end_layout

\begin_layout Standard
在每个单元上，根据 单元顶点的坐标组，定义了 
\color blue
几何坐标
\color inherit
（物理时空坐标）和 
\color blue
等参坐标
\color inherit
 之间的变换关系。
\end_layout

\begin_layout Enumerate
等参坐标组 
\begin_inset Formula $\left\{ \xi\right\} $
\end_inset

，对每个单元形式上相同，实际上依赖于 全局几何坐标 
\begin_inset Formula $\{X\}$
\end_inset

。
\end_layout

\begin_layout Enumerate
对于确定类型的单元，坐标变换矩阵 
\begin_inset Formula $T$
\end_inset

 由单元决定，而单元由顶点决定，因此通过 顶点坐标
\begin_inset Formula $\{X_{i}\}$
\end_inset

，可以参数出 雅可比矩阵 
\begin_inset Formula $[J]=\partial X/\partial\xi$
\end_inset

；
\end_layout

\begin_layout Enumerate
单元内点的几何坐标总是参数化成 
\begin_inset Formula $X=\sum_{i}N_{i}^{e}\left(x,y\right)X_{i}$
\end_inset

，形函数 
\begin_inset Formula $\{N_{i}^{e}\}$
\end_inset

 可以取不同 order，则对应的雅可比 
\begin_inset Formula $[J]$
\end_inset

 取不同的形式。
\end_layout

\begin_layout Enumerate
对于确定 order 的形函数 
\begin_inset Formula $\{N_{i}^{e}\}$
\end_inset

，除了顶点坐标组 
\begin_inset Formula $\{X_{i}\}$
\end_inset

 带来的区别，
\begin_inset Formula $[J]$
\end_inset

 中其它系数是固定的，只和 
\begin_inset Formula $\{N_{i}^{e}\}$
\end_inset

 在等参系中的函数形式有关。
\end_layout

\begin_layout Standard
因此变换的 雅可比矩阵 可以通过 各个顶点
\end_layout

\begin_layout Standard
可以计算出在三维直角坐标系中，雅可比矩阵为：
\begin_inset Formula 
\begin{equation}
\left[J\right]=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}\\
\frac{\partial x}{\partial\zeta} & \frac{\partial y}{\partial\zeta} & \frac{\partial z}{\partial\zeta}
\end{array}\right]=-\left[\begin{array}{ccc}
x_{12} & y_{12} & z_{12}\\
x_{13} & y_{13} & z_{13}\\
x_{14} & y_{14} & z_{14}
\end{array}\right].\label{eq:jacobi3d}
\end{equation}

\end_inset

其中记号约定为： 
\begin_inset Formula $x_{12}=x_{1}-x_{2}$
\end_inset

，其他类似。雅可比矩阵的逆矩阵为
\begin_inset Formula 
\[
\left[J^{-1}\right]=\frac{1}{\det\left[J\right]}\left[\begin{array}{ccc}
b_{2} & b_{3} & b_{4}\\
c_{2} & c_{3} & c_{4}\\
d_{2} & d_{3} & d_{4}
\end{array}\right].
\]

\end_inset


\end_layout

\begin_layout Example
令 
\begin_inset Formula $r_{\alpha j}$
\end_inset

 表示四面体单元中，节点的坐标矩阵，
\begin_inset Formula 
\[
r_{\alpha j}=\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]
\]

\end_inset

根据 雅可比矩阵 的表达式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi3d"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以计算出：
\begin_inset Formula 
\[
\frac{\partial\det[J]}{\partial r_{\alpha j}}={\color{blue}M_{\alpha j}},\quad{\color{blue}M_{\alpha j}}=\left[\begin{array}{ccc}
b_{1} & c_{1} & d_{1}\\
b_{2} & c_{2} & d_{2}\\
b_{3} & c_{3} & d_{3}\\
b_{4} & c_{4} & d_{4}
\end{array}\right]
\]

\end_inset

 考虑到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:shapeGrad"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\partial_{i}L_{\alpha}^{e}=\frac{1}{\det\left[J\right]}{\color{blue}M_{\alpha i}}$
\end_inset

，因此有
\begin_inset Formula 
\begin{equation}
\frac{\partial\det[J]}{\partial r_{\alpha j}}=\det[J]\,\partial_{j}L_{\alpha}^{e}\label{eq:xl6.7}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi3d"
plural "false"
caps "false"
noprefix "false"

\end_inset

，计算出雅可比逆矩阵的偏导
\begin_inset Formula 
\[
\frac{\partial[J^{-1}]}{\partial\sbf r_{\alpha}}=-[J^{-1}]\frac{\partial J}{\partial\sbf r_{\alpha}}[J^{-1}]=-\frac{1}{\det[J]}\left[\begin{array}{c}
b_{\alpha}\\
c_{\alpha}\\
d_{\alpha}
\end{array}\right]\left[\begin{array}{ccc}
\sbf e_{x} & \sbf e_{y} & \sbf e_{z}\end{array}\right][J^{-1}]
\]

\end_inset

同样引入 节点坐标矩阵 
\begin_inset Formula $r_{\alpha j}=\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]$
\end_inset

，可以写成分量形式
\begin_inset Formula 
\begin{align}
\frac{\partial J_{kj}^{-1}}{\partial r_{\alpha i}}=-\partial_{k}L_{\alpha}^{e}\;J_{ij}^{-1}.\label{eq:xl6.8}
\end{align}

\end_inset


\end_layout

\begin_layout Example
推导是在 三维直角坐标系 中进行的，即
\begin_inset Formula 
\[
\frac{\partial J_{kj}^{-1}}{\partial r_{\alpha i}}\sbf e_{i}=-\partial_{k}L_{\alpha}^{e}\;\sbf e_{i}J_{ij}^{-1},\quad\sbf e_{i}=(\sbf e_{x},\sbf e_{y},\sbf e_{z}).
\]

\end_inset


\end_layout

\begin_layout Section
Edge单元
\end_layout

\begin_layout Standard
在有限元方法计算磁场时，特别是三维磁场，通常会使用在单元边上定义的 Edge 单元（而非节点上定义的）作为待求未知量。图1.1为四面体单元上棱边与节点的对应关系，
在棱边 
\begin_inset Formula $i$
\end_inset

 上可以定义形函数：
\begin_inset Formula 
\[
\sbf N_{i}^{e}=\left(L_{i_{1}}^{e}\nabla L_{i_{2}}^{e}-L_{i_{2}}^{e}\nabla L_{i_{1}}^{e}\right)\ell_{i}^{e}
\]

\end_inset

其中 
\begin_inset Formula $i_{1}$
\end_inset

与 
\begin_inset Formula $i_{2}$
\end_inset

为与棱边
\begin_inset Formula $i$
\end_inset

 邻接的两个顶点。
\begin_inset Formula $\ell_{i}^{e}$
\end_inset

 的绝对值等于棱边的长度，正负号由节点的总体编号决定。形函数 
\begin_inset Formula $\sbf N_{i}^{e}$
\end_inset

 为一矢量，相应的矢量图可以参照图1.2所示的二维情况。
\end_layout

\begin_layout Chapter
静电场
\end_layout

\begin_layout Section
轴对称电场
\end_layout

\begin_layout Standard
柱坐标 
\begin_inset Formula $(r,\phi,z)$
\end_inset

 下的 
\begin_inset Formula $\nabla^{2}$
\end_inset

 算子：
\begin_inset Formula 
\[
\nabla^{2}\psi=\frac{1}{r}\partial_{r}\left(r\,\partial_{r}\psi\right)+\frac{1}{r^{2}}\partial_{\phi}^{2}\psi+\partial_{z}^{2}\psi
\]

\end_inset


\end_layout

\begin_layout Standard
轴对称情况下，电场方程 
\begin_inset Formula $-\epsilon\nabla^{2}\Phi=\rho$
\end_inset

 在柱坐标系下可以写成：
\begin_inset Formula 
\[
-\frac{1}{r}\partial_{r}\left(\epsilon_{r}\,r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}
\]

\end_inset

将方程化简成如下形式
\begin_inset Formula 
\begin{equation}
-\partial_{r}\left(\epsilon_{r}r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}r\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}r\label{eq:xl2.5-1}
\end{equation}

\end_inset

如果作替换
\begin_inset Formula 
\begin{align*}
 & r\to x,\quad z\to y,\\
 & \epsilon_{r}r\to\tilde{\epsilon}(x),\quad\rho r\to\tilde{\rho}(x)
\end{align*}

\end_inset

则原方程可以写作
\begin_inset Formula 
\begin{equation}
-\partial_{x}\left[\tilde{\epsilon}(x)\,\partial_{x}\Phi\right]-\partial_{y}\left[\tilde{\epsilon}(x)\,\partial_{y}\Phi\right]=\tilde{\rho}(x)\label{eq:xl2.5}
\end{equation}

\end_inset

此方程的求解和二维情况完全相同，即它对应的泛函和通常的二维情况相同。
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\Phi\right)=\frac{1}{2}\int_{\Omega^{e}}\left(\nabla N_{i}^{e}\cdot\epsilon_{r}\cdot\nabla N_{j}^{e}\right)\Phi_{i}\Phi_{j}\dd{\Omega}-\int_{\Omega^{e}}\frac{\rho}{\epsilon_{0}}N_{i}^{e}\Phi_{i}\dd{\Omega}.
\]

\end_inset

对上式的泛函变分时，自由度是电势
\begin_inset Formula $\Phi_{i}$
\end_inset

，因此与 
\begin_inset Formula ${\color{blue}\epsilon}$
\end_inset

 是否依赖于空间坐标无关。仍然给出泊松方程
\begin_inset Formula 
\[
\nabla\cdot\epsilon_{r}\cdot\nabla\Phi=-\frac{\rho}{\epsilon_{0}}.
\]

\end_inset

只不过由于对称性，泛函的积分可以直接把 
\begin_inset Formula $\phi$
\end_inset

 积掉，给出 
\begin_inset Formula $2\pi$
\end_inset

 因子。
\end_layout

\begin_layout Standard
类似地，对于 Galerkin 方程，推导步骤也是相同的。只不过把其中的 
\begin_inset Formula $\epsilon$
\end_inset

，
\begin_inset Formula $\rho$
\end_inset

 替换成相应的波浪线版本。
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\tilde{\rho}\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset


\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\left(-\tilde{\epsilon}\right)\cdot\nabla\phi}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset


\end_layout

\begin_layout Remark
在 Simdroid 中，UI界面的对称轴是 
\begin_inset Formula $y$
\end_inset

 轴，不同于上述推导中的
\begin_inset Formula $z$
\end_inset

轴。但 
\begin_inset Formula $z$
\end_inset

 or 
\begin_inset Formula $y$
\end_inset

 只是一个标志，实际是什么无所谓。对于方程
\begin_inset Formula 
\[
-\frac{1}{r}\partial_{r}\left(\epsilon_{r}\,r\,\partial_{r}\Phi\right)-\partial_{z}\left(\epsilon_{r}\,\partial_{z}\Phi\right)=\frac{\rho}{\epsilon_{0}}
\]

\end_inset

重要的是 
\begin_inset Formula $r,z$
\end_inset

 坐标的相对次序，即
\begin_inset Formula $r$
\end_inset

 是坐标
\begin_inset Formula $1$
\end_inset

，
\begin_inset Formula $z$
\end_inset

 是坐标
\begin_inset Formula $2$
\end_inset

。在随后的符号重排
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，
\begin_inset Formula $\tilde{\epsilon}(r)=\epsilon_{r}\,r$
\end_inset

，
\begin_inset Formula $\tilde{\rho}(r)=\rho\,r$
\end_inset

，即
\begin_inset Formula $\tilde{\epsilon}$
\end_inset

，
\begin_inset Formula $\tilde{\rho}$
\end_inset

 是坐标
\begin_inset Formula $1$
\end_inset

 的函数。由于轴对称边值问题被转化为 
\begin_inset Formula $x,y$
\end_inset

 平面上的问题，只要在求解算法中保持坐标次序即可，即将 
\begin_inset Formula $x$
\end_inset

 乘到 
\begin_inset Formula $\epsilon,\rho$
\end_inset

 上。
\end_layout

\begin_layout Section
静电场的能量
\end_layout

\begin_layout Standard
目录:p18; Jackson p68/43; sec1.11
\end_layout

\begin_layout Standard
静电场能的两种表示方式：
\begin_inset Formula 
\begin{align}
 & W=\frac{1}{2}\int\rho(\sbf x)\Phi(\sbf x)\dd[3]{x},\quad W=\frac{1}{8\pi\epsilon_{0}}\sum_{i}\sum_{j}\frac{q_{i}q_{j}}{\abs{\sbf x_{i}-\sbf x_{j}}}\label{eq:j1.53}\\
 & W=\frac{\epsilon_{0}}{2}\int\abs{\sbf E}^{2}\dd[3]{x}.\label{eq:j1.54}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
第一行的公式分别是连续和离散情形。双求和忽略了 
\begin_inset Formula $i=j$
\end_inset

 的项，即“自能项”。
\end_layout

\begin_layout Enumerate
两种公式的物理图像分别为：电荷之间的相互作用能；电场中存储的能量。
\end_layout

\begin_layout Enumerate
电场的能量是正定的；相互作用能可能是负值。
\end_layout

\begin_layout Standard
考虑两个点电荷 
\begin_inset Formula $q_{1}$
\end_inset

，
\begin_inset Formula $q_{2}$
\end_inset

 组成的体系，空间一点
\begin_inset Formula $\sbf x$
\end_inset

处的电势和静电能分别为：
\begin_inset Formula 
\begin{align}
 & \sbf E=\frac{1}{4\pi\epsilon_{0}}\frac{q_{1}(\sbf x-\sbf x_{1})}{\abs{\sbf x-\sbf x_{1}}^{3}}+\frac{1}{4\pi\epsilon_{0}}\frac{q_{2}(\sbf x-\sbf x_{2})}{\abs{\sbf x-\sbf x_{2}}^{3}},\nonumber \\
 & 32\pi^{2}\epsilon_{0}w=\frac{q_{1}^{2}}{\abs{\sbf x-\sbf x_{1}}^{4}}+\frac{q_{2}^{2}}{\abs{\sbf x-\sbf x_{2}}^{4}}+2\frac{q_{1}q_{2}(\sbf x-\sbf x_{1})\cdot(\sbf x-\sbf x_{2})}{\abs{\sbf x-\sbf x_{1}}^{3}\abs{\sbf x-\sbf x_{2}}^{3}}.\label{eq:j1.56}
\end{align}

\end_inset

前两项是两个点电荷的自能，后一项是相互作用能。
\end_layout

\begin_layout Subsection
电容矩阵
\end_layout

\begin_layout Standard
FEM-Gerard; page 31/47; sec 1.3.8.8 
\end_layout

\begin_layout Standard
在含有 
\begin_inset Formula $n$
\end_inset

 个导体的系统中，第 
\begin_inset Formula $i$
\end_inset

 个导体上的电荷
\begin_inset Formula $Q_{i}$
\end_inset

 可以用所有导体上的电势
\begin_inset Formula $V_{j}$
\end_inset

，以及一些几何参数，共同表出：
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
Q_{i}=\sum_{j=1}^{n}C_{ij}V_{j},\quad i=1,2,\cdots,n\label{eq:j1.61}
\end{equation}

\end_inset

系数 
\begin_inset Formula $C_{ii}$
\end_inset

 被称为电容（capacities or capacitances），非对角元
\begin_inset Formula $C_{ij}$
\end_inset

被称为互感系数。
\end_layout

\begin_layout Enumerate
导体的电容，等于它带单位电势时的电荷，同时保持其他导体电势为零。
\end_layout

\begin_layout Enumerate
电容矩阵 
\begin_inset Formula $C_{ij}$
\end_inset

 是对称矩阵，表示两个导体间的电荷相互作用是对等的。
\end_layout

\begin_layout Enumerate
非对角元 
\begin_inset Formula $C_{ij}$
\end_inset

 对应两个导体间的互作用能量。
\begin_inset Formula 
\[
C_{ij}V_{i}V_{j}=\int_{\Omega}\sbf E_{i}\cdot\sbf D_{j}\dd{\Omega},\quad i,j\,\text{不求和}
\]

\end_inset


\end_layout

\begin_layout Standard
导体系统的 静电能 可以表示为
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\sum_{i=1}^{n}Q_{i}V_{i}=\frac{1}{2}\sum_{i=1}^{n}\sum_{j=1}^{n}C_{ij}V_{i}V_{j}.\label{eq:j1.62}
\end{equation}

\end_inset


\begin_inset Formula $C_{ii}V_{i}^{2}$
\end_inset

是正定的，对应电荷的“自能”（self energy）；
\begin_inset Formula $C_{ij}V_{i}V_{j}$
\end_inset

对应相互作用能 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j1.53"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Section
电介质中的静电能
\end_layout

\begin_layout Standard
p190; sec 4.7 
\end_layout

\begin_layout Standard
见 Sec1.11，自由空间电荷系统的能量为：
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\int\rho(\sbf x)\Phi(\sbf x)\dd[3]{x}.\label{eq:j4.83}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
存在电介质的情况下，静电能的微小变分为：
\begin_inset Formula 
\begin{equation}
\delta W=\int\delta\rho(\sbf x)\Phi(\sbf x)\dd[3]{x}.\label{eq:j4.84}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\Phi(\sbf x)$
\end_inset

 是由于已存在电荷密度 
\begin_inset Formula $\rho(\sbf x)$
\end_inset

产生的电势。考虑到 
\begin_inset Formula $\nabla\cdot\sbf D=\rho$
\end_inset

，我们可以作替换
\begin_inset Formula 
\begin{equation}
\delta\rho=\nabla\cdot(\delta\sbf D).\label{eq:j4.85}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
\nabla\cdot(\Phi\delta\sbf D) & =(\nabla\phi)\cdot\delta\sbf D+\Phi\nabla\cdot\delta\sbf D\\
 & =-\sbf E\cdot\delta\sbf D+\Phi\delta\rho
\end{align*}

\end_inset

如果电荷分布在有限空间内，则 
\begin_inset Formula $\nabla\cdot(\Phi\delta\sbf D)$
\end_inset

 在全空间的积分为零（应用高斯散度定理）。因此可以把静电能的变分写成：
\begin_inset Formula 
\begin{equation}
\delta W=\int\sbf E\cdot\delta\sbf D\dd[3]{x}.\label{eq:j4.86}
\end{equation}

\end_inset

因此当
\begin_inset Formula $\sbf D$
\end_inset

从初始值
\begin_inset Formula $0$
\end_inset

变化到最终值时，在形式上可以把静电能写成：
\begin_inset Formula 
\begin{equation}
W=\int\dd[3]x\int_{0}^{D}\sbf E\cdot\delta\sbf D.\label{eq:j4.87}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
如果介质是 
\emph on
线性的
\emph default
，则
\begin_inset Formula 
\begin{equation}
\sbf E\cdot\delta\sbf D=\frac{1}{2}\delta\left(\sbf E\cdot\sbf D\right).\label{eq:4.88}
\end{equation}

\end_inset

总能量可以写成
\begin_inset Formula 
\begin{equation}
W=\frac{1}{2}\int\sbf E\cdot\sbf D\dd[3]{x}.\label{eq:j4.89}
\end{equation}

\end_inset

如果假设 
\begin_inset Formula $\rho$
\end_inset

 和 
\begin_inset Formula $\Phi$
\end_inset

 是线性相关的，通过 
\begin_inset Formula $\sbf E=-\nabla\Phi$
\end_inset

 和 
\begin_inset Formula $\nabla\cdot\sbf D=\rho$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.89"
plural "false"
caps "false"
noprefix "false"

\end_inset

 可以回到
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.83"
plural "false"
caps "false"
noprefix "false"

\end_inset

或
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.84"
plural "false"
caps "false"
noprefix "false"

\end_inset

 。因此，
\emph on
只有当行为是线性的，
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.83"
plural "false"
caps "false"
noprefix "false"

\end_inset

在宏观上才成立。
\emph default
否则，只能使用
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:j4.87"
plural "false"
caps "false"
noprefix "false"

\end_inset

计算，最终的 静电能 依赖于极化历史。
\end_layout

\begin_layout Section
非线性材料的电容矩阵
\end_layout

\begin_layout Standard
\begin_inset Note Note
status collapsed

\begin_layout Plain Layout
g1 = Plot[x^(3/5), {x, 0, 5} , AxesLabel -> {"D", "E"} , ImageSize -> Small];
 g2 = Plot[Log[x + 1], {x, 0, 5} , AxesLabel -> {"Q", "U"} , ImageSize ->
 Small]; GraphicsRow[{g1, g2}]
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/capacitance-curve.pdf
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Formula $E-D$
\end_inset

曲线与
\begin_inset Formula $U-Q$
\end_inset

曲线，静电能的等价表示形式为
\begin_inset Formula $\delta w=E\delta D$
\end_inset

，
\begin_inset Formula $\delta w=U\delta Q$
\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
follow XuLei，两张图中，曲线上的点是一一对应的，根据对应关系有：
\begin_inset Formula 
\begin{align*}
\frac{1}{2}\delta\sbf E\cdot\delta\sbf D & =\frac{1}{2}\delta U\delta fQ\\
 & =\frac{1}{2}\delta U\;C\delta U
\end{align*}

\end_inset

假设由边值问题
\begin_inset Formula $\alpha$
\end_inset

，求解出了电场结果 
\begin_inset Formula $\beta$
\end_inset

。在确定的几何点
\begin_inset Formula $P$
\end_inset

，和电场 
\begin_inset Formula $\sbf E$
\end_inset

 下，
\begin_inset Formula $\epsilon=\partial D/\partial E$
\end_inset

，
\begin_inset Formula $C=\partial Q/\partial U$
\end_inset

 都是确定的。这时候作完全线性化，完全按照线性系统处理，取 
\begin_inset Formula $\delta U=\SI{1}{V}$
\end_inset

，给出
\begin_inset Formula 
\[
C=\delta\sbf E\cdot\delta\sbf D.
\]

\end_inset

这个式子的含义是：
\end_layout

\begin_layout Enumerate
体系此时的电容，可以由 
\begin_inset Formula $\delta U=\SI{1}{V}$
\end_inset

 条件定出的电场得到；
\end_layout

\begin_layout Enumerate
在使用 Galerkin 方程计算过程中，认定 
\begin_inset Formula $\epsilon=\partial D/\partial E$
\end_inset

 为常数，
\begin_inset Formula $\epsilon$
\end_inset

 的每一几何点的具体值，由之前边值问题的解 
\begin_inset Formula $\beta$
\end_inset

 提供；材料性质的影响体现在此处。
\end_layout

\begin_layout Enumerate
而 
\begin_inset Formula $\sbf D$
\end_inset

与 
\begin_inset Formula $\sbf E$
\end_inset

 的关系，由材料在当前 
\begin_inset Formula $\sbf E$
\end_inset

 下的电介质数 
\begin_inset Formula $\epsilon$
\end_inset

 决定。非线性材料的 电介质数 
\begin_inset Formula $\epsilon$
\end_inset

 与 
\begin_inset Formula $\sbf E$
\end_inset

 的关系可能比较复杂，但在当前一点可以当成常数。
\end_layout

\begin_layout Enumerate
并且对于多导体系统，还类似地定义电容矩阵：
\begin_inset Formula 
\[
C_{ij}=\frac{1}{\delta U_{i}\delta U_{j}}\int_{\Omega}\sbf D_{i}\cdot\sbf E_{j}\dd{\Omega},
\]

\end_inset

积分区域是全系统空间，实际上还取了 
\begin_inset Formula $\delta U_{i}=\delta U_{j}=\SI{1}{V}$
\end_inset

。
\end_layout

\begin_layout Remark
体系的电容 
\begin_inset Formula $C$
\end_inset

 与体系的几何构型，以及材料的电介质数 
\begin_inset Formula $\epsilon$
\end_inset

 相关。以上方法实际上就是：
\color blue
在点的局域上，把 非线性材料 权当成 线性材料 处理
\color inherit
。线性材料的互容矩阵实际上就是
\begin_inset Formula 
\[
C_{ij}=\frac{1}{U_{i}U_{j}}\int_{\Omega}\sbf D_{i}\cdot\sbf E_{j}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Section
虚功法
\end_layout

\begin_layout Standard
FEM-Gerard; sec 38/54;
\end_layout

\begin_layout Standard
刚体上的力和力矩（torque）也可以使用虚功原理（virtual work theorem）计算。在微小位移
\begin_inset Formula $\delta u$
\end_inset

下，装置的内能（internal energy）的变化 
\begin_inset Formula $\delta W_{e}$
\end_inset

，等于 外源（external sources）输入的电能，加上力 
\begin_inset Formula $-F_{u}$
\end_inset

（牛顿第三定律）的功：
\begin_inset Formula 
\begin{equation}
\delta W_{e}=\sum V_{k}\delta Q_{k}-F_{u}\delta u=\sum\frac{\partial W_{e}}{\partial Q_{k}}\delta Q_{k}+\frac{\partial W_{e}}{\partial u}\delta u.\label{eq:g1.117}
\end{equation}

\end_inset


\end_layout

\begin_layout Example
在实验一中，装置与外界电源隔离。电极上的电荷总量不变，即 
\begin_inset Formula $\delta Q_{k}=0$
\end_inset

，因此给出
\begin_inset Formula 
\begin{align}
 & F_{u}=-\frac{\partial W_{e}}{\partial u}.\label{eq:g1.118}\\
 & C_{\omega}=-\frac{\partial W_{e}}{\partial\theta}.\label{eq:g1.119}
\end{align}

\end_inset

其中 
\begin_inset Formula $C_{\omega}$
\end_inset

 表示绕旋转轴 
\begin_inset Formula $\omega$
\end_inset

 的力矩。求偏导时，保持 electric state variable（电极上的电荷）不变。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
在实验二中，把装置连接到 恒压源，电极上的电势 
\begin_inset Formula $V_{k}$
\end_inset

 保持不变，而电极上的电荷可能会变化 
\begin_inset Formula $\delta Q_{k}$
\end_inset

。现在，更适合用系统的共能（coenergy）去分析。
\begin_inset Formula 
\begin{align}
 & \sum V_{k}\delta Q_{k}-\sum\delta\left(V_{k}Q_{k}\right)-F_{u}\delta u=\delta W_{e}-\sum\delta\left(V_{k}Q_{k}\right).\label{eq:g1.120}\\
\Rightarrow & -\sum Q_{k}\delta V_{k}-F_{u}\delta u=-\delta W_{c}=-\sum\frac{\partial W_{c}}{\partial V_{k}}\delta V_{k}-\frac{\partial W_{c}}{\partial u}\delta u.\label{eq:g1.121}
\end{align}

\end_inset

现在，力和力矩可以用 共能 的偏导表示，
\begin_inset Formula 
\begin{align}
 & F_{u}=\frac{\partial W_{c}}{\partial u},\label{eq:g1.122}\\
 & C_{\omega}=\frac{\partial W_{c}}{\partial\theta}.\label{eq:g1.123}
\end{align}

\end_inset

求偏导时保持 electric state variable（电极上的电压）不变。
\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
page 20/36;
\end_layout

\begin_layout Plain Layout
\begin_inset Formula 
\begin{equation}
\frac{\partial W_{c}}{\partial v_{i}}=-\iint D\cdot\mathrm{grad}\varphi_{i}h\dd{x}\dd{y}-\iint\rho\varphi_{i}h\dd{x}\dd{y}=0\quad\text{for}\quad i=1,2,\cdots,N_{L}\label{eq:g1.52-1}
\end{equation}

\end_inset


\begin_inset Formula $v_{i}$
\end_inset

 表示节点上的值，一共有 
\begin_inset Formula $N_{L}$
\end_inset

个。
\end_layout

\begin_layout Plain Layout
page 14/30;
\begin_inset Formula 
\begin{equation}
W_{c}=\iint\left[\int_{0}^{-\nabla v}D\dd{E}-\rho v\right]h\dd{x}\dd{y}\label{eq:g1.35-1}
\end{equation}

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Example
当电极上的电势保持常数时，coenergy 的有限元近似只是位移 
\begin_inset Formula $u$
\end_inset

 的函数，或者通过 
\color blue
节点的坐标直接依赖
\color inherit
，或者通过 
\color brown
节点电势间接依赖
\color inherit
：
\begin_inset Formula 
\begin{equation}
W_{c}=W_{c}\left[{\color{brown}v_{1}(u),v_{2}(u),\cdots,v_{N_{L}}(u)},{\color{blue}u}\right]=W_{c}(u).\label{eq:g1.126}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{equation}
F_{u}=\frac{\dd{W_{c}}}{\dd{u}}=\sum_{j=1}^{N_{L}}\frac{\partial W_{c}}{\partial v_{j}}\frac{\dd{v_{j}}}{\dd{u}}+\frac{\partial W_{c}}{\partial u}.\label{eq:g1.127}
\end{equation}

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g1.52-1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，共能对 节点电势的偏导为零，因此
\begin_inset Formula 
\begin{equation}
F_{u}=\frac{\partial W_{c}}{\partial u}.\label{eq:g1.128}
\end{equation}

\end_inset

求偏导时保持 节点电势不变。
\end_layout

\begin_layout Example
\begin_inset Float figure
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename inset/Gerard-1.11.png
	lyxscale 50
	scale 50

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Virtual deformation of the meshing。浅灰色的是弹性单元。白色的是刚体单元。空心节点表示能够运动。
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Chapter
静磁场
\end_layout

\begin_layout Section
磁场的基本理论
\end_layout

\begin_layout Standard
根据 
\begin_inset Formula $\sbf B$
\end_inset

 和 
\begin_inset Formula $\sbf H$
\end_inset

 的本构关系 
\begin_inset Formula $\sbf B(\sbf H)$
\end_inset

，可以分线性材料，永磁体 和 非线性材料 三种来计算静磁场。
\end_layout

\begin_layout Standard
下面先以最简单的线性材料为例，用有限元方法来计算静磁场，之后再讨论永磁铁和更复杂的非线性情况。首先磁场强度矢量 
\begin_inset Formula $\sbf H$
\end_inset

 满足方程
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf H=\sbf J\label{eq:xl3.1}
\end{equation}

\end_inset

在线性介质中，磁感应强度 
\begin_inset Formula $\sbf B$
\end_inset

 和 磁场强度 
\begin_inset Formula $\sbf H$
\end_inset

 之间的关系为：
\begin_inset Formula 
\[
\sbf H=\frac{1}{\mu_{0}\mu_{r}}\sbf B
\]

\end_inset

相对磁导率 
\begin_inset Formula $\mu_{r}$
\end_inset

 是不随磁场变化的常数（但可以随空间坐标变化）。由于 
\begin_inset Formula $\nabla\cdot\sbf B=0$
\end_inset

，因此磁感应强度可以用矢势 
\begin_inset Formula $\sbf A$
\end_inset

 表示为
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A
\]

\end_inset

根据
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.1"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以得到 
\begin_inset Formula $\sbf A$
\end_inset

 满足的方程
\begin_inset Formula 
\begin{equation}
\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J\label{eq:xl3.2}
\end{equation}

\end_inset


\end_layout

\begin_layout Theorem
\begin_inset Argument 1
status open

\begin_layout Plain Layout
毕奥–萨伐尔定律
\end_layout

\end_inset

ref:郭硕鸿 p77/91，若取 
\begin_inset Formula $\sbf A$
\end_inset

满足规范条件 
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

，得矢势
\begin_inset Formula $\sbf A$
\end_inset

的微分方程：
\begin_inset Formula 
\begin{equation}
\nabla^{2}\sbf A=-\mu\sbf J\label{eq:g3.1.8}
\end{equation}

\end_inset

矢势方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的特解： 
\begin_inset Formula 
\begin{equation}
\sbf A(\sbf x)=\frac{\mu}{4\pi}\int_{V}\frac{\sbf J(\sbf x')\dd{V'}}{r}\label{eq:g3.1.9}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\sbf x'$
\end_inset

 是源点，
\begin_inset Formula $\sbf x$
\end_inset

 是长点，
\begin_inset Formula $r$
\end_inset

 为由 
\begin_inset Formula $\sbf x'$
\end_inset

 到 
\begin_inset Formula $\sbf x$
\end_inset

的距离。
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

 满足 
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

。取旋度可求出
\begin_inset Formula $\sbf B$
\end_inset

：
\begin_inset Formula 
\begin{align*}
\sbf B & =\nabla\times\sbf A=\frac{\mu}{4\pi}\nabla\times\int_{V}\frac{\sbf J(\sbf x')\dd{V}}{r}\\
 & =\frac{\mu}{4\pi}\int_{V}(\nabla\frac{1}{r})\times\sbf J(\sbf x')\dd{V'}\\
 & =\frac{\mu}{4\pi}\int_{V}\frac{\sbf J\times\sbf r}{r^{3}}\dd{V'}
\end{align*}

\end_inset

过渡到线电流情形，设
\begin_inset Formula $I$
\end_inset

 为导线上电流的大小，作代换 
\begin_inset Formula $\sbf J\dd{V'}\to I\dd{\sbf l}$
\end_inset

得
\begin_inset Formula 
\begin{equation}
\sbf B=\frac{\mu}{4\pi}\oint_{L}\frac{I\dd{\sbf l}\times\sbf r}{r^{3}}\label{eq:g3.1.11}
\end{equation}

\end_inset

这就是 毕奥–萨伐尔 定律。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Remark
柱坐标下的旋度：
\begin_inset Formula 
\[
\nabla\times\sbf A=\left(\frac{1}{r}\partial_{\phi}A_{z}-\partial_{z}A_{\phi}\right)\sbf e_{r}+\left(\partial_{z}A_{r}-\partial_{r}A_{z}\right)\sbf e_{\phi}+\left[\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)-\frac{1}{r}\partial_{\phi}A_{r}\right]\sbf e_{z}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status open

\begin_layout Plain Layout
磁矢势的泛函
\end_layout

\end_inset

与
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=\mu_{0}\sbf J$
\end_inset

 对应的泛函积分为
\begin_inset Formula 
\begin{equation}
\mathcal{F}(\sbf A)=\int_{\Omega}\dd{\Omega}\left[\frac{1}{\mu_{r}}\frac{1}{2}\left(\nabla\times\sbf A\right)\cdot\left(\nabla\times\sbf A\right)-\mu_{0}\,\sbf J\cdot\sbf A\right]\label{eq:xl3.3}
\end{equation}

\end_inset

计算 
\begin_inset Formula $\mathcal{F}(\sbf A)$
\end_inset

 的变分得：
\begin_inset Formula 
\[
\mathcal{F}(\sbf A)=\int_{\Omega}\dd{\Omega}\left[\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\cdot\left(\nabla\times\delta\sbf A\right)-\mu_{0}\,\sbf J\cdot\delta\sbf A\right]
\]

\end_inset

根据公式 
\begin_inset Formula $\nabla\cdot(\sbf a\times\sbf b)=\sbf b\cdot(\nabla\times\sbf a)-\sbf a\cdot(\nabla\times\sbf b)$
\end_inset

， 并使用高斯定理可以得到
\begin_inset Formula 
\begin{align*}
\delta\mathcal{F}(\sbf A) & =\int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\dd{\Omega}+\int_{\Gamma}\sbf e_{n}\cdot\left[\delta\sbf A\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\right]\dd{\Gamma}\\
 & =\int_{\Omega}\delta\sbf A\cdot\left[\nabla\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)-\mu_{0}\sbf J\right]\dd{\Omega}-\int_{\Gamma}\delta\sbf A\cdot\left[\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)\right]\dd{\Gamma}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
第一项可以给出矢势 
\begin_inset Formula $\sbf A$
\end_inset

 满足的方程，即
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.2"
plural "false"
caps "false"
noprefix "false"

\end_inset

。第二项给出矢势
\begin_inset Formula $\sbf A$
\end_inset

的自然边界条件：
\begin_inset Formula 
\[
\sbf e_{n}\times\frac{1}{\mu_{r}}\left(\nabla\times\sbf A\right)=0
\]

\end_inset

将计算的区域 
\begin_inset Formula $\Omega$
\end_inset

 划分有限单元后，
\begin_inset Formula $\mathcal{F}(\sbf A)$
\end_inset

 可以表示为
\begin_inset Formula 
\[
\mathcal{F}(\sbf A)=\sum_{e}\mathcal{F}^{e}(\sbf A)
\]

\end_inset

其中
\begin_inset Formula 
\begin{equation}
\mathcal{F}^{e}(\sbf A^{e})=\frac{1}{2}\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf A^{e}\right)\cdot\left(\nabla\times\sbf A^{e}\right)\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf A^{e}\dd{\Omega}\label{eq:xl3.5}
\end{equation}

\end_inset

对于磁场，二维，轴对称和 三维问题 所采用的单元略有不同。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status open

\begin_layout Plain Layout
二维情况
\end_layout

\end_inset

 电流是垂直二维平面流过的，
\begin_inset Formula $\sbf A$
\end_inset

 也只有垂直二维平面的分量。即 
\begin_inset Formula $\sbf J=J_{z}\sbf e_{z}$
\end_inset

，有限元中的矢势可以用形函数和节点上定义的 
\begin_inset Formula $A_{z,i}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(x,y)=\sum_{i=1}^{n_{e}}N_{i}^{e}(x,y)A_{z,i}\sbf e_{z},
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status open

\begin_layout Plain Layout
轴对称情况
\end_layout

\end_inset

 然后是磁感应强度 
\begin_inset Formula $\sbf B$
\end_inset

 轴对称情况，从毕奥–萨伐尔定律
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.11"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\sbf B=\frac{\mu}{4\pi}\oint_{L}\frac{I\dd{\sbf l}\times\sbf r}{r^{3}}
\]

\end_inset

取对称轴为柱坐标系下的 
\begin_inset Formula $\sbf e_{z}$
\end_inset

 坐标轴，如果电流
\begin_inset Formula $I\dd{l}$
\end_inset

只沿着
\begin_inset Formula $\sbf e_{\phi}$
\end_inset

方向，则
\begin_inset Formula $\sbf B$
\end_inset

将没有 
\begin_inset Formula $\sbf e_{\phi}$
\end_inset

方向的分量，并且其他方向分量也不依赖于 
\begin_inset Formula $\phi$
\end_inset

 坐标。因此令电流 
\begin_inset Formula $\sbf J=J_{\varphi}\sbf e_{\varphi}$
\end_inset

，对应地由
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.1.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

，
\begin_inset Formula $\sbf A=A_{\varphi}\sbf e_{\varphi}$
\end_inset

。有限元中的矢势可以用形函数 和节点上定义的 
\begin_inset Formula $A_{\varphi,i}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(\rho,z)=\sum_{\alpha=1}^{n_{e}}N_{\alpha}^{e}(\rho,z)A_{\varphi,\alpha}\sbf e_{\varphi}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
\begin_inset Argument 1
status open

\begin_layout Plain Layout
三维磁场
\end_layout

\end_inset

 对于三维磁场问题，采用的是棱边单元，相应的形函数是矢量。有限元中的矢势可以用形函数和棱边上定义的 
\begin_inset Formula $A_{\alpha}$
\end_inset

 表示为：
\begin_inset Formula 
\[
\sbf A^{e}(x,y,z)=\sum_{\alpha=1}^{n_{e}}\sbf N_{\alpha}^{e}(x,y,z)A_{\alpha}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
有限元矩阵
\end_layout

\begin_layout Standard
对于任一种情况，单元内的矢量势均可以统一表示为一种形式，即
\begin_inset Formula 
\begin{equation}
\sbf A^{e}=\sum_{\alpha=1}^{n_{e}}\sbf N_{\alpha}^{e}A_{\alpha}\label{eq:xl3.6}
\end{equation}

\end_inset

例如二维情况下，
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(x,y)\sbf e_{z}$
\end_inset

，
\begin_inset Formula $A_{\alpha}=A_{z,\alpha}$
\end_inset

；轴对称情况下 
\begin_inset Formula $\sbf N_{\alpha}^{e}=N_{\alpha}^{e}(\rho,z)\sbf e_{\varphi}$
\end_inset

，
\begin_inset Formula $A_{\alpha}=A_{\varphi,\alpha}$
\end_inset

。然后将 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

，代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.5"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到
\begin_inset Formula 
\[
\mathcal{F}^{e}(\sbf A^{e})=\frac{1}{2}\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}A_{\alpha}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}A_{\beta}\right)\dd{\Omega}-\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}A_{\alpha}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Standard
计算 
\begin_inset Formula $\mathcal{F}^{e}(\sbf A^{e})$
\end_inset

 对 
\begin_inset Formula $A_{\alpha}$
\end_inset

 的导数，并根据 
\begin_inset Formula $\delta\mathcal{F}(\sbf A)=0$
\end_inset

，可以得到
\begin_inset Formula $A_{i}$
\end_inset

所满足的矩阵方程
\begin_inset Formula 
\begin{equation}
\sum_{e=1}^{M}[K_{\alpha\beta}^{e}]\{A_{\beta}\}=\sum_{e=1}^{M}\{b_{\alpha}^{e}\}\label{eq:xl3.7}
\end{equation}

\end_inset

其中
\begin_inset Formula 
\begin{align}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\beta}^{e}\right)\dd{\Omega}\label{eq:xl3.8}\\
b_{\alpha}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}\dd{\Omega}\label{eq:xl3.9}
\end{align}

\end_inset


\end_layout

\begin_layout Section
二维静磁场
\end_layout

\begin_layout Standard
二维静磁问题中的电流是垂直二维平面流过的，
\begin_inset Formula $\sbf A$
\end_inset

只有垂直二维平面的分量。即 
\begin_inset Formula $\sbf J=J_{z}\sbf e_{z}$
\end_inset

，
\begin_inset Formula $\sbf N_{i}^{e}=N_{i}^{e}\left(x,y\right)\sbf e_{z}$
\end_inset

，将其代入式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.9"
plural "false"
caps "false"
noprefix "false"

\end_inset

，可以得到
\begin_inset Formula 
\begin{align*}
 & K_{\alpha\beta}^{e}=\frac{1}{\mu_{r}}\int_{\Omega^{e}}\left(\frac{\partial N_{\alpha}^{e}}{\partial x}\frac{\partial N_{\beta}^{e}}{\partial x}+\frac{\partial N_{\alpha}^{e}}{\partial y}\frac{\partial N_{\beta}^{e}}{\partial y}\right)\dd{\Omega}\\
 & b_{\alpha}^{e}=\mu_{0}\int_{\Omega^{e}}J_{z}N_{\alpha}^{e}\dd{\Omega}
\end{align*}

\end_inset

二维静磁场方程的形式和二维静电场方程的形式一样。
\end_layout

\begin_layout Section
轴对称静磁场
\end_layout

\begin_layout Standard
如果所研究的问题具有旋转对称性，可以沿着对称轴取一个截面在柱坐标下求解相应的电磁方程，即 
\begin_inset Formula $r,z$
\end_inset

 平面。轴对称情况下，矢势在柱坐标下只有
\begin_inset Formula $A_{\varphi}$
\end_inset

分量，相应的磁场可以用矢势表示为
\begin_inset Formula 
\[
\sbf B=\nabla\times\sbf A=-\partial_{z}f_{\phi}\sbf e_{r}+\frac{1}{r}\partial_{r}\left(rf_{\phi}\right)\sbf e_{z}
\]

\end_inset

如上所述，磁感应
\begin_inset Formula $\sbf B$
\end_inset

分布在
\begin_inset Formula $r,z$
\end_inset

平面。
\end_layout

\begin_layout Remark
柱坐标下的旋度表示
\begin_inset Formula 
\begin{equation}
\nabla\times\sbf A=\left(\frac{1}{r}\partial_{\phi}A_{z}-\partial_{z}A_{\phi}\right)\sbf e_{r}+\left(\partial_{z}A_{r}-\partial_{r}A_{z}\right)\sbf e_{\phi}+\left[\frac{1}{r}\partial_{r}\left(rA_{\phi}\right)-\frac{1}{r}\partial_{\phi}A_{r}\right]\sbf e_{z}\label{eq:curl-cylin}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Standard
另外需要注意的是，虽然在截面上划分的单元和二维情况下的划分完全一样。但实际上处理的有限元单元并不是一个平面单元，而是平面单元沿对称轴旋转 
\begin_inset Formula $360$
\end_inset

 度所形成的圆环，如图 3.1所示。
\end_layout

\begin_layout Standard
\begin_inset Float figure
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
f
\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
轴对称单元对网格剖分的对应关系
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
在某个单元上的有限元泛函为（为了后续处理方便，
\begin_inset Formula $\mathcal{F}^{e}$
\end_inset

的表达式右边乘了系数
\begin_inset Formula $1/2\pi$
\end_inset

）
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\sbf A^{e}\right)=\frac{1}{2\pi}\int_{\Omega^{e}}\dd{\Omega}\left[\frac{1}{2}\frac{1}{\mu_{r}}\left(\nabla\times\sbf A^{e}\right)\cdot\left(\nabla\times\sbf A^{e}\right)-\mu_{0}\,\sbf J\cdot\sbf A^{e}\right]
\]

\end_inset

其中
\begin_inset Formula $\dd{\Omega}=r\dd{r}\dd{z}\dd{\varphi}$
\end_inset

，关于 
\begin_inset Formula $\varphi$
\end_inset

 的积分给出
\begin_inset Formula $2\pi$
\end_inset

因子，与前面的系数
\begin_inset Formula $1/2\pi$
\end_inset

 互相抵消。将 
\begin_inset Formula $\sbf A^{e}=N_{i}^{e}A_{i}\sbf e_{\varphi}$
\end_inset

，电流 
\begin_inset Formula $\sbf J=J_{\varphi}\sbf e_{\varphi}$
\end_inset

代入，
\begin_inset Formula 
\[
\mathcal{F}^{e}\left(\sbf A^{e}\right)=\sum_{i,j}^{n_{e}}\int_{\Omega^{e}}\dd{r}\dd{z}\left[\frac{1}{2}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}A_{\alpha}\right)\cdot\left(\nabla\times\sbf N_{\beta}^{e}A_{\beta}\right)-\mu_{0}\,\sbf J\cdot\sbf N_{\gamma}^{e}A_{\gamma}\right]
\]

\end_inset

轴对称情况下，形函数 
\begin_inset Formula $\sbf N_{i}^{e}=N_{i}^{e}(\rho,z)\sbf e_{\varphi}$
\end_inset

，计算可以得到
\begin_inset Formula 
\[
\nabla\times\sbf N_{i}^{e}=-\partial_{z}N_{i}^{e}\sbf e_{r}+\frac{1}{r}\partial_{r}(rN_{i}^{e})\sbf e_{z}
\]

\end_inset

相应的 
\begin_inset Formula $K_{ij}^{e}$
\end_inset

 矩阵和列向量 
\begin_inset Formula $b_{i}^{e}$
\end_inset

 可以分别表示为
\begin_inset Formula 
\begin{align*}
 & K_{\alpha\beta}^{e}=\int_{\Gamma^{e}}\frac{r}{\mu_{r}}\left[\partial_{z}N_{\alpha}^{e}\,\partial_{z}N_{\beta}^{e}+\left(\frac{N_{\alpha}^{e}}{r}+\partial_{r}N_{\alpha}^{e}\right)\left(\frac{N_{\beta}^{e}}{r}+\partial_{r}N_{\beta}^{e}\right)\right]\dd{r}\dd{z}\\
 & b_{\alpha}^{e}=\mu_{0}J_{\varphi}\int_{\Gamma^{e}}N_{\alpha}^{e}r\,\dd{r}\dd{z}.
\end{align*}

\end_inset

柱坐标下的旋度见
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:curl-cylin"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Subsection
三维磁场和树–余树规范
\end_layout

\begin_layout Standard
三维情况下的形函数有三个分量，可以取
\begin_inset Formula 
\begin{align*}
\sbf N_{\alpha}^{e} & =\left(L_{\alpha_{1}}^{e}\nabla L_{\alpha_{2}}^{e}-L_{\alpha_{2}}^{e}\nabla L_{\alpha_{1}}^{e}\right)\ell_{\alpha}^{e}\\
\nabla\times\sbf N_{\alpha}^{e} & =2\left(\nabla L_{\alpha_{1}}^{e}\times\nabla L_{\alpha_{2}}^{e}\right)\ell_{\alpha}^{e}
\end{align*}

\end_inset

因此
\begin_inset Formula 
\begin{align*}
K_{\alpha\beta}^{e} & =\int_{\Omega^{e}}\frac{1}{\mu_{r}}\left(\nabla\times\sbf N_{\alpha}^{e}\right)\cdot\left(\nabla\times\sbf N_{\beta}^{e}\right)\dd{\Omega}\\
b_{\alpha}^{e} & =\mu_{0}\int_{\Omega^{e}}\sbf J\cdot\sbf N_{\alpha}^{e}\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
由于采用棱边单元定义的矩阵 
\begin_inset Formula $[K_{\alpha\beta}^{e}]$
\end_inset

 是奇异矩阵，即 
\begin_inset Formula $\det[K_{\alpha\beta}^{e}]=0$
\end_inset

。因此矩阵方程 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl3.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\sum_{e=1}^{M}[K_{\alpha\beta}^{e}]\{A_{\beta}\}=\sum_{e=1}^{M}\{b_{\alpha}^{e}\}$
\end_inset

 有无穷多解。采用棱边单元定义的矢势
\begin_inset Formula $\sbf A$
\end_inset

 在每个单元内部是满足库仑规范的 （
\begin_inset Formula $\nabla\cdot\sbf A=0$
\end_inset

）。但是在单元的边界，库仑规范不满足，导致 矢势
\begin_inset Formula $\sbf A$
\end_inset

有无穷解。为了保证方程解的唯一性，即得到库仑规范下 
\begin_inset Formula $\sbf A$
\end_inset

的解，需要对 
\begin_inset Formula $\sbf A$
\end_inset

做一些拘束。取一个不闭合的任意矢量场
\begin_inset Formula $\sbf w$
\end_inset

，使得
\begin_inset Formula 
\[
\sbf A\cdot\sbf w=0,
\]

\end_inset

可以证明
\end_layout

\begin_layout Chapter
有限元下计算电磁力
\end_layout

\begin_layout Section
Levi–Civita 符号
\end_layout

\begin_layout Standard
ref：
\begin_inset CommandInset href
LatexCommand href
name "Levi-Civita符号"
target "https://www.zhihu.com/question/445700749"
literal "false"

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $\varepsilon^{123}=1$
\end_inset

，上标相同则为零，交换两个指标出负号。有等式：
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{def}=\left[\begin{array}{ccc}
\delta^{ad} & \delta^{ae} & \delta^{af}\\
\delta^{bd} & \delta^{be} & \delta^{bf}\\
\delta^{cd} & \delta^{ce} & \delta^{cf}
\end{array}\right]
\]

\end_inset


\end_layout

\begin_layout Enumerate
特殊情况一：单个指标求和，
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{aef}=\left[\begin{array}{ccc}
1 & 0 & 0\\
0 & \delta^{be} & \delta^{bf}\\
0 & \delta^{ce} & \delta^{cf}
\end{array}\right]=\left[\begin{array}{cc}
\delta^{be} & \delta^{bf}\\
\delta^{ce} & \delta^{cf}
\end{array}\right]=\delta^{be}\delta^{cf}-\delta^{bf}\delta^{ce}
\]

\end_inset


\end_layout

\begin_layout Enumerate
特殊情况二：双指标求和，
\begin_inset Formula 
\[
\varepsilon^{abc}\varepsilon^{dbc}=\left[\begin{array}{ccc}
\delta^{ad} & 0 & 0\\
0 & 1 & 0\\
0 & 0 & 1
\end{array}\right]=\delta^{ad}
\]

\end_inset


\end_layout

\begin_layout Section
虚功法计算磁力
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:virtualforce"

\end_inset


\end_layout

\begin_layout Standard
假设导线中的电流从 
\begin_inset Formula $0$
\end_inset

 开始，在时间
\begin_inset Formula $t$
\end_inset

的时候达到 
\begin_inset Formula $I$
\end_inset

。那么在这个过程中，导线中存储的此能为：
\begin_inset Formula 
\begin{equation}
\mathcal{U}=-\int_{0}^{t}\mathcal{E}I\dd{t'}=-\int_{0}^{t}\frac{\dd{\Psi}}{\dd{t'}}I\dd{t'}=\int_{0}^{\Psi}I\dd{\Psi}.\label{eq:x6.1}
\end{equation}

\end_inset


\begin_inset Formula $\mathcal{E}$
\end_inset

螺旋与磁通成右手螺旋。
\end_layout

\begin_layout Standard
此外通过场源关系，磁能也可以表示成：
\begin_inset Formula 
\[
\mathcal{U}=\int_{\Omega}\left[\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right]\dd{\Omega}
\]

\end_inset

是用与线性和非线性情况，不包括永磁体材料。
\end_layout

\begin_layout Standard
根据磁能还可以定义 磁共能（coenergy）：
\begin_inset Formula 
\[
\mathcal{U}_{\text{co}}=I\Psi-\mathcal{U}=\int_{0}^{I}\Psi\dd{I'}
\]

\end_inset

在坐标平面上，具有明显的几何意义；
\begin_inset Formula $\mathcal{U}$
\end_inset

 和 
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

 分别对应 
\begin_inset Formula $I$
\end_inset

–
\begin_inset Formula $\Psi$
\end_inset

 曲线两侧的面积。
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

 同样可以用场表示成
\begin_inset Formula 
\[
\mathcal{U}_{\text{co}}=\int_{\Omega}\sbf H\cdot\sbf B\dd{\Omega}-\mathcal{U}=\int_{\Omega}\left(\int_{0}^{H}\sbf B\cdot\dd{\sbf H'}\right)\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Standard
根据使用 磁能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 还是 磁共能 
\begin_inset Formula $\mathcal{U}_{\text{co}}$
\end_inset

的计算思路，还有取 
\begin_inset Formula $\Psi$
\end_inset

 或 
\begin_inset Formula $I$
\end_inset

 作为 
\begin_inset Formula $x$
\end_inset

 之外的独立变量，可以得到磁力的四种表达式：
\begin_inset Formula 
\begin{align*}
F & =-\frac{\partial\mathcal{U}\left(\Psi,x\right)}{\partial x}\\
 & =-\frac{\partial\mathcal{U}\left(I,x\right)}{\partial x}+I\frac{\partial\Psi\left(I,x\right)}{\partial x}\\
 & =\frac{\partial\mathcal{U}_{\text{co}}\left(\Psi,x\right)}{\partial x}-\Psi\frac{\partial I\left(\Psi,x\right)}{\partial x}\\
 & =\frac{\partial\mathcal{U}_{\text{co}}\left(I,x\right)}{\partial x}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
磁能的磁场表示形式：
\begin_inset Formula 
\begin{align}
\mathcal{U} & =\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\dd{\Omega},\nonumber \\
\mathcal{U}_{\text{co}} & =\sum_{e}\int_{\Omega^{e}}\left[\sbf H\cdot\sbf B-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right]\dd{\Omega}.\label{eq:fem-uco}
\end{align}

\end_inset


\end_layout

\begin_layout Section
计算磁力
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "sec:calc-magforce"

\end_inset


\end_layout

\begin_layout Standard
本节中的计算 与 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:virtualforce"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的理论不尽相同；在这里把 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 当成唯一的独立变量，计算电能的变分。
\end_layout

\begin_layout Standard
在有限元框架下，通过场的形式，将磁能表示成：
\begin_inset Formula 
\begin{align}
\mathcal{U} & =\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\dd{\Omega},\label{eq:fem-energy}
\end{align}

\end_inset

节点 
\begin_inset Formula $\alpha$
\end_inset

 上的磁力，表示成 磁能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 对节点 
\begin_inset Formula $\alpha$
\end_inset

 的坐标的偏导数：
\begin_inset Formula 
\[
\sbf F_{\alpha}=-\frac{\partial\mathcal{U}}{\partial\sbf r_{\alpha}}
\]

\end_inset

考虑到积分测度 
\begin_inset Formula $\dd{\Omega}=\dd{x}\dd{y}\dd{z}=\det[J]\dd{\xi}\dd{\eta}\dd{\zeta}$
\end_inset

，记 
\begin_inset Formula $\dd{\hat{\Omega}}=\dd{\xi}\dd{\eta}\dd{\zeta}$
\end_inset

，则根据磁共能式
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:fem-uco"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\frac{\partial\det[J]}{\partial\sbf r_{\alpha}}-\left(\sbf H\cdot\frac{\partial\sbf B}{\partial\sbf r_{\alpha}}\right)\det[J]\right]\dd{\hat{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Remark
这里的变分理解为：
\end_layout

\begin_layout Enumerate
一方面节点坐标的改变，会影响到积分测度；
\end_layout

\begin_layout Enumerate
另一方面，会影响到空间场 
\begin_inset Formula $\sbf B$
\end_inset

 的分布；这里还是用了积分下求导的公式：
\begin_inset Formula 
\[
\frac{\dd}{\dd{x}}\int_{0}^{f\left(x\right)}g\left(x'\right)\dd{x'}=f'(x)g\left[f(x)\right]
\]

\end_inset

在这里就是
\begin_inset Formula 
\[
\frac{\partial}{\partial\sbf r_{\alpha}}\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\quad\Rightarrow\quad\sbf H(\sbf B)\cdot\frac{\partial\sbf B}{\partial\sbf r_{\alpha}}
\]

\end_inset


\end_layout

\begin_layout Subsection
二维电磁力计算
\end_layout

\begin_layout Standard
二维磁场 
\begin_inset Formula $\sbf B$
\end_inset

 的矢势 
\begin_inset Formula $\sbf A$
\end_inset

 只有
\begin_inset Formula $z$
\end_inset

 分量，
\begin_inset Formula $\sbf B$
\end_inset

 可以表示为：
\begin_inset Formula 
\begin{equation}
\sbf B=\frac{\partial A_{z}}{\partial y}\sbf e_{x}-\frac{\partial A_{z}}{\partial x}\sbf e_{y}=A_{i}\frac{\partial N_{i}^{e}}{\partial y}\sbf e_{x}-A_{i}\frac{\partial N_{i}^{e}}{\partial x}\sbf e_{y}=A_{i}\left(\nabla N_{i}^{e}\times\sbf e_{z}\right).\label{eq:xl6.10}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
也可以写出磁场的分量形式：
\begin_inset Formula 
\begin{equation}
B_{j}=A_{i}\varepsilon_{jk\ell}\partial_{k}N_{i}^{e}\left(\hat{e}_{z}\right)_{\ell}=\varepsilon_{jk3}\,A_{i}\partial_{k}N_{i}^{e}\label{eq:xl6.11}
\end{equation}

\end_inset

其中 
\begin_inset Formula $\hat{e}_{z}$
\end_inset

 是
\begin_inset Formula $z$
\end_inset

方向坐标基矢，所以 
\begin_inset Formula $\left(\hat{e}_{z}\right)_{\ell}=\delta_{z\ell}$
\end_inset

。
\end_layout

\begin_layout Enumerate
上式中的 
\begin_inset Formula $\partial_{k}N_{i}^{e}$
\end_inset

 可以在等参坐标系下表示为：
\begin_inset Formula 
\[
\partial_{k}N_{i}^{e}=J_{k\ell}^{-1}\hat{\partial}_{\ell}N_{i}^{e}.
\]

\end_inset

其中 
\begin_inset Formula $\hat{\partial}_{\ell}$
\end_inset

 表示等参坐标系下的偏导。
\end_layout

\begin_layout Enumerate
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.11"
plural "false"
caps "false"
noprefix "false"

\end_inset

 稍作变换可以得到另一种形式，两边同乘 
\begin_inset Formula $\varepsilon_{jk3}$
\end_inset

 得：
\begin_inset Formula 
\begin{align*}
 & \varepsilon_{jk3}A_{i}\partial_{k}N_{i}^{e}=B_{j}\\
\Rightarrow\quad & \varepsilon_{jk3}\;\varepsilon_{jk3}A_{i}\partial_{k}N_{i}^{e}=\varepsilon_{jk3}\;B_{j}
\end{align*}

\end_inset

即
\begin_inset Formula 
\begin{equation}
A_{i}\partial_{k}N_{i}^{e}=\varepsilon_{jk3}\,B_{j}\label{eq:xl6.11-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
使用
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

 （数字表示不同指标）得
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha m}} & =A_{i}\varepsilon_{jk3}\;{\color{blue}\frac{\partial J_{k\ell}^{-1}}{\partial r_{\alpha m}}}\;\hat{\partial}_{\ell}N_{i}^{e}=A_{i}\varepsilon_{jk3}\;{\color{blue}\left(-\partial_{k}L_{\alpha}^{e}\;J_{m\ell}^{-1}\right)}\;\hat{\partial}_{\ell}N_{i}^{e}\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(A_{i}J_{m\ell}^{-1}\hat{\partial}_{\ell}N_{i}^{e}\right)\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(A_{i}\partial_{m}N_{i}^{e}\right)\\
 & =-\varepsilon_{jk3}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}\left(\varepsilon_{nm3}\,B_{n}\right)\\
 & =-\left(\delta_{jn}\delta_{km}-\delta_{jm}\delta_{kn}\right){\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{n}\\
 & =-{\color{blue}\left(\partial_{m}L_{\alpha}^{e}\right)}B_{j}+\delta_{jm}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{k}
\end{align*}

\end_inset

合并两项的贡献，给出节点 
\begin_inset Formula $\alpha$
\end_inset

 所受磁力的 
\begin_inset Formula $m$
\end_inset

 分量，
\begin_inset Formula 
\[
F_{\alpha m}=\sum_{e}\int_{\Omega^{e}}\left\{ -\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-H_{j}\left[\delta_{jm}{\color{blue}\left(\partial_{k}L_{\alpha}^{e}\right)}B_{k}-{\color{blue}\left(\partial_{m}L_{\alpha}^{e}\right)}B_{j}\right]\right\} \dd{\Omega}
\]

\end_inset

写成矢量形式，节点 
\begin_inset Formula $\alpha$
\end_inset

 上所受的力是，
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-\sbf H\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)+\left(\sbf H\cdot\sbf B\right)\nabla L_{\alpha}^{e}\right]\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Example
线性情况下 
\begin_inset Formula $\sbf B=\mu_{0}\mu_{r}\sbf H$
\end_inset

，节点 
\begin_inset Formula $\alpha$
\end_inset

 所受的力化简为：
\begin_inset Formula 
\begin{align*}
\sbf F_{\alpha} & =\sum_{e}\int_{\Omega^{e}}\left[-\frac{\sbf H\cdot\sbf B}{2}\nabla L_{\alpha}^{e}-\sbf H\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)+\left(\sbf H\cdot\sbf B\right)\nabla L_{\alpha}^{e}\right]\dd{\Omega}\\
 & =\sum_{e}\int_{\Omega^{e}}\left[\frac{-\sbf B\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)}{\mu_{0}\mu_{r}}+\frac{\sbf B\cdot\sbf B}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}\right]\dd{\Omega}
\end{align*}

\end_inset

代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.10"
plural "false"
caps "false"
noprefix "false"

\end_inset

，得到
\begin_inset Formula 
\begin{equation}
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[\frac{A_{\beta}A_{\gamma}}{\mu_{0}\mu_{r}}\left(\nabla L_{\alpha}^{e}\cdot\nabla N_{\beta}^{e}\right)\nabla N_{\gamma}^{e}-A_{\beta}A_{\gamma}\frac{\nabla N_{\beta}^{e}\cdot\nabla N_{\gamma}^{e}}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}\right]\dd{\Omega}\label{eq:xl6.12}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
三维电磁力计算
\end_layout

\begin_layout Standard
三维磁场可以用棱边性函数表示为：
\begin_inset Formula 
\[
\sbf B=(\nabla\times\sbf N_{\alpha}^{e})A_{\alpha}=2A_{\alpha}\ell_{\alpha}^{e}\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}
\]

\end_inset

其中 
\begin_inset Formula $\sbf N_{\alpha}^{e}=(L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}-L_{\alpha(2)}^{e}\times\nabla L_{\alpha(1)}^{e})\ell_{\alpha}^{e}$
\end_inset

。分量形式为：
\begin_inset Formula 
\begin{align*}
B_{j} & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\;{\color{blue}\partial_{k}L_{\alpha(1)}^{e}}\;{\color{brown}\partial_{m}L_{\alpha(2)}^{e}}\\
 & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\;{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}\hat{\partial}_{g}L_{\alpha(2)}^{e}}
\end{align*}

\end_inset

上式中的 Jacobi 矩阵和四面体棱边的长度 
\begin_inset Formula $\ell_{i}^{e}$
\end_inset

 均为 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 的函数，但在用棱边形函数进行有限元计算时，待求的独立变量应该是 
\begin_inset Formula $A_{i}\ell_{i}$
\end_inset

 而不是 
\begin_inset Formula $A_{i}$
\end_inset

；每条边上的 
\begin_inset Formula $A_{i}\ell_{i}$
\end_inset

 不变，也是保证四面体某个面上磁通不变的条件。因此在计算 
\begin_inset Formula $B_{j}$
\end_inset

 偏导的时候，只需计算 Jacobi 矩阵对 
\begin_inset Formula $\sbf r_{\alpha}$
\end_inset

 的导数。利用式 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

可得
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha h}} & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left({\color{blue}\frac{\partial J_{kf}^{-1}}{\partial r_{\alpha h}}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}}+{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}\frac{J_{mg}^{-1}}{\partial r_{\alpha h}}}\right){\color{brown}\hat{\partial}_{g}L_{\alpha(2)}^{e}}\\
 & =2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}(-)\left({\color{blue}\partial_{k}L_{\alpha}^{e}\;J_{hf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}J_{mg}^{-1}}+{\color{blue}J_{kf}^{-1}\hat{\partial}_{f}L_{\alpha(1)}^{e}}\;{\color{brown}\partial_{m}L_{\alpha}^{e}\;J_{hg}^{-1}}\right){\color{brown}\hat{\partial}_{g}L_{\alpha(2)}^{e}}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left(\partial_{k}L_{\alpha}^{e}\;{\color{red}J_{hf}^{-1}\hat{\partial}_{f}}\;L_{\alpha(1)}^{e}\;{\color{red}J_{mg}^{-1}\hat{\partial}_{g}}\;L_{\alpha(2)}^{e}+{\color{red}J_{kf}^{-1}\hat{\partial}_{f}}\;L_{\alpha(1)}^{e}\;\partial_{m}L_{\alpha}^{e}\;{\color{red}J_{hg}^{-1}\hat{\partial}_{g}}\;L_{\alpha(2)}^{e}\right)\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\left(\partial_{k}L_{\alpha}^{e}\;{\color{red}\partial_{h}}\;L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}\;L_{\alpha(2)}^{e}+{\color{red}\partial_{k}}\;L_{\alpha(1)}^{e}\;\partial_{m}L_{\alpha}^{e}\;{\color{red}\partial_{h}}\;L_{\alpha(2)}^{e}\right)\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\partial_{k}L_{\alpha}^{e}\left({\color{red}\partial_{h}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}L_{\alpha(2)}^{e}-{\color{red}\partial_{m}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{h}}L_{\alpha(2)}^{e}\right)
\end{align*}

\end_inset

代入恒等式
\begin_inset Formula 
\[
{\color{red}\partial_{h}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{m}}L_{\alpha(2)}^{e}-{\color{red}\partial_{m}}L_{\alpha(1)}^{e}\;{\color{red}\partial_{h}}L_{\alpha(2)}^{e}=\varepsilon_{bhm}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\quad\text{反对称}
\]

\end_inset

得到
\begin_inset Formula 
\begin{align*}
\frac{\partial B_{j}}{\partial r_{\alpha h}} & =-2A_{\alpha}\ell_{\alpha}^{e}\;\varepsilon_{jkm}\partial_{k}L_{\alpha}^{e}\;\varepsilon_{bhm}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\left[\begin{array}{cc}
\delta_{jb} & \delta_{jh}\\
\delta_{kb} & \delta_{kh}
\end{array}\right]\partial_{k}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{b}\\
 & =-2A_{\alpha}\ell_{\alpha}^{e}\left[\partial_{h}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{j}-\delta_{jh}\partial_{k}L_{\alpha}^{e}\left(\nabla L_{\alpha(1)}^{e}\times\nabla L_{\alpha(2)}^{e}\right)_{k}\right]\\
 & =-B_{j}\;\partial_{h}L_{\alpha}^{e}+\delta_{jh}\;B_{k}\,\partial_{k}L_{\alpha}^{e}
\end{align*}

\end_inset

写成矢量形式是
\begin_inset Formula 
\[
\left[\begin{array}{c}
\partial/\partial r_{\alpha1}\\
\partial/\partial r_{\alpha2}\\
\partial/\partial r_{\alpha3}
\end{array}\right]B_{j}=-B_{j}\nabla L_{\alpha}^{e}+\sbf e_{j}\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)
\]

\end_inset

因此虚功法的磁力表达式
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}-\sbf H\cdot\frac{\partial\sbf B}{\partial\sbf r_{k}}\right]
\]

\end_inset

给出
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\left(-\int_{0}^{B}\sbf H\cdot\dd{\sbf B'}\right)\nabla L_{\alpha}^{e}+\nabla L_{\alpha}^{e}\left(\sbf H\cdot\sbf B\right)-\left(\sbf B\cdot\nabla L_{\alpha}^{e}\right)\sbf H\right]
\]

\end_inset

对于线性材料 
\begin_inset Formula $\sbf B=\mu\mu_{0}\sbf H$
\end_inset

，结果化简为：
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\dd{\Omega}\left[\frac{\sbf B\cdot\sbf B}{2\mu_{0}\mu_{r}}\nabla L_{\alpha}^{e}-\frac{\sbf B\left(\nabla L_{\alpha}^{e}\cdot\sbf B\right)}{\mu_{0}\mu_{r}}\right]
\]

\end_inset


\end_layout

\begin_layout Section
计算电力？？
\end_layout

\begin_layout Standard
理论公式：
\begin_inset Formula 
\[
\mathcal{U}=\int_{0}^{Q}V\dd{Q'}=\int_{\Omega}\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\dd{\Omega}
\]

\end_inset


\begin_inset Formula 
\[
\int_{0}^{\Psi}I\dd{\Psi'}\quad\Leftrightarrow\quad\int_{0}^{Q}V\dd{Q'}
\]

\end_inset

所以 
\begin_inset Formula $\Psi$
\end_inset

 对应 
\begin_inset Formula $Q$
\end_inset

，
\begin_inset Formula $I$
\end_inset

 对应 
\begin_inset Formula $V$
\end_inset

。
\begin_inset Formula 
\begin{align*}
\mathcal{U}_{\text{co}} & =VQ-\mathcal{U}=\int_{0}^{V}Q\dd{V'}\\
 & =\int_{\Omega}\left(\int_{0}^{E}\sbf D\cdot\dd{\sbf E'}\right)\dd{\Omega}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
类似磁力的计算 
\begin_inset CommandInset ref
LatexCommand eqref
reference "sec:calc-magforce"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\mathcal{U}=\sum_{e}\int_{\Omega^{e}}\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\det[J]\dd{\hat{\Omega}}
\]

\end_inset

节点 
\begin_inset Formula $\alpha$
\end_inset

 上的电力，表示成 电能 
\begin_inset Formula $\mathcal{U}$
\end_inset

 对节点 
\begin_inset Formula $\alpha$
\end_inset

 的坐标的偏导数：
\begin_inset Formula 
\[
\sbf F_{\alpha}=-\frac{\partial\mathcal{U}}{\partial\sbf r_{\alpha}}
\]

\end_inset


\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right){\color{blue}\frac{\partial\det[J]}{\partial\sbf r_{\alpha}}}-\left(\sbf E\cdot{\color{brown}\frac{\partial\sbf D}{\partial\sbf r_{\alpha}}}\right)\det[J]\right]\dd{\hat{\Omega}}
\]

\end_inset


\end_layout

\begin_layout Example
代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\partial\det[J]/\partial r_{\alpha j}=\det[J]\,\partial_{j}L_{\alpha}^{e}$
\end_inset

，第一项的贡献表示为，
\begin_inset Formula 
\[
f_{\alpha,1}=-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right){\color{blue}\partial_{j}L_{\alpha}^{e}\,\det[J]}\dd{\hat{\Omega}}
\]

\end_inset

顺便改写积分测度：
\begin_inset Formula 
\[
\sbf f_{\alpha,1}=-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\nabla L_{\alpha}^{e}\,\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Example
再考虑第二项的贡献
\begin_inset Formula 
\begin{equation}
-\left(\sbf E\cdot{\color{brown}\frac{\partial\sbf D}{\partial\sbf r_{\alpha}}}\right)\det[J]\quad\Rightarrow\quad-E_{i}\frac{\partial D_{i}}{\partial r_{\alpha j}}\,\det[J]\label{eq:e-force2}
\end{equation}

\end_inset

右边是对应的分量形式。电位移
\begin_inset Formula $\sbf D$
\end_inset

 依赖于 电场强度 
\begin_inset Formula $\sbf E$
\end_inset

：
\begin_inset Formula 
\[
\frac{\partial D_{i}}{\partial r_{\alpha j}}=\mathcal{T}_{ik}\frac{\partial E_{k}}{\partial r_{\alpha j}},\quad\mathcal{T}_{ik}=\frac{\partial D_{i}}{\partial E_{k}}
\]

\end_inset


\begin_inset Formula $T_{ik}$
\end_inset

 是材料的介电张量。写出 
\begin_inset Formula $\sbf E=-\nabla\phi$
\end_inset

 的分量形式：
\end_layout

\begin_layout Example
\begin_inset Formula 
\[
E_{k}=-\partial_{k}\phi=-{\color{blue}\partial_{k}N_{\beta}^{e}\;\phi_{\beta}}
\]

\end_inset

其中 
\begin_inset Formula $\phi_{\beta}$
\end_inset

 是节点上的电势，为常数。将对等参坐标的偏导数记作 
\begin_inset Formula $\hat{\partial}_{k}=\left(\frac{\partial}{\partial\xi},\frac{\partial}{\partial\eta},\frac{\partial}{\partial\zeta}\right)$
\end_inset

，考虑雅可比矩阵得
\begin_inset Formula 
\begin{equation}
E_{k}=-{\color{brown}J_{k\ell}^{-1}}\;{\color{blue}\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\label{eq:elec-field}
\end{equation}

\end_inset


\end_layout

\begin_layout Enumerate
其中 
\begin_inset Formula $\hat{\partial}_{\ell}N_{\beta}^{e}$
\end_inset

 表示等参坐标系下的偏导，此时形函数 
\begin_inset Formula $N_{\beta}^{e}$
\end_inset

 使用等参坐标表示，不包含节点 
\begin_inset Formula $\alpha$
\end_inset

 的几何坐标。
\end_layout

\begin_layout Enumerate
对节点 
\begin_inset Formula $\alpha$
\end_inset

 坐标的依赖 只包含在 
\begin_inset Formula ${\color{brown}J_{k\ell}^{-1}}$
\end_inset

 中。
\end_layout

\begin_layout Standard
代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl6.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\frac{\partial J_{12}^{-1}}{\partial r_{\alpha3}}=-\partial_{1}L_{\alpha}^{e}\;J_{32}^{-1}$
\end_inset

 （数字表示不同指标）得
\begin_inset Formula 
\begin{align*}
\frac{\partial E_{k}}{\partial r_{\alpha j}} & =-({\color{brown}-\partial_{k}L_{\alpha}^{e}\;J_{j\ell}^{-1}})\,{\color{blue}\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\\
 & =\partial_{k}L_{\alpha}^{e}\;{\color{blue}J_{j\ell}^{-1}\,\hat{\partial}_{\ell}N_{\beta}^{e}\;\phi_{\beta}}\\
 & ={\color{blue}(-E_{j})}\;\partial_{k}L_{\alpha}^{e}
\end{align*}

\end_inset

将此结果代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:e-force2"
plural "false"
caps "false"
noprefix "false"

\end_inset

 得
\begin_inset Formula 
\[
-E_{i}\frac{\partial D_{i}}{\partial r_{\alpha j}}=-E_{i}\mathcal{T}_{ik}\left(-E_{j}\right)\partial_{k}L_{\alpha}^{e}
\]

\end_inset

写成矢量形式是
\begin_inset Formula 
\[
f_{\alpha,2}=\sbf E\;\left(\sbf E\cdot\mathcal{T}\cdot\nabla L_{\alpha}^{e}\right)\dd{\Omega}
\]

\end_inset

其中 
\begin_inset Formula $\mathcal{T}=\partial D/\partial E$
\end_inset

，是材料的介电张量。
\end_layout

\begin_layout Standard
综合两项的贡献得到：
\begin_inset Formula 
\[
\sbf F_{\alpha}=\sum_{e}\int_{\Omega^{e}}\left[-\left(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\right)\nabla L_{\alpha}^{e}+\sbf E\;\left(\sbf E\cdot\mathcal{T}\cdot\nabla L_{\alpha}^{e}\right)\right]\dd{\Omega}
\]

\end_inset


\end_layout

\begin_layout Subsection
eeee
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
F_{\alpha}=\sum_{\langle e\rangle}\int_{\Omega^{e}}\left[\big(\int_{0}^{D}\sbf E\cdot\dd{\sbf D'}\big)\nabla L_{\alpha}^{e}-\sbf E\,(\sbf D\cdot\nabla L_{\alpha}^{e})\right]\dd{\Omega}
\]

\end_inset


\begin_inset Formula 
\begin{align*}
F_{\alpha} & =\sum_{\langle e\rangle}\int_{\Omega^{e}}\frac{\sbf E\cdot\sbf D}{2}\nabla L_{\alpha}^{e}\dd{\Omega}-\sum_{\langle e\rangle}\int_{\Omega^{e}}\left(\sbf D\cdot\nabla L_{\alpha}^{e}\right)\sbf E\dd{\Omega}\\
 & +\sum_{\langle e\rangle}\int_{\Omega^{e}}\frac{\sbf B\cdot\sbf H}{2}\nabla L_{\alpha}^{e}\dd{\Omega}-\sum_{\langle e\rangle}\int_{\Omega^{e}}\left(\sbf B\cdot\nabla L_{\alpha}^{e}\right)\sbf H\dd{\Omega}
\end{align*}

\end_inset

在上面的表达式中，
\begin_inset Formula $\langle e\rangle$
\end_inset

 表示仅对最近邻单元进行求和。将目标区域的节点上的电磁力进行求和，可以得到该目标区域所受到的总的电磁力。
\end_layout

\begin_layout Standard
另外根据力矩的计算公式，也可以得到各个节点上所受到的力矩，即
\begin_inset Formula 
\[
\sbf T_{k}=\left(\sbf r_{k}-\sbf r_{0}\right)\times\sbf F_{k}
\]

\end_inset

 其中 
\begin_inset Formula $\sbf r_{0}$
\end_inset

 为转轴的坐标，对目标区域的节点上的力矩进行求和，同样可以得到总的电磁力矩。
\end_layout

\begin_layout Chapter
电场的开域问题
\end_layout

\begin_layout Standard
有限元方法只能处理有限大的空间，因此对于电场的开域问题，需要在边界上施加适当的边界条件来模拟边界的性质。首先根据麦克斯韦方程组，可以得到开域情况下电势满足的积分
方程：
\begin_inset Formula 
\[
\Phi\left(\sbf r\right)=\frac{1}{4\pi\varepsilon_{0}}\int\dd[3]{r'}\frac{1}{\abs{r-r'}}\left[\rho\left(\sbf r'\right)-\nabla'\cdot\sbf P\left(\sbf r'\right)\right]
\]

\end_inset

由于源都是局域的，因此在远离源的位置可以做如下展开：
\begin_inset Formula 
\[
\frac{1}{\abs{\sbf r-\sbf r'}}=\frac{1}{\abs{\sbf r}}+\frac{\sbf r\cdot\sbf r'}{\abs{\sbf r}^{3}}+\cdots
\]

\end_inset


\end_layout

\begin_layout Standard
取决于源的分布情况，电势在远离源的位置可能是以 
\begin_inset Formula $r^{-1}$
\end_inset

，或 
\begin_inset Formula $r^{-2}$
\end_inset

的形式衰减到零。在忽略高阶项的情况下，可以在远离源的位置将电势近似为
\begin_inset Formula 
\begin{equation}
\Phi=\frac{a}{r^{n}},\label{eq:xl2.6}
\end{equation}

\end_inset

其中 
\begin_inset Formula $a$
\end_inset

 是与 
\begin_inset Formula $r$
\end_inset

 无关的量；
\begin_inset Formula $n$
\end_inset

 可以由电荷的分布情况决定，对于同种电荷 
\begin_inset Formula $n$
\end_inset

 一般取
\begin_inset Formula $1$
\end_inset

，对于电偶极子
\begin_inset Formula $n$
\end_inset

一般取
\begin_inset Formula $2$
\end_inset

。在有限元模型边界上可以采用截断法来模拟开域边界，即取 
\begin_inset Formula $\Phi=0$
\end_inset

，或 
\begin_inset Formula $\nabla\Phi=0$
\end_inset

。两种处理方式分别对应 第一、二类边界条件，理论上的计算精度分别为 
\begin_inset Formula $\order{r^{-n}}$
\end_inset

 和 
\begin_inset Formula $\order{r^{-n-1}}$
\end_inset

。另外使用 
\begin_inset Formula $\nabla\frac{1}{r}=\frac{1}{r^{2}}\sbf e_{r}=\frac{1}{r^{2}}\frac{\sbf r}{r}$
\end_inset

，从
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.6"
plural "false"
caps "false"
noprefix "false"

\end_inset

可以得到： 
\begin_inset Formula 
\begin{equation}
\nabla\Phi=-na\frac{1}{r^{n+1}}\frac{\sbf r}{r}=-n\frac{\Phi}{r}\frac{\sbf r}{r}.\label{eq:xl2.7}
\end{equation}

\end_inset

如果在边界上采用 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 处理模型边界上的电势，那么理论上的计算精度可以达到 
\begin_inset Formula $\order{r^{-n-2}}$
\end_inset

，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示的条件即为 渐近边界条件（Asymptotic boundary condition），对应有限元计算中的第三类边界条件。
\end_layout

\begin_layout Section
表面项
\end_layout

\begin_layout Standard
在泛函积分式(2.2)
\begin_inset Formula 
\begin{equation}
\mathcal{F}\left(\Phi\right)=\frac{1}{2}\int_{\Omega}\nabla\Phi\cdot\epsilon_{r}\nabla\Phi\dd{\Omega}-\int\frac{\rho}{\epsilon_{0}}\Phi\dd{\Omega}.\label{eq:xl2.2}
\end{equation}

\end_inset

中添加一个表面项得到新的泛函积分
\begin_inset Formula 
\[
\mathcal{F}\left(\Phi\right)=\frac{1}{2}\int_{\Omega}\nabla\Phi\cdot\epsilon_{r}\nabla\Phi\dd{\Omega}-\int\frac{\rho}{\epsilon_{0}}\Phi\dd{\Omega}+{\color{blue}\int_{\Gamma}\epsilon_{r}\frac{n}{r}\frac{\Phi\epsilon_{r}\Phi}{2}}\dd{\Gamma}.
\]

\end_inset

对上式做变分可以得到（使用分部积分）
\begin_inset Formula 
\[
\delta\mathcal{F}\left(\Phi\right)=-\int_{\Omega}\left(\nabla\cdot\epsilon_{r}\nabla\Phi+\frac{\rho}{\epsilon_{0}}\right)\delta\Phi\dd{\Omega}+\int_{\Gamma}\left({\color{blue}\sbf e_{n}\cdot\epsilon_{r}\nabla\Phi+\frac{n}{r}\epsilon_{r}\Phi}\right)\delta\Phi\dd{\Gamma}.
\]

\end_inset

从方程中的第二项可得
\begin_inset Formula 
\[
\sbf e_{n}\cdot\nabla\Phi=-n\frac{\Phi}{r}
\]

\end_inset

它等价于
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 
\begin_inset Formula $\nabla\Phi=-n\frac{\Phi}{r}\frac{\sbf r}{r}$
\end_inset

。对比第三类边界条件的标准形式：
\begin_inset Formula 
\[
\left(\alpha\nabla\Phi\right)\cdot\sbf n=q-\gamma\Phi
\]

\end_inset

相当于取 
\begin_inset Formula $\alpha=1$
\end_inset

，
\begin_inset Formula $q=0$
\end_inset

，
\begin_inset Formula $-\gamma=-\frac{n}{r}$
\end_inset

。
\end_layout

\begin_layout Example
综上，开域边界条件相当于
\begin_inset Formula 
\[
-\nabla\Phi=\frac{n}{r}\Phi\,\sbf e_{r}
\]

\end_inset

取上式的变分得（变分和微分交换次序）
\begin_inset Formula 
\[
-\nabla\delta\Phi=\frac{n}{r}\delta\Phi\,\sbf e_{r}
\]

\end_inset

考虑 Galerkin 方程中边界项的贡献
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}
\end{align*}

\end_inset

其中（在开放边界足够大，渐近于球形的近似下）
\begin_inset Formula 
\[
{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot(-\sbf\nabla\delta\phi)}\Rightarrow N_{i}^{e}\sbf e_{r}\cdot\frac{\partial D}{\partial E}\cdot\sbf e_{r}\;\frac{n}{r}\delta\Phi
\]

\end_inset

同理，若代入微扰展开 
\begin_inset Formula $\delta\phi=\sum_{e=1}^{N}N_{j}^{e}\delta\phi_{j}$
\end_inset

，相当于在刚度矩阵中添加一项
\begin_inset Formula 
\[
N_{i}^{e}\;\sbf e_{r}\cdot\frac{\partial D}{\partial E}\cdot\sbf e_{r}\frac{n}{r}\;N_{j}^{e}
\]

\end_inset

或者写成
\end_layout

\begin_layout Example
\begin_inset Box Boxed
position "t"
hor_pos "c"
has_inner_box 1
inner_pos "t"
use_parbox 0
use_makebox 0
width "100col%"
special "none"
height "1in"
height_special "totalheight"
thickness "0.4pt"
separation "3pt"
shadowsize "4pt"
framecolor "black"
backgroundcolor "none"
status open

\begin_layout Plain Layout
\begin_inset Formula 
\[
\sbf r\cdot\frac{\partial D}{\partial E}\cdot\sbf r\;\frac{n}{r^{3}}\;N_{i}^{e}N_{j}^{e}
\]

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $N_{i}^{e}N_{j}^{e}$
\end_inset

 可以理解为 
\begin_inset Formula $N_{i1}^{e}N_{1j}^{e}=\left(N^{e}\cdot N^{e,T}\right)_{ij}$
\end_inset

，
\begin_inset Formula $N_{i1}^{e}$
\end_inset

为列矩阵。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r=\sqrt{x^{2}+y^{2}+z^{2}}$
\end_inset

，表示原点
\begin_inset Formula $O$
\end_inset

 到场点 
\begin_inset Formula $P$
\end_inset

 的距离。
\end_layout

\begin_layout Enumerate
为了保证计算精度，程序中要求开域边界条件的几何边界尽量为球形或圆形。
\end_layout

\begin_layout Section
边界形状和误差
\end_layout

\begin_layout Standard
对于球形边界，垂直边界的矢量 
\begin_inset Formula $\sbf e_{n}=\frac{\sbf r}{r}$
\end_inset

，所以
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

 所示的渐近边界条件可以通过在泛函积分中添加相应的表面项来处理。对于非球形边界，
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.7"
plural "false"
caps "false"
noprefix "false"

\end_inset

近似成立。这一项会在原来的 
\begin_inset Formula $\left[K_{ij}^{e}\right]$
\end_inset

 矩阵中增加表面项的贡献
\begin_inset Formula 
\begin{equation}
K_{ij}^{s}=\int_{\Gamma^{e}}\epsilon_{r}\frac{n}{r}N_{i}^{e}N_{j}^{e}\dd{\Gamma}.\label{eq:xl2.8}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
由于 
\begin_inset Formula $r$
\end_inset

 在球形边界是定值，可以直接提取到积分外面；即使对于非圆形边界，
\begin_inset Formula $1/r$
\end_inset

 在边界处表面单元中变换不大，所以依然可以提到积分号外面。下面分二维，轴对称和三位情况分别计算 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:xl2.8"
plural "false"
caps "false"
noprefix "false"

\end_inset

。
\end_layout

\begin_layout Standard
三维有限元的边界为一平面，采用高斯积分法计算的表达式为
\begin_inset Formula 
\[
K_{ij}^{s}=\epsilon_{r}\frac{n}{r}\Delta^{s}\sum_{\alpha}N_{i}^{s}\left(\xi_{\alpha},\eta_{\alpha}\right)\,N_{j}^{s}\left(\xi_{\alpha},\eta_{\alpha}\right)\,W\left(\xi_{\alpha},\eta_{\alpha}\right)
\]

\end_inset

其中 
\begin_inset Formula $\Delta^{s}$
\end_inset

 为边界单元的面积。
\end_layout

\begin_layout Remark
ref：郭硕鸿 p63/77。电多级展开：
\begin_inset Formula 
\[
f\left(\sbf x-\sbf x'\right)=f\left(\sbf x\right)-\sbf x'\cdot\nabla f@\sbf x+\frac{1}{2!}\left(\sbf x'\cdot\nabla\right)^{2}f@\sbf x+\cdots
\]

\end_inset


\begin_inset Formula 
\begin{equation}
\varphi\left(x\right)=\frac{1}{4\pi\varepsilon_{0}}\left(\frac{Q}{R}-\sbf p\cdot\nabla\frac{1}{R}+\frac{1}{6}\sum_{i,j}\mathcal{D}_{ij}\partial_{i}\partial_{j}\frac{1}{R}+\cdots\right)\label{eq:g6.7}
\end{equation}

\end_inset


\begin_inset Formula 
\begin{align*}
Q & =\int_{V}\rho\left(\sbf x'\right)\dd{V'}\\
\sbf p & =\int_{V}\rho\left(\sbf x'\right)\dd{V'}\\
\mathcal{D}_{ij} & =\int_{V}3x'_{i}x'_{j}\,\rho\left(\sbf x'\right)\dd{V'}
\end{align*}

\end_inset

其中
\begin_inset Formula $R=\sqrt{x^{2}+y^{2}+z^{2}}$
\end_inset

，表示原点到场点 
\begin_inset Formula $P$
\end_inset

 的距离。
\end_layout

\begin_layout Section
外加电场
\end_layout

\begin_layout Subsection
解析解的例子
\end_layout

\begin_layout Standard
ref: 郭硕鸿 p51/65；均匀介质球的极化，球外为真空，半径为 
\begin_inset Formula $R_{0}$
\end_inset

，均匀外电场为 
\begin_inset Formula $\sbf E_{0}$
\end_inset

。
\begin_inset CommandInset label
LatexCommand label
name "ref:g51"

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Graphics
	filename inset/GuoShuoHong-2.5.png
	lyxscale 50
	scale 40

\end_inset


\end_layout

\begin_layout Standard
取 
\begin_inset Formula $\sbf E_{0}$
\end_inset

 的方向为球坐标系 
\begin_inset Formula $z$
\end_inset

 轴，并过球心
\begin_inset Formula 
\begin{align}
\text{球外解：} & \varphi_{1}=-E_{0}R\cos\theta+\frac{\epsilon-\epsilon_{0}}{\epsilon+2\epsilon_{0}}\frac{E_{0}R_{0}^{3}\cos\theta}{R^{2}}\nonumber \\
\text{球内解：} & \varphi_{2}=-\frac{3\epsilon_{0}}{\epsilon+2\epsilon_{0}}E_{0}R\cos\theta.\label{eq:g3.21}
\end{align}

\end_inset

球内是均匀电场，球内束缚电荷激发的场与原外场反向，使总电场减弱。在球内总电场作用下，介质的极化强度为
\begin_inset Formula 
\begin{equation}
\sbf P=\chi_{e}\epsilon_{0}\sbf E=\left(\epsilon-\epsilon_{0}\right)\sbf E=\frac{\epsilon-\epsilon_{0}}{\epsilon+2\epsilon_{0}}3\epsilon_{0}\sbf E_{0}\label{eq:g3.22}
\end{equation}

\end_inset

 介质球的总电偶极矩为
\begin_inset Formula 
\begin{equation}
\sbf p=\frac{4\pi}{3}R_{0}^{3}\sbf P=\frac{\epsilon-\epsilon_{0}}{\epsilon+2\epsilon_{0}}4\pi\epsilon_{0}R_{0}^{3}\sbf E_{0}\label{eq:g3.23}
\end{equation}

\end_inset


\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:g3.21"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中的第二项正是此电偶极矩所产生的电势
\begin_inset Formula 
\begin{equation}
\frac{1}{4\pi\epsilon_{0}}\frac{\sbf p\cdot\sbf R}{R^{3}}=\frac{\epsilon-\epsilon_{0}}{\epsilon+2\epsilon_{0}}\frac{E_{0}R_{0}^{3}\cos\theta}{R^{2}}\label{eq:g3.24}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
有限元中的处理
\end_layout

\begin_layout Standard
在程序实现中，规定 
\color blue
外加电场
\color inherit
 总是配合 
\color blue
开域边界
\color inherit
 一同使用，且边界应当是球形，介质是线性的。令外加电场为 
\begin_inset Formula $\sbf E_{0}$
\end_inset

，除去它的影响之后，令 有限区域电荷产生的电势为 
\begin_inset Formula $\Phi$
\end_inset

，令总电势为 
\begin_inset Formula $\Phi_{t}=\Phi-\sbf E_{0}\cdot\sbf r$
\end_inset

， 
\begin_inset Formula $\Phi$
\end_inset

 应该满足 开域边界条件 的性质，即
\begin_inset Formula 
\begin{equation}
{\color{brown}-\nabla\Phi=\frac{n}{r}\Phi\,\sbf e_{r}}\label{eq:phi-local}
\end{equation}

\end_inset

代入 
\begin_inset Formula $\Phi={\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}$
\end_inset

， 
\begin_inset Formula 
\[
-\nabla\left({\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}\right)=\frac{n}{r}\left({\color{blue}\Phi_{t}+\sbf E_{0}\cdot\sbf r}\right)\sbf e_{r}
\]

\end_inset

略微化简给出
\begin_inset Formula 
\begin{equation}
{\color{brown}-\nabla\Phi_{t}=\frac{n}{r}\Phi_{t}\sbf e_{r}}+\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{r}\right)\sbf e_{r}\label{eq:phi-global}
\end{equation}

\end_inset

可以看到
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi-global"
plural "false"
caps "false"
noprefix "false"

\end_inset

 与 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:phi-local"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的区别是多了后面两项。代入Galerkin 方程 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Galerkin"
plural "false"
caps "false"
noprefix "false"

\end_inset

边界项 
\begin_inset Formula $N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot(\sbf\nabla\delta\phi)$
\end_inset

：并把 
\begin_inset Formula ${\color{brown}-\nabla\Phi_{t}=\frac{n}{r}\Phi_{t}\sbf e_{r}}$
\end_inset

 的贡献归入刚度矩阵 
\begin_inset Formula $K_{ij}^{e}$
\end_inset

；把 
\begin_inset Formula $\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{r}\right)\sbf e_{r}$
\end_inset

 的贡献归入 载荷（Load），载荷项的形式为
\begin_inset Formula 
\[
-N_{i}\,\sbf e_{n}\cdot\epsilon\cdot\left[\sbf E_{0}+n\left(\sbf E_{0}\cdot\sbf e_{R}\right)\sbf e_{R}\right].
\]

\end_inset


\end_layout

\begin_layout Subsection
backup
\end_layout

\begin_layout Standard
在有限元框架下求解外加电场的问题，外加电场 
\begin_inset Formula $\sbf E_{0}$
\end_inset

 的影响体现在 两个边界项中。观察 Galerkin 方程
\begin_inset Formula 
\begin{align*}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}
\end{align*}

\end_inset


\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf e_{n}\cdot\sbf D^{0}}$
\end_inset

这一项体现的是背景场（即
\begin_inset Formula $\sbf E_{0}$
\end_inset

 ）的贡献；而 
\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf e_{n}\cdot\frac{\partial D}{\partial E}\cdot\sbf\nabla\delta\phi}$
\end_inset

 则类似于开域边界条件。
\end_layout

\begin_layout Standard
参考 
\begin_inset CommandInset ref
LatexCommand eqref
reference "ref:g51"
plural "false"
caps "false"
noprefix "false"

\end_inset

，在外加电场影响下，极化电荷在边界处的电势形如
\begin_inset Formula 
\[
\Phi=a\frac{\cos\theta}{R^{n}},
\]

\end_inset

对于电偶极子 
\begin_inset Formula $n=2$
\end_inset

，其中 
\begin_inset Formula $\cos\theta=\sbf E_{0}\cdot\sbf e_{R}$
\end_inset

。考察边界上的电势法向量，
\begin_inset Formula 
\[
-\nabla\Phi=a\frac{\cos\theta}{R^{n}}\frac{n}{R}\sbf e_{R}+a\frac{\sin\theta}{R^{n}}\frac{1}{R}\sbf e_{\theta}
\]

\end_inset

对应的变分是
\begin_inset Formula 
\[
-\sbf\nabla\delta\phi=\frac{n}{R}\sbf e_{R}\delta\Phi+(\cdots)\sbf e_{\theta}
\]

\end_inset

Galerkin 方程边界项的贡献是
\begin_inset Formula 
\[
-N_{i}^{e}\sbf e_{n}\cdot\epsilon\cdot{\color{brown}\sbf\nabla\delta\phi}=N_{i}^{e}\sbf e_{n}\cdot\epsilon\cdot{\color{brown}\sbf e_{R}\,\frac{n}{R}\delta\Phi}
\]

\end_inset


\end_layout

\begin_layout Remark
其中使用了球坐标下的梯度表达式
\begin_inset Formula 
\[
\nabla\psi=\sbf e_{r}\partial_{r}\psi+\frac{1}{r}\sbf e_{\theta}\partial_{\theta}\psi+\frac{1}{r\sin\theta}\partial_{\phi}\sbf e_{\phi}.
\]

\end_inset


\end_layout

\begin_layout Chapter
有限元的矩阵方程
\end_layout

\begin_layout Section
有限元中的Galerkin 方法
\end_layout

\begin_layout Standard
FEM-Gerard;p45/61;sec 1.3.11
\end_layout

\begin_layout Standard
首先基础的公式是 ：
\begin_inset Formula 
\begin{align*}
\nabla\cdot\sbf D & =\rho\\
\sbf D & =\sbf D\left(\sbf E\right)\\
\sbf E & =-\nabla\phi
\end{align*}

\end_inset


\end_layout

\begin_layout Enumerate
令 加权的残差（residual error）和 为
\begin_inset Formula 
\begin{align}
R^{e}\left[N_{i}^{e}\right] & =\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}N_{i}^{e}\left({\color{blue}\nabla\cdot\sbf D}-\rho\right)\dd{\Omega}\label{eq:error}\\
\text{分部积分} & \Rightarrow{\color{blue}-\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}\nabla N_{i}^{e}\cdot\sbf D\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}\nabla\cdot\left(N_{i}^{e}\sbf D\right)\dd{\Omega}}-\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}\nonumber \\
\text{散度定理} & \Rightarrow-\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}-\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}=0\nonumber 
\end{align}

\end_inset

上面使用了分部积分，和高斯散度定理；通过分部积分引入了边界条件项 
\begin_inset Formula ${\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}$
\end_inset

。稍微整理下
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset

例如对于线性导体 
\begin_inset Formula $\sbf D=\epsilon\sbf E$
\end_inset

，上式可以写成：
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\left(-\epsilon\nabla\phi\right)}\dd{\Omega}=-\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset

对于齐次第二类（natural）边界条件 
\begin_inset Formula $\left(\alpha\nabla\phi\right)\cdot\sbf n=0$
\end_inset

（电位移线平行），可以直接去掉 
\begin_inset Formula $\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}$
\end_inset

 项。
\end_layout

\begin_layout Subsection
微扰展开
\end_layout

\begin_layout Enumerate
如果考虑待求物理量 
\begin_inset Formula $\sbf D$
\end_inset

 和 
\begin_inset Formula $\phi$
\end_inset

 的微小变分：
\begin_inset Formula 
\begin{align*}
\sbf D & =\sbf D^{0}+{\color{blue}\epsilon}\,\delta\sbf E=\sbf D^{0}-{\color{blue}\epsilon}\,\sbf\nabla\delta\phi\\
\phi & =\phi^{0}+\delta\phi
\end{align*}

\end_inset

其中 
\begin_inset Formula $\epsilon=\frac{\partial D}{\partial E}$
\end_inset

，对于一般材料 
\begin_inset Formula $\frac{\partial D}{\partial E}$
\end_inset

 有可能是张量。代入 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:error"
plural "false"
caps "false"
noprefix "false"

\end_inset

 得：
\begin_inset Formula 
\begin{align*}
\Rightarrow & -\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}+\frac{1}{\varepsilon_{0}}\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Omega}\\
 & +\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D^{0}}\dd{\Gamma}-\frac{1}{\varepsilon_{0}}\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Gamma}-\int_{\Omega^{e}}N_{i}^{e}\frac{\rho}{\varepsilon_{0}}\dd{\Omega}
\end{align*}

\end_inset

移项得
\begin_inset Formula 
\begin{align}
 & \int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\,\sbf n\cdot\epsilon\cdot\sbf\nabla\delta\phi}\dd{\Gamma}\nonumber \\
 & =\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\,\sbf n\cdot\sbf D^{0}}\dd{\Gamma}+\int_{\Omega^{e}}N_{i}^{e}\rho\dd{\Omega}\label{eq:Galerkin}
\end{align}

\end_inset


\end_layout

\begin_layout Enumerate
再代入 
\begin_inset Formula $\phi$
\end_inset

 的插值展开，
\begin_inset Formula $\delta\phi=\sum_{e=1}^{N}N_{j}^{e}\delta\phi_{j}$
\end_inset

 得
\begin_inset Formula 
\begin{align*}
\bigg[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\nabla N_{j}^{e}}\dd{\Omega} & -\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\,\sbf n\cdot\epsilon\cdot\nabla N_{j}^{e}}\dd{\Gamma}\bigg]\delta\phi_{j}\\
 & =\lambda\left\{ \int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}-\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\,\sbf n\cdot\sbf D^{0}}\dd{\Gamma}\right\} 
\end{align*}

\end_inset

此即 Galerkin 方法的迭代展开式。左边正比于 
\begin_inset Formula $N_{i}^{e}N_{j}^{e}$
\end_inset

，右边正比于 
\begin_inset Formula $N_{i}^{e}$
\end_inset

，因此在 尺度（scale）变换下，
\begin_inset Formula 
\[
\left[\cdots\right]\delta\phi_{j}=\lambda\left\{ \cdots\right\} ,\quad\lambda<1.
\]

\end_inset

相当于 
\begin_inset Formula $\delta\phi_{j}$
\end_inset

 获得更小的步长。
\end_layout

\begin_layout Enumerate
对于第一类（essential）边界条件，在边界上 
\begin_inset Formula $\delta\phi_{j}=0$
\end_inset

；对于齐次第二类（natural）边界条件，
\begin_inset Formula $n\cdot\sbf D^{0}=0$
\end_inset

；两种情况下边界项都可以不考虑，此时方程简化为，
\begin_inset Formula 
\begin{equation}
\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\epsilon\cdot\nabla N_{j}^{e}}\dd{\Omega}\right]\delta\phi_{j}=\lambda\left\{ \int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}\right\} .\label{eq:Galerkin-2}
\end{equation}

\end_inset

只有第三类边界条件，例如开放边界，或外加电场时需要考虑边界项。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Subsection
工作区变量
\end_layout

\begin_layout Standard
下面列出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Galerkin-2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的部件，在程序中对应的变量。 
\begin_inset Formula $W(\xi_{i})$
\end_inset

 是高斯积分的权重因子，
\begin_inset Formula $\det[J]$
\end_inset

 是雅可比矩阵的行列式。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $K$
\end_inset

：Sparse::GetMatrix<double>(
\begin_inset Quotes eld
\end_inset

K
\begin_inset Quotes erd
\end_inset

)，刚度矩阵，Galerkin 方程左侧的稀疏矩阵。
\begin_inset Formula 
\[
K=\nabla N^{T}\cdot\epsilon\cdot\nabla N*W*\det[J]
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $F_{\text{in}}$
\end_inset

：Fin，“内力”，Galerkin 方程
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:Galerkin-2"
plural "false"
caps "false"
noprefix "false"

\end_inset

中，
\begin_inset Formula $\sbf D^{0}$
\end_inset

 引发的贡献
\begin_inset Formula 
\[
F_{\text{in}}=\nabla N^{T}\cdot\sbf D^{0}\cdot\left(-\det[J]*W\right)/\epsilon_{0}
\]

\end_inset


\end_layout

\begin_layout Enumerate
\begin_inset Formula $F_{v}$
\end_inset

：Fv，“力”矢量，其实是电荷（电荷密度，或者外加电场）的贡献
\begin_inset Formula 
\[
F_{v}=N*\rho*\det[J]*W
\]

\end_inset


\end_layout

\begin_layout Enumerate
P_GFv_T 是 Global Fv，即 Fv 在所有单元上累加的结果；Fv vector中，的元素的存储次序，与全局/局域编号有关。
\end_layout

\begin_layout Enumerate
P_GFinAccum 是 Global Fin，即 Fin 在所有单元上累加的结果。
\end_layout

\begin_layout Enumerate
P_GRt，
\begin_inset Formula $\mathrm{P\_GRt}=\mathrm{P\_GFv\_T}-\mathrm{P\_GFinAccum}$
\end_inset

，两部分“力”的求和。 
\end_layout

\begin_layout Section
第一类边界条件
\end_layout

\begin_layout Standard
Dirichlet 边界条件定义为：
\begin_inset Formula 
\begin{equation}
\phi=p\quad\text{on}\quad\Gamma_{1}.\label{eq:bound1}
\end{equation}

\end_inset


\begin_inset Formula $\Gamma_{1}$
\end_inset

 是边界上的一部分。JMJin P104：假设 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 上有 
\begin_inset Formula $N_{1}$
\end_inset

 个节点，如果把它们的 全局节点编号 存储在一矢量中，例如 
\begin_inset Formula $\text{nd}(i)$
\end_inset

；把给定的边界值存储在矢量 
\begin_inset Formula $p(i)$
\end_inset

 中。对线性方程组的下述操作 相当于施加第一类边界条件：
\begin_inset Formula 
\begin{equation}
b_{\text{nd}(i)}=p\left(i\right),\quad K_{\text{nd}\left(i\right),\text{nd}\left(i\right)}=1,\quad K_{\text{nd}\left(i\right),j}=0,\quad\text{for}\quad j\neq\text{nd}(i).\label{eq:jm4.60}
\end{equation}

\end_inset

以及
\begin_inset Formula 
\[
b_{j}\to b_{j}-K_{j,\text{nd}(i)}p\left(i\right),\quad K_{j,\text{nd}\left(i\right)}=0\quad\text{for}\quad j\neq\text{nd}(i).
\]

\end_inset

其中 
\begin_inset Formula $i=1,2,3,\cdots,N_{1}$
\end_inset

。
\end_layout

\begin_layout Standard
对于 Galerkin 迭代法，在位于 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 的节点上，
\begin_inset Formula $\phi$
\end_inset

为定值，则 
\begin_inset Formula $\delta\phi=0$
\end_inset

。套用上述处理手段，只需要：
\end_layout

\begin_layout Enumerate
在 
\begin_inset Formula $K$
\end_inset

 矩阵中， 把涉及 
\begin_inset Formula $\Gamma_{1}$
\end_inset

 节点 的行和列去除；
\end_layout

\begin_layout Enumerate
而 
\begin_inset Formula $b_{j}$
\end_inset

 不需要做改动，因为此时 
\begin_inset Formula $p\left(i\right)=0$
\end_inset

。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
第三类边界条件
\end_layout

\begin_layout Standard
Robbin 边界条件：
\begin_inset Formula 
\begin{align}
 & \left(\alpha\nabla\phi\right)\cdot\sbf n+\gamma\phi=q\nonumber \\
\text{即}\quad & \sbf D\cdot\sbf n=q-\gamma\phi\label{eq:bound3}
\end{align}

\end_inset


\end_layout

\begin_layout Itemize
这里的约定是，电位移矢量 
\begin_inset Formula $\sbf D=\alpha_{x}\frac{\partial\phi}{\partial x}\hat{x}+\alpha_{y}\frac{\partial\phi}{\partial y}\hat{y}+\alpha_{z}\frac{\partial\phi}{\partial z}\hat{z}$
\end_inset

；
\end_layout

\begin_layout Itemize
注意对于线性材料，通常定义 
\begin_inset Formula $\sbf E=-\nabla\phi$
\end_inset

，
\begin_inset Formula $\sbf D=\alpha\sbf E$
\end_inset

，也就是有一个负号，所以上面的 
\begin_inset Formula $\alpha$
\end_inset

 为负数。
\end_layout

\begin_layout Standard
对于上面定义的加权残差，现在不展开 
\begin_inset Formula $\sbf n\cdot\sbf D$
\end_inset

 项：
\begin_inset Formula 
\[
R^{e}\left[N_{i}^{e}\right]=\frac{-1}{\varepsilon_{0}}\left[\left(\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\sbf D}+N_{i}^{e}\rho\right)\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}\right]
\]

\end_inset

残差 
\begin_inset Formula $R^{e}\left[N_{i}^{e}\right]$
\end_inset

 趋于零给出的方程是
\begin_inset Formula 
\[
\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\left(\frac{\partial D}{\partial E}\sbf\nabla\delta\phi\right)}\dd{\Omega}=\int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\sbf n\cdot\sbf D}\dd{\Gamma}
\]

\end_inset

代入势场展开 
\begin_inset Formula $\delta\phi=N_{j}^{e}\delta\phi_{j}$
\end_inset

，以及 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:bound3"
plural "false"
caps "false"
noprefix "false"

\end_inset


\begin_inset Formula 
\[
\left[\int_{\Omega^{e}}{\color{blue}\nabla N_{i}^{e}\cdot\left(\frac{\partial D}{\partial E}\nabla N_{j}^{e}\right)}\dd{\Omega}\right]\delta\phi_{j}=\int_{\Omega^{e}}\left({\color{blue}\nabla N_{i}^{e}\cdot\sbf D^{0}}+N_{i}^{e}\rho\right)\dd{\Omega}+\int_{\Gamma^{e}}{\color{brown}N_{i}^{e}\left(q-\gamma\phi\right)}\dd{\Gamma}
\]

\end_inset

仍然进行迭代求解。
\end_layout

\begin_layout Section
第二类边界条件
\end_layout

\begin_layout Standard
JMJin page 90: Neumann 边界条件，相当于在第三类边界条件中取 
\begin_inset Formula $\gamma=0$
\end_inset


\begin_inset Formula 
\begin{align}
 & \left(\alpha\nabla\phi\right)\cdot\sbf n=q\nonumber \\
\text{即}\quad & \sbf D\cdot\sbf n=q\label{eq:bound2}
\end{align}

\end_inset

此外还有齐次诺伊曼边界条件（homogeneous Neumann），相当于在第三类边界条件中取 
\begin_inset Formula $\gamma=q=0$
\end_inset


\begin_inset Formula 
\[
\left(\alpha\nabla\phi\right)\cdot\sbf n=0\quad\text{即}\quad\sbf D\cdot\sbf n=0
\]

\end_inset


\end_layout

\begin_layout Subsection
界面连续性条件
\end_layout

\begin_layout Standard
如果在两种介质的交界面上：
\end_layout

\begin_layout Itemize
材料性质参数例如 
\begin_inset Formula $\alpha_{x}$
\end_inset

，
\begin_inset Formula $\alpha_{y}$
\end_inset

，
\begin_inset Formula $\alpha_{z}$
\end_inset

 有突变（不连续）；
\end_layout

\begin_layout Itemize
并且假设在界面上没有任何表面源（surface source）。
\end_layout

\begin_layout Standard
则
\begin_inset Formula $\phi$
\end_inset

还应该满足连续性条件：
\begin_inset Formula 
\begin{equation}
\phi^{+}=\phi^{-},\quad\text{on}\quad\Gamma_{d}.\label{eq:jm4.4}
\end{equation}

\end_inset

以及
\begin_inset Formula 
\begin{equation}
\left(\alpha_{x}\frac{\partial\phi^{+}}{\partial x}\hat{x}+\alpha_{y}\frac{\partial\phi^{+}}{\partial y}\hat{y}+\alpha_{z}\frac{\partial\phi^{+}}{\partial z}\hat{z}\right)\cdot\hat{n}=\left(\alpha_{x}\frac{\partial\phi^{-}}{\partial x}\hat{x}+\alpha_{y}\frac{\partial\phi^{-}}{\partial y}\hat{y}+\alpha_{z}\frac{\partial\phi^{-}}{\partial z}\hat{z}\right)\cdot\hat{n}\quad\text{on}\quad\Gamma_{d}.\label{eq:jm4.5}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
即电势连续，电位移矢量 
\begin_inset Formula $\sbf D$
\end_inset

连续。
\end_layout

\begin_layout Section
各种自由度记号
\end_layout

\begin_layout Enumerate
AXIS2：表示轴对称系统，取柱坐标系计算。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
NdNum()；节点数目。
\end_layout

\begin_layout Enumerate
DofNum()：自由度数目，取决于体系，例如每个单元中，自由度就是节点上的电势。
\end_layout

\begin_layout Enumerate
GSNum()，GsNumKe()，GsNumFe()，GsNumVe()：高斯点数目；对于阶数不同的多项式，需要的采样点数目不同，因此 Gauss
 点数目可能不同。
\end_layout

\begin_layout Standard
EOF
\end_layout

\begin_layout Chapter
三维空间曲面
\end_layout

\begin_layout Section
仿射变换，局域坐标系
\end_layout

\begin_layout Standard
约定：全局坐标表示为 笛卡尔坐标系中的 
\begin_inset Formula $\sbf r=\left(x,y,z\right)$
\end_inset

 ，二维平面局域坐标表示为 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

。对于三维空间中的曲面上的点，其全局坐标和局域坐标的变换关系为：
\begin_inset Formula 
\begin{align*}
\sbf r & =S.\sbf R+\sbf r_{n}\\
\sbf R & =S^{-1}.\left(\sbf r-\sbf r_{n}\right)
\end{align*}

\end_inset

其中
\begin_inset Formula $\sbf r_{n}$
\end_inset

是第
\begin_inset Formula $n$
\end_inset

个单元的参考点。也可以写成
\begin_inset Formula 
\[
\left[\begin{array}{c}
\sbf r\\
1
\end{array}\right]=\left[\begin{array}{cc}
S & \sbf r_{n}\\
0 & 1
\end{array}\right]\left[\begin{array}{c}
\sbf R\\
1
\end{array}\right]
\]

\end_inset

其中坐标变换矩阵
\begin_inset Formula $S$
\end_inset

为
\begin_inset Formula 
\[
S_{ij}=\sbf d_{i}\cdot{\color{blue}\sbf e_{j}}.
\]

\end_inset

式中 
\begin_inset Formula $\sbf d_{i}$
\end_inset

 表示笛卡尔坐标基矢， 
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 表示局域坐标基矢。因此，
\begin_inset Formula $S$
\end_inset

 的每一列就是 
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 在原坐标系中的分量表示。这里的约定是
\begin_inset Formula 
\[
\left[e_{1}\right]=\left(\begin{array}{c}
e_{1,x}=\sbf d_{1}\cdot\sbf e_{1}\\
e_{1,y}=\sbf d_{2}\cdot\sbf e_{1}\\
e_{1,z}=\sbf d_{3}\cdot\sbf e_{1}
\end{array}\right),\quad\sbf e_{1}\,\text{分量形式为列向量}.
\]

\end_inset

用黑体表示矢量，普通字体表示矢量的分量数组，拉丁下标表示具体的分量。
\end_layout

\begin_layout Corollary
当 
\begin_inset Formula $\sbf d_{i}$
\end_inset

，
\begin_inset Formula ${\color{blue}\sbf e_{j}}$
\end_inset

 都是单位正交基时，
\begin_inset Formula $S$
\end_inset

 是正交矩阵，即
\begin_inset Formula 
\[
S^{-1}=S^{T},\quad S_{ij}^{-1}=S_{ji}.
\]

\end_inset


\begin_inset Formula 
\[
\left[\begin{array}{c}
X\\
Y\\
Z
\end{array}\right]=\left[\begin{array}{c}
e_{1}^{T}\\
e_{2}^{T}\\
e_{3}^{T}
\end{array}\right].\left([r]-[r_{n}]\right)
\]

\end_inset

其中 
\begin_inset Formula $[r]$
\end_inset

，
\begin_inset Formula $[r_{n}]$
\end_inset

 均为列向量。在局域坐标的小范围中，如果将 
\begin_inset Formula $\sbf e_{i}$
\end_inset

 当作常矢量，则有
\begin_inset Formula 
\begin{align*}
 & \dd{X}=[e_{1}^{T}]\cdot\dd{[r]}\\
 & \dd{Y}=[e_{2}^{T}]\cdot\dd{[r]}\\
 & \dd{Z}=[e_{3}^{T}]\cdot\dd{[r]}
\end{align*}

\end_inset

从几何直观上也是可以理解的。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Section
Frenet 标架
\end_layout

\begin_layout Standard
ref: 
\begin_inset CommandInset href
LatexCommand href
name "Frenet 标架"
target "https://zhuanlan.zhihu.com/p/144787656"
literal "false"

\end_inset


\end_layout

\begin_layout Standard
Frenet 公式：
\begin_inset Formula 
\[
\frac{\dd}{\dd{s}}\left[\begin{array}{c}
T(s)\\
N[s]\\
B[s]
\end{array}\right]=\left[\begin{array}{ccc}
0 & \kappa(s) & 0\\
-\kappa(s) & 0 & \tau(s)\\
0 & -\tau(s) & 0
\end{array}\right]\left[\begin{array}{c}
T(s)\\
N[s]\\
B[s]
\end{array}\right]
\]

\end_inset

以弧长作为参数：
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\sbf r(t)$
\end_inset

 变成了 
\begin_inset Formula $\sbf r(s)$
\end_inset

。
\end_layout

\begin_layout Enumerate
单位切向量 
\begin_inset Formula $\sbf T$
\end_inset

：
\begin_inset Formula 
\[
\sbf T(s)=\frac{\dd{\sbf r}}{\dd{s}}=\frac{\dd{\sbf r}/\dd{t}}{\dd{s}/\dd{t}}=\frac{\sbf v}{\abs{\sbf v}}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
曲率 
\begin_inset Formula $\kappa$
\end_inset

：描述了单位切向量随着曲线的改变，也可以看成曲线偏离直线的变化率：
\begin_inset Formula 
\[
\kappa(s)=\frac{\dd{T}}{\dd{s}}=\frac{1}{\abs{\sbf v}}\frac{\dd{\sbf T}}{\dd{t}}
\]

\end_inset


\end_layout

\begin_layout Enumerate
主法向量 
\begin_inset Formula $\sbf N$
\end_inset

：指向曲线转动的方向。定义在在 
\begin_inset Formula $\kappa\neq0$
\end_inset

 的点
\begin_inset Formula 
\[
\sbf N=\frac{1}{\kappa}\frac{\dd{T}}{\dd{s}}.
\]

\end_inset


\end_layout

\begin_layout Enumerate
次法向量：垂直于 
\begin_inset Formula $\sbf T$
\end_inset

–
\begin_inset Formula $\sbf N$
\end_inset

平面
\begin_inset Formula 
\[
\sbf B=\sbf T\times\sbf N.
\]

\end_inset


\end_layout

\begin_layout Enumerate
挠率：
\begin_inset Formula $\tau=-\frac{\dd{\sbf B}}{\dd{s}}\cdot\sbf N$
\end_inset

，代表曲线偏离 
\begin_inset Formula $\sbf T$
\end_inset

–
\begin_inset Formula $\sbf N$
\end_inset

平面的速率。和 曲线的主单位法向量
\end_layout

\begin_layout Standard
三维曲面的边界为一空间曲线，计算其边界的主法线方向需要曲率 
\begin_inset Formula $\kappa\neq0$
\end_inset

；但是在线性单元的近似下，边界上的曲率为零，所以无法计算其主法线方向。
\end_layout

\begin_layout Section
曲面上的泊松方程
\end_layout

\begin_layout Standard
三维曲面上的泊松方程
\begin_inset Formula 
\[
-\nabla_{t}\cdot\epsilon\cdot\nabla_{t}\phi=\rho
\]

\end_inset


\begin_inset Formula $\nabla_{t}$
\end_inset

 表示沿着曲面切平面的梯度。对应的有限元方程中的系数矩阵为
\begin_inset Formula 
\[
K_{ij}^{e}=\int_{\Omega^{e}}\nabla_{t}N_{i}^{e}\cdot\epsilon\cdot\nabla_{t}N_{j}^{e}\dd{\Omega}.
\]

\end_inset


\end_layout

\begin_layout Example
三位曲面四边形单元的雅可比矩阵（对于某一确定单元 
\begin_inset Formula $e$
\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[J\right] & =\left[{\color{blue}\begin{array}{c}
\frac{\partial\sbf r}{\partial\xi}\\
\frac{\partial\sbf r}{\partial\eta}
\end{array}}\right]=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{ccc}
\frac{\partial N_{i}^{e}}{\partial\xi}x_{i} & \frac{\partial N_{i}^{e}}{\partial\xi}y_{i} & \frac{\partial N_{i}^{e}}{\partial\xi}z_{i}\\
\frac{\partial N_{i}^{e}}{\partial\eta}x_{i} & \frac{\partial N_{i}^{e}}{\partial\eta}y_{i} & \frac{\partial N_{i}^{e}}{\partial\eta}z_{i}
\end{array}\right],\quad\text{重复指标求和}\\
 & =\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\left[\begin{array}{ccc}
x_{1} & y_{1} & z_{1}\\
x_{2} & y_{2} & z_{2}\\
x_{3} & y_{3} & z_{3}\\
x_{4} & y_{4} & z_{4}
\end{array}\right]
\end{align*}

\end_inset

从雅可比矩阵可以定义出局域坐标的三个方向（正交归一基）
\begin_inset Formula 
\begin{align*}
 & \sbf e_{1}=\frac{\partial\sbf r}{\partial\xi}/\abs{\frac{\partial\sbf r}{\partial\xi}}\\
 & \sbf e_{3}=\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}/\abs{\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}}\\
 & \sbf e_{2}=\sbf e_{3}\times\sbf e_{1}
\end{align*}

\end_inset


\end_layout

\begin_layout Example
根据局域坐标系 
\begin_inset Formula $\overleftrightarrow{T}=\overleftrightarrow{T}\left(\sbf e_{1},\sbf e_{2},\sbf e_{3}\right)$
\end_inset

 实现全局坐标 
\begin_inset Formula $\sbf r=\left(x,y,z\right)$
\end_inset

 到二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

的变换
\begin_inset Formula 
\[
\sbf R=\overleftrightarrow{T}\sbf r
\]

\end_inset


\begin_inset Formula 
\[
\sbf R=S^{-1}.\left(\sbf r-\sbf r_{n}\right),\quad S^{-1}=\left[\begin{array}{c}
\sbf e_{1}^{T}\\
\sbf e_{2}^{T}\\
\sbf e_{3}^{T}
\end{array}\right]
\]

\end_inset

系数矩阵计算需要的形函数的切向梯度可以在二维平面局域坐标 
\begin_inset Formula $\sbf R\left(X,Y\right)$
\end_inset

下计算（参考
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi2"
plural "false"
caps "false"
noprefix "false"

\end_inset

）
\begin_inset Formula 
\begin{align*}
\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial X} & \frac{\partial N_{2}^{e}}{\partial X} & \frac{\partial N_{3}^{e}}{\partial X} & \frac{\partial N_{4}^{e}}{\partial X}\\
\frac{\partial N_{1}^{e}}{\partial Y} & \frac{\partial N_{2}^{e}}{\partial Y} & \frac{\partial N_{3}^{e}}{\partial Y} & \frac{\partial N_{4}^{e}}{\partial Y}
\end{array}\right] & =\left[\begin{array}{cc}
\frac{\partial\xi}{\partial X} & \frac{\partial\eta}{\partial X}\\
\frac{\partial\xi}{\partial Y} & \frac{\partial\eta}{\partial Y}
\end{array}\right]\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\\
\frac{\partial X}{\partial\eta} & \frac{\partial Y}{\partial\eta}
\end{array}\right]^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left[\begin{array}{cc}
\frac{\partial\sbf r}{\partial\xi}\cdot\sbf e_{1} & \frac{\partial\sbf r}{\partial\xi}\cdot\sbf e_{2}\\
\frac{\partial\sbf r}{\partial\eta}\cdot\sbf e_{1} & \frac{\partial\sbf r}{\partial\eta}\cdot\sbf e_{2}
\end{array}\right]^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]\\
 & =\left(\left[\begin{array}{c}
\frac{\partial\sbf r}{\partial\xi}\\
\frac{\partial\sbf r}{\partial\eta}
\end{array}\right]\left[\begin{array}{cc}
\sbf e_{1} & \sbf e_{2}\end{array}\right]\right)^{-1}\left[\begin{array}{cccc}
\frac{\partial N_{1}^{e}}{\partial\xi} & \frac{\partial N_{2}^{e}}{\partial\xi} & \frac{\partial N_{3}^{e}}{\partial\xi} & \frac{\partial N_{4}^{e}}{\partial\xi}\\
\frac{\partial N_{1}^{e}}{\partial\eta} & \frac{\partial N_{2}^{e}}{\partial\eta} & \frac{\partial N_{3}^{e}}{\partial\eta} & \frac{\partial N_{4}^{e}}{\partial\eta}
\end{array}\right]
\end{align*}

\end_inset


\end_layout

\begin_layout Section
约定和总结
\end_layout

\begin_layout Enumerate
\begin_inset Formula $r_{j}$
\end_inset

 表示全局坐标，三维空间自由度 
\begin_inset Formula $j\in\left\{ 1,2,3\right\} $
\end_inset

，
\begin_inset Formula $\partial_{j}$
\end_inset

 表示对全局坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\overline{x}_{\alpha}$
\end_inset

 表示有限元中的采样点（node）， 
\begin_inset Formula $\alpha\in{1,2,\cdots,N}$
\end_inset

（希腊字母），一阶三角形单元
\begin_inset Formula $3$
\end_inset

个，二阶三角形
\begin_inset Formula $6$
\end_inset

个；一阶四边形
\begin_inset Formula $4$
\end_inset

个 等等。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $x_{p}^{\prime}$
\end_inset

 表示单元中二维平面的局域物理坐标 
\begin_inset Formula $\sbf R=\left(X,Y\right)$
\end_inset

，
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

，
\begin_inset Formula $\partial_{p}^{\prime}$
\end_inset

 表示对局域坐标求偏导。
\end_layout

\begin_layout Enumerate
\begin_inset Formula $\xi_{p}$
\end_inset

 表示将二维局域坐标再变换到等参坐标 
\begin_inset Formula $\left(\xi_{1},\xi_{2}\right)$
\end_inset

，或记作
\begin_inset Formula $\left(\xi,\eta\right)$
\end_inset

，平面自由度 
\begin_inset Formula $p\in\left\{ 1,2\right\} $
\end_inset

（拉丁字母）；
\begin_inset Formula $\hat{\partial}_{p}$
\end_inset

 表示对
\begin_inset Formula $\left\{ \xi,\eta\right\} $
\end_inset

求导。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\begin_layout Enumerate
全局物理坐标对等参坐标的雅可比行列式
\begin_inset Formula 
\begin{equation}
J_{pj}=\hat{\partial}_{p}{\color{blue}r_{j}}=\left[\begin{array}{ccc}
\frac{\partial x}{\partial\xi} & \frac{\partial y}{\partial\xi} & \frac{\partial z}{\partial\xi}\\
\frac{\partial x}{\partial\eta} & \frac{\partial y}{\partial\eta} & \frac{\partial z}{\partial\eta}
\end{array}\right]=\hat{\partial}_{p}\,{\color{blue}N_{\alpha}\,\overline{x}_{\alpha j}},\quad[2,3]\label{eq:jacobi9}
\end{equation}

\end_inset

其中 ，对于选定的单元 
\begin_inset Formula $N_{\alpha}$
\end_inset

 形式已知，
\begin_inset Formula $\overline{x}_{\alpha j}$
\end_inset

 是节点坐标为已知常量，所以 
\begin_inset Formula $J_{pj}$
\end_inset

 可以直接求得，维数是 
\begin_inset Formula $2\times3$
\end_inset

。
\end_layout

\begin_layout Enumerate
局域物理坐标的三个单位正交基
\begin_inset Formula 
\begin{align*}
\sbf e_{1} & =J_{1\cdot}/\abs{J_{1\cdot}},\quad\text{点表示取整列}\\
\sbf e_{3} & =J_{1\cdot}\times J_{2\cdot}/\abs{J_{1\cdot}\times J_{2\cdot}},\\
\sbf e_{2} & =\sbf e_{3}\times\sbf e_{1}.
\end{align*}

\end_inset

之所以按此序列构造，是为了保证 
\begin_inset Formula $\sbf e_{1}$
\end_inset

，
\begin_inset Formula $\sbf e_{2}$
\end_inset

，
\begin_inset Formula $\sbf e_{3}$
\end_inset

 是相互垂直的。求出
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi9"
plural "false"
caps "false"
noprefix "false"

\end_inset

中的 
\begin_inset Formula $J_{pj}$
\end_inset

，即可求出每个单元所属的 
\begin_inset Formula $\sbf e_{j}$
\end_inset

。可以把 
\begin_inset Formula $\left\{ \sbf e_{j}\right\} $
\end_inset

的分量写成数组形式（矩阵）。分量数组用普通字体表示，将 
\begin_inset Formula $[e_{i}]$
\end_inset

分别填入
\color blue
每列
\color inherit

\begin_inset Formula 
\begin{equation}
E_{ij}=\left[\begin{array}{ccc}
\vdots & \vdots & \vdots\\
e_{1} & e_{2} & e_{3}\\
\vdots & \vdots & \vdots
\end{array}\right],\quad[3,3]\label{eq:unitVector}
\end{equation}

\end_inset

则 指标
\begin_inset Formula $1$
\end_inset

索引 基矢的分量，指标
\begin_inset Formula $2$
\end_inset

索引 基矢的编号。
\end_layout

\begin_layout Enumerate
局域几何坐标 对 等参坐标的 雅可比矩阵：
\begin_inset Formula 
\begin{equation}
L_{pq}=\hat{\partial}_{p}x_{q}^{\prime}=\left[\begin{array}{cc}
\frac{\partial X}{\partial\xi} & \frac{\partial Y}{\partial\xi}\\
\frac{\partial X}{\partial\eta} & \frac{\partial Y}{\partial\eta}
\end{array}\right]=J_{pj}\,E_{jq},\quad[2,2]\label{eq:jacobi3}
\end{equation}

\end_inset


\begin_inset Formula $p,q\in\{1,2\}$
\end_inset

， 
\begin_inset Formula $J$
\end_inset

 和 
\begin_inset Formula $E$
\end_inset

 分别在 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi9"
plural "false"
caps "false"
noprefix "false"

\end_inset

 和 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:unitVector"
plural "false"
caps "false"
noprefix "false"

\end_inset

 中求出，注意使用 
\begin_inset Formula $E$
\end_inset

 时只取了前两列。
\end_layout

\begin_layout Enumerate
形函数 对 局域几何坐标 的梯度
\begin_inset Formula 
\[
{\color{blue}\partial_{p}^{\prime}}\,N_{\alpha}={\color{blue}L_{pq}^{-1}\,\hat{\partial}_{q}}N_{\alpha},\quad[2,N]
\]

\end_inset

其中
\begin_inset Formula $N$
\end_inset

是节点的数目，
\begin_inset Formula $L^{-1}$
\end_inset

是 
\begin_inset CommandInset ref
LatexCommand eqref
reference "eq:jacobi3"
plural "false"
caps "false"
noprefix "false"

\end_inset

 的逆。至此，
\begin_inset Formula $\nabla_{t}N_{i}^{e}$
\end_inset

已经求出。
\end_layout

\begin_layout Enumerate
计算均在等参坐标平面进行，即坐标变换步骤为 全局系的曲面
\begin_inset Formula $\Rightarrow$
\end_inset

局域系的平面
\begin_inset Formula $\Rightarrow$
\end_inset

等参系的平面。最后需要在 
\begin_inset Formula $\xi$
\end_inset

–
\begin_inset Formula $\eta$
\end_inset

 等参系平面，用高斯积分法计算积分：
\begin_inset Formula 
\[
\iint_{\Omega^{\prime e}}F\left(L_{1}^{e},L_{2}^{e},L_{3}^{e}\right)\dd{X}\dd{Y}=\sum_{i=1}^{m}F\left(L_{1i}^{e},L_{2i}^{e},L_{3i}^{e}\right)W_{i}^{\prime}\det[J]
\]

\end_inset

与平直面元的区别是，现在 
\begin_inset Formula $\det[J]$
\end_inset

=
\begin_inset Formula $\frac{\partial(X,Y)}{\partial\left(\xi,\eta\right)}$
\end_inset

 在每个高斯点上可以不同。
\begin_inset Formula $\det[J]$
\end_inset

 在几何上等于局域基矢 
\begin_inset Formula $\{\frac{\partial\sbf r}{\partial\xi},\frac{\partial\sbf r}{\partial\eta}\}$
\end_inset

 架设的四边形的面积；在程序中此面积可直接用 
\begin_inset Formula $\frac{\partial\sbf r}{\partial\xi}\times\frac{\partial\sbf r}{\partial\eta}$
\end_inset

 计算。
\end_layout

\begin_layout Standard
\begin_inset Separator plain
\end_inset


\end_layout

\end_body
\end_document
