# solver 动网格

[comsol的四大框架](https://zhuanlan.zhihu.com/p/344255030)

COMSOL中有四大框架, 分别是, 后面表示 comsol 采用的 默认符号

+ 材料框架 material frame (X, Y, Z, t);
+ 空间框架 spatial frame (x, y, z, t);
+ 网格框架 mesh frame (Xm, Ym, Zm, t);
+ 几何框架 geometry frame (Xg, Yg, Zg, t);

关于四大框架, 有如下说明:

+ 如果没有添加 `变形网格`, 四个框架是重合的; 使用的是 `spatial frame` 的名称;
+ 添加 `moving mesh` 或 `固体力学` 后, `material` 和 `spatial` 分离;
+ 添加 `Deformed Geometry`(变形几何) 后, `geometry` 和 `material` 分离;

+ 添加 `Deformed Configuration`(变形配置网格) 后, `geometry` 和 `mesh` 分离;
这个功能 需要勾选 `Study/Step1:Time Dependent/ Automatic remeshing`,
并在 `Solver Configurations/Solution1/Time-Dependent Solver 1/Automatic Remeshing` 中设置
网格重剖分条件 `Condition for Remeshing`.

重剖分生成的网格, 会挂载到 `Component1/Mesh` 节点下面, 名称为
`Deformed Configuration 2(frommesh1)` 等等.

+ 材料定义在材料框架;网格定义在网格框架;空间框架固定不变;

⑥PDE是建立在材料框架或空间框架之上;

注意:

在后处理时, 要注意solution中所选的框架, 从而在数据处理时保持一致, 避免不必要的错误.

## 移动网格和变形几何(deformed geometry & moving mesh)

[COMSOL自学学习笔记(二)](https://zhuanlan.zhihu.com/p/402597316)

+ `moving mesh`(动网格) 接口可用于 所有或部分几何 相对于 绝对参考坐标系 `移动` 的模型.
    + 适用在刚性固体对象区域的移动(固体对象本身不会变形, 或不考虑其自身变形, 即整体平移)

+ `deformed geometry`(变形网格) 接口可用于几何形状发生变形的模型, 使材料区域跟随 `几何变形` 刷新.
    + 多适用在流体区域(空气, 液体等), 也以可是变形的固体区域, `网格节点自动变化`在 `Definitions/Moving Mesh` 或 `Add Physics/ Mathematics/Deformed Mesh` 中都能找到:
    + `Definitions/Moving Mesh` 中实际包括了 变形几何 与 移动网格 的各种功能
    + `Add Physics/ Mathematics/Deformed Mesh` 中包括 变形几何 与 移动网格 两个独立接口, 将其更具体地分开

### 原理基础

在 COMSOL Multiphysics 中, 参考坐标系称为 `spatial坐标系`,
默认情况下, 其坐标为小写字母 (x, y, z, 轴对称情况下为 r, phi, z) .

相对于材料静止的坐标系称为 `Material坐标系`, 默认情况下,
其坐标为大写字母 (X, Y, Z, 轴对称情况下为 R, PHI, Z).

`Deformed Mesh interface` 使 `spatial坐标系坐标系` 中的 网格 进行特定坐标变换:

$$x=f(X,Y,Z,\cdots)\\
y=g(X,Y,Z,\cdots)\\
z=h(X,Y,Z,\cdots)\\$$

变量 x, y 和 z 是空间坐标系中网格点的坐标.
函数 f, g 和 h 是任意的, 它们的自变量通常是材料坐标系 `(X, Y, Z)` 中的点坐标.

其意义: 空间坐标系中某点 与 材料坐标系中某点 一一映射,
在计算时, 空间中该点的属性 即为 材料坐标中对应点的属性,
从而实现材料在空间中的 "移动或变形".
(注: 在 `Results`节点 中查看网格时, 应选择 空间坐标系 框架)

### E--L 参考系

空间中 `物理` 的计算离不开一个作为标准的 `参考系`(坐标系), 注意他们的意义和原理.

+ 欧拉坐标(Euler) : 称空间坐标, 坐标固定在空间中.
如果对于质点的运动来说, 是研究不同质点经过空间一定点的状态.

+ 拉格朗日坐标(Lagrangian) : 称 `材料坐标`, 坐标固定在材料上.
如果对于质点的运动来说, 是 跟随质点 研究 质点的运动状态.

+ 两种坐标都是物理上为了描述物质运动而建立的,
与数学上的笛卡尔坐标(空间直角坐标)意义不同.

由于其自身特点:

**欧拉坐标多用于流体运动的研究**, 它的网格在空间中固定不变,
质点可以在网格间流动, 计算精度不变, 但是很难捕捉物质的边界.

**拉格朗日坐标多用于固体运动的研究**, 它的网格与固体一体(固定在材料上),
网格被固定在质点上, 能过十分精确的描述边界, 但当固体变形过大时会使网格严重畸形, 不利于计算.

### 适用分析

由上面的两种坐标的特点, 我们知道:

① 研究固体运动

当使用固体力学接口时, 其计算采用拉格朗日坐标, 网格已经贴覆在固体上, 能够随它变形而变形, 已经是"变形网格"了.

当没有使用固体力学接口时, 需要使用欧拉坐标 + 变形网格.

② 研究流体运动, 使用欧拉坐标, 网格在空间中固定, 然而流体区域(流体所在空间)可能会发生变化, 此时原来的网格不能满足当前的流体计算, 需要刷新网格跟随流体区域, 这时就需要使用变形网格.

例如, 研究放气时气球内的气体流动

③ 研究流固耦合时, 流体与固体之间发生作用, 固体变形的同时流体所在空间也在变, 所以固体内使用拉格朗日坐标, 流体区域要使用欧拉坐标 + 变形网格

例如, 研究放气时气球表面张力与气体流动的速度, 研究导体受电磁力变形时空气中的磁场.

④ 研究流流耦合, 欧拉坐标 + 变形网格

⑤ 注意:

某一区域的点的属性被另一区域点的属性替代, 等效了材料的移动或变形
移动的是网格的节点.

只有网格形状改变, 网格的排布结构与数量不变, 可能出现网格单元畸形, 反转情况, 导致收敛性变差.

可启用 自动重新剖分网格 功能, 在每次节点移动后判断是否重新剖分网格, 避免出现前面的问题.

指定区域的网格变换方式(变换函数)是一致的, 即移动效果是一致的.
故主动指定网格移动只能用于刚体部件的分析区域(移动区域内部的模型在移动过程中不发生变形, 平移).

可通过 自由变形 实现某区域自动根据其他变形的区域或变形的条件发生变形(随主动变形或变形条件从动).
指定了 自由变形 的区域, 会随发生变化的网格区域自动变形.

通过 指定移动网格 等接口可以设置表达式指定网格中主动移动或变形的行为.

表达式可以来自自定义函数变量, 其他物理场变量(如, 位移场变量), 微分方程.

固体力学接口 会改变几何形状(固体对象区域), 属于内置的主动变化.

与指定移动网格 等接口功能会发生冲突, 二者定义其一即可.

