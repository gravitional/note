# template.regex.md

在程序中使用时, `\`可能需要转义成`\\`

## {} -> \r

删除`{}`内的内容, 并换成换行符` \r `, 贪婪模式

```reg
%s/\{.+\}/\r/g
```

## 解析 Markdown 语法

[正则表达解析 Markdown 语法](https://blog.csdn.net/weixin_33967071/article/details/91427955)

`Markdown` 语法包括 `标题`, `图片`, `链接`, `引用块`, `列表`, `粗体`, `斜体` 等, 下面是解析这些语法的正则表达式和简单说明:

+ `标题` ; 以一个或多个`#`开头的字符串, 并且`#`之后有`0`个或以上的字符, 如: `### 三级标题`;

    ^(#+)(.*)

+ 链接 ; 在 Markdown 语法中链接的表示形式为 `[链接](URL)`;

    /\[[\s\S]*?\]\([\s\S]*?\)/g

    解释:  匹配 `[` 符号开始, 紧接着 `[\s\S]` --范围, 空白符或者非空白符都可以,即全部.
    `*` -- 出现`0`次或者无限次, `?`-- 非贪婪模式, 让正则表达式尽可能少的匹配, 也就是说一旦匹配成功匹配不再继续尝试.
    做法很简单, 在量词后面加上`?`即可.
+ 斜体 ; 以一个 `*` 或者 `_` 开头并结尾, `\1`是后向引用, 表示规则和第一个集合相同, 中间包含0个或多个字符的字符串.

    (\*|_)(.*?)\1

+ 图片, 模式类似于链接

    !\[[^\]]+\]\([^\)]+\)

+ 粗体, 同斜体

    (\*\*|__)(.*?)\1

+ 删除线

    \~\~(.*?)\~\~

+ 引用块

    \n(&gt;|\>)(.*)

+ 内联代码块

    `{1,2}[^`](.*?)`{1,2}

+ 分割线

    ^-+$

+ fenced 代码块

    ```([\s\S]*?)```[\s]?

+ 无序列表

    ^[\s]*[-\*\+] +(.*)

+ 有序列表

    ^[\s]*[0-9]+\.(.*)

写成函数:

```java
function abstractFn(res){
  if(!res){
    return '';
  }else{
    var str=res.replace(/(\*\*|__)(.*?)(\*\*|__)/g,'')    //全局匹配 粗体
    .replace(/\!\[[\s\S]*?\]\([\s\S]*?\)/g,'')                  //全局匹配图片
    .replace(/\[[\s\S]*?\]\([\s\S]*?\)/g,'')                    //全局匹配连接
    .replace(/<\/?.+?\/?>/g,'')                                 //全局匹配内html标签
    .replace(/(\*)(.*?)(\*)/g,'')                               //全局匹配内联代码块
    .replace(/`{1,2}[^`](.*?)`{1,2}/g,'')                       //全局匹配内联代码块
    .replace(/```([\s\S]*?)```[\s]*/g,'')                       //全局匹配代码块
    .replace(/\~\~(.*?)\~\~/g,'')                               //全局匹配删除线
    .replace(/[\s]*[-\*\+]+(.*)/g,'')                           //全局匹配无序列表
    .replace(/[\s]*[0-9]+\.(.*)/g,'')                           //全局匹配有序列表
    .replace(/(#+)(.*)/g,'')                                    //全局匹配标题
    .replace(/(>+)(.*)/g,'')                                    //全局匹配摘要
    .replace(/\r\n/g,"")                                        //全局匹配换行
    .replace(/\n/g,"")                                          //全局匹配换行
    .replace(/\s/g,"")                                          //全局匹配空字符;
    return str.slice(0,155);
  }
}
```

### 匹配中文

[Unicode汉字正则表达式的探究](https://zhuanlan.zhihu.com/p/363555122)
[正则匹配中文](https://zhuanlan.zhihu.com/p/99790819)

+ `Unicode 1.0.1` ; 匹配中文字符的正则表达式: `[\u4e00-\u9fa5]`
+ 匹配双字节字符(包括汉字在内): `[^\x00-\xff]`, 中文是`双字节字符`的一部分.
注: 可以用来计算字符串的长度(一个双字节字符长度计2, ASCII字符计1)

常用正则表达式匹配规则:

+ 英文字母;  `[a-zA-Z]`
+ 数字; `[0-9]`
+ 匹配中文, 英文字母和数字及 `_` ; `^[\u4e00-\u9fa5_a-zA-Z0-9]+$`
+ 同时判断输入长度;

    ```re
    `[\u4e00-\u9fa5_a-zA-Z0-9_]{4,10}`
    ^[\w\u4E00-\u9FA5\uF900-\uFA2D]*$
    ```

+ 只含有汉字, 数字, 字母, 下划线, 不能以下划线开头和结尾:

    ```re
    ^(?!_)(?!.*?_$)[a-zA-Z0-9_\u4e00-\u9fa5]+$
    ```

    其中:

    + `^` 匹配字符串开头, `$`匹配字符串结尾.
    + `(?!_)`: 反向预查, 不能以 `_` 开头
    + `(?!.*?_$)` ; 不能以 `_` 结尾
+ 至少一个汉字, 数字, 字母, 下划线

    ```re
    [a-zA-Z0-9_\u4e00-\u9fa5]+　　
    ```

+ 只含有汉字, 数字, 字母, 下划线, 下划线位置不限:

    ```re
    ^[a-zA-Z0-9_\u4e00-\u9fa5]+$
    ```

+ 由数字, 26个英文字母或者下划线组成的字符串

    ```re
    ^\w+$
    ```

+ 2~4个汉字

    ```re
    @"^[\u4E00-\u9FA5]{2,4}$"; // @ 表示字面字符串
    ```

### 处理 markdown 行内代码

```re
(?<=[^ ])(`[\u4e00-\u9fa5_a-zA-Z0-9]+?`)(?=[^ ])
// vscode 替换
(?<=[^ ^])(`{1,2}[^,`][a-zA-Z0-9_<>@\!%\*\^\$\(\)\[\]\{\}='"#_\-\. ]+?`{1,2})(?=[^ $])
(?<=[^ ^])(`{1,2}[^,`][a-zA-Z0-9~!@#\$%\^&\*\(\)\-=\+\[\]\{\}\\\|;:'"<>\/\\.\? ]+?`{1,2})(?=[^ $])
  $1 // 在左右添加空格
``

```re
//先捕获所有行内代码, 在两边加上空格
(`{1,2}[^`](.*?)`{1,2})
 $1 //
// 再删除多余的空格
( `{1,2}[^`](.*?)`{1,2} )[ ]+?
$1//
```
