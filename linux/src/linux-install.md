# Linux 系统安装

## 一些概念

+ `Partition` ; `分区` 是 `硬盘` 的一部分, 用于存储数据(文件),它使用被称为 `文件系统` 的特定存储格式.
分区可能是安装 `操作系统` 流程的一部分, 也可以仅用于存储文件.
单个 `驱动器`(driver) 可能被分割成多个 `分区`, 每个 `分区` 作为 独立的实体, 并使用自己的 `文件系统`.
所有的驱动器, 无论是 `硬盘` 或 `闪存驱动器`--例如 `USB`盘, 都包含一个或多个分区.
分区的著名例子是 `C: ` 盘,  被微软Windows使用.

+ `file system`; `文件系统` 是用于在 `分区` 中写入 `文件` 的格式.
一些流行的文件系统是: `ntfs`(微软Windows使用),
`ext4` (Linux使用的), `fat32`, `btrfs` 和 `xfs`.
每种 `文件系统` 都是在不同的环境下使用的, 并有自己的优势和劣势.
例如, `fat32` 几乎可以被任何 `操作系统` 读取, 但是其中存储的文件必须小于 `4GB`.

+ `partition table`; `分区表` 是 `驱动器` 上现有的所有 `分区` 的列表.
它的两个主要类型是 `主引导记录`(MBR)和 `GUID分区表`(GPT).
不同的 `分区表` 允许不同类型的 `分区`, 如 `主分区`(primary) 和 `拓展分区`(extended).
`MBR分区表` 一般用于旧的 `BIOS` 系统, 只能包含有限数量的主分区,
而 `GPT` 一般用于较新的 `UEFI` 系统, 没有这种限制, 但情况并非总是如此.

+ `Directory `; 目录是 Windows 上通常称为 `文件夹`(folder) 的东西. 你可以把它们当作一个东西.

+ `Directory Tree`; Linux 上的目录是以树的形式排列的, 从 `/` 目录开始, 称为 `根目录`(root).
每个 `目录` 都有特定的用途. 例如, `/home` 目录存放用户的个人文件, 而 `/etc` 目录存放整个系统的配置文件.
关于 `目录树` 的完整描述可以在 [维基百科][] 上找到:

+ `Mount point`; `挂载点` 代表用来访问 `分区` 的 `目录`.
就像在 Windows 的文件管理器中点击 `C: 盘` 可以看到这个分区的内容一样,
点击一个 `分区` 挂载到的 `目录` 就可以查看其内容.

[维基百科]: https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard

此外, 在启动计算机时, 从启动硬件到登录操作系统, 都会用到几个程序.

+ `Live-CD`; `Live-CD` 是一个在计算机 `内存` 中运行的操作系统版本, 不需要访问硬盘驱动器.
它通常从启动时使用的 `CD`, `DVD` 或 `USB盘` 加载, 对 `Live 环境` 所做的改变不会被保存.
`Live-CD` 经常被用来预览一个操作系统, 其包含安装系统的工具.
它们也可以用来管理 `硬盘的分区` 和 挽救丢失的数据.

+ `BIOS`;  `Basic Input/Output System`(基本输入/输出系统) 是在启动时, 用于初始化硬件的 `固件`(firmware).
它在菜单中提供各种设置, 在电脑 `启动`(boot)时按下特定的按键就可以访问.
使用 `BIOS` 的系统通常具有 `MBR` 分区表.
它可以用来从 `U盘` 启动, 启动 `Live环境` 和安装例如 `Manjaro`.

+ `UEFI`; `Unified Extensible Firmware Interface`(统一可扩展固件接口)是 `BIOS` 的继承者.
它经常被用于较新的计算机上, 它仍然有类似于 `BIOS` 的菜单 (因此 `UEFI` 也常常被泛称为 `BIOS`).
`UEFI`通常有一个传统模式(`legacy`), 即仍使用 `BIOS`.
使用  `UEFI` 的计算机上的操作系统所使用的分区方案, 与 `BIOS` 系统上的分区方案略有不同.
例如需要一个小小的 `fat32` 分区, 来包含启动时使用的一些文件.
使用 `UEFI` 的系统通常具有 `GPT` 分区表.

+ `Boot loader`; `启动(开机)加载器`是一个程序, 它可以让你在打开电脑时选择启动哪个操作系统.
在启动时, 会显示计算机上所有检测到的 `操作系统` 的列表.
最广泛使用的启动加载器之一是 `GRUB`,
它正是 `Calamares` 安装的程序, 而前者就是 `Manjaro` 的安装程序.

## 一般的安装流程

[manjaro 用户指南第2章](https://manjaro.org/support/userguide/)
[ubuntu 桌面安装指南](https://ubuntu.com/tutorials/install-ubuntu-desktop#1-overview)

[Manjaro WiKi 的解决方案]: https://wiki.manjaro.org/index.php/Configure_Graphics_Cards

这里我假设你的电脑引导方式是 `UEFI`, 如果你的 `ssd` 是 `NVMe` 协议 `M.2` 的,
需要在进入安装界面之前先进去 `BIOS` 里面修改从硬盘的启动形式, 把 `RAID` 改成 `AHCI`,
保存退出, 否则进入安装界面你不会看到你的`NVMe`硬盘, 做好这件事, 其他就都和普通 `ssd` 一样了.

还需要注意的一点是, 修改成`AHCI`模式之后, 重新进入`Windows`时会有问题,
这个时候不要慌, 等电脑自动重启第三次的时候, 进入安全模式启动 `Windows`, 进去之后重启系统, 再次进入 `Windows` 就不需要安全模式了

插上 `U盘`, 在电脑`logo`出现之前狂按`F12`手动选择从`U`盘启动.
如果你的电脑有`NVIDIA`和 `Intel` 双显卡的话, 开机界面将 `drive` 改成 `nonfree`, 这样系统会自动帮你安装适配的 `NVIDIA` 驱动(简直太方便了)
如果这一步你没有改, 进去之后手动安装 `NVIDIA` 驱动, 千万不要自己随便安装,
这样很可能会导致下次启动进入 `X-Window` 界面失败, 具体怎么安装可以参考 [Manjaro WiKi 的解决方案][]

为保安装一步成功请在启动安装程序之前先联网,
一般来讲, 你只要在 `Windows` 下给 `Manjaro` 预留出磁盘空间, 如果你有多个硬盘记得在安装窗口的最上面选对硬盘,
安装时候的分区方案直接选择取代一个分区, 点击你之前分好的硬盘空间, 接着下一步即可.

### 如果你需要手动分区

压缩出一定的空白空间, 或者使用新的空白硬盘, 在安装的时候选择 `手动分区`(Manual partitioning),
确保 `分区表`(partition table) 类型是 `GPT`(GUID Partition Table).

+ 首先创建 `EFI 分区`, 它用来存放开机启动时使用的文件.
    + 大概 `500MB`, 使用 `fat32` 格式
    + 并选择 `/boot/efi` 作为挂载点, 注意不要选成 `/boot`,
    + 最后, 再给它打上 `boot` 和 `esp` flags.
    + 如果想要双系统(dual-boot), 只需要将 Windows 系统盘 上已存在的 `EFI` 分区挂载到 `/boot/efi`, 并设置 flags.
    并选择 `保留`(Keep)分区内容.

> 其中 `boot`是指开机启动, `eps` 是指 `EFI system partition`.

+ 然后创建 `交换分区`, 分区格式为 `linuxswap`, 建议大小在 `Sqrt[A]~A`,  `A` 是你的物理内存.

+ 然后创建 `根分区`, 它用来存放主要的系统文件, 所以必须存在.
最简单的, 把硬盘剩下的 `全部空白` 分配给 `根分区`, 格式为 `ext4`, 让它挂载到 `/` 目录.

+ 可以适当拖动并调整分区, 例如让顺序为 `EFI System -- Root -- Swap`, 调整到你满意为止.
