# 第二十章:正则表达式

追溯到 `Unix` 刚刚开发的时候,它只知道 `ASCII` 字符. 在 `ASCII` 中,前`32`个字符 (数字`0-31`)都是控制码(如 `tabs`,`backspaces`,和`回车`).
随后的`32`个字符(`32-63`)包含可打印的字符, 包括大多数的标点符号和数字`0`到`9`.
再随后的`32`个字符(`64-95`)包含大写字符和一些更多的标点符号.  最后的`31`个字符(`96-127`)包含小写字母和更多的标点符号.
基于这种安排方式,系统使用这种排序规则 的 `ASCII`:

```bash
ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz
```

而普通的字典顺序像这样:

```bash
aAbBcCdDeEfFgGhHiIjJkKlLmMnNoOpPqQrRsStTuUvVwWxXyYzZ
```

随着 `Unix` 系统的知名度在美国之外的国家传播开来,就需要支持不在 U.S.英语范围内的字符.
于是就扩展了`ASCII` 字符表,使用了整个`8`位,添加了字符(数字`128-255`),这样就 容纳了更多的语言.
为了支持这种能力,`POSIX` 标准介绍了一种叫做 `locale` 的概念,其可以被调整,来为某个特殊的区域, 选择所需的字符集. 通过使用下面这个命令,我们能够查看到我们系统的语言设置:

```bash
[me@linuxbox ~]$ echo $LANG
en_US.UTF-8
```

通过这个设置,`POSIX` 相容的应用程序将会使用字典排列顺序而不是 `ASCII` 顺序. 当`[A-Z]`字符区域按照字典顺序解释的时候,包含除了小写字母`a`之外的所有字母.
为了部分地解决这个问题,`POSIX` 标准包含了大量的字符集,其提供了有用的字符区域.  下表中描述了它们:

表20-2: POSIX 字符集
字符集 说明

+ `[:alnum:]`:   字母数字字符. 在 `ASCII` 中,等价于:`[A-Za-z0-9]`
+ `[:word:]`:   与`[:alnum:]`相同, 但增加了下划线字符.
+ `[:alpha:]`:   字母字符. 在 `ASCII` 中,等价于:`[A-Za-z]`
+ `[:blank:]`:   包含`空格`和 `tab` 字符.
+ `[:cntrl:]`:   `ASCII` 的控制码. 包含了`0`到`31`,和`127`的 `ASCII` 字符.
+ `[:digit:]`:   数字`0`到`9`
+ `[:graph:]`: 可视字符. 在 `ASCII` 中,它包含`33`到`126`的字符.
+ `[:lower:]`:   小写字母.
+ `[:punct:]`:   标点符号字符. 在 `ASCII` 中
+ `[:print:]`:   可打印的字符. 在`[:graph:]`中的所有字符,再加上`空格`字符.
+ `[:space:]`:   空白字符,包括`空格`,`tab`,`回车`,`换行`,`vertical tab`, 和 `form feed`.在`ASCII` 中, 等价于:`[ \t\r\n\v\f]`
+ `[:upper:]`:   大写字母.
+ `[:xdigit:]`: 用来表示十六进制数字的字符. 在`ASCII` 中,等价于:`[0-9A-Fa-f]`

## 用 find 筛选不规范文件名

`find` 命令支持一个基于正则表达式的测试.
当某一行包含的字符串匹配上了一个表达式的时候,`grep` 命令会打印出这一行,然而 `find` 命令要求路径名精确地匹配这个正则表达式.
在下面的例子里面,我们将使用带有一个正则表达式的 `find` 命令,来查找每个路径名,其包含的任意字符都不是以下字符集中的一员.

```bash
[-\_./0-9a-zA-Z]
```

这样一种扫描会发现包含空格和其它潜在不规范字符的路径名:

```bash
[me@linuxbox ~]$ find . -regex '.*[^-\_./0-9a-zA-Z].*'
```

由于要精确地匹配整个路径名,所以我们在表达式的两端使用了`.*`来匹配零个或多个字符.  在表达式中间,我们使用了否定的中括号表达式,其包含了我们一系列可接受的路径名字符.

## 用 locate 查找文件

`locate` 程序支持基本的(`--regexp` 选项)和扩展的(`--regex` 选项)正则表达式.

```bash
[me@linuxbox ~]$ locate --regex 'bin/(bz|gz|zip)'
```

通过使用 `alternation`,我们搜索包含 `bin/bz`,`bin/gz`,或`/bin/zip` 字符串的路径名.
